(self.webpackChunktheoviz=self.webpackChunktheoviz||[]).push([[792],{17:uu=>{const Je="maplibre_gl_dates";function et(ee,fe){let ue=st(fe);ee.getStyle().layers.map(function(K){if(!("source-layer"in K))return;let Ee=Z(ee.getFilter(K.id),ue);ee.setFilter(K.id,Ee)})}function st(ee){let fe;if("string"==typeof ee)fe=Pe(ee);else if(ee instanceof Date&&!isNaN(ee)){let ue=p(ee),K=ee.toISOString().split("T")[0];fe={startDate:ee,startDecimalYear:ue,startISODate:K,endDate:ee,endDecimalYear:ue,endISODate:K}}return fe}function Pe(ee){if(!ee||!/^-?\d{1,4}(?:-\d\d){0,2}$/.test(ee))return;let fe=ee.split("-");""===fe[0]&&(fe.shift(),fe[0]*=-1);let Ie,Ue,ot,ct,Ee=+fe[0];fe[1]?Ie=Ue=+fe[1]-1:(Ee++,Ie=Ue=0),fe[2]?ot=ct=+fe[2]:fe[1]&&(Ue++,ot=ct=1);let St=I(+fe[0],Ie,ot),xt=I(Ee,Ue,ct);return{startDate:!isNaN(St)&&St,startDecimalYear:!isNaN(St)&&p(St),startISODate:!isNaN(St)&&St.toISOString().split("T")[0],endDate:!isNaN(xt)&&xt,endDecimalYear:!isNaN(xt)&&p(xt),endISODate:!isNaN(xt)&&xt.toISOString().split("T")[0]}}function I(ee,fe,ue){let K=new Date(Date.UTC(ee,fe,ue));return K.setUTCFullYear(ee),K}function p(ee){let fe=ee.getUTCFullYear(),ue=I(fe+1,0,1).getTime(),K=I(fe,0,1).getTime();return fe<0&&fe--,fe+(ee.getTime()-K)/(ue-K)}function Z(ee,fe){return typeof ee<"u"&&me(ee)?he(ee,fe):be(ee,fe)}function he(ee,fe){return"all"===ee[0]&&ee[2]&&"any"===ee[1][0]&&"any"===ee[2][0]?(ee[1][1]&&"all"===ee[1][1][0]&&ee[1][1][2]&&"<"===ee[1][1][2][0]&&"start_decdate"===ee[1][1][2][1]&&(ee[1][1][2][2]=fe.endDecimalYear),ee[1][2]&&"all"===ee[1][2][0]&&ee[1][2][2]&&"<"===ee[1][2][2][0]&&"start_date"===ee[1][2][2][2]&&(ee[1][2][2][3]=fe.endISODate),ee[2][1]&&"all"===ee[2][1][0]&&ee[2][1][2]&&">="===ee[2][1][2][0]&&"end_decdate"===ee[2][1][2][1]&&(ee[2][1][2][2]=fe.startDecimalYear),ee[2][2]&&"all"===ee[2][2][0]&&ee[2][2][2]&&">="===ee[2][2][2][0]&&"end_date"===ee[2][2][2][2]&&(ee[2][2][2][3]=fe.startISODate),ee):["all",["any",["all",["has","start_decdate"],["<","start_decdate",fe.endDecimalYear]],["all",["!has","start_decdate"],["has","start_date"],["<","start_date",fe.endISODate]],["all",["!has","start_decdate"],["!has","start_date"]]],["any",["all",["has","end_decdate"],[">=","end_decdate",fe.startDecimalYear]],["all",["!has","end_decdate"],["has","end_date"],[">=","end_date",fe.startISODate]],["all",["!has","end_decdate"],["!has","end_date"]]],ee]}function be(ee,fe){const ue=`${Je}__startDecimalYear`,K=`${Je}__startISODate`,Ee=`${Je}__endDecimalYear`,Ie=`${Je}__endISODate`;if(Array.isArray(ee)&&"let"===ee[0])return ve(ee,ue,fe.startDecimalYear),ve(ee,K,fe.startISODate),ve(ee,Ee,fe.endDecimalYear),ve(ee,Ie,fe.endISODate),ee;let Ue=["all",["any",["all",["has","start_decdate"],["<",["get","start_decdate"],["var",Ee]]],["all",["!",["has","start_decdate"]],["has","start_date"],["<",["get","start_date"],["var",Ie]]],["all",["!",["has","start_decdate"]],["!",["has","start_date"]]]],["any",["all",["has","end_decdate"],[">=",["get","end_decdate"],["var",ue]]],["all",["!",["has","end_decdate"]],["has","end_date"],[">=",["get","end_date"],["var",K]]],["all",["!",["has","end_decdate"]],["!",["has","end_date"]]]]];return ee&&Ue.push(ee),["let",ue,fe.startDecimalYear,K,fe.startISODate,Ee,fe.endDecimalYear,Ie,fe.endISODate,Ue]}function me(ee){if(!Array.isArray(ee)||ee.length<2)return!1;let fe=ee.slice(1);switch(ee[0]){case"!has":case"!in":case"none":return!0;case"has":return"$id"===fe[0]||"$type"===fe[0];case"in":return fe.length>2||"$id"===fe[0]||"$type"===fe[0]||"number"==typeof fe[1]||"boolean"==typeof fe[1]||"string"==typeof fe[0]&&"string"==typeof fe[1];case"==":case"!=":case">":case">=":case"<":case"<=":return"string"==typeof fe[0]&&!Array.isArray(fe[1]);case"all":case"any":return fe.some(me);default:return!1}}function ve(ee,fe,ue){if("let"!==ee[0])return;let K=ee.indexOf(fe);-1!==K&&K%2==1?ee[K+1]=ue:ee.splice(-1,0,fe,ue)}typeof window<"u"&&("maplibregl"in window||"mapboxgl"in window)?("maplibregl"in window&&(maplibregl.Map.prototype.filterByDate=function(ee){et(this,ee)}),"mapboxgl"in window&&(mapboxgl.Map.prototype.filterByDate=function(ee){et(this,ee)})):uu.exports={filterByDate:et,dateRangeFromDate:st,decimalYearFromDate:p,dateRangeFromISODate:Pe,constrainFilterByDateRange:Z,constrainLegacyFilterByDateRange:he,constrainExpressionFilterByDateRange:be,isLegacyFilter:me,updateVariable:ve}},44:function(uu){uu.exports=function(){"use strict";var Je={},et={};function st(I,p,Z){if(et[I]=Z,"index"===I){var he="var sharedModule = {}; ("+et.shared+")(sharedModule); ("+et.worker+")(sharedModule);",be={};return et.shared(be),et.index(Je,be),typeof window<"u"&&Je.setWorkerUrl(window.URL.createObjectURL(new Blob([he],{type:"text/javascript"}))),Je}}return st("shared",0,function(I){function p(l,r,a,h){return new(a||(a=Promise))(function(m,y){function b(k){try{S(h.next(k))}catch(F){y(F)}}function D(k){try{S(h.throw(k))}catch(F){y(F)}}function S(k){var F;k.done?m(k.value):(F=k.value,F instanceof a?F:new a(function($){$(F)})).then(b,D)}S((h=h.apply(l,r||[])).next())})}function Z(l,r){this.x=l,this.y=r}function he(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var be,me;"function"==typeof SuppressedError&&SuppressedError,Z.prototype={clone(){return new Z(this.x,this.y)},add(l){return this.clone()._add(l)},sub(l){return this.clone()._sub(l)},multByPoint(l){return this.clone()._multByPoint(l)},divByPoint(l){return this.clone()._divByPoint(l)},mult(l){return this.clone()._mult(l)},div(l){return this.clone()._div(l)},rotate(l){return this.clone()._rotate(l)},rotateAround(l,r){return this.clone()._rotateAround(l,r)},matMult(l){return this.clone()._matMult(l)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(l){return this.x===l.x&&this.y===l.y},dist(l){return Math.sqrt(this.distSqr(l))},distSqr(l){const r=l.x-this.x,a=l.y-this.y;return r*r+a*a},angle(){return Math.atan2(this.y,this.x)},angleTo(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith(l){return this.angleWithSep(l.x,l.y)},angleWithSep(l,r){return Math.atan2(this.x*r-this.y*l,this.x*l+this.y*r)},_matMult(l){const r=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=r,this},_add(l){return this.x+=l.x,this.y+=l.y,this},_sub(l){return this.x-=l.x,this.y-=l.y,this},_mult(l){return this.x*=l,this.y*=l,this},_div(l){return this.x/=l,this.y/=l,this},_multByPoint(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint(l){return this.x/=l.x,this.y/=l.y,this},_unit(){return this._div(this.mag()),this},_perp(){const l=this.y;return this.y=this.x,this.x=-l,this},_rotate(l){const r=Math.cos(l),a=Math.sin(l),h=a*this.x+r*this.y;return this.x=r*this.x-a*this.y,this.y=h,this},_rotateAround(l,r){const a=Math.cos(l),h=Math.sin(l),m=r.y+h*(this.x-r.x)+a*(this.y-r.y);return this.x=r.x+a*(this.x-r.x)-h*(this.y-r.y),this.y=m,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Z},Z.convert=function(l){if(l instanceof Z)return l;if(Array.isArray(l))return new Z(+l[0],+l[1]);if(void 0!==l.x&&void 0!==l.y)return new Z(+l.x,+l.y);throw new Error("Expected [x, y] or {x, y} point format")};var ve=function(){if(me)return be;function l(r,a,h,m){this.cx=3*r,this.bx=3*(h-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(m-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=a,this.p2x=h,this.p2y=m}return me=1,be=l,l.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,a){if(void 0===a&&(a=1e-6),r<0)return 0;if(r>1)return 1;for(var h=r,m=0;m<8;m++){var y=this.sampleCurveX(h)-r;if(Math.abs(y)<a)return h;var b=this.sampleCurveDerivativeX(h);if(Math.abs(b)<1e-6)break;h-=y/b}var D=0,S=1;for(h=r,m=0;m<20&&(y=this.sampleCurveX(h),!(Math.abs(y-r)<a));m++)r>y?D=h:S=h,h=.5*(S-D)+D;return h},solve:function(r,a){return this.sampleCurveY(this.solveCurveX(r,a))}},be}(),ee=he(ve);let fe,ue;function K(){return null==fe&&(fe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),fe}function Ee(){if(null==ue&&(ue=!1,K())){const r=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(r){for(let h=0;h<25;h++){const m=4*h;r.fillStyle=`rgb(${m},${m+1},${m+2})`,r.fillRect(h%5,Math.floor(h/5),1,1)}const a=r.getImageData(0,0,5,5).data;for(let h=0;h<100;h++)if(h%4!=3&&a[h]!==h){ue=!0;break}}}return ue||!1}var Ie=1e-6,Ue=typeof Float32Array<"u"?Float32Array:Array;function ot(){var l=new Ue(9);return Ue!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function ct(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function St(){var l=new Ue(3);return Ue!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function xt(l){var r=l[0],a=l[1],h=l[2];return Math.sqrt(r*r+a*a+h*h)}function Qt(l,r,a){var h=new Ue(3);return h[0]=l,h[1]=r,h[2]=a,h}function Mt(l,r,a){return l[0]=r[0]+a[0],l[1]=r[1]+a[1],l[2]=r[2]+a[2],l}function on(l,r,a){return l[0]=r[0]*a,l[1]=r[1]*a,l[2]=r[2]*a,l}function Hn(l,r,a){var h=r[0],m=r[1],y=r[2],b=a[0],D=a[1],S=a[2];return l[0]=m*S-y*D,l[1]=y*b-h*S,l[2]=h*D-m*b,l}var Ze,Dt=xt;function pe(l,r,a){var h=r[0],m=r[1],y=r[2],b=r[3];return l[0]=a[0]*h+a[4]*m+a[8]*y+a[12]*b,l[1]=a[1]*h+a[5]*m+a[9]*y+a[13]*b,l[2]=a[2]*h+a[6]*m+a[10]*y+a[14]*b,l[3]=a[3]*h+a[7]*m+a[11]*y+a[15]*b,l}function Rt(){var l=new Ue(4);return Ue!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function ii(l,r,a,h){var m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"zyx",y=Math.PI/360;r*=y,h*=y,a*=y;var b=Math.sin(r),D=Math.cos(r),S=Math.sin(a),k=Math.cos(a),F=Math.sin(h),$=Math.cos(h);switch(m){case"xyz":l[0]=b*k*$+D*S*F,l[1]=D*S*$-b*k*F,l[2]=D*k*F+b*S*$,l[3]=D*k*$-b*S*F;break;case"xzy":l[0]=b*k*$-D*S*F,l[1]=D*S*$-b*k*F,l[2]=D*k*F+b*S*$,l[3]=D*k*$+b*S*F;break;case"yxz":l[0]=b*k*$+D*S*F,l[1]=D*S*$-b*k*F,l[2]=D*k*F-b*S*$,l[3]=D*k*$+b*S*F;break;case"yzx":l[0]=b*k*$+D*S*F,l[1]=D*S*$+b*k*F,l[2]=D*k*F-b*S*$,l[3]=D*k*$-b*S*F;break;case"zxy":l[0]=b*k*$-D*S*F,l[1]=D*S*$+b*k*F,l[2]=D*k*F+b*S*$,l[3]=D*k*$-b*S*F;break;case"zyx":l[0]=b*k*$-D*S*F,l[1]=D*S*$+b*k*F,l[2]=D*k*F-b*S*$,l[3]=D*k*$+b*S*F;break;default:throw new Error("Unknown angle order "+m)}return l}function Bt(){var l=new Ue(2);return Ue!=Float32Array&&(l[0]=0,l[1]=0),l}function Qn(l,r){var a=new Ue(2);return a[0]=l,a[1]=r,a}St(),Ze=new Ue(4),Ue!=Float32Array&&(Ze[0]=0,Ze[1]=0,Ze[2]=0,Ze[3]=0),St(),Qt(1,0,0),Qt(0,1,0),Rt(),Rt(),ot(),Bt();const pt=8192;function Nn(l,r,a){return r*(pt/(l.tileSize*Math.pow(2,a-l.tileID.overscaledZ)))}function nt(l,r){return(l%r+r)%r}function ht(l,r,a){return l*(1-a)+r*a}function Sn(l){if(l<=0)return 0;if(l>=1)return 1;const r=l*l,a=r*l;return 4*(l<.5?a:3*(l-r)+a-.75)}function ln(l,r,a,h){const m=new ee(l,r,a,h);return y=>m.solve(y)}const Wt=ln(.25,.1,.25,1);function Pn(l,r,a){return Math.min(a,Math.max(r,l))}function zn(l,r,a){const h=a-r,m=((l-r)%h+h)%h+r;return m===r?a:m}function Zn(l,...r){for(const a of r)for(const h in a)l[h]=a[h];return l}let mi=1;function ir(l,r,a){const h={};for(const m in l)h[m]=r.call(this,l[m],m,l);return h}function tr(l,r,a){const h={};for(const m in l)r.call(this,l[m],m,l)&&(h[m]=l[m]);return h}function pr(l){return Array.isArray(l)?l.map(pr):"object"==typeof l&&l?ir(l,pr):l}const Jr={};function ne(l){Jr[l]||(typeof console<"u"&&console.warn(l),Jr[l]=!0)}function kt(l,r,a){return(a.y-l.y)*(r.x-l.x)>(r.y-l.y)*(a.x-l.x)}function Ct(l){return typeof WorkerGlobalScope<"u"&&void 0!==l&&l instanceof WorkerGlobalScope}let Oe=null;function ke(l){return typeof ImageBitmap<"u"&&l instanceof ImageBitmap}const it="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function jt(l,r,a,h,m){return p(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const y=new VideoFrame(l,{timestamp:0});try{const b=y?.format;if(!b||!b.startsWith("BGR")&&!b.startsWith("RGB"))throw new Error(`Unrecognized format ${b}`);const D=b.startsWith("BGR"),S=new Uint8ClampedArray(h*m*4);if(yield y.copyTo(S,function(k,F,$,G,W){const X=4*Math.max(-F,0),Q=(Math.max(0,$)-$)*G*4+X,re=4*G,ye=Math.max(0,F),Ae=Math.max(0,$);return{rect:{x:ye,y:Ae,width:Math.min(k.width,F+G)-ye,height:Math.min(k.height,$+W)-Ae},layout:[{offset:Q,stride:re}]}}(l,r,a,h,m)),D)for(let k=0;k<S.length;k+=4){const F=S[k];S[k]=S[k+2],S[k+2]=F}return S}finally{y.close()}})}let Ut,dt;function tn(l,r,a,h){return l.addEventListener(r,a,h),{unsubscribe:()=>{l.removeEventListener(r,a,h)}}}function Cn(l){return l*Math.PI/180}function nn(l){return l/Math.PI*180}const mn={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},ji={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},bi="AbortError";function Hr(){return new Error(bi)}const ur={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Mo(l){return ur.REGISTERED_PROTOCOLS[l.substring(0,l.indexOf("://"))]}const is="global-dispatcher";class qi extends Error{constructor(r,a,h,m){super(`AJAXError: ${a} (${r}): ${h}`),this.status=r,this.statusText=a,this.url=h,this.body=m}}const Sr=()=>Ct(self)?self.worker&&self.worker.referrer:("blob:"===window.location.protocol?window.parent:window).location.href,He=function(l,r){if(/:\/\//.test(l.url)&&!/^https?:|^file:/.test(l.url)){const h=Mo(l.url);if(h)return h(l,r);if(Ct(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,targetMapId:is},r)}if(!(/^file:/.test(a=l.url)||/^file:/.test(Sr())&&!/^\w+:/.test(a))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(h,m){return p(this,void 0,void 0,function*(){const y=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,cache:h.cache,referrer:Sr(),signal:m.signal});let b,D;"json"!==h.type||y.headers.has("Accept")||y.headers.set("Accept","application/json");try{b=yield fetch(y)}catch(k){throw new qi(0,k.message,h.url,new Blob)}if(!b.ok){const k=yield b.blob();throw new qi(b.status,b.statusText,h.url,k)}D="arrayBuffer"===h.type||"image"===h.type?b.arrayBuffer():"json"===h.type?b.json():b.text();const S=yield D;if(m.signal.aborted)throw Hr();return{data:S,cacheControl:b.headers.get("Cache-Control"),expires:b.headers.get("Expires")}})}(l,r);if(Ct(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,mustQueue:!0,targetMapId:is},r)}var a,h,m;return h=l,m=r,new Promise((y,b)=>{var D;const S=new XMLHttpRequest;S.open(h.method||"GET",h.url,!0),"arrayBuffer"!==h.type&&"image"!==h.type||(S.responseType="arraybuffer");for(const k in h.headers)S.setRequestHeader(k,h.headers[k]);"json"===h.type&&(S.responseType="text",!(null===(D=h.headers)||void 0===D)&&D.Accept||S.setRequestHeader("Accept","application/json")),S.withCredentials="include"===h.credentials,S.onerror=()=>{b(new Error(S.statusText))},S.onload=()=>{if(!m.signal.aborted)if((S.status>=200&&S.status<300||0===S.status)&&null!==S.response){let k=S.response;if("json"===h.type)try{k=JSON.parse(S.response)}catch(F){return void b(F)}y({data:k,cacheControl:S.getResponseHeader("Cache-Control"),expires:S.getResponseHeader("Expires")})}else{const k=new Blob([S.response],{type:S.getResponseHeader("Content-Type")});b(new qi(S.status,S.statusText,h.url,k))}},m.signal.addEventListener("abort",()=>{S.abort(),b(Hr())}),S.send(h.body)})};function ie(l){if(!l||l.indexOf("://")<=0||0===l.indexOf("data:image/")||0===l.indexOf("blob:"))return!0;const r=new URL(l),a=window.location;return r.protocol===a.protocol&&r.host===a.host}function oe(l,r,a){a[l]&&-1!==a[l].indexOf(r)||(a[l]=a[l]||[],a[l].push(r))}function ge(l,r,a){if(a&&a[l]){const h=a[l].indexOf(r);-1!==h&&a[l].splice(h,1)}}class Fe{constructor(r,a={}){Zn(this,a),this.type=r}}class Ve extends Fe{constructor(r,a={}){super("error",Zn({error:r},a))}}class rt{on(r,a){return this._listeners=this._listeners||{},oe(r,a,this._listeners),{unsubscribe:()=>{this.off(r,a)}}}off(r,a){return ge(r,a,this._listeners),ge(r,a,this._oneTimeListeners),this}once(r,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},oe(r,a,this._oneTimeListeners),this):new Promise(h=>this.once(r,h))}fire(r,a){"string"==typeof r&&(r=new Fe(r,a||{}));const h=r.type;if(this.listens(h)){r.target=this;const m=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const D of m)D.call(this,r);const y=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const D of y)ge(h,D,this._oneTimeListeners),D.call(this,r);const b=this._eventedParent;b&&(Zn(r,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),b.fire(r))}else r instanceof Ve&&console.error(r.error);return this}listens(r){return this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r)}setEventedParent(r,a){return this._eventedParent=r,this._eventedParentData=a,this}}var xe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ke=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function yt(l,r){const a={};for(const h in l)"ref"!==h&&(a[h]=l[h]);return Ke.forEach(h=>{h in r&&(a[h]=r[h])}),a}function bt(l,r){if(Array.isArray(l)){if(!Array.isArray(r)||l.length!==r.length)return!1;for(let a=0;a<l.length;a++)if(!bt(l[a],r[a]))return!1;return!0}if("object"==typeof l&&null!==l&&null!==r){if("object"!=typeof r||Object.keys(l).length!==Object.keys(r).length)return!1;for(const a in l)if(!bt(l[a],r[a]))return!1;return!0}return l===r}function Tt(l,r){l.push(r)}function vn(l,r,a){Tt(a,{command:"addSource",args:[l,r[l]]})}function Bn(l,r,a){Tt(r,{command:"removeSource",args:[l]}),a[l]=!0}function ri(l,r,a,h){Bn(l,a,h),vn(l,r,a)}function hr(l,r,a){let h;for(h in l[a])if(Object.prototype.hasOwnProperty.call(l[a],h)&&"data"!==h&&!bt(l[a][h],r[a][h]))return!1;for(h in r[a])if(Object.prototype.hasOwnProperty.call(r[a],h)&&"data"!==h&&!bt(l[a][h],r[a][h]))return!1;return!0}function Ei(l,r,a,h,m,y){l=l||{},r=r||{};for(const b in l)Object.prototype.hasOwnProperty.call(l,b)&&(bt(l[b],r[b])||a.push({command:y,args:[h,b,r[b],m]}));for(const b in r)Object.prototype.hasOwnProperty.call(r,b)&&!Object.prototype.hasOwnProperty.call(l,b)&&(bt(l[b],r[b])||a.push({command:y,args:[h,b,r[b],m]}))}function $i(l){return l.id}function mr(l,r){return l[r.id]=r,l}class Gt{constructor(r,a,h,m){this.message=(r?`${r}: `:"")+h,m&&(this.identifier=m),null!=a&&a.__line__&&(this.line=a.__line__)}}function Ci(l,...r){for(const a of r)for(const h in a)l[h]=a[h];return l}class gn extends Error{constructor(r,a){super(a),this.message=a,this.key=r}}class Zr{constructor(r,a=[]){this.parent=r,this.bindings={};for(const[h,m]of a)this.bindings[h]=m}concat(r){return new Zr(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const di={kind:"null"},qt={kind:"number"},Mn={kind:"string"},Un={kind:"boolean"},rs={kind:"color"},Ir={kind:"projectionDefinition"},mo={kind:"object"},kn={kind:"value"},ka={kind:"collator"},qr={kind:"formatted"},Lr={kind:"padding"},ca={kind:"colorArray"},Si={kind:"numberArray"},El={kind:"resolvedImage"},oc={kind:"variableAnchorOffsetCollection"};function Et(l,r){return{kind:"array",itemType:l,N:r}}function gr(l){if("array"===l.kind){const r=gr(l.itemType);return"number"==typeof l.N?`array<${r}, ${l.N}>`:"value"===l.itemType.kind?"array":`array<${r}>`}return l.kind}const Ja=[di,qt,Mn,Un,rs,Ir,qr,mo,Et(kn),Lr,Si,ca,El,oc];function Gs(l,r){if("error"===r.kind)return null;if("array"===l.kind){if("array"===r.kind&&(0===r.N&&"value"===r.itemType.kind||!Gs(l.itemType,r.itemType))&&("number"!=typeof l.N||l.N===r.N))return null}else{if(l.kind===r.kind)return null;if("value"===l.kind)for(const a of Ja)if(!Gs(a,r))return null}return`Expected ${gr(l)} but found ${gr(r)} instead.`}function Sl(l,r){return r.some(a=>a.kind===l.kind)}function _r(l,r){return r.some(a=>"null"===a?null===l:"array"===a?Array.isArray(l):"object"===a?l&&!Array.isArray(l)&&"object"==typeof l:a===typeof l)}function Ra(l,r){return"array"===l.kind&&"array"===r.kind?l.itemType.kind===r.itemType.kind&&"number"==typeof l.N:l.kind===r.kind}const Ai=4/29,Qi=6/29,Rc=3*Qi*Qi,el=Qi*Qi*Qi,xa=Math.PI/180,ld=180/Math.PI;function On(l){return(l%=360)<0&&(l+=360),l}function eo([l,r,a,h]){let m,y;const b=Wi((.2225045*(l=dh(l))+.7168786*(r=dh(r))+.0606169*(a=dh(a)))/1);l===r&&r===a?m=y=b:(m=Wi((.4360747*l+.3850649*r+.1430804*a)/.96422),y=Wi((.0139322*l+.0971045*r+.7141733*a)/.82521));const D=116*b-16;return[D<0?0:D,500*(m-b),200*(b-y),h]}function dh(l){return l<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function Wi(l){return l>el?Math.pow(l,1/3):l/Rc+Ai}function Hs([l,r,a,h]){let m=(l+16)/116,y=isNaN(r)?m:m+r/500,b=isNaN(a)?m:m-a/200;return m=1*Il(m),y=.96422*Il(y),b=.82521*Il(b),[to(3.1338561*y-1.6168667*m-.4906146*b),to(-.9787684*y+1.9161415*m+.033454*b),to(.0719453*y-.2289914*m+1.4052427*b),h]}function to(l){return(l=l<=.00304?12.92*l:1.055*Math.pow(l,1/2.4)-.055)<0?0:l>1?1:l}function Il(l){return l>Qi?l*l*l:Rc*(l-Ai)}const sc=Object.hasOwn||function(l,r){return Object.prototype.hasOwnProperty.call(l,r)};function dr(l,r){return sc(l,r)?l[r]:void 0}function Gi(l){return parseInt(l.padEnd(2,l),16)/255}function ti(l,r){return Uo(r?l/100:l,0,1)}function Uo(l,r,a){return Math.min(Math.max(r,l),a)}function Wo(l){return!l.some(Number.isNaN)}const fh={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function La(l,r,a){return l+a*(r-l)}function Pl(l,r,a){return l.map((h,m)=>La(h,r[m],a))}class oi{constructor(r,a,h,m=1,y=!0){this.r=r,this.g=a,this.b=h,this.a=m,y||(this.r*=m,this.g*=m,this.b*=m,m||this.overwriteGetter("rgb",[r,a,h,m]))}static parse(r){if(r instanceof oi)return r;if("string"!=typeof r)return;const a=function(h){if("transparent"===(h=h.toLowerCase().trim()))return[0,0,0,0];const m=dr(fh,h);if(m){const[b,D,S]=m;return[b/255,D/255,S/255,1]}if(h.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(h)){const b=h.length<6?1:2;let D=1;return[Gi(h.slice(D,D+=b)),Gi(h.slice(D,D+=b)),Gi(h.slice(D,D+=b)),Gi(h.slice(D,D+b)||"ff")]}if(h.startsWith("rgb")){const b=h.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[D,S,k,F,$,G,W,X,Q,re,ye,Ae]=b,Ce=[F||" ",W||" ",re].join("");if("  "===Ce||"  /"===Ce||",,"===Ce||",,,"===Ce){const Me=[k,G,Q].join(""),Ge="%%%"===Me?100:""===Me?255:0;if(Ge){const Xe=[Uo(+S/Ge,0,1),Uo(+$/Ge,0,1),Uo(+X/Ge,0,1),ye?ti(+ye,Ae):1];if(Wo(Xe))return Xe}}return}}const y=h.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[b,D,S,k,F,$,G,W,X]=y,Q=[S||" ",F||" ",G].join("");if("  "===Q||"  /"===Q||",,"===Q||",,,"===Q){const re=[+D,Uo(+k,0,100),Uo(+$,0,100),W?ti(+W,X):1];if(Wo(re))return function([ye,Ae,Ce,Me]){function Ge(Xe){const mt=(Xe+ye/30)%12,Lt=Ae*Math.min(Ce,1-Ce);return Ce-Lt*Math.max(-1,Math.min(mt-3,9-mt,1))}return ye=On(ye),Ae/=100,Ce/=100,[Ge(0),Ge(8),Ge(4),Me]}(re)}}}(r);return a?new oi(...a,!1):void 0}get rgb(){const{r,g:a,b:h,a:m}=this,y=m||1/0;return this.overwriteGetter("rgb",[r/y,a/y,h/y,m])}get hcl(){return this.overwriteGetter("hcl",function(r){const[a,h,m,y]=eo(r),b=Math.sqrt(h*h+m*m);return[Math.round(1e4*b)?On(Math.atan2(m,h)*ld):NaN,b,a,y]}(this.rgb))}get lab(){return this.overwriteGetter("lab",eo(this.rgb))}overwriteGetter(r,a){return Object.defineProperty(this,r,{value:a}),a}toString(){const[r,a,h,m]=this.rgb;return`rgba(${[r,a,h].map(y=>Math.round(255*y)).join(",")},${m})`}static interpolate(r,a,h,m="rgb"){switch(m){case"rgb":{const[y,b,D,S]=Pl(r.rgb,a.rgb,h);return new oi(y,b,D,S,!1)}case"hcl":{const[y,b,D,S]=r.hcl,[k,F,$,G]=a.hcl;let W,X;if(isNaN(y)||isNaN(k))isNaN(y)?isNaN(k)?W=NaN:(W=k,1!==D&&0!==D||(X=F)):(W=y,1!==$&&0!==$||(X=b));else{let Ce=k-y;k>y&&Ce>180?Ce-=360:k<y&&y-k>180&&(Ce+=360),W=y+h*Ce}const[Q,re,ye,Ae]=function([Ce,Me,Ge,Xe]){return Ce=isNaN(Ce)?0:Ce*xa,Hs([Ge,Math.cos(Ce)*Me,Math.sin(Ce)*Me,Xe])}([W,X??La(b,F,h),La(D,$,h),La(S,G,h)]);return new oi(Q,re,ye,Ae,!1)}case"lab":{const[y,b,D,S]=Hs(Pl(r.lab,a.lab,h));return new oi(y,b,D,S,!1)}}}}oi.black=new oi(0,0,0,1),oi.white=new oi(1,1,1,1),oi.transparent=new oi(0,0,0,0),oi.red=new oi(1,0,0,1);class Zs{constructor(r,a,h){this.sensitivity=r?a?"variant":"case":a?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,a){return this.collator.compare(r,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Fi=["bottom","center","top"];class Oa{constructor(r,a,h,m,y,b){this.text=r,this.image=a,this.scale=h,this.fontStack=m,this.textColor=y,this.verticalAlign=b}}class go{constructor(r){this.sections=r}static fromString(r){return new go([new Oa(r,null,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(r=>0!==r.text.length||r.image&&0!==r.image.name.length)}static factory(r){return r instanceof go?r:go.fromString(r)}toString(){return 0===this.sections.length?"":this.sections.map(r=>r.text).join("")}}class So{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof So)return r;if("number"==typeof r)return new So([r,r,r,r]);if(Array.isArray(r)&&!(r.length<1||r.length>4)){for(const a of r)if("number"!=typeof a)return;switch(r.length){case 1:r=[r[0],r[0],r[0],r[0]];break;case 2:r=[r[0],r[1],r[0],r[1]];break;case 3:r=[r[0],r[1],r[2],r[1]]}return new So(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,a,h){return new So(Pl(r.values,a.values,h))}}class ss{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof ss)return r;if("number"==typeof r)return new ss([r]);if(Array.isArray(r)){for(const a of r)if("number"!=typeof a)return;return new ss(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,a,h){return new ss(Pl(r.values,a.values,h))}}class $n{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof $n)return r;if("string"==typeof r){const h=oi.parse(r);return h?new $n([h]):void 0}if(!Array.isArray(r))return;const a=[];for(const h of r){if("string"!=typeof h)return;const m=oi.parse(h);if(!m)return;a.push(m)}return new $n(a)}toString(){return JSON.stringify(this.values)}static interpolate(r,a,h,m="rgb"){const y=[];if(r.values.length!=a.values.length)throw new Error(`colorArray: Arrays have mismatched length (${r.values.length} vs. ${a.values.length}), cannot interpolate.`);for(let b=0;b<r.values.length;b++)y.push(oi.interpolate(r.values[b],a.values[b],h,m));return new $n(y)}}class si extends Error{constructor(r){super(r),this.name="RuntimeError"}toJSON(){return this.message}}const yn=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class as{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof as)return r;if(Array.isArray(r)&&!(r.length<1)&&r.length%2==0){for(let a=0;a<r.length;a+=2){const h=r[a],m=r[a+1];if("string"!=typeof h||!yn.has(h)||!Array.isArray(m)||2!==m.length||"number"!=typeof m[0]||"number"!=typeof m[1])return}return new as(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,a,h){const m=r.values,y=a.values;if(m.length!==y.length)throw new si(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${a.toString()}`);const b=[];for(let D=0;D<m.length;D+=2){if(m[D]!==y[D])throw new si(`Cannot interpolate values containing mismatched anchors. from[${D}]: ${m[D]}, to[${D}]: ${y[D]}`);b.push(m[D]);const[S,k]=m[D+1],[F,$]=y[D+1];b.push([La(S,F,h),La(k,$,h)])}return new as(b)}}class ls{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new ls({name:r,available:!1}):null}}class $o{constructor(r,a,h){this.from=r,this.to=a,this.transition=h}static interpolate(r,a,h){return new $o(r,a,h)}static parse(r){return r instanceof $o?r:Array.isArray(r)&&3===r.length&&"string"==typeof r[0]&&"string"==typeof r[1]&&"number"==typeof r[2]?new $o(r[0],r[1],r[2]):"object"==typeof r&&"string"==typeof r.from&&"string"==typeof r.to&&"number"==typeof r.transition?new $o(r.from,r.to,r.transition):"string"==typeof r?new $o(r,r,1):void 0}}function cd(l,r,a,h){return"number"==typeof l&&l>=0&&l<=255&&"number"==typeof r&&r>=0&&r<=255&&"number"==typeof a&&a>=0&&a<=255?void 0===h||"number"==typeof h&&h>=0&&h<=1?null:`Invalid rgba value [${[l,r,a,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof h?[l,r,a,h]:[l,r,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function qs(l){if(null===l||"string"==typeof l||"boolean"==typeof l||"number"==typeof l||l instanceof $o||l instanceof oi||l instanceof Zs||l instanceof go||l instanceof So||l instanceof ss||l instanceof $n||l instanceof as||l instanceof ls)return!0;if(Array.isArray(l)){for(const r of l)if(!qs(r))return!1;return!0}if("object"==typeof l){for(const r in l)if(!qs(l[r]))return!1;return!0}return!1}function an(l){if(null===l)return di;if("string"==typeof l)return Mn;if("boolean"==typeof l)return Un;if("number"==typeof l)return qt;if(l instanceof oi)return rs;if(l instanceof $o)return Ir;if(l instanceof Zs)return ka;if(l instanceof go)return qr;if(l instanceof So)return Lr;if(l instanceof ss)return Si;if(l instanceof $n)return ca;if(l instanceof as)return oc;if(l instanceof ls)return El;if(Array.isArray(l)){const r=l.length;let a;for(const h of l){const m=an(h);if(a){if(a===m)continue;a=kn;break}a=m}return Et(a||kn,r)}return mo}function tl(l){const r=typeof l;return null===l?"":"string"===r||"number"===r||"boolean"===r?String(l):l instanceof oi||l instanceof $o||l instanceof go||l instanceof So||l instanceof ss||l instanceof $n||l instanceof as||l instanceof ls?l.toString():JSON.stringify(l)}class rr{constructor(r,a){this.type=r,this.value=a}static parse(r,a){if(2!==r.length)return a.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!qs(r[1]))return a.error("invalid value");const h=r[1];let m=an(h);const y=a.expectedType;return"array"!==m.kind||0!==m.N||!y||"array"!==y.kind||"number"==typeof y.N&&0!==y.N||(m=y),new rr(m,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Ts={string:Mn,number:qt,boolean:Un,object:mo};class cs{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");let h,m=1;const y=r[0];if("array"===y){let D,S;if(r.length>2){const k=r[1];if("string"!=typeof k||!(k in Ts)||"object"===k)return a.error('The item type argument of "array" must be one of string, number, boolean',1);D=Ts[k],m++}else D=kn;if(r.length>3){if(null!==r[2]&&("number"!=typeof r[2]||r[2]<0||r[2]!==Math.floor(r[2])))return a.error('The length argument to "array" must be a positive integer literal',2);S=r[2],m++}h=Et(D,S)}else{if(!Ts[y])throw new Error(`Types doesn't contain name = ${y}`);h=Ts[y]}const b=[];for(;m<r.length;m++){const D=a.parse(r[m],m,kn);if(!D)return null;b.push(D)}return new cs(h,b)}evaluate(r){for(let a=0;a<this.args.length;a++){const h=this.args[a].evaluate(r);if(!Gs(this.type,an(h)))return h;if(a===this.args.length-1)throw new si(`Expected value to be of type ${gr(this.type)}, but found ${gr(an(h))} instead.`)}throw new Error}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const fr={"to-boolean":Un,"to-color":rs,"to-number":qt,"to-string":Mn};class Fa{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const h=r[0];if(!fr[h])throw new Error(`Can't parse ${h} as it is not part of the known types`);if(("to-boolean"===h||"to-string"===h)&&2!==r.length)return a.error("Expected one argument.");const m=fr[h],y=[];for(let b=1;b<r.length;b++){const D=a.parse(r[b],b,kn);if(!D)return null;y.push(D)}return new Fa(m,y)}evaluate(r){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(r);case"color":{let a,h;for(const m of this.args){if(a=m.evaluate(r),h=null,a instanceof oi)return a;if("string"==typeof a){const y=r.parseColor(a);if(y)return y}else if(Array.isArray(a)&&(h=a.length<3||a.length>4?`Invalid rgba value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:cd(a[0],a[1],a[2],a[3]),!h))return new oi(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new si(h||`Could not parse color from value '${"string"==typeof a?a:JSON.stringify(a)}'`)}case"padding":{let a;for(const h of this.args){a=h.evaluate(r);const m=So.parse(a);if(m)return m}throw new si(`Could not parse padding from value '${"string"==typeof a?a:JSON.stringify(a)}'`)}case"numberArray":{let a;for(const h of this.args){a=h.evaluate(r);const m=ss.parse(a);if(m)return m}throw new si(`Could not parse numberArray from value '${"string"==typeof a?a:JSON.stringify(a)}'`)}case"colorArray":{let a;for(const h of this.args){a=h.evaluate(r);const m=$n.parse(a);if(m)return m}throw new si(`Could not parse colorArray from value '${"string"==typeof a?a:JSON.stringify(a)}'`)}case"variableAnchorOffsetCollection":{let a;for(const h of this.args){a=h.evaluate(r);const m=as.parse(a);if(m)return m}throw new si(`Could not parse variableAnchorOffsetCollection from value '${"string"==typeof a?a:JSON.stringify(a)}'`)}case"number":{let a=null;for(const h of this.args){if(a=h.evaluate(r),null===a)return 0;const m=Number(a);if(!isNaN(m))return m}throw new si(`Could not convert ${JSON.stringify(a)} to number.`)}case"formatted":return go.fromString(tl(this.args[0].evaluate(r)));case"resolvedImage":return ls.fromString(tl(this.args[0].evaluate(r)));case"projectionDefinition":return this.args[0].evaluate(r);default:return tl(this.args[0].evaluate(r))}}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const ki=["Unknown","Point","LineString","Polygon"];class ai{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?ki[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let a=this._parseColorCache.get(r);return a||(a=oi.parse(r),this._parseColorCache.set(r,a)),a}}class Al{constructor(r,a,h=[],m,y=new Zr,b=[]){this.registry=r,this.path=h,this.key=h.map(D=>`[${D}]`).join(""),this.scope=y,this.errors=b,this.expectedType=m,this._isConstant=a}parse(r,a,h,m,y={}){return a?this.concat(a,h,m)._parse(r,y):this._parse(r,y)}_parse(r,a){function h(m,y,b){return"assert"===b?new cs(y,[m]):"coerce"===b?new Fa(y,[m]):m}if(null!==r&&"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r||(r=["literal",r]),Array.isArray(r)){if(0===r.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=r[0];if("string"!=typeof m)return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[m];if(y){let b=y.parse(r,this);if(!b)return null;if(this.expectedType){const D=this.expectedType,S=b.type;if("string"!==D.kind&&"number"!==D.kind&&"boolean"!==D.kind&&"object"!==D.kind&&"array"!==D.kind||"value"!==S.kind){if("projectionDefinition"===D.kind&&["string","array"].includes(S.kind)||["color","formatted","resolvedImage"].includes(D.kind)&&["value","string"].includes(S.kind)||["padding","numberArray"].includes(D.kind)&&["value","number","array"].includes(S.kind)||"colorArray"===D.kind&&["value","string","array"].includes(S.kind)||"variableAnchorOffsetCollection"===D.kind&&["value","array"].includes(S.kind))b=h(b,D,a.typeAnnotation||"coerce");else if(this.checkSubtype(D,S))return null}else b=h(b,D,a.typeAnnotation||"assert")}if(!(b instanceof rr)&&"resolvedImage"!==b.type.kind&&this._isConstant(b)){const D=new ai;try{b=new rr(b.type,b.evaluate(D))}catch(S){return this.error(S.message),null}}return b}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===r?"'undefined' value invalid. Use null instead.":"object"==typeof r?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,a,h){const m="number"==typeof r?this.path.concat(r):this.path,y=h?this.scope.concat(h):this.scope;return new Al(this.registry,this._isConstant,m,a||null,y,this.errors)}error(r,...a){const h=`${this.key}${a.map(m=>`[${m}]`).join("")}`;this.errors.push(new gn(h,r))}checkSubtype(r,a){const h=Gs(r,a);return h&&this.error(h),h}}class Ri{constructor(r,a){this.type=a.type,this.bindings=[].concat(r),this.result=a}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const a of this.bindings)r(a[1]);r(this.result)}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const h=[];for(let y=1;y<r.length-1;y+=2){const b=r[y];if("string"!=typeof b)return a.error(`Expected string, but found ${typeof b} instead.`,y);if(/[^a-zA-Z0-9_]/.test(b))return a.error("Variable names must contain only alphanumeric characters or '_'.",y);const D=a.parse(r[y+1],y+1);if(!D)return null;h.push([b,D])}const m=a.parse(r[r.length-1],r.length-1,a.expectedType,h);return m?new Ri(h,m):null}outputDefined(){return this.result.outputDefined()}}class Li{constructor(r,a){this.type=a.type,this.name=r,this.boundExpression=a}static parse(r,a){if(2!==r.length||"string"!=typeof r[1])return a.error("'var' expression requires exactly one string literal argument.");const h=r[1];return a.scope.has(h)?new Li(h,a.scope.get(h)):a.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}}class sn{constructor(r,a,h){this.type=r,this.index=a,this.input=h}static parse(r,a){if(3!==r.length)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=a.parse(r[1],1,qt),m=a.parse(r[2],2,Et(a.expectedType||kn));return h&&m?new sn(m.type.itemType,h,m):null}evaluate(r){const a=this.index.evaluate(r),h=this.input.evaluate(r);if(a<0)throw new si(`Array index out of bounds: ${a} < 0.`);if(a>=h.length)throw new si(`Array index out of bounds: ${a} > ${h.length-1}.`);if(a!==Math.floor(a))throw new si(`Array index must be an integer, but found ${a} instead.`);return h[a]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}}class Go{constructor(r,a){this.type=Un,this.needle=r,this.haystack=a}static parse(r,a){if(3!==r.length)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=a.parse(r[1],1,kn),m=a.parse(r[2],2,kn);return h&&m?Sl(h.type,[Un,Mn,qt,di,kn])?new Go(h,m):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${gr(h.type)} instead`):null}evaluate(r){const a=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(!h)return!1;if(!_r(a,["boolean","string","number","null"]))throw new si(`Expected first argument to be of type boolean, string, number or null, but found ${gr(an(a))} instead.`);if(!_r(h,["string","array"]))throw new si(`Expected second argument to be of type array or string, but found ${gr(an(h))} instead.`);return h.indexOf(a)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}}class Ds{constructor(r,a,h){this.type=qt,this.needle=r,this.haystack=a,this.fromIndex=h}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 2 or 3 arguments, but found ${r.length-1} instead.`);const h=a.parse(r[1],1,kn),m=a.parse(r[2],2,kn);if(!h||!m)return null;if(!Sl(h.type,[Un,Mn,qt,di,kn]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${gr(h.type)} instead`);if(4===r.length){const y=a.parse(r[3],3,qt);return y?new Ds(h,m,y):null}return new Ds(h,m)}evaluate(r){const a=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(!_r(a,["boolean","string","number","null"]))throw new si(`Expected first argument to be of type boolean, string, number or null, but found ${gr(an(a))} instead.`);let m;if(this.fromIndex&&(m=this.fromIndex.evaluate(r)),_r(h,["string"])){const y=h.indexOf(a,m);return-1===y?-1:[...h.slice(0,y)].length}if(_r(h,["array"]))return h.indexOf(a,m);throw new si(`Expected second argument to be of type array or string, but found ${gr(an(h))} instead.`)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}}class Lc{constructor(r,a,h,m,y,b){this.inputType=r,this.type=a,this.input=h,this.cases=m,this.outputs=y,this.otherwise=b}static parse(r,a){if(r.length<5)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return a.error("Expected an even number of arguments.");let h,m;a.expectedType&&"value"!==a.expectedType.kind&&(m=a.expectedType);const y={},b=[];for(let k=2;k<r.length-1;k+=2){let F=r[k];const $=r[k+1];Array.isArray(F)||(F=[F]);const G=a.concat(k);if(0===F.length)return G.error("Expected at least one branch label.");for(const X of F){if("number"!=typeof X&&"string"!=typeof X)return G.error("Branch labels must be numbers or strings.");if("number"==typeof X&&Math.abs(X)>Number.MAX_SAFE_INTEGER)return G.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof X&&Math.floor(X)!==X)return G.error("Numeric branch labels must be integer values.");if(h){if(G.checkSubtype(h,an(X)))return null}else h=an(X);if(void 0!==y[String(X)])return G.error("Branch labels must be unique.");y[String(X)]=b.length}const W=a.parse($,k,m);if(!W)return null;m=m||W.type,b.push(W)}const D=a.parse(r[1],1,kn);if(!D)return null;const S=a.parse(r[r.length-1],r.length-1,m);return S?"value"!==D.type.kind&&a.concat(1).checkSubtype(h,D.type)?null:new Lc(h,m,D,y,b,S):null}evaluate(r){const a=this.input.evaluate(r);return(an(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}}class ac{constructor(r,a,h){this.type=r,this.branches=a,this.otherwise=h}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return a.error("Expected an odd number of arguments.");let h;a.expectedType&&"value"!==a.expectedType.kind&&(h=a.expectedType);const m=[];for(let b=1;b<r.length-1;b+=2){const D=a.parse(r[b],b,Un);if(!D)return null;const S=a.parse(r[b+1],b+1,h);if(!S)return null;m.push([D,S]),h=h||S.type}const y=a.parse(r[r.length-1],r.length-1,h);if(!y)return null;if(!h)throw new Error("Can't infer output type");return new ac(h,m,y)}evaluate(r){for(const[a,h]of this.branches)if(a.evaluate(r))return h.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[a,h]of this.branches)r(a),r(h);r(this.otherwise)}outputDefined(){return this.branches.every(([r,a])=>a.outputDefined())&&this.otherwise.outputDefined()}}class lc{constructor(r,a,h,m){this.type=r,this.input=a,this.beginIndex=h,this.endIndex=m}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 2 or 3 arguments, but found ${r.length-1} instead.`);const h=a.parse(r[1],1,kn),m=a.parse(r[2],2,qt);if(!h||!m)return null;if(!Sl(h.type,[Et(kn),Mn,kn]))return a.error(`Expected first argument to be of type array or string, but found ${gr(h.type)} instead`);if(4===r.length){const y=a.parse(r[3],3,qt);return y?new lc(h.type,h,m,y):null}return new lc(h.type,h,m)}evaluate(r){const a=this.input.evaluate(r),h=this.beginIndex.evaluate(r);let m;if(this.endIndex&&(m=this.endIndex.evaluate(r)),_r(a,["string"]))return[...a].slice(h,m).join("");if(_r(a,["array"]))return a.slice(h,m);throw new si(`Expected first argument to be of type array or string, but found ${gr(an(a))} instead.`)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}}function cc(l,r){const a=l.length-1;let h,m,y=0,b=a,D=0;for(;y<=b;)if(D=Math.floor((y+b)/2),h=l[D],m=l[D+1],h<=r){if(D===a||r<m)return D;y=D+1}else{if(!(h>r))throw new si("Input is not a number.");b=D-1}return 0}class Oc{constructor(r,a,h){this.type=r,this.input=a,this.labels=[],this.outputs=[];for(const[m,y]of h)this.labels.push(m),this.outputs.push(y)}static parse(r,a){if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");const h=a.parse(r[1],1,qt);if(!h)return null;const m=[];let y=null;a.expectedType&&"value"!==a.expectedType.kind&&(y=a.expectedType);for(let b=1;b<r.length;b+=2){const D=1===b?-1/0:r[b],S=r[b+1],k=b,F=b+1;if("number"!=typeof D)return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(m.length&&m[m.length-1][0]>=D)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const $=a.parse(S,F,y);if(!$)return null;y=y||$.type,m.push([D,$])}return new Oc(y,h,m)}evaluate(r){const a=this.labels,h=this.outputs;if(1===a.length)return h[0].evaluate(r);const m=this.input.evaluate(r);if(m<=a[0])return h[0].evaluate(r);const y=a.length;return m>=a[y-1]?h[y-1].evaluate(r):h[cc(a,m)].evaluate(r)}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}var nl,Io,ud=function(){if(Io)return nl;function l(r,a,h,m){this.cx=3*r,this.bx=3*(h-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(m-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=a,this.p2x=h,this.p2y=m}return Io=1,nl=l,l.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,a){if(void 0===a&&(a=1e-6),r<0)return 0;if(r>1)return 1;for(var h=r,m=0;m<8;m++){var y=this.sampleCurveX(h)-r;if(Math.abs(y)<a)return h;var b=this.sampleCurveDerivativeX(h);if(Math.abs(b)<1e-6)break;h-=y/b}var D=0,S=1;for(h=r,m=0;m<20&&(y=this.sampleCurveX(h),!(Math.abs(y-r)<a));m++)r>y?D=h:S=h,h=.5*(S-D)+D;return h},solve:function(r,a){return this.sampleCurveY(this.solveCurveX(r,a))}},nl}(),Ws=function Dp(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}(ud);class Wr{constructor(r,a,h,m,y){this.type=r,this.operator=a,this.interpolation=h,this.input=m,this.labels=[],this.outputs=[];for(const[b,D]of y)this.labels.push(b),this.outputs.push(D)}static interpolationFactor(r,a,h,m){let y=0;if("exponential"===r.name)y=zr(a,r.base,h,m);else if("linear"===r.name)y=zr(a,1,h,m);else if("cubic-bezier"===r.name){const b=r.controlPoints;y=new Ws(b[0],b[1],b[2],b[3]).solve(zr(a,1,h,m))}return y}static parse(r,a){let[h,m,y,...b]=r;if(!Array.isArray(m)||0===m.length)return a.error("Expected an interpolation type expression.",1);if("linear"===m[0])m={name:"linear"};else if("exponential"===m[0]){const k=m[1];if("number"!=typeof k)return a.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:k}}else{if("cubic-bezier"!==m[0])return a.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const k=m.slice(1);if(4!==k.length||k.some(F=>"number"!=typeof F||F<0||F>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:k}}}if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(y=a.parse(y,2,qt),!y)return null;const D=[];let S=null;"interpolate-hcl"!==h&&"interpolate-lab"!==h||a.expectedType==ca?a.expectedType&&"value"!==a.expectedType.kind&&(S=a.expectedType):S=rs;for(let k=0;k<b.length;k+=2){const F=b[k],$=b[k+1],G=k+3,W=k+4;if("number"!=typeof F)return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',G);if(D.length&&D[D.length-1][0]>=F)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',G);const X=a.parse($,W,S);if(!X)return null;S=S||X.type,D.push([F,X])}return Ra(S,qt)||Ra(S,Ir)||Ra(S,rs)||Ra(S,Lr)||Ra(S,Si)||Ra(S,ca)||Ra(S,oc)||Ra(S,Et(qt))?new Wr(S,h,m,y,D):a.error(`Type ${gr(S)} is not interpolatable.`)}evaluate(r){const a=this.labels,h=this.outputs;if(1===a.length)return h[0].evaluate(r);const m=this.input.evaluate(r);if(m<=a[0])return h[0].evaluate(r);const y=a.length;if(m>=a[y-1])return h[y-1].evaluate(r);const b=cc(a,m),D=Wr.interpolationFactor(this.interpolation,m,a[b],a[b+1]),S=h[b].evaluate(r),k=h[b+1].evaluate(r);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return La(S,k,D);case"color":return oi.interpolate(S,k,D);case"padding":return So.interpolate(S,k,D);case"colorArray":return $n.interpolate(S,k,D);case"numberArray":return ss.interpolate(S,k,D);case"variableAnchorOffsetCollection":return as.interpolate(S,k,D);case"array":return Pl(S,k,D);case"projectionDefinition":return $o.interpolate(S,k,D)}case"interpolate-hcl":switch(this.type.kind){case"color":return oi.interpolate(S,k,D,"hcl");case"colorArray":return $n.interpolate(S,k,D,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return oi.interpolate(S,k,D,"lab");case"colorArray":return $n.interpolate(S,k,D,"lab")}}}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function zr(l,r,a,h){const m=h-a,y=l-a;return 0===m?0:1===r?y/m:(Math.pow(r,y)-1)/(Math.pow(r,m)-1)}const _o={color:oi.interpolate,number:La,padding:So.interpolate,numberArray:ss.interpolate,colorArray:$n.interpolate,variableAnchorOffsetCollection:as.interpolate,array:Pl};class kl{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");let h=null;const m=a.expectedType;m&&"value"!==m.kind&&(h=m);const y=[];for(const D of r.slice(1)){const S=a.parse(D,1+y.length,h,void 0,{typeAnnotation:"omit"});if(!S)return null;h=h||S.type,y.push(S)}if(!h)throw new Error("No output type");const b=m&&y.some(D=>Gs(m,D.type));return new kl(b?kn:h,y)}evaluate(r){let a,h=null,m=0;for(const y of this.args)if(m++,h=y.evaluate(r),h&&h instanceof ls&&!h.available&&(a||(a=h.name),h=null,m===this.args.length&&(h=a)),null!==h)break;return h}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}function ha(l,r){return"=="===l||"!="===l?"boolean"===r.kind||"string"===r.kind||"number"===r.kind||"null"===r.kind||"value"===r.kind:"string"===r.kind||"number"===r.kind||"value"===r.kind}function Rl(l,r,a,h){return 0===h.compare(r,a)}function da(l,r,a){const h="=="!==l&&"!="!==l;return class rz{constructor(y,b,D){this.type=Un,this.lhs=y,this.rhs=b,this.collator=D,this.hasUntypedArgument="value"===y.type.kind||"value"===b.type.kind}static parse(y,b){if(3!==y.length&&4!==y.length)return b.error("Expected two or three arguments.");const D=y[0];let S=b.parse(y[1],1,kn);if(!S)return null;if(!ha(D,S.type))return b.concat(1).error(`"${D}" comparisons are not supported for type '${gr(S.type)}'.`);let k=b.parse(y[2],2,kn);if(!k)return null;if(!ha(D,k.type))return b.concat(2).error(`"${D}" comparisons are not supported for type '${gr(k.type)}'.`);if(S.type.kind!==k.type.kind&&"value"!==S.type.kind&&"value"!==k.type.kind)return b.error(`Cannot compare types '${gr(S.type)}' and '${gr(k.type)}'.`);h&&("value"===S.type.kind&&"value"!==k.type.kind?S=new cs(k.type,[S]):"value"!==S.type.kind&&"value"===k.type.kind&&(k=new cs(S.type,[k])));let F=null;if(4===y.length){if("string"!==S.type.kind&&"string"!==k.type.kind&&"value"!==S.type.kind&&"value"!==k.type.kind)return b.error("Cannot use collator to compare non-string types.");if(F=b.parse(y[3],3,ka),!F)return null}return new rz(S,k,F)}evaluate(y){const b=this.lhs.evaluate(y),D=this.rhs.evaluate(y);if(h&&this.hasUntypedArgument){const S=an(b),k=an(D);if(S.kind!==k.kind||"string"!==S.kind&&"number"!==S.kind)throw new si(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${S.kind}, ${k.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const S=an(b),k=an(D);if("string"!==S.kind||"string"!==k.kind)return r(y,b,D)}return this.collator?a(y,b,D,this.collator.evaluate(y)):r(y,b,D)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}}}const li=da("==",function(l,r,a){return r===a},Rl),Yi=da("!=",function(l,r,a){return r!==a},function(l,r,a,h){return!Rl(0,r,a,h)}),ig=da("<",function(l,r,a){return r<a},function(l,r,a,h){return h.compare(r,a)<0}),nf=da(">",function(l,r,a){return r>a},function(l,r,a,h){return h.compare(r,a)>0}),uc=da("<=",function(l,r,a){return r<=a},function(l,r,a,h){return h.compare(r,a)<=0}),hd=da(">=",function(l,r,a){return r>=a},function(l,r,a,h){return h.compare(r,a)>=0});class us{constructor(r,a,h){this.type=ka,this.locale=h,this.caseSensitive=r,this.diacriticSensitive=a}static parse(r,a){if(2!==r.length)return a.error("Expected one argument.");const h=r[1];if("object"!=typeof h||Array.isArray(h))return a.error("Collator options argument must be an object.");const m=a.parse(void 0!==h["case-sensitive"]&&h["case-sensitive"],1,Un);if(!m)return null;const y=a.parse(void 0!==h["diacritic-sensitive"]&&h["diacritic-sensitive"],1,Un);if(!y)return null;let b=null;return h.locale&&(b=a.parse(h.locale,1,Mn),!b)?null:new us(m,y,b)}evaluate(r){return new Zs(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}}class hc{constructor(r,a,h,m,y){this.type=Mn,this.number=r,this.locale=a,this.currency=h,this.minFractionDigits=m,this.maxFractionDigits=y}static parse(r,a){if(3!==r.length)return a.error("Expected two arguments.");const h=a.parse(r[1],1,qt);if(!h)return null;const m=r[2];if("object"!=typeof m||Array.isArray(m))return a.error("NumberFormat options argument must be an object.");let y=null;if(m.locale&&(y=a.parse(m.locale,1,Mn),!y))return null;let b=null;if(m.currency&&(b=a.parse(m.currency,1,Mn),!b))return null;let D=null;if(m["min-fraction-digits"]&&(D=a.parse(m["min-fraction-digits"],1,qt),!D))return null;let S=null;return m["max-fraction-digits"]&&(S=a.parse(m["max-fraction-digits"],1,qt),!S)?null:new hc(h,y,b,D,S)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}}class ci{constructor(r){this.type=qr,this.sections=r}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const h=r[1];if(!Array.isArray(h)&&"object"==typeof h)return a.error("First argument must be an image or text section.");const m=[];let y=!1;for(let b=1;b<=r.length-1;++b){const D=r[b];if(y&&"object"==typeof D&&!Array.isArray(D)){y=!1;let S=null;if(D["font-scale"]&&(S=a.parse(D["font-scale"],1,qt),!S))return null;let k=null;if(D["text-font"]&&(k=a.parse(D["text-font"],1,Et(Mn)),!k))return null;let F=null;if(D["text-color"]&&(F=a.parse(D["text-color"],1,rs),!F))return null;let $=null;if(D["vertical-align"]){if("string"==typeof D["vertical-align"]&&!Fi.includes(D["vertical-align"]))return a.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${D["vertical-align"]}' instead.`);if($=a.parse(D["vertical-align"],1,Mn),!$)return null}const G=m[m.length-1];G.scale=S,G.font=k,G.textColor=F,G.verticalAlign=$}else{const S=a.parse(r[b],1,kn);if(!S)return null;const k=S.type.kind;if("string"!==k&&"value"!==k&&"null"!==k&&"resolvedImage"!==k)return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,m.push({content:S,scale:null,font:null,textColor:null,verticalAlign:null})}}return new ci(m)}evaluate(r){return new go(this.sections.map(a=>{const h=a.content.evaluate(r);return an(h)===El?new Oa("",h,null,null,null,a.verticalAlign?a.verticalAlign.evaluate(r):null):new Oa(tl(h),null,a.scale?a.scale.evaluate(r):null,a.font?a.font.evaluate(r).join(","):null,a.textColor?a.textColor.evaluate(r):null,a.verticalAlign?a.verticalAlign.evaluate(r):null)}))}eachChild(r){for(const a of this.sections)r(a.content),a.scale&&r(a.scale),a.font&&r(a.font),a.textColor&&r(a.textColor),a.verticalAlign&&r(a.verticalAlign)}outputDefined(){return!1}}class wa{constructor(r){this.type=El,this.input=r}static parse(r,a){if(2!==r.length)return a.error("Expected two arguments.");const h=a.parse(r[1],1,Mn);return h?new wa(h):a.error("No image name provided.")}evaluate(r){const a=this.input.evaluate(r),h=ls.fromString(a);return h&&r.availableImages&&(h.available=r.availableImages.indexOf(a)>-1),h}eachChild(r){r(this.input)}outputDefined(){return!1}}class Fc{constructor(r){this.type=qt,this.input=r}static parse(r,a){if(2!==r.length)return a.error(`Expected 1 argument, but found ${r.length-1} instead.`);const h=a.parse(r[1],1);return h?"array"!==h.type.kind&&"string"!==h.type.kind&&"value"!==h.type.kind?a.error(`Expected argument of type string or array, but found ${gr(h.type)} instead.`):new Fc(h):null}evaluate(r){const a=this.input.evaluate(r);if("string"==typeof a)return[...a].length;if(Array.isArray(a))return a.length;throw new si(`Expected value to be of type string or array, but found ${gr(an(a))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}}const yr=8192;function Ys(l,r){const a=(180+l[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,m=Math.pow(2,r.z);return[Math.round(a*m*yr),Math.round(h*m*yr)]}function dd(l,r){const a=Math.pow(2,r.z);return[(m=(l[0]/yr+r.x)/a,360*m-180),(h=(l[1]/yr+r.y)/a,360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90)];var h,m}function hu(l,r){l[0]=Math.min(l[0],r[0]),l[1]=Math.min(l[1],r[1]),l[2]=Math.max(l[2],r[0]),l[3]=Math.max(l[3],r[1])}function Ms(l,r){return!(l[0]<=r[0]||l[2]>=r[2]||l[1]<=r[1]||l[3]>=r[3])}function du(l,r,a){const h=l[0]-r[0],m=l[1]-r[1],y=l[0]-a[0],b=l[1]-a[1];return h*b-y*m==0&&h*y<=0&&m*b<=0}function Ll(l,r,a,h){return(m=[h[0]-a[0],h[1]-a[1]])[0]*(y=[r[0]-l[0],r[1]-l[1]])[1]-m[1]*y[0]!=0&&!(!dc(l,r,a,h)||!dc(a,h,l,r));var m,y}function fu(l,r,a){for(const h of a)for(let m=0;m<h.length-1;++m)if(Ll(l,r,h[m],h[m+1]))return!0;return!1}function Nc(l,r,a=!1){let h=!1;for(const D of r)for(let S=0;S<D.length-1;S++){if(du(l,D[S],D[S+1]))return a;(y=D[S])[1]>(m=l)[1]!=(b=D[S+1])[1]>m[1]&&m[0]<(b[0]-y[0])*(m[1]-y[1])/(b[1]-y[1])+y[0]&&(h=!h)}var m,y,b;return h}function fd(l,r){for(const a of r)if(Nc(l,a))return!0;return!1}function rf(l,r){for(const a of l)if(!Nc(a,r))return!1;for(let a=0;a<l.length-1;++a)if(fu(l[a],l[a+1],r))return!1;return!0}function fa(l,r){for(const a of r)if(rf(l,a))return!0;return!1}function dc(l,r,a,h){const m=h[0]-a[0],y=h[1]-a[1],b=(l[0]-a[0])*y-m*(l[1]-a[1]),D=(r[0]-a[0])*y-m*(r[1]-a[1]);return b>0&&D<0||b<0&&D>0}function Jn(l,r,a){const h=[];for(let m=0;m<l.length;m++){const y=[];for(let b=0;b<l[m].length;b++){const D=Ys(l[m][b],a);hu(r,D),y.push(D)}h.push(y)}return h}function Ca(l,r,a){const h=[];for(let m=0;m<l.length;m++){const y=Jn(l[m],r,a);h.push(y)}return h}function Ot(l,r,a,h){if(l[0]<a[0]||l[0]>a[2]){const m=.5*h;let y=l[0]-a[0]>m?-h:a[0]-l[0]>m?h:0;0===y&&(y=l[0]-a[2]>m?-h:a[2]-l[0]>m?h:0),l[0]+=y}hu(r,l)}function Ta(l,r,a,h){const m=Math.pow(2,h.z)*yr,y=[h.x*yr,h.y*yr],b=[];for(const D of l)for(const S of D){const k=[S.x+y[0],S.y+y[1]];Ot(k,r,a,m),b.push(k)}return b}function pu(l,r,a,h){const m=Math.pow(2,h.z)*yr,y=[h.x*yr,h.y*yr],b=[];for(const S of l){const k=[];for(const F of S){const $=[F.x+y[0],F.y+y[1]];hu(r,$),k.push($)}b.push(k)}if(r[2]-r[0]<=m/2){(D=r)[0]=D[1]=1/0,D[2]=D[3]=-1/0;for(const S of b)for(const k of S)Ot(k,r,a,m)}var D;return b}class hs{constructor(r,a){this.type=Un,this.geojson=r,this.geometries=a}static parse(r,a){if(2!==r.length)return a.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(qs(r[1])){const h=r[1];if("FeatureCollection"===h.type){const m=[];for(const y of h.features){const{type:b,coordinates:D}=y.geometry;"Polygon"===b&&m.push(D),"MultiPolygon"===b&&m.push(...D)}if(m.length)return new hs(h,{type:"MultiPolygon",coordinates:m})}else if("Feature"===h.type){const m=h.geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new hs(h,h.geometry)}else if("Polygon"===h.type||"MultiPolygon"===h.type)return new hs(h,h)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(null!=r.geometry()&&null!=r.canonicalID()){if("Point"===r.geometryType())return function(a,h){const m=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=a.canonicalID();if("Polygon"===h.type){const D=Jn(h.coordinates,y,b),S=Ta(a.geometry(),m,y,b);if(!Ms(m,y))return!1;for(const k of S)if(!Nc(k,D))return!1}if("MultiPolygon"===h.type){const D=Ca(h.coordinates,y,b),S=Ta(a.geometry(),m,y,b);if(!Ms(m,y))return!1;for(const k of S)if(!fd(k,D))return!1}return!0}(r,this.geometries);if("LineString"===r.geometryType())return function(a,h){const m=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=a.canonicalID();if("Polygon"===h.type){const D=Jn(h.coordinates,y,b),S=pu(a.geometry(),m,y,b);if(!Ms(m,y))return!1;for(const k of S)if(!rf(k,D))return!1}if("MultiPolygon"===h.type){const D=Ca(h.coordinates,y,b),S=pu(a.geometry(),m,y,b);if(!Ms(m,y))return!1;for(const k of S)if(!fa(k,D))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let pd=class{constructor(l=[],r=(a,h)=>a<h?-1:a>h?1:0){if(this.data=l,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(0===this.length)return;const l=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:r,compare:a}=this,h=r[l];for(;l>0;){const m=l-1>>1,y=r[m];if(a(h,y)>=0)break;r[l]=y,l=m}r[l]=h}_down(l){const{data:r,compare:a}=this,h=this.length>>1,m=r[l];for(;l<h;){let y=1+(l<<1);const b=y+1;if(b<this.length&&a(r[b],r[y])<0&&(y=b),a(r[y],m)>=0)break;r[l]=r[y],l=y}r[l]=m}};function mu(l,r,a=0,h=l.length-1,m=Da){for(;h>a;){if(h-a>600){const S=h-a+1,k=r-a+1,F=Math.log(S),$=.5*Math.exp(2*F/3),G=.5*Math.sqrt(F*$*(S-$)/S)*(k-S/2<0?-1:1);mu(l,r,Math.max(a,Math.floor(r-k*$/S+G)),Math.min(h,Math.floor(r+(S-k)*$/S+G)),m)}const y=l[r];let b=a,D=h;for(gu(l,a,r),m(l[h],y)>0&&gu(l,a,h);b<D;){for(gu(l,b,D),b++,D--;m(l[b],y)<0;)b++;for(;m(l[D],y)>0;)D--}0===m(l[a],y)?gu(l,a,D):(D++,gu(l,D,h)),D<=r&&(a=D+1),r<=D&&(h=D-1)}}function gu(l,r,a){const h=l[r];l[r]=l[a],l[a]=h}function Da(l,r){return l<r?-1:l>r?1:0}function Na(l,r){if(l.length<=1)return[l];const a=[];let h,m;for(const y of l){const b=_u(y);0!==b&&(y.area=Math.abs(b),void 0===m&&(m=b<0),m===b<0?(h&&a.push(h),h=[y]):h.push(y))}if(h&&a.push(h),r>1)for(let y=0;y<a.length;y++)a[y].length<=r||(mu(a[y],r,1,a[y].length-1,Mp),a[y]=a[y].slice(0,r));return a}function Mp(l,r){return r.area-l.area}function _u(l){let r=0;for(let a,h,m=0,y=l.length,b=y-1;m<y;b=m++)a=l[m],h=l[b],r+=(h.x-a.x)*(a.y+h.y);return r}const sf=1/298.257223563,Po=sf*(2-sf),md=Math.PI/180;class no{constructor(r){const a=6378.137*md*1e3,h=Math.cos(r*md),m=1/(1-Po*(1-h*h)),y=Math.sqrt(m);this.kx=a*y*h,this.ky=a*y*m*(1-Po)}distance(r,a){const h=this.wrap(r[0]-a[0])*this.kx,m=(r[1]-a[1])*this.ky;return Math.sqrt(h*h+m*m)}pointOnLine(r,a){let h,m,y,b,D=1/0;for(let S=0;S<r.length-1;S++){let k=r[S][0],F=r[S][1],$=this.wrap(r[S+1][0]-k)*this.kx,G=(r[S+1][1]-F)*this.ky,W=0;0===$&&0===G||(W=(this.wrap(a[0]-k)*this.kx*$+(a[1]-F)*this.ky*G)/($*$+G*G),W>1?(k=r[S+1][0],F=r[S+1][1]):W>0&&(k+=$/this.kx*W,F+=G/this.ky*W)),$=this.wrap(a[0]-k)*this.kx,G=(a[1]-F)*this.ky;const X=$*$+G*G;X<D&&(D=X,h=k,m=F,y=S,b=W)}return{point:[h,m],index:y,t:Math.max(0,Math.min(1,b))}}wrap(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}}function fc(l,r){return r[0]-l[0]}function Es(l){return l[1]-l[0]+1}function Yo(l,r){return l[1]>=l[0]&&l[1]<r}function pc(l,r){if(l[0]>l[1])return[null,null];const a=Es(l);if(r){if(2===a)return[l,null];const m=Math.floor(a/2);return[[l[0],l[0]+m],[l[0]+m,l[1]]]}if(1===a)return[l,null];const h=Math.floor(a/2)-1;return[[l[0],l[0]+h],[l[0]+h+1,l[1]]]}function zc(l,r){if(!Yo(r,l.length))return[1/0,1/0,-1/0,-1/0];const a=[1/0,1/0,-1/0,-1/0];for(let h=r[0];h<=r[1];++h)hu(a,l[h]);return a}function mc(l){const r=[1/0,1/0,-1/0,-1/0];for(const a of l)for(const h of a)hu(r,h);return r}function Ho(l){return l[0]!==-1/0&&l[1]!==-1/0&&l[2]!==1/0&&l[3]!==1/0}function Ol(l,r,a){if(!Ho(l)||!Ho(r))return NaN;let h=0,m=0;return l[2]<r[0]&&(h=r[0]-l[2]),l[0]>r[2]&&(h=l[0]-r[2]),l[1]>r[3]&&(m=l[1]-r[3]),l[3]<r[1]&&(m=r[1]-l[3]),a.distance([0,0],[h,m])}function Xo(l,r,a){const h=a.pointOnLine(r,l);return a.distance(l,h.point)}function Bc(l,r,a,h,m){const y=Math.min(Xo(l,[a,h],m),Xo(r,[a,h],m)),b=Math.min(Xo(a,[l,r],m),Xo(h,[l,r],m));return Math.min(y,b)}function Xs(l,r,a,h,m){if(!Yo(r,l.length)||!Yo(h,a.length))return 1/0;let y=1/0;for(let b=r[0];b<r[1];++b){const D=l[b],S=l[b+1];for(let k=h[0];k<h[1];++k){const F=a[k],$=a[k+1];if(Ll(D,S,F,$))return 0;y=Math.min(y,Bc(D,S,F,$,m))}}return y}function Ln(l,r,a,h,m){if(!Yo(r,l.length)||!Yo(h,a.length))return NaN;let y=1/0;for(let b=r[0];b<=r[1];++b)for(let D=h[0];D<=h[1];++D)if(y=Math.min(y,m.distance(l[b],a[D])),0===y)return y;return y}function pa(l,r,a){if(Nc(l,r,!0))return 0;let h=1/0;for(const m of r){const y=m[0],b=m[m.length-1];if(y!==b&&(h=Math.min(h,Xo(l,[b,y],a)),0===h))return h;const D=a.pointOnLine(m,l);if(h=Math.min(h,a.distance(l,D.point)),0===h)return h}return h}function yu(l,r,a,h){if(!Yo(r,l.length))return NaN;for(let y=r[0];y<=r[1];++y)if(Nc(l[y],a,!0))return 0;let m=1/0;for(let y=r[0];y<r[1];++y){const b=l[y],D=l[y+1];for(const S of a)for(let k=0,F=S.length,$=F-1;k<F;$=k++){const G=S[$],W=S[k];if(Ll(b,D,G,W))return 0;m=Math.min(m,Bc(b,D,G,W,h))}}return m}function ph(l,r){for(const a of l)for(const h of a)if(Nc(h,r,!0))return!0;return!1}function vu(l,r,a,h=1/0){const m=mc(l),y=mc(r);if(h!==1/0&&Ol(m,y,a)>=h)return h;if(Ms(m,y)){if(ph(l,r))return 0}else if(ph(r,l))return 0;let b=1/0;for(const D of l)for(let S=0,k=D.length,F=k-1;S<k;F=S++){const $=D[F],G=D[S];for(const W of r)for(let X=0,Q=W.length,re=Q-1;X<Q;re=X++){const ye=W[re],Ae=W[X];if(Ll($,G,ye,Ae))return 0;b=Math.min(b,Bc($,G,ye,Ae,a))}}return b}function Ss(l,r,a,h,m,y){if(!y)return;const b=Ol(zc(h,y),m,a);b<r&&l.push([b,y,[0,0]])}function wi(l,r,a,h,m,y,b){if(!y||!b)return;const D=Ol(zc(h,y),zc(m,b),a);D<r&&l.push([D,y,b])}function yo(l,r,a,h,m=1/0){let y=Math.min(h.distance(l[0],a[0][0]),m);if(0===y)return y;const b=new pd([[0,[0,l.length-1],[0,0]]],fc),D=mc(a);for(;b.length>0;){const S=b.pop();if(S[0]>=y)continue;const k=S[1],F=r?50:100;if(Es(k)<=F){if(!Yo(k,l.length))return NaN;if(r){const $=yu(l,k,a,h);if(isNaN($)||0===$)return $;y=Math.min(y,$)}else for(let $=k[0];$<=k[1];++$){const G=pa(l[$],a,h);if(y=Math.min(y,G),0===y)return 0}}else{const $=pc(k,r);Ss(b,y,h,l,D,$[0]),Ss(b,y,h,l,D,$[1])}}return y}function Pr(l,r,a,h,m,y=1/0){let b=Math.min(y,m.distance(l[0],a[0]));if(0===b)return b;const D=new pd([[0,[0,l.length-1],[0,a.length-1]]],fc);for(;D.length>0;){const S=D.pop();if(S[0]>=b)continue;const k=S[1],F=S[2],$=r?50:100,G=h?50:100;if(Es(k)<=$&&Es(F)<=G){if(!Yo(k,l.length)&&Yo(F,a.length))return NaN;let W;if(r&&h)W=Xs(l,k,a,F,m),b=Math.min(b,W);else if(r&&!h){const X=l.slice(k[0],k[1]+1);for(let Q=F[0];Q<=F[1];++Q)if(W=Xo(a[Q],X,m),b=Math.min(b,W),0===b)return b}else if(!r&&h){const X=a.slice(F[0],F[1]+1);for(let Q=k[0];Q<=k[1];++Q)if(W=Xo(l[Q],X,m),b=Math.min(b,W),0===b)return b}else W=Ln(l,k,a,F,m),b=Math.min(b,W)}else{const W=pc(k,r),X=pc(F,h);wi(D,b,m,l,a,W[0],X[0]),wi(D,b,m,l,a,W[0],X[1]),wi(D,b,m,l,a,W[1],X[0]),wi(D,b,m,l,a,W[1],X[1])}}return b}function ma(l){return"MultiPolygon"===l.type?l.coordinates.map(r=>({type:"Polygon",coordinates:r})):"MultiLineString"===l.type?l.coordinates.map(r=>({type:"LineString",coordinates:r})):"MultiPoint"===l.type?l.coordinates.map(r=>({type:"Point",coordinates:r})):[l]}class ds{constructor(r,a){this.type=qt,this.geojson=r,this.geometries=a}static parse(r,a){if(2!==r.length)return a.error(`'distance' expression requires exactly one argument, but found ${r.length-1} instead.`);if(qs(r[1])){const h=r[1];if("FeatureCollection"===h.type)return new ds(h,h.features.map(m=>ma(m.geometry)).flat());if("Feature"===h.type)return new ds(h,ma(h.geometry));if("type"in h&&"coordinates"in h)return new ds(h,ma(h))}return a.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(null!=r.geometry()&&null!=r.canonicalID()){if("Point"===r.geometryType())return function(a,h){const m=a.geometry(),y=m.flat().map(S=>dd([S.x,S.y],a.canonical));if(0===m.length)return NaN;const b=new no(y[0][1]);let D=1/0;for(const S of h){switch(S.type){case"Point":D=Math.min(D,Pr(y,!1,[S.coordinates],!1,b,D));break;case"LineString":D=Math.min(D,Pr(y,!1,S.coordinates,!0,b,D));break;case"Polygon":D=Math.min(D,yo(y,!1,S.coordinates,b,D))}if(0===D)return D}return D}(r,this.geometries);if("LineString"===r.geometryType())return function(a,h){const m=a.geometry(),y=m.flat().map(S=>dd([S.x,S.y],a.canonical));if(0===m.length)return NaN;const b=new no(y[0][1]);let D=1/0;for(const S of h){switch(S.type){case"Point":D=Math.min(D,Pr(y,!0,[S.coordinates],!1,b,D));break;case"LineString":D=Math.min(D,Pr(y,!0,S.coordinates,!0,b,D));break;case"Polygon":D=Math.min(D,yo(y,!0,S.coordinates,b,D))}if(0===D)return D}return D}(r,this.geometries);if("Polygon"===r.geometryType())return function(a,h){const m=a.geometry();if(0===m.length||0===m[0].length)return NaN;const y=Na(m,0).map(S=>S.map(k=>k.map(F=>dd([F.x,F.y],a.canonical)))),b=new no(y[0][0][0][1]);let D=1/0;for(const S of h)for(const k of y){switch(S.type){case"Point":D=Math.min(D,yo([S.coordinates],!1,k,b,D));break;case"LineString":D=Math.min(D,yo(S.coordinates,!0,k,b,D));break;case"Polygon":D=Math.min(D,vu(k,S.coordinates,b,D))}if(0===D)return D}return D}(r,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class gc{constructor(r){this.type=kn,this.key=r}static parse(r,a){if(2!==r.length)return a.error(`Expected 1 argument, but found ${r.length-1} instead.`);const h=r[1];return null==h?a.error("Global state property must be defined."):"string"!=typeof h?a.error(`Global state property must be string, but found ${typeof r[1]} instead.`):new gc(h)}evaluate(r){var a;const h=null===(a=r.globals)||void 0===a?void 0:a.globalState;return h&&0!==Object.keys(h).length?dr(h,this.key):null}eachChild(){}outputDefined(){return!1}}const Vc={"==":li,"!=":Yi,">":nf,"<":ig,">=":hd,"<=":uc,array:cs,at:sn,boolean:cs,case:ac,coalesce:kl,collator:us,format:ci,image:wa,in:Go,"index-of":Ds,interpolate:Wr,"interpolate-hcl":Wr,"interpolate-lab":Wr,length:Fc,let:Ri,literal:rr,match:Lc,number:cs,"number-format":hc,object:cs,slice:lc,step:Oc,string:cs,"to-boolean":Fa,"to-color":Fa,"to-number":Fa,"to-string":Fa,var:Li,within:hs,distance:ds,"global-state":gc};class fs{constructor(r,a,h,m){this.name=r,this.type=a,this._evaluate=h,this.args=m}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}static parse(r,a){const h=r[0],m=fs.definitions[h];if(!m)return a.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(m)?m[0]:m.type,b=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,D=b.filter(([k])=>!Array.isArray(k)||k.length===r.length-1);let S=null;for(const[k,F]of D){S=new Al(a.registry,bu,a.path,null,a.scope);const $=[];let G=!1;for(let W=1;W<r.length;W++){const X=r[W],Q=Array.isArray(k)?k[W-1]:k.type,re=S.parse(X,1+$.length,Q);if(!re){G=!0;break}$.push(re)}if(!G)if(Array.isArray(k)&&k.length!==$.length)S.error(`Expected ${k.length} arguments, but found ${$.length} instead.`);else{for(let W=0;W<$.length;W++){const X=Array.isArray(k)?k[W]:k.type,Q=$[W];S.concat(W+1).checkSubtype(X,Q.type)}if(0===S.errors.length)return new fs(h,y,F,$)}}if(1===D.length)a.errors.push(...S.errors);else{const k=(D.length?D:b).map(([$])=>{return G=$,Array.isArray(G)?`(${G.map(gr).join(", ")})`:`(${gr(G.type)}...)`;var G}).join(" | "),F=[];for(let $=1;$<r.length;$++){const G=a.parse(r[$],1+F.length);if(!G)return null;F.push(gr(G.type))}a.error(`Expected arguments of type ${k}, but found (${F.join(", ")}) instead.`)}return null}static register(r,a){fs.definitions=a;for(const h in a)r[h]=fs}}function gd(l,[r,a,h,m]){r=r.evaluate(l),a=a.evaluate(l),h=h.evaluate(l);const y=m?m.evaluate(l):1,b=cd(r,a,h,y);if(b)throw new si(b);return new oi(r/255,a/255,h/255,y,!1)}function il(l,r){return l in r}function af(l,r){const a=r[l];return void 0===a?null:a}function Is(l){return{type:l}}function bu(l){if(l instanceof Li)return bu(l.boundExpression);if(l instanceof fs&&"error"===l.name||l instanceof us||l instanceof hs||l instanceof ds||l instanceof gc)return!1;const r=l instanceof Fa||l instanceof cs;let a=!0;return l.eachChild(h=>{a=r?a&&bu(h):a&&h instanceof rr}),!!a&&_c(l)&&Ks(l,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function _c(l){if(l instanceof fs&&("get"===l.name&&1===l.args.length||"feature-state"===l.name||"has"===l.name&&1===l.args.length||"properties"===l.name||"geometry-type"===l.name||"id"===l.name||/^filter-/.test(l.name))||l instanceof hs||l instanceof ds)return!1;let r=!0;return l.eachChild(a=>{r&&!_c(a)&&(r=!1)}),r}function jc(l){if(l instanceof fs&&"feature-state"===l.name)return!1;let r=!0;return l.eachChild(a=>{r&&!jc(a)&&(r=!1)}),r}function Ks(l,r){if(l instanceof fs&&r.indexOf(l.name)>=0)return!1;let a=!0;return l.eachChild(h=>{a&&!Ks(h,r)&&(a=!1)}),a}function rl(l){return{result:"success",value:l}}function yc(l){return{result:"error",value:l}}function ga(l){return"data-driven"===l["property-type"]||"cross-faded-data-driven"===l["property-type"]}function xu(l){return!!l.expression&&l.expression.parameters.indexOf("zoom")>-1}function vc(l){return!!l.expression&&l.expression.interpolated}function _i(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":null===l?"null":typeof l}function Fl(l){return"object"==typeof l&&null!==l&&!Array.isArray(l)&&an(l)===mo}function ps(l){return l}function Nl(l,r){const a=l.stops&&"object"==typeof l.stops[0][0],h=a||!(a||void 0!==l.property),m=l.type||(vc(r)?"exponential":"interval"),y=function(F){switch(F.type){case"color":return oi.parse;case"padding":return So.parse;case"numberArray":return ss.parse;case"colorArray":return $n.parse;default:return null}}(r);if(y&&((l=Ci({},l)).stops&&(l.stops=l.stops.map(F=>[F[0],y(F[1])])),l.default=y(l.default?l.default:r.default)),l.colorSpace&&"rgb"!==(b=l.colorSpace)&&"hcl"!==b&&"lab"!==b)throw new Error(`Unknown color space: "${l.colorSpace}"`);var b;const D=function(F){switch(F){case"exponential":return gh;case"interval":return lf;case"categorical":return mh;case"identity":return Uc;default:throw new Error(`Unknown function type "${F}"`)}}(m);let S,k;if("categorical"===m){S=Object.create(null);for(const F of l.stops)S[F[0]]=F[1];k=typeof l.stops[0][0]}if(a){const F={},$=[];for(let X=0;X<l.stops.length;X++){const Q=l.stops[X],re=Q[0].zoom;void 0===F[re]&&(F[re]={zoom:re,type:l.type,property:l.property,default:l.default,stops:[]},$.push(re)),F[re].stops.push([Q[0].value,Q[1]])}const G=[];for(const X of $)G.push([F[X].zoom,Nl(F[X],r)]);const W={name:"linear"};return{kind:"composite",interpolationType:W,interpolationFactor:Wr.interpolationFactor.bind(void 0,W),zoomStops:G.map(X=>X[0]),evaluate:({zoom:X},Q)=>gh({stops:G,base:l.base},r,X).evaluate(X,Q)}}if(h){const F="exponential"===m?{name:"exponential",base:void 0!==l.base?l.base:1}:null;return{kind:"camera",interpolationType:F,interpolationFactor:Wr.interpolationFactor.bind(void 0,F),zoomStops:l.stops.map($=>$[0]),evaluate:({zoom:$})=>D(l,r,$,S,k)}}return{kind:"source",evaluate(F,$){const G=$&&$.properties?$.properties[l.property]:void 0;return void 0===G?zl(l.default,r.default):D(l,r,G,S,k)}}}function zl(l,r,a){return void 0!==l?l:void 0!==r?r:void 0!==a?a:void 0}function mh(l,r,a,h,m){return zl(typeof a===m?h[a]:void 0,l.default,r.default)}function lf(l,r,a){if("number"!==_i(a))return zl(l.default,r.default);const h=l.stops.length;if(1===h||a<=l.stops[0][0])return l.stops[0][1];if(a>=l.stops[h-1][0])return l.stops[h-1][1];const m=cc(l.stops.map(y=>y[0]),a);return l.stops[m][1]}function gh(l,r,a){const h=void 0!==l.base?l.base:1;if("number"!==_i(a))return zl(l.default,r.default);const m=l.stops.length;if(1===m||a<=l.stops[0][0])return l.stops[0][1];if(a>=l.stops[m-1][0])return l.stops[m-1][1];const y=cc(l.stops.map(F=>F[0]),a),b=function(F,$,G,W){const X=W-G,Q=F-G;return 0===X?0:1===$?Q/X:(Math.pow($,Q)-1)/(Math.pow($,X)-1)}(a,h,l.stops[y][0],l.stops[y+1][0]),D=l.stops[y][1],S=l.stops[y+1][1],k=_o[r.type]||ps;return"function"==typeof D.evaluate?{evaluate(...F){const $=D.evaluate.apply(void 0,F),G=S.evaluate.apply(void 0,F);if(void 0!==$&&void 0!==G)return k($,G,b,l.colorSpace)}}:k(D,S,b,l.colorSpace)}function Uc(l,r,a){switch(r.type){case"color":a=oi.parse(a);break;case"formatted":a=go.fromString(a.toString());break;case"resolvedImage":a=ls.fromString(a.toString());break;case"padding":a=So.parse(a);break;case"colorArray":a=$n.parse(a);break;case"numberArray":a=ss.parse(a);break;default:_i(a)===r.type||"enum"===r.type&&r.values[a]||(a=void 0)}return zl(a,l.default,r.default)}fs.register(Vc,{error:[{kind:"error"},[Mn],(l,[r])=>{throw new si(r.evaluate(l))}],typeof:[Mn,[kn],(l,[r])=>gr(an(r.evaluate(l)))],"to-rgba":[Et(qt,4),[rs],(l,[r])=>{const[a,h,m,y]=r.evaluate(l).rgb;return[255*a,255*h,255*m,y]}],rgb:[rs,[qt,qt,qt],gd],rgba:[rs,[qt,qt,qt,qt],gd],has:{type:Un,overloads:[[[Mn],(l,[r])=>il(r.evaluate(l),l.properties())],[[Mn,mo],(l,[r,a])=>il(r.evaluate(l),a.evaluate(l))]]},get:{type:kn,overloads:[[[Mn],(l,[r])=>af(r.evaluate(l),l.properties())],[[Mn,mo],(l,[r,a])=>af(r.evaluate(l),a.evaluate(l))]]},"feature-state":[kn,[Mn],(l,[r])=>af(r.evaluate(l),l.featureState||{})],properties:[mo,[],l=>l.properties()],"geometry-type":[Mn,[],l=>l.geometryType()],id:[kn,[],l=>l.id()],zoom:[qt,[],l=>l.globals.zoom],"heatmap-density":[qt,[],l=>l.globals.heatmapDensity||0],elevation:[qt,[],l=>l.globals.elevation||0],"line-progress":[qt,[],l=>l.globals.lineProgress||0],accumulated:[kn,[],l=>void 0===l.globals.accumulated?null:l.globals.accumulated],"+":[qt,Is(qt),(l,r)=>{let a=0;for(const h of r)a+=h.evaluate(l);return a}],"*":[qt,Is(qt),(l,r)=>{let a=1;for(const h of r)a*=h.evaluate(l);return a}],"-":{type:qt,overloads:[[[qt,qt],(l,[r,a])=>r.evaluate(l)-a.evaluate(l)],[[qt],(l,[r])=>-r.evaluate(l)]]},"/":[qt,[qt,qt],(l,[r,a])=>r.evaluate(l)/a.evaluate(l)],"%":[qt,[qt,qt],(l,[r,a])=>r.evaluate(l)%a.evaluate(l)],ln2:[qt,[],()=>Math.LN2],pi:[qt,[],()=>Math.PI],e:[qt,[],()=>Math.E],"^":[qt,[qt,qt],(l,[r,a])=>Math.pow(r.evaluate(l),a.evaluate(l))],sqrt:[qt,[qt],(l,[r])=>Math.sqrt(r.evaluate(l))],log10:[qt,[qt],(l,[r])=>Math.log(r.evaluate(l))/Math.LN10],ln:[qt,[qt],(l,[r])=>Math.log(r.evaluate(l))],log2:[qt,[qt],(l,[r])=>Math.log(r.evaluate(l))/Math.LN2],sin:[qt,[qt],(l,[r])=>Math.sin(r.evaluate(l))],cos:[qt,[qt],(l,[r])=>Math.cos(r.evaluate(l))],tan:[qt,[qt],(l,[r])=>Math.tan(r.evaluate(l))],asin:[qt,[qt],(l,[r])=>Math.asin(r.evaluate(l))],acos:[qt,[qt],(l,[r])=>Math.acos(r.evaluate(l))],atan:[qt,[qt],(l,[r])=>Math.atan(r.evaluate(l))],min:[qt,Is(qt),(l,r)=>Math.min(...r.map(a=>a.evaluate(l)))],max:[qt,Is(qt),(l,r)=>Math.max(...r.map(a=>a.evaluate(l)))],abs:[qt,[qt],(l,[r])=>Math.abs(r.evaluate(l))],round:[qt,[qt],(l,[r])=>{const a=r.evaluate(l);return a<0?-Math.round(-a):Math.round(a)}],floor:[qt,[qt],(l,[r])=>Math.floor(r.evaluate(l))],ceil:[qt,[qt],(l,[r])=>Math.ceil(r.evaluate(l))],"filter-==":[Un,[Mn,kn],(l,[r,a])=>l.properties()[r.value]===a.value],"filter-id-==":[Un,[kn],(l,[r])=>l.id()===r.value],"filter-type-==":[Un,[Mn],(l,[r])=>l.geometryType()===r.value],"filter-<":[Un,[Mn,kn],(l,[r,a])=>{const h=l.properties()[r.value],m=a.value;return typeof h==typeof m&&h<m}],"filter-id-<":[Un,[kn],(l,[r])=>{const a=l.id(),h=r.value;return typeof a==typeof h&&a<h}],"filter->":[Un,[Mn,kn],(l,[r,a])=>{const h=l.properties()[r.value],m=a.value;return typeof h==typeof m&&h>m}],"filter-id->":[Un,[kn],(l,[r])=>{const a=l.id(),h=r.value;return typeof a==typeof h&&a>h}],"filter-<=":[Un,[Mn,kn],(l,[r,a])=>{const h=l.properties()[r.value],m=a.value;return typeof h==typeof m&&h<=m}],"filter-id-<=":[Un,[kn],(l,[r])=>{const a=l.id(),h=r.value;return typeof a==typeof h&&a<=h}],"filter->=":[Un,[Mn,kn],(l,[r,a])=>{const h=l.properties()[r.value],m=a.value;return typeof h==typeof m&&h>=m}],"filter-id->=":[Un,[kn],(l,[r])=>{const a=l.id(),h=r.value;return typeof a==typeof h&&a>=h}],"filter-has":[Un,[kn],(l,[r])=>r.value in l.properties()],"filter-has-id":[Un,[],l=>null!==l.id()&&void 0!==l.id()],"filter-type-in":[Un,[Et(Mn)],(l,[r])=>r.value.indexOf(l.geometryType())>=0],"filter-id-in":[Un,[Et(kn)],(l,[r])=>r.value.indexOf(l.id())>=0],"filter-in-small":[Un,[Mn,Et(kn)],(l,[r,a])=>a.value.indexOf(l.properties()[r.value])>=0],"filter-in-large":[Un,[Mn,Et(kn)],(l,[r,a])=>function(h,m,y,b){for(;y<=b;){const D=y+b>>1;if(m[D]===h)return!0;m[D]>h?b=D-1:y=D+1}return!1}(l.properties()[r.value],a.value,0,a.value.length-1)],all:{type:Un,overloads:[[[Un,Un],(l,[r,a])=>r.evaluate(l)&&a.evaluate(l)],[Is(Un),(l,r)=>{for(const a of r)if(!a.evaluate(l))return!1;return!0}]]},any:{type:Un,overloads:[[[Un,Un],(l,[r,a])=>r.evaluate(l)||a.evaluate(l)],[Is(Un),(l,r)=>{for(const a of r)if(a.evaluate(l))return!0;return!1}]]},"!":[Un,[Un],(l,[r])=>!r.evaluate(l)],"is-supported-script":[Un,[Mn],(l,[r])=>{const a=l.globals&&l.globals.isSupportedScript;return!a||a(r.evaluate(l))}],upcase:[Mn,[Mn],(l,[r])=>r.evaluate(l).toUpperCase()],downcase:[Mn,[Mn],(l,[r])=>r.evaluate(l).toLowerCase()],concat:[Mn,Is(kn),(l,r)=>r.map(a=>tl(a.evaluate(l))).join("")],"resolved-locale":[Mn,[ka],(l,[r])=>r.evaluate(l).resolvedLocale()]});class ol{constructor(r,a,h){this.expression=r,this._warningHistory={},this._evaluator=new ai,this._defaultValue=a?function(m){if("color"===m.type&&Fl(m.default))return new oi(0,0,0,0);switch(m.type){case"color":return oi.parse(m.default)||null;case"padding":return So.parse(m.default)||null;case"numberArray":return ss.parse(m.default)||null;case"colorArray":return $n.parse(m.default)||null;case"variableAnchorOffsetCollection":return as.parse(m.default)||null;case"projectionDefinition":return $o.parse(m.default)||null;default:return void 0===m.default?null:m.default}}(a):null,this._enumValues=a&&"enum"===a.type?a.values:null,this._globalState=h}evaluateWithoutErrorHandling(r,a,h,m,y,b){return this._globalState&&(r=_e(r,this._globalState)),this._evaluator.globals=r,this._evaluator.feature=a,this._evaluator.featureState=h,this._evaluator.canonical=m,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(r,a,h,m,y,b){this._globalState&&(r=_e(r,this._globalState)),this._evaluator.globals=r,this._evaluator.feature=a||null,this._evaluator.featureState=h||null,this._evaluator.canonical=m,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null;try{const D=this.expression.evaluate(this._evaluator);if(null==D||"number"==typeof D&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new si(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(D.message)),this._defaultValue}}}function wu(l){return Array.isArray(l)&&l.length>0&&"string"==typeof l[0]&&l[0]in Vc}function Cu(l,r,a){const h=new Al(Vc,bu,[],r?function(y){const b={color:rs,string:Mn,number:qt,enum:Mn,boolean:Un,formatted:qr,padding:Lr,numberArray:Si,colorArray:ca,projectionDefinition:Ir,resolvedImage:El,variableAnchorOffsetCollection:oc};return"array"===y.type?Et(b[y.value]||kn,y.length):b[y.type]}(r):void 0),m=h.parse(l,void 0,void 0,void 0,r&&"string"===r.type?{typeAnnotation:"coerce"}:void 0);return m?rl(new ol(m,r,a)):yc(h.errors)}class bc{constructor(r,a,h){this.kind=r,this._styleExpression=a,this.isStateDependent="constant"!==r&&!jc(a.expression),this.globalStateRefs=Y(a.expression),this._globalState=h}evaluateWithoutErrorHandling(r,a,h,m,y,b){return this._globalState&&(r=_e(r,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(r,a,h,m,y,b)}evaluate(r,a,h,m,y,b){return this._globalState&&(r=_e(r,this._globalState)),this._styleExpression.evaluate(r,a,h,m,y,b)}}class f{constructor(r,a,h,m,y){this.kind=r,this.zoomStops=h,this._styleExpression=a,this.isStateDependent="camera"!==r&&!jc(a.expression),this.globalStateRefs=Y(a.expression),this.interpolationType=m,this._globalState=y}evaluateWithoutErrorHandling(r,a,h,m,y,b){return this._globalState&&(r=_e(r,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(r,a,h,m,y,b)}evaluate(r,a,h,m,y,b){return this._globalState&&(r=_e(r,this._globalState)),this._styleExpression.evaluate(r,a,h,m,y,b)}interpolationFactor(r,a,h){return this.interpolationType?Wr.interpolationFactor(this.interpolationType,r,a,h):0}}function C(l,r,a){const h=Cu(l,r,a);if("error"===h.result)return h;const m=h.value.expression,y=_c(m);if(!y&&!ga(r))return yc([new gn("","data expressions not supported")]);const b=Ks(m,["zoom"]);if(!b&&!xu(r))return yc([new gn("","zoom expressions not supported")]);const D=B(m);return D||b?D instanceof gn?yc([D]):D instanceof Wr&&!vc(r)?yc([new gn("",'"interpolate" expressions cannot be used with this property')]):rl(D?new f(y?"camera":"composite",h.value,D.labels,D instanceof Wr?D.interpolation:void 0,a):new bc(y?"constant":"source",h.value,a)):yc([new gn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class P{constructor(r,a){this._parameters=r,this._specification=a,Ci(this,Nl(this._parameters,this._specification))}static deserialize(r){return new P(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function B(l){let r=null;if(l instanceof Ri)r=B(l.result);else if(l instanceof kl){for(const a of l.args)if(r=B(a),r)break}else(l instanceof Oc||l instanceof Wr)&&l.input instanceof fs&&"zoom"===l.input.name&&(r=l);return r instanceof gn||l.eachChild(a=>{const h=B(a);h instanceof gn?r=h:!r&&h?r=new gn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&h&&r!==h&&(r=new gn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function Y(l,r=new Set){return l instanceof gc&&r.add(l.key),l.eachChild(a=>{Y(a,r)}),r}function _e(l,r){const{zoom:a,heatmapDensity:h,elevation:m,lineProgress:y,isSupportedScript:b,accumulated:D}=l??{};return{zoom:a,heatmapDensity:h,elevation:m,lineProgress:y,isSupportedScript:b,accumulated:D,globalState:r}}function qe(l){if(!0===l||!1===l)return!0;if(!Array.isArray(l)||0===l.length)return!1;switch(l[0]){case"has":return l.length>=2&&"$id"!==l[1]&&"$type"!==l[1];case"in":return l.length>=3&&("string"!=typeof l[1]||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==l.length||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const r of l.slice(1))if(!qe(r)&&"boolean"!=typeof r)return!1;return!0;default:return!0}}const at={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function wt(l,r){if(null==l)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};qe(l)||(l=ei(l));const a=Cu(l,at,r);if("error"===a.result)throw new Error(a.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,m,y)=>a.value.evaluate(h,m,{},y),needGeometry:wn(l),getGlobalStateRefs:()=>Y(a.value.expression)}}function Yt(l,r){return l<r?-1:l>r?1:0}function wn(l){if(!Array.isArray(l))return!1;if("within"===l[0]||"distance"===l[0])return!0;for(let r=1;r<l.length;r++)if(wn(l[r]))return!0;return!1}function ei(l){if(!l)return!0;const r=l[0];return l.length<=1?"any"!==r:"=="===r?Ti(l[1],l[2],"=="):"!="===r?ms(Ti(l[1],l[2],"==")):"<"===r||">"===r||"<="===r||">="===r?Ti(l[1],l[2],r):"any"===r?(a=l.slice(1),["any"].concat(a.map(ei))):"all"===r?["all"].concat(l.slice(1).map(ei)):"none"===r?["all"].concat(l.slice(1).map(ei).map(ms)):"in"===r?Ko(l[1],l.slice(2)):"!in"===r?ms(Ko(l[1],l.slice(2))):"has"===r?Eo(l[1]):"!has"!==r||ms(Eo(l[1]));var a}function Ti(l,r,a){switch(l){case"$type":return[`filter-type-${a}`,r];case"$id":return[`filter-id-${a}`,r];default:return[`filter-${a}`,l,r]}}function Ko(l,r){if(0===r.length)return!1;switch(l){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(a=>typeof a!=typeof r[0])?["filter-in-large",l,["literal",r.sort(Yt)]]:["filter-in-small",l,["literal",r]]}}function Eo(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function ms(l){return["!",l]}function Qo(l){const r=typeof l;if("number"===r||"boolean"===r||"string"===r||null==l)return JSON.stringify(l);if(Array.isArray(l)){let m="[";for(const y of l)m+=`${Qo(y)},`;return`${m}]`}const a=Object.keys(l).sort();let h="{";for(let m=0;m<a.length;m++)h+=`${JSON.stringify(a[m])}:${Qo(l[a[m]])},`;return`${h}}`}function sl(l){let r="";for(const a of Ke)r+=`/${Qo(l[a])}`;return r}function $c(l){const r=l.value;return r?[new Gt(l.key,r,"constants have been deprecated as of v8")]:[]}function ni(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function Zt(l){if(Array.isArray(l))return l.map(Zt);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const r={};for(const a in l)r[a]=Zt(l[a]);return r}return ni(l)}function An(l){const r=l.key,a=l.value,h=l.valueSpec||{},m=l.objectElementValidators||{},y=l.style,b=l.styleSpec,D=l.validateSpec;let S=[];const k=_i(a);if("object"!==k)return[new Gt(r,a,`object expected, ${k} found`)];for(const F in a){const $=F.split(".")[0],G=dr(h,$)||h["*"];let W;if(dr(m,$))W=m[$];else if(dr(h,$))W=D;else if(m["*"])W=m["*"];else{if(!h["*"]){S.push(new Gt(r,a[F],`unknown property "${F}"`));continue}W=D}S=S.concat(W({key:(r&&`${r}.`)+F,value:a[F],valueSpec:G,style:y,styleSpec:b,object:a,objectKey:F,validateSpec:D},a))}for(const F in h)m[F]||h[F].required&&void 0===h[F].default&&void 0===a[F]&&S.push(new Gt(r,a,`missing required property "${F}"`));return S}function vr(l){const r=l.value,a=l.valueSpec,h=l.style,m=l.styleSpec,y=l.key,b=l.arrayElementValidator||l.validateSpec;if("array"!==_i(r))return[new Gt(y,r,`array expected, ${_i(r)} found`)];if(a.length&&r.length!==a.length)return[new Gt(y,r,`array length ${a.length} expected, length ${r.length} found`)];if(a["min-length"]&&r.length<a["min-length"])return[new Gt(y,r,`array length at least ${a["min-length"]} expected, length ${r.length} found`)];let D={type:a.value,values:a.values};m.$version<7&&(D.function=a.function),"object"===_i(a.value)&&(D=a.value);let S=[];for(let k=0;k<r.length;k++)S=S.concat(b({array:r,arrayIndex:k,value:r[k],valueSpec:D,validateSpec:l.validateSpec,style:h,styleSpec:m,key:`${y}[${k}]`}));return S}function Br(l){const r=l.key,a=l.value,h=l.valueSpec;let m=_i(a);return"number"===m&&a!=a&&(m="NaN"),"number"!==m?[new Gt(r,a,`number expected, ${m} found`)]:"minimum"in h&&a<h.minimum?[new Gt(r,a,`${a} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&a>h.maximum?[new Gt(r,a,`${a} is greater than the maximum value ${h.maximum}`)]:[]}function Ni(l){const r=l.valueSpec,a=ni(l.value.type);let h,m,y,b={};const D="categorical"!==a&&void 0===l.value.property,S=!D,k="array"===_i(l.value.stops)&&"array"===_i(l.value.stops[0])&&"object"===_i(l.value.stops[0][0]),F=An({key:l.key,value:l.value,valueSpec:l.styleSpec.function,validateSpec:l.validateSpec,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(W){if("identity"===a)return[new Gt(W.key,W.value,'identity function may not have a "stops" property')];let X=[];const Q=W.value;return X=X.concat(vr({key:W.key,value:Q,valueSpec:W.valueSpec,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec,arrayElementValidator:$})),"array"===_i(Q)&&0===Q.length&&X.push(new Gt(W.key,Q,"array must have at least one stop")),X},default:function(W){return W.validateSpec({key:W.key,value:W.value,valueSpec:r,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec})}}});return"identity"===a&&D&&F.push(new Gt(l.key,l.value,'missing required property "property"')),"identity"===a||l.value.stops||F.push(new Gt(l.key,l.value,'missing required property "stops"')),"exponential"===a&&l.valueSpec.expression&&!vc(l.valueSpec)&&F.push(new Gt(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(S&&!ga(l.valueSpec)?F.push(new Gt(l.key,l.value,"property functions not supported")):D&&!xu(l.valueSpec)&&F.push(new Gt(l.key,l.value,"zoom functions not supported"))),"categorical"!==a&&!k||void 0!==l.value.property||F.push(new Gt(l.key,l.value,'"property" property is required')),F;function $(W){let X=[];const Q=W.value,re=W.key;if("array"!==_i(Q))return[new Gt(re,Q,`array expected, ${_i(Q)} found`)];if(2!==Q.length)return[new Gt(re,Q,`array length 2 expected, length ${Q.length} found`)];if(k){if("object"!==_i(Q[0]))return[new Gt(re,Q,`object expected, ${_i(Q[0])} found`)];if(void 0===Q[0].zoom)return[new Gt(re,Q,"object stop key must have zoom")];if(void 0===Q[0].value)return[new Gt(re,Q,"object stop key must have value")];if(y&&y>ni(Q[0].zoom))return[new Gt(re,Q[0].zoom,"stop zoom values must appear in ascending order")];ni(Q[0].zoom)!==y&&(y=ni(Q[0].zoom),m=void 0,b={}),X=X.concat(An({key:`${re}[0]`,value:Q[0],valueSpec:{zoom:{}},validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec,objectElementValidators:{zoom:Br,value:G}}))}else X=X.concat(G({key:`${re}[0]`,value:Q[0],validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec},Q));return wu(Zt(Q[1]))?X.concat([new Gt(`${re}[1]`,Q[1],"expressions are not allowed in function stops.")]):X.concat(W.validateSpec({key:`${re}[1]`,value:Q[1],valueSpec:r,validateSpec:W.validateSpec,style:W.style,styleSpec:W.styleSpec}))}function G(W,X){const Q=_i(W.value),re=ni(W.value),ye=null!==W.value?W.value:X;if(h){if(Q!==h)return[new Gt(W.key,ye,`${Q} stop domain type must match previous stop domain type ${h}`)]}else h=Q;if("number"!==Q&&"string"!==Q&&"boolean"!==Q)return[new Gt(W.key,ye,"stop domain value must be a number, string, or boolean")];if("number"!==Q&&"categorical"!==a){let Ae=`number expected, ${Q} found`;return ga(r)&&void 0===a&&(Ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Gt(W.key,ye,Ae)]}return"categorical"!==a||"number"!==Q||isFinite(re)&&Math.floor(re)===re?"categorical"!==a&&"number"===Q&&void 0!==m&&re<m?[new Gt(W.key,ye,"stop domain values must appear in ascending order")]:(m=re,"categorical"===a&&re in b?[new Gt(W.key,ye,"stop domain values must be unique")]:(b[re]=!0,[])):[new Gt(W.key,ye,`integer expected, found ${re}`)]}}function Vr(l){const r=("property"===l.expressionContext?C:Cu)(Zt(l.value),l.valueSpec);if("error"===r.result)return r.value.map(h=>new Gt(`${l.key}${h.key}`,l.value,h.message));const a=r.value.expression||r.value._styleExpression.expression;if("property"===l.expressionContext&&"text-font"===l.propertyKey&&!a.outputDefined())return[new Gt(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===l.expressionContext&&"layout"===l.propertyType&&!jc(a))return[new Gt(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===l.expressionContext&&!jc(a))return[new Gt(l.key,l.value,'"feature-state" data expressions are not supported with filters.')];if(l.expressionContext&&0===l.expressionContext.indexOf("cluster")){if(!Ks(a,["zoom","feature-state"]))return[new Gt(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===l.expressionContext&&!_c(a))return[new Gt(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Bl(l){const r=l.key,a=l.value,h=_i(a);return"string"!==h?[new Gt(r,a,`color expected, ${h} found`)]:oi.parse(String(a))?[]:[new Gt(r,a,`color expected, "${a}" found`)]}function Xi(l){const r=l.key,a=l.value,h=l.valueSpec,m=[];return Array.isArray(h.values)?-1===h.values.indexOf(ni(a))&&m.push(new Gt(r,a,`expected one of [${h.values.join(", ")}], ${JSON.stringify(a)} found`)):-1===Object.keys(h.values).indexOf(ni(a))&&m.push(new Gt(r,a,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(a)} found`)),m}function Ar(l){return qe(Zt(l.value))?Vr(Ci({},l,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Qs(l)}function Qs(l){const r=l.value,a=l.key;if("array"!==_i(r))return[new Gt(a,r,`array expected, ${_i(r)} found`)];const h=l.styleSpec;let m,y=[];if(r.length<1)return[new Gt(a,r,"filter array must have at least 1 element")];switch(y=y.concat(Xi({key:`${a}[0]`,value:r[0],valueSpec:h.filter_operator,style:l.style,styleSpec:l.styleSpec})),ni(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===ni(r[1])&&y.push(new Gt(a,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&y.push(new Gt(a,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(m=_i(r[1]),"string"!==m&&y.push(new Gt(`${a}[1]`,r[1],`string expected, ${m} found`)));for(let b=2;b<r.length;b++)m=_i(r[b]),"$type"===ni(r[1])?y=y.concat(Xi({key:`${a}[${b}]`,value:r[b],valueSpec:h.geometry_type,style:l.style,styleSpec:l.styleSpec})):"string"!==m&&"number"!==m&&"boolean"!==m&&y.push(new Gt(`${a}[${b}]`,r[b],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let b=1;b<r.length;b++)y=y.concat(Qs({key:`${a}[${b}]`,value:r[b],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":m=_i(r[1]),2!==r.length?y.push(new Gt(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==m&&y.push(new Gt(`${a}[1]`,r[1],`string expected, ${m} found`))}return y}function Kn(l,r){const a=l.key,h=l.validateSpec,m=l.style,y=l.styleSpec,b=l.value,D=l.objectKey,S=y[`${r}_${l.layerType}`];if(!S)return[];const k=D.match(/^(.*)-transition$/);if("paint"===r&&k&&S[k[1]]&&S[k[1]].transition)return h({key:a,value:b,valueSpec:y.transition,style:m,styleSpec:y});const F=l.valueSpec||S[D];if(!F)return[new Gt(a,b,`unknown property "${D}"`)];let $;if("string"===_i(b)&&ga(F)&&!F.tokens&&($=/^{([^}]+)}$/.exec(b)))return[new Gt(a,b,`"${D}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify($[1])} }\`.`)];const G=[];return"symbol"===l.layerType&&"text-font"===D&&Fl(Zt(b))&&"identity"===ni(b.type)&&G.push(new Gt(a,b,'"text-font" does not support identity functions')),G.concat(h({key:l.key,value:b,valueSpec:F,style:m,styleSpec:y,expressionContext:"property",propertyType:r,propertyKey:D}))}function al(l){return Kn(l,"paint")}function Gc(l){return Kn(l,"layout")}function Tu(l){let r=[];const a=l.value,h=l.key,m=l.style,y=l.styleSpec;if("object"!==_i(a))return[new Gt(h,a,`object expected, ${_i(a)} found`)];a.type||a.ref||r.push(new Gt(h,a,'either "type" or "ref" is required'));let b=ni(a.type);const D=ni(a.ref);if(a.id){const S=ni(a.id);for(let k=0;k<l.arrayIndex;k++){const F=m.layers[k];ni(F.id)===S&&r.push(new Gt(h,a.id,`duplicate layer id "${a.id}", previously used at line ${F.id.__line__}`))}}if("ref"in a){let S;["type","source","source-layer","filter","layout"].forEach(k=>{k in a&&r.push(new Gt(h,a[k],`"${k}" is prohibited for ref layers`))}),m.layers.forEach(k=>{ni(k.id)===D&&(S=k)}),S?S.ref?r.push(new Gt(h,a.ref,"ref cannot reference another ref layer")):b=ni(S.type):r.push(new Gt(h,a.ref,`ref layer "${D}" not found`))}else if("background"!==b)if(a.source){const S=m.sources&&m.sources[a.source],k=S&&ni(S.type);S?"vector"===k&&"raster"===b?r.push(new Gt(h,a.source,`layer "${a.id}" requires a raster source`)):"raster-dem"!==k&&"hillshade"===b||"raster-dem"!==k&&"color-relief"===b?r.push(new Gt(h,a.source,`layer "${a.id}" requires a raster-dem source`)):"raster"===k&&"raster"!==b?r.push(new Gt(h,a.source,`layer "${a.id}" requires a vector source`)):"vector"!==k||a["source-layer"]?"raster-dem"===k&&"hillshade"!==b&&"color-relief"!==b?r.push(new Gt(h,a.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):"line"!==b||!a.paint||!a.paint["line-gradient"]||"geojson"===k&&S.lineMetrics||r.push(new Gt(h,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new Gt(h,a,`layer "${a.id}" must specify a "source-layer"`)):r.push(new Gt(h,a.source,`source "${a.source}" not found`))}else r.push(new Gt(h,a,'missing required property "source"'));return r=r.concat(An({key:h,value:a,valueSpec:y.layer,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,objectElementValidators:{"*":()=>[],type:()=>l.validateSpec({key:`${h}.type`,value:a.type,valueSpec:y.layer.type,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,object:a,objectKey:"type"}),filter:Ar,layout:S=>An({layer:a,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":k=>Gc(Ci({layerType:b},k))}}),paint:S=>An({layer:a,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":k=>al(Ci({layerType:b},k))}})}})),r}function or(l){const r=l.value,a=l.key,h=_i(r);return"string"!==h?[new Gt(a,r,`string expected, ${h} found`)]:[]}const xc={promoteId:function({key:l,value:r}){if("string"===_i(r))return or({key:l,value:r});{const a=[];for(const h in r)a.push(...or({key:`${l}.${h}`,value:r[h]}));return a}}};function Du(l){const r=l.value,a=l.key,h=l.styleSpec,m=l.style,y=l.validateSpec;if(!r.type)return[new Gt(a,r,'"type" is required')];const b=ni(r.type);let D;switch(b){case"vector":case"raster":return D=An({key:a,value:r,valueSpec:h[`source_${b.replace("-","_")}`],style:l.style,styleSpec:h,objectElementValidators:xc,validateSpec:y}),D;case"raster-dem":return D=function(S){var k;const F=null!==(k=S.sourceName)&&void 0!==k?k:"",$=S.value,G=S.styleSpec,W=G.source_raster_dem,X=S.style;let Q=[];const re=_i($);if(void 0===$)return Q;if("object"!==re)return Q.push(new Gt("source_raster_dem",$,`object expected, ${re} found`)),Q;const ye="custom"===ni($.encoding),Ae=["redFactor","greenFactor","blueFactor","baseShift"],Ce=S.value.encoding?`"${S.value.encoding}"`:"Default";for(const Me in $)!ye&&Ae.includes(Me)?Q.push(new Gt(Me,$[Me],`In "${F}": "${Me}" is only valid when "encoding" is set to "custom". ${Ce} encoding found`)):W[Me]?Q=Q.concat(S.validateSpec({key:Me,value:$[Me],valueSpec:W[Me],validateSpec:S.validateSpec,style:X,styleSpec:G})):Q.push(new Gt(Me,$[Me],`unknown property "${Me}"`));return Q}({sourceName:a,value:r,style:l.style,styleSpec:h,validateSpec:y}),D;case"geojson":if(D=An({key:a,value:r,valueSpec:h.source_geojson,style:m,styleSpec:h,validateSpec:y,objectElementValidators:xc}),r.cluster)for(const S in r.clusterProperties){const[k,F]=r.clusterProperties[S],$="string"==typeof k?[k,["accumulated"],["get",S]]:k;D.push(...Vr({key:`${a}.${S}.map`,value:F,expressionContext:"cluster-map"})),D.push(...Vr({key:`${a}.${S}.reduce`,value:$,expressionContext:"cluster-reduce"}))}return D;case"video":return An({key:a,value:r,valueSpec:h.source_video,style:m,validateSpec:y,styleSpec:h});case"image":return An({key:a,value:r,valueSpec:h.source_image,style:m,validateSpec:y,styleSpec:h});case"canvas":return[new Gt(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Xi({key:`${a}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function ll(l){const r=l.value,a=l.styleSpec,h=a.light,m=l.style;let y=[];const b=_i(r);if(void 0===r)return y;if("object"!==b)return y=y.concat([new Gt("light",r,`object expected, ${b} found`)]),y;for(const D in r){const S=D.match(/^(.*)-transition$/);y=y.concat(S&&h[S[1]]&&h[S[1]].transition?l.validateSpec({key:D,value:r[D],valueSpec:a.transition,validateSpec:l.validateSpec,style:m,styleSpec:a}):h[D]?l.validateSpec({key:D,value:r[D],valueSpec:h[D],validateSpec:l.validateSpec,style:m,styleSpec:a}):[new Gt(D,r[D],`unknown property "${D}"`)])}return y}function Mu(l){const r=l.value,a=l.styleSpec,h=a.sky,m=l.style,y=_i(r);if(void 0===r)return[];if("object"!==y)return[new Gt("sky",r,`object expected, ${y} found`)];let b=[];for(const D in r)b=b.concat(h[D]?l.validateSpec({key:D,value:r[D],valueSpec:h[D],style:m,styleSpec:a}):[new Gt(D,r[D],`unknown property "${D}"`)]);return b}function Eu(l){const r=l.value,a=l.styleSpec,h=a.terrain,m=l.style;let y=[];const b=_i(r);if(void 0===r)return y;if("object"!==b)return y=y.concat([new Gt("terrain",r,`object expected, ${b} found`)]),y;for(const D in r)y=y.concat(h[D]?l.validateSpec({key:D,value:r[D],valueSpec:h[D],validateSpec:l.validateSpec,style:m,styleSpec:a}):[new Gt(D,r[D],`unknown property "${D}"`)]);return y}function wc(l){let r=[];const a=l.value,h=l.key;if(Array.isArray(a)){const m=[],y=[];for(const b in a)a[b].id&&m.includes(a[b].id)&&r.push(new Gt(h,a,`all the sprites' ids must be unique, but ${a[b].id} is duplicated`)),m.push(a[b].id),a[b].url&&y.includes(a[b].url)&&r.push(new Gt(h,a,`all the sprites' URLs must be unique, but ${a[b].url} is duplicated`)),y.push(a[b].url),r=r.concat(An({key:`${h}[${b}]`,value:a[b],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:l.validateSpec}));return r}return or({key:h,value:a})}function _d(l){return(r=l.value)&&r.constructor===Object?[]:[new Gt(l.key,l.value,`object expected, ${_i(l.value)} found`)];var r}const Hc={"*":()=>[],array:vr,boolean:function(l){const r=l.value,a=l.key,h=_i(r);return"boolean"!==h?[new Gt(a,r,`boolean expected, ${h} found`)]:[]},number:Br,color:Bl,constants:$c,enum:Xi,filter:Ar,function:Ni,layer:Tu,object:An,source:Du,light:ll,sky:Mu,terrain:Eu,projection:function(l){const r=l.value,a=l.styleSpec,h=a.projection,m=l.style,y=_i(r);if(void 0===r)return[];if("object"!==y)return[new Gt("projection",r,`object expected, ${y} found`)];let b=[];for(const D in r)b=b.concat(h[D]?l.validateSpec({key:D,value:r[D],valueSpec:h[D],style:m,styleSpec:a}):[new Gt(D,r[D],`unknown property "${D}"`)]);return b},projectionDefinition:function(l){const r=l.key;let a=l.value;a=a instanceof String?a.valueOf():a;const h=_i(a);return"array"!==h||(m=a,Array.isArray(m)&&3===m.length&&"string"==typeof m[0]&&"string"==typeof m[1]&&"number"==typeof m[2])||function(m){return!!["interpolate","step","literal"].includes(m[0])}(a)?["array","string"].includes(h)?[]:[new Gt(r,a,`projection expected, invalid type "${h}" found`)]:[new Gt(r,a,`projection expected, invalid array ${JSON.stringify(a)} found`)];var m},string:or,formatted:function(l){return 0===or(l).length?[]:Vr(l)},resolvedImage:function(l){return 0===or(l).length?[]:Vr(l)},padding:function(l){const r=l.key,a=l.value;if("array"===_i(a)){if(a.length<1||a.length>4)return[new Gt(r,a,`padding requires 1 to 4 values; ${a.length} values found`)];const h={type:"number"};let m=[];for(let y=0;y<a.length;y++)m=m.concat(l.validateSpec({key:`${r}[${y}]`,value:a[y],validateSpec:l.validateSpec,valueSpec:h}));return m}return Br({key:r,value:a,valueSpec:{}})},numberArray:function(l){const r=l.key,a=l.value;if("array"===_i(a)){const h={type:"number"};if(a.length<1)return[new Gt(r,a,"array length at least 1 expected, length 0 found")];let m=[];for(let y=0;y<a.length;y++)m=m.concat(l.validateSpec({key:`${r}[${y}]`,value:a[y],validateSpec:l.validateSpec,valueSpec:h}));return m}return Br({key:r,value:a,valueSpec:{}})},colorArray:function(l){const r=l.key,a=l.value;if("array"===_i(a)){if(a.length<1)return[new Gt(r,a,"array length at least 1 expected, length 0 found")];let h=[];for(let m=0;m<a.length;m++)h=h.concat(Bl({key:`${r}[${m}]`,value:a[m]}));return h}return Bl({key:r,value:a})},variableAnchorOffsetCollection:function(l){const r=l.key,a=l.value,h=_i(a),m=l.styleSpec;if("array"!==h||a.length<1||a.length%2!=0)return[new Gt(r,a,"variableAnchorOffsetCollection requires a non-empty array of even length")];let y=[];for(let b=0;b<a.length;b+=2)y=y.concat(Xi({key:`${r}[${b}]`,value:a[b],valueSpec:m.layout_symbol["text-anchor"]})),y=y.concat(vr({key:`${r}[${b+1}]`,value:a[b+1],valueSpec:{length:2,value:"number"},validateSpec:l.validateSpec,style:l.style,styleSpec:m}));return y},sprite:wc,state:_d};function Ps(l){const r=l.value,a=l.valueSpec,h=l.styleSpec;return l.validateSpec=Ps,a.expression&&Fl(ni(r))?Ni(l):a.expression&&wu(Zt(r))?Vr(l):a.type&&Hc[a.type]?Hc[a.type](l):An(Ci({},l,{valueSpec:a.type?h[a.type]:a}))}function Su(l){const r=l.value,a=l.key,h=or(l);return h.length||(-1===r.indexOf("{fontstack}")&&h.push(new Gt(a,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&h.push(new Gt(a,r,'"glyphs" url must include a "{range}" token'))),h}function bn(l,r=xe){let a=[];return a=a.concat(Ps({key:"",value:l,valueSpec:r.$root,styleSpec:r,style:l,validateSpec:Ps,objectElementValidators:{glyphs:Su,"*":()=>[]}})),l.constants&&(a=a.concat($c({key:"constants",value:l.constants}))),As(a)}function gs(l){return function(r){return l(Object.assign({},r,{validateSpec:Ps}))}}function As(l){return[].concat(l).sort((r,a)=>r.line-a.line)}function nr(l){return function(...r){return As(l.apply(this,r))}}bn.source=nr(gs(Du)),bn.sprite=nr(gs(wc)),bn.glyphs=nr(gs(Su)),bn.light=nr(gs(ll)),bn.sky=nr(gs(Mu)),bn.terrain=nr(gs(Eu)),bn.state=nr(gs(_d)),bn.layer=nr(gs(Tu)),bn.filter=nr(gs(Ar)),bn.paintProperty=nr(gs(al)),bn.layoutProperty=nr(gs(Gc));const Zc=xe,za=bn,Yr=za.light,vo=za.sky,io=za.paintProperty,cf=za.layoutProperty;function _a(l,r){let a=!1;if(r&&r.length)for(const h of r)l.fire(new Ve(new Error(h.message))),a=!0;return a}class qc{constructor(r,a,h){const m=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;const b=new Int32Array(this.arrayBuffer);r=b[0],this.d=(a=b[1])+2*(h=b[2]);for(let S=0;S<this.d*this.d;S++){const k=b[3+S],F=b[3+S+1];m.push(k===F?null:b.subarray(k,F))}const D=b[3+m.length+1];this.keys=b.subarray(b[3+m.length],D),this.bboxes=b.subarray(D),this.insert=this._insertReadonly}else{this.d=a+2*h;for(let b=0;b<this.d*this.d;b++)m.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=r,this.padding=h,this.scale=a/r,this.uid=0;const y=h/a*r;this.min=-y,this.max=r+y}insert(r,a,h,m,y){this._forEachCell(a,h,m,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(r),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(r,a,h,m,y,b){this.cells[y].push(b)}query(r,a,h,m,y){const b=this.min,D=this.max;if(r<=b&&a<=b&&D<=h&&D<=m&&!y)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(r,a,h,m,this._queryCell,S,{},y),S}}_queryCell(r,a,h,m,y,b,D,S){const k=this.cells[y];if(null!==k){const F=this.keys,$=this.bboxes;for(let G=0;G<k.length;G++){const W=k[G];if(void 0===D[W]){const X=4*W;(S?S($[X+0],$[X+1],$[X+2],$[X+3]):r<=$[X+2]&&a<=$[X+3]&&h>=$[X+0]&&m>=$[X+1])?(D[W]=!0,b.push(F[W])):D[W]=!1}}}}_forEachCell(r,a,h,m,y,b,D,S){const k=this._convertToCellCoord(r),F=this._convertToCellCoord(a),$=this._convertToCellCoord(h),G=this._convertToCellCoord(m);for(let W=k;W<=$;W++)for(let X=F;X<=G;X++){const Q=this.d*X+W;if((!S||S(this._convertFromCellCoord(W),this._convertFromCellCoord(X),this._convertFromCellCoord(W+1),this._convertFromCellCoord(X+1)))&&y.call(this,r,a,h,m,Q,b,D,S))return}}_convertFromCellCoord(r){return(r-this.padding)/this.scale}_convertToCellCoord(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const r=this.cells,a=3+this.cells.length+1+1;let h=0;for(let b=0;b<this.cells.length;b++)h+=this.cells[b].length;const m=new Int32Array(a+h+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;let y=a;for(let b=0;b<r.length;b++){const D=r[b];m[3+b]=y,m.set(D,y),y+=D.length}return m[3+r.length]=y,m.set(this.keys,y),y+=this.keys.length,m[3+r.length+1]=y,m.set(this.bboxes,y),y+=this.bboxes.length,m.buffer}static serialize(r,a){const h=r.toArrayBuffer();return a&&a.push(h),{buffer:h}}static deserialize(r){return new qc(r.buffer)}}const ro={};function hn(l,r,a={}){if(ro[l])throw new Error(`${l} is already registered.`);Object.defineProperty(r,"_classRegistryKey",{value:l,writeable:!1}),ro[l]={klass:r,omit:a.omit||[],shallow:a.shallow||[]}}hn("Object",Object),hn("Set",Set),hn("TransferableGridIndex",qc),hn("Color",oi),hn("Error",Error),hn("AJAXError",qi),hn("ResolvedImage",ls),hn("StylePropertyFunction",P),hn("StyleExpression",ol,{omit:["_evaluator"]}),hn("ZoomDependentExpression",f),hn("ZoomConstantExpression",bc),hn("CompoundExpression",fs,{omit:["_evaluate"]});for(const l in Vc)Vc[l]._classRegistryKey||hn(`Expression_${l}`,Vc[l]);function Iu(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&"ArrayBuffer"===l.constructor.name)}function Ep(l){return l.$name||l.constructor._classRegistryKey}function Vl(l){return!function(r){if(null===r||"object"!=typeof r)return!1;const a=Ep(r);return!(!a||"Object"===a)}(l)&&(null==l||"boolean"==typeof l||"number"==typeof l||"string"==typeof l||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob||l instanceof Error||Iu(l)||ke(l)||ArrayBuffer.isView(l)||l instanceof ImageData)}function _h(l,r){if(Vl(l))return(Iu(l)||ke(l))&&r&&r.push(l),ArrayBuffer.isView(l)&&r&&r.push(l.buffer),l instanceof ImageData&&r&&r.push(l.data.buffer),l;if(Array.isArray(l)){const y=[];for(const b of l)y.push(_h(b,r));return y}if("object"!=typeof l)throw new Error("can't serialize object of type "+typeof l);const a=Ep(l);if(!a)throw new Error(`can't serialize object of unregistered class ${l.constructor.name}`);if(!ro[a])throw new Error(`${a} is not registered.`);const{klass:h}=ro[a],m=h.serialize?h.serialize(l,r):{};if(h.serialize){if(r&&m===r[r.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const y in l){if(!l.hasOwnProperty(y)||ro[a].omit.indexOf(y)>=0)continue;const b=l[y];m[y]=ro[a].shallow.indexOf(y)>=0?b:_h(b,r)}l instanceof Error&&(m.message=l.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==a&&(m.$name=a),m}function Cc(l){if(Vl(l))return l;if(Array.isArray(l))return l.map(Cc);if("object"!=typeof l)throw new Error("can't deserialize object of type "+typeof l);const r=Ep(l)||"Object";if(!ro[r])throw new Error(`can't deserialize unregistered class ${r}`);const{klass:a}=ro[r];if(!a)throw new Error(`can't deserialize unregistered class ${r}`);if(a.deserialize)return a.deserialize(l);const h=Object.create(a.prototype);for(const m of Object.keys(l)){if("$name"===m)continue;const y=l[m];h[m]=ro[r].shallow.indexOf(m)>=0?y:Cc(y)}return h}class yh{constructor(){this.first=!0}update(r,a){const h=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=a),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=h,!0))}}function W0(l){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(l))}function yd(l){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(l))}function oy(l){return/\s/u.test(String.fromCodePoint(l))}function uf(l){for(const r of l)if(yd(r.codePointAt(0)))return!0;return!1}function Sp(l){for(const r of l)if(!sy(r.codePointAt(0)))return!1;return!0}function rg(l){const r=l.map(a=>{try{return new RegExp(`\\p{sc=${a}}`,"u").source}catch{return null}}).filter(a=>a);return new RegExp(r.join("|"),"u")}const Ip=rg(["Arab","Dupl","Mong","Ougr","Syrc"]);function sy(l){return!Ip.test(String.fromCodePoint(l))}function og(l){return!(yd(l)||(r=l,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(r))));var r}const sg=rg(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function ag(l){return sg.test(String.fromCodePoint(l))}function lg(l,r){return!(!r&&ag(l)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(l)))}function Pp(l){for(const r of l)if(ag(r.codePointAt(0)))return!0;return!1}const Pu=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(l){this.pluginStatus=l.pluginStatus,this.pluginURL=l.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(l){if(Pu.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=l.applyArabicShaping,this.processBidirectionalText=l.processBidirectionalText,this.processStyledBidirectionalText=l.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return null!=this.applyArabicShaping&&null!=this.processBidirectionalText&&null!=this.processStyledBidirectionalText}getRTLTextPluginStatus(){return this.pluginStatus}syncState(l,r){return p(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if("loading"!==l.pluginStatus)return this.setState(l),l;const a=l.pluginURL,h=new Promise(y=>{this.loadScriptResolve=y});r(a);const m=new Promise(y=>setTimeout(()=>y(),this.TIMEOUT));if(yield Promise.race([h,m]),this.isParsed()){const y={pluginStatus:"loaded",pluginURL:a};return this.setState(y),y}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${a}`)})}};class Dr{constructor(r,a){this.isSupportedScript=Y0,this.zoom=r,a?(this.now=a.now||0,this.fadeDuration=a.fadeDuration||0,this.zoomHistory=a.zoomHistory||new yh,this.transition=a.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new yh,this.transition={})}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,a=r-Math.floor(r),h=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*a}}}function Y0(l){return function(r,a){for(const h of r)if(!lg(h.codePointAt(0),a))return!1;return!0}(l,"loaded"===Pu.getRTLTextPluginStatus())}const vd="-transition";class vh{constructor(r,a,h){this.property=r,this.value=a,this.expression=function(m,y,b){if(Fl(m))return new P(m,y);if(wu(m)){const D=C(m,y,b);if("error"===D.result)throw new Error(D.value.map(S=>`${S.key}: ${S.message}`).join(", "));return D.value}{let D=m;return"color"===y.type&&"string"==typeof m?D=oi.parse(m):"padding"!==y.type||"number"!=typeof m&&!Array.isArray(m)?"numberArray"!==y.type||"number"!=typeof m&&!Array.isArray(m)?"colorArray"!==y.type||"string"!=typeof m&&!Array.isArray(m)?"variableAnchorOffsetCollection"===y.type&&Array.isArray(m)?D=as.parse(m):"projectionDefinition"===y.type&&"string"==typeof m&&(D=$o.parse(m)):D=$n.parse(m):D=ss.parse(m):D=So.parse(m),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>D}}}(void 0===a?r.specification.default:a,r.specification,h)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(r,a,h){return this.property.possiblyEvaluate(this,r,a,h)}}class Js{constructor(r,a){this.property=r,this.value=new vh(r,void 0,a)}transitioned(r,a){return new kp(this.property,this.value,a,Zn({},r.transition,this.transition),r.now)}untransitioned(){return new kp(this.property,this.value,null,{},0)}}class Ap{constructor(r,a){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues),this._globalState=a}getValue(r){return pr(this._values[r].value.value)}setValue(r,a){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new Js(this._values[r].property,this._globalState)),this._values[r].value=new vh(this._values[r].property,null===a?void 0:pr(a),this._globalState)}getTransition(r){return pr(this._values[r].transition)}setTransition(r,a){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new Js(this._values[r].property,this._globalState)),this._values[r].transition=pr(a)||void 0}serialize(){const r={};for(const a of Object.keys(this._values)){const h=this.getValue(a);void 0!==h&&(r[a]=h);const m=this.getTransition(a);void 0!==m&&(r[`${a}${vd}`]=m)}return r}transitioned(r,a){const h=new Rp(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].transitioned(r,a._values[m]);return h}untransitioned(){const r=new Rp(this._properties);for(const a of Object.keys(this._values))r._values[a]=this._values[a].untransitioned();return r}}class kp{constructor(r,a,h,m,y){this.property=r,this.value=a,this.begin=y+m.delay||0,this.end=this.begin+m.duration||0,r.specification.transition&&(m.delay||m.duration)&&(this.prior=h)}possiblyEvaluate(r,a,h){const m=r.now||0,y=this.value.possiblyEvaluate(r,a,h),b=this.prior;if(b){if(m>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(m<this.begin)return b.possiblyEvaluate(r,a,h);{const D=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(r,a,h),y,Sn(D))}}return y}}class Rp{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,a,h){const m=new Au(this._properties);for(const y of Object.keys(this._values))m._values[y]=this._values[y].possiblyEvaluate(r,a,h);return m}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Lp{constructor(r,a){this._properties=r,this._values=Object.create(r.defaultPropertyValues),this._globalState=a}hasValue(r){return void 0!==this._values[r].value}getValue(r){return pr(this._values[r].value)}setValue(r,a){this._values[r]=new vh(this._values[r].property,null===a?void 0:pr(a),this._globalState)}serialize(){const r={};for(const a of Object.keys(this._values)){const h=this.getValue(a);void 0!==h&&(r[a]=h)}return r}possiblyEvaluate(r,a,h){const m=new Au(this._properties);for(const y of Object.keys(this._values))m._values[y]=this._values[y].possiblyEvaluate(r,a,h);return m}}class Ba{constructor(r,a,h){this.property=r,this.value=a,this.parameters=h}isConstant(){return"constant"===this.value.kind}constantOr(r){return"constant"===this.value.kind?this.value.value:r}evaluate(r,a,h,m){return this.property.evaluate(this.value,this.parameters,r,a,h,m)}}class Au{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class In{constructor(r){this.specification=r}possiblyEvaluate(r,a){if(r.isDataDriven())throw new Error("Value should not be data driven");return r.expression.evaluate(a)}interpolate(r,a,h){const m=_o[this.specification.type];return m?m(r,a,h):r}}class Wn{constructor(r,a){this.specification=r,this.overrides=a}possiblyEvaluate(r,a,h,m){return new Ba(this,"constant"===r.expression.kind||"camera"===r.expression.kind?{kind:"constant",value:r.expression.evaluate(a,null,{},h,m)}:r.expression,a)}interpolate(r,a,h){if("constant"!==r.value.kind||"constant"!==a.value.kind)return r;if(void 0===r.value.value||void 0===a.value.value)return new Ba(this,{kind:"constant",value:void 0},r.parameters);const m=_o[this.specification.type];if(m){const y=m(r.value.value,a.value.value,h);return new Ba(this,{kind:"constant",value:y},r.parameters)}return r}evaluate(r,a,h,m,y,b){return"constant"===r.kind?r.value:r.evaluate(a,h,m,y,b)}}class Ji extends Wn{possiblyEvaluate(r,a,h,m){if(void 0===r.value)return new Ba(this,{kind:"constant",value:void 0},a);if("constant"===r.expression.kind){const y=r.expression.evaluate(a,null,{},h,m),b="resolvedImage"===r.property.specification.type&&"string"!=typeof y?y.name:y,D=this._calculate(b,b,b,a);return new Ba(this,{kind:"constant",value:D},a)}if("camera"===r.expression.kind){const y=this._calculate(r.expression.evaluate({zoom:a.zoom-1}),r.expression.evaluate({zoom:a.zoom}),r.expression.evaluate({zoom:a.zoom+1}),a);return new Ba(this,{kind:"constant",value:y},a)}return new Ba(this,r.expression,a)}evaluate(r,a,h,m,y,b){if("source"===r.kind){const D=r.evaluate(a,h,m,y,b);return this._calculate(D,D,D,a)}return"composite"===r.kind?this._calculate(r.evaluate({zoom:Math.floor(a.zoom)-1},h,m),r.evaluate({zoom:Math.floor(a.zoom)},h,m),r.evaluate({zoom:Math.floor(a.zoom)+1},h,m),a):r.value}_calculate(r,a,h,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:r,to:a}:{from:h,to:a}}interpolate(r){return r}}class Op{constructor(r){this.specification=r}possiblyEvaluate(r,a,h,m){if(void 0!==r.value){if("constant"===r.expression.kind){const y=r.expression.evaluate(a,null,{},h,m);return this._calculate(y,y,y,a)}return this._calculate(r.expression.evaluate(new Dr(Math.floor(a.zoom-1),a)),r.expression.evaluate(new Dr(Math.floor(a.zoom),a)),r.expression.evaluate(new Dr(Math.floor(a.zoom+1),a)),a)}}_calculate(r,a,h,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:r,to:a}:{from:h,to:a}}interpolate(r){return r}}class bh{constructor(r){this.specification=r}possiblyEvaluate(r,a,h,m){return!!r.expression.evaluate(a,null,{},h,m)}interpolate(){return!1}}class gi{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const a in r){const h=r[a];h.specification.overridable&&this.overridableProperties.push(a);const m=this.defaultPropertyValues[a]=new vh(h,void 0,void 0),y=this.defaultTransitionablePropertyValues[a]=new Js(h,void 0);this.defaultTransitioningPropertyValues[a]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=m.possiblyEvaluate({})}}}hn("DataDrivenProperty",Wn),hn("DataConstantProperty",In),hn("CrossFadedDataDrivenProperty",Ji),hn("CrossFadedProperty",Op),hn("ColorRampProperty",bh);class ya extends rt{constructor(r,a,h){if(super(),this.id=r.id,this.type=r.type,this._globalState=h,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},"custom"!==r.type&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,"background"!==r.type&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter,this._featureFilter=wt(r.filter,h)),a.layout&&(this._unevaluatedLayout=new Lp(a.layout,h)),a.paint)){this._transitionablePaint=new Ap(a.paint,h);for(const m in r.paint)this.setPaintProperty(m,r.paint[m],{validate:!1});for(const m in r.layout)this.setLayoutProperty(m,r.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Au(a.paint)}}setFilter(r){this.filter=r,this._featureFilter=wt(r,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return"visibility"===r?this.visibility:this._unevaluatedLayout.getValue(r)}getLayoutAffectingGlobalStateRefs(){const r=new Set;if(this._unevaluatedLayout)for(const a in this._unevaluatedLayout._values){const h=this._unevaluatedLayout._values[a];for(const m of h.getGlobalStateRefs())r.add(m)}for(const a of this._featureFilter.getGlobalStateRefs())r.add(a);return r}getPaintAffectingGlobalStateRefs(){var r;const a=new globalThis.Map;if(this._transitionablePaint)for(const h in this._transitionablePaint._values){const m=this._transitionablePaint._values[h].value;for(const y of m.getGlobalStateRefs()){const b=null!==(r=a.get(y))&&void 0!==r?r:[];b.push({name:h,value:m.value}),a.set(y,b)}}return a}setLayoutProperty(r,a,h={}){null!=a&&this._validate(cf,`layers.${this.id}.layout.${r}`,r,a,h)||("visibility"!==r?this._unevaluatedLayout.setValue(r,a):this.visibility=a)}getPaintProperty(r){return r.endsWith(vd)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,a,h={}){if(null!=a&&this._validate(io,`layers.${this.id}.paint.${r}`,r,a,h))return!1;if(r.endsWith(vd))return this._transitionablePaint.setTransition(r.slice(0,-11),a||void 0),!1;{const m=this._transitionablePaint._values[r],y="cross-faded-data-driven"===m.property.specification["property-type"],b=m.value.isDataDriven(),D=m.value;this._transitionablePaint.setValue(r,a),this._handleSpecialPaintPropertyUpdate(r);const S=this._transitionablePaint._values[r].value;return S.isDataDriven()||b||y||this._handleOverridablePaintPropertyUpdate(r,D,S)}}_handleSpecialPaintPropertyUpdate(r){}_handleOverridablePaintPropertyUpdate(r,a,h){return!1}isHidden(r,a=!1){return!!(this.minzoom&&r<(a?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&r>=this.maxzoom)||"none"===this.visibility}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,a){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,a)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),tr(r,(a,h)=>!(void 0===a||"layout"===h&&!Object.keys(a).length||"paint"===h&&!Object.keys(a).length))}_validate(r,a,h,m,y={}){return(!y||!1!==y.validate)&&_a(this,r.call(za,{key:a,layerType:this.type,objectKey:h,value:m,styleSpec:xe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const a=this.paint.get(r);if(a instanceof Ba&&ga(a.property.specification)&&("source"===a.value.kind||"composite"===a.value.kind)&&a.value.isStateDependent)return!0}return!1}}let ku;var ea={get paint(){return ku=ku||new gi({"raster-opacity":new In(xe.paint_raster["raster-opacity"]),"raster-hue-rotate":new In(xe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new In(xe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new In(xe.paint_raster["raster-brightness-max"]),"raster-saturation":new In(xe.paint_raster["raster-saturation"]),"raster-contrast":new In(xe.paint_raster["raster-contrast"]),"raster-resampling":new In(xe.paint_raster["raster-resampling"]),"raster-fade-duration":new In(xe.paint_raster["raster-fade-duration"])})}};class ay extends ya{constructor(r,a){super(r,ea,a)}}const Ru={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class cl{constructor(r,a){this._structArray=r,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class sr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,a){return r._trim(),a&&(r.isTransferred=!0,a.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const a=Object.create(this.prototype);return a.arrayBuffer=r.arrayBuffer,a.length=r.length,a.capacity=r.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ki(l,r=1){let a=0,h=0;return{members:l.map(m=>{const y=Ru[m.type].BYTES_PER_ELEMENT,b=a=cg(a,Math.max(r,y)),D=m.components||1;return h=Math.max(h,y),a+=y*D,{name:m.name,type:m.type,components:D,offset:b}}),size:cg(a,Math.max(h,r)),alignment:r}}function cg(l,r){return Math.ceil(l/r)*r}class Lu extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a){const h=this.length;return this.resize(h+1),this.emplace(h,r,a)}emplace(r,a,h){const m=2*r;return this.int16[m+0]=a,this.int16[m+1]=h,r}}Lu.prototype.bytesPerElement=4,hn("StructArrayLayout2i4",Lu);class bd extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,a,h)}emplace(r,a,h,m){const y=3*r;return this.int16[y+0]=a,this.int16[y+1]=h,this.int16[y+2]=m,r}}bd.prototype.bytesPerElement=6,hn("StructArrayLayout3i6",bd);class va extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,h,m){const y=this.length;return this.resize(y+1),this.emplace(y,r,a,h,m)}emplace(r,a,h,m,y){const b=4*r;return this.int16[b+0]=a,this.int16[b+1]=h,this.int16[b+2]=m,this.int16[b+3]=y,r}}va.prototype.bytesPerElement=8,hn("StructArrayLayout4i8",va);class hf extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,h,m,y,b){const D=this.length;return this.resize(D+1),this.emplace(D,r,a,h,m,y,b)}emplace(r,a,h,m,y,b,D){const S=6*r;return this.int16[S+0]=a,this.int16[S+1]=h,this.int16[S+2]=m,this.int16[S+3]=y,this.int16[S+4]=b,this.int16[S+5]=D,r}}hf.prototype.bytesPerElement=12,hn("StructArrayLayout2i4i12",hf);class ul extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,h,m,y,b){const D=this.length;return this.resize(D+1),this.emplace(D,r,a,h,m,y,b)}emplace(r,a,h,m,y,b,D){const S=4*r,k=8*r;return this.int16[S+0]=a,this.int16[S+1]=h,this.uint8[k+4]=m,this.uint8[k+5]=y,this.uint8[k+6]=b,this.uint8[k+7]=D,r}}ul.prototype.bytesPerElement=8,hn("StructArrayLayout2i4ub8",ul);class Ou extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a){const h=this.length;return this.resize(h+1),this.emplace(h,r,a)}emplace(r,a,h){const m=2*r;return this.float32[m+0]=a,this.float32[m+1]=h,r}}Ou.prototype.bytesPerElement=8,hn("StructArrayLayout2f8",Ou);class Tc extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,h,m,y,b,D,S,k,F){const $=this.length;return this.resize($+1),this.emplace($,r,a,h,m,y,b,D,S,k,F)}emplace(r,a,h,m,y,b,D,S,k,F,$){const G=10*r;return this.uint16[G+0]=a,this.uint16[G+1]=h,this.uint16[G+2]=m,this.uint16[G+3]=y,this.uint16[G+4]=b,this.uint16[G+5]=D,this.uint16[G+6]=S,this.uint16[G+7]=k,this.uint16[G+8]=F,this.uint16[G+9]=$,r}}Tc.prototype.bytesPerElement=20,hn("StructArrayLayout10ui20",Tc);class xh extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,h,m,y,b,D,S){const k=this.length;return this.resize(k+1),this.emplace(k,r,a,h,m,y,b,D,S)}emplace(r,a,h,m,y,b,D,S,k){const F=8*r;return this.uint16[F+0]=a,this.uint16[F+1]=h,this.uint16[F+2]=m,this.uint16[F+3]=y,this.uint16[F+4]=b,this.uint16[F+5]=D,this.uint16[F+6]=S,this.uint16[F+7]=k,r}}xh.prototype.bytesPerElement=16,hn("StructArrayLayout8ui16",xh);class jl extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,h,m,y,b,D,S,k,F,$,G){const W=this.length;return this.resize(W+1),this.emplace(W,r,a,h,m,y,b,D,S,k,F,$,G)}emplace(r,a,h,m,y,b,D,S,k,F,$,G,W){const X=12*r;return this.int16[X+0]=a,this.int16[X+1]=h,this.int16[X+2]=m,this.int16[X+3]=y,this.uint16[X+4]=b,this.uint16[X+5]=D,this.uint16[X+6]=S,this.uint16[X+7]=k,this.int16[X+8]=F,this.int16[X+9]=$,this.int16[X+10]=G,this.int16[X+11]=W,r}}jl.prototype.bytesPerElement=24,hn("StructArrayLayout4i4ui4i24",jl);class wh extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,a,h)}emplace(r,a,h,m){const y=3*r;return this.float32[y+0]=a,this.float32[y+1]=h,this.float32[y+2]=m,r}}wh.prototype.bytesPerElement=12,hn("StructArrayLayout3f12",wh);class Wc extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint32[1*r+0]=a,r}}Wc.prototype.bytesPerElement=4,hn("StructArrayLayout1ul4",Wc);class ta extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,h,m,y,b,D,S,k){const F=this.length;return this.resize(F+1),this.emplace(F,r,a,h,m,y,b,D,S,k)}emplace(r,a,h,m,y,b,D,S,k,F){const $=10*r,G=5*r;return this.int16[$+0]=a,this.int16[$+1]=h,this.int16[$+2]=m,this.int16[$+3]=y,this.int16[$+4]=b,this.int16[$+5]=D,this.uint32[G+3]=S,this.uint16[$+8]=k,this.uint16[$+9]=F,r}}ta.prototype.bytesPerElement=20,hn("StructArrayLayout6i1ul2ui20",ta);class xd extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,h,m,y,b){const D=this.length;return this.resize(D+1),this.emplace(D,r,a,h,m,y,b)}emplace(r,a,h,m,y,b,D){const S=6*r;return this.int16[S+0]=a,this.int16[S+1]=h,this.int16[S+2]=m,this.int16[S+3]=y,this.int16[S+4]=b,this.int16[S+5]=D,r}}xd.prototype.bytesPerElement=12,hn("StructArrayLayout2i2i2i12",xd);class Ch extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,h,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,r,a,h,m,y)}emplace(r,a,h,m,y,b){const D=4*r,S=8*r;return this.float32[D+0]=a,this.float32[D+1]=h,this.float32[D+2]=m,this.int16[S+6]=y,this.int16[S+7]=b,r}}Ch.prototype.bytesPerElement=16,hn("StructArrayLayout2f1f2i16",Ch);class Fu extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,h,m,y,b){const D=this.length;return this.resize(D+1),this.emplace(D,r,a,h,m,y,b)}emplace(r,a,h,m,y,b,D){const S=16*r,k=4*r,F=8*r;return this.uint8[S+0]=a,this.uint8[S+1]=h,this.float32[k+1]=m,this.float32[k+2]=y,this.int16[F+6]=b,this.int16[F+7]=D,r}}Fu.prototype.bytesPerElement=16,hn("StructArrayLayout2ub2f2i16",Fu);class fi extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,a,h)}emplace(r,a,h,m){const y=3*r;return this.uint16[y+0]=a,this.uint16[y+1]=h,this.uint16[y+2]=m,r}}fi.prototype.bytesPerElement=6,hn("StructArrayLayout3ui6",fi);class Th extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h,m,y,b,D,S,k,F,$,G,W,X,Q,re,ye){const Ae=this.length;return this.resize(Ae+1),this.emplace(Ae,r,a,h,m,y,b,D,S,k,F,$,G,W,X,Q,re,ye)}emplace(r,a,h,m,y,b,D,S,k,F,$,G,W,X,Q,re,ye,Ae){const Ce=24*r,Me=12*r,Ge=48*r;return this.int16[Ce+0]=a,this.int16[Ce+1]=h,this.uint16[Ce+2]=m,this.uint16[Ce+3]=y,this.uint32[Me+2]=b,this.uint32[Me+3]=D,this.uint32[Me+4]=S,this.uint16[Ce+10]=k,this.uint16[Ce+11]=F,this.uint16[Ce+12]=$,this.float32[Me+7]=G,this.float32[Me+8]=W,this.uint8[Ge+36]=X,this.uint8[Ge+37]=Q,this.uint8[Ge+38]=re,this.uint32[Me+10]=ye,this.int16[Ce+22]=Ae,r}}Th.prototype.bytesPerElement=48,hn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Th);class Dh extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h,m,y,b,D,S,k,F,$,G,W,X,Q,re,ye,Ae,Ce,Me,Ge,Xe,mt,Lt,Pt,Vt,dn,Jt){const Kt=this.length;return this.resize(Kt+1),this.emplace(Kt,r,a,h,m,y,b,D,S,k,F,$,G,W,X,Q,re,ye,Ae,Ce,Me,Ge,Xe,mt,Lt,Pt,Vt,dn,Jt)}emplace(r,a,h,m,y,b,D,S,k,F,$,G,W,X,Q,re,ye,Ae,Ce,Me,Ge,Xe,mt,Lt,Pt,Vt,dn,Jt,Kt){const It=32*r,Vn=16*r;return this.int16[It+0]=a,this.int16[It+1]=h,this.int16[It+2]=m,this.int16[It+3]=y,this.int16[It+4]=b,this.int16[It+5]=D,this.int16[It+6]=S,this.int16[It+7]=k,this.uint16[It+8]=F,this.uint16[It+9]=$,this.uint16[It+10]=G,this.uint16[It+11]=W,this.uint16[It+12]=X,this.uint16[It+13]=Q,this.uint16[It+14]=re,this.uint16[It+15]=ye,this.uint16[It+16]=Ae,this.uint16[It+17]=Ce,this.uint16[It+18]=Me,this.uint16[It+19]=Ge,this.uint16[It+20]=Xe,this.uint16[It+21]=mt,this.uint16[It+22]=Lt,this.uint32[Vn+12]=Pt,this.float32[Vn+13]=Vt,this.float32[Vn+14]=dn,this.uint16[It+30]=Jt,this.uint16[It+31]=Kt,r}}Dh.prototype.bytesPerElement=64,hn("StructArrayLayout8i15ui1ul2f2ui64",Dh);class Mh extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.float32[1*r+0]=a,r}}Mh.prototype.bytesPerElement=4,hn("StructArrayLayout1f4",Mh);class w extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,a,h)}emplace(r,a,h,m){const y=3*r;return this.uint16[6*r+0]=a,this.float32[y+1]=h,this.float32[y+2]=m,r}}w.prototype.bytesPerElement=12,hn("StructArrayLayout1ui2f12",w);class o extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,a,h)}emplace(r,a,h,m){const y=4*r;return this.uint32[2*r+0]=a,this.uint16[y+2]=h,this.uint16[y+3]=m,r}}o.prototype.bytesPerElement=8,hn("StructArrayLayout1ul2ui8",o);class u extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a){const h=this.length;return this.resize(h+1),this.emplace(h,r,a)}emplace(r,a,h){const m=2*r;return this.uint16[m+0]=a,this.uint16[m+1]=h,r}}u.prototype.bytesPerElement=4,hn("StructArrayLayout2ui4",u);class g extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint16[1*r+0]=a,r}}g.prototype.bytesPerElement=2,hn("StructArrayLayout1ui2",g);class v extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,h,m){const y=this.length;return this.resize(y+1),this.emplace(y,r,a,h,m)}emplace(r,a,h,m,y){const b=4*r;return this.float32[b+0]=a,this.float32[b+1]=h,this.float32[b+2]=m,this.float32[b+3]=y,r}}v.prototype.bytesPerElement=16,hn("StructArrayLayout4f16",v);class T extends cl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Z(this.anchorPointX,this.anchorPointY)}}T.prototype.size=20;class M extends ta{get(r){return new T(this,r)}}hn("CollisionBoxArray",M);class A extends cl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(r){this._structArray.uint8[this._pos1+37]=r}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(r){this._structArray.uint8[this._pos1+38]=r}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(r){this._structArray.uint32[this._pos4+10]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}A.prototype.size=48;class O extends Th{get(r){return new A(this,r)}}hn("PlacedSymbolArray",O);class U extends cl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(r){this._structArray.uint32[this._pos4+12]=r}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}U.prototype.size=64;class N extends Dh{get(r){return new U(this,r)}}hn("SymbolInstanceArray",N);class H extends Mh{getoffsetX(r){return this.float32[1*r+0]}}hn("GlyphOffsetArray",H);class q extends bd{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}hn("SymbolLineVertexArray",q);class te extends cl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}te.prototype.size=12;class ce extends w{get(r){return new te(this,r)}}hn("TextAnchorOffsetArray",ce);class Te extends cl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Te.prototype.size=8;class De extends o{get(r){return new Te(this,r)}}hn("FeatureIndexArray",De);class we extends Lu{}class Le extends Lu{}class je extends Lu{}class Re extends hf{}class $e extends ul{}class Ye extends Ou{}class Ne extends Tc{}class Qe extends xh{}class gt extends jl{}class lt extends wh{}class ft extends Wc{}class _t extends xd{}class Ht extends Fu{}class $t extends fi{}class Ft extends u{}const Tn=Ki([{name:"a_pos",components:2,type:"Int16"}],4),{members:yi}=Tn;class pi{constructor(r=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=r}prepareSegment(r,a,h,m){const y=this.segments[this.segments.length-1];return r>pi.MAX_VERTEX_ARRAY_LENGTH&&ne(`Max vertices per segment is ${pi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${pi.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!y||y.vertexLength+r>pi.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==m?this.createNewSegment(a,h,m):y}createNewSegment(r,a,h){const m={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0,vaos:{}};return void 0!==h&&(m.sortKey=h),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(m),m}getOrCreateLatestSegment(r,a,h){return this.prepareSegment(0,r,a,h)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const r of this.segments)for(const a in r.vaos)r.vaos[a].destroy()}static simpleSegment(r,a,h,m){return new pi([{vertexOffset:r,primitiveOffset:a,vertexLength:h,primitiveLength:m,vaos:{},sortKey:0}])}}function br(l,r){return 256*(l=Pn(Math.floor(l),0,255))+Pn(Math.floor(r),0,255)}pi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,hn("SegmentVector",pi);const xr=Ki([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Or=Ki([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var ar,Ao,Fr,oo={exports:{}},so={exports:{}},bo={exports:{}},na=function(){if(Fr)return oo.exports;Fr=1;var l=(ar||(ar=1,so.exports=function(a,h){var m,y,b,D,S,k,F,$;for(y=a.length-(m=3&a.length),b=h,S=3432918353,k=461845907,$=0;$<y;)F=255&a.charCodeAt($)|(255&a.charCodeAt(++$))<<8|(255&a.charCodeAt(++$))<<16|(255&a.charCodeAt(++$))<<24,++$,b=27492+(65535&(D=5*(65535&(b=(b^=F=(65535&(F=(F=(65535&F)*S+(((F>>>16)*S&65535)<<16)&4294967295)<<15|F>>>17))*k+(((F>>>16)*k&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(D>>>16)&65535)<<16);switch(F=0,m){case 3:F^=(255&a.charCodeAt($+2))<<16;case 2:F^=(255&a.charCodeAt($+1))<<8;case 1:b^=F=(65535&(F=(F=(65535&(F^=255&a.charCodeAt($)))*S+(((F>>>16)*S&65535)<<16)&4294967295)<<15|F>>>17))*k+(((F>>>16)*k&65535)<<16)&4294967295}return b^=a.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}),so.exports),r=(Ao||(Ao=1,bo.exports=function(a,h){for(var m,y=a.length,b=h^y,D=0;y>=4;)m=1540483477*(65535&(m=255&a.charCodeAt(D)|(255&a.charCodeAt(++D))<<8|(255&a.charCodeAt(++D))<<16|(255&a.charCodeAt(++D))<<24))+((1540483477*(m>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),y-=4,++D;switch(y){case 3:b^=(255&a.charCodeAt(D+2))<<16;case 2:b^=(255&a.charCodeAt(D+1))<<8;case 1:b=1540483477*(65535&(b^=255&a.charCodeAt(D)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}),bo.exports);return oo.exports=l,oo.exports.murmur3=l,oo.exports.murmur2=r,oo.exports}(),Ul=he(na);class Va{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,a,h,m){this.ids.push(Yc(r)),this.positions.push(a,h,m)}getPositions(r){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const a=Yc(r);let h=0,m=this.ids.length-1;for(;h<m;){const b=h+m>>1;this.ids[b]>=a?m=b:h=b+1}const y=[];for(;this.ids[h]===a;)y.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return y}static serialize(r,a){const h=new Float64Array(r.ids),m=new Uint32Array(r.positions);return Xr(h,m,0,h.length-1),a&&a.push(h.buffer,m.buffer),{ids:h,positions:m}}static deserialize(r){const a=new Va;return a.ids=r.ids,a.positions=r.positions,a.indexed=!0,a}}function Yc(l){const r=+l;return!isNaN(r)&&r<=Number.MAX_SAFE_INTEGER?r:Ul(String(l))}function Xr(l,r,a,h){for(;a<h;){const m=l[a+h>>1];let y=a-1,b=h+1;for(;;){do{y++}while(l[y]<m);do{b--}while(l[b]>m);if(y>=b)break;Ma(l,y,b),Ma(r,3*y,3*b),Ma(r,3*y+1,3*b+1),Ma(r,3*y+2,3*b+2)}b-a<h-b?(Xr(l,r,a,b),a=b+1):(Xr(l,r,b+1,h),h=b)}}function Ma(l,r,a){const h=l[r];l[r]=l[a],l[a]=h}hn("FeaturePositionMap",Va);class zi{constructor(r,a){this.gl=r.gl,this.location=a}}class er extends zi{constructor(r,a){super(r,a),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class Ea extends zi{constructor(r,a){super(r,a),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class lr extends zi{constructor(r,a){super(r,a),this.current=oi.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const Nu=new Float32Array(16);function Xc(l){return[br(255*l.r,255*l.g),br(255*l.b,255*l.a)]}class Kr{constructor(r,a,h){this.value=r,this.uniformNames=a.map(m=>`u_${m}`),this.type=h}setUniform(r,a,h){r.set(h.constantOr(this.value))}getBinding(r,a,h){return"color"===this.type?new lr(r,a):new er(r,a)}}class Mr{constructor(r,a){this.uniformNames=a.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=r.tlbr}setConstantDashPositions(r,a){this.dashTo=[0,r.y,r.height,r.width],this.dashFrom=[0,a.y,a.height,a.width]}setUniform(r,a,h,m){let y=null;"u_pattern_to"===m?y=this.patternTo:"u_pattern_from"===m?y=this.patternFrom:"u_dasharray_to"===m?y=this.dashTo:"u_dasharray_from"===m?y=this.dashFrom:"u_pixel_ratio_to"===m?y=this.pixelRatioTo:"u_pixel_ratio_from"===m&&(y=this.pixelRatioFrom),null!==y&&r.set(y)}getBinding(r,a,h){return"u_pattern"===h.substr(0,9)||"u_dasharray_"===h.substr(0,12)?new Ea(r,a):new er(r,a)}}class wr{constructor(r,a,h,m){this.expression=r,this.type=h,this.maxValue=0,this.paintVertexAttributes=a.map(y=>({name:`a_${y}`,type:"Float32",components:"color"===h?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(r,a,h){const m=this.paintVertexArray.length,y=this.expression.evaluate(new Dr(0,h),a,{},h.canonical,[],h.formattedSection);this.paintVertexArray.resize(r),this._setPaintValue(m,r,y)}updatePaintArray(r,a,h,m,y){const b=this.expression.evaluate(new Dr(0,y),h,m);this._setPaintValue(r,a,b)}_setPaintValue(r,a,h){if("color"===this.type){const m=Xc(h);for(let y=r;y<a;y++)this.paintVertexArray.emplace(y,m[0],m[1])}else{for(let m=r;m<a;m++)this.paintVertexArray.emplace(m,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Er{constructor(r,a,h,m,y,b){this.expression=r,this.uniformNames=a.map(D=>`u_${D}_t`),this.type=h,this.useIntegerZoom=m,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=a.map(D=>({name:`a_${D}`,type:"Float32",components:"color"===h?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(r,a,h){const m=this.expression.evaluate(new Dr(this.zoom,h),a,{},h.canonical,[],h.formattedSection),y=this.expression.evaluate(new Dr(this.zoom+1,h),a,{},h.canonical,[],h.formattedSection),b=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(b,r,m,y)}updatePaintArray(r,a,h,m,y){const b=this.expression.evaluate(new Dr(this.zoom,y),h,m),D=this.expression.evaluate(new Dr(this.zoom+1,y),h,m);this._setPaintValue(r,a,b,D)}_setPaintValue(r,a,h,m){if("color"===this.type){const y=Xc(h),b=Xc(m);for(let D=r;D<a;D++)this.paintVertexArray.emplace(D,y[0],y[1],b[0],b[1])}else{for(let y=r;y<a;y++)this.paintVertexArray.emplace(y,h,m);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(m))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,a){const h=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,m=Pn(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);r.set(m)}getBinding(r,a,h){return new er(r,a)}}class $l{constructor(r,a,h,m,y,b){this.expression=r,this.type=a,this.useIntegerZoom=h,this.zoom=m,this.layerId=b,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(r,a,h){const m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(m,r,this.getPositionIds(a),h)}updatePaintArray(r,a,h,m,y){this._setPaintValues(r,a,this.getPositionIds(h),y)}_setPaintValues(r,a,h,m){const y=this.getPositions(m);if(!y||!h)return;const b=y[h.min],D=y[h.mid],S=y[h.max];if(b&&D&&S)for(let k=r;k<a;k++)this.emplace(this.zoomInPaintVertexArray,k,D,b),this.emplace(this.zoomOutPaintVertexArray,k,D,S)}upload(r){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const a=this.getVertexAttributes();this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,a,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,a,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class wd extends $l{getPositions(r){return r.imagePositions}getPositionIds(r){return r.patterns&&r.patterns[this.layerId]}getVertexAttributes(){return xr.members}emplace(r,a,h,m){r.emplace(a,h.tlbr[0],h.tlbr[1],h.tlbr[2],h.tlbr[3],m.tlbr[0],m.tlbr[1],m.tlbr[2],m.tlbr[3],h.pixelRatio,m.pixelRatio)}}class Cd extends $l{getPositions(r){return r.dashPositions}getPositionIds(r){return r.dashes&&r.dashes[this.layerId]}getVertexAttributes(){return Or.members}emplace(r,a,h,m){r.emplace(a,0,h.y,h.height,h.width,0,m.y,m.height,m.width)}}class df{constructor(r,a,h){this.binders={},this._buffers=[];const m=[];for(const y in r.paint._values){if(!h(y))continue;const b=r.paint.get(y);if(!(b instanceof Ba&&ga(b.property.specification)))continue;const D=ug(y,r.type),S=b.value,k=b.property.specification.type,F=b.property.useIntegerZoom,$=b.property.specification["property-type"],G="cross-faded"===$||"cross-faded-data-driven"===$;if("constant"===S.kind)this.binders[y]=G?new Mr(S.value,D):new Kr(S.value,D,k),m.push(`/u_${y}`);else if("source"===S.kind||G){const W=Qc(y,k,"source");this.binders[y]=G?"line-dasharray"===y?new Cd(S,k,F,a,W,r.id):new wd(S,k,F,a,W,r.id):new wr(S,D,k,W),m.push(`/a_${y}`)}else{const W=Qc(y,k,"composite");this.binders[y]=new Er(S,D,k,F,a,W),m.push(`/z_${y}`)}}this.cacheKey=m.sort().join("")}getMaxValue(r){const a=this.binders[r];return a instanceof wr||a instanceof Er?a.maxValue:0}populatePaintArrays(r,a,h){for(const m in this.binders){const y=this.binders[m];(y instanceof wr||y instanceof Er||y instanceof $l)&&y.populatePaintArray(r,a,h)}}setConstantPatternPositions(r,a){for(const h in this.binders){const m=this.binders[h];m instanceof Mr&&m.setConstantPatternPositions(r,a)}}setConstantDashPositions(r,a){for(const h in this.binders){const m=this.binders[h];m instanceof Mr&&m.setConstantDashPositions(r,a)}}updatePaintArrays(r,a,h,m,y){let b=!1;for(const D in r){const S=a.getPositions(D);for(const k of S){const F=h.feature(k.index);for(const $ in this.binders){const G=this.binders[$];if((G instanceof wr||G instanceof Er||G instanceof $l)&&!0===G.expression.isStateDependent){const W=m.paint.get($);G.expression=W.value,G.updatePaintArray(k.start,k.end,F,r[D],y),b=!0}}}}return b}defines(){const r=[];for(const a in this.binders){const h=this.binders[a];(h instanceof Kr||h instanceof Mr)&&r.push(...h.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return r}getBinderAttributes(){const r=[];for(const a in this.binders){const h=this.binders[a];if(h instanceof wr||h instanceof Er)for(let m=0;m<h.paintVertexAttributes.length;m++)r.push(h.paintVertexAttributes[m].name);else if(h instanceof $l){const m=h.getVertexAttributes();for(const y of m)r.push(y.name)}}return r}getBinderUniforms(){const r=[];for(const a in this.binders){const h=this.binders[a];if(h instanceof Kr||h instanceof Mr||h instanceof Er)for(const m of h.uniformNames)r.push(m)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,a){const h=[];for(const m in this.binders){const y=this.binders[m];if(y instanceof Kr||y instanceof Mr||y instanceof Er)for(const b of y.uniformNames)if(a[b]){const D=y.getBinding(r,a[b],b);h.push({name:b,property:m,binding:D})}}return h}setUniforms(r,a,h,m){for(const{name:y,property:b,binding:D}of a)this.binders[b].setUniform(D,m,h.get(b),y)}updatePaintBuffers(r){this._buffers=[];for(const a in this.binders){const h=this.binders[a];if(r&&h instanceof $l){const m=2===r.fromScale?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(h instanceof wr||h instanceof Er)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(r){for(const a in this.binders){const h=this.binders[a];(h instanceof wr||h instanceof Er||h instanceof $l)&&h.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const a=this.binders[r];(a instanceof wr||a instanceof Er||a instanceof $l)&&a.destroy()}}}class Kc{constructor(r,a,h=()=>!0){this.programConfigurations={};for(const m of r)this.programConfigurations[m.id]=new df(m,a,h);this.needsUpload=!1,this._featureMap=new Va,this._bufferOffset=0}populatePaintArrays(r,a,h,m){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(r,a,m);void 0!==a.id&&this._featureMap.add(a.id,h,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,a,h,m){for(const y of h)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(r,this._featureMap,a,y,m)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}function ug(l,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[l]||[l.replace(`${r}-`,"").replace(/-/g,"_")]}function Qc(l,r,a){const m={"line-pattern":{source:Ne,composite:Ne},"fill-pattern":{source:Ne,composite:Ne},"fill-extrusion-pattern":{source:Ne,composite:Ne},"line-dasharray":{source:Qe,composite:Qe}}[l];return m&&m[a]||{color:{source:Ou,composite:v},number:{source:Mh,composite:Ou}}[r][a]}hn("ConstantBinder",Kr),hn("CrossFadedConstantBinder",Mr),hn("SourceExpressionBinder",wr),hn("CrossFadedPatternBinder",wd),hn("CrossFadedDasharrayBinder",Cd),hn("CompositeExpressionBinder",Er),hn("ProgramConfiguration",df,{omit:["_buffers"]}),hn("ProgramConfigurationSet",Kc);const Dc=Math.pow(2,14)-1,zu=-Dc-1;function Gl(l){const r=pt/l.extent,a=l.loadGeometry();for(let h=0;h<a.length;h++){const m=a[h];for(let y=0;y<m.length;y++){const b=m[y],D=Math.round(b.x*r),S=Math.round(b.y*r);b.x=Pn(D,zu,Dc),b.y=Pn(S,zu,Dc),(D<b.x||D>b.x+1||S<b.y||S>b.y+1)&&ne("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return a}function hl(l,r){return{type:l.type,id:l.id,properties:l.properties,geometry:r?Gl(l):[]}}function Np(l,r,a,h,m){l.emplaceBack(8*r-32768+h,8*a-32768+m)}class ly{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasDependencies=!1,this.layoutVertexArray=new Le,this.indexArray=new $t,this.segments=new pi,this.programConfigurations=new Kc(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,h){const m=this.layers[0],y=[];let b=null,D=!1,S="heatmap"===m.type;if("circle"===m.type){const F=m;b=F.layout.get("circle-sort-key"),D=!b.isConstant(),S=S||"map"===F.paint.get("circle-pitch-alignment")}const k=S?a.subdivisionGranularity.circle:1;for(const{feature:F,id:$,index:G,sourceLayerIndex:W}of r){const X=this.layers[0]._featureFilter.needGeometry,Q=hl(F,X);if(!this.layers[0]._featureFilter.filter(new Dr(this.zoom),Q,h))continue;const re=D?b.evaluate(Q,{},h):void 0,ye={id:$,properties:F.properties,type:F.type,sourceLayerIndex:W,index:G,geometry:X?Q.geometry:Gl(F),patterns:{},sortKey:re};y.push(ye)}D&&y.sort((F,$)=>F.sortKey-$.sortKey);for(const F of y){const{geometry:$,index:G,sourceLayerIndex:W}=F,X=r[G].feature;this.addFeature(F,$,G,h,k),a.featureIndex.insert(X,$,G,W,this.index)}}update(r,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,{imagePositions:h})}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,yi),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,a,h,m,y=1){let b;switch(y){case 1:b=[0,7];break;case 3:b=[0,2,5,7];break;case 5:b=[0,1,3,4,6,7];break;case 7:b=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${y}; valid values are 1, 3, 5, 7.`)}const D=b.length;for(const S of a)for(const k of S){const F=k.x,$=k.y;if(F<0||F>=pt||$<0||$>=pt)continue;const G=this.segments.prepareSegment(D*D,this.layoutVertexArray,this.indexArray,r.sortKey),W=G.vertexLength;for(let X=0;X<D;X++)for(let Q=0;Q<D;Q++)Np(this.layoutVertexArray,F,$,b[Q],b[X]);for(let X=0;X<D-1;X++)for(let Q=0;Q<D-1;Q++){const re=W+X*D+Q,ye=W+(X+1)*D+Q;this.indexArray.emplaceBack(re,ye+1,re+1),this.indexArray.emplaceBack(re,ye,ye+1)}G.vertexLength+=D*D,G.primitiveLength+=(D-1)*(D-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,{imagePositions:{},canonical:m})}}function Ww(l,r){for(let a=0;a<l.length;a++)if(mf(r,l[a]))return!0;for(let a=0;a<r.length;a++)if(mf(l,r[a]))return!0;return!!hg(l,r)}function cy(l,r,a){return!!mf(l,r)||!!dg(r,l,a)}function X0(l,r){if(1===l.length)return pf(r,l[0]);for(let a=0;a<r.length;a++){const h=r[a];for(let m=0;m<h.length;m++)if(mf(l,h[m]))return!0}for(let a=0;a<l.length;a++)if(pf(r,l[a]))return!0;for(let a=0;a<r.length;a++)if(hg(l,r[a]))return!0;return!1}function K0(l,r,a){if(l.length>1){if(hg(l,r))return!0;for(let h=0;h<r.length;h++)if(dg(r[h],l,a))return!0}for(let h=0;h<l.length;h++)if(dg(l[h],r,a))return!0;return!1}function hg(l,r){if(0===l.length||0===r.length)return!1;for(let a=0;a<l.length-1;a++){const h=l[a],m=l[a+1];for(let y=0;y<r.length-1;y++)if(ff(h,m,r[y],r[y+1]))return!0}return!1}function ff(l,r,a,h){return kt(l,a,h)!==kt(r,a,h)&&kt(l,r,a)!==kt(l,r,h)}function dg(l,r,a){const h=a*a;if(1===r.length)return l.distSqr(r[0])<h;for(let m=1;m<r.length;m++)if(fg(l,r[m-1],r[m])<h)return!0;return!1}function fg(l,r,a){const h=r.distSqr(a);if(0===h)return l.distSqr(r);const m=((l.x-r.x)*(a.x-r.x)+(l.y-r.y)*(a.y-r.y))/h;return l.distSqr(m<0?r:m>1?a:a.sub(r)._mult(m)._add(r))}function pf(l,r){let a,h,m,y=!1;for(let b=0;b<l.length;b++){a=l[b];for(let D=0,S=a.length-1;D<a.length;S=D++)h=a[D],m=a[S],h.y>r.y!=m.y>r.y&&r.x<(m.x-h.x)*(r.y-h.y)/(m.y-h.y)+h.x&&(y=!y)}return y}function mf(l,r){let a=!1;for(let h=0,m=l.length-1;h<l.length;m=h++){const y=l[h],b=l[m];y.y>r.y!=b.y>r.y&&r.x<(b.x-y.x)*(r.y-y.y)/(b.y-y.y)+y.x&&(a=!a)}return a}function zp(l,r,a){const h=a[0],m=a[2];if(l.x<h.x&&r.x<h.x||l.x>m.x&&r.x>m.x||l.y<h.y&&r.y<h.y||l.y>m.y&&r.y>m.y)return!1;const y=kt(l,r,a[0]);return y!==kt(l,r,a[1])||y!==kt(l,r,a[2])||y!==kt(l,r,a[3])}function Eh(l,r,a){const h=r.paint.get(l).value;return"constant"===h.kind?h.value:a.programConfigurations.get(r.id).getMaxValue(l)}function Td(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function uy(l,r,a,h,m){if(!r[0]&&!r[1])return l;const y=Z.convert(r)._mult(m);"viewport"===a&&y._rotate(-h);const b=[];for(let D=0;D<l.length;D++)b.push(l[D].sub(y));return b}function Q0({queryGeometry:l,size:r},a){return cy(l,a,r)}function J0({queryGeometry:l,size:r,transform:a,unwrappedTileID:h,getElevation:m},y){return cy(l,y,r*(a.projectTileCoordinates(y.x,y.y,h,m).signedDistanceFromCamera/a.cameraToCenterDistance))}function Yw({queryGeometry:l,size:r,transform:a,unwrappedTileID:h,getElevation:m},y){const b=a.projectTileCoordinates(y.x,y.y,h,m).signedDistanceFromCamera,D=r*(a.cameraToCenterDistance/b);return cy(l,gf(y,a,h,m),D)}function Jc({queryGeometry:l,size:r,transform:a,unwrappedTileID:h,getElevation:m},y){return cy(l,gf(y,a,h,m),r)}function eb({queryGeometry:l,size:r,transform:a,unwrappedTileID:h,getElevation:m,pitchAlignment:y="map",pitchScale:b="map"},D){const S="map"===y?"map"===b?Q0:J0:"map"===b?Yw:Jc,k={queryGeometry:l,size:r,transform:a,unwrappedTileID:h,getElevation:m};for(const F of D)for(const $ of F)if(S(k,$))return!0;return!1}function gf(l,r,a,h){const m=r.projectTileCoordinates(l.x,l.y,a,h).point;return new Z((.5*m.x+.5)*r.width,(.5*-m.y+.5)*r.height)}let pg,hy;hn("CircleBucket",ly,{omit:["layers"]});var mg={get paint(){return hy=hy||new gi({"circle-radius":new Wn(xe.paint_circle["circle-radius"]),"circle-color":new Wn(xe.paint_circle["circle-color"]),"circle-blur":new Wn(xe.paint_circle["circle-blur"]),"circle-opacity":new Wn(xe.paint_circle["circle-opacity"]),"circle-translate":new In(xe.paint_circle["circle-translate"]),"circle-translate-anchor":new In(xe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new In(xe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new In(xe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Wn(xe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Wn(xe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Wn(xe.paint_circle["circle-stroke-opacity"])})},get layout(){return pg=pg||new gi({"circle-sort-key":new Wn(xe.layout_circle["circle-sort-key"])})}};class dy extends ya{constructor(r,a){super(r,mg,a)}createBucket(r){return new ly(r)}queryRadius(r){const a=r;return Eh("circle-radius",this,a)+Eh("circle-stroke-width",this,a)+Td(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:r,feature:a,featureState:h,geometry:m,transform:y,pixelsToTileUnits:b,unwrappedTileID:D,getElevation:S}){const k=uy(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-y.bearingInRadians,b),F=this.paint.get("circle-radius").evaluate(a,h)+this.paint.get("circle-stroke-width").evaluate(a,h),$=this.paint.get("circle-pitch-scale"),G=this.paint.get("circle-pitch-alignment");let W,X;return"map"===G?(W=k,X=F*b):(re=y,ye=D,Ae=S,W=k.map(Ce=>gf(Ce,re,ye,Ae)),X=F),eb({queryGeometry:W,size:X,transform:y,unwrappedTileID:D,getElevation:S,pitchAlignment:G,pitchScale:$},m);var re,ye,Ae}}class tb extends ly{}let fy;hn("HeatmapBucket",tb,{omit:["layers"]});var nb={get paint(){return fy=fy||new gi({"heatmap-radius":new Wn(xe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Wn(xe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new In(xe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bh(xe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new In(xe.paint_heatmap["heatmap-opacity"])})}};function gg(l,{width:r,height:a},h,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==r*a*h)throw new RangeError(`mismatched image size. expected: ${m.length} but got: ${r*a*h}`)}else m=new Uint8Array(r*a*h);return l.width=r,l.height=a,l.data=m,l}function py(l,{width:r,height:a},h){if(r===l.width&&a===l.height)return;const m=gg({},{width:r,height:a},h);my(l,m,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,r),height:Math.min(l.height,a)},h),l.width=r,l.height=a,l.data=m.data}function my(l,r,a,h,m,y){if(0===m.width||0===m.height)return r;if(m.width>l.width||m.height>l.height||a.x>l.width-m.width||a.y>l.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>r.width||m.height>r.height||h.x>r.width-m.width||h.y>r.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const b=l.data,D=r.data;if(b===D)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<m.height;S++){const k=((a.y+S)*l.width+a.x)*y,F=((h.y+S)*r.width+h.x)*y;for(let $=0;$<m.width*y;$++)D[F+$]=b[k+$]}return r}class Sh{constructor(r,a){gg(this,r,1,a)}resize(r){py(this,r,1)}clone(){return new Sh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,h,m,y){my(r,a,h,m,y,1)}}class _s{constructor(r,a){gg(this,r,4,a)}resize(r){py(this,r,4)}replace(r,a){a?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new _s({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,h,m,y){my(r,a,h,m,y,4)}setPixel(r,a,h){const m=4*(r*this.width+a);this.data[m+0]=Math.round(255*h.r/h.a),this.data[m+1]=Math.round(255*h.g/h.a),this.data[m+2]=Math.round(255*h.b/h.a),this.data[m+3]=Math.round(255*h.a)}}function ib(l){const r={},a=l.resolution||256,h=l.clips?l.clips.length:1,m=l.image||new _s({width:a,height:h});if(Math.log(a)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${a}`);const y=(b,D,S)=>{r[l.evaluationKey]=S;const k=l.expression.evaluate(r);m.setPixel(b/4/a,D/4,k)};if(l.clips)for(let b=0,D=0;b<h;++b,D+=4*a)for(let S=0,k=0;S<a;S++,k+=4){const F=S/(a-1),{start:$,end:G}=l.clips[b];y(D,k,$*(1-F)+G*F)}else for(let b=0,D=0;b<a;b++,D+=4)y(0,D,b/(a-1));return m}hn("AlphaImage",Sh),hn("RGBAImage",_s);const _g="big-fb";class rb extends ya{createBucket(r){return new tb(r)}constructor(r,a){super(r,nb,a),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){"heatmap-color"===r&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ib({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(_g)&&this.heatmapFbos.delete(_g)}queryRadius(r){return Eh("heatmap-radius",this,r)}queryIntersectsFeature({queryGeometry:r,feature:a,featureState:h,geometry:m,transform:y,pixelsToTileUnits:b,unwrappedTileID:D,getElevation:S}){return eb({queryGeometry:r,size:this.paint.get("heatmap-radius").evaluate(a,h)*b,transform:y,unwrappedTileID:D,getElevation:S},m)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}}let Bu;var Dd={get paint(){return Bu=Bu||new gi({"hillshade-illumination-direction":new In(xe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new In(xe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new In(xe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new In(xe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new In(xe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new In(xe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new In(xe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new In(xe.paint_hillshade["hillshade-method"])})}};class ko extends ya{constructor(r,a){super(r,Dd,a),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let r=this.paint.get("hillshade-illumination-direction").values,a=this.paint.get("hillshade-illumination-altitude").values,h=this.paint.get("hillshade-highlight-color").values,m=this.paint.get("hillshade-shadow-color").values;const y=Math.max(r.length,a.length,h.length,m.length);r=r.concat(Array(y-r.length).fill(r.at(-1))),a=a.concat(Array(y-a.length).fill(a.at(-1))),h=h.concat(Array(y-h.length).fill(h.at(-1))),m=m.concat(Array(y-m.length).fill(m.at(-1)));const b=a.map(Cn);return{directionRadians:r.map(Cn),altitudeRadians:b,shadowColor:m,highlightColor:h}}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}}let ob;var ks={get paint(){return ob=ob||new gi({"color-relief-opacity":new In(xe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new bh(xe["paint_color-relief"]["color-relief-color"])})}};class Bp{constructor(r,a,h,m){this.context=r,this.format=h,this.texture=r.gl.createTexture(),this.update(a,m)}update(r,a,h){const{width:m,height:y}=r,b=!(this.size&&this.size[0]===m&&this.size[1]===y||h),{context:D}=this,{gl:S}=D;if(this.useMipmap=!(!a||!a.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),D.pixelStoreUnpackFlipY.set(!1),D.pixelStoreUnpack.set(1),D.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!a||!1!==a.premultiply)),b)this.size=[m,y],r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||ke(r)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,r):S.texImage2D(S.TEXTURE_2D,0,this.format,m,y,0,this.format,S.UNSIGNED_BYTE,r.data);else{const{x:k,y:F}=h||{x:0,y:0};r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||ke(r)?S.texSubImage2D(S.TEXTURE_2D,0,k,F,S.RGBA,S.UNSIGNED_BYTE,r):S.texSubImage2D(S.TEXTURE_2D,0,k,F,m,y,S.RGBA,S.UNSIGNED_BYTE,r.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D),D.pixelStoreUnpackFlipY.setDefault(),D.pixelStoreUnpack.setDefault(),D.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(r,a,h){const{context:m}=this,{gl:y}=m;y.bindTexture(y.TEXTURE_2D,this.texture),h!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=y.LINEAR),r!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,r),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,h||r),this.filter=r),a!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,a),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class sb{constructor(r,a,h,m=1,y=1,b=1,D=0){if(this.uid=r,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(h&&!["mapbox","terrarium","custom"].includes(h))return void ne(`"${h}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=a.height;const S=this.dim=a.height-2;switch(this.data=new Uint32Array(a.data.buffer),h){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=m,this.greenFactor=y,this.blueFactor=b,this.baseShift=D;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let k=0;k<S;k++)this.data[this._idx(-1,k)]=this.data[this._idx(0,k)],this.data[this._idx(S,k)]=this.data[this._idx(S-1,k)],this.data[this._idx(k,-1)]=this.data[this._idx(k,0)],this.data[this._idx(k,S)]=this.data[this._idx(k,S-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(S,-1)]=this.data[this._idx(S-1,0)],this.data[this._idx(-1,S)]=this.data[this._idx(0,S-1)],this.data[this._idx(S,S)]=this.data[this._idx(S-1,S-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let k=0;k<S;k++)for(let F=0;F<S;F++){const $=this.get(k,F);$>this.max&&(this.max=$),$<this.min&&(this.min=$)}}get(r,a){const h=new Uint8Array(this.data.buffer),m=4*this._idx(r,a);return this.unpack(h[m],h[m+1],h[m+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(r,a){if(r<-1||r>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(r+1)}unpack(r,a,h){return r*this.redFactor+a*this.greenFactor+h*this.blueFactor-this.baseShift}pack(r){return gy(r,this.getUnpackVector())}getPixels(){return new _s({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,a,h){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let m=a*this.dim,y=a*this.dim+this.dim,b=h*this.dim,D=h*this.dim+this.dim;switch(a){case-1:m=y-1;break;case 1:y=m+1}switch(h){case-1:b=D-1;break;case 1:D=b+1}const S=-a*this.dim,k=-h*this.dim;for(let F=b;F<D;F++)for(let $=m;$<y;$++)this.data[this._idx($,F)]=r.data[this._idx($+S,F+k)]}}function gy(l,r){const a=r[0],h=r[1],m=r[2],y=r[3],b=Math.min(a,h,m),D=Math.round((l+y)/b);return{r:Math.floor(D*b/a)%256,g:Math.floor(D*b/h)%256,b:Math.floor(D*b/m)%256}}hn("DEMData",sb);class Vp extends ya{constructor(r,a){super(r,ks,a)}_createColorRamp(r){const a={elevationStops:[],colorStops:[]},h=this._transitionablePaint._values["color-relief-color"].value.expression;if(h instanceof bc&&h._styleExpression.expression instanceof Wr){this.colorRampExpression=h;const b=h._styleExpression.expression;a.elevationStops=b.labels,a.colorStops=[];for(const D of a.elevationStops)a.colorStops.push(b.evaluate({globals:{elevation:D}}))}if(a.elevationStops.length<1&&(a.elevationStops=[0],a.colorStops=[oi.transparent]),a.elevationStops.length<2&&(a.elevationStops.push(a.elevationStops[0]+1),a.colorStops.push(a.colorStops[0])),a.elevationStops.length<=r)return a;const m={elevationStops:[],colorStops:[]},y=(a.elevationStops.length-1)/(r-1);for(let b=0;b<a.elevationStops.length-.5;b+=y)m.elevationStops.push(a.elevationStops[Math.round(b)]),m.colorStops.push(a.colorStops[Math.round(b)]);return ne(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${r}, provided: ${a.elevationStops.length}`),m}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(r,a,h){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const m=this._createColorRamp(a),y=new _s({width:m.colorStops.length,height:1}),b=new _s({width:m.colorStops.length,height:1});for(let D=0;D<m.elevationStops.length;D++){const S=gy(m.elevationStops[D],h);b.setPixel(0,D,new oi(S.r/255,S.g/255,S.b/255,1)),y.setPixel(0,D,m.colorStops[D])}return this.colorRampTextures={elevationTexture:new Bp(r,b,r.gl.RGBA),colorTexture:new Bp(r,y,r.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return"none"!==this.visibility&&!!this.colorRampTextures}}const Xw=Ki([{name:"a_pos",components:2,type:"Int16"}],4),{members:ab}=Xw;function _f(l,r,a){const h=a.patternDependencies;let m=!1;for(const y of r){const b=y.paint.get(`${l}-pattern`);b.isConstant()||(m=!0);const D=b.constantOr(null);D&&(m=!0,h[D.to]=!0,h[D.from]=!0)}return m}function yf(l,r,a,h,m){const{zoom:y}=h,b=m.patternDependencies;for(const D of r){const S=D.paint.get(`${l}-pattern`).value;if("constant"!==S.kind){let k=S.evaluate({zoom:y-1},a,{},m.availableImages),F=S.evaluate({zoom:y},a,{},m.availableImages),$=S.evaluate({zoom:y+1},a,{},m.availableImages);k=k&&k.name?k.name:k,F=F&&F.name?F.name:F,$=$&&$.name?$.name:$,b[k]=!0,b[F]=!0,b[$]=!0,a.patterns[D.id]={min:k,mid:F,max:$}}}return a}function _y(l,r,a,h,m){let y;if(m===function(b,D,S,k){let F=0;for(let $=D,G=S-k;$<S;$+=k)F+=(b[G]-b[$])*(b[$+1]+b[G+1]),G=$;return F}(l,r,a,h)>0)for(let b=r;b<a;b+=h)y=nC(b/h|0,l[b],l[b+1],y);else for(let b=a-h;b>=r;b-=h)y=nC(b/h|0,l[b],l[b+1],y);return y&&Ed(y,y.next)&&(bf(y),y=y.next),y}function Md(l,r){if(!l)return l;r||(r=l);let a,h=l;do{if(a=!1,h.steiner||!Ed(h,h.next)&&0!==Ro(h.prev,h,h.next))h=h.next;else{if(bf(h),h=r=h.prev,h===h.next)break;a=!0}}while(a||h!==r);return r}function jp(l,r,a,h,m,y,b){if(!l)return;!b&&y&&function(S,k,F,$){let G=S;do{0===G.z&&(G.z=yg(G.x,G.y,k,F,$)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next}while(G!==S);G.prevZ.nextZ=null,G.prevZ=null,function(W){let X,Q=1;do{let re,ye=W;W=null;let Ae=null;for(X=0;ye;){X++;let Ce=ye,Me=0;for(let Xe=0;Xe<Q&&(Me++,Ce=Ce.nextZ,Ce);Xe++);let Ge=Q;for(;Me>0||Ge>0&&Ce;)0!==Me&&(0===Ge||!Ce||ye.z<=Ce.z)?(re=ye,ye=ye.nextZ,Me--):(re=Ce,Ce=Ce.nextZ,Ge--),Ae?Ae.nextZ=re:W=re,re.prevZ=Ae,Ae=re;ye=Ce}Ae.nextZ=null,Q*=2}while(X>1)}(G)}(l,h,m,y);let D=l;for(;l.prev!==l.next;){const S=l.prev,k=l.next;if(y?lb(l,h,m,y):Kw(l))r.push(S.i,l.i,k.i),bf(l),l=k.next,D=k.next;else if((l=k)===D){b?1===b?jp(l=Qw(Md(l),r),r,a,h,m,y,2):2===b&&cb(l,r,a,h,m,y):jp(Md(l),r,a,h,m,y,1);break}}}function Kw(l){const r=l.prev,a=l,h=l.next;if(Ro(r,a,h)>=0)return!1;const m=r.x,y=a.x,b=h.x,D=r.y,S=a.y,k=h.y,F=Math.min(m,y,b),$=Math.min(D,S,k),G=Math.max(m,y,b),W=Math.max(D,S,k);let X=h.next;for(;X!==r;){if(X.x>=F&&X.x<=G&&X.y>=$&&X.y<=W&&vg(m,D,y,S,b,k,X.x,X.y)&&Ro(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function lb(l,r,a,h){const m=l.prev,y=l,b=l.next;if(Ro(m,y,b)>=0)return!1;const D=m.x,S=y.x,k=b.x,F=m.y,$=y.y,G=b.y,W=Math.min(D,S,k),X=Math.min(F,$,G),Q=Math.max(D,S,k),re=Math.max(F,$,G),ye=yg(W,X,r,a,h),Ae=yg(Q,re,r,a,h);let Ce=l.prevZ,Me=l.nextZ;for(;Ce&&Ce.z>=ye&&Me&&Me.z<=Ae;){if(Ce.x>=W&&Ce.x<=Q&&Ce.y>=X&&Ce.y<=re&&Ce!==m&&Ce!==b&&vg(D,F,S,$,k,G,Ce.x,Ce.y)&&Ro(Ce.prev,Ce,Ce.next)>=0||(Ce=Ce.prevZ,Me.x>=W&&Me.x<=Q&&Me.y>=X&&Me.y<=re&&Me!==m&&Me!==b&&vg(D,F,S,$,k,G,Me.x,Me.y)&&Ro(Me.prev,Me,Me.next)>=0))return!1;Me=Me.nextZ}for(;Ce&&Ce.z>=ye;){if(Ce.x>=W&&Ce.x<=Q&&Ce.y>=X&&Ce.y<=re&&Ce!==m&&Ce!==b&&vg(D,F,S,$,k,G,Ce.x,Ce.y)&&Ro(Ce.prev,Ce,Ce.next)>=0)return!1;Ce=Ce.prevZ}for(;Me&&Me.z<=Ae;){if(Me.x>=W&&Me.x<=Q&&Me.y>=X&&Me.y<=re&&Me!==m&&Me!==b&&vg(D,F,S,$,k,G,Me.x,Me.y)&&Ro(Me.prev,Me,Me.next)>=0)return!1;Me=Me.nextZ}return!0}function Qw(l,r){let a=l;do{const h=a.prev,m=a.next.next;!Ed(h,m)&&Hl(h,a,a.next,m)&&dl(h,m)&&dl(m,h)&&(r.push(h.i,a.i,m.i),bf(a),bf(a.next),a=l=m),a=a.next}while(a!==l);return Md(a)}function cb(l,r,a,h,m,y){let b=l;do{let D=b.next.next;for(;D!==b.prev;){if(b.i!==D.i&&tC(b,D)){let S=vf(b,D);return b=Md(b,b.next),S=Md(S,S.next),jp(b,r,a,h,m,y,0),void jp(S,r,a,h,m,y,0)}D=D.next}b=b.next}while(b!==l)}function Jw(l,r){let a=l.x-r.x;return 0===a&&(a=l.y-r.y,0===a)&&(a=(l.next.y-l.y)/(l.next.x-l.x)-(r.next.y-r.y)/(r.next.x-r.x)),a}function eC(l,r){const a=function(m,y){let b=y;const D=m.x,S=m.y;let k,F=-1/0;if(Ed(m,b))return b;do{if(Ed(m,b.next))return b.next;if(S<=b.y&&S>=b.next.y&&b.next.y!==b.y){const Q=b.x+(S-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(Q<=D&&Q>F&&(F=Q,k=b.x<b.next.x?b:b.next,Q===D))return k}b=b.next}while(b!==y);if(!k)return null;const $=k,G=k.x,W=k.y;let X=1/0;b=k;do{if(D>=b.x&&b.x>=G&&D!==b.x&&ys(S<W?D:F,S,G,W,S<W?F:D,S,b.x,b.y)){const Q=Math.abs(S-b.y)/(D-b.x);dl(b,m)&&(Q<X||Q===X&&(b.x>k.x||b.x===k.x&&s2(k,b)))&&(k=b,X=Q)}b=b.next}while(b!==$);return k}(l,r);if(!a)return r;const h=vf(a,l);return Md(h,h.next),Md(a,a.next)}function s2(l,r){return Ro(l.prev,l,r.prev)<0&&Ro(r.next,l,l.next)<0}function yg(l,r,a,h,m){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-a)*m|0)|l<<8))|l<<4))|l<<2))|l<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-h)*m|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function ub(l){let r=l,a=l;do{(r.x<a.x||r.x===a.x&&r.y<a.y)&&(a=r),r=r.next}while(r!==l);return a}function ys(l,r,a,h,m,y,b,D){return(m-b)*(r-D)>=(l-b)*(y-D)&&(l-b)*(h-D)>=(a-b)*(r-D)&&(a-b)*(y-D)>=(m-b)*(h-D)}function vg(l,r,a,h,m,y,b,D){return!(l===b&&r===D)&&ys(l,r,a,h,m,y,b,D)}function tC(l,r){return l.next.i!==r.i&&l.prev.i!==r.i&&!function(a,h){let m=a;do{if(m.i!==a.i&&m.next.i!==a.i&&m.i!==h.i&&m.next.i!==h.i&&Hl(m,m.next,a,h))return!0;m=m.next}while(m!==a);return!1}(l,r)&&(dl(l,r)&&dl(r,l)&&function(a,h){let m=a,y=!1;const b=(a.x+h.x)/2,D=(a.y+h.y)/2;do{m.y>D!=m.next.y>D&&m.next.y!==m.y&&b<(m.next.x-m.x)*(D-m.y)/(m.next.y-m.y)+m.x&&(y=!y),m=m.next}while(m!==a);return y}(l,r)&&(Ro(l.prev,l,r.prev)||Ro(l,r.prev,r))||Ed(l,r)&&Ro(l.prev,l,l.next)>0&&Ro(r.prev,r,r.next)>0)}function Ro(l,r,a){return(r.y-l.y)*(a.x-r.x)-(r.x-l.x)*(a.y-r.y)}function Ed(l,r){return l.x===r.x&&l.y===r.y}function Hl(l,r,a,h){const m=bg(Ro(l,r,a)),y=bg(Ro(l,r,h)),b=bg(Ro(a,h,l)),D=bg(Ro(a,h,r));return m!==y&&b!==D||!(0!==m||!Up(l,a,r))||!(0!==y||!Up(l,h,r))||!(0!==b||!Up(a,l,h))||!(0!==D||!Up(a,r,h))}function Up(l,r,a){return r.x<=Math.max(l.x,a.x)&&r.x>=Math.min(l.x,a.x)&&r.y<=Math.max(l.y,a.y)&&r.y>=Math.min(l.y,a.y)}function bg(l){return l>0?1:l<0?-1:0}function dl(l,r){return Ro(l.prev,l,l.next)<0?Ro(l,r,l.next)>=0&&Ro(l,l.prev,r)>=0:Ro(l,r,l.prev)<0||Ro(l,l.next,r)<0}function vf(l,r){const a=$p(l.i,l.x,l.y),h=$p(r.i,r.x,r.y),m=l.next,y=r.prev;return l.next=r,r.prev=l,a.next=m,m.prev=a,h.next=a,a.prev=h,y.next=h,h.prev=y,h}function nC(l,r,a,h){const m=$p(l,r,a);return h?(m.next=h.next,m.prev=h,h.next.prev=m,h.next=m):(m.prev=m,m.next=m),m}function bf(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function $p(l,r,a){return{i:l,x:r,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class fl{constructor(r,a){if(a>r)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=r,this._minGranularity=a}getGranularityForZoomLevel(r){return Math.max(Math.floor(this._baseZoomGranularity/(1<<r)),this._minGranularity,1)}}class Gp{constructor(r){this.fill=r.fill,this.line=r.line,this.tile=r.tile,this.stencil=r.stencil,this.circle=r.circle}}Gp.noSubdivision=new Gp({fill:new fl(0,0),line:new fl(0,0),tile:new fl(0,0),stencil:new fl(0,0),circle:1}),hn("SubdivisionGranularityExpression",fl),hn("SubdivisionGranularitySetting",Gp);const xf=-32768,ao=32767;class Hp{constructor(r,a){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=r,this._granularityCellSize=pt/r,this._canonical=a}_getKey(r,a){return(r+=32768)<<16|a+32768}_vertexToIndex(r,a){if(r<-32768||a<-32768||r>32767||a>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const h=0|Math.round(r),m=0|Math.round(a),y=this._getKey(h,m);if(this._vertexDictionary.has(y))return this._vertexDictionary.get(y);const b=this._vertexBuffer.length/2;return this._vertexDictionary.set(y,b),this._vertexBuffer.push(h,m),b}_subdivideTrianglesScanline(r){if(this._granularity<2)return function(m,y){const b=[];for(let D=0;D<y.length;D+=3){const S=y[D],k=y[D+1],F=y[D+2],$=m[2*S],G=m[2*S+1];(m[2*k]-$)*(m[2*F+1]-G)-(m[2*k+1]-G)*(m[2*F]-$)>0?(b.push(S),b.push(F),b.push(k)):(b.push(S),b.push(k),b.push(F))}return b}(this._vertexBuffer,r);const a=[],h=r.length;for(let m=0;m<h;m+=3){const y=[r[m+0],r[m+1],r[m+2]],b=[this._vertexBuffer[2*r[m+0]+0],this._vertexBuffer[2*r[m+0]+1],this._vertexBuffer[2*r[m+1]+0],this._vertexBuffer[2*r[m+1]+1],this._vertexBuffer[2*r[m+2]+0],this._vertexBuffer[2*r[m+2]+1]];let D=1/0,S=1/0,k=-1/0,F=-1/0;for(let Q=0;Q<3;Q++){const re=b[2*Q],ye=b[2*Q+1];D=Math.min(D,re),k=Math.max(k,re),S=Math.min(S,ye),F=Math.max(F,ye)}if(D===k||S===F)continue;const $=Math.floor(D/this._granularityCellSize),G=Math.ceil(k/this._granularityCellSize),W=Math.floor(S/this._granularityCellSize),X=Math.ceil(F/this._granularityCellSize);if($!==G||W!==X)for(let Q=W;Q<X;Q++){const re=this._scanlineGenerateVertexRingForCellRow(Q,b,y);a2(this._vertexBuffer,re,a)}else a.push(...y)}return a}_scanlineGenerateVertexRingForCellRow(r,a,h){const m=r*this._granularityCellSize,y=m+this._granularityCellSize,b=[];for(let D=0;D<3;D++){const S=a[2*D],k=a[2*D+1],F=a[2*(D+1)%6],$=a[(2*(D+1)+1)%6],G=a[2*(D+2)%6],W=a[(2*(D+2)+1)%6],X=F-S,Q=$-k,re=0===X,ye=0===Q,Ae=(m-k)/Q,Ce=(y-k)/Q,Me=Math.min(Ae,Ce),Ge=Math.max(Ae,Ce);if(!ye&&(Me>=1||Ge<=0)||ye&&(k<m||k>y)){$>=m&&$<=y&&b.push(h[(D+1)%3]);continue}!ye&&Me>0&&b.push(this._vertexToIndex(S+X*Me,k+Q*Me));const Xe=S+X*Math.max(Me,0),mt=S+X*Math.min(Ge,1);re||this._generateIntraEdgeVertices(b,S,k,F,$,Xe,mt),!ye&&Ge<1&&b.push(this._vertexToIndex(S+X*Ge,k+Q*Ge)),(ye||$>=m&&$<=y)&&b.push(h[(D+1)%3]),!ye&&($<=m||$>=y)&&this._generateInterEdgeVertices(b,S,k,F,$,G,W,mt,m,y)}return b}_generateIntraEdgeVertices(r,a,h,m,y,b,D){const S=m-a,k=y-h,F=0===k,$=F?Math.min(a,m):Math.min(b,D),G=F?Math.max(a,m):Math.max(b,D),W=Math.floor($/this._granularityCellSize)+1,X=Math.ceil(G/this._granularityCellSize)-1;if(F?a<m:b<D)for(let Q=W;Q<=X;Q++){const re=Q*this._granularityCellSize;r.push(this._vertexToIndex(re,h+k*(re-a)/S))}else for(let Q=X;Q>=W;Q--){const re=Q*this._granularityCellSize;r.push(this._vertexToIndex(re,h+k*(re-a)/S))}}_generateInterEdgeVertices(r,a,h,m,y,b,D,S,k,F){const $=y-h,G=b-m,W=D-y,X=(k-y)/W,Q=(F-y)/W,re=Math.min(X,Q),ye=Math.max(X,Q),Ae=m+G*re;let Ce=Math.floor(Math.min(Ae,S)/this._granularityCellSize)+1,Me=Math.ceil(Math.max(Ae,S)/this._granularityCellSize)-1,Ge=S<Ae;const Xe=0===W;if(Xe&&(D===k||D===F))return;if(Xe||re>=1||ye<=0){const Lt=h-D,Pt=b+(a-b)*Math.min((k-D)/Lt,(F-D)/Lt);Ce=Math.floor(Math.min(Pt,S)/this._granularityCellSize)+1,Me=Math.ceil(Math.max(Pt,S)/this._granularityCellSize)-1,Ge=S<Pt}const mt=$>0?F:k;if(Ge)for(let Lt=Ce;Lt<=Me;Lt++)r.push(this._vertexToIndex(Lt*this._granularityCellSize,mt));else for(let Lt=Me;Lt>=Ce;Lt--)r.push(this._vertexToIndex(Lt*this._granularityCellSize,mt))}_generateOutline(r){const a=[];for(const h of r){const m=Ih(h,this._granularity,!0),y=this._pointArrayToIndices(m),b=[];for(let D=1;D<y.length;D++)b.push(y[D-1]),b.push(y[D]);a.push(b)}return a}_handlePoles(r){let a=!1,h=!1;this._canonical&&(0===this._canonical.y&&(a=!0),this._canonical.y===(1<<this._canonical.z)-1&&(h=!0)),(a||h)&&this._fillPoles(r,a,h)}_ensureNoPoleVertices(){const r=this._vertexBuffer;for(let a=0;a<r.length;a+=2){const h=r[a+1];h===xf&&(r[a+1]=-32767),h===ao&&(r[a+1]=32766)}}_generatePoleQuad(r,a,h,m,y,b){m>y!=(b===xf)?(r.push(a),r.push(h),r.push(this._vertexToIndex(m,b)),r.push(h),r.push(this._vertexToIndex(y,b)),r.push(this._vertexToIndex(m,b))):(r.push(h),r.push(a),r.push(this._vertexToIndex(m,b)),r.push(this._vertexToIndex(y,b)),r.push(h),r.push(this._vertexToIndex(m,b)))}_fillPoles(r,a,h){const m=this._vertexBuffer,y=pt,b=r.length;for(let D=2;D<b;D+=3){const S=r[D-2],k=r[D-1],F=r[D],$=m[2*S],G=m[2*S+1],W=m[2*k],X=m[2*k+1],Q=m[2*F],re=m[2*F+1];a&&(0===G&&0===X&&this._generatePoleQuad(r,S,k,$,W,xf),0===X&&0===re&&this._generatePoleQuad(r,k,F,W,Q,xf),0===re&&0===G&&this._generatePoleQuad(r,F,S,Q,$,xf)),h&&(G===y&&X===y&&this._generatePoleQuad(r,S,k,$,W,ao),X===y&&re===y&&this._generatePoleQuad(r,k,F,W,Q,ao),re===y&&G===y&&this._generatePoleQuad(r,F,S,Q,$,ao))}}_initializeVertices(r){for(let a=0;a<r.length;a+=2)this._vertexToIndex(r[a],r[a+1])}subdividePolygonInternal(r,a){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:h,holeIndices:m}=function(D){const S=[],k=[];for(const F of D)if(0!==F.length){F!==D[0]&&S.push(k.length/2);for(let $=0;$<F.length;$++)k.push(F[$].x),k.push(F[$].y)}return{flattened:k,holeIndices:S}}(r);let y;this._initializeVertices(h);try{const D=function(k,F,$=2){const G=F&&F.length,W=G?F[0]*$:k.length;let X=_y(k,0,W,$,!0);const Q=[];if(!X||X.next===X.prev)return Q;let re,ye,Ae;if(G&&(X=function(Ce,Me,Ge,Xe){const mt=[];for(let Lt=0,Pt=Me.length;Lt<Pt;Lt++){const Vt=_y(Ce,Me[Lt]*Xe,Lt<Pt-1?Me[Lt+1]*Xe:Ce.length,Xe,!1);Vt===Vt.next&&(Vt.steiner=!0),mt.push(ub(Vt))}mt.sort(Jw);for(let Lt=0;Lt<mt.length;Lt++)Ge=eC(mt[Lt],Ge);return Ge}(k,F,X,$)),k.length>80*$){re=k[0],ye=k[1];let Ce=re,Me=ye;for(let Ge=$;Ge<W;Ge+=$){const Xe=k[Ge],mt=k[Ge+1];Xe<re&&(re=Xe),mt<ye&&(ye=mt),Xe>Ce&&(Ce=Xe),mt>Me&&(Me=mt)}Ae=Math.max(Ce-re,Me-ye),Ae=0!==Ae?32767/Ae:0}return jp(X,Q,$,re,ye,Ae,0),Q}(h,m),S=this._convertIndices(h,D);y=this._subdivideTrianglesScanline(S)}catch(D){console.error(D)}let b=[];return a&&(b=this._generateOutline(r)),this._ensureNoPoleVertices(),this._handlePoles(y),{verticesFlattened:this._vertexBuffer,indicesTriangles:y,indicesLineList:b}}_convertIndices(r,a){const h=[];for(let m=0;m<a.length;m++)h.push(this._vertexToIndex(r[2*a[m]],r[2*a[m]+1]));return h}_pointArrayToIndices(r){const a=[];for(let h=0;h<r.length;h++){const m=r[h];a.push(this._vertexToIndex(m.x,m.y))}return a}}function yy(l,r,a,h=!0){return new Hp(a,r).subdividePolygonInternal(l,h)}function Ih(l,r,a=!1){if(!l||l.length<1)return[];if(l.length<2)return[];const h=l[0],m=l[l.length-1],y=a&&(h.x!==m.x||h.y!==m.y);if(r<2)return y?[...l,l[0]]:[...l];const b=Math.floor(pt/r),D=[];D.push(new Z(l[0].x,l[0].y));const S=l.length,k=y?S:S-1;for(let F=0;F<k;F++){const $=l[F],G=F<S-1?l[F+1]:l[0],W=$.x,X=$.y,Q=G.x,re=G.y,ye=W!==Q,Ae=X!==re;if(!ye&&!Ae)continue;const Ce=Q-W,Me=re-X,Ge=Math.abs(Ce),Xe=Math.abs(Me);let mt=W,Lt=X;for(;;){const Vt=Ce>0?(Math.floor(mt/b)+1)*b:(Math.ceil(mt/b)-1)*b,dn=Me>0?(Math.floor(Lt/b)+1)*b:(Math.ceil(Lt/b)-1)*b,Jt=Math.abs(mt-Vt),Kt=Math.abs(Lt-dn),It=Math.abs(mt-Q),Vn=Math.abs(Lt-re),jn=ye?Jt/Ge:Number.POSITIVE_INFINITY,qn=Ae?Kt/Xe:Number.POSITIVE_INFINITY;if((It<=Jt||!ye)&&(Vn<=Kt||!Ae))break;if(jn<qn&&ye||!Ae){mt=Vt,Lt+=Me*jn;const Dn=new Z(mt,Math.round(Lt));D[D.length-1].x===Dn.x&&D[D.length-1].y===Dn.y||D.push(Dn)}else{mt+=Ce*qn,Lt=dn;const Dn=new Z(Math.round(mt),Lt);D[D.length-1].x===Dn.x&&D[D.length-1].y===Dn.y||D.push(Dn)}}const Pt=new Z(Q,re);D[D.length-1].x===Pt.x&&D[D.length-1].y===Pt.y||D.push(Pt)}return D}function a2(l,r,a){if(0===r.length)throw new Error("Subdivision vertex ring is empty.");let h=0,m=l[2*r[0]];for(let S=1;S<r.length;S++){const k=l[2*r[S]];k<m&&(m=k,h=S)}const y=r.length;let b=h,D=(b+1)%y;for(;;){const S=b-1>=0?b-1:y-1,k=(D+1)%y,F=l[2*r[S]],$=l[2*r[k]],G=l[2*r[b]],W=l[2*r[b]+1],X=l[2*r[D]+1];let Q=!1;if(F<$)Q=!0;else if(F>$)Q=!1;else{const re=X-W,ye=-(l[2*r[D]]-G),Ae=W<X?1:-1;((F-G)*re+(l[2*r[S]+1]-W)*ye)*Ae>(($-G)*re+(l[2*r[k]+1]-W)*ye)*Ae&&(Q=!0)}if(Q){const re=r[S],ye=r[b],Ae=r[D];re!==ye&&re!==Ae&&ye!==Ae&&a.push(Ae,ye,re),b--,b<0&&(b=y-1)}else{const re=r[k],ye=r[b],Ae=r[D];re!==ye&&re!==Ae&&ye!==Ae&&a.push(Ae,ye,re),D++,D>=y&&(D=0)}if(S===k)break}}function xg(l,r,a,h,m,y,b,D,S){const k=m.length/2,F=b&&D&&S;if(k<pi.MAX_VERTEX_ARRAY_LENGTH){const $=r.prepareSegment(k,a,h),G=$.vertexLength;for(let Q=0;Q<y.length;Q+=3)h.emplaceBack(G+y[Q],G+y[Q+1],G+y[Q+2]);let W,X;$.vertexLength+=k,$.primitiveLength+=y.length/3,F&&(X=b.prepareSegment(k,a,D),W=X.vertexLength,X.vertexLength+=k);for(let Q=0;Q<m.length;Q+=2)l(m[Q],m[Q+1]);if(F)for(let Q=0;Q<S.length;Q++){const re=S[Q];for(let ye=1;ye<re.length;ye+=2)D.emplaceBack(W+re[ye-1],W+re[ye]);X.primitiveLength+=re.length/2}}else(function($,G,W,X,Q,re){const ye=[];for(let Xe=0;Xe<X.length/2;Xe++)ye.push(-1);const Ae={count:0};let Ce=0,Me=$.getOrCreateLatestSegment(G,W),Ge=Me.vertexLength;for(let Xe=2;Xe<Q.length;Xe+=3){const mt=Q[Xe-2],Lt=Q[Xe-1],Pt=Q[Xe];let Vt=ye[mt]<Ce,dn=ye[Lt]<Ce,Jt=ye[Pt]<Ce;Me.vertexLength+((Vt?1:0)+(dn?1:0)+(Jt?1:0))>pi.MAX_VERTEX_ARRAY_LENGTH&&(Me=$.createNewSegment(G,W),Ce=Ae.count,Vt=!0,dn=!0,Jt=!0,Ge=0);const Kt=Ph(ye,X,re,Ae,mt,Vt,Me),It=Ph(ye,X,re,Ae,Lt,dn,Me),Vn=Ph(ye,X,re,Ae,Pt,Jt,Me);W.emplaceBack(Ge+Kt-Ce,Ge+It-Ce,Ge+Vn-Ce),Me.primitiveLength++}})(r,a,h,m,y,l),F&&function($,G,W,X,Q,re){const ye=[];for(let Xe=0;Xe<X.length/2;Xe++)ye.push(-1);const Ae={count:0};let Ce=0,Me=$.getOrCreateLatestSegment(G,W),Ge=Me.vertexLength;for(let Xe=0;Xe<Q.length;Xe++){const mt=Q[Xe];for(let Lt=1;Lt<Q[Xe].length;Lt+=2){const Pt=mt[Lt-1],Vt=mt[Lt];let dn=ye[Pt]<Ce,Jt=ye[Vt]<Ce;Me.vertexLength+((dn?1:0)+(Jt?1:0))>pi.MAX_VERTEX_ARRAY_LENGTH&&(Me=$.createNewSegment(G,W),Ce=Ae.count,dn=!0,Jt=!0,Ge=0);const Kt=Ph(ye,X,re,Ae,Pt,dn,Me),It=Ph(ye,X,re,Ae,Vt,Jt,Me);W.emplaceBack(Ge+Kt-Ce,Ge+It-Ce),Me.primitiveLength++}}}(b,a,D,m,S,l),r.forceNewSegmentOnNextPrepare(),b?.forceNewSegmentOnNextPrepare()}function Ph(l,r,a,h,m,y,b){if(y){const D=h.count;return a(r[2*m],r[2*m+1]),l[m]=h.count,h.count++,b.vertexLength++,D}return l[m]}class vy{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new je,this.indexArray=new $t,this.indexArray2=new Ft,this.programConfigurations=new Kc(r.layers,r.zoom),this.segments=new pi,this.segments2=new pi,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,h){this.hasDependencies=_f("fill",this.layers,a);const m=this.layers[0].layout.get("fill-sort-key"),y=!m.isConstant(),b=[];for(const{feature:D,id:S,index:k,sourceLayerIndex:F}of r){const $=this.layers[0]._featureFilter.needGeometry,G=hl(D,$);if(!this.layers[0]._featureFilter.filter(new Dr(this.zoom),G,h))continue;const W=y?m.evaluate(G,{},h,a.availableImages):void 0,X={id:S,properties:D.properties,type:D.type,sourceLayerIndex:F,index:k,geometry:$?G.geometry:Gl(D),patterns:{},sortKey:W};b.push(X)}y&&b.sort((D,S)=>D.sortKey-S.sortKey);for(const D of b){const{geometry:S,index:k,sourceLayerIndex:F}=D;if(this.hasDependencies){const $=yf("fill",this.layers,D,{zoom:this.zoom},a);this.patternFeatures.push($)}else this.addFeature(D,S,k,h,{},a.subdivisionGranularity);a.featureIndex.insert(r[k].feature,S,k,F,this.index)}}update(r,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,{imagePositions:h})}addFeatures(r,a,h){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,a,h,r.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,ab),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,a,h,m,y,b){for(const D of Na(a,500)){const S=yy(D,m,b.fill.getGranularityForZoomLevel(m.z)),k=this.layoutVertexArray;xg((F,$)=>{k.emplaceBack(F,$)},this.segments,this.layoutVertexArray,this.indexArray,S.verticesFlattened,S.indicesTriangles,this.segments2,this.indexArray2,S.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,{imagePositions:y,canonical:m})}}let Cr,hb;hn("FillBucket",vy,{omit:["layers","patternFeatures"]});var by={get paint(){return hb=hb||new gi({"fill-antialias":new In(xe.paint_fill["fill-antialias"]),"fill-opacity":new Wn(xe.paint_fill["fill-opacity"]),"fill-color":new Wn(xe.paint_fill["fill-color"]),"fill-outline-color":new Wn(xe.paint_fill["fill-outline-color"]),"fill-translate":new In(xe.paint_fill["fill-translate"]),"fill-translate-anchor":new In(xe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ji(xe.paint_fill["fill-pattern"])})},get layout(){return Cr=Cr||new gi({"fill-sort-key":new Wn(xe.layout_fill["fill-sort-key"])})}};class iC extends ya{constructor(r,a){super(r,by,a)}recalculate(r,a){super.recalculate(r,a);const h=this.paint._values["fill-outline-color"];"constant"===h.value.kind&&void 0===h.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new vy(r)}queryRadius(){return Td(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:r,geometry:a,transform:h,pixelsToTileUnits:m}){return X0(uy(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-h.bearingInRadians,m),a)}isTileClipped(){return!0}}const rC=Ki([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),xy=Ki([{name:"a_centroid",components:2,type:"Int16"}],4),{members:db}=rC;class Sd{constructor(r,a,h,m,y){this.properties={},this.extent=h,this.type=0,this.id=void 0,this._pbf=r,this._geometry=-1,this._keys=m,this._values=y,r.readFields(wy,this,a)}loadGeometry(){const r=this._pbf;r.pos=this._geometry;const a=r.readVarint()+r.pos,h=[];let m,y=1,b=0,D=0,S=0;for(;r.pos<a;){if(b<=0){const k=r.readVarint();y=7&k,b=k>>3}if(b--,1===y||2===y)D+=r.readSVarint(),S+=r.readSVarint(),1===y&&(m&&h.push(m),m=[]),m&&m.push(new Z(D,S));else{if(7!==y)throw new Error(`unknown command ${y}`);m&&m.push(m[0].clone())}}return m&&h.push(m),h}bbox(){const r=this._pbf;r.pos=this._geometry;const a=r.readVarint()+r.pos;let h=1,m=0,y=0,b=0,D=1/0,S=-1/0,k=1/0,F=-1/0;for(;r.pos<a;){if(m<=0){const $=r.readVarint();h=7&$,m=$>>3}if(m--,1===h||2===h)y+=r.readSVarint(),b+=r.readSVarint(),y<D&&(D=y),y>S&&(S=y),b<k&&(k=b),b>F&&(F=b);else if(7!==h)throw new Error(`unknown command ${h}`)}return[D,k,S,F]}toGeoJSON(r,a,h){const m=this.extent*Math.pow(2,h),y=this.extent*r,b=this.extent*a,D=this.loadGeometry();function S(G){return[360*(G.x+y)/m-180,360/Math.PI*Math.atan(Math.exp((1-2*(G.y+b)/m)*Math.PI))-90]}function k(G){return G.map(S)}let F;if(1===this.type){const G=[];for(const X of D)G.push(X[0]);const W=k(G);F=1===G.length?{type:"Point",coordinates:W[0]}:{type:"MultiPoint",coordinates:W}}else if(2===this.type){const G=D.map(k);F=1===G.length?{type:"LineString",coordinates:G[0]}:{type:"MultiLineString",coordinates:G}}else{if(3!==this.type)throw new Error("unknown feature type");{const G=function(X){const Q=X.length;if(Q<=1)return[X];const re=[];let ye,Ae;for(let Ce=0;Ce<Q;Ce++){const Me=oC(X[Ce]);0!==Me&&(void 0===Ae&&(Ae=Me<0),Ae===Me<0?(ye&&re.push(ye),ye=[X[Ce]]):ye&&ye.push(X[Ce]))}return ye&&re.push(ye),re}(D),W=[];for(const X of G)W.push(X.map(k));F=1===W.length?{type:"Polygon",coordinates:W[0]}:{type:"MultiPolygon",coordinates:W}}}const $={type:"Feature",geometry:F,properties:this.properties};return null!=this.id&&($.id=this.id),$}}function wy(l,r,a){1===l?r.id=a.readVarint():2===l?function(h,m){const y=h.readVarint()+h.pos;for(;h.pos<y;){const b=m._keys[h.readVarint()],D=m._values[h.readVarint()];m.properties[b]=D}}(a,r):3===l?r.type=a.readVarint():4===l&&(r._geometry=a.pos)}function oC(l){let r=0;for(let a,h,m=0,y=l.length,b=y-1;m<y;b=m++)a=l[m],h=l[b],r+=(h.x-a.x)*(a.y+h.y);return r}Sd.types=["Unknown","Point","LineString","Polygon"];class fb{constructor(r,a){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(pb,this,a),this.length=this._features.length}feature(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];const a=this._pbf.readVarint()+this._pbf.pos;return new Sd(this._pbf,a,this.extent,this._keys,this._values)}}function pb(l,r,a){15===l?r.version=a.readVarint():1===l?r.name=a.readString():5===l?r.extent=a.readVarint():2===l?r._features.push(a.pos):3===l?r._keys.push(a.readString()):4===l&&r._values.push(function(h){let m=null;const y=h.readVarint()+h.pos;for(;h.pos<y;){const b=h.readVarint()>>3;m=1===b?h.readString():2===b?h.readFloat():3===b?h.readDouble():4===b?h.readVarint64():5===b?h.readVarint():6===b?h.readSVarint():7===b?h.readBoolean():null}if(null==m)throw new Error("unknown feature value");return m}(a))}class mb{constructor(r,a){this.layers=r.readFields(Mc,{},a)}}function Mc(l,r,a){if(3===l){const h=new fb(a,a.readVarint()+a.pos);h.length&&(r[h.name]=h)}}const Cy=Math.pow(2,13);function wf(l,r,a,h,m,y,b,D){l.emplaceBack(r,a,2*Math.floor(h*Cy)+b,m*Cy*2,y*Cy*2,Math.round(D))}class gb{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasDependencies=!1,this.layoutVertexArray=new Re,this.centroidVertexArray=new we,this.indexArray=new $t,this.programConfigurations=new Kc(r.layers,r.zoom),this.segments=new pi,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,h){this.features=[],this.hasDependencies=_f("fill-extrusion",this.layers,a);for(const{feature:m,id:y,index:b,sourceLayerIndex:D}of r){const S=this.layers[0]._featureFilter.needGeometry,k=hl(m,S);if(!this.layers[0]._featureFilter.filter(new Dr(this.zoom),k,h))continue;const F={id:y,sourceLayerIndex:D,index:b,geometry:S?k.geometry:Gl(m),properties:m.properties,type:m.type,patterns:{}};this.hasDependencies?this.features.push(yf("fill-extrusion",this.layers,F,{zoom:this.zoom},a)):this.addFeature(F,F.geometry,b,h,{},a.subdivisionGranularity),a.featureIndex.insert(m,F.geometry,b,D,this.index,!0)}}addFeatures(r,a,h){for(const m of this.features){const{geometry:y}=m;this.addFeature(m,y,m.index,a,h,r.subdivisionGranularity)}}update(r,a,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,{imagePositions:h})}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,db),this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,xy.members,!0),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(r,a,h,m,y,b){for(const D of Na(a,500)){const S={x:0,y:0,sampleCount:0},k=this.layoutVertexArray.length;this.processPolygon(S,m,r,D,b);const F=this.layoutVertexArray.length-k,$=Math.floor(S.x/S.sampleCount),G=Math.floor(S.y/S.sampleCount);for(let W=0;W<F;W++)this.centroidVertexArray.emplaceBack($,G)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,{imagePositions:y,canonical:m})}processPolygon(r,a,h,m,y){if(m.length<1||yb(m[0]))return;for(const $ of m)0!==$.length&&l2(r,$);const b={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},D=y.fill.getGranularityForZoomLevel(a.z),S="Polygon"===Sd.types[h.type];for(const $ of m){if(0===$.length||yb($))continue;const G=Ih($,D,S);this._generateSideFaces(G,b)}if(!S)return;const k=yy(m,a,D,!1),F=this.layoutVertexArray;xg(($,G)=>{wf(F,$,G,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,k.verticesFlattened,k.indicesTriangles)}_generateSideFaces(r,a){let h=0;for(let m=1;m<r.length;m++){const y=r[m],b=r[m-1];if(_b(y,b))continue;a.segment.vertexLength+4>pi.MAX_VERTEX_ARRAY_LENGTH&&(a.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const D=y.sub(b)._perp()._unit(),S=b.dist(y);h+S>32768&&(h=0),wf(this.layoutVertexArray,y.x,y.y,D.x,D.y,0,0,h),wf(this.layoutVertexArray,y.x,y.y,D.x,D.y,0,1,h),h+=S,wf(this.layoutVertexArray,b.x,b.y,D.x,D.y,0,0,h),wf(this.layoutVertexArray,b.x,b.y,D.x,D.y,0,1,h);const k=a.segment.vertexLength;this.indexArray.emplaceBack(k,k+2,k+1),this.indexArray.emplaceBack(k+1,k+2,k+3),a.segment.vertexLength+=4,a.segment.primitiveLength+=2}}}function l2(l,r){for(let a=0;a<r.length;a++){const h=r[a];a===r.length-1&&r[0].x===h.x&&r[0].y===h.y||(l.x+=h.x,l.y+=h.y,l.sampleCount++)}}function _b(l,r){return l.x===r.x&&(l.x<0||l.x>pt)||l.y===r.y&&(l.y<0||l.y>pt)}function yb(l){return l.every(r=>r.x<0)||l.every(r=>r.x>pt)||l.every(r=>r.y<0)||l.every(r=>r.y>pt)}let vb;hn("FillExtrusionBucket",gb,{omit:["layers","features"]});var sC={get paint(){return vb=vb||new gi({"fill-extrusion-opacity":new In(xe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Wn(xe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new In(xe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new In(xe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ji(xe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Wn(xe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Wn(xe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new In(xe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Cf extends ya{constructor(r,a){super(r,sC,a)}createBucket(r){return new gb(r)}queryRadius(){return Td(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:r,feature:a,featureState:h,geometry:m,transform:y,pixelsToTileUnits:b,pixelPosMatrix:D}){const S=uy(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-y.bearingInRadians,b),k=this.paint.get("fill-extrusion-height").evaluate(a,h),F=this.paint.get("fill-extrusion-base").evaluate(a,h),$=function(W,X){const Q=[];for(const re of W){const ye=[re.x,re.y,0,1];pe(ye,ye,X),Q.push(new Z(ye[0]/ye[3],ye[1]/ye[3]))}return Q}(S,D),G=function(W,X,Q,re){const ye=[],Ae=[],Ce=re[8]*X,Me=re[9]*X,Ge=re[10]*X,Xe=re[11]*X,mt=re[8]*Q,Lt=re[9]*Q,Pt=re[10]*Q,Vt=re[11]*Q;for(const dn of W){const Jt=[],Kt=[];for(const It of dn){const Vn=It.x,jn=It.y,qn=re[0]*Vn+re[4]*jn+re[12],Dn=re[1]*Vn+re[5]*jn+re[13],Ii=re[2]*Vn+re[6]*jn+re[14],jr=re[3]*Vn+re[7]*jn+re[15],Fo=Ii+Ge,Os=jr+Xe,gl=qn+mt,oa=Dn+Lt,bs=Ii+Pt,Fs=jr+Vt,uo=new Z((qn+Ce)/Os,(Dn+Me)/Os);uo.z=Fo/Os,Jt.push(uo);const No=new Z(gl/Fs,oa/Fs);No.z=bs/Fs,Kt.push(No)}ye.push(Jt),Ae.push(Kt)}return[ye,Ae]}(m,F,k,D);return function(W,X,Q){let re=1/0;X0(Q,X)&&(re=Ty(Q,X[0]));for(let ye=0;ye<X.length;ye++){const Ae=X[ye],Ce=W[ye];for(let Me=0;Me<Ae.length-1;Me++){const Ge=Ae[Me],Xe=[Ge,Ae[Me+1],Ce[Me+1],Ce[Me],Ge];Ww(Q,Xe)&&(re=Math.min(re,Ty(Q,Xe)))}}return re!==1/0&&re}(G[0],G[1],$)}}function Rs(l,r){return l.x*r.x+l.y*r.y}function Ty(l,r){if(1===l.length){let a=0;const h=r[a++];let m;for(;!m||h.equals(m);)if(m=r[a++],!m)return 1/0;for(;a<r.length;a++){const y=r[a],b=l[0],D=m.sub(h),S=y.sub(h),k=b.sub(h),F=Rs(D,D),$=Rs(D,S),G=Rs(S,S),W=Rs(k,D),X=Rs(k,S),Q=F*G-$*$,re=(G*W-$*X)/Q,ye=(F*X-$*W)/Q,Ae=h.z*(1-re-ye)+m.z*re+y.z*ye;if(isFinite(Ae))return Ae}return 1/0}{let a=1/0;for(const h of r)a=Math.min(a,h.z);return a}}const bb=Ki([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:c2}=bb,pl=Ki([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:wg}=pl,xb=Math.cos(Math.PI/180*37.5),wb=Math.pow(2,14)/.5;class Dy{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new $e,this.layoutVertexArray2=new Ye,this.indexArray=new $t,this.programConfigurations=new Kc(r.layers,r.zoom),this.segments=new pi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,h){this.hasDependencies=_f("line",this.layers,a)||this.hasLineDasharray(this.layers);const m=this.layers[0].layout.get("line-sort-key"),y=!m.isConstant(),b=[];for(const{feature:D,id:S,index:k,sourceLayerIndex:F}of r){const $=this.layers[0]._featureFilter.needGeometry,G=hl(D,$);if(!this.layers[0]._featureFilter.filter(new Dr(this.zoom),G,h))continue;const W=y?m.evaluate(G,{},h):void 0,X={id:S,properties:D.properties,type:D.type,sourceLayerIndex:F,index:k,geometry:$?G.geometry:Gl(D),patterns:{},dashes:{},sortKey:W};b.push(X)}y&&b.sort((D,S)=>D.sortKey-S.sortKey);for(const D of b){const{geometry:S,index:k,sourceLayerIndex:F}=D;this.hasDependencies?(_f("line",this.layers,a)?yf("line",this.layers,D,{zoom:this.zoom},a):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,D,this.zoom,a),this.patternFeatures.push(D)):this.addFeature(D,S,k,h,{},{},a.subdivisionGranularity),a.featureIndex.insert(r[k].feature,S,k,F,this.index)}}update(r,a,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,{imagePositions:h,dashPositions:m})}addFeatures(r,a,h,m){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,a,h,m,r.subdivisionGranularity)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,wg)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,c2),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,a,h,m,y,b,D){const S=this.layers[0].layout,k=S.get("line-join").evaluate(r,{}),F=S.get("line-cap"),$=S.get("line-miter-limit"),G=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const W of a)this.addLine(W,r,k,F,$,G,m,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,h,{imagePositions:y,dashPositions:b,canonical:m})}addLine(r,a,h,m,y,b,D,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,r=Ih(r,D?S.line.getGranularityForZoomLevel(D.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ce=0;Ce<r.length-1;Ce++)this.totalDistance+=r[Ce].dist(r[Ce+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const k="Polygon"===Sd.types[a.type];let F=r.length;for(;F>=2&&r[F-1].equals(r[F-2]);)F--;let $=0;for(;$<F-1&&r[$].equals(r[$+1]);)$++;if(F<(k?3:2))return;"bevel"===h&&(y=1.05);const G=this.overscaling<=16?122880/(512*this.overscaling):0,W=this.segments.prepareSegment(10*F,this.layoutVertexArray,this.indexArray);let X,Q,re,ye,Ae;this.e1=this.e2=-1,k&&(X=r[F-2],Ae=r[$].sub(X)._unit()._perp());for(let Ce=$;Ce<F;Ce++){if(re=Ce===F-1?k?r[$+1]:void 0:r[Ce+1],re&&r[Ce].equals(re))continue;Ae&&(ye=Ae),X&&(Q=X),X=r[Ce],Ae=re?re.sub(X)._unit()._perp():ye,ye=ye||Ae;let Me=ye.add(Ae);0===Me.x&&0===Me.y||Me._unit();const Ge=ye.x*Ae.x+ye.y*Ae.y,Xe=Me.x*Ae.x+Me.y*Ae.y,mt=0!==Xe?1/Xe:1/0,Lt=2*Math.sqrt(2-2*Xe),Pt=Xe<xb&&Q&&re,Vt=ye.x*Ae.y-ye.y*Ae.x>0;if(Pt&&Ce>$){const Kt=X.dist(Q);if(Kt>2*G){const It=X.sub(X.sub(Q)._mult(G/Kt)._round());this.updateDistance(Q,It),this.addCurrentVertex(It,ye,0,0,W),Q=It}}const dn=Q&&re;let Jt=dn?h:k?"butt":m;if(dn&&"round"===Jt&&(mt<b?Jt="miter":mt<=2&&(Jt="fakeround")),"miter"===Jt&&mt>y&&(Jt="bevel"),"bevel"===Jt&&(mt>2&&(Jt="flipbevel"),mt<y&&(Jt="miter")),Q&&this.updateDistance(Q,X),"miter"===Jt)Me._mult(mt),this.addCurrentVertex(X,Me,0,0,W);else if("flipbevel"===Jt){if(mt>100)Me=Ae.mult(-1);else{const Kt=mt*ye.add(Ae).mag()/ye.sub(Ae).mag();Me._perp()._mult(Kt*(Vt?-1:1))}this.addCurrentVertex(X,Me,0,0,W),this.addCurrentVertex(X,Me.mult(-1),0,0,W)}else if("bevel"===Jt||"fakeround"===Jt){const Kt=-Math.sqrt(mt*mt-1),It=Vt?Kt:0,Vn=Vt?0:Kt;if(Q&&this.addCurrentVertex(X,ye,It,Vn,W),"fakeround"===Jt){const jn=Math.round(180*Lt/Math.PI/20);for(let qn=1;qn<jn;qn++){let Dn=qn/jn;if(.5!==Dn){const jr=Dn-.5;Dn+=Dn*jr*(Dn-1)*((1.0904+Ge*(Ge*(3.55645-1.43519*Ge)-3.2452))*jr*jr+(.848013+Ge*(.215638*Ge-1.06021)))}const Ii=Ae.sub(ye)._mult(Dn)._add(ye)._unit()._mult(Vt?-1:1);this.addHalfVertex(X,Ii.x,Ii.y,!1,Vt,0,W)}}re&&this.addCurrentVertex(X,Ae,-It,-Vn,W)}else if("butt"===Jt)this.addCurrentVertex(X,Me,0,0,W);else if("square"===Jt){const Kt=Q?1:-1;this.addCurrentVertex(X,Me,Kt,Kt,W)}else"round"===Jt&&(Q&&(this.addCurrentVertex(X,ye,0,0,W),this.addCurrentVertex(X,ye,1,1,W,!0)),re&&(this.addCurrentVertex(X,Ae,-1,-1,W,!0),this.addCurrentVertex(X,Ae,0,0,W)));if(Pt&&Ce<F-1){const Kt=X.dist(re);if(Kt>2*G){const It=X.add(re.sub(X)._mult(G/Kt)._round());this.updateDistance(X,It),this.addCurrentVertex(It,Ae,0,0,W),X=It}}}}addCurrentVertex(r,a,h,m,y,b=!1){const D=a.y*m-a.x,S=-a.y-a.x*m;this.addHalfVertex(r,a.x+a.y*h,a.y-a.x*h,b,!1,h,y),this.addHalfVertex(r,D,S,b,!0,-m,y),this.distance>wb/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(r,a,h,m,y,b))}addHalfVertex({x:r,y:a},h,m,y,b,D,S){const k=.5*(this.lineClips?this.scaledDistance*(wb-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((r<<1)+(y?1:0),(a<<1)+(b?1:0),Math.round(63*h)+128,Math.round(63*m)+128,1+(0===D?0:D<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const F=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,F,this.e2),S.primitiveLength++),b?this.e2=F:this.e1=F}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(r,a){this.distance+=r.dist(a),this.updateScaledDistance()}hasLineDasharray(r){for(const a of r){const h=a.paint.get("line-dasharray");if(h&&!h.isConstant())return!0}return!1}addLineDashDependencies(r,a,h,m){for(const y of r){const b=y.paint.get("line-dasharray");if(!b||"constant"===b.value.kind)continue;const D="round"===y.layout.get("line-cap"),S={dasharray:b.value.evaluate({zoom:h-1},a,{}),round:D},k={dasharray:b.value.evaluate({zoom:h},a,{}),round:D},F={dasharray:b.value.evaluate({zoom:h+1},a,{}),round:D},$=`${S.dasharray.join(",")},${S.round}`,G=`${k.dasharray.join(",")},${k.round}`,W=`${F.dasharray.join(",")},${F.round}`;m.dashDependencies[$]=S,m.dashDependencies[G]=k,m.dashDependencies[W]=F,a.dashes[y.id]={min:$,mid:G,max:W}}}}let Tf,Cb;hn("LineBucket",Dy,{omit:["layers","patternFeatures"]});var Cg={get paint(){return Cb=Cb||new gi({"line-opacity":new Wn(xe.paint_line["line-opacity"]),"line-color":new Wn(xe.paint_line["line-color"]),"line-translate":new In(xe.paint_line["line-translate"]),"line-translate-anchor":new In(xe.paint_line["line-translate-anchor"]),"line-width":new Wn(xe.paint_line["line-width"]),"line-gap-width":new Wn(xe.paint_line["line-gap-width"]),"line-offset":new Wn(xe.paint_line["line-offset"]),"line-blur":new Wn(xe.paint_line["line-blur"]),"line-dasharray":new Ji(xe.paint_line["line-dasharray"]),"line-pattern":new Ji(xe.paint_line["line-pattern"]),"line-gradient":new bh(xe.paint_line["line-gradient"])})},get layout(){return Tf=Tf||new gi({"line-cap":new In(xe.layout_line["line-cap"]),"line-join":new Wn(xe.layout_line["line-join"]),"line-miter-limit":new In(xe.layout_line["line-miter-limit"]),"line-round-limit":new In(xe.layout_line["line-round-limit"]),"line-sort-key":new Wn(xe.layout_line["line-sort-key"])})}};class Tb extends Wn{possiblyEvaluate(r,a){return a=new Dr(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,zoomHistory:a.zoomHistory,transition:a.transition}),super.possiblyEvaluate(r,a)}evaluate(r,a,h,m){return a=Zn({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(r,a,h,m)}}let Ah;class Zp extends ya{constructor(r,a){super(r,Cg,a),this.gradientVersion=0,Ah||(Ah=new Tb(Cg.paint.properties["line-width"].specification),Ah.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(r){if("line-gradient"===r){const a=this.gradientExpression();this.stepInterpolant=!(void 0===a._styleExpression)&&a._styleExpression.expression instanceof Oc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,a){super.recalculate(r,a),this.paint._values["line-floorwidth"]=Ah.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new Dy(r)}queryRadius(r){const a=r,h=My(Eh("line-width",this,a),Eh("line-gap-width",this,a)),m=Eh("line-offset",this,a);return h/2+Math.abs(m)+Td(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:r,feature:a,featureState:h,geometry:m,transform:y,pixelsToTileUnits:b}){const D=uy(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-y.bearingInRadians,b),S=b/2*My(this.paint.get("line-width").evaluate(a,h),this.paint.get("line-gap-width").evaluate(a,h)),k=this.paint.get("line-offset").evaluate(a,h);return k&&(m=function(F,$){const G=[];for(let W=0;W<F.length;W++){const X=F[W],Q=[];for(let re=0;re<X.length;re++){const ye=X[re-1],Ae=X[re],Ce=X[re+1],Me=0===re?new Z(0,0):Ae.sub(ye)._unit()._perp(),Ge=re===X.length-1?new Z(0,0):Ce.sub(Ae)._unit()._perp(),Xe=Me._add(Ge)._unit(),mt=Xe.x*Ge.x+Xe.y*Ge.y;0!==mt&&Xe._mult(1/mt),Q.push(Xe._mult($)._add(Ae))}G.push(Q)}return G}(m,k*b)),function(F,$,G){for(let W=0;W<$.length;W++){const X=$[W];if(F.length>=3)for(let Q=0;Q<X.length;Q++)if(mf(F,X[Q]))return!0;if(K0(F,X,G))return!0}return!1}(D,m,S)}isTileClipped(){return!0}}function My(l,r){return r>0?r+2*l:l}const Tg=Ki([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Dg=Ki([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ki([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const aC=Ki([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Ki([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Db=Ki([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),lC=Ki([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Mb(l,r,a){return l.sections.forEach(h=>{h.text=function(m,y,b){const D=y.layout.get("text-transform").evaluate(b,{});return"uppercase"===D?m=m.toLocaleUpperCase():"lowercase"===D&&(m=m.toLocaleLowerCase()),Pu.applyArabicShaping&&(m=Pu.applyArabicShaping(m)),m}(h.text,r,a)}),l}Ki([{name:"triangle",components:3,type:"Uint16"}]),Ki([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ki([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ki([{type:"Float32",name:"offsetX"}]),Ki([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ki([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const qp={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u22ef":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"},cC={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},ja={40:!0};function Mg(l,r,a,h,m,y){if("fontStack"in r){const b=a[r.fontStack],D=b&&b[l];return D?D.metrics.advance*r.scale+m:0}{const b=h[r.imageName];return b?b.displaySize[0]*r.scale*24/y+m:0}}function Ey(l,r,a,h){const m=Math.pow(l-r,2);return h?l<r?m/2:2*m:m+Math.abs(a)*a}function Sy(l,r,a){let h=0;return 10===l&&(h-=1e4),a&&(h+=150),40!==l&&65288!==l||(h+=50),41!==r&&65289!==r||(h+=50),h}function Sa(l,r,a,h,m,y){let b=null,D=Ey(r,a,m,y);for(const S of h){const k=Ey(r-S.x,a,m,y)+S.badness;k<=D&&(b=S,D=k)}return{index:l,x:r,priorBreak:b,badness:D}}function Df(l){return l?Df(l.priorBreak).concat(l.index):[]}class kh{constructor(r="",a=[],h=[]){this.text=r,this.sections=a,this.sectionIndex=h,this.imageSectionID=null}static fromFeature(r,a){const h=new kh;for(let m=0;m<r.sections.length;m++){const y=r.sections[m];y.image?h.addImageSection(y):h.addTextSection(y,a)}return h}length(){return[...this.text].length}getSection(r){return this.sections[this.sectionIndex[r]]}getSectionIndex(r){return this.sectionIndex[r]}verticalizePunctuation(){this.text=function(r){let a="",h={premature:!0,value:void 0};const m=r[Symbol.iterator]();let y=m.next();const b=r[Symbol.iterator]();b.next();let D=b.next();for(;!y.done;)a+=!D.done&&og(D.value.codePointAt(0))&&!qp[D.value]||!h.premature&&og(h.value.codePointAt(0))&&!qp[h.value]||!qp[y.value]?y.value:qp[y.value],h={value:y.value,premature:!1},y=m.next(),D=b.next();return a}(this.text)}hasZeroWidthSpaces(){return this.text.includes("\u200b")}trim(){const r=this.text.match(/^\s*/),a=r?r[0].length:0,h=this.text.match(/\S\s*$/),m=h?h[0].length-1:0;this.text=this.text.substring(a,this.text.length-m),this.sectionIndex=this.sectionIndex.slice(a,this.sectionIndex.length-m)}substring(r,a){const h=[...this.text].slice(r,a).join(""),m=this.sectionIndex.slice(r,a);return new kh(h,this.sections,m)}toCodeUnitIndex(r){return[...this.text].slice(0,r).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,a)=>Math.max(r,this.sections[a].scale),0)}getMaxImageSize(r){let a=0,h=0;for(let m=0;m<this.length();m++){const y=this.getSection(m);if("imageName"in y){const b=r[y.imageName];if(!b)continue;const D=b.displaySize;a=Math.max(a,D[0]),h=Math.max(h,D[1])}}return{maxImageWidth:a,maxImageHeight:h}}addTextSection(r,a){this.text+=r.text,this.sections.push({scale:r.scale||1,verticalAlign:r.verticalAlign||"bottom",fontStack:r.fontStack||a});const h=this.sections.length-1;this.sectionIndex.push(...[...r.text].map(()=>h))}addImageSection(r){const a=r.image?r.image.name:"";if(0===a.length)return void ne("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push({scale:1,verticalAlign:r.verticalAlign||"bottom",imageName:a}),this.sectionIndex.push(this.sections.length-1)):ne("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(r,a,h,m,y){const b=[],D=this.determineAverageLineWidth(r,a,h,m,y),S=this.hasZeroWidthSpaces();let k=0,F=0;const $=this.text[Symbol.iterator]();let G=$.next();const W=this.text[Symbol.iterator]();W.next();let X=W.next();const Q=this.text[Symbol.iterator]();Q.next(),Q.next();let re=Q.next();for(;!G.done;){const ye=this.getSection(F),Ae=G.value.codePointAt(0);if(oy(Ae)||(k+=Mg(Ae,ye,h,m,r,y)),!X.done){const Ce=W0(Ae),Me=X.value.codePointAt(0);(cC[Ae]||Ce||"imageName"in ye||!re.done&&ja[Me])&&b.push(Sa(F+1,k,D,b,Sy(Ae,Me,Ce&&S),!1))}F++,G=$.next(),X=W.next(),re=Q.next()}return Df(Sa(this.length(),k,D,b,0,!0))}determineAverageLineWidth(r,a,h,m,y){let b=0,D=0;for(const S of this.text){const k=this.getSection(D);b+=Mg(S.codePointAt(0),k,h,m,r,y),D++}return b/Math.max(1,Math.ceil(b/a))}}const Eg=4294967296,Eb=1/Eg,Iy=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Py{constructor(r=new Uint8Array(16)){this.buf=ArrayBuffer.isView(r)?r:new Uint8Array(r),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(r,a,h=this.length){for(;this.pos<h;){const m=this.readVarint(),y=m>>3,b=this.pos;this.type=7&m,r(y,a,this),this.pos===b&&this.skip(m)}return a}readMessage(r,a){return this.readFields(r,a,this.readVarint()+this.pos)}readFixed32(){const r=this.dataView.getUint32(this.pos,!0);return this.pos+=4,r}readSFixed32(){const r=this.dataView.getInt32(this.pos,!0);return this.pos+=4,r}readFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Eg;return this.pos+=8,r}readSFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Eg;return this.pos+=8,r}readFloat(){const r=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,r}readDouble(){const r=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,r}readVarint(r){const a=this.buf;let h,m;return m=a[this.pos++],h=127&m,m<128?h:(m=a[this.pos++],h|=(127&m)<<7,m<128?h:(m=a[this.pos++],h|=(127&m)<<14,m<128?h:(m=a[this.pos++],h|=(127&m)<<21,m<128?h:(m=a[this.pos],h|=(15&m)<<28,function(y,b,D){const S=D.buf;let k,F;if(F=S[D.pos++],k=(112&F)>>4,F<128||(F=S[D.pos++],k|=(127&F)<<3,F<128)||(F=S[D.pos++],k|=(127&F)<<10,F<128)||(F=S[D.pos++],k|=(127&F)<<17,F<128)||(F=S[D.pos++],k|=(127&F)<<24,F<128)||(F=S[D.pos++],k|=(1&F)<<31,F<128))return function Id(l,r,a){return a?4294967296*r+(l>>>0):4294967296*(r>>>0)+(l>>>0)}(y,k,b);throw new Error("Expected varint not more than 10 bytes")}(h,r,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const r=this.readVarint();return r%2==1?(r+1)/-2:r/2}readBoolean(){return!!this.readVarint()}readString(){const r=this.readVarint()+this.pos,a=this.pos;return this.pos=r,r-a>=12&&Iy?Iy.decode(this.buf.subarray(a,r)):function(h,m,y){let b="",D=m;for(;D<y;){const S=h[D];let k,F,$,G=null,W=S>239?4:S>223?3:S>191?2:1;if(D+W>y)break;1===W?S<128&&(G=S):2===W?(k=h[D+1],128==(192&k)&&(G=(31&S)<<6|63&k,G<=127&&(G=null))):3===W?(k=h[D+1],F=h[D+2],128==(192&k)&&128==(192&F)&&(G=(15&S)<<12|(63&k)<<6|63&F,(G<=2047||G>=55296&&G<=57343)&&(G=null))):4===W&&(k=h[D+1],F=h[D+2],$=h[D+3],128==(192&k)&&128==(192&F)&&128==(192&$)&&(G=(15&S)<<18|(63&k)<<12|(63&F)<<6|63&$,(G<=65535||G>=1114112)&&(G=null))),null===G?(G=65533,W=1):G>65535&&(G-=65536,b+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),b+=String.fromCharCode(G),D+=W}return b}(this.buf,a,r)}readBytes(){const r=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,r);return this.pos=r,a}readPackedVarint(r=[],a){const h=this.readPackedEnd();for(;this.pos<h;)r.push(this.readVarint(a));return r}readPackedSVarint(r=[]){const a=this.readPackedEnd();for(;this.pos<a;)r.push(this.readSVarint());return r}readPackedBoolean(r=[]){const a=this.readPackedEnd();for(;this.pos<a;)r.push(this.readBoolean());return r}readPackedFloat(r=[]){const a=this.readPackedEnd();for(;this.pos<a;)r.push(this.readFloat());return r}readPackedDouble(r=[]){const a=this.readPackedEnd();for(;this.pos<a;)r.push(this.readDouble());return r}readPackedFixed32(r=[]){const a=this.readPackedEnd();for(;this.pos<a;)r.push(this.readFixed32());return r}readPackedSFixed32(r=[]){const a=this.readPackedEnd();for(;this.pos<a;)r.push(this.readSFixed32());return r}readPackedFixed64(r=[]){const a=this.readPackedEnd();for(;this.pos<a;)r.push(this.readFixed64());return r}readPackedSFixed64(r=[]){const a=this.readPackedEnd();for(;this.pos<a;)r.push(this.readSFixed64());return r}readPackedEnd(){return 2===this.type?this.readVarint()+this.pos:this.pos+1}skip(r){const a=7&r;if(0===a)for(;this.buf[this.pos++]>127;);else if(2===a)this.pos=this.readVarint()+this.pos;else if(5===a)this.pos+=4;else{if(1!==a)throw new Error(`Unimplemented type: ${a}`);this.pos+=8}}writeTag(r,a){this.writeVarint(r<<3|a)}realloc(r){let a=this.length||16;for(;a<this.pos+r;)a*=2;if(a!==this.length){const h=new Uint8Array(a);h.set(this.buf),this.buf=h,this.dataView=new DataView(h.buffer),this.length=a}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeSFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*Eb),!0),this.pos+=8}writeSFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*Eb),!0),this.pos+=8}writeVarint(r){(r=+r||0)>268435455||r<0?function(a,h){let m,y;if(a>=0?(m=a%4294967296|0,y=a/4294967296|0):(m=~(-a%4294967296),y=~(-a/4294967296),4294967295^m?m=m+1|0:(m=0,y=y+1|0)),a>=0x10000000000000000||a<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");var b,S;h.realloc(10),b=m,(S=h).buf[S.pos++]=127&b|128,b>>>=7,S.buf[S.pos++]=127&b|128,b>>>=7,S.buf[S.pos++]=127&b|128,b>>>=7,S.buf[S.pos++]=127&b|128,S.buf[S.pos]=127&(b>>>=7),function(b,D){const S=(7&b)<<4;D.buf[D.pos++]|=S|((b>>>=3)?128:0),b&&(D.buf[D.pos++]=127&b|((b>>>=7)?128:0),b&&(D.buf[D.pos++]=127&b|((b>>>=7)?128:0),b&&(D.buf[D.pos++]=127&b|((b>>>=7)?128:0),b&&(D.buf[D.pos++]=127&b|((b>>>=7)?128:0),b&&(D.buf[D.pos++]=127&b)))))}(y,h)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))}writeSVarint(r){this.writeVarint(r<0?2*-r-1:2*r)}writeBoolean(r){this.writeVarint(+r)}writeString(r){r=String(r),this.realloc(4*r.length),this.pos++;const a=this.pos;this.pos=function(m,y,b){for(let D,S,k=0;k<y.length;k++){if(D=y.charCodeAt(k),D>55295&&D<57344){if(!S){D>56319||k+1===y.length?(m[b++]=239,m[b++]=191,m[b++]=189):S=D;continue}if(D<56320){m[b++]=239,m[b++]=191,m[b++]=189,S=D;continue}D=S-55296<<10|D-56320|65536,S=null}else S&&(m[b++]=239,m[b++]=191,m[b++]=189,S=null);D<128?m[b++]=D:(D<2048?m[b++]=D>>6|192:(D<65536?m[b++]=D>>12|224:(m[b++]=D>>18|240,m[b++]=D>>12&63|128),m[b++]=D>>6&63|128),m[b++]=63&D|128)}return b}(this.buf,r,this.pos);const h=this.pos-a;h>=128&&Sb(a,h,this),this.pos=a-1,this.writeVarint(h),this.pos+=h}writeFloat(r){this.realloc(4),this.dataView.setFloat32(this.pos,r,!0),this.pos+=4}writeDouble(r){this.realloc(8),this.dataView.setFloat64(this.pos,r,!0),this.pos+=8}writeBytes(r){const a=r.length;this.writeVarint(a),this.realloc(a);for(let h=0;h<a;h++)this.buf[this.pos++]=r[h]}writeRawMessage(r,a){this.pos++;const h=this.pos;r(a,this);const m=this.pos-h;m>=128&&Sb(h,m,this),this.pos=h-1,this.writeVarint(m),this.pos+=m}writeMessage(r,a,h){this.writeTag(r,2),this.writeRawMessage(a,h)}writePackedVarint(r,a){a.length&&this.writeMessage(r,Ib,a)}writePackedSVarint(r,a){a.length&&this.writeMessage(r,uC,a)}writePackedBoolean(r,a){a.length&&this.writeMessage(r,fC,a)}writePackedFloat(r,a){a.length&&this.writeMessage(r,hC,a)}writePackedDouble(r,a){a.length&&this.writeMessage(r,dC,a)}writePackedFixed32(r,a){a.length&&this.writeMessage(r,Pb,a)}writePackedSFixed32(r,a){a.length&&this.writeMessage(r,Ab,a)}writePackedFixed64(r,a){a.length&&this.writeMessage(r,kb,a)}writePackedSFixed64(r,a){a.length&&this.writeMessage(r,Sg,a)}writeBytesField(r,a){this.writeTag(r,2),this.writeBytes(a)}writeFixed32Field(r,a){this.writeTag(r,5),this.writeFixed32(a)}writeSFixed32Field(r,a){this.writeTag(r,5),this.writeSFixed32(a)}writeFixed64Field(r,a){this.writeTag(r,1),this.writeFixed64(a)}writeSFixed64Field(r,a){this.writeTag(r,1),this.writeSFixed64(a)}writeVarintField(r,a){this.writeTag(r,0),this.writeVarint(a)}writeSVarintField(r,a){this.writeTag(r,0),this.writeSVarint(a)}writeStringField(r,a){this.writeTag(r,2),this.writeString(a)}writeFloatField(r,a){this.writeTag(r,5),this.writeFloat(a)}writeDoubleField(r,a){this.writeTag(r,1),this.writeDouble(a)}writeBooleanField(r,a){this.writeVarintField(r,+a)}}function Sb(l,r,a){const h=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));a.realloc(h);for(let m=a.pos-1;m>=l;m--)a.buf[m+h]=a.buf[m]}function Ib(l,r){for(let a=0;a<l.length;a++)r.writeVarint(l[a])}function uC(l,r){for(let a=0;a<l.length;a++)r.writeSVarint(l[a])}function hC(l,r){for(let a=0;a<l.length;a++)r.writeFloat(l[a])}function dC(l,r){for(let a=0;a<l.length;a++)r.writeDouble(l[a])}function fC(l,r){for(let a=0;a<l.length;a++)r.writeBoolean(l[a])}function Pb(l,r){for(let a=0;a<l.length;a++)r.writeFixed32(l[a])}function Ab(l,r){for(let a=0;a<l.length;a++)r.writeSFixed32(l[a])}function kb(l,r){for(let a=0;a<l.length;a++)r.writeFixed64(l[a])}function Sg(l,r){for(let a=0;a<l.length;a++)r.writeSFixed64(l[a])}function Rb(l,r,a){1===l&&a.readMessage(Lb,r)}function Lb(l,r,a){if(3===l){const{id:h,bitmap:m,width:y,height:b,left:D,top:S,advance:k}=a.readMessage(Ob,{});r.push({id:h,bitmap:new Sh({width:y+6,height:b+6},m),metrics:{width:y,height:b,left:D,top:S,advance:k}})}}function Ob(l,r,a){1===l?r.id=a.readVarint():2===l?r.bitmap=a.readBytes():3===l?r.width=a.readVarint():4===l?r.height=a.readVarint():5===l?r.left=a.readSVarint():6===l?r.top=a.readSVarint():7===l&&(r.advance=a.readVarint())}function Ay(l){let r=0,a=0;for(const b of l)r+=b.w*b.h,a=Math.max(a,b.w);l.sort((b,D)=>D.h-b.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),a),h:1/0}];let m=0,y=0;for(const b of l)for(let D=h.length-1;D>=0;D--){const S=h[D];if(!(b.w>S.w||b.h>S.h)){if(b.x=S.x,b.y=S.y,y=Math.max(y,b.y+b.h),m=Math.max(m,b.x+b.w),b.w===S.w&&b.h===S.h){const k=h.pop();k&&D<h.length&&(h[D]=k)}else b.h===S.h?(S.x+=b.w,S.w-=b.w):b.w===S.w?(S.y+=b.h,S.h-=b.h):(h.push({x:S.x+b.w,y:S.y,w:S.w-b.w,h:b.h}),S.y+=b.h,S.h-=b.h);break}}return{w:m,h:y,fill:r/(m*y)||0}}class ky{constructor(r,{pixelRatio:a,version:h,stretchX:m,stretchY:y,content:b,textFitWidth:D,textFitHeight:S}){this.paddedRect=r,this.pixelRatio=a,this.stretchX=m,this.stretchY=y,this.content=b,this.version=h,this.textFitWidth=D,this.textFitHeight=S}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Fb{constructor(r,a){const h={},m={};this.haveRenderCallbacks=[];const y=[];this.addImages(r,h,y),this.addImages(a,m,y);const{w:b,h:D}=Ay(y),S=new _s({width:b||1,height:D||1});for(const k in r){const F=r[k],$=h[k].paddedRect;_s.copy(F.data,S,{x:0,y:0},{x:$.x+1,y:$.y+1},F.data)}for(const k in a){const F=a[k],$=m[k].paddedRect,G=$.x+1,W=$.y+1,X=F.data.width,Q=F.data.height;_s.copy(F.data,S,{x:0,y:0},{x:G,y:W},F.data),_s.copy(F.data,S,{x:0,y:Q-1},{x:G,y:W-1},{width:X,height:1}),_s.copy(F.data,S,{x:0,y:0},{x:G,y:W+Q},{width:X,height:1}),_s.copy(F.data,S,{x:X-1,y:0},{x:G-1,y:W},{width:1,height:Q}),_s.copy(F.data,S,{x:0,y:0},{x:G+X,y:W},{width:1,height:Q})}this.image=S,this.iconPositions=h,this.patternPositions=m}addImages(r,a,h){for(const m in r){const y=r[m],b={x:0,y:0,w:y.data.width+2,h:y.data.height+2};h.push(b),a[m]=new ky(b,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(r,a){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in r.updatedImages)this.patchUpdatedImage(this.iconPositions[h],r.getImage(h),a),this.patchUpdatedImage(this.patternPositions[h],r.getImage(h),a)}patchUpdatedImage(r,a,h){if(!r||!a||r.version===a.version)return;r.version=a.version;const[m,y]=r.tl;h.update(a.data,void 0,{x:m,y})}}var Rh;function Ig(l,r,a,h,m,y,b,D,S,k,F,$,G,W,X){const Q=kh.fromFeature(l,m);let re;$===I.ay.vertical&&Q.verticalizePunctuation();let ye=Q.determineLineBreaks(k,y,r,h,W);const{processBidirectionalText:Ae,processStyledBidirectionalText:Ce}=Pu;if(Ae&&1===Q.sections.length){re=[],ye=ye.map(mt=>Q.toCodeUnitIndex(mt));const Xe=Ae(Q.toString(),ye);for(const mt of Xe){const Lt=[...mt].map(()=>0);re.push(new kh(mt,Q.sections,Lt))}}else if(Ce){re=[],ye=ye.map(Pt=>Q.toCodeUnitIndex(Pt));let Xe=0;const mt=[];for(const Pt of Q.text)mt.push(...Array(Pt.length).fill(Q.sectionIndex[Xe])),Xe++;const Lt=Ce(Q.text,mt,ye);for(const Pt of Lt){const Vt=[];let dn="";for(const Jt of Pt[0])Vt.push(Pt[1][dn.length]),dn+=Jt;re.push(new kh(Pt[0],Q.sections,Vt))}}else re=function(Xe,mt){const Lt=[];let Pt=0;for(const Vt of mt)Lt.push(Xe.substring(Pt,Vt)),Pt=Vt;return Pt<Xe.length()&&Lt.push(Xe.substring(Pt,Xe.length())),Lt}(Q,ye);const Me=[],Ge={positionedLines:Me,text:Q.toString(),top:F[1],bottom:F[1],left:F[0],right:F[0],writingMode:$,iconsInText:!1,verticalizable:!1};return function(Xe,mt,Lt,Pt,Vt,dn,Jt,Kt,It,Vn,jn,qn){let Dn=0,Ii=0,jr=0,Fo=0;const Os="right"===Kt?1:"left"===Kt?0:.5,gl=24/qn;let oa=0;for(const uo of Vt){uo.trim();const No=uo.getMaxScale(),Ns={positionedGlyphs:[],lineOffset:0};Xe.positionedLines[oa]=Ns;const xs=Ns.positionedGlyphs;let Pa=0;if(!uo.length()){Ii+=dn,++oa;continue}const Rr=Nb(Pt,uo,gl);let zs=0;for(const zo of uo.text){const Ur=uo.getSection(zs),Bo=zo.codePointAt(0),ho=pC(It,jn,Bo),Jo={glyph:Bo,imageName:null,x:Dn,y:Ii+-17,vertical:ho,scale:1,fontStack:"",sectionIndex:uo.getSectionIndex(zs),metrics:null,rect:null};let Hu;if("fontStack"in Ur){if(Hu=mC(Ur,Bo,ho,Rr,mt,Lt),!Hu)continue;Jo.fontStack=Ur.fontStack}else{if(Xe.iconsInText=!0,Ur.scale*=gl,Hu=Bb(Ur,ho,No,Rr,Pt),!Hu)continue;Pa=Math.max(Pa,Hu.imageOffset),Jo.imageName=Ur.imageName}const{rect:Xl,metrics:Jg,baselineOffset:Fd}=Hu;Jo.y+=Fd,Jo.scale=Ur.scale,Jo.metrics=Jg,Jo.rect=Xl,xs.push(Jo),ho?(Xe.verticalizable=!0,Dn+=("imageName"in Ur?Jg.advance:24)*Ur.scale+Vn):Dn+=Jg.advance*Ur.scale+Vn,zs++}0!==xs.length&&(jr=Math.max(Dn-Vn,jr),Ly(xs,0,xs.length-1,Os)),Dn=0,Ns.lineOffset=Math.max(Pa,24*(No-1));const Yl=dn*No+Pa;Ii+=Yl,Fo=Math.max(Yl,Fo),++oa}const{horizontalAlign:bs,verticalAlign:Fs}=Ry(Jt);(function(uo,No,Ns,xs,Pa,Rr,zs,Yl,zo){const Ur=(No-Ns)*Pa;let Bo=0;Bo=Rr!==zs?-Yl*xs- -17:-xs*zo*zs+.5*zs;for(const ho of uo)for(const Jo of ho.positionedGlyphs)Jo.x+=Ur,Jo.y+=Bo})(Xe.positionedLines,Os,bs,Fs,jr,Fo,dn,Ii,Vt.length),Xe.top+=-Fs*Ii,Xe.bottom=Xe.top+Ii,Xe.left+=-bs*jr,Xe.right=Xe.left+jr}(Ge,r,a,h,re,b,D,S,$,k,G,X),!function(Xe){for(const mt of Xe)if(0!==mt.positionedGlyphs.length)return!1;return!0}(Me)&&Ge}function Ry(l){let r=.5,a=.5;switch(l){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:r,verticalAlign:a}}function Nb(l,r,a){const h=24*r.getMaxScale(),{maxImageWidth:m,maxImageHeight:y}=r.getMaxImageSize(l),b=Math.max(h,y*a);return{verticalLineContentWidth:Math.max(h,m*a),horizontalLineContentHeight:b}}function zb(l){switch(l){case"top":return 0;case"center":return.5;default:return 1}}function pC(l,r,a){return!(l===I.ay.horizontal||!r&&!yd(a)||r&&(oy(a)||(h=a,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(h)))));var h}function mC(l,r,a,h,m,y){const b=y[l.fontStack],D=function(k,F,$,G){if(k&&k.rect)return k;const W=F[$.fontStack],X=W&&W[G];return X?{rect:null,metrics:X.metrics}:null}(b&&b[r],m,l,r);if(null===D)return null;let S;if(a)S=h.verticalLineContentWidth-24*l.scale;else{const k=zb(l.verticalAlign);S=(h.horizontalLineContentHeight-24*l.scale)*k}return{rect:D.rect,metrics:D.metrics,baselineOffset:S}}function Bb(l,r,a,h,m){const y=m[l.imageName];if(!y)return null;const b=y.paddedRect,D=y.displaySize,S={width:D[0],height:D[1],left:1,top:-3,advance:r?D[1]:D[0]};let k;if(r)k=h.verticalLineContentWidth-D[1]*l.scale;else{const F=zb(l.verticalAlign);k=(h.horizontalLineContentHeight-D[1]*l.scale)*F}return{rect:b,metrics:S,baselineOffset:k,imageOffset:(r?D[0]:D[1])*l.scale-24*a}}function Ly(l,r,a,h){if(0===h)return;const m=l[a],y=(l[a].x+m.metrics.advance*m.scale)*h;for(let b=r;b<=a;b++)l[b].x-=y}function gC(l,r,a){const{horizontalAlign:h,verticalAlign:m}=Ry(a),y=r[0]-l.displaySize[0]*h,b=r[1]-l.displaySize[1]*m;return{image:l,top:b,bottom:b+l.displaySize[1],left:y,right:y+l.displaySize[0]}}function Ec(l){var r,a;let h=l.left,m=l.top,y=l.right-h,b=l.bottom-m;const D=null!==(r=l.image.textFitWidth)&&void 0!==r?r:"stretchOrShrink",S=null!==(a=l.image.textFitHeight)&&void 0!==a?a:"stretchOrShrink",k=(l.image.content[2]-l.image.content[0])/(l.image.content[3]-l.image.content[1]);if("proportional"===S){if("stretchOnly"===D&&y/b<k||"proportional"===D){const F=Math.ceil(b*k);h*=F/y,y=F}}else if("proportional"===D&&"stretchOnly"===S&&0!==k&&y/b>k){const F=Math.ceil(y/k);m*=F/b,b=F}return{x1:h,y1:m,x2:h+y,y2:m+b}}function eu(l,r,a,h,m,y){const b=l.image;let D;if(b.content){const re=b.content,ye=b.pixelRatio||1;D=[re[0]/ye,re[1]/ye,b.displaySize[0]-re[2]/ye,b.displaySize[1]-re[3]/ye]}const S=r.left*y,k=r.right*y;let F,$,G,W;"width"===a||"both"===a?(W=m[0]+S-h[3],$=m[0]+k+h[1]):(W=m[0]+(S+k-b.displaySize[0])/2,$=W+b.displaySize[0]);const X=r.top*y,Q=r.bottom*y;return"height"===a||"both"===a?(F=m[1]+X-h[0],G=m[1]+Q+h[2]):(F=m[1]+(X+Q-b.displaySize[1])/2,G=F+b.displaySize[1]),{image:b,top:F,right:$,bottom:G,left:W,collisionPadding:D}}hn("ImagePosition",ky),hn("ImageAtlas",Fb),I.ay=void 0,(Rh=I.ay||(I.ay={}))[Rh.none=0]="none",Rh[Rh.horizontal=1]="horizontal",Rh[Rh.vertical=2]="vertical",Rh[Rh.horizontalOnly=3]="horizontalOnly";const Vu=128,tu=32640;function Pg(l,r){const{expression:a}=r;if("constant"===a.kind)return{kind:"constant",layoutSize:a.evaluate(new Dr(l+1))};if("source"===a.kind)return{kind:"source"};{const{zoomStops:h,interpolationType:m}=a;let y=0;for(;y<h.length&&h[y]<=l;)y++;y=Math.max(0,y-1);let b=y;for(;b<h.length&&h[b]<l+1;)b++;b=Math.min(h.length-1,b);const D=h[y],S=h[b];return"composite"===a.kind?{kind:"composite",minZoom:D,maxZoom:S,interpolationType:m}:{kind:"camera",minZoom:D,maxZoom:S,minSize:a.evaluate(new Dr(D)),maxSize:a.evaluate(new Dr(S)),interpolationType:m}}}function Vb(l,r,a){let h="never";const m=l.get(r);return m?h=m:l.get(a)&&(h="always"),h}const u2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Wp(l,r,a,h,m,y,b,D,S,k,F,$,G){const W=D?Math.min(tu,Math.round(D[0])):0,X=D?Math.min(tu,Math.round(D[1])):0;l.emplaceBack(r,a,Math.round(32*h),Math.round(32*m),y,b,(W<<1)+(S?1:0),X,16*k,16*F,256*$,256*G)}function Oy(l,r,a){l.emplaceBack(r.x,r.y,a),l.emplaceBack(r.x,r.y,a),l.emplaceBack(r.x,r.y,a),l.emplaceBack(r.x,r.y,a)}function _C(l){for(const r of l.sections)if(Pp(r.text))return!0;return!1}class jb{constructor(r){this.layoutVertexArray=new gt,this.indexArray=new $t,this.programConfigurations=r,this.segments=new pi,this.dynamicLayoutVertexArray=new lt,this.opacityVertexArray=new ft,this.hasVisibleVertices=!1,this.placedSymbolArray=new O}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(r,a,h,m){this.isEmpty()||(h&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Tg.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,Dg.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,u2,!0),this.opacityVertexBuffer.itemSize=1),(h||m)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}hn("SymbolBuffers",jb);class Fy{constructor(r,a,h){this.layoutVertexArray=new r,this.layoutAttributes=a,this.indexArray=new h,this.segments=new pi,this.collisionVertexArray=new Ht}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,aC.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}hn("CollisionBuffers",Fy);class Zl{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(b=>b.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Pg(this.zoom,a["text-size"]),this.iconSizeData=Pg(this.zoom,a["icon-size"]);const h=this.layers[0].layout,m=h.get("symbol-sort-key"),y=h.get("symbol-z-order");this.canOverlap="never"!==Vb(h,"text-overlap","text-allow-overlap")||"never"!==Vb(h,"icon-overlap","icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==y&&!m.isConstant(),this.sortFeaturesByY=("viewport-y"===y||"auto"===y&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===h.get("symbol-placement")&&(this.writingModes=h.get("text-writing-mode").map(b=>I.ay[b])),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=r.sourceID}createArrays(){this.text=new jb(new Kc(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new jb(new Kc(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new H,this.lineVertexArray=new q,this.symbolInstances=new N,this.textAnchorOffsets=new ce}calculateGlyphDependencies(r,a,h,m,y){for(const b of r)if(a[b.codePointAt(0)]=!0,(h||m)&&y){const D=qp[b];D&&(a[D.codePointAt(0)]=!0)}}populate(r,a,h){const m=this.layers[0],y=m.layout,b=y.get("text-font"),D=y.get("text-field"),S=y.get("icon-image"),k=("constant"!==D.value.kind||D.value.value instanceof go&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&("constant"!==b.value.kind||b.value.value.length>0),F="constant"!==S.value.kind||!!S.value.value||Object.keys(S.parameters).length>0,$=y.get("symbol-sort-key");if(this.features=[],!k&&!F)return;const G=a.iconDependencies,W=a.glyphDependencies,X=a.availableImages,Q=new Dr(this.zoom);for(const{feature:re,id:ye,index:Ae,sourceLayerIndex:Ce}of r){const Me=m._featureFilter.needGeometry,Ge=hl(re,Me);if(!m._featureFilter.filter(Q,Ge,h))continue;let Xe,mt;if(Me||(Ge.geometry=Gl(re)),k){const Pt=m.getValueAndResolveTokens("text-field",Ge,h,X),Vt=go.factory(Pt),dn=this.hasRTLText=this.hasRTLText||_C(Vt);(!dn||"unavailable"===Pu.getRTLTextPluginStatus()||dn&&Pu.isParsed())&&(Xe=Mb(Vt,m,Ge))}if(F){const Pt=m.getValueAndResolveTokens("icon-image",Ge,h,X);mt=Pt instanceof ls?Pt:ls.fromString(Pt)}if(!Xe&&!mt)continue;const Lt=this.sortFeaturesByKey?$.evaluate(Ge,{},h):void 0;if(this.features.push({id:ye,text:Xe,icon:mt,index:Ae,sourceLayerIndex:Ce,geometry:Ge.geometry,properties:re.properties,type:Sd.types[re.type],sortKey:Lt}),mt&&(G[mt.name]=!0),Xe){const Pt=b.evaluate(Ge,{},h).join(","),Vt="viewport"!==y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(I.ay.vertical)>=0;for(const dn of Xe.sections)if(dn.image)G[dn.image.name]=!0;else{const Jt=uf(Xe.toString()),Kt=dn.fontStack||Pt,It=W[Kt]=W[Kt]||{};this.calculateGlyphDependencies(dn.text,It,Vt,this.allowVerticalPlacement,Jt)}}}"line"===y.get("symbol-placement")&&(this.features=function(re){const ye={},Ae={},Ce=[];let Me=0;function Ge(Pt){Ce.push(re[Pt]),Me++}function Xe(Pt,Vt,dn){const Jt=Ae[Pt];return delete Ae[Pt],Ae[Vt]=Jt,Ce[Jt].geometry[0].pop(),Ce[Jt].geometry[0]=Ce[Jt].geometry[0].concat(dn[0]),Jt}function mt(Pt,Vt,dn){const Jt=ye[Vt];return delete ye[Vt],ye[Pt]=Jt,Ce[Jt].geometry[0].shift(),Ce[Jt].geometry[0]=dn[0].concat(Ce[Jt].geometry[0]),Jt}function Lt(Pt,Vt,dn){const Jt=dn?Vt[0][Vt[0].length-1]:Vt[0][0];return`${Pt}:${Jt.x}:${Jt.y}`}for(let Pt=0;Pt<re.length;Pt++){const Vt=re[Pt],dn=Vt.geometry,Jt=Vt.text?Vt.text.toString():null;if(!Jt){Ge(Pt);continue}const Kt=Lt(Jt,dn),It=Lt(Jt,dn,!0);if(Kt in Ae&&It in ye&&Ae[Kt]!==ye[It]){const Vn=mt(Kt,It,dn),jn=Xe(Kt,It,Ce[Vn].geometry);delete ye[Kt],delete Ae[It],Ae[Lt(Jt,Ce[jn].geometry,!0)]=jn,Ce[Vn].geometry=null}else Kt in Ae?Xe(Kt,It,dn):It in ye?mt(Kt,It,dn):(Ge(Pt),ye[Kt]=Me-1,Ae[It]=Me-1)}return Ce.filter(Pt=>Pt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((re,ye)=>re.sortKey-ye.sortKey)}update(r,a,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,a,this.layers,{imagePositions:h}),this.icon.programConfigurations.updatePaintArrays(r,a,this.layers,{imagePositions:h}))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,a){const h=this.lineVertexArray.length;if(void 0!==r.segment){let m=r.dist(a[r.segment+1]),y=r.dist(a[r.segment]);const b={};for(let D=r.segment+1;D<a.length;D++)b[D]={x:a[D].x,y:a[D].y,tileUnitDistanceFromAnchor:m},D<a.length-1&&(m+=a[D+1].dist(a[D]));for(let D=r.segment||0;D>=0;D--)b[D]={x:a[D].x,y:a[D].y,tileUnitDistanceFromAnchor:y},D>0&&(y+=a[D-1].dist(a[D]));for(let D=0;D<a.length;D++){const S=b[D];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(r,a,h,m,y,b,D,S,k,F,$,G){const W=r.indexArray,X=r.layoutVertexArray,Q=r.segments.prepareSegment(4*a.length,X,W,this.canOverlap?b.sortKey:void 0),re=this.glyphOffsetArray.length,ye=Q.vertexLength,Ae=this.allowVerticalPlacement&&D===I.ay.vertical?Math.PI/2:0,Ce=b.text&&b.text.sections;for(let Me=0;Me<a.length;Me++){const{tl:Ge,tr:Xe,bl:mt,br:Lt,tex:Pt,pixelOffsetTL:Vt,pixelOffsetBR:dn,minFontScaleX:Jt,minFontScaleY:Kt,glyphOffset:It,isSDF:Vn,sectionIndex:jn}=a[Me],qn=Q.vertexLength,Dn=It[1];Wp(X,S.x,S.y,Ge.x,Dn+Ge.y,Pt.x,Pt.y,h,Vn,Vt.x,Vt.y,Jt,Kt),Wp(X,S.x,S.y,Xe.x,Dn+Xe.y,Pt.x+Pt.w,Pt.y,h,Vn,dn.x,Vt.y,Jt,Kt),Wp(X,S.x,S.y,mt.x,Dn+mt.y,Pt.x,Pt.y+Pt.h,h,Vn,Vt.x,dn.y,Jt,Kt),Wp(X,S.x,S.y,Lt.x,Dn+Lt.y,Pt.x+Pt.w,Pt.y+Pt.h,h,Vn,dn.x,dn.y,Jt,Kt),Oy(r.dynamicLayoutVertexArray,S,Ae),W.emplaceBack(qn,qn+2,qn+1),W.emplaceBack(qn+1,qn+2,qn+3),Q.vertexLength+=4,Q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(It[0]),Me!==a.length-1&&jn===a[Me+1].sectionIndex||r.programConfigurations.populatePaintArrays(X.length,b,b.index,{imagePositions:{},canonical:G,formattedSection:Ce&&Ce[jn]})}r.placedSymbolArray.emplaceBack(S.x,S.y,re,this.glyphOffsetArray.length-re,ye,k,F,S.segment,h?h[0]:0,h?h[1]:0,m[0],m[1],D,0,!1,0,$)}_addCollisionDebugVertex(r,a,h,m,y,b){return a.emplaceBack(0,0),r.emplaceBack(h.x,h.y,m,y,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(r,a,h,m,y,b,D){const S=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),k=S.vertexLength,F=y.layoutVertexArray,$=y.collisionVertexArray,G=D.anchorX,W=D.anchorY;this._addCollisionDebugVertex(F,$,b,G,W,new Z(r,a)),this._addCollisionDebugVertex(F,$,b,G,W,new Z(h,a)),this._addCollisionDebugVertex(F,$,b,G,W,new Z(h,m)),this._addCollisionDebugVertex(F,$,b,G,W,new Z(r,m)),S.vertexLength+=4;const X=y.indexArray;X.emplaceBack(k,k+1),X.emplaceBack(k+1,k+2),X.emplaceBack(k+2,k+3),X.emplaceBack(k+3,k),S.primitiveLength+=4}addDebugCollisionBoxes(r,a,h,m){for(let y=r;y<a;y++){const b=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,m?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,h)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Fy(_t,Db.members,Ft),this.iconCollisionBox=new Fy(_t,Db.members,Ft);for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}}_deserializeCollisionBoxesForSymbol(r,a,h,m,y,b,D,S,k){const F={};for(let $=a;$<h;$++){const G=r.get($);F.textBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},F.textFeatureIndex=G.featureIndex;break}for(let $=m;$<y;$++){const G=r.get($);F.verticalTextBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},F.verticalTextFeatureIndex=G.featureIndex;break}for(let $=b;$<D;$++){const G=r.get($);F.iconBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},F.iconFeatureIndex=G.featureIndex;break}for(let $=S;$<k;$++){const G=r.get($);F.verticalIconBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,anchorPointX:G.anchorPointX,anchorPointY:G.anchorPointY},F.verticalIconFeatureIndex=G.featureIndex;break}return F}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const h=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,a){const h=r.placedSymbolArray.get(a),m=h.vertexStartIndex+4*h.numGlyphs;for(let y=h.vertexStartIndex;y<m;y+=4)r.indexArray.emplaceBack(y,y+2,y+1),r.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const a=Math.sin(r),h=Math.cos(r),m=[],y=[],b=[];for(let D=0;D<this.symbolInstances.length;++D){b.push(D);const S=this.symbolInstances.get(D);m.push(0|Math.round(a*S.anchorX+h*S.anchorY)),y.push(S.featureIndex)}return b.sort((D,S)=>m[D]-m[S]||y[S]-y[D]),b}addToSortKeyRanges(r,a){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===a?h.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const h=this.symbolInstances.get(a);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((m,y,b)=>{m>=0&&b.indexOf(m)===y&&this.addIndicesForPlacedSymbol(this.text,m)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ub,Ag;hn("SymbolBucket",Zl,{omit:["layers","collisionBoxArray","features","compareText"]}),Zl.MAX_GLYPHS=65535,Zl.addDynamicAttributes=Oy;var Yp={get paint(){return Ag=Ag||new gi({"icon-opacity":new Wn(xe.paint_symbol["icon-opacity"]),"icon-color":new Wn(xe.paint_symbol["icon-color"]),"icon-halo-color":new Wn(xe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Wn(xe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Wn(xe.paint_symbol["icon-halo-blur"]),"icon-translate":new In(xe.paint_symbol["icon-translate"]),"icon-translate-anchor":new In(xe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Wn(xe.paint_symbol["text-opacity"]),"text-color":new Wn(xe.paint_symbol["text-color"],{runtimeType:rs,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new Wn(xe.paint_symbol["text-halo-color"]),"text-halo-width":new Wn(xe.paint_symbol["text-halo-width"]),"text-halo-blur":new Wn(xe.paint_symbol["text-halo-blur"]),"text-translate":new In(xe.paint_symbol["text-translate"]),"text-translate-anchor":new In(xe.paint_symbol["text-translate-anchor"])})},get layout(){return Ub=Ub||new gi({"symbol-placement":new In(xe.layout_symbol["symbol-placement"]),"symbol-spacing":new In(xe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new In(xe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Wn(xe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new In(xe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new In(xe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new In(xe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new In(xe.layout_symbol["icon-ignore-placement"]),"icon-optional":new In(xe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new In(xe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Wn(xe.layout_symbol["icon-size"]),"icon-text-fit":new In(xe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new In(xe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Wn(xe.layout_symbol["icon-image"]),"icon-rotate":new Wn(xe.layout_symbol["icon-rotate"]),"icon-padding":new Wn(xe.layout_symbol["icon-padding"]),"icon-keep-upright":new In(xe.layout_symbol["icon-keep-upright"]),"icon-offset":new Wn(xe.layout_symbol["icon-offset"]),"icon-anchor":new Wn(xe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new In(xe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new In(xe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new In(xe.layout_symbol["text-rotation-alignment"]),"text-field":new Wn(xe.layout_symbol["text-field"]),"text-font":new Wn(xe.layout_symbol["text-font"]),"text-size":new Wn(xe.layout_symbol["text-size"]),"text-max-width":new Wn(xe.layout_symbol["text-max-width"]),"text-line-height":new In(xe.layout_symbol["text-line-height"]),"text-letter-spacing":new Wn(xe.layout_symbol["text-letter-spacing"]),"text-justify":new Wn(xe.layout_symbol["text-justify"]),"text-radial-offset":new Wn(xe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new In(xe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Wn(xe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Wn(xe.layout_symbol["text-anchor"]),"text-max-angle":new In(xe.layout_symbol["text-max-angle"]),"text-writing-mode":new In(xe.layout_symbol["text-writing-mode"]),"text-rotate":new Wn(xe.layout_symbol["text-rotate"]),"text-padding":new In(xe.layout_symbol["text-padding"]),"text-keep-upright":new In(xe.layout_symbol["text-keep-upright"]),"text-transform":new Wn(xe.layout_symbol["text-transform"]),"text-offset":new Wn(xe.layout_symbol["text-offset"]),"text-allow-overlap":new In(xe.layout_symbol["text-allow-overlap"]),"text-overlap":new In(xe.layout_symbol["text-overlap"]),"text-ignore-placement":new In(xe.layout_symbol["text-ignore-placement"]),"text-optional":new In(xe.layout_symbol["text-optional"])})}};class kg{constructor(r){if(void 0===r.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=r.property.overrides?r.property.overrides.runtimeType:di,this.defaultValue=r}evaluate(r){if(r.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(r.formattedSection))return a.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}hn("FormatSectionOverride",kg,{omit:["defaultValue"]});class Xp extends ya{constructor(r,a){super(r,Yp,a)}recalculate(r,a){if(super.recalculate(r,a),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const h=this.layout.get("text-writing-mode");if(h){const m=[];for(const y of h)m.indexOf(y)<0&&m.push(y);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(r,a,h,m){const y=this.layout.get(r).evaluate(a,{},h,m),b=this._unevaluatedLayout._values[r];return b.isDataDriven()||wu(b.value)||!y?y:(D=a.properties,y.replace(/{([^{}]+)}/g,(k,F)=>D&&F in D?String(D[F]):""));var D}createBucket(r){return new Zl(r)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const r of Yp.paint.overridableProperties){if(!Xp.hasPaintOverride(this.layout,r))continue;const a=this.paint.get(r),h=new kg(a),m=new ol(h,a.property.specification);let y=null;y="constant"===a.value.kind||"source"===a.value.kind?new bc("source",m):new f("composite",m,a.value.zoomStops),this.paint._values[r]=new Ba(a.property,y,a.parameters)}}_handleOverridablePaintPropertyUpdate(r,a,h){return!(!this.layout||a.isDataDriven()||h.isDataDriven())&&Xp.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,a){const h=r.get("text-field"),m=Yp.paint.properties[a];let y=!1;const b=D=>{for(const S of D)if(m.overrides&&m.overrides.hasOverride(S))return void(y=!0)};if("constant"===h.value.kind&&h.value.value instanceof go)b(h.value.value.sections);else if("source"===h.value.kind||"composite"===h.value.kind){const D=k=>{y||(k instanceof rr&&an(k.value)===qr?b(k.value.sections):k instanceof ci?b(k.sections):k.eachChild(D))},S=h.value;S._styleExpression&&D(S._styleExpression.expression)}return y}}let Kp;var Ny={get paint(){return Kp=Kp||new gi({"background-color":new In(xe.paint_background["background-color"]),"background-pattern":new Op(xe.paint_background["background-pattern"]),"background-opacity":new In(xe.paint_background["background-opacity"])})}};class Qp extends ya{constructor(r,a){super(r,Ny,a)}}class Rg extends ya{constructor(r,a){super(r,{},a),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=r}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Lh{constructor(r){this._methodToThrottle=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const zy={once:!0},Mf=6371008.8;class ql{constructor(r,a){if(isNaN(r)||isNaN(a))throw new Error(`Invalid LngLat object: (${r}, ${a})`);if(this.lng=+r,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ql(zn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const a=Math.PI/180,h=this.lat*a,m=r.lat*a,y=Math.sin(h)*Math.sin(m)+Math.cos(h)*Math.cos(m)*Math.cos((r.lng-this.lng)*a);return Mf*Math.acos(Math.min(y,1))}static convert(r){if(r instanceof ql)return r;if(Array.isArray(r)&&(2===r.length||3===r.length))return new ql(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&"object"==typeof r&&null!==r)return new ql(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Lg=2*Math.PI*Mf;function Og(l){return Lg*Math.cos(l*Math.PI/180)}function Jp(l){return(180+l)/360}function By(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function Fg(l,r){return l/Og(r)}function Pd(l){return 360*l-180}function em(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Vy(l,r){return l*Og(em(r))}class Ef{constructor(r,a,h=0){this.x=+r,this.y=+a,this.z=+h}static fromLngLat(r,a=0){const h=ql.convert(r);return new Ef(Jp(h.lng),By(h.lat),Fg(a,h.lat))}toLngLat(){return new ql(Pd(this.x),em(this.y))}toAltitude(){return Vy(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Lg*(r=em(this.y),1/Math.cos(r*Math.PI/180));var r}}function Ng(l,r,a){var h=2*Math.PI*6378137/256/Math.pow(2,a);return[l*h-2*Math.PI*6378137/2,r*h-2*Math.PI*6378137/2]}class zg{constructor(r,a,h){if(y=a,b=h,(m=r)<0||m>25||b<0||b>=Math.pow(2,m)||y<0||y>=Math.pow(2,m))throw new Error(`x=${a}, y=${h}, z=${r} outside of bounds. 0<=x<${Math.pow(2,r)}, 0<=y<${Math.pow(2,r)} 0<=z<=25 `);var m,y,b;this.z=r,this.x=a,this.y=h,this.key=Oh(0,r,r,a,h)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,a,h){const m=(b=this.y,D=this.z,S=Ng(256*(y=this.x),256*(b=Math.pow(2,D)-b-1),D),k=Ng(256*(y+1),256*(b+1),D),S[0]+","+S[1]+","+k[0]+","+k[1]);var y,b,D,S,k;const F=function($,G,W){let X,Q="";for(let re=$;re>0;re--)X=1<<re-1,Q+=(G&X?1:0)+(W&X?2:0);return Q}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===h?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,a>1?"@2x":"").replace(/{quadkey}/g,F).replace(/{bbox-epsg-3857}/g,m)}isChildOf(r){const a=this.z-r.z;return a>0&&r.x===this.x>>a&&r.y===this.y>>a}getTilePoint(r){const a=Math.pow(2,this.z);return new Z((r.x*a-this.x)*pt,(r.y*a-this.y)*pt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class jy{constructor(r,a){this.wrap=r,this.canonical=a,this.key=Oh(r,a.z,a.z,a.x,a.y)}}class Ia{constructor(r,a,h,m,y){if(this.terrainRttPosMatrix32f=null,r<h)throw new Error(`overscaledZ should be >= z; overscaledZ = ${r}; z = ${h}`);this.overscaledZ=r,this.wrap=a,this.canonical=new zg(h,+m,+y),this.key=Oh(a,r,h,m,y)}clone(){return new Ia(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-r;return r>this.canonical.z?new Ia(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ia(r,this.wrap,r,this.canonical.x>>a,this.canonical.y>>a)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(r,a){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-r;return r>this.canonical.z?Oh(this.wrap*+a,r,this.canonical.z,this.canonical.x,this.canonical.y):Oh(this.wrap*+a,r,r,this.canonical.x>>h,this.canonical.y>>h)}isChildOf(r){if(r.wrap!==this.wrap||this.overscaledZ-r.overscaledZ<=0)return!1;if(0===r.overscaledZ)return this.overscaledZ>0;const a=this.canonical.z-r.canonical.z;return!(a<0)&&r.canonical.x===this.canonical.x>>a&&r.canonical.y===this.canonical.y>>a}children(r){if(this.overscaledZ>=r)return[new Ia(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,h=2*this.canonical.x,m=2*this.canonical.y;return[new Ia(a,this.wrap,a,h,m),new Ia(a,this.wrap,a,h+1,m),new Ia(a,this.wrap,a,h,m+1),new Ia(a,this.wrap,a,h+1,m+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Ia(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Ia(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new jy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(r){return this.canonical.getTilePoint(new Ef(r.x-this.wrap,r.y))}}function Oh(l,r,a,h,m){(l*=2)<0&&(l=-1*l-1);const y=1<<a;return(y*y*l+y*m+h).toString(36)+a.toString(36)+r.toString(36)}function nu(l,r){return r?l.properties[r]:l.id}function $b(l,r){const a={id:l.id};if(r.removeAllProperties&&(delete l.removeProperties,delete l.addOrUpdateProperties,delete r.removeProperties),r.removeProperties)for(const h of r.removeProperties){const m=l.addOrUpdateProperties.findIndex(y=>y.key===h);m>-1&&l.addOrUpdateProperties.splice(m,1)}return(l.removeAllProperties||r.removeAllProperties)&&(a.removeAllProperties=!0),(l.removeProperties||r.removeProperties)&&(a.removeProperties=[...l.removeProperties||[],...r.removeProperties||[]]),(l.addOrUpdateProperties||r.addOrUpdateProperties)&&(a.addOrUpdateProperties=[...l.addOrUpdateProperties||[],...r.addOrUpdateProperties||[]]),(l.newGeometry||r.newGeometry)&&(a.newGeometry=r.newGeometry||l.newGeometry),a}function Ua(l){var r,a;if(!l)return{};const h={};return h.removeAll=l.removeAll,h.remove=new Set(l.remove||[]),h.add=new Map(null===(r=l.add)||void 0===r?void 0:r.map(m=>[m.id,m])),h.update=new Map(null===(a=l.update)||void 0===a?void 0:a.map(m=>[m.id,m])),h}hn("CanonicalTileID",zg),hn("OverscaledTileID",Ia,{omit:["terrainRttPosMatrix32f"]});class yC{constructor(r){this._stringToNumber={},this._numberToString=[];for(let a=0;a<r.length;a++){const h=r[a];this._stringToNumber[h]=a,this._numberToString[a]=h}}encode(r){return this._stringToNumber[r]}decode(r){if(r>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${r} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[r]}}class tm{constructor(r,a,h,m,y){this.type="Feature",this._vectorTileFeature=r,r._z=a,r._x=h,r._y=m,this.properties=r.properties,this.id=y}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const a in this)"_geometry"!==a&&"_vectorTileFeature"!==a&&(r[a]=this[a]);return r}}class Sf{_name;dataBuffer;nullabilityBuffer;_size;constructor(r,a,h){this._name=r,this.dataBuffer=a,"number"==typeof h?this._size=h:(this.nullabilityBuffer=h,this._size=h.size())}getValue(r){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(r)?null:this.getValueFromBuffer(r)}has(r){return this.nullabilityBuffer&&this.nullabilityBuffer.get(r)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class ju extends Sf{}class nm extends ju{getValueFromBuffer(r){return this.dataBuffer[r]}}class Bg extends ju{getValueFromBuffer(r){return this.dataBuffer[r]}}class Uy extends Sf{delta;constructor(r,a,h,m){super(r,a,m),this.delta=h}}class Vg extends Uy{constructor(r,a,h,m){super(r,Int32Array.of(a),h,m)}getValueFromBuffer(r){return this.dataBuffer[0]+r*this.delta}}class jg extends Sf{constructor(r,a,h){super(r,Int32Array.of(a),h)}getValueFromBuffer(r){return this.dataBuffer[0]}}class Gb{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(r,a,h,m,y=4096){this._name=r,this._geometryVector=a,this._idVector=h,this._propertyVectors=m,this._extent=y}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(r){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map(a=>[a.name,a]))),this.propertyVectorsMap.get(r)}*[Symbol.iterator](){const r=this.geometryVector[Symbol.iterator]();let a=0;for(;a<this.numFeatures;){let h;this.idVector&&(h=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(a)):this.idVector.getValue(a));const m=r?.next().value,y={};for(const b of this.propertyVectors){if(!b)continue;const D=b.name,S=b.getValue(a);null!==S&&(y[D]=S)}a++,yield{id:h,geometry:m,properties:y}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const r=[],a=this.geometryVector.getGeometries();for(let h=0;h<this.numFeatures;h++){let m;this.idVector&&(m=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(h)):this.idVector.getValue(h));const y={coordinates:a[h],type:this.geometryVector.geometryType(h)},b={};for(const D of this.propertyVectors){if(!D)continue;const S=D.name,k=D.getValue(h);null!==k&&(b[S]=k)}r.push({id:m,geometry:y,properties:b})}return r}containsMaxSaveIntegerValues(r){return r instanceof nm||r instanceof jg&&r instanceof Vg||r instanceof Bg}}class vC{value;constructor(r){this.value=r}get(){return this.value}set(r){this.value=r}increment(){return this.value++}add(r){this.value+=r}}var vs,Bi,kr,$a,Fh,Vi,lo,co,iu,ia,l;(l=vs||(vs={})).PRESENT="PRESENT",l.DATA="DATA",l.OFFSET="OFFSET",l.LENGTH="LENGTH";class If{_dictionaryType;_offsetType;_lengthType;constructor(r,a,h){this._dictionaryType=r,this._offsetType=a,this._lengthType=h}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Zo(l,r,a){const h=new Int32Array(a);let m=0,y=r.get();for(let b=0;b<h.length;b++){let D=l[y++],S=127&D;D<128||(D=l[y++],S|=(127&D)<<7,D<128||(D=l[y++],S|=(127&D)<<14,D<128||(D=l[y++],S|=(127&D)<<21,D<128||(D=l[y++],S|=(15&D)<<28)))),h[m++]=S}return r.set(y),h}function Ug(l,r,a){const h=new BigInt64Array(a);for(let m=0;m<h.length;m++)h[m]=Zb(l,r);return h}function Pf(l,r){let a,h;return h=l[r.get()],r.increment(),a=127&h,h<128?a:(h=l[r.get()],r.increment(),a|=(127&h)<<7,h<128?a:(h=l[r.get()],r.increment(),a|=(127&h)<<14,h<128?a:(h=l[r.get()],r.increment(),a|=(127&h)<<21,h<128?a:(h=l[r.get()],a|=(15&h)<<28,function(m,y,b){let D,S;if(S=y[b.get()],b.increment(),D=(112&S)>>4,S<128||(S=y[b.get()],b.increment(),D|=(127&S)<<3,S<128)||(S=y[b.get()],b.increment(),D|=(127&S)<<10,S<128)||(S=y[b.get()],b.increment(),D|=(127&S)<<17,S<128)||(S=y[b.get()],b.increment(),D|=(127&S)<<24,S<128)||(S=y[b.get()],b.increment(),D|=(1&S)<<31,S<128))return 4294967296*D+(m>>>0);throw new Error("Expected varint not more than 10 bytes")}(a,l,r)))))}function Hb(l,r,a,h){throw new Error("FastPFor is not implemented yet.")}function Wl(l){return l>>>1^-(1&l)}function Af(l){return l>>1n^-(1n&l)}function Zb(l,r){let a=0n,h=0,m=r.get();for(;m<l.length;){const y=l[m++];if(a|=BigInt(127&y)<<BigInt(h),!(128&y))break;if(h+=7,h>=64)throw new Error("Varint too long")}return r.set(m),a}function kf(l,r,a){const h=new Int32Array(a);let m=0;for(let y=0;y<r;y++){const b=l[y];h.fill(l[y+r],m,m+b),m+=b}return h}function im(l,r,a){const h=new BigInt64Array(a);let m=0;for(let y=0;y<r;y++){const b=Number(l[y]);h.fill(l[y+r],m,m+b),m+=b}return h}function $y(l,r,a){const h=new Float64Array(a);let m=0;for(let y=0;y<r;y++){const b=l[y];h.fill(l[y+r],m,m+b),m+=b}return h}function $g(l){const r=l.length/4*4;let a=1;if(r>=4)for(let h=l[0];a<r-4;a+=4)h=l[a]+=h,h=l[a+1]+=h,h=l[a+2]+=h,h=l[a+3]+=h;for(;a!=l.length;)l[a]+=l[a-1],++a}function Rf(l){l[0]=l[0]>>>1^-(1&l[0]),l[1]=l[1]>>>1^-(1&l[1]);const r=l.length/4*4;let a=2;if(r>=4)for(;a<r-4;a+=4){const h=l[a],m=l[a+1],y=l[a+2],b=l[a+3];l[a]=(h>>>1^-(1&h))+l[a-2],l[a+1]=(m>>>1^-(1&m))+l[a-1],l[a+2]=(y>>>1^-(1&y))+l[a],l[a+3]=(b>>>1^-(1&b))+l[a+1]}for(;a!=l.length;a+=2)l[a]=(l[a]>>>1^-(1&l[a]))+l[a-2],l[a+1]=(l[a+1]>>>1^-(1&l[a+1]))+l[a-1]}function Oo(l,r,a){return Math.min(a,Math.max(r,l))}(function(l){l.NONE="NONE",l.DELTA="DELTA",l.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",l.RLE="RLE",l.MORTON="MORTON",l.PDE="PDE"})(Bi||(Bi={})),function(l){l.NONE="NONE",l.FAST_PFOR="FAST_PFOR",l.VARINT="VARINT",l.ALP="ALP"}(kr||(kr={})),function(l){l.NONE="NONE",l.SINGLE="SINGLE",l.SHARED="SHARED",l.VERTEX="VERTEX",l.MORTON="MORTON",l.FSST="FSST"}($a||($a={})),function(l){l.VERTEX="VERTEX",l.INDEX="INDEX",l.STRING="STRING",l.KEY="KEY"}(Fh||(Fh={})),function(l){l.VAR_BINARY="VAR_BINARY",l.GEOMETRIES="GEOMETRIES",l.PARTS="PARTS",l.RINGS="RINGS",l.TRIANGLES="TRIANGLES",l.SYMBOL="SYMBOL",l.DICTIONARY="DICTIONARY"}(Vi||(Vi={}));class Ad{_physicalStreamType;_logicalStreamType;_logicalLevelTechnique1;_logicalLevelTechnique2;_physicalLevelTechnique;_numValues;_byteLength;constructor(r,a,h,m,y,b,D){this._physicalStreamType=r,this._logicalStreamType=a,this._logicalLevelTechnique1=h,this._logicalLevelTechnique2=m,this._physicalLevelTechnique=y,this._numValues=b,this._byteLength=D}static decode(r,a){const h=r[a.get()],m=Object.values(vs)[h>>4];let y=null;switch(m){case vs.DATA:y=new If(Object.values($a)[15&h]);break;case vs.OFFSET:y=new If(null,Object.values(Fh)[15&h]);break;case vs.LENGTH:y=new If(null,null,Object.values(Vi)[15&h])}a.increment();const b=r[a.get()],D=Object.values(Bi)[b>>5],S=Object.values(Bi)[b>>2&7],k=Object.values(kr)[3&b];a.increment();const F=Zo(r,a,2);return new Ad(m,y,D,S,k,F[0],F[1])}get physicalStreamType(){return this._physicalStreamType}get logicalStreamType(){return this._logicalStreamType}get logicalLevelTechnique1(){return this._logicalLevelTechnique1}get logicalLevelTechnique2(){return this._logicalLevelTechnique2}get physicalLevelTechnique(){return this._physicalLevelTechnique}get numValues(){return this._numValues}get byteLength(){return this._byteLength}getDecompressedCount(){return this._numValues}}class qo extends Ad{num_bits;coordinate_shift;constructor(r,a,h,m,y,b,D,S,k){super(r,a,h,m,y,b,D),this.num_bits=S,this.coordinate_shift=k}static decode(r,a){const h=Ad.decode(r,a),m=Zo(r,a,2);return new qo(h.physicalStreamType,h.logicalStreamType,h.logicalLevelTechnique1,h.logicalLevelTechnique2,h.physicalLevelTechnique,h.numValues,h.byteLength,m[0],m[1])}static decodePartial(r,a,h){const m=Zo(a,h,2);return new qo(r.physicalStreamType,r.logicalStreamType,r.logicalLevelTechnique1,r.logicalLevelTechnique2,r.physicalLevelTechnique,r.numValues,r.byteLength,m[0],m[1])}numBits(){return this.num_bits}coordinateShift(){return this.coordinate_shift}}class rm extends Ad{_runs;_numRleValues;constructor(r,a,h,m,y,b,D,S,k){super(r,a,h,m,y,b,D),this._runs=S,this._numRleValues=k}static decode(r,a){const h=Ad.decode(r,a),m=Zo(r,a,2);return new rm(h.physicalStreamType,h.logicalStreamType,h.logicalLevelTechnique1,h.logicalLevelTechnique2,h.physicalLevelTechnique,h.numValues,h.byteLength,m[0],m[1])}static decodePartial(r,a,h){const m=Zo(a,h,2);return new rm(r.physicalStreamType,r.logicalStreamType,r.logicalLevelTechnique1,r.logicalLevelTechnique2,r.physicalLevelTechnique,r.numValues,r.byteLength,m[0],m[1])}get runs(){return this._runs}get numRleValues(){return this._numRleValues}getDecompressedCount(){return this._numRleValues}}class ra{static decode(r,a){const h=Ad.decode(r,a);return h.logicalLevelTechnique1===Bi.MORTON?qo.decodePartial(h,r,a):Bi.RLE!==h.logicalLevelTechnique1&&Bi.RLE!==h.logicalLevelTechnique2||kr.NONE===h.physicalLevelTechnique?h:rm.decodePartial(h,r,a)}}!function(l){l[l.FLAT=0]="FLAT",l[l.CONST=1]="CONST",l[l.SEQUENCE=2]="SEQUENCE",l[l.DICTIONARY=3]="DICTIONARY",l[l.FSST_DICTIONARY=4]="FSST_DICTIONARY"}(lo||(lo={}));class ml{values;_size;constructor(r,a){this.values=r,this._size=a}get(r){const a=Math.floor(r/8);return 1==(this.values[a]>>r%8&1)}set(r,a){const h=Math.floor(r/8);this.values[h]=this.values[h]|(a?1:0)<<r%8}getInt(r){const a=Math.floor(r/8);return this.values[a]>>r%8&1}size(){return this._size}getBuffer(){return this.values}}class vi{constructor(){}static decodeIntStream(r,a,h,m,y){const b=vi.decodePhysicalLevelTechnique(r,a,h);return this.decodeIntBuffer(b,h,m,y)}static decodeLengthStreamToOffsetBuffer(r,a,h){const m=vi.decodePhysicalLevelTechnique(r,a,h);return this.decodeLengthToOffsetBuffer(m,h)}static decodePhysicalLevelTechnique(r,a,h){const m=h.physicalLevelTechnique;if(m===kr.FAST_PFOR)return Hb();if(m===kr.VARINT)return Zo(r,a,h.numValues);if(m===kr.NONE){const y=a.get();a.add(h.byteLength);const b=r.subarray(y,a.get());return new Int32Array(b)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}static decodeConstIntStream(r,a,h,m){const y=vi.decodePhysicalLevelTechnique(r,a,h);if(1===y.length){const b=y[0];return m?Wl(b):b}return m?Wl(y[1]):y[1]}static decodeSequenceIntStream(r,a,h){return function(m){if(2==m.length){const y=Wl(m[1]);return[y,y]}return[Wl(m[2]),Wl(m[3])]}(vi.decodePhysicalLevelTechnique(r,a,h))}static decodeSequenceLongStream(r,a,h){return function(m){if(2==m.length){const y=Af(m[1]);return[y,y]}return[Af(m[2]),Af(m[3])]}(Ug(r,a,h.numValues))}static decodeLongStream(r,a,h,m){const y=Ug(r,a,h.numValues);return this.decodeLongBuffer(y,h,m)}static decodeLongFloat64Stream(r,a,h,m){const y=function(b,D,S){const k=new Float64Array(D);for(let F=0;F<D;F++)k[F]=Pf(b,S);return k}(r,h.numValues,a);return this.decodeFloat64Buffer(y,h,m)}static decodeConstLongStream(r,a,h,m){const y=Ug(r,a,h.numValues);if(1===y.length){const b=y[0];return m?Af(b):b}return m?Af(y[1]):y[1]}static decodeIntBuffer(r,a,h,m){switch(a.logicalLevelTechnique1){case Bi.DELTA:return a.logicalLevelTechnique2===Bi.RLE?function(y,b,D){const S=new Int32Array(D);let k=0,F=0;for(let $=0;$<b;$++){const G=y[$],W=Wl(y[$+b]);for(let X=0;X<G;X++)F+=W,S[k++]=F}return S}(r,a.runs,a.numRleValues):(function(y){y[0]=y[0]>>>1^-(1&y[0]);const b=y.length/4*4;let D=1;if(b>=4)for(;D<b-4;D+=4){const S=y[D],k=y[D+1],F=y[D+2],$=y[D+3];y[D]=(S>>>1^-(1&S))+y[D-1],y[D+1]=(k>>>1^-(1&k))+y[D],y[D+2]=(F>>>1^-(1&F))+y[D+1],y[D+3]=($>>>1^-(1&$))+y[D+2]}for(;D!=y.length;++D)y[D]=(y[D]>>>1^-(1&y[D]))+y[D-1]}(r),r);case Bi.RLE:return y=r,b=a,h?function(S,k,F){const $=new Int32Array(F);let G=0;for(let W=0;W<k;W++){const X=S[W];let Q=S[W+k];Q=Q>>>1^-(1&Q),$.fill(Q,G,G+X),G+=X}return $}(y,b.runs,b.numRleValues):kf(y,b.runs,b.numRleValues);case Bi.MORTON:return $g(r),r;case Bi.COMPONENTWISE_DELTA:return m?(function(y,b,D,S){let k=y[0]>>>1^-(1&y[0]),F=y[1]>>>1^-(1&y[1]);y[0]=Oo(Math.round(k*b),D,S),y[1]=Oo(Math.round(F*b),D,S);const $=y.length/16;let G=2;if($>=4)for(;G<$-4;G+=4){const W=y[G],X=y[G+1],Q=(W>>>1^-(1&W))+k,re=(X>>>1^-(1&X))+F;y[G]=Oo(Math.round(Q*b),D,S),y[G+1]=Oo(Math.round(re*b),D,S);const ye=y[G+2],Ae=y[G+3];k=(ye>>>1^-(1&ye))+Q,F=(Ae>>>1^-(1&Ae))+re,y[G+2]=Oo(Math.round(k*b),D,S),y[G+3]=Oo(Math.round(F*b),D,S)}for(;G!=y.length;G+=2)k+=y[G]>>>1^-(1&y[G]),F+=y[G+1]>>>1^-(1&y[G+1]),y[G]=Oo(Math.round(k*b),D,S),y[G+1]=Oo(Math.round(F*b),D,S)}(r,m.scale,m.min,m.max),r):(Rf(r),r);case Bi.NONE:return h&&function(y){for(let b=0;b<y.length;b++){const D=y[b];y[b]=D>>>1^-(1&D)}}(r),r;default:throw new Error(`The specified Logical level technique is not supported: ${a.logicalLevelTechnique1}`)}var y,b}static decodeLongBuffer(r,a,h){switch(a.logicalLevelTechnique1){case Bi.DELTA:return a.logicalLevelTechnique2===Bi.RLE?function(m,y,b){const D=new BigInt64Array(b);let S=0,k=0n;for(let F=0;F<y;F++){const $=Number(m[F]),G=Af(m[F+y]);for(let W=0;W<$;W++)k+=G,D[S++]=k}return D}(r,a.runs,a.numRleValues):(function(m){m[0]=m[0]>>1n^-(1n&m[0]);const y=m.length/4*4;let b=1;if(y>=4)for(;b<y-4;b+=4){const D=m[b],S=m[b+1],k=m[b+2],F=m[b+3];m[b]=(D>>1n^-(1n&D))+m[b-1],m[b+1]=(S>>1n^-(1n&S))+m[b],m[b+2]=(k>>1n^-(1n&k))+m[b+1],m[b+3]=(F>>1n^-(1n&F))+m[b+2]}for(;b!=m.length;++b)m[b]=(m[b]>>1n^-(1n&m[b]))+m[b-1]}(r),r);case Bi.RLE:return m=r,y=a,h?function(D,S,k){const F=new BigInt64Array(k);let $=0;for(let G=0;G<S;G++){const W=Number(D[G]);let X=D[G+S];X=X>>1n^-(1n&X),F.fill(X,$,$+W),$+=W}return F}(m,y.runs,y.numRleValues):im(m,y.runs,y.numRleValues);case Bi.NONE:return h&&function(m){for(let y=0;y<m.length;y++){const b=m[y];m[y]=b>>1n^-(1n&b)}}(r),r;default:throw new Error(`The specified Logical level technique is not supported: ${a.logicalLevelTechnique1}`)}var m,y}static decodeFloat64Buffer(r,a,h){switch(a.logicalLevelTechnique1){case Bi.DELTA:return a.logicalLevelTechnique2===Bi.RLE&&(r=$y(r,a.runs,a.numRleValues)),function(m){m[0]=m[0]%2==1?(m[0]+1)/-2:m[0]/2;const y=m.length/4*4;let b=1;if(y>=4)for(;b<y-4;b+=4){const D=m[b],S=m[b+1],k=m[b+2],F=m[b+3];m[b]=(D%2==1?(D+1)/-2:D/2)+m[b-1],m[b+1]=(S%2==1?(S+1)/-2:S/2)+m[b],m[b+2]=(k%2==1?(k+1)/-2:k/2)+m[b+1],m[b+3]=(F%2==1?(F+1)/-2:F/2)+m[b+2]}for(;b!=m.length;++b)m[b]=(m[b]%2==1?(m[b]+1)/-2:m[b]/2)+m[b-1]}(r),r;case Bi.RLE:return m=r,y=a,h?function(D,S,k){const F=new Float64Array(k);let $=0;for(let G=0;G<S;G++){const W=D[G];let X=D[G+S];X=X%2==1?(X+1)/-2:X/2,F.fill(X,$,$+W),$+=W}return F}(m,y.runs,y.numRleValues):$y(m,y.runs,y.numRleValues);case Bi.NONE:return h&&function(m){for(let y=0;y<m.length;y++){const b=m[y];m[y]=b%2==1?(b+1)/-2:b/2}}(r),r;default:throw new Error(`The specified Logical level technique is not supported: ${a.logicalLevelTechnique1}`)}var m,y}static decodeLengthToOffsetBuffer(r,a){if(a.logicalLevelTechnique1===Bi.DELTA&&a.logicalLevelTechnique2===Bi.NONE)return function(h){const m=new Int32Array(h.length+1);m[0]=0,m[1]=Wl(h[0]);let y=m[1],b=2;for(;b!=m.length;++b){const D=h[b-1];y+=D>>>1^-(1&D),m[b]=m[b-1]+y}return m}(r);if(a.logicalLevelTechnique1===Bi.RLE&&a.logicalLevelTechnique2===Bi.NONE)return function(h,m,y){const b=new Int32Array(y+1);b[0]=0;let D=1,S=b[0];for(let k=0;k<m;k++){const F=h[k],$=h[k+m];for(let G=D;G<D+F;G++)b[G]=$+S,S=b[G];D+=F}return b}(r,a.runs,a.numRleValues);if(a.logicalLevelTechnique1===Bi.NONE&&a.logicalLevelTechnique2===Bi.NONE){!function(m){let y=0;for(let b=0;b<m.length;b++)m[b]+=y,y=m[b]}(r);const h=new Int32Array(a.numValues+1);return h[0]=0,h.set(r,1),h}if(a.logicalLevelTechnique1===Bi.DELTA&&a.logicalLevelTechnique2===Bi.RLE){const h=function(m,y,b){const D=new Int32Array(b+1);D[0]=0;let S=1,k=D[0];for(let F=0;F<y;F++){const $=m[F];let G=m[F+y];G=G>>>1^-(1&G);for(let W=S;W<S+$;W++)D[W]=G+k,k=D[W];S+=$}return D}(r,a.runs,a.numRleValues);return $g(h),h}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")}static decodeNullableIntStream(r,a,h,m,y){const b=h.physicalLevelTechnique===kr.FAST_PFOR?Hb():Zo(r,a,h.numValues);return this.decodeNullableIntBuffer(b,h,m,y)}static decodeNullableLongStream(r,a,h,m,y){const b=Ug(r,a,h.numValues);return this.decodeNullableLongBuffer(b,h,m,y)}static decodeNullableIntBuffer(r,a,h,m){switch(a.logicalLevelTechnique1){case Bi.DELTA:return a.logicalLevelTechnique2===Bi.RLE&&(r=kf(r,a.runs,a.numRleValues)),function(y,b){const D=new Int32Array(y.size());let S=0;y.get(0)?(D[0]=y.get(0)?b[0]>>>1^-(1&b[0]):0,S=1):D[0]=0;let k=1;for(;k!=D.length;++k)D[k]=y.get(k)?D[k-1]+(b[S]>>>1^-(1&b[S++])):D[k-1];return D}(m,r);case Bi.RLE:return function(y,b,D,S){const k=b;return D?function(F,$,G){const W=new Int32Array(F.size());let X=0;for(let Q=0;Q<G;Q++){const re=$[Q];let ye=$[Q+G];ye=ye>>>1^-(1&ye);for(let Ae=X;Ae<X+re;Ae++)F.get(Ae)?W[Ae]=ye:(W[Ae]=0,X++);X+=re}return W}(S,y,k.runs):function(F,$,G){const W=new Int32Array(F.size());let X=0;for(let Q=0;Q<G;Q++){const re=$[Q],ye=$[Q+G];for(let Ae=X;Ae<X+re;Ae++)F.get(Ae)?W[Ae]=ye:(W[Ae]=0,X++);X+=re}return W}(S,y,k.runs)}(r,a,h,m);case Bi.MORTON:return $g(r),r;case Bi.COMPONENTWISE_DELTA:return Rf(r),r;case Bi.NONE:return h?function(y,b){const D=new Int32Array(y.size());let S=0,k=0;for(;k!=D.length;++k)if(y.get(k)){const F=b[S++];D[k]=F>>>1^-(1&F)}else D[k]=0;return D}(m,r):function(y,b){const D=new Int32Array(y.size());let S=0,k=0;for(;k!=D.length;++k)D[k]=y.get(k)?b[S++]:0;return D}(m,r);default:throw new Error("The specified Logical level technique is not supported")}}static decodeNullableLongBuffer(r,a,h,m){switch(a.logicalLevelTechnique1){case Bi.DELTA:return a.logicalLevelTechnique2===Bi.RLE&&(r=im(r,a.runs,a.numRleValues)),function(y,b){const D=new BigInt64Array(y.size());let S=0;y.get(0)?(D[0]=y.get(0)?b[0]>>1n^-(1n&b[0]):0n,S=1):D[0]=0n;let k=1;for(;k!=D.length;++k)D[k]=y.get(k)?D[k-1]+(b[S]>>1n^-(1n&b[S++])):D[k-1];return D}(m,r);case Bi.RLE:return function(y,b,D,S){const k=b;return D?function(F,$,G){const W=new BigInt64Array(F.size());let X=0;for(let Q=0;Q<G;Q++){const re=Number($[Q]);let ye=$[Q+G];ye=ye>>1n^-(1n&ye);for(let Ae=X;Ae<X+re;Ae++)F.get(Ae)?W[Ae]=ye:(W[Ae]=0n,X++);X+=re}return W}(S,y,k.runs):function(F,$,G){const W=new BigInt64Array(F.size());let X=0;for(let Q=0;Q<G;Q++){const re=Number($[Q]),ye=$[Q+G];for(let Ae=X;Ae<X+re;Ae++)F.get(Ae)?W[Ae]=ye:(W[Ae]=0n,X++);X+=re}return W}(S,y,k.runs)}(r,a,h,m);case Bi.NONE:return h?function(y,b){const D=new BigInt64Array(y.size());let S=0,k=0;for(;k!=D.length;++k)if(y.get(k)){const F=b[S++];D[k]=F>>1n^-(1n&F)}else D[k]=0n;return D}(m,r):function(y,b){const D=new BigInt64Array(y.size());let S=0,k=0;for(;k!=D.length;++k)D[k]=y.get(k)?b[S++]:0n;return D}(m,r);default:throw new Error("The specified Logical level technique is not supported")}}static getVectorType(r,a,h,m){const y=r.logicalLevelTechnique1;if(y===Bi.RLE)return 1===r.runs?lo.CONST:lo.FLAT;const b=a instanceof ml?a.size():a;if(y===Bi.DELTA&&r.logicalLevelTechnique2===Bi.RLE){const D=r.runs,S=2;if(r.numRleValues!==b)return lo.FLAT;if(1===D)return lo.SEQUENCE;if(2===D){const k=m.get();let F;if(r.physicalLevelTechnique===kr.VARINT)F=Zo(h,m,4);else{const $=m.get();F=new Int32Array(h.buffer,h.byteOffset+$,4)}if(m.set(k),F[2]===S&&F[3]===S)return lo.SEQUENCE}}return 1===r.numValues?lo.CONST:lo.FLAT}}class Gy extends ju{getValueFromBuffer(r){return this.dataBuffer[r]}}class qb extends Uy{constructor(r,a,h,m){super(r,BigInt64Array.of(a),h,m)}getValueFromBuffer(r){return this.dataBuffer[0]+BigInt(r)*this.delta}}class om{_geometryOffsets;_partOffsets;_ringOffsets;constructor(r,a,h){this._geometryOffsets=r,this._partOffsets=a,this._ringOffsets=h}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}class Wb{tileExtent;_numBits;_coordinateShift;minBound;maxBound;constructor(r,a){this._coordinateShift=r<0?Math.abs(r):0,this.tileExtent=a+this._coordinateShift,this._numBits=Math.ceil(Math.log2(this.tileExtent)),this.minBound=r,this.maxBound=a}validateCoordinates(r){if(r.x<this.minBound||r.y<this.minBound||r.x>this.maxBound||r.y>this.maxBound)throw new Error("The specified tile buffer size is currently not supported.")}numBits(){return this._numBits}coordinateShift(){return this._coordinateShift}}class Lf extends Wb{encode(r){this.validateCoordinates(r);const a=r.x+this._coordinateShift,h=r.y+this._coordinateShift;let m=0;for(let y=0;y<this._numBits;y++)m|=(a&1<<y)<<y|(h&1<<y)<<y+1;return m}decode(r){return{x:this.decodeMorton(r)-this._coordinateShift,y:this.decodeMorton(r>>1)-this._coordinateShift}}decodeMorton(r){let a=0;for(let h=0;h<this._numBits;h++)a|=(r&1<<2*h)>>h;return a}static decode(r,a,h){return{x:Lf.decodeMorton(r,a)-h,y:Lf.decodeMorton(r>>1,a)-h}}static decodeMorton(r,a){let h=0;for(let m=0;m<a;m++)h|=(r&1<<2*m)>>m;return h}}(function(l){l[l.POINT=0]="POINT",l[l.LINESTRING=1]="LINESTRING",l[l.POLYGON=2]="POLYGON",l[l.MULTIPOINT=3]="MULTIPOINT",l[l.MULTILINESTRING=4]="MULTILINESTRING",l[l.MULTIPOLYGON=5]="MULTIPOLYGON"})(co||(co={})),function(l){l[l.POINT=0]="POINT",l[l.LINESTRING=1]="LINESTRING",l[l.POLYGON=2]="POLYGON"}(iu||(iu={})),function(l){l[l.MORTON=0]="MORTON",l[l.VEC_2=1]="VEC_2",l[l.VEC_3=2]="VEC_3"}(ia||(ia={}));class h2{createPoint(r){return[[r]]}createMultiPoint(r){return r.map(a=>[a])}createLineString(r){return[r]}createMultiLineString(r){return r}createPolygon(r,a){return[r,...a]}createMultiPolygon(r){return r.flat()}}function sm(l){const r=new Array(l.numGeometries);let a=1,h=1,m=1,y=0;const b=new h2;let D=0,S=0;const k=l.mortonSettings,F=l.topologyVector,$=F.geometryOffsets,G=F.partOffsets,W=F.ringOffsets,X=l.vertexOffsets,Q=l.containsPolygonGeometry(),re=l.vertexBuffer;for(let ye=0;ye<l.numGeometries;ye++){const Ae=l.geometryType(ye);if(Ae===co.POINT){if(X&&0!==X.length)if(l.vertexBufferType===ia.VEC_2){const Ce=2*X[S++],Me=new Z(re[Ce],re[Ce+1]);r[y++]=b.createPoint(Me)}else{const Ce=X[S++],Me=Lf.decode(re[Ce],k.numBits,k.coordinateShift),Ge=new Z(Me.x,Me.y);r[y++]=b.createPoint(Ge)}else{const Ce=new Z(re[D++],re[D++]);r[y++]=b.createPoint(Ce)}$&&m++,G&&a++,W&&h++}else if(Ae===co.MULTIPOINT){const Ce=$[m]-$[m-1];m++;const Me=new Array(Ce);if(X&&0!==X.length){for(let Ge=0;Ge<Ce;Ge++){const Xe=2*X[S++];Me[Ge]=new Z(re[Xe],re[Xe+1])}r[y++]=b.createMultiPoint(Me)}else{for(let Ge=0;Ge<Ce;Ge++){const Xe=re[D++],mt=re[D++];Me[Ge]=new Z(Xe,mt)}r[y++]=b.createMultiPoint(Me)}}else if(Ae===co.LINESTRING){let Ce,Me=0;Q?(Me=W[h]-W[h-1],h++):Me=G[a]-G[a-1],a++,X&&0!==X.length?(Ce=l.vertexBufferType===ia.VEC_2?zf(re,X,S,Me,!1):Nh(re,X,S,Me,!1,k),S+=Me):(Ce=Nf(re,D,Me,!1),D+=2*Me),r[y++]=b.createLineString(Ce),$&&m++}else if(Ae===co.POLYGON){const Ce=G[a]-G[a-1];a++;const Me=new Array(Ce-1);let Ge=W[h]-W[h-1];if(h++,X&&0!==X.length){const Xe=l.vertexBufferType===ia.VEC_2?Ff(re,X,S,Ge):Uu(re,X,S,Ge,0,k);S+=Ge;for(let mt=0;mt<Me.length;mt++)Ge=W[h]-W[h-1],h++,Me[mt]=l.vertexBufferType===ia.VEC_2?Ff(re,X,S,Ge):Uu(re,X,S,Ge,0,k),S+=Ge;r[y++]=b.createPolygon(Xe,Me)}else{const Xe=Of(re,D,Ge);D+=2*Ge;for(let mt=0;mt<Me.length;mt++)Ge=W[h]-W[h-1],h++,Me[mt]=Of(re,D,Ge),D+=2*Ge;r[y++]=b.createPolygon(Xe,Me)}$&&m++}else if(Ae===co.MULTILINESTRING){const Ce=$[m]-$[m-1];m++;const Me=new Array(Ce);if(X&&0!==X.length){for(let Ge=0;Ge<Ce;Ge++){let Xe=0;Q?(Xe=W[h]-W[h-1],h++):Xe=G[a]-G[a-1],a++;const mt=l.vertexBufferType===ia.VEC_2?zf(re,X,S,Xe,!1):Nh(re,X,S,Xe,!1,k);Me[Ge]=mt,S+=Xe}r[y++]=b.createMultiLineString(Me)}else{for(let Ge=0;Ge<Ce;Ge++){let Xe=0;Q?(Xe=W[h]-W[h-1],h++):Xe=G[a]-G[a-1],a++,Me[Ge]=Nf(re,D,Xe,!1),D+=2*Xe}r[y++]=b.createMultiLineString(Me)}}else{if(Ae!==co.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const Ce=$[m]-$[m-1];m++;const Me=new Array(Ce);let Ge=0;if(X&&0!==X.length){for(let Xe=0;Xe<Ce;Xe++){const mt=G[a]-G[a-1];a++;const Lt=new Array(mt-1);Ge=W[h]-W[h-1],h++;const Pt=l.vertexBufferType===ia.VEC_2?Ff(re,X,S,Ge):Uu(re,X,S,Ge,0,k);S+=Ge;for(let Vt=0;Vt<Lt.length;Vt++)Ge=W[h]-W[h-1],h++,Lt[Vt]=l.vertexBufferType===ia.VEC_2?Ff(re,X,S,Ge):Uu(re,X,S,Ge,0,k),S+=Ge;Me[Xe]=b.createPolygon(Pt,Lt)}r[y++]=b.createMultiPolygon(Me)}else{for(let Xe=0;Xe<Ce;Xe++){const mt=G[a]-G[a-1];a++;const Lt=new Array(mt-1);Ge=W[h]-W[h-1],h++;const Pt=Of(re,D,Ge);D+=2*Ge;for(let Vt=0;Vt<Lt.length;Vt++){const dn=W[h]-W[h-1];h++,Lt[Vt]=Of(re,D,dn),D+=2*dn}Me[Xe]=b.createPolygon(Pt,Lt)}r[y++]=b.createMultiPolygon(Me)}}}}return r}function Of(l,r,a){return Nf(l,r,a,!0)}function Ff(l,r,a,h){return zf(l,r,a,h,!0)}function Uu(l,r,a,h,m,y){return Nh(l,r,a,h,!0,y)}function Nf(l,r,a,h){const m=new Array(h?a+1:a);for(let y=0;y<2*a;y+=2)m[y/2]=new Z(l[r+y],l[r+y+1]);return h&&(m[m.length-1]=m[0]),m}function zf(l,r,a,h,m){const y=new Array(m?h+1:h);for(let b=0;b<2*h;b+=2){const D=2*r[a+b/2];y[b/2]=new Z(l[D],l[D+1])}return m&&(y[y.length-1]=y[0]),y}function Nh(l,r,a,h,m,y){const b=new Array(m?h+1:h);for(let D=0;D<h;D++){const S=Lf.decode(l[r[a+D]],y.numBits,y.coordinateShift);b[D]=new Z(S.x,S.y)}return m&&(b[b.length-1]=b[0]),b}class Gg{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(r,a,h,m,y){this._vertexBufferType=r,this._topologyVector=a,this._vertexOffsets=h,this._vertexBuffer=m,this._mortonSettings=y}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const r=sm(this);let a=0;for(;a<this.numGeometries;)yield{coordinates:r[a],type:this.geometryType(a)},a++}getSimpleEncodedVertex(r){const a=this.vertexOffsets?2*this.vertexOffsets[r]:2*r;return[this.vertexBuffer[a],this.vertexBuffer[a+1]]}getVertex(r){if(this.vertexOffsets&&this.mortonSettings){const h=Lf.decode(this.vertexBuffer[this.vertexOffsets[r]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[h.x,h.y]}const a=this.vertexOffsets?2*this.vertexOffsets[r]:2*r;return[this.vertexBuffer[a],this.vertexBuffer[a+1]]}getGeometries(){return sm(this)}get mortonSettings(){return this._mortonSettings}}class kd extends Gg{_numGeometries;_geometryType;constructor(r,a,h,m,y,b,D){super(h,m,y,b,D),this._numGeometries=r,this._geometryType=a}static createMortonEncoded(r,a,h,m,y,b){return new kd(r,a,ia.MORTON,h,m,y,b)}static create(r,a,h,m,y){return new kd(r,a,ia.VEC_2,h,m,y)}geometryType(r){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===co.POLYGON||this._geometryType===co.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Bf extends Gg{_geometryTypes;constructor(r,a,h,m,y,b){super(r,h,m,y,b),this._geometryTypes=a}static createMortonEncoded(r,a,h,m,y){return new Bf(ia.MORTON,r,a,h,m,y)}static create(r,a,h,m){return new Bf(ia.VEC_2,r,a,h,m)}geometryType(r){return this._geometryTypes[r]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let r=0;r<this.numGeometries;r++)if(this.geometryType(r)===co.POLYGON||this.geometryType(r)===co.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Hy{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(r,a,h,m){this._triangleOffsets=r,this._indexBuffer=a,this._vertexBuffer=h,this._topologyVector=m}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const r=new Array(this.numGeometries),a=this._topologyVector,h=a.partOffsets,m=a.ringOffsets,y=a.geometryOffsets;let b=0,D=1,S=1,k=1;for(let F=0;F<this.numGeometries;F++)switch(this.geometryType(F)){case co.POLYGON:{const $=h[D]-h[D-1];D++;const G=[];for(let W=0;W<$;W++){const X=m[S]-m[S-1];S++;const Q=[];for(let re=0;re<X;re++){const ye=this._vertexBuffer[b++],Ae=this._vertexBuffer[b++];Q.push(new Z(ye,Ae))}Q.length>0&&Q.push(Q[0]),G.push(Q)}r[F]=G,y&&k++}break;case co.MULTIPOLYGON:{const $=y[k]-y[k-1];k++;const G=[];for(let W=0;W<$;W++){const X=h[D]-h[D-1];D++;for(let Q=0;Q<X;Q++){const re=m[S]-m[S-1];S++;const ye=[];for(let Ae=0;Ae<re;Ae++){const Ce=this._vertexBuffer[b++],Me=this._vertexBuffer[b++];ye.push(new Z(Ce,Me))}ye.length>0&&ye.push(ye[0]),G.push(ye)}}r[F]=G}}return r}[Symbol.iterator](){return null}}class Vf extends Hy{_numGeometries;_geometryType;constructor(r,a,h,m,y,b){super(h,m,y,b),this._numGeometries=r,this._geometryType=a}static create(r,a,h,m,y,b){return new Vf(r,a,h,m,y,b)}geometryType(r){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}class Hg extends Hy{_geometryTypes;constructor(r,a,h,m,y){super(a,h,m,y),this._geometryTypes=r}static create(r,a,h,m,y){return new Hg(r,a,h,m,y)}geometryType(r){return this._geometryTypes[r]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function bC(l,r,a,h,m){const y=ra.decode(l,a);let b=null,D=null,S=null,k=null,F=null,$=null,G=null,W=null;if(vi.getVectorType(y,h,l,a)===lo.CONST){const Q=vi.decodeConstIntStream(l,a,y,!1);for(let re=0;re<r-1;re++){const ye=ra.decode(l,a);switch(ye.physicalStreamType){case vs.LENGTH:switch(ye.logicalStreamType.lengthType){case Vi.GEOMETRIES:b=vi.decodeLengthStreamToOffsetBuffer(l,a,ye);break;case Vi.PARTS:D=vi.decodeLengthStreamToOffsetBuffer(l,a,ye);break;case Vi.RINGS:S=vi.decodeLengthStreamToOffsetBuffer(l,a,ye);break;case Vi.TRIANGLES:G=vi.decodeLengthStreamToOffsetBuffer(l,a,ye)}break;case vs.OFFSET:switch(ye.logicalStreamType.offsetType){case Fh.VERTEX:k=vi.decodeIntStream(l,a,ye,!1);break;case Fh.INDEX:W=vi.decodeIntStream(l,a,ye,!1)}break;case vs.DATA:if($a.VERTEX===ye.logicalStreamType.dictionaryType)F=vi.decodeIntStream(l,a,ye,!0,m);else{const Ae=ye;$={numBits:Ae.numBits(),coordinateShift:Ae.coordinateShift()},F=vi.decodeIntStream(l,a,ye,!1,m)}}}if(null!==W){if(null!=b||null!=D){const re=new om(b,D,S);return Vf.create(h,Q,G,W,F,re)}return Vf.create(h,Q,G,W,F)}return null===$?kd.create(h,Q,new om(b,D,S),k,F):kd.createMortonEncoded(h,Q,new om(b,D,S),k,F,$)}const X=vi.decodeIntStream(l,a,y,!1);for(let Q=0;Q<r-1;Q++){const re=ra.decode(l,a);switch(re.physicalStreamType){case vs.LENGTH:switch(re.logicalStreamType.lengthType){case Vi.GEOMETRIES:b=vi.decodeIntStream(l,a,re,!1);break;case Vi.PARTS:D=vi.decodeIntStream(l,a,re,!1);break;case Vi.RINGS:S=vi.decodeIntStream(l,a,re,!1);break;case Vi.TRIANGLES:G=vi.decodeLengthStreamToOffsetBuffer(l,a,re)}break;case vs.OFFSET:switch(re.logicalStreamType.offsetType){case Fh.VERTEX:k=vi.decodeIntStream(l,a,re,!1);break;case Fh.INDEX:W=vi.decodeIntStream(l,a,re,!1)}break;case vs.DATA:if($a.VERTEX===re.logicalStreamType.dictionaryType)F=vi.decodeIntStream(l,a,re,!0,m);else{const ye=re;$={numBits:ye.numBits(),coordinateShift:ye.coordinateShift()},F=vi.decodeIntStream(l,a,re,!1,m)}}}return null!==W&&null===D?Hg.create(X,G,W,F):(null!==b?(b=zh(X,b,2),null!==D&&null!==S?(D=jf(X,b,D,!1),S=function(Q,re,ye,Ae){const Ce=new Int32Array(ye[ye.length-1]+1);let Me=0;Ce[0]=Me;let Ge=1,Xe=1,mt=0;for(let Lt=0;Lt<Q.length;Lt++){const Pt=Q[Lt],Vt=re[Lt+1]-re[Lt];if(0!==Pt&&3!==Pt)for(let dn=0;dn<Vt;dn++){const Jt=ye[Ge]-ye[Ge-1];Ge++;for(let Kt=0;Kt<Jt;Kt++)Me=Ce[Xe++]=Me+Ae[mt++]}else for(let dn=0;dn<Vt;dn++)Ce[Xe++]=++Me,Ge++}return Ce}(X,b,D,S)):null!==D&&(D=function(Q,re,ye){const Ae=new Int32Array(re[re.length-1]+1);let Ce=0;Ae[0]=Ce;let Me=1,Ge=0;for(let Xe=0;Xe<Q.length;Xe++){const mt=Q[Xe],Lt=re[Xe+1]-re[Xe];if(4===mt||1===mt)for(let Pt=0;Pt<Lt;Pt++)Ce=Ae[Me++]=Ce+ye[Ge++];else for(let Pt=0;Pt<Lt;Pt++)Ae[Me++]=++Ce}return Ae}(X,b,D))):null!==D&&null!==S?(D=zh(X,D,1),S=jf(X,D,S,!0)):null!==D&&(D=zh(X,D,0)),null!==W?Hg.create(X,G,W,F,new om(b,D,S)):null===$?Bf.create(X,new om(b,D,S),k,F):Bf.createMortonEncoded(X,new om(b,D,S),k,F,$))}function zh(l,r,a){const h=new Int32Array(l.length+1);let m=0;h[0]=m;let y=0;for(let b=0;b<l.length;b++)m=h[b+1]=m+(l[b]>a?r[y++]:1);return h}function jf(l,r,a,h){const m=new Int32Array(r[r.length-1]+1);let y=0;m[0]=y;let b=1,D=0;for(let S=0;S<l.length;S++){const k=l[S],F=r[S+1]-r[S];if(5===k||2===k||h&&(4===k||1===k))for(let $=0;$<F;$++)y=m[b++]=y+a[D++];else for(let $=0;$<F;$++)m[b++]=++y}return m}class Yb extends Sf{dataVector;constructor(r,a,h){super(r,a.getBuffer(),h),this.dataVector=a}getValueFromBuffer(r){return this.dataVector.get(r)}}class xC extends ju{getValueFromBuffer(r){return this.dataBuffer[r]}}class Zy extends Sf{constructor(r,a,h){super(r,BigInt64Array.of(a),h)}getValueFromBuffer(r){return this.dataBuffer[0]}}function d2(l,r,a){for(let h=0;h<l;h++){const m=ra.decode(r,a);a.add(m.byteLength)}}function Uf(l,r,a){return Xb(l,Math.ceil(r/8),a)}function Xb(l,r,a){const h=new Uint8Array(r);let m=0;for(;m<r;){const y=l[a.increment()];if(y<=127){const b=y+3,D=l[a.increment()],S=m+b;h.fill(D,m,S),m=S}else{const b=256-y;for(let D=0;D<b;D++)h[m++]=l[a.increment()]}}return h}const Kb=new TextDecoder;function am(l,r,a){return a-r>=12?Kb.decode(l.subarray(r,a)):function(h,m,y){let b="",D=m;for(;D<y;){const S=h[D];let k,F,$,G=null,W=S>239?4:S>223?3:S>191?2:1;if(D+W>y)break;1===W?S<128&&(G=S):2===W?(k=h[D+1],128==(192&k)&&(G=(31&S)<<6|63&k,G<=127&&(G=null))):3===W?(k=h[D+1],F=h[D+2],128==(192&k)&&128==(192&F)&&(G=(15&S)<<12|(63&k)<<6|63&F,(G<=2047||G>=55296&&G<=57343)&&(G=null))):4===W&&(k=h[D+1],F=h[D+2],$=h[D+3],128==(192&k)&&128==(192&F)&&128==(192&$)&&(G=(15&S)<<18|(63&k)<<12|(63&F)<<6|63&$,(G<=65535||G>=1114112)&&(G=null))),null===G?(G=65533,W=1):G>65535&&(G-=65536,b+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),b+=String.fromCharCode(G),D+=W}return b}(l,r,a)}class qy extends Sf{offsetBuffer;constructor(r,a,h,m){super(r,h,m),this.offsetBuffer=a}}class Wy extends qy{textEncoder;constructor(r,a,h,m){super(r,a,h,m??a.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(r){return am(this.dataBuffer,this.offsetBuffer[r],this.offsetBuffer[r+1])}}class Rd extends qy{indexBuffer;textEncoder;constructor(r,a,h,m,y){super(r,h,m,y??a.length),this.indexBuffer=a,this.indexBuffer=a,this.textEncoder=new TextEncoder}getValueFromBuffer(r){const a=this.indexBuffer[r];return am(this.dataBuffer,this.offsetBuffer[a],this.offsetBuffer[a+1])}}class Qb extends qy{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(r,a,h,m,y,b,D){super(r,h,m,D),this.indexBuffer=a,this.symbolOffsetBuffer=y,this.symbolTableBuffer=b,this.textEncoder=new TextEncoder}getValueFromBuffer(r){null==this.decodedDictionary&&(null==this.symbolLengthBuffer&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=function(h,m,y){const b=[],D=new Array(m.length).fill(0);for(let S=1;S<m.length;S++)D[S]=D[S-1]+m[S-1];for(let S=0;S<y.length;S++)if(255===y[S])b.push(y[++S]);else{const k=m[y[S]],F=D[y[S]];for(let $=0;$<k;$++)b.push(h[F+$])}return new Uint8Array(b)}(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const a=this.indexBuffer[r];return am(this.decodedDictionary,this.offsetBuffer[a],this.offsetBuffer[a+1])}offsetToLengthBuffer(r){const a=new Uint32Array(r.length-1);let h=r[0];for(let m=1;m<r.length;m++){const y=r[m];a[m-1]=y-h,h=y}return a}}let Jb=(()=>{class l{static ROOT_COLUMN_NAME="default";static NESTED_COLUMN_SEPARATOR=":";constructor(){}static decode(a,h,m,y,b){let D=null,S=null,k=null,F=null,$=null,G=null,W=null,X=null;for(let Q=0;Q<y;Q++){const re=ra.decode(h,m);if(0!==re.byteLength)switch(re.physicalStreamType){case vs.PRESENT:{const ye=Uf(h,re.numValues,m);G=new ml(ye,re.numValues);break}case vs.OFFSET:S=null!=b||null!=G?vi.decodeNullableIntStream(h,m,re,!1,b??G):vi.decodeIntStream(h,m,re,!1);break;case vs.LENGTH:{const ye=vi.decodeLengthStreamToOffsetBuffer(h,m,re);Vi.DICTIONARY===re.logicalStreamType.lengthType?D=ye:Vi.SYMBOL===re.logicalStreamType.lengthType?F=ye:W=ye;break}case vs.DATA:{const ye=h.subarray(m.get(),m.get()+re.byteLength);m.add(re.byteLength);const Ae=re.logicalStreamType.dictionaryType;$a.FSST===Ae?$=ye:$a.SINGLE===Ae||$a.SHARED===Ae?k=ye:$a.NONE===Ae&&(X=ye);break}}}return this.decodeFsstDictionaryVector(a,$,S,D,k,F,b??G)??this.decodeDictionaryVector(a,k,S,D,b??G)??this.decodePlainStringVector(a,W,X,S,b??G)}static decodeFsstDictionaryVector(a,h,m,y,b,D,S){return h?new Qb(a,m,y,b,D,h,S):null}static decodeDictionaryVector(a,h,m,y,b){return h?b?new Rd(a,m,y,h,b):new Rd(a,m,y,h):null}static decodePlainStringVector(a,h,m,y,b){if(!h||!m)return null;if(y)return b?new Rd(a,y,h,m,b):new Rd(a,y,h,m);if(b&&b.size()!==h.length-1){const D=new Int32Array(b.size());let S=0;for(let k=0;k<b.size();k++)D[k]=b.get(k)?S++:0;return new Rd(a,D,h,m,b)}return b?new Wy(a,h,m,b):new Wy(a,h,m)}static decodeSharedDictionary(a,h,m,y,b){let D=null,S=null,k=null,F=null,$=!1;for(;!$;){const Q=ra.decode(a,h);switch(Q.physicalStreamType){case vs.LENGTH:Vi.DICTIONARY===Q.logicalStreamType.lengthType?D=vi.decodeLengthStreamToOffsetBuffer(a,h,Q):k=vi.decodeLengthStreamToOffsetBuffer(a,h,Q);break;case vs.DATA:$a.SINGLE===Q.logicalStreamType.dictionaryType||$a.SHARED===Q.logicalStreamType.dictionaryType?(S=a.subarray(h.get(),h.get()+Q.byteLength),$=!0):F=a.subarray(h.get(),h.get()+Q.byteLength),h.add(Q.byteLength)}}const G=m.complexType.children,W=[];let X=0;for(const Q of G){const re=Zo(a,h,1)[0];if(0==re)continue;const ye=`${m.name}${Q.name===l.ROOT_COLUMN_NAME?"":l.NESTED_COLUMN_SEPARATOR+Q.name}`;if(b&&!b.has(ye)){d2(re,a,h);continue}if(2!==re||"scalarField"!==Q.type||9!==Q.scalarField.physicalType)throw new Error("Currently only optional string fields are implemented for a struct.");const Ae=ra.decode(a,h),Ce=Uf(a,Ae.numValues,h),Me=ra.decode(a,h),Ge=(Me instanceof rm?Me.numRleValues:Me.numValues)!==y?vi.decodeNullableIntStream(a,h,Me,!1,new ml(Ce,Ae.numValues)):vi.decodeIntStream(a,h,Me,!1);W[X++]=F?new Qb(ye,Ge,D,S,k,F,new ml(Ce,Ae.numValues)):new Rd(ye,Ge,D,S,new ml(Ce,Ae.numValues))}return W}}return l})();function $u(l,r,a,h,m,y){return"scalarType"===a.type?function(b,D,S,k,F,$){let G=null,W=0;if(0===b)return null;if($.nullable){const Q=ra.decode(D,S);W=Q.numValues;const re=S.get(),ye=Uf(D,W,S);S.set(re+Q.byteLength),G=new ml(ye,Q.numValues)}const X=G??k;switch(F.physicalType){case 4:case 3:return function(Q,re,ye,Ae,Ce){const Me=ra.decode(Q,re),Ge=vi.getVectorType(Me,Ce,Q,re),Xe=3===Ae.physicalType;if(Ge===lo.FLAT){const mt=lm(Ce)?vi.decodeNullableIntStream(Q,re,Me,Xe,Ce):vi.decodeIntStream(Q,re,Me,Xe);return new nm(ye.name,mt,Ce)}if(Ge===lo.SEQUENCE){const mt=vi.decodeSequenceIntStream(Q,re,Me);return new Vg(ye.name,mt[0],mt[1],Me.numRleValues)}{const mt=vi.decodeConstIntStream(Q,re,Me,Xe);return new jg(ye.name,mt,Ce)}}(D,S,$,F,X);case 9:return Jb.decode($.name,D,S,$.nullable?b-1:b,G);case 0:return function(Q,re,ye,Ae,Ce){const Me=ra.decode(Q,re),Ge=Me.numValues,Xe=re.get(),mt=lm(Ce)?function(Pt,Vt,dn,Jt){const Kt=Xb(Pt,Math.ceil(Vt/8),dn),It=new ml(Kt,Vt),Vn=Jt.size(),jn=new ml(new Uint8Array(Vn),Vn);let qn=0;for(let Dn=0;Dn<Jt.size();Dn++){const Ii=!!Jt.get(Dn)&&It.get(qn++);jn.set(Dn,Ii)}return jn.getBuffer()}(Q,Ge,re,Ce):Uf(Q,Ge,re);re.set(Xe+Me.byteLength);const Lt=new ml(mt,Ge);return new Yb(ye.name,Lt,Ce)}(D,S,$,0,X);case 6:case 5:return function(Q,re,ye,Ae,Ce){const Me=ra.decode(Q,re),Ge=vi.getVectorType(Me,Ae,Q,re),Xe=5===Ce.physicalType;if(Ge===lo.FLAT){const mt=lm(Ae)?vi.decodeNullableLongStream(Q,re,Me,Xe,Ae):vi.decodeLongStream(Q,re,Me,Xe);return new Gy(ye.name,mt,Ae)}if(Ge===lo.SEQUENCE){const mt=vi.decodeSequenceLongStream(Q,re,Me);return new qb(ye.name,mt[0],mt[1],Me.numRleValues)}{const mt=vi.decodeConstLongStream(Q,re,Me,Xe);return new Zy(ye.name,mt,Ae)}}(D,S,$,X,F);case 7:return function(Q,re,ye,Ae){const Ce=ra.decode(Q,re),Me=lm(Ae)?function(Ge,Xe,mt,Lt){const Pt=Xe.get(),Vt=Pt+Lt*Float32Array.BYTES_PER_ELEMENT,dn=new Uint8Array(Ge.subarray(Pt,Vt)).buffer,Jt=new Float32Array(dn);Xe.set(Vt);const Kt=mt.size(),It=new Float32Array(Kt);let Vn=0;for(let jn=0;jn<Kt;jn++)It[jn]=mt.get(jn)?Jt[Vn++]:0;return It}(Q,re,Ae,Ce.numValues):function(Ge,Xe,mt){const Lt=Xe.get(),Pt=Lt+mt*Float32Array.BYTES_PER_ELEMENT,Vt=new Uint8Array(Ge.subarray(Lt,Pt)).buffer,dn=new Float32Array(Vt);return Xe.set(Pt),dn}(Q,re,Ce.numValues);return new xC(ye.name,Me,Ae)}(D,S,$,X);case 8:return function(Q,re,ye,Ae){const Ce=ra.decode(Q,re),Me=lm(Ae)?function(Ge,Xe,mt,Lt){const Pt=Xe.get(),Vt=Pt+Lt*Float64Array.BYTES_PER_ELEMENT,dn=new Uint8Array(Ge.subarray(Pt,Vt)).buffer,Jt=new Float64Array(dn);Xe.set(Vt);const Kt=mt.size(),It=new Float64Array(Kt);let Vn=0;for(let jn=0;jn<Kt;jn++)It[jn]=mt.get(jn)?Jt[Vn++]:0;return It}(Q,re,Ae,Ce.numValues):function(Ge,Xe,mt){const Lt=Xe.get(),Pt=Lt+mt*Float64Array.BYTES_PER_ELEMENT,Vt=new Uint8Array(Ge.subarray(Lt,Pt)).buffer,dn=new Float64Array(Vt);return Xe.set(Pt),dn}(Q,re,Ce.numValues);return new Bg(ye.name,Me,Ae)}(D,S,$,X);default:throw new Error(`The specified data type for the field is currently not supported: ${F}`)}}(h,l,r,m,a.scalarType,a):1!=h?null:Jb.decodeSharedDictionary(l,r,a,m,y)}function lm(l){return l instanceof ml}class Yy{static decodeColumnType(r){switch(r){case 0:case 1:case 2:case 3:{const a={};a.nullable=!!(1&r),a.columnScope=0;const h={};return h.physicalType=r>1?6:4,h.type="physicalType",a.scalarType=h,a.type="scalarType",a}case 4:{const a={nullable:!1,columnScope:0},h={type:"physicalType",physicalType:0};return a.type="complexType",a.complexType=h,a}case 30:{const a={nullable:!1,columnScope:0},h={type:"physicalType",physicalType:1};return a.type="complexType",a.complexType=h,a}default:return this.mapScalarType(r)}}static columnTypeHasName(r){return r>=10}static columnTypeHasChildren(r){return 30===r}static hasStreamCount(r){if("id"===r.name)return!1;if("scalarType"===r.type){const a=r.scalarType;if("physicalType"===a.type)switch(a.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if("logicalType"===a.type)return!1}else if("complexType"===r.type){const a=r.complexType;if("physicalType"===a.type)switch(a.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",r),!1}static mapScalarType(r){let a=null;switch(r){case 10:case 11:a=0;break;case 12:case 13:a=1;break;case 14:case 15:a=2;break;case 16:case 17:a=3;break;case 18:case 19:a=4;break;case 20:case 21:a=5;break;case 22:case 23:a=6;break;case 24:case 25:a=7;break;case 26:case 27:a=8;break;case 28:case 29:a=9;break;default:return null}const h={};h.nullable=!!(1&r),h.columnScope=0;const m={type:"physicalType"};return m.physicalType=a,h.type="scalarType",h.scalarType=m,h}}const Xy=new TextDecoder;function wC(l,r){const a=Zo(l,r,1)[0];if(0===a)return"";const h=r.get(),m=l.subarray(h,h+a);return r.add(a),Xy.decode(m)}function cm(l,r){const a=Zo(l,r,1)[0]>>>0,h=!!(4&a),m=!!(2&a),y=Zo(l,r,1)[0]>>>0,b={};if(1&a&&(b.nullable=!0),m){const D={};if(h?(D.type="logicalType",D.logicalType=y):(D.type="physicalType",D.physicalType=y),8&a){const S=Zo(l,r,1)[0]>>>0;D.children=new Array(S);for(let k=0;k<S;k++)D.children[k]=cm(l,r)}b.type="complexField",b.complexField=D}else{const D={};h?(D.type="logicalType",D.logicalType=y):(D.type="physicalType",D.physicalType=y),b.type="scalarField",b.scalarField=D}return b}function um(l,r){const a=Zo(l,r,1)[0]>>>0,h=Yy.decodeColumnType(a);if(!h)throw new Error(`Unsupported column type code: ${a}`);if(Yy.columnTypeHasName(a)?h.name=wC(l,r):a>=0&&a<=3?h.name="id":4===a&&(h.name="geometry"),Yy.columnTypeHasChildren(a)){const m=Zo(l,r,1)[0]>>>0,y=h.complexType;y.children=new Array(m);for(let b=0;b<m;b++)y.children[b]=cm(l,r)}return h}function CC(l,r){const a={featureTables:[]},h={};h.name=wC(l,r);const m=Zo(l,r,1)[0]>>>0,y=Zo(l,r,1)[0]>>>0;h.columns=new Array(y);for(let b=0;b<y;b++)h.columns[b]=um(l,r);return a.featureTables.push(h),[a,m]}function ex(l,r,a,h,m,y,b=!1){const D=r.scalarType.physicalType,S=vi.getVectorType(m,y,l,a);if(4===D)switch(S){case lo.FLAT:{const k=vi.decodeIntStream(l,a,m,!1);return new nm(h,k,y)}case lo.SEQUENCE:{const k=vi.decodeSequenceIntStream(l,a,m);return new Vg(h,k[0],k[1],m.numRleValues)}case lo.CONST:{const k=vi.decodeConstIntStream(l,a,m,!1);return new jg(h,k,y)}}else switch(S){case lo.FLAT:{if(b){const F=vi.decodeLongFloat64Stream(l,a,m,!1);return new Bg(h,F,y)}const k=vi.decodeLongStream(l,a,m,!1);return new Gy(h,k,y)}case lo.SEQUENCE:{const k=vi.decodeSequenceLongStream(l,a,m);return new qb(h,k[0],k[1],m.numRleValues)}case lo.CONST:{const k=vi.decodeConstLongStream(l,a,m,!1);return new Zy(h,k,y)}}throw new Error("Vector type not supported for id column.")}class TC{constructor(r,a){var h;switch(this._featureData=r,this.properties=this._featureData.properties||{},null===(h=this._featureData.geometry)||void 0===h?void 0:h.type){case co.POINT:case co.MULTIPOINT:this.type=1;break;case co.LINESTRING:case co.MULTILINESTRING:this.type=2;break;case co.POLYGON:case co.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=a,this.id=Number(this._featureData.id)}projectPoint(r,a,h,m){return[360*(r.x+a)/m-180,360/Math.PI*Math.atan(Math.exp((1-2*(r.y+h)/m)*Math.PI))-90]}projectLine(r,a,h,m){return r.map(y=>this.projectPoint(y,a,h,m))}toGeoJSON(r,a,h){const m=this.extent*Math.pow(2,h),y=this.extent*r,b=this.extent*a,D=this.loadGeometry();let S;switch(this.type){case 1:{const F=[];for(const G of D)F.push(G[0]);const $=this.projectLine(F,y,b,m);S=1===F.length?{type:"Point",coordinates:$[0]}:{type:"MultiPoint",coordinates:$};break}case 2:{const F=D.map($=>this.projectLine($,y,b,m));S=1===F.length?{type:"LineString",coordinates:F[0]}:{type:"MultiLineString",coordinates:F};break}case 3:{const F=Na(D),$=[];for(const G of F)$.push(G.map(W=>this.projectLine(W,y,b,m)));S=1===$.length?{type:"Polygon",coordinates:$[0]}:{type:"MultiPolygon",coordinates:$};break}default:throw new Error(`unknown feature type: ${this.type}`)}const k={type:"Feature",geometry:S,properties:this.properties};return null!=this.id&&(k.id=this.id),k}loadGeometry(){const r=[];for(const a of this._featureData.geometry.coordinates){const h=[];for(const m of a)h.push(new Z(m.x,m.y));r.push(h)}return r}bbox(){return[0,0,0,0]}}class DC{constructor(r){this.features=[],this.featureTable=r,this.name=r.name,this.extent=r.extent,this.version=2,this.features=r.getFeatures(),this.length=this.features.length}feature(r){return new TC(this.features[r],this.extent)}}class Ky{constructor(r){this.layers={};const a=function(h,m,y=!0){const b=new vC(0),D=[];for(;b.get()<h.length;){const S=Zo(h,b,1)[0]>>>0,k=b.get()+S;if(k>h.length)throw new Error(`Block overruns tile: ${k} > ${h.length}`);if(Zo(h,b,1)[0]>>>0!=1){b.set(k);continue}const F=CC(h,b),$=F[1],G=F[0].featureTables[0];let W=null,X=null;const Q=[];let re=0;for(const Ae of G.columns){const Ce=Ae.name;if("id"===Ce){let Me=null;if(Ae.nullable){const Xe=ra.decode(h,b),mt=b.get(),Lt=Uf(h,Xe.numValues,b);b.set(mt+Xe.byteLength),Me=new ml(Lt,Xe.numValues)}const Ge=ra.decode(h,b);re=Ge.getDecompressedCount(),W=ex(h,Ae,b,Ce,Ge,Me??re,y)}else if("geometry"===Ce){const Me=Zo(h,b,1)[0];if(0===re){const Ge=b.get();re=ra.decode(h,b).getDecompressedCount(),b.set(Ge)}X=bC(h,Me,b,re,m)}else{const Me=Yy.hasStreamCount(Ae)?Zo(h,b,1)[0]:1;if(0===Me&&"scalarType"===Ae.type)continue;const Ge=$u(h,b,Ae,Me,re,void 0);Ge&&(Array.isArray(Ge)?Q.push(...Ge):Q.push(Ge))}}const ye=new Gb(G.name,X,W,Q,$);D.push(ye),b.set(k)}return D}(new Uint8Array(r));this.layers=a.reduce((h,m)=>Object.assign(Object.assign({},h),{[m.name]:new DC(m)}),{})}}class Bh{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(r){return this.minX=Math.min(this.minX,r.x),this.minY=Math.min(this.minY,r.y),this.maxX=Math.max(this.maxX,r.x),this.maxY=Math.max(this.maxY,r.y),this}expandBy(r){return this.minX-=r,this.minY-=r,this.maxX+=r,this.maxY+=r,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(r){return this.expandBy(-r)}map(r){const a=new Bh;return a.extend(r(new Z(this.minX,this.minY))),a.extend(r(new Z(this.maxX,this.minY))),a.extend(r(new Z(this.minX,this.maxY))),a.extend(r(new Z(this.maxX,this.maxY))),a}static fromPoints(r){const a=new Bh;for(const h of r)a.extend(h);return a}contains(r){return r.x>=this.minX&&r.x<=this.maxX&&r.y>=this.minY&&r.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(r){return!this.empty()&&!r.empty()&&r.minX>=this.minX&&r.maxX<=this.maxX&&r.minY>=this.minY&&r.maxY<=this.maxY}intersects(r){return!this.empty()&&!r.empty()&&r.minX<=this.maxX&&r.maxX>=this.minX&&r.minY<=this.maxY&&r.maxY>=this.minY}}const Qy="_geojsonTileLayer";class tx{constructor(r,a){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new qc(pt,16,0),this.grid3D=new qc(pt,16,0),this.featureIndexArray=new De,this.promoteId=a}insert(r,a,h,m,y,b){const D=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,m,y);const S=b?this.grid3D:this.grid;for(let k=0;k<a.length;k++){const F=a[k],$=[1/0,1/0,-1/0,-1/0];for(let G=0;G<F.length;G++){const W=F[G];$[0]=Math.min($[0],W.x),$[1]=Math.min($[1],W.y),$[2]=Math.max($[2],W.x),$[3]=Math.max($[3],W.y)}$[0]<pt&&$[1]<pt&&$[2]>=0&&$[3]>=0&&S.insert(D,$[0],$[1],$[2],$[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers="mlt"!==this.encoding?new mb(new Py(this.rawTileData)).layers:new Ky(this.rawTileData).layers,this.sourceLayerCoder=new yC(this.vtLayers?Object.keys(this.vtLayers).sort():[Qy])),this.vtLayers}query(r,a,h,m){this.loadVTLayers();const y=r.params,b=pt/r.tileSize/r.scale,D=wt(y.filter,y.globalState),S=r.queryGeometry,k=r.queryPadding*b,F=Bh.fromPoints(S),$=this.grid.query(F.minX-k,F.minY-k,F.maxX+k,F.maxY+k),G=Bh.fromPoints(r.cameraQueryGeometry).expandBy(k),W=this.grid3D.query(G.minX,G.minY,G.maxX,G.maxY,(re,ye,Ae,Ce)=>function(Me,Ge,Xe,mt,Lt){for(const Vt of Me)if(Ge<=Vt.x&&Xe<=Vt.y&&mt>=Vt.x&&Lt>=Vt.y)return!0;const Pt=[new Z(Ge,Xe),new Z(Ge,Lt),new Z(mt,Lt),new Z(mt,Xe)];if(Me.length>2)for(const Vt of Pt)if(mf(Me,Vt))return!0;for(let Vt=0;Vt<Me.length-1;Vt++)if(zp(Me[Vt],Me[Vt+1],Pt))return!0;return!1}(r.cameraQueryGeometry,re-k,ye-k,Ae+k,Ce+k));for(const re of W)$.push(re);$.sort(nx);const X={};let Q;for(let re=0;re<$.length;re++){const ye=$[re];if(ye===Q)continue;Q=ye;const Ae=this.featureIndexArray.get(ye);let Ce=null;this.loadMatchingFeature(X,Ae.bucketIndex,Ae.sourceLayerIndex,Ae.featureIndex,D,y.layers,y.availableImages,a,h,m,(Me,Ge,Xe)=>(Ce||(Ce=Gl(Me)),Ge.queryIntersectsFeature({queryGeometry:S,feature:Me,featureState:Xe,geometry:Ce,zoom:this.z,transform:r.transform,pixelsToTileUnits:b,pixelPosMatrix:r.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:r.getElevation})))}return X}loadMatchingFeature(r,a,h,m,y,b,D,S,k,F,$){const G=this.bucketLayerIDs[a];if(b&&!G.some(re=>b.has(re)))return;const W=this.sourceLayerCoder.decode(h),X=this.vtLayers[W].feature(m);if(y.needGeometry){const re=hl(X,!0);if(!y.filter(new Dr(this.tileID.overscaledZ),re,this.tileID.canonical))return}else if(!y.filter(new Dr(this.tileID.overscaledZ),X))return;const Q=this.getId(X,W);for(let re=0;re<G.length;re++){const ye=G[re];if(b&&!b.has(ye))continue;const Ae=S[ye];if(!Ae)continue;let Ce={};Q&&F&&(Ce=F.getState(Ae.sourceLayer||Qy,Q));const Me=Zn({},k[ye]);Me.paint=$f(Me.paint,Ae.paint,X,Ce,D),Me.layout=$f(Me.layout,Ae.layout,X,Ce,D);const Ge=!$||$(X,Ae,Ce);if(!Ge)continue;const Xe=new tm(X,this.z,this.x,this.y,Q);Xe.layer=Me;let mt=r[ye];void 0===mt&&(mt=r[ye]=[]),mt.push({featureIndex:m,feature:Xe,intersectionZ:Ge})}}lookupSymbolFeatures(r,a,h,m,y,b,D,S){const k={};this.loadVTLayers();const F=wt(y.filterSpec,y.globalState);for(const $ of r)this.loadMatchingFeature(k,h,m,$,F,b,D,S,a);return k}hasLayer(r){for(const a of this.bucketLayerIDs)for(const h of a)if(r===h)return!0;return!1}getId(r,a){var h;let m=r.id;return this.promoteId&&(m=r.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[a]],"boolean"==typeof m&&(m=Number(m)),void 0===m&&!(null===(h=r.properties)||void 0===h)&&h.cluster&&this.promoteId&&(m=Number(r.properties.cluster_id))),m}}function $f(l,r,a,h,m){return ir(l,(y,b)=>{const D=r instanceof Au?r.get(b):null;return D&&D.evaluate?D.evaluate(a,h,m):D})}function nx(l,r){return r-l}function Zg(l,r,a,h,m){const y=[];for(let b=0;b<l.length;b++){const D=l[b];let S;for(let k=0;k<D.length-1;k++){let F=D[k],$=D[k+1];F.x<r&&$.x<r||(F.x<r?F=new Z(r,F.y+(r-F.x)/($.x-F.x)*($.y-F.y))._round():$.x<r&&($=new Z(r,F.y+(r-F.x)/($.x-F.x)*($.y-F.y))._round()),F.y<a&&$.y<a||(F.y<a?F=new Z(F.x+(a-F.y)/($.y-F.y)*($.x-F.x),a)._round():$.y<a&&($=new Z(F.x+(a-F.y)/($.y-F.y)*($.x-F.x),a)._round()),F.x>=h&&$.x>=h||(F.x>=h?F=new Z(h,F.y+(h-F.x)/($.x-F.x)*($.y-F.y))._round():$.x>=h&&($=new Z(h,F.y+(h-F.x)/($.x-F.x)*($.y-F.y))._round()),F.y>=m&&$.y>=m||(F.y>=m?F=new Z(F.x+(m-F.y)/($.y-F.y)*($.x-F.x),m)._round():$.y>=m&&($=new Z(F.x+(m-F.y)/($.y-F.y)*($.x-F.x),m)._round()),S&&F.equals(S[S.length-1])||(S=[F],y.push(S)),S.push($)))))}}return y}function ix(l,r,a,h,m){switch(r){case 1:return function(y,b,D,S){const k=[];for(const F of y)for(const $ of F){const G=0===S?$.x:$.y;G>=b&&G<=D&&k.push([$])}return k}(l,a,h,m);case 2:return MC(l,a,h,m,!1);case 3:return MC(l,a,h,m,!0)}return[]}function f2(l,r,a,h,m){const y=0===h?p2:hm;let b=[];const D=[];for(let F=0;F<l.length-1;F++){const $=l[F],G=l[F+1],W=0===h?$.x:$.y,X=0===h?G.x:G.y;let Q=!1;W<r?X>r&&b.push(y($,G,r)):W>a?X<a&&b.push(y($,G,a)):b.push($),X<r&&W>=r&&(b.push(y($,G,r)),Q=!0),X>a&&W<=a&&(b.push(y($,G,a)),Q=!0),!m&&Q&&(D.push(b),b=[])}const S=l.length-1,k=0===h?l[S].x:l[S].y;return k>=r&&k<=a&&b.push(l[S]),m&&b.length>0&&!b[0].equals(b[b.length-1])&&b.push(new Z(b[0].x,b[0].y)),b.length>0&&D.push(b),D}function MC(l,r,a,h,m){const y=[];for(const b of l){const D=f2(b,r,a,h,m);D.length>0&&y.push(...D)}return y}function p2(l,r,a){return new Z(a,l.y+(a-l.x)/(r.x-l.x)*(r.y-l.y))}function hm(l,r,a){return new Z(l.x+(a-l.y)/(r.y-l.y)*(r.x-l.x),a)}hn("FeatureIndex",tx,{omit:["rawTileData","sourceLayerCoder"]});class Vh extends Z{constructor(r,a,h,m){super(r,a),this.angle=h,void 0!==m&&(this.segment=m)}clone(){return new Vh(this.x,this.y,this.angle,this.segment)}}function dm(l,r,a,h,m){if(void 0===r.segment||0===a)return!0;let y=r,b=r.segment+1,D=0;for(;D>-a/2;){if(b--,b<0)return!1;D-=l[b].dist(y),y=l[b]}D+=l[b].dist(l[b+1]),b++;const S=[];let k=0;for(;D<a/2;){const F=l[b],$=l[b+1];if(!$)return!1;let G=l[b-1].angleTo(F)-F.angleTo($);for(G=Math.abs((G+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:D,angleDelta:G}),k+=G;D-S[0].distance>h;)k-=S.shift().angleDelta;if(k>m)return!1;b++,D+=F.dist($)}return!0}function qg(l){let r=0;for(let a=0;a<l.length-1;a++)r+=l[a].dist(l[a+1]);return r}function Gf(l,r,a){return l?.6*r*a:0}function EC(l,r){return Math.max(l?l.right-l.left:0,r?r.right-r.left:0)}function m2(l,r,a,h,m,y){const b=Gf(a,m,y),D=EC(a,h)*y;let S=0;const k=qg(l)/2;for(let F=0;F<l.length-1;F++){const $=l[F],G=l[F+1],W=$.dist(G);if(S+W>k){const X=(k-S)/W,Q=_o.number($.x,G.x,X),re=_o.number($.y,G.y,X),ye=new Vh(Q,re,G.angleTo($),F);return ye._round(),!b||dm(l,ye,D,b,r)?ye:void 0}S+=W}}function rx(l,r,a,h,m,y,b,D,S){const k=Gf(h,y,b),F=EC(h,m),$=F*b,G=0===l[0].x||l[0].x===S||0===l[0].y||l[0].y===S;return r-$<r/4&&(r=$+r/4),ox(l,G?r/2*D%r:(F/2+2*y)*b*D%r,r,k,a,$,G,!1,S)}function ox(l,r,a,h,m,y,b,D,S){const k=y/2,F=qg(l);let $=0,G=r-a,W=[];for(let X=0;X<l.length-1;X++){const Q=l[X],re=l[X+1],ye=Q.dist(re),Ae=re.angleTo(Q);for(;G+a<$+ye;){G+=a;const Ce=(G-$)/ye,Me=_o.number(Q.x,re.x,Ce),Ge=_o.number(Q.y,re.y,Ce);if(Me>=0&&Me<S&&Ge>=0&&Ge<S&&G-k>=0&&G+k<=F){const Xe=new Vh(Me,Ge,Ae,X);Xe._round(),h&&!dm(l,Xe,y,h,m)||W.push(Xe)}}$+=ye}return D||W.length||b||(W=ox(l,$/2,a,h,m,y,b,!0,S)),W}function Jy(l,r,a,h){const m=[],y=l.image,b=y.pixelRatio,D=y.paddedRect.w-2,S=y.paddedRect.h-2;let k={x1:l.left,y1:l.top,x2:l.right,y2:l.bottom};const F=y.stretchX||[[0,D]],$=y.stretchY||[[0,S]],G=(It,Vn)=>It+Vn[1]-Vn[0],W=F.reduce(G,0),X=$.reduce(G,0),Q=D-W,re=S-X;let ye=0,Ae=W,Ce=0,Me=X,Ge=0,Xe=Q,mt=0,Lt=re;if(y.content&&h){const It=y.content,Vn=It[2]-It[0],jn=It[3]-It[1];(y.textFitWidth||y.textFitHeight)&&(k=Ec(l)),ye=Hf(F,0,It[0]),Ce=Hf($,0,It[1]),Ae=Hf(F,It[0],It[2]),Me=Hf($,It[1],It[3]),Ge=It[0]-ye,mt=It[1]-Ce,Xe=Vn-Ae,Lt=jn-Me}const Pt=k.x1,Vt=k.y1,dn=k.x2-Pt,Jt=k.y2-Vt,Kt=(It,Vn,jn,qn)=>{const Dn=ru(It.stretch-ye,Ae,dn,Pt),Ii=fm(It.fixed-Ge,Xe,It.stretch,W),jr=ru(Vn.stretch-Ce,Me,Jt,Vt),Fo=fm(Vn.fixed-mt,Lt,Vn.stretch,X),Os=ru(jn.stretch-ye,Ae,dn,Pt),gl=fm(jn.fixed-Ge,Xe,jn.stretch,W),oa=ru(qn.stretch-Ce,Me,Jt,Vt),bs=fm(qn.fixed-mt,Lt,qn.stretch,X),Fs=new Z(Dn,jr),uo=new Z(Os,jr),No=new Z(Os,oa),Ns=new Z(Dn,oa),xs=new Z(Ii/b,Fo/b),Pa=new Z(gl/b,bs/b),Rr=r*Math.PI/180;if(Rr){const zo=Math.sin(Rr),Ur=Math.cos(Rr),Bo=[Ur,-zo,zo,Ur];Fs._matMult(Bo),uo._matMult(Bo),Ns._matMult(Bo),No._matMult(Bo)}const zs=It.stretch+It.fixed,Yl=Vn.stretch+Vn.fixed;return{tl:Fs,tr:uo,bl:Ns,br:No,tex:{x:y.paddedRect.x+1+zs,y:y.paddedRect.y+1+Yl,w:jn.stretch+jn.fixed-zs,h:qn.stretch+qn.fixed-Yl},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:xs,pixelOffsetBR:Pa,minFontScaleX:Xe/b/dn,minFontScaleY:Lt/b/Jt,isSDF:a}};if(h&&(y.stretchX||y.stretchY)){const It=ev(F,Q,W),Vn=ev($,re,X);for(let jn=0;jn<It.length-1;jn++){const qn=It[jn],Dn=It[jn+1];for(let Ii=0;Ii<Vn.length-1;Ii++)m.push(Kt(qn,Vn[Ii],Dn,Vn[Ii+1]))}}else m.push(Kt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:D+1},{fixed:0,stretch:S+1}));return m}function Hf(l,r,a){let h=0;for(const m of l)h+=Math.max(r,Math.min(a,m[1]))-Math.max(r,Math.min(a,m[0]));return h}function ev(l,r,a){const h=[{fixed:-1,stretch:0}];for(const[m,y]of l){const b=h[h.length-1];h.push({fixed:m-b.stretch,stretch:b.stretch}),h.push({fixed:m-b.stretch,stretch:b.stretch+(y-m)})}return h.push({fixed:r+1,stretch:a}),h}function ru(l,r,a,h){return l/r*a+h}function fm(l,r,a,h){return l-r*a/h}hn("Anchor",Vh);class Wg{constructor(r,a,h,m,y,b,D,S,k,F){var $;if(this.boxStartIndex=r.length,k){let G=b.top,W=b.bottom;const X=b.collisionPadding;X&&(G-=X[1],W+=X[3]);let Q=W-G;Q>0&&(Q=Math.max(10,Q),this.circleDiameter=Q)}else{const G=null!==($=b.image)&&void 0!==$&&$.content&&(b.image.textFitWidth||b.image.textFitHeight)?Ec(b):{x1:b.left,y1:b.top,x2:b.right,y2:b.bottom};G.y1=G.y1*D-S[0],G.y2=G.y2*D+S[2],G.x1=G.x1*D-S[3],G.x2=G.x2*D+S[1];const W=b.collisionPadding;if(W&&(G.x1-=W[0]*D,G.y1-=W[1]*D,G.x2+=W[2]*D,G.y2+=W[3]*D),F){const X=new Z(G.x1,G.y1),Q=new Z(G.x2,G.y1),re=new Z(G.x1,G.y2),ye=new Z(G.x2,G.y2),Ae=F*Math.PI/180;X._rotate(Ae),Q._rotate(Ae),re._rotate(Ae),ye._rotate(Ae),G.x1=Math.min(X.x,Q.x,re.x,ye.x),G.x2=Math.max(X.x,Q.x,re.x,ye.x),G.y1=Math.min(X.y,Q.y,re.y,ye.y),G.y2=Math.max(X.y,Q.y,re.y,ye.y)}r.emplaceBack(a.x,a.y,G.x1,G.y1,G.x2,G.y2,h,m,y)}this.boxEndIndex=r.length}}class SC{constructor(r=[],a=(h,m)=>h<m?-1:h>m?1:0){if(this.data=r,this.length=this.data.length,this.compare=a,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(0===this.length)return;const r=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:a,compare:h}=this,m=a[r];for(;r>0;){const y=r-1>>1,b=a[y];if(h(m,b)>=0)break;a[r]=b,r=y}a[r]=m}_down(r){const{data:a,compare:h}=this,m=this.length>>1,y=a[r];for(;r<m;){let b=1+(r<<1);const D=b+1;if(D<this.length&&h(a[D],a[b])<0&&(b=D),h(a[b],y)>=0)break;a[r]=a[b],r=b}a[r]=y}}function IC(l,r=1,a=!1){const h=Bh.fromPoints(l[0]),m=Math.min(h.width(),h.height());let y=m/2;const b=new SC([],PC),{minX:D,minY:S,maxX:k,maxY:F}=h;if(0===m)return new Z(D,S);for(let W=D;W<k;W+=m)for(let X=S;X<F;X+=m)b.push(new Ld(W+y,X+y,y,l));let $=function(W){let X=0,Q=0,re=0;const ye=W[0];for(let Ae=0,Ce=ye.length,Me=Ce-1;Ae<Ce;Me=Ae++){const Ge=ye[Ae],Xe=ye[Me],mt=Ge.x*Xe.y-Xe.x*Ge.y;Q+=(Ge.x+Xe.x)*mt,re+=(Ge.y+Xe.y)*mt,X+=3*mt}return new Ld(Q/X,re/X,0,W)}(l),G=b.length;for(;b.length;){const W=b.pop();(W.d>$.d||!$.d)&&($=W,a&&console.log("found best %d after %d probes",Math.round(1e4*W.d)/1e4,G)),W.max-$.d<=r||(y=W.h/2,b.push(new Ld(W.p.x-y,W.p.y-y,y,l)),b.push(new Ld(W.p.x+y,W.p.y-y,y,l)),b.push(new Ld(W.p.x-y,W.p.y+y,y,l)),b.push(new Ld(W.p.x+y,W.p.y+y,y,l)),G+=4)}return a&&(console.log(`num probes: ${G}`),console.log(`best distance: ${$.d}`)),$.p}function PC(l,r){return r.max-l.max}function Ld(l,r,a,h){this.p=new Z(l,r),this.h=a,this.d=function(m,y){let b=!1,D=1/0;for(let S=0;S<y.length;S++){const k=y[S];for(let F=0,$=k.length,G=$-1;F<$;G=F++){const W=k[F],X=k[G];W.y>m.y!=X.y>m.y&&m.x<(X.x-W.x)*(m.y-W.y)/(X.y-W.y)+W.x&&(b=!b),D=Math.min(D,fg(m,W,X))}}return(b?1:-1)*Math.sqrt(D)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}var Ls;I.aO=void 0,(Ls=I.aO||(I.aO={}))[Ls.center=1]="center",Ls[Ls.left=2]="left",Ls[Ls.right=3]="right",Ls[Ls.top=4]="top",Ls[Ls.bottom=5]="bottom",Ls[Ls["top-left"]=6]="top-left",Ls[Ls["top-right"]=7]="top-right",Ls[Ls["bottom-left"]=8]="bottom-left",Ls[Ls["bottom-right"]=9]="bottom-right";const tv=Number.POSITIVE_INFINITY;function sx(l,r){return r[1]!==tv?function(a,h,m){let y=0,b=0;switch(h=Math.abs(h),m=Math.abs(m),a){case"top-right":case"top-left":case"top":b=m-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-m}switch(a){case"top-right":case"bottom-right":case"right":y=-h;break;case"top-left":case"bottom-left":case"left":y=h}return[y,b]}(l,r[0],r[1]):function(a,h){let m=0,y=0;h<0&&(h=0);const b=h/Math.SQRT2;switch(a){case"top-right":case"top-left":y=b-7;break;case"bottom-right":case"bottom-left":y=7-b;break;case"bottom":y=7-h;break;case"top":y=h-7}switch(a){case"top-right":case"bottom-right":m=-b;break;case"top-left":case"bottom-left":m=b;break;case"left":m=h;break;case"right":m=-h}return[m,y]}(l,r[0])}function ax(l,r,a){var h;const m=l.layout,y=null===(h=m.get("text-variable-anchor-offset"))||void 0===h?void 0:h.evaluate(r,{},a);if(y){const D=y.values,S=[];for(let k=0;k<D.length;k+=2){const F=S[k]=D[k],$=D[k+1].map(G=>24*G);F.startsWith("top")?$[1]-=7:F.startsWith("bottom")&&($[1]+=7),S[k+1]=$}return new as(S)}const b=m.get("text-variable-anchor");if(b){let D;D=void 0!==l._unevaluatedLayout.getValue("text-radial-offset")?[24*m.get("text-radial-offset").evaluate(r,{},a),tv]:m.get("text-offset").evaluate(r,{},a).map(k=>24*k);const S=[];for(const k of b)S.push(k,sx(k,D));return new as(S)}return null}function nv(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function iv(l,r,a,h,m,y,b,D,S,k,F,$){let G=y.textMaxSize.evaluate(r,{});void 0===G&&(G=b);const W=l.layers[0].layout,X=W.get("icon-offset").evaluate(r,{},F),Q=cx(a.horizontal),re=b/24,ye=l.tilePixelRatio*re,Ae=l.tilePixelRatio*G/24,Ce=l.tilePixelRatio*D,Me=l.tilePixelRatio*W.get("symbol-spacing"),Ge=W.get("text-padding")*l.tilePixelRatio,Xe=function(jn,qn,Dn,Ii=1){const jr=jn.get("icon-padding").evaluate(qn,{},Dn),Fo=jr&&jr.values;return[Fo[0]*Ii,Fo[1]*Ii,Fo[2]*Ii,Fo[3]*Ii]}(W,r,F,l.tilePixelRatio),mt=W.get("text-max-angle")/180*Math.PI,Lt="viewport"!==W.get("text-rotation-alignment")&&"point"!==W.get("symbol-placement"),Pt="map"===W.get("icon-rotation-alignment")&&"point"!==W.get("symbol-placement"),Vt=W.get("symbol-placement"),dn=Me/2,Jt=W.get("icon-text-fit");let Kt;h&&"none"!==Jt&&(l.allowVerticalPlacement&&a.vertical&&(Kt=eu(h,a.vertical,Jt,W.get("icon-text-fit-padding"),X,re)),Q&&(h=eu(h,Q,Jt,W.get("icon-text-fit-padding"),X,re)));const It=F?$.line.getGranularityForZoomLevel(F.z):1,Vn=(jn,qn)=>{qn.x<0||qn.x>=pt||qn.y<0||qn.y>=pt||function(Dn,Ii,jr,Fo,Os,gl,oa,bs,Fs,uo,No,Ns,xs,Pa,Rr,zs,Yl,zo,Ur,Bo,ho,Jo,Hu,Xl,Jg){const Fd=Dn.addToLineVertexArray(Ii,jr);let Sc,qf,Wf,Yf,av=0,hx=0,dx=0,fx=0,lv=-1,cv=-1;const Zu={};let e_=Ul("");if(Dn.allowVerticalPlacement&&Fo.vertical){const Bs=bs.layout.get("text-rotate").evaluate(ho,{},Xl)+90;Wf=new Wg(Fs,Ii,uo,No,Ns,Fo.vertical,xs,Pa,Rr,Bs),oa&&(Yf=new Wg(Fs,Ii,uo,No,Ns,oa,Yl,zo,Rr,Bs))}if(Os){const Bs=bs.layout.get("icon-rotate").evaluate(ho,{}),Za="none"!==bs.layout.get("icon-text-fit"),Kl=Jy(Os,Bs,Hu,Za),es=oa?Jy(oa,Bs,Hu,Za):void 0;qf=new Wg(Fs,Ii,uo,No,Ns,Os,Yl,zo,!1,Bs),av=4*Kl.length;const jh=Dn.iconSizeData;let qu=null;"source"===jh.kind?(qu=[Vu*bs.layout.get("icon-size").evaluate(ho,{})],qu[0]>tu&&ne(`${Dn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===jh.kind&&(qu=[Vu*Jo.compositeIconSizes[0].evaluate(ho,{},Xl),Vu*Jo.compositeIconSizes[1].evaluate(ho,{},Xl)],(qu[0]>tu||qu[1]>tu)&&ne(`${Dn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Dn.addSymbols(Dn.icon,Kl,qu,Bo,Ur,ho,I.ay.none,Ii,Fd.lineStartIndex,Fd.lineLength,-1,Xl),lv=Dn.icon.placedSymbolArray.length-1,es&&(hx=4*es.length,Dn.addSymbols(Dn.icon,es,qu,Bo,Ur,ho,I.ay.vertical,Ii,Fd.lineStartIndex,Fd.lineLength,-1,Xl),cv=Dn.icon.placedSymbolArray.length-1)}const AC=Object.keys(Fo.horizontal);for(const Bs of AC){const Za=Fo.horizontal[Bs];if(!Sc){e_=Ul(Za.text);const es=bs.layout.get("text-rotate").evaluate(ho,{},Xl);Sc=new Wg(Fs,Ii,uo,No,Ns,Za,xs,Pa,Rr,es)}const Kl=1===Za.positionedLines.length;if(dx+=lx(Dn,Ii,Za,gl,bs,Rr,ho,zs,Fd,Fo.vertical?I.ay.horizontal:I.ay.horizontalOnly,Kl?AC:[Bs],Zu,lv,Jo,Xl),Kl)break}Fo.vertical&&(fx+=lx(Dn,Ii,Fo.vertical,gl,bs,Rr,ho,zs,Fd,I.ay.vertical,["vertical"],Zu,cv,Jo,Xl));const g2=Sc?Sc.boxStartIndex:Dn.collisionBoxArray.length,uv=Sc?Sc.boxEndIndex:Dn.collisionBoxArray.length,_2=Wf?Wf.boxStartIndex:Dn.collisionBoxArray.length,y2=Wf?Wf.boxEndIndex:Dn.collisionBoxArray.length,v2=qf?qf.boxStartIndex:Dn.collisionBoxArray.length,b2=qf?qf.boxEndIndex:Dn.collisionBoxArray.length,x2=Yf?Yf.boxStartIndex:Dn.collisionBoxArray.length,kC=Yf?Yf.boxEndIndex:Dn.collisionBoxArray.length;let Ha=-1;const Nd=(Bs,Za)=>Bs&&Bs.circleDiameter?Math.max(Bs.circleDiameter,Za):Za;Ha=Nd(Sc,Ha),Ha=Nd(Wf,Ha),Ha=Nd(qf,Ha),Ha=Nd(Yf,Ha);const hv=Ha>-1?1:0;hv&&(Ha*=Jg/24),Dn.glyphOffsetArray.length>=Zl.MAX_GLYPHS&&ne("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==ho.sortKey&&Dn.addToSortKeyRanges(Dn.symbolInstances.length,ho.sortKey);const px=ax(bs,ho,Xl),[mx,RC]=function(Bs,Za){const Kl=Bs.length,es=Za?.values;if(es?.length>0)for(let jh=0;jh<es.length;jh+=2){const qu=es[jh+1];Bs.emplaceBack(I.aO[es[jh]],qu[0],qu[1])}return[Kl,Bs.length]}(Dn.textAnchorOffsets,px);Dn.symbolInstances.emplaceBack(Ii.x,Ii.y,Zu.right>=0?Zu.right:-1,Zu.center>=0?Zu.center:-1,Zu.left>=0?Zu.left:-1,Zu.vertical||-1,lv,cv,e_,g2,uv,_2,y2,v2,b2,x2,kC,uo,dx,fx,av,hx,hv,0,xs,Ha,mx,RC)}(l,qn,jn,a,h,m,Kt,l.layers[0],l.collisionBoxArray,r.index,r.sourceLayerIndex,l.index,ye,[Ge,Ge,Ge,Ge],Lt,S,Ce,Xe,Pt,X,r,y,k,F,b)};if("line"===Vt)for(const jn of Zg(r.geometry,0,0,pt,pt)){const qn=Ih(jn,It),Dn=rx(qn,Me,mt,a.vertical||Q,h,24,Ae,l.overscaling,pt);for(const Ii of Dn)Q&&rv(l,Q.text,dn,Ii)||Vn(qn,Ii)}else if("line-center"===Vt){for(const jn of r.geometry)if(jn.length>1){const qn=Ih(jn,It),Dn=m2(qn,mt,a.vertical||Q,h,24,Ae);Dn&&Vn(qn,Dn)}}else if("Polygon"===r.type)for(const jn of Na(r.geometry,0)){const qn=IC(jn,16);Vn(Ih(jn[0],It,!0),new Vh(qn.x,qn.y,0))}else if("LineString"===r.type)for(const jn of r.geometry){const qn=Ih(jn,It);Vn(qn,new Vh(qn[0].x,qn[0].y,0))}else if("Point"===r.type)for(const jn of r.geometry)for(const qn of jn)Vn([qn],new Vh(qn.x,qn.y,0))}function lx(l,r,a,h,m,y,b,D,S,k,F,$,G,W,X){const Q=function(Ae,Ce,Me,Ge,Xe,mt,Lt,Pt){const Vt=Ge.layout.get("text-rotate").evaluate(mt,{})*Math.PI/180,dn=[];for(const Jt of Ce.positionedLines)for(const Kt of Jt.positionedGlyphs){if(!Kt.rect)continue;const It=Kt.rect||{};let Vn=4,jn=!0,qn=1,Dn=0;const Ii=(Xe||Pt)&&Kt.vertical,jr=Kt.metrics.advance*Kt.scale/2;if(Pt&&Ce.verticalizable&&(Dn=Jt.lineOffset/2-(Kt.imageName?-(24-Kt.metrics.width*Kt.scale)/2:24*(Kt.scale-1))),Kt.imageName){const zo=Lt[Kt.imageName];jn=zo.sdf,qn=zo.pixelRatio,Vn=1/qn}const Fo=Xe?[Kt.x+jr,Kt.y]:[0,0];let Os=Xe?[0,0]:[Kt.x+jr+Me[0],Kt.y+Me[1]-Dn],gl=[0,0];Ii&&(gl=Os,Os=[0,0]);const oa=Kt.metrics.isDoubleResolution?2:1,bs=(Kt.metrics.left-Vn)*Kt.scale-jr+Os[0],Fs=(-Kt.metrics.top-Vn)*Kt.scale+Os[1],uo=bs+It.w/oa*Kt.scale/qn,No=Fs+It.h/oa*Kt.scale/qn,Ns=new Z(bs,Fs),xs=new Z(uo,Fs),Pa=new Z(bs,No),Rr=new Z(uo,No);if(Ii){const zo=new Z(-jr,jr- -17),Ur=-Math.PI/2,Bo=12-jr,ho=new Z(22-Bo,-(Kt.imageName?Bo:0)),Jo=new Z(...gl);Ns._rotateAround(Ur,zo)._add(ho)._add(Jo),xs._rotateAround(Ur,zo)._add(ho)._add(Jo),Pa._rotateAround(Ur,zo)._add(ho)._add(Jo),Rr._rotateAround(Ur,zo)._add(ho)._add(Jo)}if(Vt){const zo=Math.sin(Vt),Ur=Math.cos(Vt),Bo=[Ur,-zo,zo,Ur];Ns._matMult(Bo),xs._matMult(Bo),Pa._matMult(Bo),Rr._matMult(Bo)}const zs=new Z(0,0),Yl=new Z(0,0);dn.push({tl:Ns,tr:xs,bl:Pa,br:Rr,tex:It,writingMode:Ce.writingMode,glyphOffset:Fo,sectionIndex:Kt.sectionIndex,isSDF:jn,pixelOffsetTL:zs,pixelOffsetBR:Yl,minFontScaleX:0,minFontScaleY:0})}return dn}(0,a,D,m,y,b,h,l.allowVerticalPlacement),re=l.textSizeData;let ye=null;"source"===re.kind?(ye=[Vu*m.layout.get("text-size").evaluate(b,{})],ye[0]>tu&&ne(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===re.kind&&(ye=[Vu*W.compositeTextSizes[0].evaluate(b,{},X),Vu*W.compositeTextSizes[1].evaluate(b,{},X)],(ye[0]>tu||ye[1]>tu)&&ne(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),l.addSymbols(l.text,Q,ye,D,y,b,k,r,S.lineStartIndex,S.lineLength,G,X);for(const Ae of F)$[Ae]=l.text.placedSymbolArray.length-1;return 4*Q.length}function cx(l){for(const r in l)return l[r];return null}function rv(l,r,a,h){const m=l.compareText;if(r in m){const y=m[r];for(let b=y.length-1;b>=0;b--)if(h.dist(y[b])<a)return!0}else m[r]=[];return m[r].push(h),!1}const ov=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class sv{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,h]=new Uint8Array(r,0,2);if(219!==a)throw new Error("Data does not appear to be in a KDBush format.");const m=h>>4;if(1!==m)throw new Error(`Got v${m} data when expected v1.`);const y=ov[15&h];if(!y)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(r,2,1),[D]=new Uint32Array(r,4,1);return new sv(D,b,y,r)}constructor(r,a=64,h=Float64Array,m){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=h,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const y=ov.indexOf(this.ArrayType),b=2*r*this.ArrayType.BYTES_PER_ELEMENT,D=r*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-D%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${h}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+D+S,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+b+D+S),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+D+S,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=r)}add(r,a){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=r,this.coords[this._pos++]=a,h}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return Yg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,a,h,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:b,nodeSize:D}=this,S=[0,y.length-1,0],k=[];for(;S.length;){const F=S.pop()||0,$=S.pop()||0,G=S.pop()||0;if($-G<=D){for(let re=G;re<=$;re++){const ye=b[2*re],Ae=b[2*re+1];ye>=r&&ye<=h&&Ae>=a&&Ae<=m&&k.push(y[re])}continue}const W=G+$>>1,X=b[2*W],Q=b[2*W+1];X>=r&&X<=h&&Q>=a&&Q<=m&&k.push(y[W]),(0===F?r<=X:a<=Q)&&(S.push(G),S.push(W-1),S.push(1-F)),(0===F?h>=X:m>=Q)&&(S.push(W+1),S.push($),S.push(1-F))}return k}within(r,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:y,nodeSize:b}=this,D=[0,m.length-1,0],S=[],k=h*h;for(;D.length;){const F=D.pop()||0,$=D.pop()||0,G=D.pop()||0;if($-G<=b){for(let re=G;re<=$;re++)pm(y[2*re],y[2*re+1],r,a)<=k&&S.push(m[re]);continue}const W=G+$>>1,X=y[2*W],Q=y[2*W+1];pm(X,Q,r,a)<=k&&S.push(m[W]),(0===F?r-h<=X:a-h<=Q)&&(D.push(G),D.push(W-1),D.push(1-F)),(0===F?r+h>=X:a+h>=Q)&&(D.push(W+1),D.push($),D.push(1-F))}return S}}function Yg(l,r,a,h,m,y){if(m-h<=a)return;const b=h+m>>1;Xg(l,r,b,h,m,y),Yg(l,r,a,h,b-1,1-y),Yg(l,r,a,b+1,m,1-y)}function Xg(l,r,a,h,m,y){for(;m>h;){if(m-h>600){const k=m-h+1,F=a-h+1,$=Math.log(k),G=.5*Math.exp(2*$/3),W=.5*Math.sqrt($*G*(k-G)/k)*(F-k/2<0?-1:1);Xg(l,r,a,Math.max(h,Math.floor(a-F*G/k+W)),Math.min(m,Math.floor(a+(k-F)*G/k+W)),y)}const b=r[2*a+y];let D=h,S=m;for(Od(l,r,h,a),r[2*m+y]>b&&Od(l,r,h,m);D<S;){for(Od(l,r,D,S),D++,S--;r[2*D+y]<b;)D++;for(;r[2*S+y]>b;)S--}r[2*h+y]===b?Od(l,r,h,S):(S++,Od(l,r,S,m)),S<=a&&(h=S+1),a<=S&&(m=S-1)}}function Od(l,r,a,h){Ga(l,a,h),Ga(r,2*a,2*h),Ga(r,2*a+1,2*h+1)}function Ga(l,r,a){const h=l[r];l[r]=l[a],l[a]=h}function pm(l,r,a,h){const m=l-a,y=r-h;return m*m+y*y}var Kg;I.cG=void 0,(Kg=I.cG||(I.cG={})).create="create",Kg.load="load",Kg.fullLoad="fullLoad";let Gu=null,mm=[];const Zf=1e3/60,gm="loadTime",Qg="fullLoadTime",ux={mark(l){performance.mark(l)},frame(l){const r=l;null!=Gu&&mm.push(r-Gu),Gu=r},clearMetrics(){Gu=null,mm=[],performance.clearMeasures(gm),performance.clearMeasures(Qg);for(const l in I.cG)performance.clearMarks(I.cG[l])},getPerformanceMetrics(){performance.measure(gm,I.cG.create,I.cG.load),performance.measure(Qg,I.cG.create,I.cG.fullLoad);const l=performance.getEntriesByName(gm)[0].duration,r=performance.getEntriesByName(Qg)[0].duration,a=mm.length,h=1/(mm.reduce((y,b)=>y+b,0)/a/1e3),m=mm.filter(y=>y>Zf).reduce((y,b)=>y+(b-Zf)/Zf,0);return{loadTime:l,fullLoadTime:r,fps:h,percentDroppedFrames:m/(a+m)*100,totalFrames:a}}};I.$=Ee,I.A=Ue,I.B=_a,I.C=za,I.D=In,I.E=rt,I.F=function([l,r,a]){return r+=90,r*=Math.PI/180,a*=Math.PI/180,{x:l*Math.cos(r)*Math.sin(a),y:l*Math.sin(r)*Math.sin(a),z:l*Math.cos(a)}},I.G=_o,I.H=Dr,I.I=ky,I.J=vo,I.K=function(l){if(null==Oe){const r=l.navigator?l.navigator.userAgent:null;Oe=!!l.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Oe},I.L=class{constructor(l,r){this.target=l,this.mapId=r,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Lh(()=>this.process()),this.subscription=tn(this.target,"message",a=>this.receive(a),!1),this.globalScope=Ct(self)?l:window}registerMessageHandler(l,r){this.messageHandlers[l]=r}unregisterMessageHandler(l){delete this.messageHandlers[l]}sendAsync(l,r){return new Promise((a,h)=>{const m=Math.round(1e18*Math.random()).toString(36).substring(0,10),y=r?tn(r.signal,"abort",()=>{y?.unsubscribe(),delete this.resolveRejects[m];const S={id:m,type:"<cancel>",origin:location.origin,targetMapId:l.targetMapId,sourceMapId:this.mapId};this.target.postMessage(S)},zy):null;this.resolveRejects[m]={resolve:S=>{y?.unsubscribe(),a(S)},reject:S=>{y?.unsubscribe(),h(S)}};const b=[],D=Object.assign(Object.assign({},l),{id:m,sourceMapId:this.mapId,origin:location.origin,data:_h(l.data,b)});this.target.postMessage(D,{transfer:b})})}receive(l){const r=l.data,a=r.id;if(!("file://"!==r.origin&&"file://"!==location.origin&&"resource://android"!==r.origin&&"resource://android"!==location.origin&&r.origin!==location.origin||r.targetMapId&&this.mapId!==r.targetMapId)){if("<cancel>"===r.type){delete this.tasks[a];const h=this.abortControllers[a];return delete this.abortControllers[a],void(h&&h.abort())}if(Ct(self)||r.mustQueue)return this.tasks[a]=r,this.taskQueue.push(a),void this.invoker.trigger();this.processTask(a,r)}}process(){if(0===this.taskQueue.length)return;const l=this.taskQueue.shift(),r=this.tasks[l];delete this.tasks[l],this.taskQueue.length>0&&this.invoker.trigger(),r&&this.processTask(l,r)}processTask(l,r){return p(this,void 0,void 0,function*(){if("<response>"===r.type){const m=this.resolveRejects[l];return delete this.resolveRejects[l],m?void(r.error?m.reject(Cc(r.error)):m.resolve(Cc(r.data))):void 0}if(!this.messageHandlers[r.type])return void this.completeTask(l,new Error(`Could not find a registered handler for ${r.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const a=Cc(r.data),h=new AbortController;this.abortControllers[l]=h;try{const m=yield this.messageHandlers[r.type](r.sourceMapId,a,h);this.completeTask(l,null,m)}catch(m){this.completeTask(l,m)}})}completeTask(l,r,a){const h=[];delete this.abortControllers[l];const m={id:l,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:r?_h(r):null,data:_h(a,h)};this.target.postMessage(m,{transfer:h})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},I.M=is,I.N=function(){var l=new Ue(16);return Ue!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l},I.O=function(l,r,a){var h,m,y,b,D,S,k,F,$,G,W,X,Q=a[0],re=a[1],ye=a[2];return r===l?(l[12]=r[0]*Q+r[4]*re+r[8]*ye+r[12],l[13]=r[1]*Q+r[5]*re+r[9]*ye+r[13],l[14]=r[2]*Q+r[6]*re+r[10]*ye+r[14],l[15]=r[3]*Q+r[7]*re+r[11]*ye+r[15]):(m=r[1],y=r[2],b=r[3],D=r[4],S=r[5],k=r[6],F=r[7],$=r[8],G=r[9],W=r[10],X=r[11],l[0]=h=r[0],l[1]=m,l[2]=y,l[3]=b,l[4]=D,l[5]=S,l[6]=k,l[7]=F,l[8]=$,l[9]=G,l[10]=W,l[11]=X,l[12]=h*Q+D*re+$*ye+r[12],l[13]=m*Q+S*re+G*ye+r[13],l[14]=y*Q+k*re+W*ye+r[14],l[15]=b*Q+F*re+X*ye+r[15]),l},I.P=Z,I.Q=function(l,r,a){var h=a[0],m=a[1],y=a[2];return l[0]=r[0]*h,l[1]=r[1]*h,l[2]=r[2]*h,l[3]=r[3]*h,l[4]=r[4]*m,l[5]=r[5]*m,l[6]=r[6]*m,l[7]=r[7]*m,l[8]=r[8]*y,l[9]=r[9]*y,l[10]=r[10]*y,l[11]=r[11]*y,l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15],l},I.R=_s,I.S=function(l,r,a){var h=r[0],m=r[1],y=r[2],b=r[3],D=r[4],S=r[5],k=r[6],F=r[7],$=r[8],G=r[9],W=r[10],X=r[11],Q=r[12],re=r[13],ye=r[14],Ae=r[15],Ce=a[0],Me=a[1],Ge=a[2],Xe=a[3];return l[0]=Ce*h+Me*D+Ge*$+Xe*Q,l[1]=Ce*m+Me*S+Ge*G+Xe*re,l[2]=Ce*y+Me*k+Ge*W+Xe*ye,l[3]=Ce*b+Me*F+Ge*X+Xe*Ae,l[4]=(Ce=a[4])*h+(Me=a[5])*D+(Ge=a[6])*$+(Xe=a[7])*Q,l[5]=Ce*m+Me*S+Ge*G+Xe*re,l[6]=Ce*y+Me*k+Ge*W+Xe*ye,l[7]=Ce*b+Me*F+Ge*X+Xe*Ae,l[8]=(Ce=a[8])*h+(Me=a[9])*D+(Ge=a[10])*$+(Xe=a[11])*Q,l[9]=Ce*m+Me*S+Ge*G+Xe*re,l[10]=Ce*y+Me*k+Ge*W+Xe*ye,l[11]=Ce*b+Me*F+Ge*X+Xe*Ae,l[12]=(Ce=a[12])*h+(Me=a[13])*D+(Ge=a[14])*$+(Xe=a[15])*Q,l[13]=Ce*m+Me*S+Ge*G+Xe*re,l[14]=Ce*y+Me*k+Ge*W+Xe*ye,l[15]=Ce*b+Me*F+Ge*X+Xe*Ae,l},I.T=Bp,I.U=function(l,r){const a={};for(let h=0;h<r.length;h++){const m=r[h];m in l&&(a[m]=l[m])}return a},I.V=ql,I.W=zn,I.X=By,I.Y=Jp,I.Z=K,I._=p,I.a=ur,I.a$=Mt,I.a0=jt,I.a1=Ia,I.a2=Pd,I.a3=em,I.a4=pt,I.a5=function(l,r,a){if(!l)return r||{};if(!r)return l||{};const h=Ua(l),m=Ua(r);!function(b,D){D.removeAll&&(b.add.clear(),b.update.clear(),b.remove.clear(),D.remove.clear());for(const S of D.remove)b.add.delete(S),b.update.delete(S);for(const[S,k]of D.update){const F=b.update.get(S);F&&(D.update.set(S,$b(F,k)),b.update.delete(S))}}(h,m);const y={};if((h.removeAll||m.removeAll)&&(y.removeAll=!0),y.remove=new Set([...h.remove,...m.remove]),y.add=new Map([...h.add,...m.add]),y.update=new Map([...h.update,...m.update]),y.remove.size&&y.add.size)for(const b of y.add.keys())y.remove.delete(b);return function(b){const D={};return b.removeAll&&(D.removeAll=b.removeAll),b.remove&&(D.remove=Array.from(b.remove)),b.add&&(D.add=Array.from(b.add.values())),b.update&&(D.update=Array.from(b.update.values())),D}(y)},I.a6=function(l,r){if(null==l)return!0;if("Feature"===l.type)return null!=nu(l,r);if("FeatureCollection"===l.type){const a=new Set;for(const h of l.features){const m=nu(h,r);if(null==m||a.has(m))return!1;a.add(m)}return!0}return!1},I.a7=function(l,r){const a=new Map;if(null!=l)if("Feature"===l.type)a.set(nu(l,r),l);else for(const h of l.features)a.set(nu(h,r),h);return a},I.a8=function(l,r,a){var h,m;if(r.removeAll)l.clear();else if(r.remove)for(const y of r.remove)l.delete(y);if(r.add)for(const y of r.add){const b=nu(y,a);null!=b&&l.set(b,y)}if(r.update)for(const y of r.update){let b=l.get(y.id);if(!b)continue;const D=!!y.newGeometry,S=y.removeAllProperties||(null===(h=y.removeProperties)||void 0===h?void 0:h.length)>0||(null===(m=y.addOrUpdateProperties)||void 0===m?void 0:m.length)>0;if((D||S)&&(b=Object.assign({},b),l.set(y.id,b),D&&(b.geometry=y.newGeometry),S)){if(b.properties=y.removeAllProperties?{}:Object.assign({},b.properties||{}),y.removeProperties)for(const k of y.removeProperties)delete b.properties[k];if(y.addOrUpdateProperties)for(const{key:k,value:F}of y.addOrUpdateProperties)b.properties[k]=F}}},I.a9=Qy,I.aA=function(l,r){var a=r[0],h=r[1],m=r[2],y=r[3],b=r[4],D=r[5],S=r[6],k=r[7],F=r[8],$=r[9],G=r[10],W=r[11],X=r[12],Q=r[13],re=r[14],ye=r[15],Ae=a*D-h*b,Ce=a*S-m*b,Me=a*k-y*b,Ge=h*S-m*D,Xe=h*k-y*D,mt=m*k-y*S,Lt=F*Q-$*X,Pt=F*re-G*X,Vt=F*ye-W*X,dn=$*re-G*Q,Jt=$*ye-W*Q,Kt=G*ye-W*re,It=Ae*Kt-Ce*Jt+Me*dn+Ge*Vt-Xe*Pt+mt*Lt;return It?(l[0]=(D*Kt-S*Jt+k*dn)*(It=1/It),l[1]=(m*Jt-h*Kt-y*dn)*It,l[2]=(Q*mt-re*Xe+ye*Ge)*It,l[3]=(G*Xe-$*mt-W*Ge)*It,l[4]=(S*Vt-b*Kt-k*Pt)*It,l[5]=(a*Kt-m*Vt+y*Pt)*It,l[6]=(re*Me-X*mt-ye*Ce)*It,l[7]=(F*mt-G*Me+W*Ce)*It,l[8]=(b*Jt-D*Vt+k*Lt)*It,l[9]=(h*Vt-a*Jt-y*Lt)*It,l[10]=(X*Xe-Q*Me+ye*Ae)*It,l[11]=($*Me-F*Xe-W*Ae)*It,l[12]=(D*Pt-b*dn-S*Lt)*It,l[13]=(a*dn-h*Pt+m*Lt)*It,l[14]=(Q*Ce-X*Ge-re*Ae)*It,l[15]=(F*Ge-$*Ce+G*Ae)*It,l):null},I.aB=Bt,I.aC=function(l){var r=l[0],a=l[1];return Math.sqrt(r*r+a*a)},I.aD=function(l){return l[0]=0,l[1]=0,l},I.aE=function(l,r,a){return l[0]=r[0]*a,l[1]=r[1]*a,l},I.aF=Oy,I.aG=pe,I.aH=function(l,r,a,h){const m=r.y-l.y,y=r.x-l.x,b=h.y-a.y,D=h.x-a.x,S=b*y-D*m;if(0===S)return null;const k=(D*(l.y-a.y)-b*(l.x-a.x))/S;return new Z(l.x+k*y,l.y+k*m)},I.aI=Zg,I.aJ=Ww,I.aK=function(l){let r=1/0,a=1/0,h=-1/0,m=-1/0;for(const y of l)r=Math.min(r,y.x),a=Math.min(a,y.y),h=Math.max(h,y.x),m=Math.max(m,y.y);return[r,a,h,m]},I.aL=24,I.aM=Nn,I.aN=function(l,r,a,h,m=!1){if(!a[0]&&!a[1])return[0,0];const y=m?"map"===h?-l.bearingInRadians:0:"viewport"===h?l.bearingInRadians:0;if(y){const b=Math.sin(y),D=Math.cos(y);a=[a[0]*D-a[1]*b,a[0]*b+a[1]*D]}return[m?a[0]:Nn(r,a[0],l.zoom),m?a[1]:Nn(r,a[1],l.zoom)]},I.aP=Vb,I.aQ=nv,I.aR=Ry,I.aS=sv,I.aT=Ki,I.aU=Gp,I.aV=we,I.aW=pi,I.aX=$t,I.aY=nn,I.aZ=Vy,I.a_=on,I.aa=Ef,I.ab=Bh,I.ac=25,I.ad=zg,I.ae=l=>{const r=window.document.createElement("video");return r.muted=!0,new Promise(a=>{r.onloadstart=()=>{a(r)};for(const h of l){const m=window.document.createElement("source");ie(h)||(r.crossOrigin="Anonymous"),m.src=h,r.appendChild(m)}})},I.af=Gt,I.ag=function(){return mi++},I.ah=M,I.ai=Zl,I.aj=wt,I.ak=hl,I.al=tm,I.am=function(l){const r={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,h,m,y)=>{const b=m||y;return r[h]=!b||b.toLowerCase(),""}),r["max-age"]){const a=parseInt(r["max-age"],10);isNaN(a)?delete r["max-age"]:r["max-age"]=a}return r},I.an=Pn,I.ao=85.051129,I.ap=Cn,I.aq=function(l){return Math.pow(2,l)},I.ar=ct,I.as=Fg,I.at=function(l){return Math.log(l)/Math.LN2},I.au=function(l){var r=l[0],a=l[1];return r*r+a*a},I.av=class{constructor(l,r){this.max=l,this.onRemove=r,this.reset()}reset(){for(const l in this.data)for(const r of this.data[l])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(l,r,a){const h=l.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const m={value:r,timeout:void 0};if(void 0!==a&&(m.timeout=setTimeout(()=>{this.remove(l,m)},a)),this.data[h].push(m),this.order.push(h),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const r=this.data[l].shift();return r.timeout&&clearTimeout(r.timeout),0===this.data[l].length&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),r.value}getByKey(l){const r=this.data[l];return r?r[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,r){if(!this.has(l))return this;const a=l.wrapped().key,h=void 0===r?0:this.data[a].indexOf(r),m=this.data[a][h];return this.data[a].splice(h,1),m.timeout&&clearTimeout(m.timeout),0===this.data[a].length&&delete this.data[a],this.onRemove(m.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(l){const r=[];for(const a in this.data)for(const h of this.data[a])l(h.value)||r.push(h);for(const a of r)this.remove(a.value.tileID,a)}},I.aw=function(l){if(!l.length)return new Set;const r=Math.max(...l.map(S=>S.canonical.z));let a=1/0,h=-1/0,m=1/0,y=-1/0;const b=[];for(const S of l){const{x:k,y:F,z:$}=S.canonical,G=Math.pow(2,r-$),W=k*G,X=F*G;b.push({id:S,x:W,y:X}),W<a&&(a=W),W>h&&(h=W),X<m&&(m=X),X>y&&(y=X)}const D=new Set;for(const S of b)S.x!==a&&S.x!==h&&S.y!==m&&S.y!==y||D.add(S.id);return D},I.ax=function(l,r){let a=0,h=0;if("constant"===l.kind)h=l.layoutSize;else if("source"!==l.kind){const{interpolationType:m,minZoom:y,maxZoom:b}=l,D=m?Pn(Wr.interpolationFactor(m,r,y,b),0,1):0;"camera"===l.kind?h=_o.number(l.minSize,l.maxSize,D):a=D}return{uSizeT:a,uSize:h}},I.az=function(l,{uSize:r,uSizeT:a},{lowerSize:h,upperSize:m}){return"source"===l.kind?h/Vu:"composite"===l.kind?_o.number(h/Vu,m/Vu,a):r},I.b=ke,I.b$=class extends zi{constructor(l,r){super(l,r),this.current=Nu}set(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let r=1;r<16;r++)if(l[r]!==this.current[r]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}},I.b0=function(l){var r=new Ue(3);return r[0]=l[0],r[1]=l[1],r[2]=l[2],r},I.b1=function(l,r,a){return l[0]=r[0]-a[0],l[1]=r[1]-a[1],l[2]=r[2]-a[2],l},I.b2=function(l,r){var a=r[0],h=r[1],m=r[2],y=a*a+h*h+m*m;return y>0&&(y=1/Math.sqrt(y)),l[0]=r[0]*y,l[1]=r[1]*y,l[2]=r[2]*y,l},I.b3=Hn,I.b4=function(l,r){return l[0]*r[0]+l[1]*r[1]+l[2]*r[2]},I.b5=function(l,r,a){return l[0]=r[0]*a[0],l[1]=r[1]*a[1],l[2]=r[2]*a[2],l[3]=r[3]*a[3],l},I.b6=xt,I.b7=function(l,r,a){const h=r[0]*a[0]+r[1]*a[1]+r[2]*a[2];return 0===h?null:(-(l[0]*a[0]+l[1]*a[1]+l[2]*a[2])-a[3])/h},I.b8=Dt,I.b9=function(l,r,a){return l[0]=r[0]*a,l[1]=r[1]*a,l[2]=r[2]*a,l[3]=r[3]*a,l},I.bA=ii,I.bB=function(l,r,a){var h=a[0],m=a[1],y=a[2],b=a[3],D=r[0],S=r[1],k=r[2],F=m*k-y*S,$=y*D-h*k,G=h*S-m*D;return l[0]=D+b*(F+=F)+m*(G+=G)-y*($+=$),l[1]=S+b*$+y*F-h*G,l[2]=k+b*G+h*$-m*F,l},I.bC=function(l,r,a){const h=(m=[l[0],l[1],l[2],r[0],r[1],r[2],a[0],a[1],a[2]])[0]*((F=m[8])*(b=m[4])-(D=m[5])*(k=m[7]))+m[1]*(-F*(y=m[3])+D*(S=m[6]))+m[2]*(k*y-b*S);var m,y,b,D,S,k,F;if(0===h)return null;const $=Hn([],[r[0],r[1],r[2]],[a[0],a[1],a[2]]),G=Hn([],[a[0],a[1],a[2]],[l[0],l[1],l[2]]),W=Hn([],[l[0],l[1],l[2]],[r[0],r[1],r[2]]),X=on([],$,-l[3]);return Mt(X,X,on([],G,-r[3])),Mt(X,X,on([],W,-a[3])),on(X,X,1/h),X},I.bD=Mf,I.bE=function(){return new Float64Array(4)},I.bF=function(l,r,a,h){var m=[],y=[];return m[0]=r[0]-a[0],m[1]=r[1]-a[1],m[2]=r[2]-a[2],y[0]=m[0]*Math.cos(h)-m[1]*Math.sin(h),y[1]=m[0]*Math.sin(h)+m[1]*Math.cos(h),y[2]=m[2],l[0]=y[0]+a[0],l[1]=y[1]+a[1],l[2]=y[2]+a[2],l},I.bG=function(l,r,a,h){var m=[],y=[];return m[0]=r[0]-a[0],m[1]=r[1]-a[1],m[2]=r[2]-a[2],y[0]=m[0],y[1]=m[1]*Math.cos(h)-m[2]*Math.sin(h),y[2]=m[1]*Math.sin(h)+m[2]*Math.cos(h),l[0]=y[0]+a[0],l[1]=y[1]+a[1],l[2]=y[2]+a[2],l},I.bH=function(l,r,a,h){var m=[],y=[];return m[0]=r[0]-a[0],m[1]=r[1]-a[1],m[2]=r[2]-a[2],y[0]=m[2]*Math.sin(h)+m[0]*Math.cos(h),y[1]=m[1],y[2]=m[2]*Math.cos(h)-m[0]*Math.sin(h),l[0]=y[0]+a[0],l[1]=y[1]+a[1],l[2]=y[2]+a[2],l},I.bI=function(l,r,a){var h=Math.sin(a),m=Math.cos(a),y=r[0],b=r[1],D=r[2],S=r[3],k=r[8],F=r[9],$=r[10],G=r[11];return r!==l&&(l[4]=r[4],l[5]=r[5],l[6]=r[6],l[7]=r[7],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[0]=y*m-k*h,l[1]=b*m-F*h,l[2]=D*m-$*h,l[3]=S*m-G*h,l[8]=y*h+k*m,l[9]=b*h+F*m,l[10]=D*h+$*m,l[11]=S*h+G*m,l},I.bJ=function(l,r){const a=nt(l,360),h=nt(r,360),m=h-a,y=h>a?m-360:m+360;return Math.abs(m)<Math.abs(y)?m:y},I.bK=function(l){return l[0]=0,l[1]=0,l[2]=0,l},I.bL=function(l,r,a,h){const m=Math.sqrt(l*l+r*r),y=Math.sqrt(a*a+h*h);l/=m,r/=m,a/=y,h/=y;const b=Math.acos(l*a+r*h);return-r*a+l*h>0?b:-b},I.bM=function(l,r){const a=nt(l,2*Math.PI),h=nt(r,2*Math.PI);return Math.min(Math.abs(a-h),Math.abs(a-h+2*Math.PI),Math.abs(a-h-2*Math.PI))},I.bN=function(){const l={},r=xe.$version;for(const a in xe.$root){const h=xe.$root[a];if(h.required){let m=null;m="version"===a?r:"array"===h.type?[]:{},null!=m&&(l[a]=m)}}return l},I.bO=Sr,I.bP=yh,I.bQ=function l(r,a){if(Array.isArray(r)){if(!Array.isArray(a)||r.length!==a.length)return!1;for(let h=0;h<r.length;h++)if(!l(r[h],a[h]))return!1;return!0}if("object"==typeof r&&null!==r&&null!==a){if("object"!=typeof a||Object.keys(r).length!==Object.keys(a).length)return!1;for(const h in r)if(!l(r[h],a[h]))return!1;return!0}return r===a},I.bR=function(l){l=l.slice();const r=Object.create(null);for(let a=0;a<l.length;a++)r[l[a].id]=l[a];for(let a=0;a<l.length;a++)"ref"in l[a]&&(l[a]=yt(l[a],r[l[a].ref]));return l},I.bS=function(l,r){if("custom"===l.type)return new Rg(l,r);switch(l.type){case"background":return new Qp(l,r);case"circle":return new dy(l,r);case"color-relief":return new Vp(l,r);case"fill":return new iC(l,r);case"fill-extrusion":return new Cf(l,r);case"heatmap":return new rb(l,r);case"hillshade":return new ko(l,r);case"line":return new Zp(l,r);case"raster":return new ay(l,r);case"symbol":return new Xp(l,r)}},I.bT=l=>"raster"===l.type,I.bU=pr,I.bV=function(l,r){if(!l)return[{command:"setStyle",args:[r]}];let a=[];try{if(!bt(l.version,r.version))return[{command:"setStyle",args:[r]}];bt(l.center,r.center)||a.push({command:"setCenter",args:[r.center]}),bt(l.state,r.state)||a.push({command:"setGlobalState",args:[r.state]}),bt(l.centerAltitude,r.centerAltitude)||a.push({command:"setCenterAltitude",args:[r.centerAltitude]}),bt(l.zoom,r.zoom)||a.push({command:"setZoom",args:[r.zoom]}),bt(l.bearing,r.bearing)||a.push({command:"setBearing",args:[r.bearing]}),bt(l.pitch,r.pitch)||a.push({command:"setPitch",args:[r.pitch]}),bt(l.roll,r.roll)||a.push({command:"setRoll",args:[r.roll]}),bt(l.sprite,r.sprite)||a.push({command:"setSprite",args:[r.sprite]}),bt(l.glyphs,r.glyphs)||a.push({command:"setGlyphs",args:[r.glyphs]}),bt(l.transition,r.transition)||a.push({command:"setTransition",args:[r.transition]}),bt(l.light,r.light)||a.push({command:"setLight",args:[r.light]}),bt(l.terrain,r.terrain)||a.push({command:"setTerrain",args:[r.terrain]}),bt(l.sky,r.sky)||a.push({command:"setSky",args:[r.sky]}),bt(l.projection,r.projection)||a.push({command:"setProjection",args:[r.projection]});const h={},m=[];!function(b,D,S,k){let F;for(F in D=D||{},b=b||{})Object.prototype.hasOwnProperty.call(b,F)&&(Object.prototype.hasOwnProperty.call(D,F)||Bn(F,S,k));for(F in D)Object.prototype.hasOwnProperty.call(D,F)&&(Object.prototype.hasOwnProperty.call(b,F)?bt(b[F],D[F])||("geojson"===b[F].type&&"geojson"===D[F].type&&hr(b,D,F)?Tt(S,{command:"setGeoJSONSourceData",args:[F,D[F].data]}):ri(F,D,S,k)):vn(F,D,S))}(l.sources,r.sources,m,h);const y=[];l.layers&&l.layers.forEach(b=>{"source"in b&&h[b.source]?a.push({command:"removeLayer",args:[b.id]}):y.push(b)}),a=a.concat(m),function(b,D,S){D=D||[];const k=(b=b||[]).map($i),F=D.map($i),$=b.reduce(mr,{}),G=D.reduce(mr,{}),W=k.slice(),X=Object.create(null);let Q,re,ye,Ae,Ce;for(let Me=0,Ge=0;Me<k.length;Me++)Q=k[Me],Object.prototype.hasOwnProperty.call(G,Q)?Ge++:(Tt(S,{command:"removeLayer",args:[Q]}),W.splice(W.indexOf(Q,Ge),1));for(let Me=0,Ge=0;Me<F.length;Me++)Q=F[F.length-1-Me],W[W.length-1-Me]!==Q&&(Object.prototype.hasOwnProperty.call($,Q)?(Tt(S,{command:"removeLayer",args:[Q]}),W.splice(W.lastIndexOf(Q,W.length-Ge),1)):Ge++,Ae=W[W.length-Me],Tt(S,{command:"addLayer",args:[G[Q],Ae]}),W.splice(W.length-Me,0,Q),X[Q]=!0);for(let Me=0;Me<F.length;Me++)if(Q=F[Me],re=$[Q],ye=G[Q],!X[Q]&&!bt(re,ye))if(bt(re.source,ye.source)&&bt(re["source-layer"],ye["source-layer"])&&bt(re.type,ye.type)){for(Ce in Ei(re.layout,ye.layout,S,Q,null,"setLayoutProperty"),Ei(re.paint,ye.paint,S,Q,null,"setPaintProperty"),bt(re.filter,ye.filter)||Tt(S,{command:"setFilter",args:[Q,ye.filter]}),bt(re.minzoom,ye.minzoom)&&bt(re.maxzoom,ye.maxzoom)||Tt(S,{command:"setLayerZoomRange",args:[Q,ye.minzoom,ye.maxzoom]}),re)Object.prototype.hasOwnProperty.call(re,Ce)&&"layout"!==Ce&&"paint"!==Ce&&"filter"!==Ce&&"metadata"!==Ce&&"minzoom"!==Ce&&"maxzoom"!==Ce&&(0===Ce.indexOf("paint.")?Ei(re[Ce],ye[Ce],S,Q,Ce.slice(6),"setPaintProperty"):bt(re[Ce],ye[Ce])||Tt(S,{command:"setLayerProperty",args:[Q,Ce,ye[Ce]]}));for(Ce in ye)Object.prototype.hasOwnProperty.call(ye,Ce)&&!Object.prototype.hasOwnProperty.call(re,Ce)&&"layout"!==Ce&&"paint"!==Ce&&"filter"!==Ce&&"metadata"!==Ce&&"minzoom"!==Ce&&"maxzoom"!==Ce&&(0===Ce.indexOf("paint.")?Ei(re[Ce],ye[Ce],S,Q,Ce.slice(6),"setPaintProperty"):bt(re[Ce],ye[Ce])||Tt(S,{command:"setLayerProperty",args:[Q,Ce,ye[Ce]]}))}else Tt(S,{command:"removeLayer",args:[Q]}),Ae=W[W.lastIndexOf(Q)+1],Tt(S,{command:"addLayer",args:[ye,Ae]})}(y,r.layers,a)}catch(h){console.warn("Unable to compute style diff:",h),a=[{command:"setStyle",args:[r]}]}return a},I.bW=function(l){const r=[],a=l.id;return void 0===a&&r.push({message:`layers.${a}: missing required property "id"`}),void 0===l.render&&r.push({message:`layers.${a}: missing required method "render"`}),l.renderingMode&&"2d"!==l.renderingMode&&"3d"!==l.renderingMode&&r.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),r},I.bX=ir,I.bY=tr,I.bZ=class extends zi{constructor(l,r){super(l,r),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},I.b_=lr,I.ba=function(l,r){return l[0]*r[0]+l[1]*r[1]+l[2]*r[2]+l[3]},I.bb=jy,I.bc=Oh,I.bd=function(l,r,a,h,m){var y=1/Math.tan(r/2);if(l[0]=y/a,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=y,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,null!=m&&m!==1/0){var b=1/(h-m);l[10]=(m+h)*b,l[14]=2*m*h*b}else l[10]=-1,l[14]=-2*h;return l},I.be=function(l){var r=new Ue(16);return r[0]=l[0],r[1]=l[1],r[2]=l[2],r[3]=l[3],r[4]=l[4],r[5]=l[5],r[6]=l[6],r[7]=l[7],r[8]=l[8],r[9]=l[9],r[10]=l[10],r[11]=l[11],r[12]=l[12],r[13]=l[13],r[14]=l[14],r[15]=l[15],r},I.bf=function(l,r,a){var h=Math.sin(a),m=Math.cos(a),y=r[0],b=r[1],D=r[2],S=r[3],k=r[4],F=r[5],$=r[6],G=r[7];return r!==l&&(l[8]=r[8],l[9]=r[9],l[10]=r[10],l[11]=r[11],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[0]=y*m+k*h,l[1]=b*m+F*h,l[2]=D*m+$*h,l[3]=S*m+G*h,l[4]=k*m-y*h,l[5]=F*m-b*h,l[6]=$*m-D*h,l[7]=G*m-S*h,l},I.bg=function(l,r,a){var h=Math.sin(a),m=Math.cos(a),y=r[4],b=r[5],D=r[6],S=r[7],k=r[8],F=r[9],$=r[10],G=r[11];return r!==l&&(l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15]),l[4]=y*m+k*h,l[5]=b*m+F*h,l[6]=D*m+$*h,l[7]=S*m+G*h,l[8]=k*m-y*h,l[9]=F*m-b*h,l[10]=$*m-D*h,l[11]=G*m-S*h,l},I.bh=function(){const l=new Float32Array(16);return ct(l),l},I.bi=function(){const l=new Float64Array(16);return ct(l),l},I.bj=function(){return new Float64Array(16)},I.bk=function(l,r,a){const h=new Float64Array(4);return ii(h,l,r-90,a),h},I.bl=function(l,r,a,h){var m,y,b,D,S,k=r[0],F=r[1],$=r[2],G=r[3],W=a[0],X=a[1],Q=a[2],re=a[3];return(y=k*W+F*X+$*Q+G*re)<0&&(y=-y,W=-W,X=-X,Q=-Q,re=-re),1-y>Ie?(m=Math.acos(y),b=Math.sin(m),D=Math.sin((1-h)*m)/b,S=Math.sin(h*m)/b):(D=1-h,S=h),l[0]=D*k+S*W,l[1]=D*F+S*X,l[2]=D*$+S*Q,l[3]=D*G+S*re,l},I.bm=function(l){const r=new Float64Array(9);var a,h,m,y,b,D,S,k,F,$,G,W,X,Q,re,ye,Ae,Ce;$=(m=(h=l)[0])*(S=m+m),G=(y=h[1])*S,X=(b=h[2])*S,Q=b*(k=y+y),ye=(D=h[3])*S,Ae=D*k,Ce=D*(F=b+b),(a=r)[0]=1-(W=y*k)-(re=b*F),a[3]=G-Ce,a[6]=X+Ae,a[1]=G+Ce,a[4]=1-$-re,a[7]=Q-ye,a[2]=X-Ae,a[5]=Q+ye,a[8]=1-$-W;const Me=nn(-Math.asin(Pn(r[2],-1,1)));let Ge,Xe;return Math.hypot(r[5],r[8])<.001?(Ge=0,Xe=-nn(Math.atan2(r[3],r[4]))):(Ge=nn(0===r[5]&&0===r[8]?0:Math.atan2(r[5],r[8])),Xe=nn(0===r[1]&&0===r[0]?0:Math.atan2(r[1],r[0]))),{roll:Ge,pitch:Me+90,bearing:Xe}},I.bn=function(l,r){return l.roll==r.roll&&l.pitch==r.pitch&&l.bearing==r.bearing},I.bo=oi,I.bp=er,I.bq=xf,I.br=ao,I.bs=fl,I.bt=ht,I.bu=Sn,I.bv=$o,I.bw=function(l,r,a,h,m){return ht(h,m,Pn((l-r)/(a-r),0,1))},I.bx=nt,I.by=function(){return new Float64Array(3)},I.bz=function(l,r,a,h){return l[0]=r[0]+a[0]*h,l[1]=r[1]+a[1]*h,l[2]=r[2]+a[2]*h,l},I.c=Hr,I.c$=class{constructor(l){this._marks={start:[l.url,"start"].join("#"),end:[l.url,"end"].join("#"),measure:l.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let l=performance.getEntriesByName(this._marks.measure);return 0===l.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),l=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),l}},I.c0=Ea,I.c1=class extends zi{constructor(l,r){super(l,r),this.current=[0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))}},I.c2=class extends zi{constructor(l,r){super(l,r),this.current=[0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))}},I.c3=ot,I.c4=function(l,r){var a=Math.sin(r),h=Math.cos(r);return l[0]=h,l[1]=a,l[2]=0,l[3]=-a,l[4]=h,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},I.c5=function(l,r,a){var h=r[0],m=r[1],y=r[2];return l[0]=h*a[0]+m*a[3]+y*a[6],l[1]=h*a[1]+m*a[4]+y*a[7],l[2]=h*a[2]+m*a[5]+y*a[8],l},I.c6=function(l,r,a,h,m,y,b){var D=1/(r-a),S=1/(h-m),k=1/(y-b);return l[0]=-2*D,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*S,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*k,l[11]=0,l[12]=(r+a)*D,l[13]=(m+h)*S,l[14]=(b+y)*k,l[15]=1,l},I.c7=class extends zi{constructor(l,r){super(l,r),this.current=new Array}set(l){if(l!=this.current){this.current=l;const r=new Float32Array(4*l.length);for(let a=0;a<l.length;a++)r[4*a]=l[a].r,r[4*a+1]=l[a].g,r[4*a+2]=l[a].b,r[4*a+3]=l[a].a;this.gl.uniform4fv(this.location,r)}}},I.c8=class extends zi{constructor(l,r){super(l,r),this.current=new Array}set(l){if(l!=this.current){this.current=l;const r=new Float32Array(l);this.gl.uniform1fv(this.location,r)}}},I.c9=class extends Ch{},I.cA=function(l){return mn[l]||ji[l]},I.cB=function(l,r,a){var h=r[0],m=r[1];return l[0]=a[0]*h+a[4]*m+a[12],l[1]=a[1]*h+a[5]*m+a[13],l},I.cC=function(l,r){const{x:a,y:h}=Ef.fromLngLat(r);return!(l<0||l>25||h<0||h>=1||a<0||a>=1)},I.cD=function(l,r){return l[0]=r[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=r[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=r[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},I.cE=class extends bd{},I.cF=ux,I.cH=function(l){return l.message===bi},I.cI=qi,I.cJ=function(l,r){ur.REGISTERED_PROTOCOLS[l]=r},I.cK=function(l){delete ur.REGISTERED_PROTOCOLS[l]},I.cL=function(l,r){const a={};for(let m=0;m<l.length;m++){const y=r&&r[l[m].id]||sl(l[m]);r&&(r[l[m].id]=y);let b=a[y];b||(b=a[y]=[]),b.push(l[m])}const h=[];for(const m in a)h.push(a[m]);return h},I.cM=hn,I.cN=yC,I.cO=tx,I.cP=Fb,I.cQ=function(l){l.bucket.createArrays(),l.bucket.tilePixelRatio=pt/(512*l.bucket.overscaling),l.bucket.compareText={},l.bucket.iconsNeedLinear=!1;const r=l.bucket.layers[0],a=r.layout,h=r._unevaluatedLayout._values,m={layoutIconSize:h["icon-size"].possiblyEvaluate(new Dr(l.bucket.zoom+1),l.canonical),layoutTextSize:h["text-size"].possiblyEvaluate(new Dr(l.bucket.zoom+1),l.canonical),textMaxSize:h["text-size"].possiblyEvaluate(new Dr(18))};if("composite"===l.bucket.textSizeData.kind){const{minZoom:k,maxZoom:F}=l.bucket.textSizeData;m.compositeTextSizes=[h["text-size"].possiblyEvaluate(new Dr(k),l.canonical),h["text-size"].possiblyEvaluate(new Dr(F),l.canonical)]}if("composite"===l.bucket.iconSizeData.kind){const{minZoom:k,maxZoom:F}=l.bucket.iconSizeData;m.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new Dr(k),l.canonical),h["icon-size"].possiblyEvaluate(new Dr(F),l.canonical)]}const y=24*a.get("text-line-height"),b="viewport"!==a.get("text-rotation-alignment")&&"point"!==a.get("symbol-placement"),D=a.get("text-keep-upright"),S=a.get("text-size");for(const k of l.bucket.features){const F=a.get("text-font").evaluate(k,{},l.canonical).join(","),$=S.evaluate(k,{},l.canonical),G=m.layoutTextSize.evaluate(k,{},l.canonical),W=m.layoutIconSize.evaluate(k,{},l.canonical),X={horizontal:{},vertical:void 0},Q=k.text;let re,ye=[0,0];if(Q){const Me=Q.toString(),Ge=24*a.get("text-letter-spacing").evaluate(k,{},l.canonical),Xe=Sp(Me)?Ge:0,mt=a.get("text-anchor").evaluate(k,{},l.canonical),Lt=ax(r,k,l.canonical);if(!Lt){const Jt=a.get("text-radial-offset").evaluate(k,{},l.canonical);ye=Jt?sx(mt,[24*Jt,tv]):a.get("text-offset").evaluate(k,{},l.canonical).map(Kt=>24*Kt)}let Pt=b?"center":a.get("text-justify").evaluate(k,{},l.canonical);const Vt="point"===a.get("symbol-placement")?24*a.get("text-max-width").evaluate(k,{},l.canonical):1/0,dn=()=>{l.bucket.allowVerticalPlacement&&uf(Me)&&(X.vertical=Ig(Q,l.glyphMap,l.glyphPositions,l.imagePositions,F,Vt,y,mt,"left",Xe,ye,I.ay.vertical,!0,G,$))};if(!b&&Lt){const Jt=new Set;if("auto"===Pt)for(let It=0;It<Lt.values.length;It+=2)Jt.add(nv(Lt.values[It]));else Jt.add(Pt);let Kt=!1;for(const It of Jt)if(!X.horizontal[It])if(Kt)X.horizontal[It]=X.horizontal[0];else{const Vn=Ig(Q,l.glyphMap,l.glyphPositions,l.imagePositions,F,Vt,y,"center",It,Xe,ye,I.ay.horizontal,!1,G,$);Vn&&(X.horizontal[It]=Vn,Kt=1===Vn.positionedLines.length)}dn()}else{"auto"===Pt&&(Pt=nv(mt));const Jt=Ig(Q,l.glyphMap,l.glyphPositions,l.imagePositions,F,Vt,y,mt,Pt,Xe,ye,I.ay.horizontal,!1,G,$);Jt&&(X.horizontal[Pt]=Jt),dn(),uf(Me)&&b&&D&&(X.vertical=Ig(Q,l.glyphMap,l.glyphPositions,l.imagePositions,F,Vt,y,mt,Pt,Xe,ye,I.ay.vertical,!1,G,$))}}let Ae=!1;if(k.icon&&k.icon.name){const Me=l.imageMap[k.icon.name];Me&&(re=gC(l.imagePositions[k.icon.name],a.get("icon-offset").evaluate(k,{},l.canonical),a.get("icon-anchor").evaluate(k,{},l.canonical)),Ae=!!Me.sdf,void 0===l.bucket.sdfIcons?l.bucket.sdfIcons=Ae:l.bucket.sdfIcons!==Ae&&ne("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Me.pixelRatio!==l.bucket.pixelRatio||0!==a.get("icon-rotate").constantOr(1))&&(l.bucket.iconsNeedLinear=!0))}const Ce=cx(X.horizontal)||X.vertical;l.bucket.iconsInText=!!Ce&&Ce.iconsInText,(Ce||re)&&iv(l.bucket,k,X,re,l.imageMap,m,G,W,ye,Ae,l.canonical,l.subdivisionGranularity)}l.showCollisionBoxes&&l.bucket.generateCollisionDebugBuffers()},I.cR=vy,I.cS=gb,I.cT=Dy,I.cU=fb,I.cV=Py,I.cW=Sd,I.cX=function(l,r,a,h,m,y){let b=ix(l,r,a,m,0);return b=ix(b,r,h,y,1),b},I.cY=class{constructor(l){this.maxEntries=l,this.map=new Map}get(l){const r=this.map.get(l);return void 0!==r&&(this.map.delete(l),this.map.set(l,r)),r}set(l,r){if(this.map.has(l))this.map.delete(l);else if(this.map.size>=this.maxEntries){const a=this.map.keys().next().value;this.map.delete(a)}this.map.set(l,r)}clear(){this.map.clear()}},I.cZ=mb,I.c_=Ky,I.ca=lC,I.cb=class extends fi{},I.cc=_g,I.cd=function(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))},I.ce=ib,I.cf=function(l,r,a){var h=r[0],m=r[1],y=r[2],b=a[3]*h+a[7]*m+a[11]*y+a[15];return l[0]=(a[0]*h+a[4]*m+a[8]*y+a[12])/(b=b||1),l[1]=(a[1]*h+a[5]*m+a[9]*y+a[13])/b,l[2]=(a[2]*h+a[6]*m+a[10]*y+a[14])/b,l},I.cg=class extends va{},I.ch=class extends g{},I.ci=function(l,r){return l[0]===r[0]&&l[1]===r[1]&&l[2]===r[2]&&l[3]===r[3]&&l[4]===r[4]&&l[5]===r[5]&&l[6]===r[6]&&l[7]===r[7]&&l[8]===r[8]&&l[9]===r[9]&&l[10]===r[10]&&l[11]===r[11]&&l[12]===r[12]&&l[13]===r[13]&&l[14]===r[14]&&l[15]===r[15]},I.cj=function(l,r){var a=l[0],h=l[1],m=l[2],y=l[3],b=l[4],D=l[5],S=l[6],k=l[7],F=l[8],$=l[9],G=l[10],W=l[11],X=l[12],Q=l[13],re=l[14],ye=l[15],Ae=r[0],Ce=r[1],Me=r[2],Ge=r[3],Xe=r[4],mt=r[5],Lt=r[6],Pt=r[7],Vt=r[8],dn=r[9],Jt=r[10],Kt=r[11],It=r[12],Vn=r[13],jn=r[14],qn=r[15];return Math.abs(a-Ae)<=Ie*Math.max(1,Math.abs(a),Math.abs(Ae))&&Math.abs(h-Ce)<=Ie*Math.max(1,Math.abs(h),Math.abs(Ce))&&Math.abs(m-Me)<=Ie*Math.max(1,Math.abs(m),Math.abs(Me))&&Math.abs(y-Ge)<=Ie*Math.max(1,Math.abs(y),Math.abs(Ge))&&Math.abs(b-Xe)<=Ie*Math.max(1,Math.abs(b),Math.abs(Xe))&&Math.abs(D-mt)<=Ie*Math.max(1,Math.abs(D),Math.abs(mt))&&Math.abs(S-Lt)<=Ie*Math.max(1,Math.abs(S),Math.abs(Lt))&&Math.abs(k-Pt)<=Ie*Math.max(1,Math.abs(k),Math.abs(Pt))&&Math.abs(F-Vt)<=Ie*Math.max(1,Math.abs(F),Math.abs(Vt))&&Math.abs($-dn)<=Ie*Math.max(1,Math.abs($),Math.abs(dn))&&Math.abs(G-Jt)<=Ie*Math.max(1,Math.abs(G),Math.abs(Jt))&&Math.abs(W-Kt)<=Ie*Math.max(1,Math.abs(W),Math.abs(Kt))&&Math.abs(X-It)<=Ie*Math.max(1,Math.abs(X),Math.abs(It))&&Math.abs(Q-Vn)<=Ie*Math.max(1,Math.abs(Q),Math.abs(Vn))&&Math.abs(re-jn)<=Ie*Math.max(1,Math.abs(re),Math.abs(jn))&&Math.abs(ye-qn)<=Ie*Math.max(1,Math.abs(ye),Math.abs(qn))},I.ck=function(l,r){return l[0]=r[0],l[1]=r[1],l[2]=r[2],l[3]=r[3],l[4]=r[4],l[5]=r[5],l[6]=r[6],l[7]=r[7],l[8]=r[8],l[9]=r[9],l[10]=r[10],l[11]=r[11],l[12]=r[12],l[13]=r[13],l[14]=r[14],l[15]=r[15],l},I.cl=l=>"symbol"===l.type,I.cm=l=>"circle"===l.type,I.cn=l=>"heatmap"===l.type,I.co=l=>"line"===l.type,I.cp=l=>"fill"===l.type,I.cq=l=>"fill-extrusion"===l.type,I.cr=l=>"hillshade"===l.type,I.cs=l=>"color-relief"===l.type,I.ct=l=>"background"===l.type,I.cu=l=>"custom"===l.type,I.cv=ln,I.cw=function(l,r,a){const h=Qn(r.x-a.x,r.y-a.y),m=Qn(l.x-a.x,l.y-a.y);var y,b;return nn(Math.atan2(h[0]*m[1]-h[1]*m[0],(y=h)[0]*(b=m)[0]+y[1]*b[1]))},I.cx=Wt,I.cy=function(l,r){return ji[r]&&(l instanceof MouseEvent||l instanceof WheelEvent)},I.cz=function(l,r){return mn[r]&&"touches"in l},I.d=ie,I.d0=function(l,r,a,h,m){return p(this,void 0,void 0,function*(){if(Ee())try{return yield jt(l,r,a,h,m)}catch{}return function(y,b,D,S,k){const F=y.width,$=y.height;Ut&&dt||(Ut=new OffscreenCanvas(F,$),dt=Ut.getContext("2d",{willReadFrequently:!0})),Ut.width=F,Ut.height=$,dt.drawImage(y,0,0,F,$);const G=dt.getImageData(b,D,S,k);return dt.clearRect(0,0,F,$),G.data}(l,r,a,h,m)})},I.d1=sb,I.d2=he,I.d3=Cu,I.d4=Pu,I.e=Zn,I.f=l=>p(void 0,void 0,void 0,function*(){if(0===l.byteLength)return createImageBitmap(new ImageData(1,1));const r=new Blob([new Uint8Array(l)],{type:"image/png"});try{return createImageBitmap(r)}catch(a){throw new Error(`Could not load image because of ${a.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),I.g=Mo,I.h=l=>new Promise((r,a)=>{const h=new Image;h.onload=()=>{r(h),URL.revokeObjectURL(h.src),h.onload=null,window.requestAnimationFrame(()=>{h.src=it})},h.onerror=()=>a(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const m=new Blob([new Uint8Array(l)],{type:"image/png"});h.src=l.byteLength?URL.createObjectURL(m):it}),I.i=Ct,I.j=(l,r)=>He(Zn(l,{type:"json"}),r),I.k=Ve,I.l=Fe,I.m=He,I.n=(l,r)=>He(Zn(l,{type:"arrayBuffer"}),r),I.o=function(l){return new Py(l).readFields(Rb,[])},I.p=Ay,I.q=function(l){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(l))},I.r=Sh,I.s=tn,I.t=gi,I.u=xe,I.v=Zc,I.w=ne,I.x=Ap,I.y=Yr,I.z=vd}),st("worker",0,function(I){class p{constructor(ie,oe){this.keyCache={},ie&&this.replace(ie,oe)}replace(ie,oe){this._layerConfigs={},this._layers={},this.update(ie,[],oe)}update(ie,oe,ge){for(const Ve of ie){this._layerConfigs[Ve.id]=Ve;const rt=this._layers[Ve.id]=I.bS(Ve,ge);rt._featureFilter=I.aj(rt.filter,ge),this.keyCache[Ve.id]&&delete this.keyCache[Ve.id]}for(const Ve of oe)delete this.keyCache[Ve],delete this._layerConfigs[Ve],delete this._layers[Ve];this.familiesBySource={};const Fe=I.cL(Object.values(this._layerConfigs),this.keyCache);for(const Ve of Fe){const rt=Ve.map(vn=>this._layers[vn.id]),xe=rt[0];if("none"===xe.visibility)continue;const Ke=xe.source||"";let yt=this.familiesBySource[Ke];yt||(yt=this.familiesBySource[Ke]={});const bt=xe.sourceLayer||I.a9;let Tt=yt[bt];Tt||(Tt=yt[bt]=[]),Tt.push(rt)}}}class Z{constructor(ie){const oe={},ge=[];for(const xe in ie){const Ke=ie[xe],yt=oe[xe]={};for(const bt in Ke){const Tt=Ke[+bt];if(!Tt||0===Tt.bitmap.width||0===Tt.bitmap.height)continue;const vn={x:0,y:0,w:Tt.bitmap.width+2,h:Tt.bitmap.height+2};ge.push(vn),yt[bt]={rect:vn,metrics:Tt.metrics}}}const{w:Fe,h:Ve}=I.p(ge),rt=new I.r({width:Fe||1,height:Ve||1});for(const xe in ie){const Ke=ie[xe];for(const yt in Ke){const bt=Ke[+yt];if(!bt||0===bt.bitmap.width||0===bt.bitmap.height)continue;const Tt=oe[xe][yt].rect;I.r.copy(bt.bitmap,rt,{x:0,y:0},{x:Tt.x+1,y:Tt.y+1},bt.bitmap)}}this.image=rt,this.positions=oe}}I.cM("GlyphAtlas",Z);class he{constructor(ie){this.tileID=new I.a1(ie.tileID.overscaledZ,ie.tileID.wrap,ie.tileID.canonical.z,ie.tileID.canonical.x,ie.tileID.canonical.y),this.uid=ie.uid,this.zoom=ie.zoom,this.pixelRatio=ie.pixelRatio,this.tileSize=ie.tileSize,this.source=ie.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ie.showCollisionBoxes,this.collectResourceTiming=!!ie.collectResourceTiming,this.returnDependencies=!!ie.returnDependencies,this.promoteId=ie.promoteId,this.inFlightDependencies=[]}parse(ie,oe,ge,Fe,Ve){return I._(this,void 0,void 0,function*(){this.status="parsing",this.data=ie,this.collisionBoxArray=new I.ah;const rt=new I.cN(Object.keys(ie.layers).sort()),xe=new I.cO(this.tileID,this.promoteId);xe.bucketLayerIDs=[];const Ke={},yt={featureIndex:xe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:ge,subdivisionGranularity:Ve},bt=oe.familiesBySource[this.source];for(const Mn in bt){const Un=ie.layers[Mn];if(!Un)continue;1===Un.version&&I.w(`Vector tile source "${this.source}" layer "${Mn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const rs=rt.encode(Mn),Ir=[];for(let mo=0;mo<Un.length;mo++){const kn=Un.feature(mo),ka=xe.getId(kn,Mn);Ir.push({feature:kn,id:ka,index:mo,sourceLayerIndex:rs})}for(const mo of bt[Mn]){const kn=mo[0];kn.source!==this.source&&I.w(`layer.source = ${kn.source} does not equal this.source = ${this.source}`),kn.isHidden(this.zoom,!0)||(be(mo,this.zoom,ge),(Ke[kn.id]=kn.createBucket({index:xe.bucketLayerIDs.length,layers:mo,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:rs,sourceID:this.source})).populate(Ir,yt,this.tileID.canonical),xe.bucketLayerIDs.push(mo.map(ka=>ka.id)))}}const Tt=I.bX(yt.glyphDependencies,Mn=>Object.keys(Mn).map(Number));this.inFlightDependencies.forEach(Mn=>Mn?.abort()),this.inFlightDependencies=[];let vn=Promise.resolve({});if(Object.keys(Tt).length){const Mn=new AbortController;this.inFlightDependencies.push(Mn),vn=Fe.sendAsync({type:"GG",data:{stacks:Tt,source:this.source,tileID:this.tileID,type:"glyphs"}},Mn)}const Bn=Object.keys(yt.iconDependencies);let ri=Promise.resolve({});if(Bn.length){const Mn=new AbortController;this.inFlightDependencies.push(Mn),ri=Fe.sendAsync({type:"GI",data:{icons:Bn,source:this.source,tileID:this.tileID,type:"icons"}},Mn)}const hr=Object.keys(yt.patternDependencies);let Ei=Promise.resolve({});if(hr.length){const Mn=new AbortController;this.inFlightDependencies.push(Mn),Ei=Fe.sendAsync({type:"GI",data:{icons:hr,source:this.source,tileID:this.tileID,type:"patterns"}},Mn)}const $i=yt.dashDependencies;let mr=Promise.resolve({});if(Object.keys($i).length){const Mn=new AbortController;this.inFlightDependencies.push(Mn),mr=Fe.sendAsync({type:"GDA",data:{dashes:$i}},Mn)}const[Gt,Ci,gn,Zr]=yield Promise.all([vn,ri,Ei,mr]),di=new Z(Gt),qt=new I.cP(Ci,gn);for(const Mn in Ke){const Un=Ke[Mn];Un instanceof I.ai?(be(Un.layers,this.zoom,ge),I.cQ({bucket:Un,glyphMap:Gt,glyphPositions:di.positions,imageMap:Ci,imagePositions:qt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:yt.subdivisionGranularity})):Un.hasDependencies&&(Un instanceof I.cR||Un instanceof I.cS||Un instanceof I.cT)&&(be(Un.layers,this.zoom,ge),Un.addFeatures(yt,this.tileID.canonical,qt.patternPositions,Zr))}return this.status="done",{buckets:Object.values(Ke).filter(Mn=>!Mn.isEmpty()),featureIndex:xe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:di.image,imageAtlas:qt,dashPositions:Zr,glyphMap:this.returnDependencies?Gt:null,iconMap:this.returnDependencies?Ci:null,glyphPositions:this.returnDependencies?di.positions:null}})}}function be(He,ie,oe){const ge=new I.H(ie);for(const Fe of He)Fe.recalculate(ge,oe)}class me extends I.cW{constructor(ie,oe){super(new I.cV,0,oe,[],[]),this.feature=ie,this.type=ie.type,this.properties=ie.tags?ie.tags:{},"id"in ie&&("string"==typeof ie.id?this.id=parseInt(ie.id,10):"number"!=typeof ie.id||isNaN(ie.id)||(this.id=ie.id))}loadGeometry(){const ie=[],oe=1===this.feature.type?[this.feature.geometry]:this.feature.geometry;for(const ge of oe){const Fe=[];for(const Ve of ge)Fe.push(new I.P(Ve[0],Ve[1]));ie.push(Fe)}return ie}}class ve extends I.cU{constructor(ie,oe){super(new I.cV),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=oe?oe.version:1,this.extent=oe?oe.extent:4096,this.length=ie.length,this.features=ie}feature(ie){return new me(this.features[ie],this.extent)}}function ee(He,ie){ie.writeVarintField(15,He.version||1),ie.writeStringField(1,He.name||""),ie.writeVarintField(5,He.extent||4096);const oe={keys:[],values:[],keycache:{},valuecache:{}};for(let Ve=0;Ve<He.length;Ve++)oe.feature=He.feature(Ve),ie.writeMessage(2,fe,oe);const ge=oe.keys;for(const Ve of ge)ie.writeStringField(3,Ve);const Fe=oe.values;for(const Ve of Fe)ie.writeMessage(4,Ue,Ve)}function fe(He,ie){if(!He.feature)return;const oe=He.feature;void 0!==oe.id&&ie.writeVarintField(1,oe.id),ie.writeMessage(2,ue,He),ie.writeVarintField(3,oe.type),ie.writeMessage(4,Ie,oe)}function ue(He,ie){for(const oe in He.feature?.properties){let ge=He.feature.properties[oe],Fe=He.keycache[oe];if(null===ge)continue;void 0===Fe&&(He.keys.push(oe),Fe=He.keys.length-1,He.keycache[oe]=Fe),ie.writeVarint(Fe),"string"!=typeof ge&&"boolean"!=typeof ge&&"number"!=typeof ge&&(ge=JSON.stringify(ge));const Ve=typeof ge+":"+ge;let rt=He.valuecache[Ve];void 0===rt&&(He.values.push(ge),rt=He.values.length-1,He.valuecache[Ve]=rt),ie.writeVarint(rt)}}function K(He,ie){return(ie<<3)+(7&He)}function Ee(He){return He<<1^He>>31}function Ie(He,ie){const oe=He.loadGeometry(),ge=He.type;let Fe=0,Ve=0;for(const rt of oe){let xe=1;1===ge&&(xe=rt.length),ie.writeVarint(K(1,xe));const Ke=3===ge?rt.length-1:rt.length;for(let yt=0;yt<Ke;yt++){1===yt&&1!==ge&&ie.writeVarint(K(2,Ke-1));const bt=rt[yt].x-Fe,Tt=rt[yt].y-Ve;ie.writeVarint(Ee(bt)),ie.writeVarint(Ee(Tt)),Fe+=bt,Ve+=Tt}3===He.type&&ie.writeVarint(K(7,1))}}function Ue(He,ie){const oe=typeof He;"string"===oe?ie.writeStringField(1,He):"boolean"===oe?ie.writeBooleanField(7,He):"number"===oe&&(He%1!=0?ie.writeDoubleField(3,He):He<0?ie.writeSVarintField(6,He):ie.writeVarintField(5,He))}class ot extends I.cW{constructor(ie,oe,ge,Fe,Ve){super(new I.cV,0,Ve,[],[]),this.type=ie,this.properties=ge||{},this.extent=Ve,this.pointsArray=oe,this.id=Fe}loadGeometry(){return this.pointsArray.map(ie=>ie.map(oe=>new I.P(oe.x,oe.y)))}}class ct extends I.cU{constructor(ie,oe,ge){super(new I.cV),this.version=2,this._myFeatures=ie,this.name=oe,this.length=ie.length,this.extent=ge}feature(ie){return this._myFeatures[ie]}}class St{constructor(){this.layers={}}addLayer(ie){this.layers[ie.name]=ie}}function xt(He){let ie=function(oe){const ge=new I.cV;return function(Fe,Ve){for(const rt in Fe.layers)Ve.writeMessage(3,ee,Fe.layers[rt])}(oe,ge),ge.finish()}(He);return 0===ie.byteOffset&&ie.byteLength===ie.buffer.byteLength||(ie=new Uint8Array(ie)),{vectorTile:He,rawData:ie.buffer}}function Qt(He,ie,oe){const{extent:ge}=He,Fe=Math.pow(2,oe.z-ie.z),Ve=(oe.x-ie.x*Fe)*ge,rt=(oe.y-ie.y*Fe)*ge,xe=[];for(let Ke=0;Ke<He.length;Ke++){const yt=He.feature(Ke);let bt=yt.loadGeometry();for(const vn of bt)for(const Bn of vn)Bn.x=Bn.x*Fe-Ve,Bn.y=Bn.y*Fe-rt;const Tt=128;bt=I.cX(bt,yt.type,-Tt,-Tt,ge+Tt,ge+Tt),0!==bt.length&&xe.push(new ot(yt.type,bt,yt.properties,yt.id,ge))}return new ct(xe,He.name,ge)}class Mt{constructor(ie,oe,ge){this.actor=ie,this.layerIndex=oe,this.availableImages=ge,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new I.cY(1e3)}loadVectorTile(ie,oe){return I._(this,void 0,void 0,function*(){const ge=yield I.n(ie.request,oe);try{return{vectorTile:"mlt"!==ie.encoding?new I.cZ(new I.cV(ge.data)):new I.c_(ge.data),rawData:ge.data,cacheControl:ge.cacheControl,expires:ge.expires}}catch(Fe){const Ve=new Uint8Array(ge.data);let rt=`Unable to parse the tile at ${ie.request.url}, `;throw rt+=31===Ve[0]&&139===Ve[1]?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Fe.message}`,new Error(rt)}})}loadTile(ie){return I._(this,void 0,void 0,function*(){const{uid:oe,overzoomParameters:ge}=ie;ge&&(ie.request=ge.overzoomRequest);const Fe=!!(ie&&ie.request&&ie.request.collectResourceTiming)&&new I.c$(ie.request),Ve=new he(ie);this.loading[oe]=Ve;const rt=new AbortController;Ve.abort=rt;try{const xe=yield this.loadVectorTile(ie,rt);if(delete this.loading[oe],!xe)return null;if(ge){const vn=this._getOverzoomTile(ie,xe.vectorTile);xe.rawData=vn.rawData,xe.vectorTile=vn.vectorTile}const Ke=xe.rawData,yt={};xe.expires&&(yt.expires=xe.expires),xe.cacheControl&&(yt.cacheControl=xe.cacheControl);const bt={};if(Fe){const vn=Fe.finish();vn&&(bt.resourceTiming=JSON.parse(JSON.stringify(vn)))}Ve.vectorTile=xe.vectorTile;const Tt=Ve.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.actor,ie.subdivisionGranularity);this.loaded[oe]=Ve,this.fetching[oe]={rawTileData:Ke,cacheControl:yt,resourceTiming:bt};try{const vn=yield Tt;return I.e({rawTileData:Ke.slice(0),encoding:ie.encoding},vn,yt,bt)}finally{delete this.fetching[oe]}}catch(xe){throw delete this.loading[oe],Ve.status="done",this.loaded[oe]=Ve,xe}})}_getOverzoomTile(ie,oe){const{tileID:ge,source:Fe,overzoomParameters:Ve}=ie,{maxZoomTileID:rt}=Ve,xe=`${rt.key}_${ge.key}`,Ke=this.overzoomedTileResultCache.get(xe);if(Ke)return Ke;const yt=new St,bt=this.layerIndex.familiesBySource[Fe];for(const vn in bt){const Bn=oe.layers[vn];if(!Bn)continue;const ri=Qt(Bn,rt,ge.canonical);ri.length>0&&yt.addLayer(ri)}const Tt=xt(yt);return this.overzoomedTileResultCache.set(xe,Tt),Tt}reloadTile(ie){return I._(this,void 0,void 0,function*(){const oe=ie.uid;if(!this.loaded||!this.loaded[oe])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ge=this.loaded[oe];if(ge.showCollisionBoxes=ie.showCollisionBoxes,"parsing"===ge.status){const Fe=yield ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor,ie.subdivisionGranularity);let Ve;if(this.fetching[oe]){const{rawTileData:rt,cacheControl:xe,resourceTiming:Ke}=this.fetching[oe];delete this.fetching[oe],Ve=I.e({rawTileData:rt.slice(0),encoding:ie.encoding},Fe,xe,Ke)}else Ve=Fe;return Ve}if("done"===ge.status&&ge.vectorTile)return ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor,ie.subdivisionGranularity)})}abortTile(ie){return I._(this,void 0,void 0,function*(){const oe=this.loading,ge=ie.uid;oe&&oe[ge]&&oe[ge].abort&&(oe[ge].abort.abort(),delete oe[ge])})}removeTile(ie){return I._(this,void 0,void 0,function*(){this.loaded&&this.loaded[ie.uid]&&delete this.loaded[ie.uid]})}}class on{constructor(){this.loaded={}}loadTile(ie){return I._(this,void 0,void 0,function*(){const{uid:oe,encoding:ge,rawImageData:Fe,redFactor:Ve,greenFactor:rt,blueFactor:xe,baseShift:Ke}=ie,yt=Fe.width+2,bt=Fe.height+2,Tt=I.b(Fe)?new I.R({width:yt,height:bt},yield I.d0(Fe,-1,-1,yt,bt)):Fe,vn=new I.d1(oe,Tt,ge,Ve,rt,xe,Ke);return this.loaded=this.loaded||{},this.loaded[oe]=vn,vn})}removeTile(ie){const oe=this.loaded,ge=ie.uid;oe&&oe[ge]&&delete oe[ge]}}var Hn,Ze,Dt=function(){if(Ze)return Hn;function He(oe,ge){if(0!==oe.length){ie(oe[0],ge);for(var Fe=1;Fe<oe.length;Fe++)ie(oe[Fe],!ge)}}function ie(oe,ge){for(var Fe=0,Ve=0,rt=0,xe=oe.length,Ke=xe-1;rt<xe;Ke=rt++){var yt=(oe[rt][0]-oe[Ke][0])*(oe[Ke][1]+oe[rt][1]),bt=Fe+yt;Ve+=Math.abs(Fe)>=Math.abs(yt)?Fe-bt+yt:yt-bt+Fe,Fe=bt}Fe+Ve>=0!=!!ge&&oe.reverse()}return Ze=1,Hn=function oe(ge,Fe){var Ve,rt=ge&&ge.type;if("FeatureCollection"===rt)for(Ve=0;Ve<ge.features.length;Ve++)oe(ge.features[Ve],Fe);else if("GeometryCollection"===rt)for(Ve=0;Ve<ge.geometries.length;Ve++)oe(ge.geometries[Ve],Fe);else if("Feature"===rt)oe(ge.geometry,Fe);else if("Polygon"===rt)He(ge.coordinates,Fe);else if("MultiPolygon"===rt)for(Ve=0;Ve<ge.coordinates.length;Ve++)He(ge.coordinates[Ve],Fe);return ge}}(),pe=I.d2(Dt);const Rt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:He=>He},ii=Math.fround||(Bt=new Float32Array(1),He=>(Bt[0]=+He,Bt[0]));var Bt;class Qn{constructor(ie){this.options=Object.assign(Object.create(Rt),ie),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ie){const{log:oe,minZoom:ge,maxZoom:Fe}=this.options;oe&&console.time("total time");const Ve=`prepare ${ie.length} points`;oe&&console.time(Ve),this.points=ie;const rt=[];for(let Ke=0;Ke<ie.length;Ke++){const yt=ie[Ke];if(!yt.geometry)continue;const[bt,Tt]=yt.geometry.coordinates,vn=ii(nt(bt)),Bn=ii(ht(Tt));rt.push(vn,Bn,1/0,Ke,-1,1),this.options.reduce&&rt.push(0)}let xe=this.trees[Fe+1]=this._createTree(rt);oe&&console.timeEnd(Ve);for(let Ke=Fe;Ke>=ge;Ke--){const yt=+Date.now();xe=this.trees[Ke]=this._createTree(this._cluster(xe,Ke)),oe&&console.log("z%d: %d clusters in %dms",Ke,xe.numItems,+Date.now()-yt)}return oe&&console.timeEnd("total time"),this}getClusters(ie,oe){let ge=((ie[0]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,ie[1]));let Ve=180===ie[2]?180:((ie[2]+180)%360+360)%360-180;const rt=Math.max(-90,Math.min(90,ie[3]));if(ie[2]-ie[0]>=360)ge=-180,Ve=180;else if(ge>Ve){const Tt=this.getClusters([ge,Fe,180,rt],oe),vn=this.getClusters([-180,Fe,Ve,rt],oe);return Tt.concat(vn)}const xe=this.trees[this._limitZoom(oe)],Ke=xe.range(nt(ge),ht(rt),nt(Ve),ht(Fe)),yt=xe.data,bt=[];for(const Tt of Ke){const vn=this.stride*Tt;bt.push(yt[vn+5]>1?pt(yt,vn,this.clusterProps):this.points[yt[vn+3]])}return bt}getChildren(ie){const oe=this._getOriginId(ie),ge=this._getOriginZoom(ie),Fe="No cluster with the specified id.",Ve=this.trees[ge];if(!Ve)throw new Error(Fe);const rt=Ve.data;if(oe*this.stride>=rt.length)throw new Error(Fe);const xe=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),Ke=Ve.within(rt[oe*this.stride],rt[oe*this.stride+1],xe),yt=[];for(const bt of Ke){const Tt=bt*this.stride;rt[Tt+4]===ie&&yt.push(rt[Tt+5]>1?pt(rt,Tt,this.clusterProps):this.points[rt[Tt+3]])}if(0===yt.length)throw new Error(Fe);return yt}getLeaves(ie,oe,ge){const Fe=[];return this._appendLeaves(Fe,ie,oe=oe||10,ge=ge||0,0),Fe}getTile(ie,oe,ge){const Fe=this.trees[this._limitZoom(ie)],Ve=Math.pow(2,ie),{extent:rt,radius:xe}=this.options,Ke=xe/rt,yt=(ge-Ke)/Ve,bt=(ge+1+Ke)/Ve,Tt={features:[]};return this._addTileFeatures(Fe.range((oe-Ke)/Ve,yt,(oe+1+Ke)/Ve,bt),Fe.data,oe,ge,Ve,Tt),0===oe&&this._addTileFeatures(Fe.range(1-Ke/Ve,yt,1,bt),Fe.data,Ve,ge,Ve,Tt),oe===Ve-1&&this._addTileFeatures(Fe.range(0,yt,Ke/Ve,bt),Fe.data,-1,ge,Ve,Tt),Tt.features.length?Tt:null}getClusterExpansionZoom(ie){let oe=this._getOriginZoom(ie)-1;for(;oe<=this.options.maxZoom;){const ge=this.getChildren(ie);if(oe++,1!==ge.length)break;ie=ge[0].properties.cluster_id}return oe}_appendLeaves(ie,oe,ge,Fe,Ve){const rt=this.getChildren(oe);for(const xe of rt){const Ke=xe.properties;if(Ke&&Ke.cluster?Ve+Ke.point_count<=Fe?Ve+=Ke.point_count:Ve=this._appendLeaves(ie,Ke.cluster_id,ge,Fe,Ve):Ve<Fe?Ve++:ie.push(xe),ie.length===ge)break}return Ve}_createTree(ie){const oe=new I.aS(ie.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<ie.length;ge+=this.stride)oe.add(ie[ge],ie[ge+1]);return oe.finish(),oe.data=ie,oe}_addTileFeatures(ie,oe,ge,Fe,Ve,rt){for(const xe of ie){const Ke=xe*this.stride,yt=oe[Ke+5]>1;let bt,Tt,vn;if(yt)bt=Nn(oe,Ke,this.clusterProps),Tt=oe[Ke],vn=oe[Ke+1];else{const hr=this.points[oe[Ke+3]];bt=hr.properties;const[Ei,$i]=hr.geometry.coordinates;Tt=nt(Ei),vn=ht($i)}const Bn={type:1,geometry:[[Math.round(this.options.extent*(Tt*Ve-ge)),Math.round(this.options.extent*(vn*Ve-Fe))]],tags:bt};let ri;ri=yt||this.options.generateId?oe[Ke+3]:this.points[oe[Ke+3]].id,void 0!==ri&&(Bn.id=ri),rt.features.push(Bn)}}_limitZoom(ie){return Math.max(this.options.minZoom,Math.min(Math.floor(+ie),this.options.maxZoom+1))}_cluster(ie,oe){const{radius:ge,extent:Fe,reduce:Ve,minPoints:rt}=this.options,xe=ge/(Fe*Math.pow(2,oe)),Ke=ie.data,yt=[],bt=this.stride;for(let Tt=0;Tt<Ke.length;Tt+=bt){if(Ke[Tt+2]<=oe)continue;Ke[Tt+2]=oe;const vn=Ke[Tt],Bn=Ke[Tt+1],ri=ie.within(Ke[Tt],Ke[Tt+1],xe),hr=Ke[Tt+5];let Ei=hr;for(const $i of ri){const mr=$i*bt;Ke[mr+2]>oe&&(Ei+=Ke[mr+5])}if(Ei>hr&&Ei>=rt){let $i,mr=vn*hr,Gt=Bn*hr,Ci=-1;const gn=(Tt/bt<<5)+(oe+1)+this.points.length;for(const Zr of ri){const di=Zr*bt;if(Ke[di+2]<=oe)continue;Ke[di+2]=oe;const qt=Ke[di+5];mr+=Ke[di]*qt,Gt+=Ke[di+1]*qt,Ke[di+4]=gn,Ve&&($i||($i=this._map(Ke,Tt,!0),Ci=this.clusterProps.length,this.clusterProps.push($i)),Ve($i,this._map(Ke,di)))}Ke[Tt+4]=gn,yt.push(mr/Ei,Gt/Ei,1/0,gn,-1,Ei),Ve&&yt.push(Ci)}else{for(let $i=0;$i<bt;$i++)yt.push(Ke[Tt+$i]);if(Ei>1)for(const $i of ri){const mr=$i*bt;if(!(Ke[mr+2]<=oe)){Ke[mr+2]=oe;for(let Gt=0;Gt<bt;Gt++)yt.push(Ke[mr+Gt])}}}}return yt}_getOriginId(ie){return ie-this.points.length>>5}_getOriginZoom(ie){return(ie-this.points.length)%32}_map(ie,oe,ge){if(ie[oe+5]>1){const rt=this.clusterProps[ie[oe+6]];return ge?Object.assign({},rt):rt}const Fe=this.points[ie[oe+3]].properties,Ve=this.options.map(Fe);return ge&&Ve===Fe?Object.assign({},Ve):Ve}}function pt(He,ie,oe){return{type:"Feature",id:He[ie+3],properties:Nn(He,ie,oe),geometry:{type:"Point",coordinates:[(ge=He[ie],360*(ge-.5)),Sn(He[ie+1])]}};var ge}function Nn(He,ie,oe){const ge=He[ie+5],Fe=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,Ve=He[ie+6],rt=-1===Ve?{}:Object.assign({},oe[Ve]);return Object.assign(rt,{cluster:!0,cluster_id:He[ie+3],point_count:ge,point_count_abbreviated:Fe})}function nt(He){return He/360+.5}function ht(He){const ie=Math.sin(He*Math.PI/180),oe=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return oe<0?0:oe>1?1:oe}function Sn(He){const ie=(180-360*He)*Math.PI/180;return 360*Math.atan(Math.exp(ie))/Math.PI-90}function ln(He,ie,oe,ge){let Fe=ge;const Ve=ie+(oe-ie>>1);let rt,xe=oe-ie;const Ke=He[ie],yt=He[ie+1],bt=He[oe],Tt=He[oe+1];for(let vn=ie+3;vn<oe;vn+=3){const Bn=Wt(He[vn],He[vn+1],Ke,yt,bt,Tt);if(Bn>Fe)rt=vn,Fe=Bn;else if(Bn===Fe){const ri=Math.abs(vn-Ve);ri<xe&&(rt=vn,xe=ri)}}Fe>ge&&(rt-ie>3&&ln(He,ie,rt,ge),He[rt+2]=Fe,oe-rt>3&&ln(He,rt,oe,ge))}function Wt(He,ie,oe,ge,Fe,Ve){let rt=Fe-oe,xe=Ve-ge;if(0!==rt||0!==xe){const Ke=((He-oe)*rt+(ie-ge)*xe)/(rt*rt+xe*xe);Ke>1?(oe=Fe,ge=Ve):Ke>0&&(oe+=rt*Ke,ge+=xe*Ke)}return rt=He-oe,xe=ie-ge,rt*rt+xe*xe}function Pn(He,ie,oe,ge){const Fe={id:He??null,type:ie,geometry:oe,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===ie||"MultiPoint"===ie||"LineString"===ie)zn(Fe,oe);else if("Polygon"===ie)zn(Fe,oe[0]);else if("MultiLineString"===ie)for(const Ve of oe)zn(Fe,Ve);else if("MultiPolygon"===ie)for(const Ve of oe)zn(Fe,Ve[0]);return Fe}function zn(He,ie){for(let oe=0;oe<ie.length;oe+=3)He.minX=Math.min(He.minX,ie[oe]),He.minY=Math.min(He.minY,ie[oe+1]),He.maxX=Math.max(He.maxX,ie[oe]),He.maxY=Math.max(He.maxY,ie[oe+1])}function Zn(He,ie,oe,ge){if(!ie.geometry)return;const Fe=ie.geometry.coordinates;if(Fe&&0===Fe.length)return;const Ve=ie.geometry.type,rt=Math.pow(oe.tolerance/((1<<oe.maxZoom)*oe.extent),2);let xe=[],Ke=ie.id;if(oe.promoteId?Ke=ie.properties[oe.promoteId]:oe.generateId&&(Ke=ge||0),"Point"===Ve)mi(Fe,xe);else if("MultiPoint"===Ve)for(const yt of Fe)mi(yt,xe);else if("LineString"===Ve)ir(Fe,xe,rt,!1);else if("MultiLineString"===Ve){if(oe.lineMetrics){for(const yt of Fe)xe=[],ir(yt,xe,rt,!1),He.push(Pn(Ke,"LineString",xe,ie.properties));return}tr(Fe,xe,rt,!1)}else if("Polygon"===Ve)tr(Fe,xe,rt,!0);else{if("MultiPolygon"!==Ve){if("GeometryCollection"===Ve){for(const yt of ie.geometry.geometries)Zn(He,{id:Ke,geometry:yt,properties:ie.properties},oe,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const yt of Fe){const bt=[];tr(yt,bt,rt,!0),xe.push(bt)}}He.push(Pn(Ke,Ve,xe,ie.properties))}function mi(He,ie){ie.push(pr(He[0]),Jr(He[1]),0)}function ir(He,ie,oe,ge){let Fe,Ve,rt=0;for(let Ke=0;Ke<He.length;Ke++){const yt=pr(He[Ke][0]),bt=Jr(He[Ke][1]);ie.push(yt,bt,0),Ke>0&&(rt+=ge?(Fe*bt-yt*Ve)/2:Math.sqrt(Math.pow(yt-Fe,2)+Math.pow(bt-Ve,2))),Fe=yt,Ve=bt}const xe=ie.length-3;ie[2]=1,ln(ie,0,xe,oe),ie[xe+2]=1,ie.size=Math.abs(rt),ie.start=0,ie.end=ie.size}function tr(He,ie,oe,ge){for(let Fe=0;Fe<He.length;Fe++){const Ve=[];ir(He[Fe],Ve,oe,ge),ie.push(Ve)}}function pr(He){return He/360+.5}function Jr(He){const ie=Math.sin(He*Math.PI/180),oe=.5-.25*Math.log((1+ie)/(1-ie))/Math.PI;return oe<0?0:oe>1?1:oe}function ne(He,ie,oe,ge,Fe,Ve,rt,xe){if(ge/=ie,Ve>=(oe/=ie)&&rt<ge)return He;if(rt<oe||Ve>=ge)return null;const Ke=[];for(const yt of He){const bt=yt.geometry;let Tt=yt.type;const vn=0===Fe?yt.minX:yt.minY,Bn=0===Fe?yt.maxX:yt.maxY;if(vn>=oe&&Bn<ge){Ke.push(yt);continue}if(Bn<oe||vn>=ge)continue;let ri=[];if("Point"===Tt||"MultiPoint"===Tt)kt(bt,ri,oe,ge,Fe);else if("LineString"===Tt)Ct(bt,ri,oe,ge,Fe,!1,xe.lineMetrics);else if("MultiLineString"===Tt)ke(bt,ri,oe,ge,Fe,!1);else if("Polygon"===Tt)ke(bt,ri,oe,ge,Fe,!0);else if("MultiPolygon"===Tt)for(const hr of bt){const Ei=[];ke(hr,Ei,oe,ge,Fe,!0),Ei.length&&ri.push(Ei)}if(ri.length){if(xe.lineMetrics&&"LineString"===Tt){for(const hr of ri)Ke.push(Pn(yt.id,Tt,hr,yt.tags));continue}"LineString"!==Tt&&"MultiLineString"!==Tt||(1===ri.length?(Tt="LineString",ri=ri[0]):Tt="MultiLineString"),"Point"!==Tt&&"MultiPoint"!==Tt||(Tt=3===ri.length?"Point":"MultiPoint"),Ke.push(Pn(yt.id,Tt,ri,yt.tags))}}return Ke.length?Ke:null}function kt(He,ie,oe,ge,Fe){for(let Ve=0;Ve<He.length;Ve+=3){const rt=He[Ve+Fe];rt>=oe&&rt<=ge&&it(ie,He[Ve],He[Ve+1],He[Ve+2])}}function Ct(He,ie,oe,ge,Fe,Ve,rt){let xe=Oe(He);const Ke=0===Fe?jt:Ut;let yt,bt,Tt=He.start;for(let Ei=0;Ei<He.length-3;Ei+=3){const $i=He[Ei],mr=He[Ei+1],Gt=He[Ei+2],Ci=He[Ei+3],gn=He[Ei+4],Zr=0===Fe?$i:mr,di=0===Fe?Ci:gn;let qt=!1;rt&&(yt=Math.sqrt(Math.pow($i-Ci,2)+Math.pow(mr-gn,2))),Zr<oe?di>oe&&(bt=Ke(xe,$i,mr,Ci,gn,oe),rt&&(xe.start=Tt+yt*bt)):Zr>ge?di<ge&&(bt=Ke(xe,$i,mr,Ci,gn,ge),rt&&(xe.start=Tt+yt*bt)):it(xe,$i,mr,Gt),di<oe&&Zr>=oe&&(bt=Ke(xe,$i,mr,Ci,gn,oe),qt=!0),di>ge&&Zr<=ge&&(bt=Ke(xe,$i,mr,Ci,gn,ge),qt=!0),!Ve&&qt&&(rt&&(xe.end=Tt+yt*bt),ie.push(xe),xe=Oe(He)),rt&&(Tt+=yt)}let vn=He.length-3;const Bn=He[vn],ri=He[vn+1],hr=0===Fe?Bn:ri;hr>=oe&&hr<=ge&&it(xe,Bn,ri,He[vn+2]),vn=xe.length-3,Ve&&vn>=3&&(xe[vn]!==xe[0]||xe[vn+1]!==xe[1])&&it(xe,xe[0],xe[1],xe[2]),xe.length&&ie.push(xe)}function Oe(He){const ie=[];return ie.size=He.size,ie.start=He.start,ie.end=He.end,ie}function ke(He,ie,oe,ge,Fe,Ve){for(const rt of He)Ct(rt,ie,oe,ge,Fe,Ve,!1)}function it(He,ie,oe,ge){He.push(ie,oe,ge)}function jt(He,ie,oe,ge,Fe,Ve){const rt=(Ve-ie)/(ge-ie);return it(He,Ve,oe+(Fe-oe)*rt,1),rt}function Ut(He,ie,oe,ge,Fe,Ve){const rt=(Ve-oe)/(Fe-oe);return it(He,ie+(ge-ie)*rt,Ve,1),rt}function dt(He,ie){const oe=[];for(let ge=0;ge<He.length;ge++){const Fe=He[ge],Ve=Fe.type;let rt;if("Point"===Ve||"MultiPoint"===Ve||"LineString"===Ve)rt=tn(Fe.geometry,ie);else if("MultiLineString"===Ve||"Polygon"===Ve){rt=[];for(const xe of Fe.geometry)rt.push(tn(xe,ie))}else if("MultiPolygon"===Ve){rt=[];for(const xe of Fe.geometry){const Ke=[];for(const yt of xe)Ke.push(tn(yt,ie));rt.push(Ke)}}oe.push(Pn(Fe.id,Ve,rt,Fe.tags))}return oe}function tn(He,ie){const oe=[];oe.size=He.size,void 0!==He.start&&(oe.start=He.start,oe.end=He.end);for(let ge=0;ge<He.length;ge+=3)oe.push(He[ge]+ie,He[ge+1],He[ge+2]);return oe}function Cn(He,ie){if(He.transformed)return He;const oe=1<<He.z,ge=He.x,Fe=He.y;for(const Ve of He.features){const rt=Ve.geometry,xe=Ve.type;if(Ve.geometry=[],1===xe)for(let Ke=0;Ke<rt.length;Ke+=2)Ve.geometry.push(nn(rt[Ke],rt[Ke+1],ie,oe,ge,Fe));else for(let Ke=0;Ke<rt.length;Ke++){const yt=[];for(let bt=0;bt<rt[Ke].length;bt+=2)yt.push(nn(rt[Ke][bt],rt[Ke][bt+1],ie,oe,ge,Fe));Ve.geometry.push(yt)}}return He.transformed=!0,He}function nn(He,ie,oe,ge,Fe,Ve){return[Math.round(oe*(He*ge-Fe)),Math.round(oe*(ie*ge-Ve))]}function mn(He,ie,oe,ge,Fe){const Ve=ie===Fe.maxZoom?0:Fe.tolerance/((1<<ie)*Fe.extent),rt={features:[],numPoints:0,numSimplified:0,numFeatures:He.length,source:null,x:oe,y:ge,z:ie,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const xe of He)ji(rt,xe,Ve,Fe);return rt}function ji(He,ie,oe,ge){const Fe=ie.geometry,Ve=ie.type,rt=[];if(He.minX=Math.min(He.minX,ie.minX),He.minY=Math.min(He.minY,ie.minY),He.maxX=Math.max(He.maxX,ie.maxX),He.maxY=Math.max(He.maxY,ie.maxY),"Point"===Ve||"MultiPoint"===Ve)for(let xe=0;xe<Fe.length;xe+=3)rt.push(Fe[xe],Fe[xe+1]),He.numPoints++,He.numSimplified++;else if("LineString"===Ve)bi(rt,Fe,He,oe,!1,!1);else if("MultiLineString"===Ve||"Polygon"===Ve)for(let xe=0;xe<Fe.length;xe++)bi(rt,Fe[xe],He,oe,"Polygon"===Ve,0===xe);else if("MultiPolygon"===Ve)for(let xe=0;xe<Fe.length;xe++){const Ke=Fe[xe];for(let yt=0;yt<Ke.length;yt++)bi(rt,Ke[yt],He,oe,!0,0===yt)}if(rt.length){let xe=ie.tags||null;if("LineString"===Ve&&ge.lineMetrics){xe={};for(const yt in ie.tags)xe[yt]=ie.tags[yt];xe.mapbox_clip_start=Fe.start/Fe.size,xe.mapbox_clip_end=Fe.end/Fe.size}const Ke={geometry:rt,type:"Polygon"===Ve||"MultiPolygon"===Ve?3:"LineString"===Ve||"MultiLineString"===Ve?2:1,tags:xe};null!==ie.id&&(Ke.id=ie.id),He.features.push(Ke)}}function bi(He,ie,oe,ge,Fe,Ve){const rt=ge*ge;if(ge>0&&ie.size<(Fe?rt:ge))return void(oe.numPoints+=ie.length/3);const xe=[];for(let Ke=0;Ke<ie.length;Ke+=3)(0===ge||ie[Ke+2]>rt)&&(oe.numSimplified++,xe.push(ie[Ke],ie[Ke+1])),oe.numPoints++;Fe&&function(Ke,yt){let bt=0;for(let Tt=0,vn=Ke.length,Bn=vn-2;Tt<vn;Bn=Tt,Tt+=2)bt+=(Ke[Tt]-Ke[Bn])*(Ke[Tt+1]+Ke[Bn+1]);if(bt>0===yt)for(let Tt=0,vn=Ke.length;Tt<vn/2;Tt+=2){const Bn=Ke[Tt],ri=Ke[Tt+1];Ke[Tt]=Ke[vn-2-Tt],Ke[Tt+1]=Ke[vn-1-Tt],Ke[vn-2-Tt]=Bn,Ke[vn-1-Tt]=ri}}(xe,Ve),He.push(xe)}const Hr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ur{constructor(ie,oe){const ge=(oe=this.options=function(Ve,rt){for(const xe in rt)Ve[xe]=rt[xe];return Ve}(Object.create(Hr),oe)).debug;if(ge&&console.time("preprocess data"),oe.maxZoom<0||oe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(oe.promoteId&&oe.generateId)throw new Error("promoteId and generateId cannot be used together.");let Fe=function(Ve,rt){const xe=[];if("FeatureCollection"===Ve.type)for(let Ke=0;Ke<Ve.features.length;Ke++)Zn(xe,Ve.features[Ke],rt,Ke);else Zn(xe,"Feature"===Ve.type?Ve:{geometry:Ve},rt);return xe}(ie,oe);this.tiles={},this.tileCoords=[],ge&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",oe.indexMaxZoom,oe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Fe=function(Ve,rt){const xe=rt.buffer/rt.extent;let Ke=Ve;const yt=ne(Ve,1,-1-xe,xe,0,-1,2,rt),bt=ne(Ve,1,1-xe,2+xe,0,-1,2,rt);return(yt||bt)&&(Ke=ne(Ve,1,-xe,1+xe,0,-1,2,rt)||[],yt&&(Ke=dt(yt,1).concat(Ke)),bt&&(Ke=Ke.concat(dt(bt,-1)))),Ke}(Fe,oe),Fe.length&&this.splitTile(Fe,0,0,0),ge&&(Fe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ie,oe,ge,Fe,Ve,rt,xe){const Ke=[ie,oe,ge,Fe],yt=this.options,bt=yt.debug;for(;Ke.length;){Fe=Ke.pop(),ge=Ke.pop(),oe=Ke.pop(),ie=Ke.pop();const Tt=1<<oe,vn=Mo(oe,ge,Fe);let Bn=this.tiles[vn];if(!Bn&&(bt>1&&console.time("creation"),Bn=this.tiles[vn]=mn(ie,oe,ge,Fe,yt),this.tileCoords.push({z:oe,x:ge,y:Fe}),bt)){bt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",oe,ge,Fe,Bn.numFeatures,Bn.numPoints,Bn.numSimplified),console.timeEnd("creation"));const qt=`z${oe}`;this.stats[qt]=(this.stats[qt]||0)+1,this.total++}if(Bn.source=ie,null==Ve){if(oe===yt.indexMaxZoom||Bn.numPoints<=yt.indexMaxPoints)continue}else{if(oe===yt.maxZoom||oe===Ve)continue;if(null!=Ve){const qt=Ve-oe;if(ge!==rt>>qt||Fe!==xe>>qt)continue}}if(Bn.source=null,0===ie.length)continue;bt>1&&console.time("clipping");const ri=.5*yt.buffer/yt.extent,hr=.5-ri,Ei=.5+ri,$i=1+ri;let mr=null,Gt=null,Ci=null,gn=null,Zr=ne(ie,Tt,ge-ri,ge+Ei,0,Bn.minX,Bn.maxX,yt),di=ne(ie,Tt,ge+hr,ge+$i,0,Bn.minX,Bn.maxX,yt);ie=null,Zr&&(mr=ne(Zr,Tt,Fe-ri,Fe+Ei,1,Bn.minY,Bn.maxY,yt),Gt=ne(Zr,Tt,Fe+hr,Fe+$i,1,Bn.minY,Bn.maxY,yt),Zr=null),di&&(Ci=ne(di,Tt,Fe-ri,Fe+Ei,1,Bn.minY,Bn.maxY,yt),gn=ne(di,Tt,Fe+hr,Fe+$i,1,Bn.minY,Bn.maxY,yt),di=null),bt>1&&console.timeEnd("clipping"),Ke.push(mr||[],oe+1,2*ge,2*Fe),Ke.push(Gt||[],oe+1,2*ge,2*Fe+1),Ke.push(Ci||[],oe+1,2*ge+1,2*Fe),Ke.push(gn||[],oe+1,2*ge+1,2*Fe+1)}}getTile(ie,oe,ge){ie=+ie,oe=+oe,ge=+ge;const Fe=this.options,{extent:Ve,debug:rt}=Fe;if(ie<0||ie>24)return null;const xe=1<<ie,Ke=Mo(ie,oe=oe+xe&xe-1,ge);if(this.tiles[Ke])return Cn(this.tiles[Ke],Ve);rt>1&&console.log("drilling down to z%d-%d-%d",ie,oe,ge);let yt,bt=ie,Tt=oe,vn=ge;for(;!yt&&bt>0;)bt--,Tt>>=1,vn>>=1,yt=this.tiles[Mo(bt,Tt,vn)];return yt&&yt.source?(rt>1&&(console.log("found parent tile z%d-%d-%d",bt,Tt,vn),console.time("drilling down")),this.splitTile(yt.source,bt,Tt,vn,ie,oe,ge),rt>1&&console.timeEnd("drilling down"),this.tiles[Ke]?Cn(this.tiles[Ke],Ve):null):null}}function Mo(He,ie,oe){return 32*((1<<He)*oe+ie)+He}class is extends Mt{constructor(ie,oe,ge,Fe=qi){super(ie,oe,ge),this._dataUpdateable=new Map,this._createGeoJSONIndex=Fe}loadVectorTile(ie,oe){return I._(this,void 0,void 0,function*(){const ge=ie.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Fe=this._geoJSONIndex.getTile(ge.z,ge.x,ge.y);return Fe?xt(new ve(Fe.features,{version:2,extent:I.a4})):null})}loadData(ie){return I._(this,void 0,void 0,function*(){var oe;null===(oe=this._pendingRequest)||void 0===oe||oe.abort();const ge=this._startPerformance(ie);this._pendingRequest=new AbortController;try{(!this._pendingData||ie.request||ie.data||ie.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(ie,this._pendingRequest));const Fe=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(Fe,ie),this.loaded={};const Ve=ie.dataDiff&&I.a6(Fe)?{applyDiff:!0}:{data:Fe};return this._finishPerformance(ge,ie,Ve),Ve}catch(Fe){if(delete this._pendingRequest,I.cH(Fe))return{abandoned:!0};throw Fe}})}_startPerformance(ie){var oe;if(null!==(oe=ie?.request)&&void 0!==oe&&oe.collectResourceTiming)return new I.c$(ie.request)}_finishPerformance(ie,oe,ge){if(!ie)return;const Fe=ie.finish();Fe&&(ge.resourceTiming={},ge.resourceTiming[oe.source]=JSON.parse(JSON.stringify(Fe)))}getData(){return I._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(ie){const oe=this.loaded;return oe&&oe[ie.uid]?super.reloadTile(ie):this.loadTile(ie)}loadAndProcessGeoJSON(ie,oe){return I._(this,void 0,void 0,function*(){let ge;if(ie.request?ge=yield this.loadGeoJSONFromUrl(ie.request,ie.promoteId,oe):ie.data?ge=this._loadGeoJSONFromObject(ie.data,ie.promoteId):ie.dataDiff&&(ge=this._loadGeoJSONFromDiff(ie.dataDiff,ie.promoteId,ie.source)),delete this._pendingRequest,"object"!=typeof ge)throw new Error(`Input data given to '${ie.source}' is not a valid GeoJSON object.`);return pe(ge,!0),ie.filter&&(ge=this._filterGeoJSON(ge,ie.filter)),ge})}loadGeoJSONFromUrl(ie,oe,ge){return I._(this,void 0,void 0,function*(){const Fe=yield I.j(ie,ge);return this._dataUpdateable=I.a6(Fe.data,oe)?I.a7(Fe.data,oe):void 0,Fe.data})}_loadGeoJSONFromObject(ie,oe){return this._dataUpdateable=I.a6(ie,oe)?I.a7(ie,oe):void 0,ie}_loadGeoJSONFromDiff(ie,oe,ge){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ge}`);I.a8(this._dataUpdateable,ie,oe);const Fe=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(Fe)}_filterGeoJSON(ie,oe){const ge=I.d3(oe,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ge.result)throw new Error(ge.value.map(Ve=>`${Ve.key}: ${Ve.message}`).join(", "));const Fe=ie.features.filter(Ve=>ge.value.evaluate({zoom:0},Ve));return this._toFeatureCollection(Fe)}_toFeatureCollection(ie){return{type:"FeatureCollection",features:ie}}removeSource(ie){return I._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(ie){return this._geoJSONIndex.getClusterExpansionZoom(ie.clusterId)}getClusterChildren(ie){return this._geoJSONIndex.getChildren(ie.clusterId)}getClusterLeaves(ie){return this._geoJSONIndex.getLeaves(ie.clusterId,ie.limit,ie.offset)}}function qi(He,ie){return ie.cluster?new Qn(function({superclusterOptions:oe,clusterProperties:ge}){if(!ge||!oe)return oe;const Fe={},Ve={},rt={accumulated:null,zoom:0},xe={properties:null},Ke=Object.keys(ge);for(const yt of Ke){const[bt,Tt]=ge[yt],vn=I.d3(Tt),Bn=I.d3("string"==typeof bt?[bt,["accumulated"],["get",yt]]:bt);Fe[yt]=vn.value,Ve[yt]=Bn.value}return oe.map=yt=>{xe.properties=yt;const bt={};for(const Tt of Ke)bt[Tt]=Fe[Tt].evaluate(rt,xe);return bt},oe.reduce=(yt,bt)=>{xe.properties=bt;for(const Tt of Ke)rt.accumulated=yt[Tt],yt[Tt]=Ve[Tt].evaluate(rt,xe)},oe}(ie)).load(He.features):new ur(He,ie.geojsonVtOptions)}class Sr{constructor(ie){this.self=ie,this.actor=new I.L(ie),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(oe,ge)=>{if(this.externalWorkerSourceTypes[oe])throw new Error(`Worker source with name "${oe}" already registered.`);this.externalWorkerSourceTypes[oe]=ge},this.self.addProtocol=I.cJ,this.self.removeProtocol=I.cK,this.self.registerRTLTextPlugin=oe=>{I.d4.setMethods(oe)},this.actor.registerMessageHandler("LDT",(oe,ge)=>this._getDEMWorkerSource(oe,ge.source).loadTile(ge)),this.actor.registerMessageHandler("RDT",(oe,ge)=>I._(this,void 0,void 0,function*(){this._getDEMWorkerSource(oe,ge.source).removeTile(ge)})),this.actor.registerMessageHandler("GCEZ",(oe,ge)=>I._(this,void 0,void 0,function*(){return this._getWorkerSource(oe,ge.type,ge.source).getClusterExpansionZoom(ge)})),this.actor.registerMessageHandler("GCC",(oe,ge)=>I._(this,void 0,void 0,function*(){return this._getWorkerSource(oe,ge.type,ge.source).getClusterChildren(ge)})),this.actor.registerMessageHandler("GCL",(oe,ge)=>I._(this,void 0,void 0,function*(){return this._getWorkerSource(oe,ge.type,ge.source).getClusterLeaves(ge)})),this.actor.registerMessageHandler("LD",(oe,ge)=>this._getWorkerSource(oe,ge.type,ge.source).loadData(ge)),this.actor.registerMessageHandler("GD",(oe,ge)=>this._getWorkerSource(oe,ge.type,ge.source).getData()),this.actor.registerMessageHandler("LT",(oe,ge)=>this._getWorkerSource(oe,ge.type,ge.source).loadTile(ge)),this.actor.registerMessageHandler("RT",(oe,ge)=>this._getWorkerSource(oe,ge.type,ge.source).reloadTile(ge)),this.actor.registerMessageHandler("AT",(oe,ge)=>this._getWorkerSource(oe,ge.type,ge.source).abortTile(ge)),this.actor.registerMessageHandler("RMT",(oe,ge)=>this._getWorkerSource(oe,ge.type,ge.source).removeTile(ge)),this.actor.registerMessageHandler("RS",(oe,ge)=>I._(this,void 0,void 0,function*(){if(!this.workerSources[oe]||!this.workerSources[oe][ge.type]||!this.workerSources[oe][ge.type][ge.source])return;const Fe=this.workerSources[oe][ge.type][ge.source];delete this.workerSources[oe][ge.type][ge.source],void 0!==Fe.removeSource&&Fe.removeSource(ge)})),this.actor.registerMessageHandler("RM",oe=>I._(this,void 0,void 0,function*(){delete this.layerIndexes[oe],delete this.availableImages[oe],delete this.workerSources[oe],delete this.demWorkerSources[oe],this.globalStates.delete(oe)})),this.actor.registerMessageHandler("SR",(oe,ge)=>I._(this,void 0,void 0,function*(){this.referrer=ge})),this.actor.registerMessageHandler("SRPS",(oe,ge)=>this._syncRTLPluginState(oe,ge)),this.actor.registerMessageHandler("IS",(oe,ge)=>I._(this,void 0,void 0,function*(){this.self.importScripts(ge)})),this.actor.registerMessageHandler("SI",(oe,ge)=>this._setImages(oe,ge)),this.actor.registerMessageHandler("UL",(oe,ge)=>I._(this,void 0,void 0,function*(){this._getLayerIndex(oe).update(ge.layers,ge.removedIds,this._getGlobalState(oe))})),this.actor.registerMessageHandler("UGS",(oe,ge)=>I._(this,void 0,void 0,function*(){const Fe=this._getGlobalState(oe);for(const Ve in ge)Fe[Ve]=ge[Ve]})),this.actor.registerMessageHandler("SL",(oe,ge)=>I._(this,void 0,void 0,function*(){this._getLayerIndex(oe).replace(ge,this._getGlobalState(oe))}))}_getGlobalState(ie){let oe=this.globalStates.get(ie);return oe||(oe={},this.globalStates.set(ie,oe)),oe}_setImages(ie,oe){return I._(this,void 0,void 0,function*(){this.availableImages[ie]=oe;for(const ge in this.workerSources[ie]){const Fe=this.workerSources[ie][ge];for(const Ve in Fe)Fe[Ve].availableImages=oe}})}_syncRTLPluginState(ie,oe){return I._(this,void 0,void 0,function*(){return yield I.d4.syncState(oe,this.self.importScripts)})}_getAvailableImages(ie){let oe=this.availableImages[ie];return oe||(oe=[]),oe}_getLayerIndex(ie){let oe=this.layerIndexes[ie];return oe||(oe=this.layerIndexes[ie]=new p),oe}_getWorkerSource(ie,oe,ge){if(this.workerSources[ie]||(this.workerSources[ie]={}),this.workerSources[ie][oe]||(this.workerSources[ie][oe]={}),!this.workerSources[ie][oe][ge]){const Fe={sendAsync:(Ve,rt)=>(Ve.targetMapId=ie,this.actor.sendAsync(Ve,rt))};switch(oe){case"vector":this.workerSources[ie][oe][ge]=new Mt(Fe,this._getLayerIndex(ie),this._getAvailableImages(ie));break;case"geojson":this.workerSources[ie][oe][ge]=new is(Fe,this._getLayerIndex(ie),this._getAvailableImages(ie));break;default:this.workerSources[ie][oe][ge]=new this.externalWorkerSourceTypes[oe](Fe,this._getLayerIndex(ie),this._getAvailableImages(ie))}}return this.workerSources[ie][oe][ge]}_getDEMWorkerSource(ie,oe){return this.demWorkerSources[ie]||(this.demWorkerSources[ie]={}),this.demWorkerSources[ie][oe]||(this.demWorkerSources[ie][oe]=new on),this.demWorkerSources[ie][oe]}}return I.i(self)&&(self.worker=new Sr(self)),Sr}),st("index",0,function(I,p){var Z="5.13.0";function he(){var w=new p.A(4);return p.A!=Float32Array&&(w[1]=0,w[2]=0),w[0]=1,w[3]=1,w}let be,me,ve;const ee={frame(w,o,u){const g=requestAnimationFrame(T=>{v(),o(T)}),{unsubscribe:v}=p.s(w.signal,"abort",()=>{v(),cancelAnimationFrame(g),u(p.c())},!1)},frameAsync(w){return new Promise((o,u)=>{this.frame(w,o,u)})},getImageData(w,o=0){return this.getImageCanvasContext(w).getImageData(-o,-o,w.width+2*o,w.height+2*o)},getImageCanvasContext(w){const o=window.document.createElement("canvas"),u=o.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return o.width=w.width,o.height=w.height,u.drawImage(w,0,0,w.width,w.height),u},resolveURL:w=>(be||(be=document.createElement("a")),be.href=w,be.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return void 0!==ve?ve:!!matchMedia&&(null==me&&(me=matchMedia("(prefers-reduced-motion: reduce)")),me.matches)},set prefersReducedMotion(w){ve=w}},fe=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return null!==this._frozenAt?this._frozenAt:this._realTime()}setNow(w){this._frozenAt=w}restoreNow(){this._frozenAt=null}isFrozen(){return null!==this._frozenAt}};function ue(){return fe.getCurrentTime()}class K{static testProp(o){if(!K.docStyle)return o[0];for(let u=0;u<o.length;u++)if(o[u]in K.docStyle)return o[u];return o[0]}static create(o,u,g){const v=window.document.createElement(o);return void 0!==u&&(v.className=u),g&&g.appendChild(v),v}static createNS(o,u){return window.document.createElementNS(o,u)}static disableDrag(){K.docStyle&&K.selectProp&&(K.userSelect=K.docStyle[K.selectProp],K.docStyle[K.selectProp]="none")}static enableDrag(){K.docStyle&&K.selectProp&&(K.docStyle[K.selectProp]=K.userSelect)}static setTransform(o,u){o.style[K.transformProp]=u}static addEventListener(o,u,g,v={}){o.addEventListener(u,g,"passive"in v?v:v.capture)}static removeEventListener(o,u,g,v={}){o.removeEventListener(u,g,"passive"in v?v:v.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",K.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",K.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",K.suppressClickInternal,!0)},0)}static getScale(o){const u=o.getBoundingClientRect();return{x:u.width/o.offsetWidth||1,y:u.height/o.offsetHeight||1,boundingClientRect:u}}static getPoint(o,u,g){const v=u.boundingClientRect;return new p.P((g.clientX-v.left)/u.x-o.clientLeft,(g.clientY-v.top)/u.y-o.clientTop)}static mousePos(o,u){const g=K.getScale(o);return K.getPoint(o,g,u)}static touchPos(o,u){const g=[],v=K.getScale(o);for(let T=0;T<u.length;T++)g.push(K.getPoint(o,v,u[T]));return g}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}static sanitize(o){const u=(new DOMParser).parseFromString(o,"text/html").body||document.createElement("body"),g=u.querySelectorAll("script");for(const v of g)v.remove();return K.clean(u),u.innerHTML}static isPossiblyDangerous(o,u){const g=u.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(o)||!g.includes("javascript:")&&!g.includes("data:"))||!!o.startsWith("on")||void 0}static clean(o){const u=o.children;for(const g of u)K.removeAttributes(g),K.clean(g)}static removeAttributes(o){for(const{name:u,value:g}of o.attributes)K.isPossiblyDangerous(u,g)&&o.removeAttribute(u)}}K.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,K.selectProp=K.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),K.transformProp=K.testProp(["transform","WebkitTransform"]);const Ee={supported:!1,testSupport:function(w){!ot&&Ue&&(ct?St(w):Ie=w)}};let Ie,Ue,ot=!1,ct=!1;function St(w){const o=w.createTexture();w.bindTexture(w.TEXTURE_2D,o);try{if(w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,Ue),w.isContextLost())return;Ee.supported=!0}catch{}w.deleteTexture(o),ot=!0}var xt;typeof document<"u"&&(Ue=document.createElement("img"),Ue.onload=()=>{Ie&&St(Ie),Ie=null,ct=!0},Ue.onerror=()=>{ot=!0,Ie=null},Ue.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(w){let o,u,g,v;w.resetRequestQueue=()=>{o=[],u=0,g=0,v={}},w.addThrottleControl=O=>{const U=g++;return v[U]=O,U},w.removeThrottleControl=O=>{delete v[O],M()},w.getImage=(O,U,N=!0)=>new Promise((H,q)=>{Ee.supported&&(O.headers||(O.headers={}),O.headers.accept="image/webp,*/*"),p.e(O,{type:"image"}),o.push({abortController:U,requestParameters:O,supportImageRefresh:N,state:"queued",onError:te=>{q(te)},onSuccess:te=>{H(te)}}),M()});const T=O=>p._(this,void 0,void 0,function*(){O.state="running";const{requestParameters:U,supportImageRefresh:N,onError:H,onSuccess:q,abortController:te}=O,ce=!1===N&&!p.i(self)&&!p.g(U.url)&&(!U.headers||Object.keys(U.headers).reduce((we,Le)=>we&&"accept"===Le,!0));u++;const Te=ce?A(U,te):p.m(U,te);try{const we=yield Te;delete O.abortController,O.state="completed",we.data instanceof HTMLImageElement||p.b(we.data)?q(we):we.data&&q({data:yield(De=we.data,"function"==typeof createImageBitmap?p.f(De):p.h(De)),cacheControl:we.cacheControl,expires:we.expires})}catch(we){delete O.abortController,H(we)}finally{u--,M()}var De}),M=()=>{const O=(()=>{for(const U of Object.keys(v))if(v[U]())return!0;return!1})()?p.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:p.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let U=u;U<O&&o.length>0;U++){const N=o.shift();N.abortController.signal.aborted?U--:T(N)}},A=(O,U)=>new Promise((N,H)=>{const q=new Image,te=O.url,ce=O.credentials;ce&&"include"===ce?q.crossOrigin="use-credentials":(ce&&"same-origin"===ce||!p.d(te))&&(q.crossOrigin="anonymous"),U.signal.addEventListener("abort",()=>{q.src="",H(p.c())}),q.fetchPriority="high",q.onload=()=>{q.onerror=q.onload=null,N({data:q})},q.onerror=()=>{q.onerror=q.onload=null,U.signal.aborted||H(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},q.src=te})}(xt||(xt={})),xt.resetRequestQueue();class Qt{constructor(o){this._transformRequestFn=o??null}transformRequest(o,u){return this._transformRequestFn&&this._transformRequestFn(o,u)||{url:o}}setTransformRequest(o){this._transformRequestFn=o}}function Mt(w){const o=[];if("string"==typeof w)o.push({id:"default",url:w});else if(w&&w.length>0){const u=[];for(const{id:g,url:v}of w){const T=`${g}${v}`;-1===u.indexOf(T)&&(u.push(T),o.push({id:g,url:v}))}}return o}function on(w,o,u){try{const g=new URL(w);return g.pathname+=`${o}${u}`,g.toString()}catch{throw new Error(`Invalid sprite URL "${w}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Hn(w){const{userImage:o}=w;return!!(o&&o.render&&o.render())&&(w.data.replace(new Uint8Array(o.data.buffer)),!0)}class Ze extends p.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const o of Object.keys(this.images))this.removeImage(o);this.patterns={},this.atlasImage=new p.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:u,promiseResolve:g}of this.requestors)g(this._getImagesForIds(u));this.requestors=[]}}getImage(o){const u=this.images[o];if(u&&!u.data&&u.spriteData){const g=u.spriteData;u.data=new p.R({width:g.width,height:g.height},g.context.getImageData(g.x,g.y,g.width,g.height).data),u.spriteData=null}return u}addImage(o,u){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,u)&&(this.images[o]=u)}_validate(o,u){let g=!0;const v=u.data||u.spriteData;return this._validateStretch(u.stretchX,v&&v.width)||(this.fire(new p.k(new Error(`Image "${o}" has invalid "stretchX" value`))),g=!1),this._validateStretch(u.stretchY,v&&v.height)||(this.fire(new p.k(new Error(`Image "${o}" has invalid "stretchY" value`))),g=!1),this._validateContent(u.content,u)||(this.fire(new p.k(new Error(`Image "${o}" has invalid "content" value`))),g=!1),g}_validateStretch(o,u){if(!o)return!0;let g=0;for(const v of o){if(v[0]<g||v[1]<v[0]||u<v[1])return!1;g=v[1]}return!0}_validateContent(o,u){if(!o)return!0;if(4!==o.length)return!1;const g=u.spriteData,v=g&&g.width||u.data.width,T=g&&g.height||u.data.height;return!(o[0]<0||v<o[0]||o[1]<0||T<o[1]||o[2]<0||v<o[2]||o[3]<0||T<o[3]||o[2]<o[0]||o[3]<o[1])}updateImage(o,u,g=!0){const v=this.getImage(o);if(g&&(v.data.width!==u.data.width||v.data.height!==u.data.height))throw new Error(`size mismatch between old image (${v.data.width}x${v.data.height}) and new image (${u.data.width}x${u.data.height}).`);u.version=v.version+1,this.images[o]=u,this.updatedImages[o]=!0}removeImage(o){const u=this.images[o];delete this.images[o],delete this.patterns[o],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o){return new Promise((u,g)=>{let v=!0;if(!this.isLoaded())for(const T of o)this.images[T]||(v=!1);this.isLoaded()||v?u(this._getImagesForIds(o)):this.requestors.push({ids:o,promiseResolve:u})})}_getImagesForIds(o){const u={};for(const g of o){let v=this.getImage(g);v||(this.fire(new p.l("styleimagemissing",{id:g})),v=this.getImage(g)),v?u[g]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,textFitWidth:v.textFitWidth,textFitHeight:v.textFitHeight,hasRenderCallback:!(!v.userImage||!v.userImage.render)}:p.w(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return u}getPixelSize(){const{width:o,height:u}=this.atlasImage;return{width:o,height:u}}getPattern(o){const u=this.patterns[o],g=this.getImage(o);if(!g)return null;if(u&&u.position.version===g.version)return u.position;if(u)u.position.version=g.version;else{const v={w:g.data.width+2,h:g.data.height+2,x:0,y:0},T=new p.I(v,g);this.patterns[o]={bin:v,position:T}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const u=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.T(o,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const T in this.patterns)o.push(this.patterns[T].bin);const{w:u,h:g}=p.p(o),v=this.atlasImage;v.resize({width:u||1,height:g||1});for(const T in this.patterns){const{bin:M}=this.patterns[T],A=M.x+1,O=M.y+1,U=this.getImage(T).data,N=U.width,H=U.height;p.R.copy(U,v,{x:0,y:0},{x:A,y:O},{width:N,height:H}),p.R.copy(U,v,{x:0,y:H-1},{x:A,y:O-1},{width:N,height:1}),p.R.copy(U,v,{x:0,y:0},{x:A,y:O+H},{width:N,height:1}),p.R.copy(U,v,{x:N-1,y:0},{x:A-1,y:O},{width:1,height:H}),p.R.copy(U,v,{x:0,y:0},{x:A+N,y:O},{width:1,height:H})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const u of o){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const g=this.getImage(u);g||p.w(`Image with ID: "${u}" was not found`),Hn(g)&&this.updateImage(u,g)}}cloneImages(){const o={};for(const u in this.images){const g=this.images[u];o[u]=Object.assign(Object.assign({},g),{data:g.data?g.data.clone():null})}return o}}const Dt=1e20;function pe(w,o,u,g,v,T,M,A,O){for(let U=o;U<o+g;U++)Rt(w,u*T+U,T,v,M,A,O);for(let U=u;U<u+v;U++)Rt(w,U*T+o,1,g,M,A,O)}function Rt(w,o,u,g,v,T,M){T[0]=0,M[0]=-Dt,M[1]=Dt,v[0]=w[o];for(let A=1,O=0,U=0;A<g;A++){v[A]=w[o+A*u];const N=A*A;do{const H=T[O];U=(v[A]-v[H]+N-H*H)/(A-H)/2}while(U<=M[O]&&--O>-1);O++,T[O]=A,M[O]=U,M[O+1]=Dt}for(let A=0,O=0;A<g;A++){for(;M[O+1]<A;)O++;const U=T[O],N=A-U;w[o+A*u]=v[U]+N*N}}const ii=p.v.layout_symbol["text-font"].default.join(",");class Bt{constructor(o,u,g){this.requestManager=o,this.localIdeographFontFamily=u,this.entries={},this.lang=g}setURL(o){this.url=o}getGlyphs(o){return p._(this,void 0,void 0,function*(){const u=[];for(const T in o)for(const M of o[T])u.push(this._getAndCacheGlyphsPromise(T,M));const g=yield Promise.all(u),v={};for(const{stack:T,id:M,glyph:A}of g)v[T]||(v[T]={}),v[T][M]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics};return v})}_getAndCacheGlyphsPromise(o,u){return p._(this,void 0,void 0,function*(){let g=this.entries[o];g||(g=this.entries[o]={glyphs:{},requests:{},ranges:{}});let v=g.glyphs[u];return void 0!==v?{stack:o,id:u,glyph:v}:!this.url||this._charUsesLocalIdeographFontFamily(u)?(v=g.glyphs[u]=this._drawGlyph(g,o,u),{stack:o,id:u,glyph:v}):yield this._downloadAndCacheRangePromise(o,u)})}_downloadAndCacheRangePromise(o,u){return p._(this,void 0,void 0,function*(){const g=this.entries[o],v=Math.floor(u/256);if(g.ranges[v])return{stack:o,id:u,glyph:null};if(!g.requests[v]){const T=Bt.loadGlyphRange(o,v,this.url,this.requestManager);g.requests[v]=T}try{const T=yield g.requests[v];for(const M in T)g.glyphs[+M]=T[+M];return g.ranges[v]=!0,{stack:o,id:u,glyph:T[u]||null}}catch(T){const M=g.glyphs[u]=this._drawGlyph(g,o,u);return this._warnOnMissingGlyphRange(M,v,u,T),{stack:o,id:u,glyph:M}}})}_warnOnMissingGlyphRange(o,u,g,v){const T=256*u,M=T+255,A=g.toString(16).padStart(4,"0").toUpperCase();p.w(`Unable to load glyph range ${u}, ${T}-${M}. Rendering codepoint U+${A} locally instead. ${v}`)}_charUsesLocalIdeographFontFamily(o){return!!this.localIdeographFontFamily&&p.q(o)}_drawGlyph(o,u,g){const v=u===ii&&""!==this.localIdeographFontFamily&&this._charUsesLocalIdeographFontFamily(g),T=v?"ideographTinySDF":"tinySDF";o[T]||(o[T]=this._createTinySDF(v?this.localIdeographFontFamily:u));const M=o[T].draw(String.fromCodePoint(g));return{id:g,bitmap:new p.r({width:M.width||60,height:M.height||60},M.data),metrics:{width:M.glyphWidth/2||24,height:M.glyphHeight/2||24,left:M.glyphLeft/2+.5||0,top:M.glyphTop/2-27.5||-8,advance:M.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(o){const u=o?o.split(","):[];u.push("sans-serif");const g=u.map(v=>/[-\w]+/.test(v)?v:`'${CSS.escape(v)}'`).join(",");return new Bt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:g,fontWeight:this._fontWeight(u[0]),fontStyle:this._fontStyle(u[0]),lang:this.lang})}_fontStyle(o){return/italic/i.test(o)?"italic":/oblique/i.test(o)?"oblique":"normal"}_fontWeight(o){const u={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let g;for(const[v,T]of Object.entries(u))new RegExp(`\\b${v}\\b`,"i").test(o)&&(g=`${T}`);return g}destroy(){for(const o in this.entries){const u=this.entries[o];u.tinySDF&&(u.tinySDF=null),u.ideographTinySDF&&(u.ideographTinySDF=null),u.glyphs={},u.requests={},u.ranges={}}this.entries={}}}Bt.loadGlyphRange=function(w,o,u,g){return p._(this,void 0,void 0,function*(){const v=256*o,T=v+255,M=g.transformRequest(u.replace("{fontstack}",w).replace("{range}",`${v}-${T}`),"Glyphs"),A=yield p.n(M,new AbortController);if(!A||!A.data)throw new Error(`Could not load glyph range. range: ${o}, ${v}-${T}`);const O={};for(const U of p.o(A.data))O[U.id]=U;return O})},Bt.TinySDF=class{constructor({fontSize:w=24,buffer:o=3,radius:u=8,cutoff:g=.25,fontFamily:v="sans-serif",fontWeight:T="normal",fontStyle:M="normal",lang:A=null}={}){this.buffer=o,this.cutoff=g,this.radius=u,this.lang=A;const O=this.size=w+4*o,U=this._createCanvas(O),N=this.ctx=U.getContext("2d",{willReadFrequently:!0});N.font=`${M} ${T} ${w}px ${v}`,N.textBaseline="alphabetic",N.textAlign="left",N.fillStyle="black",this.gridOuter=new Float64Array(O*O),this.gridInner=new Float64Array(O*O),this.f=new Float64Array(O),this.z=new Float64Array(O+1),this.v=new Uint16Array(O)}_createCanvas(w){const o=document.createElement("canvas");return o.width=o.height=w,o}draw(w){const{width:o,actualBoundingBoxAscent:u,actualBoundingBoxDescent:g,actualBoundingBoxLeft:v,actualBoundingBoxRight:T}=this.ctx.measureText(w),M=Math.ceil(u),A=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(T-v))),O=Math.min(this.size-this.buffer,M+Math.ceil(g)),U=A+2*this.buffer,N=O+2*this.buffer,H=Math.max(U*N,0),q=new Uint8ClampedArray(H),te={data:q,width:U,height:N,glyphWidth:A,glyphHeight:O,glyphTop:M,glyphLeft:0,glyphAdvance:o};if(0===A||0===O)return te;const{ctx:ce,buffer:Te,gridInner:De,gridOuter:we}=this;this.lang&&(ce.lang=this.lang),ce.clearRect(Te,Te,A,O),ce.fillText(w,Te,Te+M);const Le=ce.getImageData(Te,Te,A,O);we.fill(Dt,0,H),De.fill(0,0,H);for(let je=0;je<O;je++)for(let Re=0;Re<A;Re++){const $e=Le.data[4*(je*A+Re)+3]/255;if(0===$e)continue;const Ye=(je+Te)*U+Re+Te;if(1===$e)we[Ye]=0,De[Ye]=Dt;else{const Ne=.5-$e;we[Ye]=Ne>0?Ne*Ne:0,De[Ye]=Ne<0?Ne*Ne:0}}pe(we,0,0,U,N,U,this.f,this.v,this.z),pe(De,Te,Te,A,O,U,this.f,this.v,this.z);for(let je=0;je<H;je++){const Re=Math.sqrt(we[je])-Math.sqrt(De[je]);q[je]=Math.round(255-255*(Re/this.radius+this.cutoff))}return te}};class Qn{constructor(){this.specification=p.u.light.position}possiblyEvaluate(o,u){return p.F(o.expression.evaluate(u))}interpolate(o,u,g){return{x:p.G.number(o.x,u.x,g),y:p.G.number(o.y,u.y,g),z:p.G.number(o.z,u.z,g)}}}let pt;class Nn extends p.E{constructor(o){super(),pt=pt||new p.t({anchor:new p.D(p.u.light.anchor),position:new Qn,color:new p.D(p.u.light.color),intensity:new p.D(p.u.light.intensity)}),this._transitionable=new p.x(pt,void 0),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,u={}){if(!this._validate(p.y,o,u))for(const g in o){const v=o[g];g.endsWith(p.z)?this._transitionable.setTransition(g.slice(0,-p.z.length),v):this._transitionable.setValue(g,v)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,g){return(!g||!1!==g.validate)&&p.B(this,o.call(p.C,{value:u,style:{glyphs:!0,sprite:!0},styleSpec:p.u}))}}const nt=new p.t({"sky-color":new p.D(p.u.sky["sky-color"]),"horizon-color":new p.D(p.u.sky["horizon-color"]),"fog-color":new p.D(p.u.sky["fog-color"]),"fog-ground-blend":new p.D(p.u.sky["fog-ground-blend"]),"horizon-fog-blend":new p.D(p.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new p.D(p.u.sky["sky-horizon-blend"]),"atmosphere-blend":new p.D(p.u.sky["atmosphere-blend"])});class ht extends p.E{constructor(o){super(),this._transitionable=new p.x(nt,void 0),this.setSky(o),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new p.H(0))}setSky(o,u={}){if(!this._validate(p.J,o,u)){o||(o={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const g in o){const v=o[g];g.endsWith(p.z)?this._transitionable.setTransition(g.slice(0,-p.z.length),v):this._transitionable.setValue(g,v)}}}getSky(){return this._transitionable.serialize()}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,u,g={}){return!1!==g?.validate&&p.B(this,o.call(p.C,p.e({value:u,style:{glyphs:!0,sprite:!0},styleSpec:p.u})))}calculateFogBlendOpacity(o){return o<60?0:o<70?(o-60)/10:1}}class Sn{constructor(o,u){this.width=o,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,u){const g=o.join(",")+String(u);return this.dashEntry[g]||(this.dashEntry[g]=this.addDash(o,u)),this.dashEntry[g]}getDashRanges(o,u,g){const v=[];let T=o.length%2==1?-o[o.length-1]*g:0,M=o[0]*g,A=!0;v.push({left:T,right:M,isDash:A,zeroLength:0===o[0]});let O=o[0];for(let U=1;U<o.length;U++){A=!A;const N=o[U];T=O*g,O+=N,M=O*g,v.push({left:T,right:M,isDash:A,zeroLength:0===N})}return v}addRoundDash(o,u,g){const v=u/2;for(let T=-g;T<=g;T++){const M=this.width*(this.nextRow+g+T);let A=0,O=o[A];for(let U=0;U<this.width;U++){U/O.right>1&&(O=o[++A]);const N=Math.abs(U-O.left),H=Math.abs(U-O.right),q=Math.min(N,H);let te;const ce=T/g*(v+1);if(O.isDash){const Te=v-Math.abs(ce);te=Math.sqrt(q*q+Te*Te)}else te=v-Math.sqrt(q*q+ce*ce);this.data[M+U]=Math.max(0,Math.min(255,te+128))}}}addRegularDash(o){for(let A=o.length-1;A>=0;--A){const O=o[A],U=o[A+1];O.zeroLength?o.splice(A,1):U&&U.isDash===O.isDash&&(U.left=O.left,o.splice(A,1))}const u=o[0],g=o[o.length-1];u.isDash===g.isDash&&(u.left=g.left-this.width,g.right=u.right+this.width);const v=this.width*this.nextRow;let T=0,M=o[T];for(let A=0;A<this.width;A++){A/M.right>1&&(M=o[++T]);const O=Math.abs(A-M.left),U=Math.abs(A-M.right),N=Math.min(O,U);this.data[v+A]=Math.max(0,Math.min(255,(M.isDash?N:-N)+128))}}addDash(o,u){const g=u?7:0,v=2*g+1;if(this.nextRow+v>this.height)return p.w("LineAtlas out of space"),null;let T=0;for(let A=0;A<o.length;A++)T+=o[A];if(0!==T){const A=this.width/T,O=this.getDashRanges(o,this.width,A);u?this.addRoundDash(O,A,g):this.addRegularDash(O)}const M={y:this.nextRow+g,height:2*g,width:T};return this.nextRow+=v,this.dirty=!0,M}bind(o){const u=o.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}const ln="maplibre_preloaded_worker_pool";class Wt{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<Wt.workerCount;)this.workers.push(new Worker(p.a.WORKER_URL));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],0===this.numActive()&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ln]}numActive(){return Object.keys(this.active).length}}const Pn=Math.floor(ee.hardwareConcurrency/2);let zn,Zn;function mi(){return zn||(zn=new Wt),zn}Wt.workerCount=p.K(globalThis)?Math.max(Math.min(Pn,3),1):1;class ir{constructor(o,u){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=u;const g=this.workerPool.acquire(u);for(let v=0;v<g.length;v++){const T=new p.L(g[v],u);T.name=`Worker ${v}`,this.actors.push(T)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,u){const g=[];for(const v of this.actors)g.push(v.sendAsync({type:o,data:u}));return Promise.all(g)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(o=!0){this.actors.forEach(u=>{u.remove()}),this.actors=[],o&&this.workerPool.release(this.id)}registerMessageHandler(o,u){for(const g of this.actors)g.registerMessageHandler(o,u)}unregisterMessageHandler(o){for(const u of this.actors)u.unregisterMessageHandler(o)}}function tr(){return Zn||(Zn=new ir(mi(),p.M),Zn.registerMessageHandler("GR",(w,o,u)=>p.m(o,u))),Zn}function pr(w,o){const u=p.N();return p.O(u,u,[1,1,0]),p.Q(u,u,[.5*w.width,.5*w.height,1]),w.calculatePosMatrix?p.S(u,u,w.calculatePosMatrix(o.toUnwrapped())):u}function Jr(w,o,u,g,v,T,M){var A;const O=function(q,te,ce){if(q)for(const Te of q){const De=te[Te];if(De&&De.source===ce&&"fill-extrusion"===De.type)return!0}else for(const Te in te){const De=te[Te];if(De.source===ce&&"fill-extrusion"===De.type)return!0}return!1}(null!==(A=v?.layers)&&void 0!==A?A:null,o,w.id),U=T.maxPitchScaleFactor(),N=w.tilesIn(g,U,O);N.sort(ne);const H=[];for(const q of N)H.push({wrappedTileID:q.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(o,u,w.getState(),q.queryGeometry,q.cameraQueryGeometry,q.scale,v,T,U,pr(T,q.tileID),M?(te,ce)=>M(q.tileID,te,ce):void 0)});return function(q,te){for(const ce in q)for(const Te of q[ce])kt(Te,te);return q}(function(q){const te={},ce={};for(const Te of q){const De=Te.queryResults,we=Te.wrappedTileID,Le=ce[we]=ce[we]||{};for(const je in De){const Re=De[je],$e=Le[je]=Le[je]||{},Ye=te[je]=te[je]||[];for(const Ne of Re)$e[Ne.featureIndex]||($e[Ne.featureIndex]=!0,Ye.push(Ne))}}return te}(H),w)}function ne(w,o){const u=w.tileID,g=o.tileID;return u.overscaledZ-g.overscaledZ||u.canonical.y-g.canonical.y||u.wrap-g.wrap||u.canonical.x-g.canonical.x}function kt(w,o){const u=w.feature,g=o.getFeatureState(u.layer["source-layer"],u.id);u.source=u.layer.source,u.layer["source-layer"]&&(u.sourceLayer=u.layer["source-layer"]),u.state=g}function Ct(w,o,u){return p._(this,void 0,void 0,function*(){let g=w;if(w.url?g=(yield p.j(o.transformRequest(w.url,"Source"),u)).data:yield ee.frameAsync(u),!g)return null;const v=p.U(p.e(g,w),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in g&&g.vector_layers&&(v.vectorLayerIds=g.vector_layers.map(T=>T.id)),v})}class Oe{constructor(o,u){o&&(u?this.setSouthWest(o).setNorthEast(u):Array.isArray(o)&&(4===o.length?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1])))}setNorthEast(o){return this._ne=o instanceof p.V?new p.V(o.lng,o.lat):p.V.convert(o),this}setSouthWest(o){return this._sw=o instanceof p.V?new p.V(o.lng,o.lat):p.V.convert(o),this}extend(o){const u=this._sw,g=this._ne;let v,T;if(o instanceof p.V)v=o,T=o;else{if(!(o instanceof Oe))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(Oe.convert(o)):this.extend(p.V.convert(o)):o&&("lng"in o||"lon"in o)&&"lat"in o?this.extend(p.V.convert(o)):this;if(v=o._sw,T=o._ne,!v||!T)return this}return u||g?(u.lng=Math.min(v.lng,u.lng),u.lat=Math.min(v.lat,u.lat),g.lng=Math.max(T.lng,g.lng),g.lat=Math.max(T.lat,g.lat)):(this._sw=new p.V(v.lng,v.lat),this._ne=new p.V(T.lng,T.lat)),this}getCenter(){return new p.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new p.V(this.getWest(),this.getNorth())}getSouthEast(){return new p.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:u,lat:g}=p.V.convert(o);let v=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=g&&g<=this._ne.lat&&v}intersects(o){if((o=Oe.convert(o)).getNorth()<this.getSouth()||o.getSouth()>this.getNorth())return!1;const u=p.W(this.getWest(),-180,180),g=p.W(this.getEast(),-180,180),v=p.W(o.getWest(),-180,180),T=p.W(o.getEast(),-180,180),M=u>g,A=v>T;return!(!M||!A)||(M?T>=u||v<=g:A?g>=v||u<=T:!(v>g||T<u))}static convert(o){return o instanceof Oe?o:o&&new Oe(o)}static fromLngLat(o,u=0){const g=360*u/40075017,v=g/Math.cos(Math.PI/180*o.lat);return new Oe(new p.V(o.lng-v,o.lat-g),new p.V(o.lng+v,o.lat+g))}adjustAntiMeridian(){const o=new p.V(this._sw.lng,this._sw.lat),u=new p.V(this._ne.lng,this._ne.lat);return new Oe(o,o.lng>u.lng?new p.V(u.lng+360,u.lat):u)}}class ke{constructor(o,u,g){this.bounds=Oe.convert(this.validateBounds(o)),this.minzoom=u||0,this.maxzoom=g||24}validateBounds(o){return Array.isArray(o)&&4===o.length?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const u=Math.pow(2,o.z),g=Math.floor(p.Y(this.bounds.getWest())*u),v=Math.floor(p.X(this.bounds.getNorth())*u),T=Math.ceil(p.Y(this.bounds.getEast())*u),M=Math.ceil(p.X(this.bounds.getSouth())*u);return o.x>=g&&o.x<T&&o.y>=v&&o.y<M}}class it extends p.E{constructor(o,u,g,v){if(super(),this.id=o,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.e(this,p.U(u,["url","scheme","tileSize","promoteId","encoding"])),this._options=p.e({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v)}load(){return p._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new p.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield Ct(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),o&&(p.e(this,o),o.bounds&&(this.tileBounds=new ke(o.bounds,this.minzoom,this.maxzoom)),this.fire(new p.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.l("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this._loaded=!0,this.fire(new p.k(o))}})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.abort(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return p.e({},this._options)}loadTile(o){return p._(this,void 0,void 0,function*(){const u=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g={request:this.map._requestManager.transformRequest(u,"Tile"),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(o)};g.request.collectResourceTiming=this._collectResourceTiming;let v="RT";if(o.actor&&"expired"!==o.state){if("loading"===o.state)return new Promise((T,M)=>{o.reloadPromise={resolve:T,reject:M}})}else o.actor=this.dispatcher.getActor(),v="LT";o.abortController=new AbortController;try{const T=yield o.actor.sendAsync({type:v,data:g},o.abortController);if(delete o.abortController,o.aborted)return;this._afterTileLoadWorkerResponse(o,T)}catch(T){if(delete o.abortController,o.aborted)return;if(T&&404!==T.status)throw T;this._afterTileLoadWorkerResponse(o,null)}})}_getOverzoomParameters(o){if(o.tileID.canonical.z<=this.maxzoom||void 0===this.map._zoomLevelsToOverscale)return;const u=o.tileID.scaledTo(this.maxzoom).canonical,g=u.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:u,overzoomRequest:this.map._requestManager.transformRequest(g,"Tile")}}_afterTileLoadWorkerResponse(o,u){if(u&&u.resourceTiming&&(o.resourceTiming=u.resourceTiming),u&&this.map._refreshExpiredTiles&&o.setExpiryData(u),o.loadVectorData(u,this.map.painter),o.reloadPromise){const g=o.reloadPromise;o.reloadPromise=null,this.loadTile(o).then(g.resolve).catch(g.reject)}}abortTile(o){return p._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.actor&&(yield o.actor.sendAsync({type:"AT",data:{uid:o.uid,type:this.type,source:this.id}}))})}unloadTile(o){return p._(this,void 0,void 0,function*(){o.unloadVectorData(),o.actor&&(yield o.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class jt extends p.E{constructor(o,u,g,v){super(),this.id=o,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.e({type:"raster"},u),p.e(this,p.U(u,["url","scheme","tileSize"]))}load(){return p._(this,arguments,void 0,function*(o=!1){this._loaded=!1,this.fire(new p.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const u=yield Ct(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,u&&(p.e(this,u),u.bounds&&(this.tileBounds=new ke(u.bounds,this.minzoom,this.maxzoom)),this.fire(new p.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:o})))}catch(u){this._tileJSONRequest=null,this._loaded=!0,this.fire(new p.k(u))}})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(o){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),o(),this.load(!0)}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}serialize(){return p.e({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o){return p._(this,void 0,void 0,function*(){const u=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.abortController=new AbortController;try{const g=yield xt.getImage(this.map._requestManager.transformRequest(u,"Tile"),o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(g&&g.data){this.map._refreshExpiredTiles&&(g.cacheControl||g.expires)&&o.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const v=this.map.painter.context,T=v.gl,M=g.data;o.texture=this.map.painter.getTileTexture(M.width),o.texture?o.texture.update(M,{useMipmap:!0}):(o.texture=new p.T(v,M,T.RGBA,{useMipmap:!0}),o.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST)),o.state="loaded"}}catch(g){if(delete o.abortController,o.aborted)o.state="unloaded";else if(g)throw o.state="errored",g}})}abortTile(o){return p._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController)})}unloadTile(o){return p._(this,void 0,void 0,function*(){o.texture&&this.map.painter.saveTileTexture(o.texture)})}hasTransition(){return!1}}class Ut extends jt{constructor(o,u,g,v){super(o,u,g,v),this.type="raster-dem",this.maxzoom=22,this._options=p.e({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox",this.redFactor=u.redFactor,this.greenFactor=u.greenFactor,this.blueFactor=u.blueFactor,this.baseShift=u.baseShift}loadTile(o){return p._(this,void 0,void 0,function*(){const u=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g=this.map._requestManager.transformRequest(u,"Tile");o.neighboringTiles=this._getNeighboringTiles(o.tileID),o.abortController=new AbortController;try{const v=yield xt.getImage(g,o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(v&&v.data){const T=v.data;this.map._refreshExpiredTiles&&(v.cacheControl||v.expires)&&o.setExpiryData({cacheControl:v.cacheControl,expires:v.expires});const M=p.b(T)&&p.Z()?T:yield this.readImageNow(T),A={type:this.type,uid:o.uid,source:this.id,rawImageData:M,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!o.actor||"expired"===o.state){o.actor=this.dispatcher.getActor();const O=yield o.actor.sendAsync({type:"LDT",data:A});o.dem=O,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded"}}}catch(v){if(delete o.abortController,o.aborted)o.state="unloaded";else if(v)throw o.state="errored",v}})}readImageNow(o){return p._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&p.$()){const u=o.width+2,g=o.height+2;try{return new p.R({width:u,height:g},yield p.a0(o,-1,-1,u,g))}catch{}}return ee.getImageData(o,1)})}_getNeighboringTiles(o){const u=o.canonical,g=Math.pow(2,u.z),v=(u.x-1+g)%g,T=0===u.x?o.wrap-1:o.wrap,M=(u.x+1+g)%g,A=u.x+1===g?o.wrap+1:o.wrap,O={};return O[new p.a1(o.overscaledZ,T,u.z,v,u.y).key]={backfilled:!1},O[new p.a1(o.overscaledZ,A,u.z,M,u.y).key]={backfilled:!1},u.y>0&&(O[new p.a1(o.overscaledZ,T,u.z,v,u.y-1).key]={backfilled:!1},O[new p.a1(o.overscaledZ,o.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},O[new p.a1(o.overscaledZ,A,u.z,M,u.y-1).key]={backfilled:!1}),u.y+1<g&&(O[new p.a1(o.overscaledZ,T,u.z,v,u.y+1).key]={backfilled:!1},O[new p.a1(o.overscaledZ,o.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},O[new p.a1(o.overscaledZ,A,u.z,M,u.y+1).key]={backfilled:!1}),O}unloadTile(o){return p._(this,void 0,void 0,function*(){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&(yield o.actor.sendAsync({type:"RDT",data:{type:this.type,uid:o.uid,source:this.id}}))})}}function dt(w){return"GeometryCollection"===w.type?w.geometries.map(o=>o.coordinates).flat(1/0):w.coordinates.flat(1/0)}function tn(w){const o=new Oe;let u;switch(w.type){case"FeatureCollection":u=w.features.map(g=>dt(g.geometry)).flat(1/0);break;case"Feature":u=dt(w.geometry);break;default:u=dt(w)}if(0==u.length)return o;for(let g=0;g<u.length-1;g+=2)o.extend([u[g],u[g+1]]);return o}class Cn extends p.E{constructor(o,u,g,v){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:u.data},this.actor=g.getActor(),this.setEventedParent(v),this._data="string"==typeof u.data?{url:u.data}:{geojson:u.data},this._options=p.e({},u),this._collectResourceTiming=u.collectResourceTiming,void 0!==u.maxzoom&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId,void 0!==u.clusterMaxZoom&&this.maxzoom<=u.clusterMaxZoom&&p.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${u.clusterMaxZoom}".`),this.workerOptions=p.e({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(void 0!==u.buffer?u.buffer:128),tolerance:this._pixelsToTileUnits(void 0!==u.tolerance?u.tolerance:.375),extent:p.a4,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(u.clusterMaxZoom),minPoints:Math.max(2,u.clusterMinPoints||2),extent:p.a4,radius:this._pixelsToTileUnits(u.clusterRadius||50),log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions),"string"==typeof this.promoteId&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return void 0!==this._pendingWorkerUpdate.data||void 0!==this._pendingWorkerUpdate.diff||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(o){return o*(p.a4/this.tileSize)}_getClusterMaxZoom(o){const u=o?Math.round(o):this.maxzoom-1;return Number.isInteger(o)||void 0===o||p.w(`Integer expected for option 'clusterMaxZoom': provided value "${o}" rounded to "${u}"`),u}load(){return p._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(o){this.map=o,this.load()}setData(o,u){this._data="string"==typeof o?{url:o}:{geojson:o},this._pendingWorkerUpdate={data:o};const g=this._updateWorkerData();return u?g:this}updateData(o,u){this._pendingWorkerUpdate.diff=p.a5(this._pendingWorkerUpdate.diff,o);const g=this._updateWorkerData();return u?g:this}getData(){return p._(this,void 0,void 0,function*(){const o=p.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:o})})}getBounds(){return p._(this,void 0,void 0,function*(){return tn(yield this.getData())})}setClusterOptions(o){return this.workerOptions.cluster=o.cluster,void 0!==o.clusterRadius&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(o.clusterRadius)),void 0!==o.clusterMaxZoom&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(o.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(o){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:o,source:this.id}})}getClusterChildren(o){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:o,source:this.id}})}getClusterLeaves(o,u,g){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:o,limit:u,offset:g}})}_updateWorkerData(){return p._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void p.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:o,diff:u}=this._pendingWorkerUpdate,g=p.e({type:this.type},this.workerOptions);o?("string"==typeof o?(g.request=this.map._requestManager.transformRequest(ee.resolveURL(o),"Source"),g.request.collectResourceTiming=this._collectResourceTiming):g.data=o,this._pendingWorkerUpdate.data=void 0):u&&(g.dataDiff=u,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new p.l("dataloading",{dataType:"source"}));try{const v=yield this.actor.sendAsync({type:"LD",data:g});if(this._isUpdatingWorker=!1,this._removed||v.abandoned)return void this.fire(new p.l("dataabort",{dataType:"source"}));v.applyDiff?this._applyDiff(u):this._data={geojson:v.data};let T=null;v.resourceTiming&&v.resourceTiming[this.id]&&(T=v.resourceTiming[this.id].slice(0));const M={dataType:"source"};this._collectResourceTiming&&T&&T.length>0&&p.e(M,{resourceTiming:T}),this.fire(new p.l("data",Object.assign(Object.assign({},M),{sourceDataType:"metadata"}))),this.fire(new p.l("data",Object.assign(Object.assign({},M),{sourceDataType:"content",shouldReloadTileOptions:this._getShouldReloadTileOptions(u)})))}catch(v){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new p.l("dataabort",{dataType:"source"}));this.fire(new p.k(v))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}})}_applyDiff(o){const u="string"==typeof this.promoteId?this.promoteId:void 0;this._data.url||this._data.updateable||!p.a6(this._data.geojson,u)||(this._data={updateable:p.a7(this._data.geojson,u)}),o&&this._data.updateable?p.a8(this._data.updateable,o,u):p.w("Cannot apply GeoJSONSource#updateData due to internal error")}_getShouldReloadTileOptions(o){if(this._options.cluster||!o||o.removeAll)return;const{add:u=[],update:g=[],remove:v=[]}=o||{},T=new Set([...g.map(M=>M.id),...v]);for(const M of T.values())if("number"!=typeof M&&null==this.promoteId)return void p.w(`GeoJSONSource "${this.id}": updateData is slower when using string GeoJSON feature IDs (e.g. "${M}"). Consider using promoteId or numeric IDs for better performance.`);return{nextBounds:[...g.map(M=>M.newGeometry),...u.map(M=>M.geometry)].filter(Boolean).map(M=>tn(M)),prevIds:T}}shouldReloadTile(o,{nextBounds:u,prevIds:g}){if(!o.latestFeatureIndex)return"unloaded"!==o.state;const v=o.latestFeatureIndex.loadVTLayers();for(let O=0;O<o.latestFeatureIndex.featureIndexArray.length;O++){const U=o.latestFeatureIndex.featureIndexArray.get(O),N=v[p.a9].feature(U.featureIndex),H=o.latestFeatureIndex.getId(N,p.a9);if(g.has(H))return!0}const{buffer:T,extent:M}=this.workerOptions.geojsonVtOptions,A=function({x:O,y:U,z:N},H=0){const q=p.a2((O-H)/Math.pow(2,N)),te=p.a3((U+1+H)/Math.pow(2,N)),ce=p.a2((O+1+H)/Math.pow(2,N)),Te=p.a3((U-H)/Math.pow(2,N));return new Oe([q,te],[ce,Te])}(o.tileID.canonical,T/M);for(const O of u)if(A.intersects(O))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(o){return p._(this,void 0,void 0,function*(){const u=o.actor?"RT":"LT";o.actor=this.actor;const g={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};o.abortController=new AbortController;const v=yield this.actor.sendAsync({type:u,data:g},o.abortController);delete o.abortController,o.unloadVectorData(),o.aborted||o.loadVectorData(v,this.map.painter,"RT"===u)})}abortTile(o){return p._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.aborted=!0})}unloadTile(o){return p._(this,void 0,void 0,function*(){o.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return p.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class nn extends p.E{constructor(o,u,g,v){super(),this.flippedWindingOrder=!1,this.id=o,this.dispatcher=g,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=u}load(o){return p._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new p.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const u=yield xt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,u&&u.data&&(this.image=u.data,o&&(this.coordinates=o),this._finishLoading())}catch(u){this._request=null,this._loaded=!0,this.fire(new p.k(u))}})}loaded(){return this._loaded}updateImage(o){return o.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=o.url,this.load(o.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(o){this.coordinates=o;const u=o.map(p.aa.fromLngLat);var g;return this.tileID=function(v){const T=p.ab.fromPoints(v),M=T.width(),A=T.height(),O=Math.max(M,A),U=Math.max(0,Math.floor(-Math.log(O)/Math.LN2)),N=Math.pow(2,U);return new p.ad(U,Math.floor((T.minX+T.maxX)/2*N),Math.floor((T.minY+T.maxY)/2*N))}(u),this.terrainTileRanges=this._getOverlappingTileRanges(u),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=u.map(v=>this.tileID.getTilePoint(v)._round()),this.flippedWindingOrder=((g=this.tileCoords)[1].x-g[0].x)*(g[2].y-g[0].y)-(g[1].y-g[0].y)*(g[2].x-g[0].x)<0,this.fire(new p.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const o=this.map.painter.context,u=o.gl;this.texture||(this.texture=new p.T(o,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let g=!1;for(const v in this.tiles){const T=this.tiles[v];"loaded"!==T.state&&(T.state="loaded",T.texture=this.texture,g=!0)}g&&this.fire(new p.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(o){return p._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={}):o.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(o){const{minX:u,minY:g,maxX:v,maxY:T}=p.ab.fromPoints(o),M={};for(let A=0;A<=p.ac;A++){const O=Math.pow(2,A),U=Math.floor(u*O),N=Math.floor(g*O),H=Math.floor(v*O),q=Math.floor(T*O);M[A]={minTileX:U,minTileY:N,maxTileX:H,maxTileY:q}}return M}}class mn extends nn{constructor(o,u,g,v){super(o,u,g,v),this.roundZoom=!0,this.type="video",this.options=u}load(){return p._(this,void 0,void 0,function*(){this._loaded=!1;const o=this.options;this.urls=[];for(const u of o.urls)this.urls.push(this.map._requestManager.transformRequest(u,"Source").url);try{const u=yield p.ae(this.urls);if(this._loaded=!0,!u)return;this.video=u,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(u){this.fire(new p.k(u))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const u=this.video.seekable;o<u.start(0)||o>u.end(0)?this.fire(new p.k(new p.af(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const o=this.map.painter.context,u=o.gl;this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new p.T(o,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let g=!1;for(const v in this.tiles){const T=this.tiles[v];"loaded"!==T.state&&(T.state="loaded",T.texture=this.texture,g=!0)}g&&this.fire(new p.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ji extends nn{constructor(o,u,g,v){super(o,u,g,v),u.coordinates?Array.isArray(u.coordinates)&&4===u.coordinates.length&&!u.coordinates.some(T=>!Array.isArray(T)||2!==T.length||T.some(M=>"number"!=typeof M))||this.fire(new p.k(new p.af(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.k(new p.af(`sources.${o}`,null,'missing required property "coordinates"'))),u.animate&&"boolean"!=typeof u.animate&&this.fire(new p.k(new p.af(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),u.canvas?"string"==typeof u.canvas||u.canvas instanceof HTMLCanvasElement||this.fire(new p.k(new p.af(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.k(new p.af(`sources.${o}`,null,'missing required property "canvas"'))),this.options=u,this.animate=void 0===u.animate||u.animate}load(){return p._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const u=this.map.painter.context,g=u.gl;this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.T(u,this.canvas,g.RGBA,{premultiply:!0});let v=!1;for(const T in this.tiles){const M=this.tiles[T];"loaded"!==M.state&&(M.state="loaded",M.texture=this.texture,v=!0)}v&&this.fire(new p.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const bi={},Hr=w=>{switch(w){case"geojson":return Cn;case"image":return nn;case"raster":return jt;case"raster-dem":return Ut;case"vector":return it;case"video":return mn;case"canvas":return ji}return bi[w]},ur="RTLPluginLoaded";class Mo extends p.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=tr()}_syncState(o){return this.status=o,this.dispatcher.broadcast("SRPS",{pluginStatus:o,pluginURL:this.url}).catch(u=>{throw this.status="error",u})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(o){return p._(this,arguments,void 0,function*(u,g=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ee.resolveURL(u),!this.url)throw new Error(`requested url ${u} is invalid`);if("unavailable"===this.status){if(!g)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if("requested"===this.status)return this._requestImport()})}_requestImport(){return p._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new p.l(ur))})}lazyLoad(){"unavailable"===this.status?this.status="requested":"deferred"===this.status&&this._requestImport()}}let is=null;function qi(){return is||(is=new Mo),is}var Sr,He,w;(w=Sr||(Sr={}))[w.Base=0]="Base",w[w.Parent=1]="Parent",function(w){w[w.Departing=0]="Departing",w[w.Incoming=1]="Incoming"}(He||(He={}));class ie{constructor(o,u){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=o,this.uid=p.ag(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(o){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(o||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:o,fadingDirection:u,fadingParentID:g,fadeEndTime:v}){this.resetFadeLogic(),this.fadingRole=o,this.fadingDirection=u,this.fadingParentID=g,this.fadeEndTime=v}setSelfFadeLogic(o){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=o}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=ue(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(o,u,g){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData,this.latestFeatureIndex.encoding=o.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(v,T){const M={};if(!T)return M;for(const A of v){const O=A.layerIds.map(U=>T.getLayer(U)).filter(Boolean);if(0!==O.length){A.layers=O,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map(U=>O.filter(N=>N.id===U)[0]));for(const U of O)M[U.id]=A}}return M}(o.buckets,u?.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const T=this.buckets[v];if(T instanceof p.ai){if(this.hasSymbolBuckets=!0,!g)break;T.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const T=this.buckets[v];if(T instanceof p.ai&&T.hasRTLText){this.hasRTLText=!0,qi().lazyLoad();break}}this.queryPadding=0;for(const v in this.buckets){const T=this.buckets[v];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(v).queryRadius(T))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),this.dashPositions=o.dashPositions}else this.collisionBoxArray=new p.ah}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const g in this.buckets){const v=this.buckets[g];v.uploadPending()&&v.upload(o)}const u=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new p.T(o,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new p.T(o,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,u,g,v,T,M,A,O,U,N,H){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:v,cameraQueryGeometry:T,scale:M,tileSize:this.tileSize,pixelPosMatrix:N,transform:O,params:A,queryPadding:this.queryPadding*U,getElevation:H},o,u,g):{}}querySourceFeatures(o,u){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const v=g.loadVTLayers(),T=u&&u.sourceLayer?u.sourceLayer:"",M=v[p.a9]||v[T];if(!M)return;const A=p.aj(u?.filter,u?.globalState),{z:O,x:U,y:N}=this.tileID.canonical,H={z:O,x:U,y:N};for(let q=0;q<M.length;q++){const te=M.feature(q);if(A.needGeometry){const De=p.ak(te,!0);if(!A.filter(new p.H(this.tileID.overscaledZ),De,this.tileID.canonical))continue}else if(!A.filter(new p.H(this.tileID.overscaledZ),te))continue;const ce=g.getId(te,T),Te=new p.al(te,O,U,N,ce);Te.tile=H,o.push(Te)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const u=this.expirationTime;if(o.cacheControl){const g=p.am(o.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const g=Date.now();let v=!1;if(this.expirationTime>g)v=!1;else if(u)if(this.expirationTime<u)v=!0;else{const T=this.expirationTime-u;T?this.expirationTime=g+Math.max(T,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(o,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(o).length)return;const g=this.latestFeatureIndex.loadVTLayers();for(const v in this.buckets){if(!u.style.hasLayer(v))continue;const T=this.buckets[v],M=T.layers[0].sourceLayer||p.a9,A=g[M],O=o[M];if(!A||!O||0===Object.keys(O).length)continue;T.update(O,A,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const U=u&&u.style&&u.style.getLayer(v);U&&(this.queryPadding=Math.max(this.queryPadding,U.queryRadius(T)))}}holdingForSymbolFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ue()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(o){this.symbolFadeHoldUntil=ue()+o}setDependencies(o,u){const g={};for(const v of u)g[v]=!0;this.dependencies[o]=g}hasDependency(o,u){for(const g of o){const v=this.dependencies[g];if(v)for(const T of u)if(v[T])return!0}return!1}}class oe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,u,g){const v=String(u);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][v]=this.stateChanges[o][v]||{},p.e(this.stateChanges[o][v],g),null===this.deletedStates[o]){this.deletedStates[o]={};for(const T in this.state[o])T!==v&&(this.deletedStates[o][T]=null)}else if(this.deletedStates[o]&&null===this.deletedStates[o][v]){this.deletedStates[o][v]={};for(const T in this.state[o][v])g[T]||(this.deletedStates[o][v][T]=null)}else for(const T in g)this.deletedStates[o]&&this.deletedStates[o][v]&&null===this.deletedStates[o][v][T]&&delete this.deletedStates[o][v][T]}removeFeatureState(o,u,g){if(null===this.deletedStates[o])return;const v=String(u);if(this.deletedStates[o]=this.deletedStates[o]||{},g&&void 0!==u)null!==this.deletedStates[o][v]&&(this.deletedStates[o][v]=this.deletedStates[o][v]||{},this.deletedStates[o][v][g]=null);else if(void 0!==u)if(this.stateChanges[o]&&this.stateChanges[o][v])for(g in this.deletedStates[o][v]={},this.stateChanges[o][v])this.deletedStates[o][v][g]=null;else this.deletedStates[o][v]=null;else this.deletedStates[o]=null}getState(o,u){const g=String(u),v=p.e({},(this.state[o]||{})[g],(this.stateChanges[o]||{})[g]);if(null===this.deletedStates[o])return{};if(this.deletedStates[o]){const T=this.deletedStates[o][u];if(null===T)return{};for(const M in T)delete v[M]}return v}initializeTileState(o,u){o.setFeatureState(this.state,u)}coalesceChanges(o,u){const g={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const T={};for(const M in this.stateChanges[v])this.state[v][M]||(this.state[v][M]={}),p.e(this.state[v][M],this.stateChanges[v][M]),T[M]=this.state[v][M];g[v]=T}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const T={};if(null===this.deletedStates[v])for(const M in this.state[v])T[M]={},this.state[v][M]={};else for(const M in this.deletedStates[v]){if(null===this.deletedStates[v][M])this.state[v][M]={};else for(const A of Object.keys(this.deletedStates[v][M]))delete this.state[v][M][A];T[M]=this.state[v][M]}g[v]=g[v]||{},p.e(g[v],T)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(g).length)for(const v in o)o[v].setFeatureState(g,u)}}const ge=89.25;function Fe(w,o){const u=p.an(o.lat,-p.ao,p.ao);return new p.P(p.Y(o.lng)*w,p.X(u)*w)}function Ve(w,o){return new p.aa(o.x/w,o.y/w).toLngLat()}function rt(w){return w.cameraToCenterDistance*Math.min(.85*Math.tan(p.ap(90-w.pitch)),Math.tan(p.ap(ge-w.pitch)))}function xe(w,o){const u=w.canonical,g=o/p.aq(u.z),v=u.x+Math.pow(2,u.z)*w.wrap,T=p.ar(new Float64Array(16));return p.O(T,T,[v*g,u.y*g,0]),p.Q(T,T,[g/p.a4,g/p.a4,1]),T}function Ke(w,o,u,g,v){const T=p.aa.fromLngLat(w,o),M=v*p.as(1,w.lat),A=M*Math.cos(p.ap(u)),O=Math.sqrt(M*M-A*A),U=O*Math.sin(p.ap(-g)),N=O*Math.cos(p.ap(-g));return new p.aa(T.x+U,T.y+N,T.z+A)}function yt(w,o,u){const g=o.intersectsFrustum(w);if(!u||0===g)return g;const v=o.intersectsPlane(u);return 0===v?0:2===g&&2===v?2:1}function bt(w,o,u){let g=0;const v=(u-o)/10;for(let T=0;T<10;T++)g+=v*Math.pow(Math.cos(o+(T+.5)/10*(u-o)),w);return g}function Tt(w,o){return function(u,g,v,T,M){const A=2*((w-1)/p.at(Math.cos(p.ap(ge-M))/Math.cos(p.ap(ge)))-1),O=Math.acos(v/T),U=2*bt(A-1,0,p.ap(M/2)),N=Math.min(p.ap(ge),O+p.ap(M/2)),H=bt(A-1,Math.min(N,O-p.ap(M/2)),N),q=Math.atan(g/v),te=Math.hypot(g,v);let ce=u;return ce+=p.at(T/te/Math.max(.5,Math.cos(p.ap(M/2)))),ce+=A*p.at(Math.cos(q))/2,ce-=p.at(Math.max(1,H/U/o))/2,ce}}const vn=Tt(9.314,3);function Bn(w,o){const u=(o.roundZoom?Math.round:Math.floor)(w.zoom+p.at(w.tileSize/o.tileSize));return Math.max(0,u)}function ri(w,o){const u=w.getCameraFrustum(),g=w.getClippingPlane(),v=w.screenPointToMercatorCoordinate(w.getCameraPoint()),T=p.aa.fromLngLat(w.center,w.elevation);v.z=T.z+Math.cos(w.pitchInRadians)*w.cameraToCenterDistance/w.worldSize;const M=w.getCoveringTilesDetailsProvider(),A=M.allowVariableZoom(w,o),O=Bn(w,o),U=o.minzoom||0,N=void 0!==o.maxzoom?o.maxzoom:w.maxZoom,H=Math.min(Math.max(0,O),N),q=Math.pow(2,H),te=[q*v.x,q*v.y,0],ce=[q*T.x,q*T.y,0],Te=Math.hypot(T.x-v.x,T.y-v.y),De=Math.abs(T.z-v.z),we=Math.hypot(Te,De),Le=$e=>({zoom:0,x:0,y:0,wrap:$e,fullyVisible:!1}),je=[],Re=[];if(w.renderWorldCopies&&M.allowWorldCopies())for(let $e=1;$e<=3;$e++)je.push(Le(-$e)),je.push(Le($e));for(je.push(Le(0));je.length>0;){const $e=je.pop(),Ye=$e.x,Ne=$e.y;let Qe=$e.fullyVisible;const gt={x:Ye,y:Ne,z:$e.zoom},lt=M.getTileBoundingVolume(gt,$e.wrap,w.elevation,o);if(!Qe){const $t=yt(u,lt,g);if(0===$t)continue;Qe=2===$t}const ft=M.distanceToTile2d(v.x,v.y,gt,lt);let _t=O;A&&(_t=(o.calculateTileZoom||vn)(w.zoom+p.at(w.tileSize/o.tileSize),ft,De,we,w.fov)),_t=(o.roundZoom?Math.round:Math.floor)(_t),_t=Math.max(0,_t);const Ht=Math.min(_t,N);if($e.wrap=M.getWrap(T,gt,$e.wrap),$e.zoom>=Ht){if($e.zoom<U)continue;const $t=H-$e.zoom,Ft=te[0]-.5-(Ye<<$t),Tn=te[1]-.5-(Ne<<$t),yi=o.reparseOverscaled?Math.max($e.zoom,_t):$e.zoom;Re.push({tileID:new p.a1($e.zoom===N?yi:$e.zoom,$e.wrap,$e.zoom,Ye,Ne),distanceSq:p.au([ce[0]-.5-Ye,ce[1]-.5-Ne]),tileDistanceToCamera:Math.sqrt(Ft*Ft+Tn*Tn)})}else for(let $t=0;$t<4;$t++)je.push({zoom:$e.zoom+1,x:(Ye<<1)+$t%2,y:(Ne<<1)+($t>>1),wrap:$e.wrap,fullyVisible:Qe})}return Re.sort(($e,Ye)=>$e.distanceSq-Ye.distanceSq).map($e=>$e.tileID)}const hr=p.ab.fromPoints([new p.P(0,0),new p.P(p.a4,p.a4)]);class Ei extends p.E{constructor(o,u,g){super(),this.id=o,this.dispatcher=g,this.on("data",v=>this._dataHandler(v)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((v,T,M,A)=>{const O=new(Hr(T.type))(v,T,M,A);if(O.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${O.id}`);return O})(o,u,g,this),this._tiles={},this._cache=new p.av(0,v=>this._unloadTile(v)),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new oe,this._didEmitContent=!1,this._updated=!1}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._maxTileCacheZoomLevels=o?o._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(void 0===this.used&&void 0===this.usedForTerrain||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const o in this._tiles){const u=this._tiles[o];if("loaded"!==u.state&&"errored"!==u.state)return!1}return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,u,g){return p._(this,void 0,void 0,function*(){try{yield this._source.loadTile(o),this._tileLoaded(o,u,g)}catch(v){o.state="errored",404!==v.status?this._source.fire(new p.k(v,{tile:o})):this.update(this.transform,this.terrain)}})}_unloadTile(o){this._source.unloadTile&&this._source.unloadTile(o)}_abortTile(o){this._source.abortTile&&this._source.abortTile(o),this._source.fire(new p.l("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const g=this._tiles[u];g.upload(o),g.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort($i).map(o=>o.key)}getRenderableIds(o){const u=[];for(const g in this._tiles)this._isIdRenderable(g,o)&&u.push(this._tiles[g]);return o?u.sort((g,v)=>{const T=g.tileID,M=v.tileID,A=new p.P(T.canonical.x,T.canonical.y)._rotate(-this.transform.bearingInRadians),O=new p.P(M.canonical.x,M.canonical.y)._rotate(-this.transform.bearingInRadians);return T.overscaledZ-M.overscaledZ||O.y-A.y||O.x-A.x}).map(g=>g.tileID.key):u.map(g=>g.tileID).sort($i).map(g=>g.key)}hasRenderableParent(o){const u=o.overscaledZ-1;if(u>=this._source.minzoom){const g=this.getLoadedTile(o.scaledTo(u));if(g)return this._isIdRenderable(g.tileID.key)}return!1}_isIdRenderable(o,u=!1){var g;return null===(g=this._tiles[o])||void 0===g?void 0:g.isRenderable(u)}reload(o,u=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const g in this._tiles)u&&this._source.shouldReloadTile&&!this._source.shouldReloadTile(this._tiles[g],u)||(o?this._reloadTile(g,"expired"):"errored"!==this._tiles[g].state&&this._reloadTile(g,"reloading"))}}_reloadTile(o,u){return p._(this,void 0,void 0,function*(){const g=this._tiles[o];g&&("loading"!==g.state&&(g.state=u),yield this._loadTile(g,o,u))})}_tileLoaded(o,u,g){o.timeAdded=ue(),o.selfFading&&(o.fadeEndTime=o.timeAdded+this._rasterFadeDuration),"expired"===g&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(u,o),"raster-dem"===this.getSource().type&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new p.l("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const u=this.getRenderableIds();for(let v=0;v<u.length;v++){const T=u[v];if(o.neighboringTiles&&o.neighboringTiles[T]){const M=this.getTileByID(T);g(o,M),g(M,o)}}function g(v,T){v.needsHillshadePrepare=!0,v.needsTerrainPrepare=!0;let M=T.tileID.canonical.x-v.tileID.canonical.x;const A=T.tileID.canonical.y-v.tileID.canonical.y,O=Math.pow(2,v.tileID.canonical.z),U=T.tileID.key;0===M&&0===A||Math.abs(A)>1||(Math.abs(M)>1&&(1===Math.abs(M+O)?M+=O:1===Math.abs(M-O)&&(M-=O)),T.dem&&v.dem&&(v.dem.backfillBorder(T.dem,M,A),v.neighboringTiles&&v.neighboringTiles[U]&&(v.neighboringTiles[U].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,u){const g=this._getLoadedDescendents(u),v=new Set;for(const T of u){const M=g[T.key];if(!M?.length){v.add(T);continue}const A=T.overscaledZ+Ei.maxOverzooming,O=M.filter(H=>H.tileID.overscaledZ<=A);if(!O.length){v.add(T);continue}const U=Math.min(...O.map(H=>H.tileID.overscaledZ)),N=O.filter(H=>H.tileID.overscaledZ===U).map(H=>H.tileID);for(const H of N)o[H.key]=H;this._areDescendentsComplete(N,U,T.overscaledZ)||v.add(T)}return v}_getLoadedDescendents(o){var u;const g={};for(const v in this._tiles){const T=this._tiles[v];if(T.hasData())for(const M of o)T.tileID.isChildOf(M)&&(g[u=M.key]||(g[u]=[])).push(T)}return g}_areDescendentsComplete(o,u,g){return 1===o.length&&o[0].isOverscaled()?o[0].overscaledZ===u:Math.pow(4,u-g)===o.length}getLoadedTile(o){const u=this._tiles[o.key];return u?.hasData()?u:null}updateCacheSize(o){const u=Math.ceil(o.width/this._source.tileSize)+1,g=Math.ceil(o.height/this._source.tileSize)+1,v=Math.floor(u*g*(null===this._maxTileCacheZoomLevels?p.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),T="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(T)}handleWrapJump(o){const u=Math.round((o-(void 0===this._prevLng?o:this._prevLng))/360);if(this._prevLng=o,u){const g={};for(const v in this._tiles){const T=this._tiles[v];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+u),g[T.tileID.key]=T}this._tiles=g,this._resetTileReloadTimers()}}update(o,u){if(!this._sourceLoaded||this._paused)return;let g;this.transform=o,this.terrain=u,this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?g=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(O=>new p.a1(O.canonical.z,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y)):(g=ri(o,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:"vector"===this._source.type&&void 0!==this.map._zoomLevelsToOverscale?o.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:u,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(g=g.filter(O=>this._source.hasTile(O)))):g=[],this.usedForTerrain&&(g=this._addTerrainIdealTiles(g));const v=0===g.length&&!this._updated&&this._didEmitContent;this._updated=!0,v&&this.fire(new p.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const T=Bn(o,this._source),M=this._updateRetainedTiles(g,T),A=mr(this._source.type);A&&this._rasterFadeDuration>0&&!u&&this._updateFadingTiles(g,M),A?this._cleanUpRasterTiles(M):this._cleanUpVectorTiles(M)}_cleanUpRasterTiles(o){for(const u in this._tiles)o[u]||this._removeTile(u)}_cleanUpVectorTiles(o){for(const u in this._tiles){const g=this._tiles[u];o[u]?g.clearSymbolFadeHold():g.hasSymbolBuckets?g.holdingForSymbolFade()?g.symbolFadeFinished()&&this._removeTile(u):g.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(u)}}_addTerrainIdealTiles(o){const u=[];for(const g of o)if(g.canonical.z>this._source.minzoom){const v=g.scaledTo(g.canonical.z-1);u.push(v);const T=g.scaledTo(Math.max(this._source.minzoom,Math.min(g.canonical.z,5)));u.push(T)}return o.concat(u)}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForSymbolFade()&&this._removeTile(o)}_updateRetainedTiles(o,u){var g;const v=new Set;for(const U of o)this._addTile(U).hasData()||v.add(U);const T=o.reduce((U,N)=>(U[N.key]=N,U),{}),M=this._retainLoadedChildren(T,v),A={},O=Math.max(u-Ei.maxUnderzooming,this._source.minzoom);for(const U of M){let N=this._tiles[U.key],H=N?.wasRequested();for(let q=U.overscaledZ-1;q>=O;--q){const te=U.scaledTo(q);if(A[te.key])break;if(A[te.key]=!0,N=this.getTile(te),!N&&H&&(N=this._addTile(te)),N){const ce=N.hasData();if((ce||!(null!==(g=this.map)&&void 0!==g&&g.cancelPendingTileRequestsWhileZooming)||H)&&(T[te.key]=te),H=N.wasRequested(),ce)break}}}return T}_updateFadingTiles(o,u){const g=ue(),v=p.aw(o);for(const T of o){const M=this._tiles[T.key];M.fadingDirection!==He.Departing&&0!==M.fadeOpacity||M.resetFadeLogic(),this._updateFadingAncestor(M,u,g)||this._updateFadingDescendents(M,u,g)||this._updateFadingEdge(M,v,g)||M.resetFadeLogic()}}_updateFadingAncestor(o,u,g){if(!o.hasData())return!1;const{tileID:v,fadingRole:T,fadingDirection:M,fadingParentID:A}=o;if(T===Sr.Base&&M===He.Incoming&&A)return u[A.key]=A,!0;const O=Math.max(v.overscaledZ-this._maxFadingAncestorLevels,this._source.minzoom);for(let U=v.overscaledZ-1;U>=O;U--){const N=v.scaledTo(U),H=this.getLoadedTile(N);if(H)return o.setCrossFadeLogic({fadingRole:Sr.Base,fadingDirection:He.Incoming,fadingParentID:H.tileID,fadeEndTime:g+this._rasterFadeDuration}),H.setCrossFadeLogic({fadingRole:Sr.Parent,fadingDirection:He.Departing,fadeEndTime:g+this._rasterFadeDuration}),u[N.key]=N,!0}return!1}_updateFadingDescendents(o,u,g){if(!o.hasData())return!1;const v=o.tileID.children(this._source.maxzoom);let T=this._updateFadingChildren(o,v,u,g);if(T)return!0;for(const M of v){const A=M.children(this._source.maxzoom);this._updateFadingChildren(o,A,u,g)&&(T=!0)}return T}_updateFadingChildren(o,u,g,v){if(u[0].overscaledZ>=this._source.maxzoom)return!1;let T=!1;for(const M of u){const A=this.getLoadedTile(M);if(!A)continue;const{fadingRole:O,fadingDirection:U,fadingParentID:N}=A;O===Sr.Base&&U===He.Departing&&N||(A.setCrossFadeLogic({fadingRole:Sr.Base,fadingDirection:He.Departing,fadingParentID:o.tileID,fadeEndTime:v+this._rasterFadeDuration}),o.setCrossFadeLogic({fadingRole:Sr.Parent,fadingDirection:He.Incoming,fadeEndTime:v+this._rasterFadeDuration})),g[M.key]=M,T=!0}return T}_updateFadingEdge(o,u,g){const v=o.tileID;return!!o.selfFading||!o.hasData()&&!!u.has(v)&&(o.setSelfFadeLogic(g+this._rasterFadeDuration),!0)}_addTile(o){let u=this._tiles[o.key];if(u)return u;u=this._cache.getAndRemove(o),u&&(u.resetFadeLogic(),this._setTileReloadTimer(o.key,u),u.tileID=o,this._state.initializeTileState(u,this.map?this.map.painter:null));const g=u;return u||(u=new ie(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(u,o.key,u.state)),u.uses++,this._tiles[o.key]=u,g||this._source.fire(new p.l("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(o,u){this._clearTileReloadTimer(o);const g=u.getExpiryTimeout();g&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},g))}_clearTileReloadTimer(o){const u=this._timers[o];u&&(clearTimeout(u),delete this._timers[o])}_resetTileReloadTimers(){for(const o in this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(const o in this._tiles)this._setTileReloadTimer(o,this._tiles[o])}refreshTiles(o){for(const u in this._tiles)(this._isIdRenderable(u)||"errored"==this._tiles[u].state)&&o.some(g=>g.equals(this._tiles[u].tileID.canonical))&&this._reloadTile(u,"expired")}_removeTile(o){const u=this._tiles[o];u&&(u.uses--,delete this._tiles[o],this._clearTileReloadTimer(o),u.uses>0||(u.hasData()&&"reloading"!==u.state?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}_dataHandler(o){"source"===o.dataType&&("metadata"!==o.sourceDataType?"content"===o.sourceDataType&&this._sourceLoaded&&!this._paused&&(this.reload(o.sourceDataChanged,o.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,u,g){const v=[],T=this.transform;if(!T)return v;const M=T.getCoveringTilesDetailsProvider().allowWorldCopies(),A=g?T.getCameraQueryGeometry(o):o,O=te=>T.screenPointToMercatorCoordinate(te,this.terrain),U=this.transformBbox(o,O,!M),N=this.transformBbox(A,O,!M),H=this.getIds(),q=p.ab.fromPoints(N);for(let te=0;te<H.length;te++){const ce=this._tiles[H[te]];if(ce.holdingForSymbolFade())continue;const Te=M?[ce.tileID]:[ce.tileID.unwrapTo(-1),ce.tileID.unwrapTo(0)],De=Math.pow(2,T.zoom-ce.tileID.overscaledZ),we=u*ce.queryPadding*p.a4/ce.tileSize/De;for(const Le of Te){const je=q.map(Re=>Le.getTilePoint(new p.aa(Re.x,Re.y)));if(je.expandBy(we),je.intersects(hr)){const Re=U.map(Ye=>Le.getTilePoint(Ye)),$e=N.map(Ye=>Le.getTilePoint(Ye));v.push({tile:ce,tileID:M?Le:Le.unwrapTo(0),queryGeometry:Re,cameraQueryGeometry:$e,scale:De})}}}return v}transformBbox(o,u,g){let v=o.map(u);if(g){const T=p.ab.fromPoints(o);T.shrinkBy(.001*Math.min(T.width(),T.height()));const M=T.map(u);p.ab.fromPoints(v).covers(M)||(v=v.map(A=>A.x>.5?new p.aa(A.x-1,A.y,A.z):A))}return v}getVisibleCoordinates(o){const u=this.getRenderableIds(o).map(g=>this._tiles[g].tileID);return this.transform&&this.transform.populateCache(u),u}hasTransition(){if(this._source.hasTransition())return!0;if(mr(this._source.type)&&this._rasterFadeDuration>0){const o=ue();for(const u in this._tiles)if(this._tiles[u].fadeEndTime>=o)return!0}return!1}setRasterFadeDuration(o){this._rasterFadeDuration=o}setFeatureState(o,u,g){this._state.updateState(o=o||p.a9,u,g)}removeFeatureState(o,u,g){this._state.removeFeatureState(o=o||p.a9,u,g)}getFeatureState(o,u){return this._state.getState(o=o||p.a9,u)}setDependencies(o,u,g){const v=this._tiles[o];v&&v.setDependencies(u,g)}reloadTilesForDependencies(o,u){for(const g in this._tiles)this._tiles[g].hasDependency(o,u)&&this._reloadTile(g,"reloading");this._cache.filter(g=>!g.hasDependency(o,u))}}function $i(w,o){const u=Math.abs(2*w.wrap)-+(w.wrap<0),g=Math.abs(2*o.wrap)-+(o.wrap<0);return w.overscaledZ-o.overscaledZ||g-u||o.canonical.y-w.canonical.y||o.canonical.x-w.canonical.x}function mr(w){return"raster"===w||"image"===w||"video"===w}Ei.maxUnderzooming=10,Ei.maxOverzooming=3;class Gt{constructor(o,u){this.reset(o,u)}reset(o,u){this.points=o||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(1===this.points.length)return this.points[0];o=p.an(o,0,1);let u=1,g=this._distances[u];const v=o*this.paddedLength+this.padding;for(;g<v&&u<this._distances.length;)g=this._distances[++u];const T=u-1,M=this._distances[T],A=g-M,O=A>0?(v-M)/A:0;return this.points[T].mult(1-O).add(this.points[u].mult(O))}}function Ci(w,o){let u=!0;return"always"===w||"never"!==w&&"never"!==o||(u=!1),u}class gn{constructor(o,u,g){const v=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(o/g),this.yCellCount=Math.ceil(u/g);for(let M=0;M<this.xCellCount*this.yCellCount;M++)v.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=u,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,u,g,v,T){this._forEachCell(u,g,v,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(T)}insertCircle(o,u,g,v){this._forEachCell(u-v,g-v,u+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(u),this.circles.push(g),this.circles.push(v)}_insertBoxCell(o,u,g,v,T,M){this.boxCells[T].push(M)}_insertCircleCell(o,u,g,v,T,M){this.circleCells[T].push(M)}_query(o,u,g,v,T,M,A){if(g<0||o>this.width||v<0||u>this.height)return[];const O=[];if(o<=0&&u<=0&&this.width<=g&&this.height<=v){if(T)return[{key:null,x1:o,y1:u,x2:g,y2:v}];for(let U=0;U<this.boxKeys.length;U++)O.push({key:this.boxKeys[U],x1:this.bboxes[4*U],y1:this.bboxes[4*U+1],x2:this.bboxes[4*U+2],y2:this.bboxes[4*U+3]});for(let U=0;U<this.circleKeys.length;U++){const N=this.circles[3*U],H=this.circles[3*U+1],q=this.circles[3*U+2];O.push({key:this.circleKeys[U],x1:N-q,y1:H-q,x2:N+q,y2:H+q})}}else this._forEachCell(o,u,g,v,this._queryCell,O,{hitTest:T,overlapMode:M,seenUids:{box:{},circle:{}}},A);return O}query(o,u,g,v){return this._query(o,u,g,v,!1,null)}hitTest(o,u,g,v,T,M){return this._query(o,u,g,v,!0,T,M).length>0}hitTestCircle(o,u,g,v,T){const M=o-g,A=o+g,O=u-g,U=u+g;if(A<0||M>this.width||U<0||O>this.height)return!1;const N=[];return this._forEachCell(M,O,A,U,this._queryCellCircle,N,{hitTest:!0,overlapMode:v,circle:{x:o,y:u,radius:g},seenUids:{box:{},circle:{}}},T),N.length>0}_queryCell(o,u,g,v,T,M,A,O){const{seenUids:U,hitTest:N,overlapMode:H}=A,q=this.boxCells[T];if(null!==q){const ce=this.bboxes;for(const Te of q)if(!U.box[Te]){U.box[Te]=!0;const De=4*Te,we=this.boxKeys[Te];if(o<=ce[De+2]&&u<=ce[De+3]&&g>=ce[De+0]&&v>=ce[De+1]&&(!O||O(we))&&(!N||!Ci(H,we.overlapMode))&&(M.push({key:we,x1:ce[De],y1:ce[De+1],x2:ce[De+2],y2:ce[De+3]}),N))return!0}}const te=this.circleCells[T];if(null!==te){const ce=this.circles;for(const Te of te)if(!U.circle[Te]){U.circle[Te]=!0;const De=3*Te,we=this.circleKeys[Te];if(this._circleAndRectCollide(ce[De],ce[De+1],ce[De+2],o,u,g,v)&&(!O||O(we))&&(!N||!Ci(H,we.overlapMode))){const Le=ce[De],je=ce[De+1],Re=ce[De+2];if(M.push({key:we,x1:Le-Re,y1:je-Re,x2:Le+Re,y2:je+Re}),N)return!0}}}return!1}_queryCellCircle(o,u,g,v,T,M,A,O){const{circle:U,seenUids:N,overlapMode:H}=A,q=this.boxCells[T];if(null!==q){const ce=this.bboxes;for(const Te of q)if(!N.box[Te]){N.box[Te]=!0;const De=4*Te,we=this.boxKeys[Te];if(this._circleAndRectCollide(U.x,U.y,U.radius,ce[De+0],ce[De+1],ce[De+2],ce[De+3])&&(!O||O(we))&&!Ci(H,we.overlapMode))return M.push(!0),!0}}const te=this.circleCells[T];if(null!==te){const ce=this.circles;for(const Te of te)if(!N.circle[Te]){N.circle[Te]=!0;const De=3*Te,we=this.circleKeys[Te];if(this._circlesCollide(ce[De],ce[De+1],ce[De+2],U.x,U.y,U.radius)&&(!O||O(we))&&!Ci(H,we.overlapMode))return M.push(!0),!0}}}_forEachCell(o,u,g,v,T,M,A,O){const U=this._convertToXCellCoord(o),N=this._convertToYCellCoord(u),H=this._convertToXCellCoord(g),q=this._convertToYCellCoord(v);for(let te=U;te<=H;te++)for(let ce=N;ce<=q;ce++)if(T.call(this,o,u,g,v,this.xCellCount*ce+te,M,A,O))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,u,g,v,T,M){const A=v-o,O=T-u,U=g+M;return U*U>A*A+O*O}_circleAndRectCollide(o,u,g,v,T,M,A){const O=(M-v)/2,U=Math.abs(o-(v+O));if(U>O+g)return!1;const N=(A-T)/2,H=Math.abs(u-(T+N));if(H>N+g)return!1;if(U<=O||H<=N)return!0;const q=U-O,te=H-N;return q*q+te*te<=g*g}}function Zr(w,o,u){const g=p.N();if(!w){const{vecSouth:H,vecEast:q}=qt(o),te=he();te[0]=q[0],te[1]=q[1],te[2]=H[0],te[3]=H[1],v=te,(N=(M=(T=te)[0])*(U=T[3])-(O=T[2])*(A=T[1]))&&(v[0]=U*(N=1/N),v[1]=-A*N,v[2]=-O*N,v[3]=M*N),g[0]=te[0],g[1]=te[1],g[4]=te[2],g[5]=te[3]}var v,T,M,A,O,U,N;return p.Q(g,g,[1/u,1/u,1]),g}function di(w,o,u,g){if(w){const v=p.N();if(!o){const{vecSouth:T,vecEast:M}=qt(u);v[0]=M[0],v[1]=M[1],v[4]=T[0],v[5]=T[1]}return p.Q(v,v,[g,g,1]),v}return u.pixelsToClipSpaceMatrix}function qt(w){const o=Math.cos(w.rollInRadians),u=Math.sin(w.rollInRadians),g=Math.cos(w.pitchInRadians),v=Math.cos(w.bearingInRadians),T=Math.sin(w.bearingInRadians),M=p.aB();M[0]=-v*g*u-T*o,M[1]=-T*g*u+v*o;const A=p.aC(M);A<1e-9?p.aD(M):p.aE(M,M,1/A);const O=p.aB();O[0]=v*g*o-T*u,O[1]=T*g*o+v*u;const U=p.aC(O);return U<1e-9?p.aD(O):p.aE(O,O,1/U),{vecEast:O,vecSouth:M}}function Mn(w,o,u,g){let v;g?(v=[w,o,g(w,o),1],p.aG(v,v,u)):(v=[w,o,0,1],Sl(v,v,u));const T=v[3];return{point:new p.P(v[0]/T,v[1]/T),signedDistanceFromCamera:T,isOccluded:!1}}function Un(w,o){return.5+w/o*.5}function rs(w,o){return w.x>=-o[0]&&w.x<=o[0]&&w.y>=-o[1]&&w.y<=o[1]}function Ir(w,o,u,g,v,T,M,A,O,U,N,H,q){const te=u?w.textSizeData:w.iconSizeData,ce=p.ax(te,o.transform.zoom),Te=[256/o.width*2+1,256/o.height*2+1],De=u?w.text.dynamicLayoutVertexArray:w.icon.dynamicLayoutVertexArray;De.clear();const we=w.lineVertexArray,Le=u?w.text.placedSymbolArray:w.icon.placedSymbolArray,je=o.transform.width/o.transform.height;let Re=!1;for(let $e=0;$e<Le.length;$e++){const Ye=Le.get($e);if(Ye.hidden||Ye.writingMode===p.ay.vertical&&!Re){Gs(Ye.numGlyphs,De);continue}Re=!1;const Ne=new p.P(Ye.anchorX,Ye.anchorY),Qe={getElevation:q,pitchedLabelPlaneMatrix:g,lineVertexArray:we,pitchWithMap:T,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:o.transform,tileAnchorPoint:Ne,unwrappedTileID:O,width:U,height:N,translation:H},gt=El(Ye.anchorX,Ye.anchorY,Qe);if(!rs(gt.point,Te)){Gs(Ye.numGlyphs,De);continue}const lt=Un(o.transform.cameraToCenterDistance,gt.signedDistanceFromCamera),ft=p.az(te,ce,Ye),_t=T?ft*o.transform.getPitchedTextCorrection(Ye.anchorX,Ye.anchorY,O)/lt:ft*lt,Ht=ka({projectionContext:Qe,pitchedLabelPlaneMatrixInverse:v,symbol:Ye,fontSize:_t,flip:!1,keepUpright:M,glyphOffsetArray:w.glyphOffsetArray,dynamicLayoutVertexArray:De,aspectRatio:je,rotateToLine:A});Re=Ht.useVertical,(Ht.notEnoughRoom||Re||Ht.needsFlipping&&ka({projectionContext:Qe,pitchedLabelPlaneMatrixInverse:v,symbol:Ye,fontSize:_t,flip:!0,keepUpright:M,glyphOffsetArray:w.glyphOffsetArray,dynamicLayoutVertexArray:De,aspectRatio:je,rotateToLine:A}).notEnoughRoom)&&Gs(Ye.numGlyphs,De)}u?w.text.dynamicLayoutVertexBuffer.updateData(De):w.icon.dynamicLayoutVertexBuffer.updateData(De)}function mo(w,o,u,g,v,T,M,A){const O=T.glyphStartIndex+T.numGlyphs,U=T.lineStartIndex,N=T.lineStartIndex+T.lineLength,H=o.getoffsetX(T.glyphStartIndex),q=o.getoffsetX(O-1),te=gr(w*H,u,g,v,T.segment,U,N,A,M);if(!te)return null;const ce=gr(w*q,u,g,v,T.segment,U,N,A,M);return ce?A.projectionCache.anyProjectionOccluded?null:{first:te,last:ce}:null}function kn(w,o,u,g){return w===p.ay.horizontal&&Math.abs(u.y-o.y)>Math.abs(u.x-o.x)*g?{useVertical:!0}:(w===p.ay.vertical?o.y<u.y:o.x>u.x)?{needsFlipping:!0}:null}function ka(w){const{projectionContext:o,pitchedLabelPlaneMatrixInverse:u,symbol:g,fontSize:v,flip:T,keepUpright:M,glyphOffsetArray:A,dynamicLayoutVertexArray:O,aspectRatio:U,rotateToLine:N}=w,H=v/24,q=g.lineOffsetX*H,te=g.lineOffsetY*H;let ce;if(g.numGlyphs>1){const Te=g.glyphStartIndex+g.numGlyphs,De=g.lineStartIndex,we=g.lineStartIndex+g.lineLength,Le=mo(H,A,q,te,T,g,N,o);if(!Le)return{notEnoughRoom:!0};const je=Si(Le.first.point.x,Le.first.point.y,o,u),Re=Si(Le.last.point.x,Le.last.point.y,o,u);if(M&&!T){const $e=kn(g.writingMode,je,Re,U);if($e)return $e}ce=[Le.first];for(let $e=g.glyphStartIndex+1;$e<Te-1;$e++){const Ye=gr(H*A.getoffsetX($e),q,te,T,g.segment,De,we,o,N);if(!Ye)return{notEnoughRoom:!0};ce.push(Ye)}ce.push(Le.last)}else{if(M&&!T){const De=ca(o.tileAnchorPoint.x,o.tileAnchorPoint.y,o).point,we=g.lineStartIndex+g.segment+1,Le=new p.P(o.lineVertexArray.getx(we),o.lineVertexArray.gety(we)),je=ca(Le.x,Le.y,o),Re=je.signedDistanceFromCamera>0?je.point:qr(o.tileAnchorPoint,Le,De,1,o),$e=Si(De.x,De.y,o,u),Ye=Si(Re.x,Re.y,o,u),Ne=kn(g.writingMode,$e,Ye,U);if(Ne)return Ne}const Te=gr(H*A.getoffsetX(g.glyphStartIndex),q,te,T,g.segment,g.lineStartIndex,g.lineStartIndex+g.lineLength,o,N);if(!Te||o.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ce=[Te]}for(const Te of ce)p.aF(O,Te.point,Te.angle);return{}}function qr(w,o,u,g,v){const T=w.add(w.sub(o)._unit()),M=ca(T.x,T.y,v).point,A=u.sub(M);return u.add(A._mult(g/A.mag()))}function Lr(w,o,u){const g=o.projectionCache;if(g.projections[w])return g.projections[w];const v=new p.P(o.lineVertexArray.getx(w),o.lineVertexArray.gety(w)),T=ca(v.x,v.y,o);if(T.signedDistanceFromCamera>0)return g.projections[w]=T.point,g.anyProjectionOccluded=g.anyProjectionOccluded||T.isOccluded,T.point;const M=w-u.direction;return qr(0===u.distanceFromAnchor?o.tileAnchorPoint:new p.P(o.lineVertexArray.getx(M),o.lineVertexArray.gety(M)),v,u.previousVertex,u.absOffsetX-u.distanceFromAnchor+1,o)}function ca(w,o,u){const g=w+u.translation[0],v=o+u.translation[1];let T;return u.pitchWithMap?(T=Mn(g,v,u.pitchedLabelPlaneMatrix,u.getElevation),T.isOccluded=!1):(T=u.transform.projectTileCoordinates(g,v,u.unwrappedTileID,u.getElevation),T.point.x=(.5*T.point.x+.5)*u.width,T.point.y=(.5*-T.point.y+.5)*u.height),T}function Si(w,o,u,g){if(u.pitchWithMap){const v=[w,o,0,1];return p.aG(v,v,g),u.transform.projectTileCoordinates(v[0]/v[3],v[1]/v[3],u.unwrappedTileID,u.getElevation).point}return{x:w/u.width*2-1,y:1-o/u.height*2}}function El(w,o,u){return u.transform.projectTileCoordinates(w,o,u.unwrappedTileID,u.getElevation)}function oc(w,o,u){return w._unit()._perp()._mult(o*u)}function Et(w,o,u,g,v,T,M,A,O){if(A.projectionCache.offsets[w])return A.projectionCache.offsets[w];const U=u.add(o);if(w+O.direction<g||w+O.direction>=v)return A.projectionCache.offsets[w]=U,U;const N=Lr(w+O.direction,A,O),H=oc(N.sub(u),M,O.direction),q=u.add(H),te=N.add(H);return A.projectionCache.offsets[w]=p.aH(T,U,q,te)||U,A.projectionCache.offsets[w]}function gr(w,o,u,g,v,T,M,A,O){const U=g?w-o:w+o;let N=U>0?1:-1,H=0;g&&(N*=-1,H=Math.PI),N<0&&(H+=Math.PI);let q,te=N>0?T+v:T+v+1;A.projectionCache.cachedAnchorPoint?q=A.projectionCache.cachedAnchorPoint:(q=ca(A.tileAnchorPoint.x,A.tileAnchorPoint.y,A).point,A.projectionCache.cachedAnchorPoint=q);let ce,Te,De=q,we=q,Le=0,je=0;const Re=Math.abs(U),$e=[];let Ye;for(;Le+je<=Re;){if(te+=N,te<T||te>=M)return null;Le+=je,we=De,Te=ce;const gt={absOffsetX:Re,direction:N,distanceFromAnchor:Le,previousVertex:we};if(De=Lr(te,A,gt),0===u)$e.push(we),Ye=De.sub(we);else{let lt;const ft=De.sub(we);lt=0===ft.mag()?oc(Lr(te+N,A,gt).sub(De),u,N):oc(ft,u,N),Te||(Te=we.add(lt)),ce=Et(te,lt,De,T,M,Te,u,A,gt),$e.push(Te),Ye=ce.sub(Te)}je=Ye.mag()}const Ne=Ye._mult((Re-Le)/je)._add(Te||we),Qe=H+Math.atan2(De.y-we.y,De.x-we.x);return $e.push(Ne),{point:Ne,angle:O?Qe:0,path:$e}}const Ja=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Gs(w,o){for(let u=0;u<w;u++){const g=o.length;o.resize(g+4),o.float32.set(Ja,3*g)}}function Sl(w,o,u){const g=o[0],v=o[1];return w[0]=u[0]*g+u[4]*v+u[12],w[1]=u[1]*g+u[5]*v+u[13],w[3]=u[3]*g+u[7]*v+u[15],w}const _r=100;class Ra{constructor(o,u=new gn(o.width+200,o.height+200,25),g=new gn(o.width+200,o.height+200,25)){this.transform=o,this.grid=u,this.ignoredGrid=g,this.pitchFactor=Math.cos(o.pitch*Math.PI/180)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+_r,this.screenBottomBoundary=o.height+_r,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,u,g,v,T,M,A,O,U,N,H,q){const te=this.projectAndGetPerspectiveRatio(o.anchorPointX+O[0],o.anchorPointY+O[1],T,N,q),ce=g*te.perspectiveRatio;let Te;if(M||A)Te=this._projectCollisionBox(o,ce,v,T,M,A,O,te,N,H,q);else{const Ye=te.x+(H?H.x*ce:0),Ne=te.y+(H?H.y*ce:0);Te={allPointsOccluded:!1,box:[Ye+o.x1*ce,Ne+o.y1*ce,Ye+o.x2*ce,Ne+o.y2*ce]}}const[De,we,Le,je]=Te.box,Re=M?Te.allPointsOccluded:te.isOccluded;let $e=Re;return $e||($e=te.perspectiveRatio<this.perspectiveRatioCutoff),$e||($e=!this.isInsideGrid(De,we,Le,je)),$e||"always"!==u&&this.grid.hitTest(De,we,Le,je,u,U)?{box:[De,we,Le,je],placeable:!1,offscreen:!1,occluded:Re}:{box:[De,we,Le,je],placeable:!0,offscreen:this.isOffscreen(De,we,Le,je),occluded:Re}}placeCollisionCircles(o,u,g,v,T,M,A,O,U,N,H,q,te,ce){const Te=[],De=new p.P(u.anchorX,u.anchorY),we=this.getPerspectiveRatio(De.x,De.y,M,ce),Le=(U?T*this.transform.getPitchedTextCorrection(u.anchorX,u.anchorY,M)/we:T*we)/p.aL,je={getElevation:ce,pitchedLabelPlaneMatrix:A,lineVertexArray:g,pitchWithMap:U,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:De,unwrappedTileID:M,width:this.transform.width,height:this.transform.height,translation:te},Re=mo(Le,v,u.lineOffsetX*Le,u.lineOffsetY*Le,!1,u,!1,je);let $e=!1,Ye=!1,Ne=!0;if(Re){const Qe=.5*H*we+q,gt=new p.P(-100,-100),lt=new p.P(this.screenRightBoundary,this.screenBottomBoundary),ft=new Gt,_t=Re.first,Ht=Re.last;let $t=[];for(let yi=_t.path.length-1;yi>=1;yi--)$t.push(_t.path[yi]);for(let yi=1;yi<Ht.path.length;yi++)$t.push(Ht.path[yi]);const Ft=2.5*Qe;if(U){const yi=this.projectPathToScreenSpace($t,je);$t=yi.some(pi=>pi.signedDistanceFromCamera<=0)?[]:yi.map(pi=>pi.point)}let Tn=[];if($t.length>0){const yi=$t[0].clone(),pi=$t[0].clone();for(let br=1;br<$t.length;br++)yi.x=Math.min(yi.x,$t[br].x),yi.y=Math.min(yi.y,$t[br].y),pi.x=Math.max(pi.x,$t[br].x),pi.y=Math.max(pi.y,$t[br].y);Tn=yi.x>=gt.x&&pi.x<=lt.x&&yi.y>=gt.y&&pi.y<=lt.y?[$t]:pi.x<gt.x||yi.x>lt.x||pi.y<gt.y||yi.y>lt.y?[]:p.aI([$t],gt.x,gt.y,lt.x,lt.y)}for(const yi of Tn){ft.reset(yi,.25*Qe);let pi=0;pi=ft.length<=.5*Qe?1:Math.ceil(ft.paddedLength/Ft)+1;for(let br=0;br<pi;br++){const xr=br/Math.max(pi-1,1),Or=ft.lerp(xr),ar=Or.x+_r,Ao=Or.y+_r;Te.push(ar,Ao,Qe,0);const Fr=ar-Qe,oo=Ao-Qe,so=ar+Qe,bo=Ao+Qe;if(Ne=Ne&&this.isOffscreen(Fr,oo,so,bo),Ye=Ye||this.isInsideGrid(Fr,oo,so,bo),"always"!==o&&this.grid.hitTestCircle(ar,Ao,Qe,o,N)&&($e=!0,!O))return{circles:[],offscreen:!1,collisionDetected:$e}}}}return{circles:!O&&$e||!Ye||we<this.perspectiveRatioCutoff?[]:Te,offscreen:Ne,collisionDetected:$e}}projectPathToScreenSpace(o,u){return function(v){let T=0,M=0,A=0,O=0;for(let U=0;U<v.length;U++)v[U].isOccluded?(A=U+1,O=0):(O++,O>M&&(M=O,T=A));return v.slice(T,T+M)}(function(v,T){const M=p.N();return p.aA(M,T.pitchedLabelPlaneMatrix),v.map(A=>{const O=Mn(A.x,A.y,M,T.getElevation),U=T.transform.projectTileCoordinates(O.point.x,O.point.y,T.unwrappedTileID,T.getElevation);return U.point.x=(.5*U.point.x+.5)*T.width,U.point.y=(.5*-U.point.y+.5)*T.height,U})}(o,u))}queryRenderedSymbols(o){if(0===o.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const u=[],g=new p.ab;for(const H of o){const q=new p.P(H.x+_r,H.y+_r);g.extend(q),u.push(q)}const{minX:v,minY:T,maxX:M,maxY:A}=g,O=this.grid.query(v,T,M,A).concat(this.ignoredGrid.query(v,T,M,A)),U={},N={};for(const H of O){const q=H.key;if(void 0===U[q.bucketInstanceId]&&(U[q.bucketInstanceId]={}),U[q.bucketInstanceId][q.featureIndex])continue;const te=[new p.P(H.x1,H.y1),new p.P(H.x2,H.y1),new p.P(H.x2,H.y2),new p.P(H.x1,H.y2)];p.aJ(u,te)&&(U[q.bucketInstanceId][q.featureIndex]=!0,void 0===N[q.bucketInstanceId]&&(N[q.bucketInstanceId]=[]),N[q.bucketInstanceId].push(q.featureIndex))}return N}insertCollisionBox(o,u,g,v,T,M){(g?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:T,collisionGroupID:M,overlapMode:u},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,u,g,v,T,M){const A=g?this.ignoredGrid:this.grid,O={bucketInstanceId:v,featureIndex:T,collisionGroupID:M,overlapMode:u};for(let U=0;U<o.length;U+=4)A.insertCircle(O,o[U],o[U+1],o[U+2])}projectAndGetPerspectiveRatio(o,u,g,v,T){if(T){let M;v?(M=[o,u,v(o,u),1],p.aG(M,M,T)):(M=[o,u,0,1],Sl(M,M,T));const A=M[3];return{x:(M[0]/A+1)/2*this.transform.width+_r,y:(-M[1]/A+1)/2*this.transform.height+_r,perspectiveRatio:.5+this.transform.cameraToCenterDistance/A*.5,isOccluded:!1,signedDistanceFromCamera:A}}{const M=this.transform.projectTileCoordinates(o,u,g,v);return{x:(M.point.x+1)/2*this.transform.width+_r,y:(1-M.point.y)/2*this.transform.height+_r,perspectiveRatio:.5+this.transform.cameraToCenterDistance/M.signedDistanceFromCamera*.5,isOccluded:M.isOccluded,signedDistanceFromCamera:M.signedDistanceFromCamera}}}getPerspectiveRatio(o,u,g,v){const T=this.transform.projectTileCoordinates(o,u,g,v);return.5+this.transform.cameraToCenterDistance/T.signedDistanceFromCamera*.5}isOffscreen(o,u,g,v){return g<_r||o>=this.screenRightBoundary||v<_r||u>this.screenBottomBoundary}isInsideGrid(o,u,g,v){return g>=0&&o<this.gridRightBoundary&&v>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const o=p.ar([]);return p.O(o,o,[-100,-100,0]),o}_projectCollisionBox(o,u,g,v,T,M,A,O,U,N,H){let q=1,te=0,ce=0,Te=1;const De=o.anchorPointX+A[0],we=o.anchorPointY+A[1];if(M&&!T){const $t=this.projectAndGetPerspectiveRatio(De+1,we,v,U,H),Ft=$t.x-O.x,Tn=Math.atan(($t.y-O.y)/Ft)+(Ft<0?Math.PI:0),yi=Math.sin(Tn),pi=Math.cos(Tn);q=pi,te=yi,ce=-yi,Te=pi}else if(!M&&T){const $t=qt(this.transform);q=$t.vecEast[0],te=$t.vecEast[1],ce=$t.vecSouth[0],Te=$t.vecSouth[1]}let Le=O.x,je=O.y,Re=u;T&&(Le=De,je=we,Re=Math.pow(2,-(this.transform.zoom-g.overscaledZ)),Re*=this.transform.getPitchedTextCorrection(De,we,v),N||(Re*=p.an(.5+O.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),N&&(Le+=q*N.x*Re+ce*N.y*Re,je+=te*N.x*Re+Te*N.y*Re);const $e=o.x1*Re,Ye=o.x2*Re,Ne=($e+Ye)/2,Qe=o.y1*Re,gt=o.y2*Re,lt=(Qe+gt)/2,ft=[{offsetX:$e,offsetY:Qe},{offsetX:Ne,offsetY:Qe},{offsetX:Ye,offsetY:Qe},{offsetX:Ye,offsetY:lt},{offsetX:Ye,offsetY:gt},{offsetX:Ne,offsetY:gt},{offsetX:$e,offsetY:gt},{offsetX:$e,offsetY:lt}];let _t=[];for(const{offsetX:$t,offsetY:Ft}of ft)_t.push(new p.P(Le+q*$t+ce*Ft,je+te*$t+Te*Ft));let Ht=!1;if(T){const $t=_t.map(Ft=>this.projectAndGetPerspectiveRatio(Ft.x,Ft.y,v,U,H));Ht=$t.some(Ft=>!Ft.isOccluded),_t=$t.map(Ft=>new p.P(Ft.x,Ft.y))}else Ht=!0;return{box:p.aK(_t),allPointsOccluded:!Ht}}}class ua{constructor(o,u,g,v){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?u:-u))):v&&g?1:0,this.placed=g}isHidden(){return 0===this.opacity&&!this.placed}}class os{constructor(o,u,g,v,T){this.text=new ua(o?o.text:null,u,g,T),this.icon=new ua(o?o.icon:null,u,v,T)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ai{constructor(o,u,g){this.text=o,this.icon=u,this.skipFade=g}}class Qi{constructor(o,u,g,v,T){this.bucketInstanceId=o,this.featureIndex=u,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=T}}class Rc{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const u=++this.maxGroupID;this.collisionGroups[o]={ID:u,predicate:g=>g.collisionGroupID===u}}return this.collisionGroups[o]}}function el(w,o,u,g,v){const{horizontalAlign:T,verticalAlign:M}=p.aR(w);return new p.P(-(T-.5)*o+g[0]*v,-(M-.5)*u+g[1]*v)}class xa{constructor(o,u,g,v,T){this.transform=o.clone(),this.terrain=u,this.collisionIndex=new Ra(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=g,this.retainedQueryData={},this.collisionGroups=new Rc(v),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=T,T&&(T.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(o){const u=this.terrain;return u?(g,v)=>u.getElevation(o,g,v):null}getBucketParts(o,u,g,v){const T=g.getBucket(u),M=g.latestFeatureIndex;if(!T||!M||u.id!==T.layerIds[0])return;const A=g.collisionBoxArray,O=T.layers[0].layout,U=T.layers[0].paint,N=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),H=g.tileSize/p.a4,q=g.tileID.toUnwrapped(),te="map"===O.get("text-rotation-alignment"),ce=p.aM(g,1,this.transform.zoom),Te=p.aN(this.collisionIndex.transform,g,U.get("text-translate"),U.get("text-translate-anchor")),De=p.aN(this.collisionIndex.transform,g,U.get("icon-translate"),U.get("icon-translate-anchor")),we=Zr(te,this.transform,ce);this.retainedQueryData[T.bucketInstanceId]=new Qi(T.bucketInstanceId,M,T.sourceLayerIndex,T.index,g.tileID);const Le={bucket:T,layout:O,translationText:Te,translationIcon:De,unwrappedTileID:q,pitchedLabelPlaneMatrix:we,scale:N,textPixelRatio:H,holdingForFade:g.holdingForSymbolFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:p.ax(T.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(v)for(const je of T.sortKeyRanges){const{sortKey:Re,symbolInstanceStart:$e,symbolInstanceEnd:Ye}=je;o.push({sortKey:Re,symbolInstanceStart:$e,symbolInstanceEnd:Ye,parameters:Le})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:Le})}attemptAnchorPlacement(o,u,g,v,T,M,A,O,U,N,H,q,te,ce,Te,De,we,Le,je,Re){const $e=p.aO[o.textAnchor],Ye=[o.textOffset0,o.textOffset1],Ne=el($e,g,v,Ye,T),Qe=this.collisionIndex.placeCollisionBox(u,q,O,U,N,A,M,De,H.predicate,je,Ne,Re);if((!Le||this.collisionIndex.placeCollisionBox(Le,q,O,U,N,A,M,we,H.predicate,je,Ne,Re).placeable)&&Qe.placeable){let gt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[te.crossTileID]&&this.prevPlacement.placements[te.crossTileID]&&this.prevPlacement.placements[te.crossTileID].text&&(gt=this.prevPlacement.variableOffsets[te.crossTileID].anchor),0===te.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[te.crossTileID]={textOffset:Ye,width:g,height:v,anchor:$e,textBoxScale:T,prevAnchor:gt},this.markUsedJustification(ce,$e,te,Te),ce.allowVerticalPlacement&&(this.markUsedOrientation(ce,Te,te),this.placedOrientations[te.crossTileID]=Te),{shift:Ne,placedGlyphBoxes:Qe}}}placeLayerBucketPart(o,u,g){const{bucket:v,layout:T,translationText:M,translationIcon:A,unwrappedTileID:O,pitchedLabelPlaneMatrix:U,textPixelRatio:N,holdingForFade:H,collisionBoxArray:q,partiallyEvaluatedTextSize:te,collisionGroup:ce}=o.parameters,Te=T.get("text-optional"),De=T.get("icon-optional"),we=p.aP(T,"text-overlap","text-allow-overlap"),Le="always"===we,je=p.aP(T,"icon-overlap","icon-allow-overlap"),Re="always"===je,$e="map"===T.get("text-rotation-alignment"),Ye="map"===T.get("text-pitch-alignment"),Ne="none"!==T.get("icon-text-fit"),Qe="viewport-y"===T.get("symbol-z-order"),gt=Le&&(Re||!v.hasIconData()||De),lt=Re&&(Le||!v.hasTextData()||Te);!v.collisionArrays&&q&&v.deserializeCollisionBoxes(q);const ft=this.retainedQueryData[v.bucketInstanceId].tileID,_t=this._getTerrainElevationFunc(ft),Ht=this.transform.getFastPathSimpleProjectionMatrix(ft),$t=(Ft,Tn,yi)=>{var pi,br;if(u[Ft.crossTileID])return;if(H)return void(this.placements[Ft.crossTileID]=new Ai(!1,!1,!1));let xr=!1,Or=!1,ar=!0,Ao=null,Fr={box:null,placeable:!1,offscreen:null,occluded:!1},oo={placeable:!1},so=null,bo=null,na=null,Ul=0,Va=0,Yc=0;Tn.textFeatureIndex?Ul=Tn.textFeatureIndex:Ft.useRuntimeCollisionCircles&&(Ul=Ft.featureIndex),Tn.verticalTextFeatureIndex&&(Va=Tn.verticalTextFeatureIndex);const Xr=Tn.textBox;if(Xr){const Ea=Kr=>{let Mr=p.ay.horizontal;if(v.allowVerticalPlacement&&!Kr&&this.prevPlacement){const wr=this.prevPlacement.placedOrientations[Ft.crossTileID];wr&&(this.placedOrientations[Ft.crossTileID]=wr,Mr=wr,this.markUsedOrientation(v,Mr,Ft))}return Mr},lr=(Kr,Mr)=>{if(v.allowVerticalPlacement&&Ft.numVerticalGlyphVertices>0&&Tn.verticalTextBox){for(const wr of v.writingModes)if(wr===p.ay.vertical?(Fr=Mr(),oo=Fr):Fr=Kr(),Fr&&Fr.placeable)break}else Fr=Kr()},Nu=Ft.textAnchorOffsetStartIndex,Xc=Ft.textAnchorOffsetEndIndex;if(Xc===Nu){const Kr=(Mr,wr)=>{const Er=this.collisionIndex.placeCollisionBox(Mr,we,N,ft,O,Ye,$e,M,ce.predicate,_t,void 0,Ht);return Er&&Er.placeable&&(this.markUsedOrientation(v,wr,Ft),this.placedOrientations[Ft.crossTileID]=wr),Er};lr(()=>Kr(Xr,p.ay.horizontal),()=>{const Mr=Tn.verticalTextBox;return v.allowVerticalPlacement&&Ft.numVerticalGlyphVertices>0&&Mr?Kr(Mr,p.ay.vertical):{box:null,offscreen:null}}),Ea(Fr&&Fr.placeable)}else{let Kr=p.aO[null===(br=null===(pi=this.prevPlacement)||void 0===pi?void 0:pi.variableOffsets[Ft.crossTileID])||void 0===br?void 0:br.anchor];const Mr=(Er,$l,wd)=>{const Cd=Er.x2-Er.x1,df=Er.y2-Er.y1,Kc=Ft.textBoxScale,ug=Ne&&"never"===je?$l:null;let Qc=null,Dc="never"===we?1:2,zu="never";Kr&&Dc++;for(let Gl=0;Gl<Dc;Gl++){for(let hl=Nu;hl<Xc;hl++){const Fp=v.textAnchorOffsets.get(hl);if(Kr&&Fp.textAnchor!==Kr)continue;const Np=this.attemptAnchorPlacement(Fp,Er,Cd,df,Kc,$e,Ye,N,ft,O,ce,zu,Ft,v,wd,M,A,ug,_t);if(Np&&(Qc=Np.placedGlyphBoxes,Qc&&Qc.placeable))return xr=!0,Ao=Np.shift,Qc}Kr?Kr=null:zu=we}return g&&!Qc&&(Qc={box:this.collisionIndex.placeCollisionBox(Xr,"always",N,ft,O,Ye,$e,M,ce.predicate,_t,void 0,Ht).box,offscreen:!1,placeable:!1,occluded:!1}),Qc};lr(()=>Mr(Xr,Tn.iconBox,p.ay.horizontal),()=>{const Er=Tn.verticalTextBox;return v.allowVerticalPlacement&&(!Fr||!Fr.placeable)&&Ft.numVerticalGlyphVertices>0&&Er?Mr(Er,Tn.verticalIconBox,p.ay.vertical):{box:null,occluded:!0,offscreen:null}}),Fr&&(xr=Fr.placeable,ar=Fr.offscreen);const wr=Ea(Fr&&Fr.placeable);if(!xr&&this.prevPlacement){const Er=this.prevPlacement.variableOffsets[Ft.crossTileID];Er&&(this.variableOffsets[Ft.crossTileID]=Er,this.markUsedJustification(v,Er.anchor,Ft,wr))}}}if(so=Fr,xr=so&&so.placeable,ar=so&&so.offscreen,Ft.useRuntimeCollisionCircles&&Ft.centerJustifiedTextSymbolIndex>=0){const Ea=v.text.placedSymbolArray.get(Ft.centerJustifiedTextSymbolIndex),lr=p.az(v.textSizeData,te,Ea),Nu=T.get("text-padding");bo=this.collisionIndex.placeCollisionCircles(we,Ea,v.lineVertexArray,v.glyphOffsetArray,lr,O,U,g,Ye,ce.predicate,Ft.collisionCircleDiameter,Nu,M,_t),bo.circles.length&&bo.collisionDetected&&!g&&p.w("Collisions detected, but collision boxes are not shown"),xr=Le||bo.circles.length>0&&!bo.collisionDetected,ar=ar&&bo.offscreen}if(Tn.iconFeatureIndex&&(Yc=Tn.iconFeatureIndex),Tn.iconBox){const Ea=lr=>this.collisionIndex.placeCollisionBox(lr,je,N,ft,O,Ye,$e,A,ce.predicate,_t,Ne&&Ao?Ao:void 0,Ht);oo&&oo.placeable&&Tn.verticalIconBox?(na=Ea(Tn.verticalIconBox),Or=na.placeable):(na=Ea(Tn.iconBox),Or=na.placeable),ar=ar&&na.offscreen}const Ma=Te||0===Ft.numHorizontalGlyphVertices&&0===Ft.numVerticalGlyphVertices,zi=De||0===Ft.numIconVertices;Ma||zi?zi?Ma||(Or=Or&&xr):xr=Or&&xr:Or=xr=Or&&xr;const er=Or&&na.placeable;if(xr&&so.placeable&&this.collisionIndex.insertCollisionBox(so.box,we,T.get("text-ignore-placement"),v.bucketInstanceId,oo&&oo.placeable&&Va?Va:Ul,ce.ID),er&&this.collisionIndex.insertCollisionBox(na.box,je,T.get("icon-ignore-placement"),v.bucketInstanceId,Yc,ce.ID),bo&&xr&&this.collisionIndex.insertCollisionCircles(bo.circles,we,T.get("text-ignore-placement"),v.bucketInstanceId,Ul,ce.ID),g&&this.storeCollisionData(v.bucketInstanceId,yi,Tn,so,na,bo),0===Ft.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===v.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ft.crossTileID]=new Ai((xr||gt)&&!so?.occluded,(Or||lt)&&!na?.occluded,ar||v.justReloaded),u[Ft.crossTileID]=!0};if(Qe){if(0!==o.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const Ft=v.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Tn=Ft.length-1;Tn>=0;--Tn){const yi=Ft[Tn];$t(v.symbolInstances.get(yi),v.collisionArrays[yi],yi)}}else for(let Ft=o.symbolInstanceStart;Ft<o.symbolInstanceEnd;Ft++)$t(v.symbolInstances.get(Ft),v.collisionArrays[Ft],Ft);v.justReloaded=!1}storeCollisionData(o,u,g,v,T,M){if(g.textBox||g.iconBox){let A,O;this.collisionBoxArrays.has(o)?A=this.collisionBoxArrays.get(o):(A=new Map,this.collisionBoxArrays.set(o,A)),A.has(u)?O=A.get(u):(O={text:null,icon:null},A.set(u,O)),g.textBox&&(O.text=v.box),g.iconBox&&(O.icon=T.box)}if(M){let A=this.collisionCircleArrays[o];void 0===A&&(A=this.collisionCircleArrays[o]=[]);for(let O=0;O<M.circles.length;O+=4)A.push(M.circles[O+0]-_r),A.push(M.circles[O+1]-_r),A.push(M.circles[O+2]),A.push(M.collisionDetected?1:0)}}markUsedJustification(o,u,g,v){let T;T=v===p.ay.vertical?g.verticalPlacedTextSymbolIndex:{left:g.leftJustifiedTextSymbolIndex,center:g.centerJustifiedTextSymbolIndex,right:g.rightJustifiedTextSymbolIndex}[p.aQ(u)];const M=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex,g.verticalPlacedTextSymbolIndex];for(const A of M)A>=0&&(o.text.placedSymbolArray.get(A).crossTileID=T>=0&&A!==T?0:g.crossTileID)}markUsedOrientation(o,u,g){const v=u===p.ay.horizontal||u===p.ay.horizontalOnly?u:0,T=u===p.ay.vertical?u:0,M=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex];for(const A of M)o.text.placedSymbolArray.get(A).placedOrientation=v;g.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(g.verticalPlacedTextSymbolIndex).placedOrientation=T)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let g=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const v=u?u.symbolFadeChange(o):1,T=u?u.opacities:{},M=u?u.variableOffsets:{},A=u?u.placedOrientations:{};for(const O in this.placements){const U=this.placements[O],N=T[O];N?(this.opacities[O]=new os(N,v,U.text,U.icon),g=g||U.text!==N.text.placed||U.icon!==N.icon.placed):(this.opacities[O]=new os(null,v,U.text,U.icon,U.skipFade),g=g||U.text||U.icon)}for(const O in T){const U=T[O];if(!this.opacities[O]){const N=new os(U,v,!1,!1);N.isHidden()||(this.opacities[O]=N,g=g||U.text.placed||U.icon.placed)}}for(const O in M)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=M[O]);for(const O in A)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=A[O]);if(u&&void 0===u.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");g?this.lastPlacementChangeTime=o:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:o)}updateLayerOpacities(o,u){const g={};for(const v of u){const T=v.getBucket(o);T&&v.latestFeatureIndex&&o.id===T.layerIds[0]&&this.updateBucketOpacities(T,v.tileID,g,v.collisionBoxArray)}}updateBucketOpacities(o,u,g,v){o.hasTextData()&&(o.text.opacityVertexArray.clear(),o.text.hasVisibleVertices=!1),o.hasIconData()&&(o.icon.opacityVertexArray.clear(),o.icon.hasVisibleVertices=!1),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const T=o.layers[0],M=T.layout,A=new os(null,0,!1,!1,!0),O=M.get("text-allow-overlap"),U=M.get("icon-allow-overlap"),N=T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"),H="map"===M.get("text-rotation-alignment"),q="map"===M.get("text-pitch-alignment"),te="none"!==M.get("icon-text-fit"),ce=new os(null,0,O&&(U||!o.hasIconData()||M.get("icon-optional")),U&&(O||!o.hasTextData()||M.get("text-optional")),!0);!o.collisionArrays&&v&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(v);const Te=(we,Le,je)=>{for(let Re=0;Re<Le/4;Re++)we.opacityVertexArray.emplaceBack(je);we.hasVisibleVertices=we.hasVisibleVertices||je!==dr},De=this.collisionBoxArrays.get(o.bucketInstanceId);for(let we=0;we<o.symbolInstances.length;we++){const Le=o.symbolInstances.get(we),{numHorizontalGlyphVertices:je,numVerticalGlyphVertices:Re,crossTileID:$e}=Le;let Ye=this.opacities[$e];g[$e]?Ye=A:Ye||(Ye=ce,this.opacities[$e]=Ye),g[$e]=!0;const Ne=Le.numIconVertices>0,Qe=this.placedOrientations[Le.crossTileID],gt=Qe===p.ay.vertical,lt=Qe===p.ay.horizontal||Qe===p.ay.horizontalOnly;if(je>0||Re>0){const _t=sc(Ye.text);Te(o.text,je,gt?dr:_t),Te(o.text,Re,lt?dr:_t);const Ht=Ye.text.isHidden();[Le.rightJustifiedTextSymbolIndex,Le.centerJustifiedTextSymbolIndex,Le.leftJustifiedTextSymbolIndex].forEach(Tn=>{Tn>=0&&(o.text.placedSymbolArray.get(Tn).hidden=Ht||gt?1:0)}),Le.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(Le.verticalPlacedTextSymbolIndex).hidden=Ht||lt?1:0);const $t=this.variableOffsets[Le.crossTileID];$t&&this.markUsedJustification(o,$t.anchor,Le,Qe);const Ft=this.placedOrientations[Le.crossTileID];Ft&&(this.markUsedJustification(o,"left",Le,Ft),this.markUsedOrientation(o,Ft,Le))}if(Ne){const _t=sc(Ye.icon),Ht=!(te&&Le.verticalPlacedIconSymbolIndex&&gt);Le.placedIconSymbolIndex>=0&&(Te(o.icon,Le.numIconVertices,Ht?_t:dr),o.icon.placedSymbolArray.get(Le.placedIconSymbolIndex).hidden=Ye.icon.isHidden()),Le.verticalPlacedIconSymbolIndex>=0&&(Te(o.icon,Le.numVerticalIconVertices,Ht?dr:_t),o.icon.placedSymbolArray.get(Le.verticalPlacedIconSymbolIndex).hidden=Ye.icon.isHidden())}const ft=De&&De.has(we)?De.get(we):{text:null,icon:null};if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const _t=o.collisionArrays[we];if(_t){let Ht=new p.P(0,0);if(_t.textBox||_t.verticalTextBox){let $t=!0;if(N){const Ft=this.variableOffsets[$e];Ft?(Ht=el(Ft.anchor,Ft.width,Ft.height,Ft.textOffset,Ft.textBoxScale),H&&Ht._rotate(q?-this.transform.bearingInRadians:this.transform.bearingInRadians)):$t=!1}if(_t.textBox||_t.verticalTextBox){let Ft;_t.textBox&&(Ft=gt),_t.verticalTextBox&&(Ft=lt),ld(o.textCollisionBox.collisionVertexArray,Ye.text.placed,!$t||Ft,ft.text,Ht.x,Ht.y)}}if(_t.iconBox||_t.verticalIconBox){const $t=!(lt||!_t.verticalIconBox);let Ft;_t.iconBox&&(Ft=$t),_t.verticalIconBox&&(Ft=!$t),ld(o.iconCollisionBox.collisionVertexArray,Ye.icon.placed,Ft,ft.icon,te?Ht.x:0,te?Ht.y:0)}}}}if(o.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);o.bucketInstanceId in this.collisionCircleArrays&&(o.collisionCircleArray=this.collisionCircleArrays[o.bucketInstanceId],delete this.collisionCircleArrays[o.bucketInstanceId])}symbolFadeChange(o){return 0===this.fadeDuration?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,u){const g=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*g>o}setStale(){this.stale=!0}}function ld(w,o,u,g,v,T){g&&0!==g.length||(g=[0,0,0,0]);const M=g[0]-_r,A=g[1]-_r,O=g[2]-_r,U=g[3]-_r;w.emplaceBack(o?1:0,u?1:0,v||0,T||0,M,A),w.emplaceBack(o?1:0,u?1:0,v||0,T||0,O,A),w.emplaceBack(o?1:0,u?1:0,v||0,T||0,O,U),w.emplaceBack(o?1:0,u?1:0,v||0,T||0,M,U)}const On=Math.pow(2,25),eo=Math.pow(2,24),dh=Math.pow(2,17),Wi=Math.pow(2,16),Hs=Math.pow(2,9),to=Math.pow(2,8),Il=Math.pow(2,1);function sc(w){if(0===w.opacity&&!w.placed)return 0;if(1===w.opacity&&w.placed)return 4294967295;const o=w.placed?1:0,u=Math.floor(127*w.opacity);return u*On+o*eo+u*dh+o*Wi+u*Hs+o*to+u*Il+o}const dr=0;class Gi{constructor(o){this._sortAcrossTiles="viewport-y"!==o.layout.get("symbol-z-order")&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,u,g,v,T){const M=this._bucketParts;for(;this._currentTileIndex<o.length;)if(u.getBucketParts(M,v,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((A,O)=>A.sortKey-O.sortKey));this._currentPartIndex<M.length;)if(u.placeLayerBucketPart(M[this._currentPartIndex],this._seenCrossTileIDs,g),this._currentPartIndex++,T())return!0;return!1}}class ti{constructor(o,u,g,v,T,M,A,O){this.placement=new xa(o,u,M,A,O),this._currentPlacementIndex=g.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=T,this._done=!1}isDone(){return this._done}continuePlacement(o,u,g){const v=ue(),T=()=>!this._forceFullPlacement&&ue()-v>2;for(;this._currentPlacementIndex>=0;){const M=u[o[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if("symbol"===M.type&&(!M.minzoom||M.minzoom<=A)&&(!M.maxzoom||M.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new Gi(M)),this._inProgressLayer.continuePlacement(g[M.source],this.placement,this._showCollisionBoxes,M,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Uo=512/p.a4/2;class Wo{constructor(o,u,g){this.tileID=o,this.bucketInstanceId=g,this._symbolsByKey={};const v=new Map;for(let T=0;T<u.length;T++){const M=u.get(T),A=M.key,O=v.get(A);O?O.push(M):v.set(A,[M])}for(const[T,M]of v){const A={positions:M.map(O=>({x:Math.floor(O.anchorX*Uo),y:Math.floor(O.anchorY*Uo)})),crossTileIDs:M.map(O=>O.crossTileID)};if(A.positions.length>128){const O=new p.aS(A.positions.length,16,Uint16Array);for(const{x:U,y:N}of A.positions)O.add(U,N);O.finish(),delete A.positions,A.index=O}this._symbolsByKey[T]=A}}getScaledCoordinates(o,u){const{x:g,y:v,z:T}=this.tileID.canonical,{x:M,y:A,z:O}=u.canonical,U=Uo/Math.pow(2,O-T),N=(A*p.a4+o.anchorY)*U,H=v*p.a4*Uo;return{x:Math.floor((M*p.a4+o.anchorX)*U-g*p.a4*Uo),y:Math.floor(N-H)}}findMatches(o,u,g){const v=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let T=0;T<o.length;T++){const M=o.get(T);if(M.crossTileID)continue;const A=this._symbolsByKey[M.key];if(!A)continue;const O=this.getScaledCoordinates(M,u);if(A.index){const U=A.index.range(O.x-v,O.y-v,O.x+v,O.y+v).sort();for(const N of U){const H=A.crossTileIDs[N];if(!g[H]){g[H]=!0,M.crossTileID=H;break}}}else if(A.positions)for(let U=0;U<A.positions.length;U++){const N=A.positions[U],H=A.crossTileIDs[U];if(Math.abs(N.x-O.x)<=v&&Math.abs(N.y-O.y)<=v&&!g[H]){g[H]=!0,M.crossTileID=H;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:o})=>o)}}class fh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class La{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const u=Math.round((o-this.lng)/360);if(0!==u)for(const g in this.indexes){const v=this.indexes[g],T={};for(const M in v){const A=v[M];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+u),T[A.tileID.key]=A}this.indexes[g]=T}this.lng=o}addBucket(o,u,g){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let T=0;T<u.symbolInstances.length;T++)u.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const v=this.usedCrossTileIDs[o.overscaledZ];for(const T in this.indexes){const M=this.indexes[T];if(Number(T)>o.overscaledZ)for(const A in M){const O=M[A];O.tileID.isChildOf(o)&&O.findMatches(u.symbolInstances,o,v)}else{const A=M[o.scaledTo(Number(T)).key];A&&A.findMatches(u.symbolInstances,o,v)}}for(let T=0;T<u.symbolInstances.length;T++){const M=u.symbolInstances.get(T);M.crossTileID||(M.crossTileID=g.generate(),v[M.crossTileID]=!0)}return void 0===this.indexes[o.overscaledZ]&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Wo(o,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(o,u){for(const g of u.getCrossTileIDsLists())for(const v of g)delete this.usedCrossTileIDs[o][v]}removeStaleBuckets(o){let u=!1;for(const g in this.indexes){const v=this.indexes[g];for(const T in v)o[v[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[T]),delete v[T],u=!0)}return u}}class Pl{constructor(){this.layerIndexes={},this.crossTileIDs=new fh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,u,g){let v=this.layerIndexes[o.id];void 0===v&&(v=this.layerIndexes[o.id]=new La);let T=!1;const M={};v.handleWrapJump(g);for(const A of u){const O=A.getBucket(o);O&&o.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(A.tileID,O,this.crossTileIDs)&&(T=!0),M[O.bucketInstanceId]=!0)}return v.removeStaleBuckets(M)&&(T=!0),T}pruneUnusedLayers(o){const u={};o.forEach(g=>{u[g]=!0});for(const g in this.layerIndexes)u[g]||delete this.layerIndexes[g]}}var oi="void main() {fragColor=vec4(1.0);}";const Zs={prelude:Fi("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nout highp vec4 fragColor;","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c\n);}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\n#ifdef GLOBE\nif ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}\n#endif\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;"),projectionMercator:Fi("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Fi("","#define GLOBE_RADIUS 6371008.8\nuniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos\n);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); \nif (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len\n);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}"),background:Fi("uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Fi("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Fi("in vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {\n#ifdef GLOBE\nvec3 center_vector=projectToSphere(circle_center);\n#endif\nfloat angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {\n#ifdef GLOBE\nvec4 projected_center=interpolateProjection(circle_center,center_vector,ele);\n#else\nvec4 projected_center=projectTileWithElevation(circle_center,ele);\n#endif\ncorner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}\n#ifdef GLOBE\nvec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);\n#else\ngl_Position=projectTileWithElevation(corner_position,ele);\n#endif\n} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:Fi(oi,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Fi("uniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);\n#ifdef GLOBE\nvec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);\n#else\ngl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));\n#endif\n}"),heatmapTexture:Fi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Fi("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Fi("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Fi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else\n{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Fi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Fi(oi,"in vec2 a_pos;void main() {\n#ifdef GLOBE\ngl_Position=projectTileFor3D(a_pos,0.0);\n#else\ngl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);\n#endif\n}"),fill:Fi("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nfragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_fill_translate;in vec2 a_pos;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);}"),fillOutline:Fi("in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillOutlinePattern:Fi("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n}"),fillPattern:Fi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:Fi("in vec4 v_color;void main() {fragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\nout vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);\n#ifdef GLOBE\nmat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);\n#endif\ndirectional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:Fi("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;\n#ifdef TERRAIN3D\nin vec2 a_centroid;\n#endif\n#ifdef GLOBE\nout vec3 v_sphere_pos;\n#endif\nout vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;\n#ifdef GLOBE\nvec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);\n#else\ngl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);\n#endif\nvec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:Fi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Fi("uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];\n#define PI 3.141592653589793\n#define STANDARD 0\n#define COMBINED 1\n#define IGOR 2\n#define MULTIDIRECTIONAL 3\n#define BASIC 4\nfloat get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else\n{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else\n{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Fi("uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:Fi("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:Fi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:Fi("uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define mediump vec4 dasharray_from\n#pragma mapbox: define mediump vec4 dasharray_to\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dasharray_from\n#pragma mapbox: initialize mediump vec4 dasharray_to\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define mediump vec4 dasharray_from\n#pragma mapbox: define mediump vec4 dasharray_to\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dasharray_from\n#pragma mapbox: initialize mediump vec4 dasharray_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nfloat u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}"),lineGradientSDF:Fi("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;\n#ifdef GLOBE\nin float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define mediump vec4 dasharray_from\n#pragma mapbox: define mediump vec4 dasharray_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dasharray_from\n#pragma mapbox: initialize mediump vec4 dasharray_to\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);\n#ifdef GLOBE\nif (v_depth > 1.0) {discard;}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nin vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;\n#ifdef GLOBE\nout float v_depth;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define mediump vec4 dasharray_from\n#pragma mapbox: define mediump vec4 dasharray_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 dasharray_from\n#pragma mapbox: initialize mediump vec4 dasharray_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;\n#ifdef GLOBE\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nfloat u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}"),raster:Fi("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;\n#ifdef GLOBE\nif (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}\n#endif\nv_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Fi("uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:Fi("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:Fi("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\nfragColor=vec4(1.0);\n#endif\n}","in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;\n#ifdef GLOBE\nif(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}\n#endif\nvec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:Fi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Fi("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Fi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Fi("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Fi("in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758\n);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}","in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Fi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Fi(w,o){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=o.match(/in ([\w]+) ([\w]+)/g),v=w.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=T?T.concat(v):v,A={};return{fragmentSource:w=w.replace(u,(O,U,N,H,q)=>(A[q]=!0,"define"===U?`\n#ifndef HAS_UNIFORM_u_${q}\nin ${N} ${H} ${q};\n#else\nuniform ${N} ${H} u_${q};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${q}\n    ${N} ${H} ${q} = u_${q};\n#endif\n`)),vertexSource:o=o.replace(u,(O,U,N,H,q)=>{const te="float"===H?"vec2":"vec4",ce=q.match(/color/)?"color":te;return A[q]?"define"===U?`\n#ifndef HAS_UNIFORM_u_${q}\nuniform lowp float u_${q}_t;\nin ${N} ${te} a_${q};\nout ${N} ${H} ${q};\n#else\nuniform ${N} ${H} u_${q};\n#endif\n`:"vec4"===ce?`\n#ifndef HAS_UNIFORM_u_${q}\n    ${q} = a_${q};\n#else\n    ${N} ${H} ${q} = u_${q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${q}\n    ${q} = unpack_mix_${ce}(a_${q}, u_${q}_t);\n#else\n    ${N} ${H} ${q} = u_${q};\n#endif\n`:"define"===U?`\n#ifndef HAS_UNIFORM_u_${q}\nuniform lowp float u_${q}_t;\nin ${N} ${te} a_${q};\n#else\nuniform ${N} ${H} u_${q};\n#endif\n`:"vec4"===ce?`\n#ifndef HAS_UNIFORM_u_${q}\n    ${N} ${H} ${q} = a_${q};\n#else\n    ${N} ${H} ${q} = u_${q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${q}\n    ${N} ${H} ${q} = unpack_mix_${ce}(a_${q}, u_${q}_t);\n#else\n    ${N} ${H} ${q} = u_${q};\n#endif\n`}),staticAttributes:g,staticUniforms:M}}class Oa{constructor(o,u,g){this.vertexBuffer=o,this.indexBuffer=u,this.segments=g}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var go=p.aT([{name:"a_pos",type:"Int16",components:2}]);const So="#define PROJECTION_MERCATOR",ss="mercator";class $n{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return ss}get shaderDefine(){return So}get shaderPreludeCode(){return Zs.projectionMercator}get vertexShaderPreludeCode(){return Zs.projectionMercator.vertexSource}get subdivisionGranularity(){return p.aU.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(o){}getMeshFromTileID(o,u,g,v,T){if(this._cachedMesh)return this._cachedMesh;const M=new p.aV;M.emplaceBack(0,0),M.emplaceBack(p.a4,0),M.emplaceBack(0,p.a4),M.emplaceBack(p.a4,p.a4);const A=o.createVertexBuffer(M,go.members),O=p.aW.simpleSegment(0,0,4,2),U=new p.aX;U.emplaceBack(1,0,2),U.emplaceBack(1,2,3);const N=o.createIndexBuffer(U);return this._cachedMesh=new Oa(A,N,O),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(o){}}class si{constructor(o=0,u=0,g=0,v=0){if(isNaN(o)||o<0||isNaN(u)||u<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=u,this.left=g,this.right=v}interpolate(o,u,g){return null!=u.top&&null!=o.top&&(this.top=p.G.number(o.top,u.top,g)),null!=u.bottom&&null!=o.bottom&&(this.bottom=p.G.number(o.bottom,u.bottom,g)),null!=u.left&&null!=o.left&&(this.left=p.G.number(o.left,u.left,g)),null!=u.right&&null!=o.right&&(this.right=p.G.number(o.right,u.right,g)),this}getCenter(o,u){const g=p.an((this.left+o-this.right)/2,0,o),v=p.an((this.top+u-this.bottom)/2,0,u);return new p.P(g,v)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new si(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function yn(w,o){if(!w.renderWorldCopies||w.lngRange)return;const u=o.lng-w.center.lng;o.lng+=u>180?-360:u<-180?360:0}function as(w){return Math.max(0,Math.floor(w))}class ls{constructor(o,u){var g;this.applyConstrain=(v,T)=>null!==this._constrainOverride?this._constrainOverride(v,T):this._callbacks.defaultConstrain(v,T),this._callbacks=o,this._tileSize=512,this._renderWorldCopies=void 0===u?.renderWorldCopies||!!u?.renderWorldCopies,this._minZoom=u?.minZoom||0,this._maxZoom=u?.maxZoom||22,this._minPitch=null==u?.minPitch?0:u?.minPitch,this._maxPitch=null==u?.maxPitch?60:u?.maxPitch,this._constrainOverride=null!==(g=u?.constrainOverride)&&void 0!==g?g:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new p.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=as(this._zoom),this._scale=p.aq(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new si,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(o,u,g){this._constrainOverride=o.constrainOverride,this._latRange=o.latRange,this._lngRange=o.lngRange,this._width=o.width,this._height=o.height,this._center=o.center,this._elevation=o.elevation,this._minElevationForCurrentTile=o.minElevationForCurrentTile,this._zoom=o.zoom,this._tileZoom=as(this._zoom),this._scale=p.aq(this._zoom),this._bearingInRadians=o.bearingInRadians,this._fovInRadians=o.fovInRadians,this._pitchInRadians=o.pitchInRadians,this._rollInRadians=o.rollInRadians,this._unmodified=o.unmodified,this._edgeInsets=new si(o.padding.top,o.padding.bottom,o.padding.left,o.padding.right),this._minZoom=o.minZoom,this._maxZoom=o.maxZoom,this._minPitch=o.minPitch,this._maxPitch=o.maxPitch,this._renderWorldCopies=o.renderWorldCopies,this._cameraToCenterDistance=o.cameraToCenterDistance,this._nearZ=o.nearZ,this._farZ=o.farZ,this._autoCalculateNearFarZ=!g&&o.autoCalculateNearFarZ,u&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(o){this._minElevationForCurrentTile=o}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(o){this._minZoom!==o&&(this._minZoom=o,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(o){this._minPitch!==o&&(this._minPitch=o,this.setPitch(Math.max(this.pitch,o)))}get maxPitch(){return this._maxPitch}setMaxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.setPitch(Math.min(this.pitch,o)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(o){void 0===o?o=!0:null===o&&(o=!1),this._renderWorldCopies=o}get constrainOverride(){return this._constrainOverride}setConstrainOverride(o){void 0===o&&(o=null),this._constrainOverride!==o&&(this._constrainOverride=o,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(o){const u=p.W(o,-180,180)*Math.PI/180;var g,v,T,M,A,O,U,N,H;this._bearingInRadians!==u&&(this._unmodified=!1,this._bearingInRadians=u,this._calcMatrices(),this._rotationMatrix=he(),g=this._rotationMatrix,T=-this._bearingInRadians,M=(v=this._rotationMatrix)[0],A=v[1],O=v[2],U=v[3],N=Math.sin(T),H=Math.cos(T),g[0]=M*H+O*N,g[1]=A*H+U*N,g[2]=M*-N+O*H,g[3]=A*-N+U*H)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(o){const u=p.an(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==u&&(this._unmodified=!1,this._pitchInRadians=u,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(o){const u=o/180*Math.PI;this._rollInRadians!==u&&(this._unmodified=!1,this._rollInRadians=u,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return p.aY(this._fovInRadians)}setFov(o){o=p.an(o,.1,150),this.fov!==o&&(this._unmodified=!1,this._fovInRadians=p.ap(o),this._calcMatrices())}get zoom(){return this._zoom}setZoom(o){const u=this.applyConstrain(this._center,o).zoom;this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this._tileZoom=Math.max(0,Math.floor(u)),this._scale=p.aq(u),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(o){o!==this._elevation&&(this._elevation=o,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(o,u){this._autoCalculateNearFarZ=!1,this._nearZ=o,this._farZ=u,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,u,g){this._unmodified=!1,this._edgeInsets.interpolate(o,u,g),this.constrainInternal(),this._calcMatrices()}resize(o,u,g=!0){this._width=o,this._height=u,g&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&2===this._latRange.length&&this._lngRange&&2===this._lngRange.length?new Oe([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(o){o?(this._lngRange=[o.getWest(),o.getEast()],this._latRange=[o.getSouth(),o.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-p.ao,p.ao])}getCameraQueryGeometry(o,u){if(1===u.length)return[u[0],o];{const{minX:g,minY:v,maxX:T,maxY:M}=p.ab.fromPoints(u).extend(o);return[new p.P(g,v),new p.P(T,v),new p.P(T,M),new p.P(g,M),new p.P(g,v)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const o=this._unmodified,{center:u,zoom:g}=this.applyConstrain(this.center,this.zoom);this.setCenter(u),this.setZoom(g),this._unmodified=o,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let o=p.ar(new Float64Array(16));p.Q(o,o,[this._width/2,-this._height/2,1]),p.O(o,o,[1,-1,0]),this._clipSpaceToPixelsMatrix=o,o=p.ar(new Float64Array(16)),p.Q(o,o,[1,-1,1]),p.O(o,o,[-1,-1,0]),p.Q(o,o,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=o,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(o,u,g,v){const T=void 0!==g?g:this.bearing,M=v=void 0!==v?v:this.pitch,A=p.aa.fromLngLat(o,u),O=-Math.cos(p.ap(M)),U=Math.sin(p.ap(M)),N=U*Math.sin(p.ap(T)),H=-U*Math.cos(p.ap(T));let q=this.elevation;const te=u-q;let ce;O*te>=0||Math.abs(O)<.1?(ce=1e4,q=u+ce*O):ce=-te/O;let Te,De,we=p.aZ(1,A.y),Le=0;do{if(Le+=1,Le>10)break;De=ce/we,Te=new p.aa(A.x+N*De,A.y+H*De),we=1/Te.meterInMercatorCoordinateUnits()}while(Math.abs(ce-De*we)>1e-12);return{center:Te.toLngLat(),elevation:q,zoom:p.at(this.height/2/Math.tan(this.fovInRadians/2)/De/this.tileSize)}}recalculateZoomAndCenter(o){if(this.elevation-o==0)return;const u=p.as(1,this.center.lat)*this.worldSize,g=this.cameraToCenterDistance/u,v=p.aa.fromLngLat(this.center,this.elevation),T=Ke(this.center,this.elevation,this.pitch,this.bearing,g);this._elevation=o;const M=this.calculateCenterFromCameraLngLatAlt(T.toLngLat(),p.aZ(T.z,v.y),this.bearing,this.pitch);this._elevation=M.elevation,this._center=M.center,this.setZoom(M.zoom)}getCameraPoint(){const o=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.P(o*Math.sin(this.rollInRadians),o*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const o=p.as(1,this.center.lat)*this.worldSize;return Ke(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/o).toLngLat()}getMercatorTileCoordinates(o){if(!o)return[0,0,1,1];const u=o.canonical.z>=0?1<<o.canonical.z:Math.pow(2,o.canonical.z);return[o.canonical.x/u,o.canonical.y/u,1/u/p.a4,1/u/p.a4]}}class $o{constructor(o,u){this.min=o,this.max=u,this.center=p.a_([],p.a$([],this.min,this.max),.5)}quadrant(o){const u=[o%2==0,o<2],g=p.b0(this.min),v=p.b0(this.max);for(let T=0;T<u.length;T++)g[T]=u[T]?this.min[T]:this.center[T],v[T]=u[T]?this.center[T]:this.max[T];return v[2]=this.max[2],new $o(g,v)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersectsFrustum(o){let u=!0;for(let g=0;g<o.planes.length;g++){const v=this.intersectsPlane(o.planes[g]);if(0===v)return 0;1===v&&(u=!1)}return u?2:o.aabb.min[0]>this.max[0]||o.aabb.min[1]>this.max[1]||o.aabb.min[2]>this.max[2]||o.aabb.max[0]<this.min[0]||o.aabb.max[1]<this.min[1]||o.aabb.max[2]<this.min[2]?0:1}intersectsPlane(o){let u=o[3],g=o[3];for(let v=0;v<3;v++)o[v]>0?(u+=o[v]*this.min[v],g+=o[v]*this.max[v]):(g+=o[v]*this.min[v],u+=o[v]*this.max[v]);return u>=0?2:g<0?0:1}}class cd{distanceToTile2d(o,u,g,v){const T=v.distanceX([o,u]),M=v.distanceY([o,u]);return Math.hypot(T,M)}getWrap(o,u,g){return g}getTileBoundingVolume(o,u,g,v){var T,M;let A=0,O=0;if(v?.terrain){const N=new p.a1(o.z,u,o.z,o.x,o.y),H=v.terrain.getMinMaxElevation(N);A=null!==(T=H.minElevation)&&void 0!==T?T:Math.min(0,g),O=null!==(M=H.maxElevation)&&void 0!==M?M:Math.max(0,g)}const U=1<<o.z;return new $o([u+o.x/U,o.y/U,A],[u+(o.x+1)/U,(o.y+1)/U,O])}allowVariableZoom(o,u){const g=o.fov*(Math.abs(Math.cos(o.rollInRadians))*o.height+Math.abs(Math.sin(o.rollInRadians))*o.width)/o.height,v=p.an(78.5-g/2,0,60);return!!u.terrain||o.pitch>v}allowWorldCopies(){return!0}prepareNextFrame(){}}class qs{constructor(o,u,g){this.points=o,this.planes=u,this.aabb=g}static fromInvProjectionMatrix(o,u=1,g=0,v,T){const M=T?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],A=Math.pow(2,g),O=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(q=>function(te,ce,Te,De){const we=p.aG([],te,ce),Le=1/we[3]/Te*De;return p.b5(we,we,[Le,Le,1/we[3],Le])}(q,o,u,A));v&&function(q,te,ce,Te){const De=Te?4:0,we=Te?0:4;let Le=0;const je=[],Re=[];for(let Ne=0;Ne<4;Ne++){const Qe=p.b1([],q[Ne+we],q[Ne+De]),gt=p.b6(Qe);p.a_(Qe,Qe,1/gt),je.push(gt),Re.push(Qe)}for(let Ne=0;Ne<4;Ne++){const Qe=p.b7(q[Ne+De],Re[Ne],ce);Le=null!==Qe&&Qe>=0?Math.max(Le,Qe):Math.max(Le,je[Ne])}const $e=function(Ne,Qe){const gt=p.b1([],Ne[Qe[0]],Ne[Qe[1]]),lt=p.b1([],Ne[Qe[2]],Ne[Qe[1]]),ft=[0,0,0,0];return p.b2(ft,p.b3([],gt,lt)),ft[3]=-p.b4(ft,Ne[Qe[0]]),ft}(q,te),Ye=function(Ne,Qe){const gt=p.b8(Ne),lt=p.b9([],Ne,1/gt),ft=p.b1([],Qe,p.a_([],lt,p.b4(Qe,lt))),_t=p.b8(ft);if(_t>0){const Ht=Math.sqrt(1-lt[3]*lt[3]),$t=p.a_([],lt,-lt[3]),Ft=p.a$([],$t,p.a_([],ft,Ht/_t));return p.ba(Qe,Ft)}return null}(ce,$e);if(null!==Ye){const Ne=Ye/p.b4(Re[0],$e);Le=Math.min(Le,Ne)}for(let Ne=0;Ne<4;Ne++){const Qe=Math.min(Le,je[Ne]);q[Ne+we]=[q[Ne+De][0]+Re[Ne][0]*Qe,q[Ne+De][1]+Re[Ne][1]*Qe,q[Ne+De][2]+Re[Ne][2]*Qe,1]}}(O,M[0],v,T);const U=M.map(q=>{const te=p.b1([],O[q[0]],O[q[1]]),ce=p.b1([],O[q[2]],O[q[1]]),Te=p.b2([],p.b3([],te,ce)),De=-p.b4(Te,O[q[1]]);return Te.concat(De)}),N=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],H=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const q of O)for(let te=0;te<3;te++)N[te]=Math.min(N[te],q[te]),H[te]=Math.max(H[te],q[te]);return new qs(O,U,new $o(N,H))}}class an{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(o){this._helper.setMinZoom(o)}setMaxZoom(o){this._helper.setMaxZoom(o)}setMinPitch(o){this._helper.setMinPitch(o)}setMaxPitch(o){this._helper.setMaxPitch(o)}setRenderWorldCopies(o){this._helper.setRenderWorldCopies(o)}setBearing(o){this._helper.setBearing(o)}setPitch(o){this._helper.setPitch(o)}setRoll(o){this._helper.setRoll(o)}setFov(o){this._helper.setFov(o)}setZoom(o){this._helper.setZoom(o)}setCenter(o){this._helper.setCenter(o)}setElevation(o){this._helper.setElevation(o)}setMinElevationForCurrentTile(o){this._helper.setMinElevationForCurrentTile(o)}setPadding(o){this._helper.setPadding(o)}interpolatePadding(o,u,g){return this._helper.interpolatePadding(o,u,g)}isPaddingEqual(o){return this._helper.isPaddingEqual(o)}resize(o,u,g=!0){this._helper.resize(o,u,g)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(o){this._helper.setMaxBounds(o)}setConstrainOverride(o){this._helper.setConstrainOverride(o)}overrideNearFarZ(o,u){this._helper.overrideNearFarZ(o,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(o){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),o)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(o,u){}constructor(o){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(u,g)=>{g=p.an(+g,this.minZoom,this.maxZoom);const v={center:new p.V(u.lng,u.lat),zoom:g};let T=this._helper._lngRange;if(!this._helper._renderWorldCopies&&null===T){const Re=179.9999999999;T=[-Re,Re]}const M=this.tileSize*p.aq(v.zoom);let A=0,O=M,U=0,N=M,H=0,q=0;const{x:te,y:ce}=this.size;if(this._helper._latRange){const Re=this._helper._latRange;A=p.X(Re[1])*M,O=p.X(Re[0])*M,O-A<ce&&(H=ce/(O-A))}T&&(U=p.W(p.Y(T[0])*M,0,M),N=p.W(p.Y(T[1])*M,0,M),N<U&&(N+=M),N-U<te&&(q=te/(N-U)));const{x:Te,y:De}=Fe(M,u);let we,Le;const je=Math.max(q||0,H||0);if(je){const Re=new p.P(q?(N+U)/2:Te,H?(O+A)/2:De);return v.center=Ve(M,Re).wrap(),v.zoom+=p.at(je),v}if(this._helper._latRange){const Re=ce/2;De-Re<A&&(Le=A+Re),De+Re>O&&(Le=O-Re)}if(T){const Re=(U+N)/2;let $e=Te;this._helper._renderWorldCopies&&($e=p.W(Te,Re-M/2,Re+M/2));const Ye=te/2;$e-Ye<U&&(we=U+Ye),$e+Ye>N&&(we=N-Ye)}if(void 0!==we||void 0!==Le){const Re=new p.P(we??Te,Le??De);v.center=Ve(M,Re).wrap()}return v},this.applyConstrain=(u,g)=>this._helper.applyConstrain(u,g),this._helper=new ls({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(u,g)=>this.defaultConstrain(u,g)},o),this._coveringTilesDetailsProvider=new cd}clone(){const o=new an;return o.apply(this),o}apply(o,u,g){this._helper.apply(o,u,g)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(o){const u=[new p.bb(0,o)];if(this._helper._renderWorldCopies){const g=this.screenPointToMercatorCoordinate(new p.P(0,0)),v=this.screenPointToMercatorCoordinate(new p.P(this._helper._width,0)),T=this.screenPointToMercatorCoordinate(new p.P(this._helper._width,this._helper._height)),M=this.screenPointToMercatorCoordinate(new p.P(0,this._helper._height)),A=Math.floor(Math.min(g.x,v.x,T.x,M.x)),O=Math.floor(Math.max(g.x,v.x,T.x,M.x)),U=1;for(let N=A-U;N<=O+U;N++)0!==N&&u.push(new p.bb(N,o))}return u}getCameraFrustum(){return qs.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(o){const u=this.screenPointToLocation(this.centerPoint,o),g=o?o.getElevationForLngLatZoom(u,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(g)}setLocationAtPoint(o,u){const g=p.as(this.elevation,this.center.lat),v=this.screenPointToMercatorCoordinateAtZ(u,g),T=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,g),M=p.aa.fromLngLat(o),A=new p.aa(M.x-(v.x-T.x),M.y-(v.y-T.y));this.setCenter(A?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(o,u){return u?this.coordinatePoint(p.aa.fromLngLat(o),u.getElevationForLngLatZoom(o,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(p.aa.fromLngLat(o))}screenPointToLocation(o,u){var g;return null===(g=this.screenPointToMercatorCoordinate(o,u))||void 0===g?void 0:g.toLngLat()}screenPointToMercatorCoordinate(o,u){if(u){const g=u.pointCoordinate(o);if(null!=g)return g}return this.screenPointToMercatorCoordinateAtZ(o)}screenPointToMercatorCoordinateAtZ(o,u){const g=u||0,v=[o.x,o.y,0,1],T=[o.x,o.y,1,1];p.aG(v,v,this._pixelMatrixInverse),p.aG(T,T,this._pixelMatrixInverse);const M=v[3],A=T[3],O=v[1]/M,U=T[1]/A,N=v[2]/M,H=T[2]/A,q=N===H?0:(g-N)/(H-N);return new p.aa(p.G.number(v[0]/M,T[0]/A,q)/this.worldSize,p.G.number(O,U,q)/this.worldSize,g)}coordinatePoint(o,u=0,g=this._pixelMatrix){const v=[o.x*this.worldSize,o.y*this.worldSize,u,1];return p.aG(v,v,g),new p.P(v[0]/v[3],v[1]/v[3])}getBounds(){const o=Math.max(0,this._helper._height/2-rt(this));return(new Oe).extend(this.screenPointToLocation(new p.P(0,o))).extend(this.screenPointToLocation(new p.P(this._helper._width,o))).extend(this.screenPointToLocation(new p.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new p.P(0,this._helper._height)))}isPointOnMapSurface(o,u){return u?null!=u.pointCoordinate(o):o.y>this.height/2-rt(this)}calculatePosMatrix(o,u=!1,g){var v;const T=null!==(v=o.key)&&void 0!==v?v:p.bc(o.wrap,o.canonical.z,o.canonical.z,o.canonical.x,o.canonical.y),M=u?this._alignedPosMatrixCache:this._posMatrixCache;if(M.has(T)){const U=M.get(T);return g?U.f32:U.f64}const A=xe(o,this.worldSize);p.S(A,u?this._alignedProjMatrix:this._viewProjMatrix,A);const O={f64:A,f32:new Float32Array(A)};return M.set(T,O),g?O.f32:O.f64}calculateFogMatrix(o){const u=o.key,g=this._fogMatrixCacheF32;if(g.has(u))return g.get(u);const v=xe(o,this.worldSize);return p.S(v,this._fogMatrix,v),g.set(u,new Float32Array(v)),g.get(u)}calculateCenterFromCameraLngLatAlt(o,u,g,v){return this._helper.calculateCenterFromCameraLngLatAlt(o,u,g,v)}_calculateNearFarZIfNeeded(o,u,g){if(!this._helper.autoCalculateNearFarZ)return;const v=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),T=o-v*this._helper._pixelPerMeter/Math.cos(u),M=v<0?T:o,A=Math.PI/2+this.pitchInRadians,O=p.ap(this.fov)*(Math.abs(Math.cos(p.ap(this.roll)))*this.height+Math.abs(Math.sin(p.ap(this.roll)))*this.width)/this.height*(.5+g.y/this.height),U=Math.sin(O)*M/Math.sin(p.an(Math.PI-A-O,.01,Math.PI-.01)),N=rt(this),H=Math.atan(N/this._helper.cameraToCenterDistance),q=p.ap(.75),te=H>q?2*H*(.5+g.y/(2*N)):q,ce=Math.sin(te)*M/Math.sin(p.an(Math.PI-A-te,.01,Math.PI-.01)),Te=Math.min(U,ce);this._helper._farZ=1.01*(Math.cos(Math.PI/2-u)*Te+M),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const o=this.centerOffset,u=Fe(this.worldSize,this.center),g=u.x,v=u.y;this._helper._pixelPerMeter=p.as(1,this.center.lat)*this.worldSize;const T=p.ap(Math.min(this.pitch,ge)),M=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(T));let A;this._calculateNearFarZIfNeeded(M,T,o),A=new Float64Array(16),p.bd(A,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),p.aA(this._invProjMatrix,A),A[8]=2*-o.x/this._helper._width,A[9]=2*o.y/this._helper._height,this._projectionMatrix=p.be(A),p.Q(A,A,[1,-1,1]),p.O(A,A,[0,0,-this._helper.cameraToCenterDistance]),p.bf(A,A,-this.rollInRadians),p.bg(A,A,this.pitchInRadians),p.bf(A,A,-this.bearingInRadians),p.O(A,A,[-g,-v,0]),this._mercatorMatrix=p.Q([],A,[this.worldSize,this.worldSize,this.worldSize]),p.Q(A,A,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=p.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,A),p.O(A,A,[0,0,-this.elevation]),this._viewProjMatrix=A,this._invViewProjMatrix=p.aA([],A);const O=[0,0,-1,1];p.aG(O,O,this._invViewProjMatrix),this._cameraPosition=[O[0]/O[3],O[1]/O[3],O[2]/O[3]],this._fogMatrix=new Float64Array(16),p.bd(this._fogMatrix,this.fovInRadians,this.width/this.height,M,this._helper._farZ),this._fogMatrix[8]=2*-o.x/this.width,this._fogMatrix[9]=2*o.y/this.height,p.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),p.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),p.bf(this._fogMatrix,this._fogMatrix,-this.rollInRadians),p.bg(this._fogMatrix,this._fogMatrix,this.pitchInRadians),p.bf(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),p.O(this._fogMatrix,this._fogMatrix,[-g,-v,0]),p.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),p.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=p.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,A);const U=this._helper._width%2/2,N=this._helper._height%2/2,H=Math.cos(this.bearingInRadians),q=Math.sin(-this.bearingInRadians),te=g-Math.round(g)+H*U+q*N,ce=v-Math.round(v)+H*N+q*U,Te=new Float64Array(A);if(p.O(Te,Te,[te>.5?te-1:te,ce>.5?ce-1:ce,0]),this._alignedProjMatrix=Te,A=p.aA(new Float64Array(16),this._pixelMatrix),!A)throw new Error("failed to invert matrix");this._pixelMatrixInverse=A,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const o=this.screenPointToMercatorCoordinate(new p.P(0,0)),u=[o.x*this.worldSize,o.y*this.worldSize,0,1];return p.aG(u,u,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const o=p.as(1,this.center.lat)*this.worldSize;return Ke(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/o).toLngLat()}lngLatToCameraDepth(o,u){const g=p.aa.fromLngLat(o),v=[g.x*this.worldSize,g.y*this.worldSize,u,1];return p.aG(v,v,this._viewProjMatrix),v[2]/v[3]}getProjectionData(o){const{overscaledTileID:u,aligned:g,applyTerrainMatrix:v}=o,T=this._helper.getMercatorTileCoordinates(u),M=u?this.calculatePosMatrix(u,g,!0):null;let A;return A=u&&u.terrainRttPosMatrix32f&&v?u.terrainRttPosMatrix32f:M||p.bh(),{mainMatrix:A,tileMercatorCoords:T,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:A}}isLocationOccluded(o){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(o,u,g){return 1}transformLightDirection(o){return p.b0(o)}getRayDirectionFromPixel(o){throw new Error("Not implemented.")}projectTileCoordinates(o,u,g,v){const T=this.calculatePosMatrix(g);let M;v?(M=[o,u,v(o,u),1],p.aG(M,M,T)):(M=[o,u,0,1],Sl(M,M,T));const A=M[3];return{point:new p.P(M[0]/A,M[1]/A),signedDistanceFromCamera:A,isOccluded:!1}}populateCache(o){for(const u of o)this.calculatePosMatrix(u)}getMatrixForModel(o,u){const g=p.aa.fromLngLat(o,u),v=g.meterInMercatorCoordinateUnits(),T=p.bi();return p.O(T,T,[g.x,g.y,g.z]),p.bf(T,T,Math.PI),p.bg(T,T,Math.PI/2),p.Q(T,T,[-v,v,v]),T}getProjectionDataForCustomLayer(o=!0){const u=new p.a1(0,0,0,0,0),g=this.getProjectionData({overscaledTileID:u,applyGlobeMatrix:o}),v=xe(u,this.worldSize);p.S(v,this._viewProjMatrix,v),g.tileMercatorCoords=[0,0,1,1];const T=[p.a4,p.a4,this.worldSize/this._helper.pixelsPerMeter],M=p.bj();return p.Q(M,v,T),g.fallbackMatrix=M,g.mainMatrix=M,g}getFastPathSimpleProjectionMatrix(o){return this.calculatePosMatrix(o)}}function tl(){p.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function rr(w){if(w.useSlerp)if(w.k<1){const o=p.bk(w.startEulerAngles.roll,w.startEulerAngles.pitch,w.startEulerAngles.bearing),u=p.bk(w.endEulerAngles.roll,w.endEulerAngles.pitch,w.endEulerAngles.bearing),g=new Float64Array(4);p.bl(g,o,u,w.k);const v=p.bm(g);w.tr.setRoll(v.roll),w.tr.setPitch(v.pitch),w.tr.setBearing(v.bearing)}else w.tr.setRoll(w.endEulerAngles.roll),w.tr.setPitch(w.endEulerAngles.pitch),w.tr.setBearing(w.endEulerAngles.bearing);else w.tr.setRoll(p.G.number(w.startEulerAngles.roll,w.endEulerAngles.roll,w.k)),w.tr.setPitch(p.G.number(w.startEulerAngles.pitch,w.endEulerAngles.pitch,w.k)),w.tr.setBearing(p.G.number(w.startEulerAngles.bearing,w.endEulerAngles.bearing,w.k))}function Ts(w,o,u,g,v){const T=v.padding,M=Fe(v.worldSize,u.getNorthWest()),A=Fe(v.worldSize,u.getNorthEast()),O=Fe(v.worldSize,u.getSouthEast()),U=Fe(v.worldSize,u.getSouthWest()),N=p.ap(-g),H=M.rotate(N),q=A.rotate(N),te=O.rotate(N),ce=U.rotate(N),Te=new p.P(Math.max(H.x,q.x,ce.x,te.x),Math.max(H.y,q.y,ce.y,te.y)),De=new p.P(Math.min(H.x,q.x,ce.x,te.x),Math.min(H.y,q.y,ce.y,te.y)),we=Te.sub(De),Le=(v.width-(T.left+T.right+o.left+o.right))/we.x,je=(v.height-(T.top+T.bottom+o.top+o.bottom))/we.y;if(je<0||Le<0)return void tl();const Re=Math.min(p.at(v.scale*Math.min(Le,je)),w.maxZoom),$e=p.P.convert(w.offset),Ye=new p.P((o.left-o.right)/2,(o.top-o.bottom)/2).rotate(p.ap(g)),Ne=$e.add(Ye).mult(v.scale/p.aq(Re));return{center:Ve(v.worldSize,M.add(O).div(2).sub(Ne)),zoom:Re,bearing:g}}class cs{get useGlobeControls(){return!1}handlePanInertia(o,u){const g=o.mag(),v=Math.abs(rt(u));return{easingOffset:o.mult(Math.min(.75*v/g,1)),easingCenter:u.center}}handleMapControlsRollPitchBearingZoom(o,u){o.bearingDelta&&u.setBearing(u.bearing+o.bearingDelta),o.pitchDelta&&u.setPitch(u.pitch+o.pitchDelta),o.rollDelta&&u.setRoll(u.roll+o.rollDelta),o.zoomDelta&&u.setZoom(u.zoom+o.zoomDelta)}handleMapControlsPan(o,u,g){o.around.distSqr(u.centerPoint)<.01||u.setLocationAtPoint(g,o.around)}cameraForBoxAndBearing(o,u,g,v,T){return Ts(o,u,g,v,T)}handleJumpToCenterZoom(o,u){o.zoom!==(void 0!==u.zoom?+u.zoom:o.zoom)&&o.setZoom(+u.zoom),void 0!==u.center&&o.setCenter(p.V.convert(u.center))}handleEaseTo(o,u){const g=o.zoom,v=o.padding,T={roll:o.roll,pitch:o.pitch,bearing:o.bearing},M={roll:void 0===u.roll?o.roll:u.roll,pitch:void 0===u.pitch?o.pitch:u.pitch,bearing:void 0===u.bearing?o.bearing:u.bearing},A=void 0!==u.zoom,O=!o.isPaddingEqual(u.padding);let U=!1;const N=A?+u.zoom:o.zoom;let H=o.centerPoint.add(u.offsetAsPoint);const q=o.screenPointToLocation(H),{center:te,zoom:ce}=o.applyConstrain(p.V.convert(u.center||q),N??g);yn(o,te);const Te=Fe(o.worldSize,q),De=Fe(o.worldSize,te).sub(Te),we=p.aq(ce-g);return U=ce!==g,{easeFunc:Le=>{if(U&&o.setZoom(p.G.number(g,ce,Le)),p.bn(T,M)||rr({startEulerAngles:T,endEulerAngles:M,tr:o,k:Le,useSlerp:T.roll!=M.roll}),O&&(o.interpolatePadding(v,u.padding,Le),H=o.centerPoint.add(u.offsetAsPoint)),u.around)o.setLocationAtPoint(u.around,u.aroundPoint);else{const je=p.aq(o.zoom-g),Re=ce>g?Math.min(2,we):Math.max(.5,we),$e=Math.pow(Re,1-Le),Ye=Ve(o.worldSize,Te.add(De.mult(Le*$e)).mult(je));o.setLocationAtPoint(o.renderWorldCopies?Ye.wrap():Ye,H)}},isZooming:U,elevationCenter:te}}handleFlyTo(o,u){const g=void 0!==u.zoom,v=o.zoom,T=o.applyConstrain(p.V.convert(u.center||u.locationAtOffset),g?+u.zoom:v),M=T.center,A=T.zoom;yn(o,M);const O=Fe(o.worldSize,u.locationAtOffset),U=Fe(o.worldSize,M).sub(O),N=U.mag(),H=p.aq(A-v);let q;if(void 0!==u.minZoom){const te=Math.min(+u.minZoom,v,A),ce=o.applyConstrain(M,te).zoom;q=p.aq(ce-v)}return{easeFunc:(te,ce,Te,De)=>{o.setZoom(1===te?A:v+p.at(ce));const we=1===te?M:Ve(o.worldSize,O.add(U.mult(Te)).mult(ce));o.setLocationAtPoint(o.renderWorldCopies?we.wrap():we,De)},scaleOfZoom:H,targetCenter:M,scaleOfMinZoom:q,pixelPathLength:N}}}class fr{constructor(o,u,g){this.blendFunction=o,this.blendColor=u,this.mask=g}}fr.Replace=[1,0],fr.disabled=new fr(fr.Replace,p.bo.transparent,[!1,!1,!1,!1]),fr.unblended=new fr(fr.Replace,p.bo.transparent,[!0,!0,!0,!0]),fr.alphaBlended=new fr([1,771],p.bo.transparent,[!0,!0,!0,!0]);class ki{constructor(o,u,g){this.enable=o,this.mode=u,this.frontFace=g}}ki.disabled=new ki(!1,1029,2305),ki.backCCW=new ki(!0,1029,2305),ki.frontCCW=new ki(!0,1028,2305);class ai{constructor(o,u,g){this.func=o,this.mask=u,this.range=g}}ai.ReadOnly=!1,ai.ReadWrite=!0,ai.disabled=new ai(519,ai.ReadOnly,[0,1]);class Ri{constructor(o,u,g,v,T,M){this.test=o,this.ref=u,this.mask=g,this.fail=v,this.depthFail=T,this.pass=M}}Ri.disabled=new Ri({func:519,mask:0},0,0,7680,7680,7680);const Li=new WeakMap;function sn(w){var o;if(Li.has(w))return Li.get(w);{const u=null===(o=w.getParameter(w.VERSION))||void 0===o?void 0:o.startsWith("WebGL 2.0");return Li.set(w,u),u}}class Go{get awaitingQuery(){return!!this._readbackQueue}constructor(o){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=o;const u=o.context,g=u.gl;this._texFormat=g.RGBA,this._texType=g.UNSIGNED_BYTE;const v=new p.aV;v.emplaceBack(-1,-1),v.emplaceBack(2,-1),v.emplaceBack(-1,2);const T=new p.aX;T.emplaceBack(0,1,2),this._fullscreenTriangle=new Oa(u.createVertexBuffer(v,go.members),u.createIndexBuffer(T),p.aW.simpleSegment(0,0,v.length,T.length)),this._resultBuffer=new Uint8Array(4),u.activeTexture.set(g.TEXTURE1);const M=g.createTexture();g.bindTexture(g.TEXTURE_2D,M),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST),g.texImage2D(g.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=u.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(M),sn(g)&&(this._pbo=g.createBuffer(),g.bindBuffer(g.PIXEL_PACK_BUFFER,this._pbo),g.bufferData(g.PIXEL_PACK_BUFFER,4,g.STREAM_READ),g.bindBuffer(g.PIXEL_PACK_BUFFER,null))}destroy(){const o=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),o.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(o,u){const g=this._updateCount;return this._readbackQueue?g>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():g>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(o,u),this._updateCount++,this._measuredError}_bindFramebuffer(){const o=this._cachedRenderContext.context,u=o.gl;o.activeTexture.set(u.TEXTURE1),u.bindTexture(u.TEXTURE_2D,this._fbo.colorAttachment.get()),o.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(o,u){const g=this._cachedRenderContext.context,v=g.gl;if(this._bindFramebuffer(),g.viewport.set([0,0,this._texWidth,this._texHeight]),g.clear({color:p.bo.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(g,v.TRIANGLES,ai.disabled,Ri.disabled,fr.unblended,ki.disabled,((T,M)=>({u_input:T,u_output_expected:M}))(o,u),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&sn(v)){v.bindBuffer(v.PIXEL_PACK_BUFFER,this._pbo),v.readBuffer(v.COLOR_ATTACHMENT0),v.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),v.bindBuffer(v.PIXEL_PACK_BUFFER,null);const T=v.fenceSync(v.SYNC_GPU_COMMANDS_COMPLETE,0);v.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:T}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const o=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&sn(o)){const u=o.clientWaitSync(this._readbackQueue.sync,0,0);if(u===o.WAIT_FAILED)return p.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(u===o.TIMEOUT_EXPIRED)return;o.bindBuffer(o.PIXEL_PACK_BUFFER,this._pbo),o.getBufferSubData(o.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),o.bindBuffer(o.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),o.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Go._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(o){let u=0;return u+=o[0]/256,u+=o[1]/65536,u+=o[2]/16777216,o[3]<127&&(u=-u),u/128}}const Ds=p.a4/128;function Lc(w,o){const u=void 0!==w.granularity?Math.max(w.granularity,1):1,g=u+(w.generateBorders?2:0),v=u+(w.extendToNorthPole||w.generateBorders?1:0)+(w.extendToSouthPole||w.generateBorders?1:0),T=g+1,M=v+1,A=w.generateBorders?-1:0,O=w.generateBorders||w.extendToNorthPole?-1:0,U=u+(w.generateBorders?1:0),N=u+(w.generateBorders||w.extendToSouthPole?1:0),H=T*M,q=g*v*6,te=T*M>65536;if(te&&"16bit"===o)throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const ce=te||"32bit"===o,Te=new Int16Array(2*H);let De=0;for(let je=O;je<=N;je++)for(let Re=A;Re<=U;Re++){let $e=Re/u*p.a4;-1===Re&&($e=-Ds),Re===u+1&&($e=p.a4+Ds);let Ye=je/u*p.a4;-1===je&&(Ye=w.extendToNorthPole?p.bq:-Ds),je===u+1&&(Ye=w.extendToSouthPole?p.br:p.a4+Ds),Te[De++]=$e,Te[De++]=Ye}const we=ce?new Uint32Array(q):new Uint16Array(q);let Le=0;for(let je=0;je<v;je++)for(let Re=0;Re<g;Re++){const $e=Re+1+je*T,Ye=Re+(je+1)*T,Ne=Re+1+(je+1)*T;we[Le++]=Re+je*T,we[Le++]=Ye,we[Le++]=$e,we[Le++]=$e,we[Le++]=Ye,we[Le++]=Ne}return{vertices:Te.buffer.slice(0),indices:we.buffer.slice(0),uses32bitIndices:ce}}const ac=new p.aU({fill:new p.bs(128,2),line:new p.bs(512,0),tile:new p.bs(128,32),stencil:new p.bs(128,1),circle:3});class lc{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Zs.projectionGlobe}get vertexShaderPreludeCode(){return Zs.projectionMercator.vertexSource}get subdivisionGranularity(){return ac}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(o){this._errorMeasurement||(this._errorMeasurement=new Go(o));const u=p.X(this._errorQueryLatitudeDegrees),g=2*Math.atan(Math.exp(Math.PI-u*Math.PI*2))-.5*Math.PI,v=this._errorMeasurement.updateErrorLoop(u,g),T=ue();v!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=v,this._errorMeasurementLastChangeTime=T);const M=Math.min(Math.max((T-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=p.bt(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,p.bu(M))}_getMeshKey(o){return`${o.granularity.toString(36)}_${o.generateBorders?"b":""}${o.extendToNorthPole?"n":""}${o.extendToSouthPole?"s":""}`}getMeshFromTileID(o,u,g,v,T){const M=("stencil"===T?ac.stencil:ac.tile).getGranularityForZoomLevel(u.z);return this._getMesh(o,{granularity:M,generateBorders:g,extendToNorthPole:0===u.y&&v,extendToSouthPole:u.y===(1<<u.z)-1&&v})}_getMesh(o,u){const g=this._getMeshKey(u);if(g in this._tileMeshCache)return this._tileMeshCache[g];const v=function(T,M){const A=Lc(M,"16bit"),O=p.aV.deserialize({arrayBuffer:A.vertices,length:A.vertices.byteLength/2/2}),U=p.aX.deserialize({arrayBuffer:A.indices,length:A.indices.byteLength/2/3});return new Oa(T.createVertexBuffer(O,go.members),T.createIndexBuffer(U),p.aW.simpleSegment(0,0,O.length,U.length))}(o,u);return this._tileMeshCache[g]=v,v}recalculate(o){}hasTransition(){const o=ue();let u=!1;return u=u||(o-this._errorMeasurementLastChangeTime)/1e3<.7,u=u||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,u}setErrorQueryLatitudeDegrees(o){this._errorQueryLatitudeDegrees=o}}const cc=new p.t({type:new p.D(p.u.projection.type)});class Oc extends p.E{constructor(o){super(),this._transitionable=new p.x(cc,void 0),this.setProjection(o),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new p.H(0)),this._mercatorProjection=new $n,this._verticalPerspectiveProjection=new lc}get transitionState(){const o=this.properties.get("type");if("string"==typeof o&&"mercator"===o)return 0;if("string"==typeof o&&"vertical-perspective"===o)return 1;if(o instanceof p.bv){if("vertical-perspective"===o.from&&"mercator"===o.to)return 1-o.transition;if("mercator"===o.from&&"vertical-perspective"===o.to)return o.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(o){this._mercatorProjection.updateGPUdependent(o),this._verticalPerspectiveProjection.updateGPUdependent(o)}getMeshFromTileID(o,u,g,v,T){return this.currentProjection.getMeshFromTileID(o,u,g,v,T)}setProjection(o){this._transitionable.setValue("type",o?.type||"mercator")}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}setErrorQueryLatitudeDegrees(o){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(o),this._mercatorProjection.setErrorQueryLatitudeDegrees(o)}}function Dp(w){const o=ud(w.worldSize,w.center.lat);return 2*Math.PI*o}function nl(w,o,u,g,v){const T=1/(1<<v),M=o/p.a4*T+g*T,A=p.bx((w/p.a4*T+u*T)*Math.PI*2+Math.PI,2*Math.PI),O=2*Math.atan(Math.exp(Math.PI-M*Math.PI*2))-.5*Math.PI,U=Math.cos(O),N=new Float64Array(3);return N[0]=Math.sin(A)*U,N[1]=Math.sin(O),N[2]=Math.cos(A)*U,N}function Io(w){return function(o,u){const g=Math.cos(u),v=new Float64Array(3);return v[0]=Math.sin(o)*g,v[1]=Math.sin(u),v[2]=Math.cos(o)*g,v}(w.lng*Math.PI/180,w.lat*Math.PI/180)}function ud(w,o){return w/(2*Math.PI)/Math.cos(o*Math.PI/180)}function Ws(w){const o=Math.asin(w[1])/Math.PI*180,u=Math.sqrt(w[0]*w[0]+w[2]*w[2]);if(u>1e-6){const g=w[0]/u,v=Math.acos(w[2]/u),T=(g>0?v:-v)/Math.PI*180;return new p.V(p.W(T,-180,180),o)}return new p.V(0,o)}function Wr(w){return Math.cos(w*Math.PI/180)}function zr(w,o){const u=Wr(w),g=Wr(o);return p.at(g/u)}function _o(w,o){const u=w.rotate(o.bearingInRadians),g=o.zoom+zr(o.center.lat,0),v=p.bt(1/Wr(o.center.lat),1/Wr(Math.min(Math.abs(o.center.lat),60)),p.bw(g,7,3,0,1)),T=360/Dp({worldSize:o.worldSize,center:{lat:o.center.lat}});return new p.V(o.center.lng-u.x*T*v,p.an(o.center.lat+u.y*T,-p.ao,p.ao))}function kl(w){const o=.5*w,u=Math.sin(o),g=Math.cos(o);return Math.log(u+g)-Math.log(g-u)}function ha(w,o,u,g){const v=w.lat+u*g;if(Math.abs(u)>1){const T=(Math.sign(w.lat+u)!==Math.sign(w.lat)?-Math.abs(w.lat):Math.abs(w.lat))*Math.PI/180,M=Math.abs(w.lat+u)*Math.PI/180,A=kl(T+g*(M-T)),O=kl(T),U=kl(M);return new p.V(w.lng+o*((A-O)/(U-O)),v)}return new p.V(w.lng+o*g,v)}class Rl{constructor(o){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=o}swapBuffers(){if(!this._hadAnyChanges)return;const o=this._cachePrevious;this._cachePrevious=this._cache,this._cache=o,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(o,u,g,v){const T=`${o.z}_${o.x}_${o.y}_${v?.terrain?"t":""}`,M=this._cache.get(T);if(M)return M;const A=this._cachePrevious.get(T);if(A)return this._cache.set(T,A),A;const O=this._boundingVolumeFactory(o,u,g,v);return this._cache.set(T,O),this._hadAnyChanges=!0,O}}class da{constructor(o,u,g,v){this.min=g,this.max=v,this.points=o,this.planes=u}static fromAabb(o,u){const g=[];for(let v=0;v<8;v++)g.push([1&~v?o[0]:u[0],1==(v>>1&1)?u[1]:o[1],1==(v>>2&1)?u[2]:o[2]]);return new da(g,[[-1,0,0,u[0]],[1,0,0,-o[0]],[0,-1,0,u[1]],[0,1,0,-o[1]],[0,0,-1,u[2]],[0,0,1,-o[2]]],o,u)}static fromCenterSizeAngles(o,u,g){const v=p.bA([],g[0],g[1],g[2]),T=p.bB([],[u[0],0,0],v),M=p.bB([],[0,u[1],0],v),A=p.bB([],[0,0,u[2]],v),O=[...o],U=[...o];for(let H=0;H<8;H++)for(let q=0;q<3;q++){const te=o[q]+T[q]*(1&~H?-1:1)+M[q]*(1==(H>>1&1)?1:-1)+A[q]*(1==(H>>2&1)?1:-1);O[q]=Math.min(O[q],te),U[q]=Math.max(U[q],te)}const N=[];for(let H=0;H<8;H++){const q=[...o];p.a$(q,q,p.a_([],T,1&~H?-1:1)),p.a$(q,q,p.a_([],M,1==(H>>1&1)?1:-1)),p.a$(q,q,p.a_([],A,1==(H>>2&1)?1:-1)),N.push(q)}return new da(N,[[...T,-p.b4(T,N[0])],[...M,-p.b4(M,N[0])],[...A,-p.b4(A,N[0])],[-T[0],-T[1],-T[2],-p.b4(T,N[7])],[-M[0],-M[1],-M[2],-p.b4(M,N[7])],[-A[0],-A[1],-A[2],-p.b4(A,N[7])]],O,U)}intersectsFrustum(o){let u=!0;const g=this.points.length,v=this.planes.length,T=o.planes.length,M=o.points.length;for(let A=0;A<T;A++){const O=o.planes[A];let U=0;for(let N=0;N<g;N++){const H=this.points[N];O[0]*H[0]+O[1]*H[1]+O[2]*H[2]+O[3]>=0&&U++}if(0===U)return 0;U<g&&(u=!1)}if(u)return 2;for(let A=0;A<v;A++){const O=this.planes[A];let U=0;for(let N=0;N<M;N++){const H=o.points[N];O[0]*H[0]+O[1]*H[1]+O[2]*H[2]+O[3]>=0&&U++}if(0===U)return 0}return 1}intersectsPlane(o){const u=this.points.length;let g=0;for(let v=0;v<u;v++){const T=this.points[v];o[0]*T[0]+o[1]*T[1]+o[2]*T[2]+o[3]>=0&&g++}return g===u?2:0===g?0:1}}function li(w,o,u){const g=w-o;return g<0?-g:Math.max(0,g-u)}function Yi(w,o,u,g,v){const T=w-u;let M;return M=T<0?Math.min(-T,1+T-v):T>1?Math.min(Math.max(T-v,0),1-T):0,Math.max(M,li(o,g,v))}class ig{constructor(){this._boundingVolumeCache=new Rl(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(o,u,g,v){const T=1<<g.z,M=1/T,A=g.x/T,O=g.y/T;let U=2;return U=Math.min(U,Yi(o,u,A,O,M)),U=Math.min(U,Yi(o,u,A+.5,-O-M,M)),U=Math.min(U,Yi(o,u,A+.5,2-O-M,M)),U}getWrap(o,u,g){const v=1<<u.z,T=1/v,M=u.x/v,A=li(o.x,M,T),O=li(o.x,M-1,T),U=li(o.x,M+1,T),N=Math.min(A,O,U);return N===U?1:N===O?-1:0}allowVariableZoom(o,u){return Bn(o,u)>4}allowWorldCopies(){return!1}getTileBoundingVolume(o,u,g,v){return this._boundingVolumeCache.getTileBoundingVolume(o,u,g,v)}_computeTileBoundingVolume(o,u,g,v){var T,M;let A=0,O=0;if(v?.terrain){const U=new p.a1(o.z,u,o.z,o.x,o.y),N=v.terrain.getMinMaxElevation(U);A=null!==(T=N.minElevation)&&void 0!==T?T:Math.min(0,g),O=null!==(M=N.maxElevation)&&void 0!==M?M:Math.max(0,g)}if(A/=p.bD,O/=p.bD,A+=1,O+=1,o.z<=0)return da.fromAabb([-O,-O,-O],[O,O,O]);if(1===o.z)return da.fromAabb([0===o.x?-O:0,0===o.y?0:-O,-O],[0===o.x?0:O,0===o.y?O:0,O]);{const U=[nl(0,0,o.x,o.y,o.z),nl(p.a4,0,o.x,o.y,o.z),nl(p.a4,p.a4,o.x,o.y,o.z),nl(0,p.a4,o.x,o.y,o.z)],N=[];for(const ft of U)N.push(p.a_([],ft,O));if(O!==A)for(const ft of U)N.push(p.a_([],ft,A));0===o.y&&N.push([0,1,0]),o.y===(1<<o.z)-1&&N.push([0,-1,0]);const H=[1,1,1],q=[-1,-1,-1];for(const ft of N)for(let _t=0;_t<3;_t++)H[_t]=Math.min(H[_t],ft[_t]),q[_t]=Math.max(q[_t],ft[_t]);const te=nl(p.a4/2,p.a4/2,o.x,o.y,o.z),ce=p.b3([],[0,1,0],te);p.b2(ce,ce);const Te=p.b3([],te,ce);p.b2(Te,Te);const De=p.b3([],U[2],U[1]);p.b2(De,De);const we=p.b3([],U[0],U[3]);p.b2(we,we),N.push(p.a_([],te,O)),o.y>=(1<<o.z)/2&&N.push(p.a_([],nl(p.a4/2,0,o.x,o.y,o.z),O)),o.y<(1<<o.z)/2&&N.push(p.a_([],nl(p.a4/2,p.a4,o.x,o.y,o.z),O));const Le=nf(te,N),je=nf(Te,N),Re=[-te[0],-te[1],-te[2],Le.max],$e=[te[0],te[1],te[2],-Le.min],Ye=[-Te[0],-Te[1],-Te[2],je.max],Ne=[Te[0],Te[1],Te[2],-je.min],Qe=[...De,0],gt=[...we,0],lt=[];return 0===o.y?lt.push(p.bC(gt,Qe,Re),p.bC(gt,Qe,$e)):lt.push(p.bC(Ye,Qe,Re),p.bC(Ye,Qe,$e),p.bC(Ye,gt,Re),p.bC(Ye,gt,$e)),o.y===(1<<o.z)-1?lt.push(p.bC(gt,Qe,Re),p.bC(gt,Qe,$e)):lt.push(p.bC(Ne,Qe,Re),p.bC(Ne,Qe,$e),p.bC(Ne,gt,Re),p.bC(Ne,gt,$e)),new da(lt,[Re,$e,Ye,Ne,Qe,gt],H,q)}}}function nf(w,o){let u=1/0,g=-1/0;for(const v of o){const T=p.b4(w,v);u=Math.min(u,T),g=Math.max(g,T)}return{min:u,max:g}}class uc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(o){this._helper.setMinZoom(o)}setMaxZoom(o){this._helper.setMaxZoom(o)}setMinPitch(o){this._helper.setMinPitch(o)}setMaxPitch(o){this._helper.setMaxPitch(o)}setRenderWorldCopies(o){this._helper.setRenderWorldCopies(o)}setBearing(o){this._helper.setBearing(o)}setPitch(o){this._helper.setPitch(o)}setRoll(o){this._helper.setRoll(o)}setFov(o){this._helper.setFov(o)}setZoom(o){this._helper.setZoom(o)}setCenter(o){this._helper.setCenter(o)}setElevation(o){this._helper.setElevation(o)}setMinElevationForCurrentTile(o){this._helper.setMinElevationForCurrentTile(o)}setPadding(o){this._helper.setPadding(o)}interpolatePadding(o,u,g){return this._helper.interpolatePadding(o,u,g)}isPaddingEqual(o){return this._helper.isPaddingEqual(o)}resize(o,u){this._helper.resize(o,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(o){this._helper.setMaxBounds(o)}setConstrainOverride(o){this._helper.setConstrainOverride(o)}overrideNearFarZ(o,u){this._helper.overrideNearFarZ(o,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(o){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),o)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(o){}constructor(o){this._cachedClippingPlane=p.bE(),this._projectionMatrix=p.bi(),this._globeViewProjMatrix32f=p.bh(),this._globeViewProjMatrixNoCorrection=p.bi(),this._globeViewProjMatrixNoCorrectionInverted=p.bi(),this._globeProjMatrixInverted=p.bi(),this._cameraPosition=p.by(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(u,g)=>{const v=p.an(u.lat,-p.ao,p.ao),T=p.an(+g,this.minZoom+zr(0,v),this.maxZoom);return{center:new p.V(u.lng,v),zoom:T}},this.applyConstrain=(u,g)=>this._helper.applyConstrain(u,g),this._helper=new ls({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(u,g)=>this.defaultConstrain(u,g)},o),this._coveringTilesDetailsProvider=new ig}clone(){const o=new uc;return o.apply(this),o}apply(o,u){this._globeLatitudeErrorCorrectionRadians=u||0,this._helper.apply(o)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const o=p.by();return o[0]=this._cameraPosition[0],o[1]=this._cameraPosition[1],o[2]=this._cameraPosition[2],o}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(o){const{overscaledTileID:u,applyGlobeMatrix:g}=o,v=this._helper.getMercatorTileCoordinates(u);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:v,clippingPlane:this._cachedClippingPlane,projectionTransition:g?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(o){const u=this.pitchInRadians,g=this.cameraToCenterDistance/o,v=Math.sin(u)*g,T=Math.cos(u)*g+1,M=1/Math.sqrt(v*v+T*T)*1;let A=-v,O=T;const U=Math.sqrt(A*A+O*O);A/=U,O/=U;const N=[0,A,O];p.bF(N,N,[0,0,0],-this.bearingInRadians),p.bG(N,N,[0,0,0],-1*this.center.lat*Math.PI/180),p.bH(N,N,[0,0,0],this.center.lng*Math.PI/180);const H=1/p.b6(N);return p.a_(N,N,H),[...N,-M*H]}isLocationOccluded(o){return!this.isSurfacePointVisible(Io(o))}transformLightDirection(o){const u=this._helper._center.lng*Math.PI/180,g=this._helper._center.lat*Math.PI/180,v=Math.cos(g),T=[Math.sin(u)*v,Math.sin(g),Math.cos(u)*v],M=[T[2],0,-T[0]],A=[0,0,0];p.b3(A,M,T),p.b2(M,M),p.b2(A,A);const O=[0,0,0];return p.b2(O,[M[0]*o[0]+A[0]*o[1]+T[0]*o[2],M[1]*o[0]+A[1]*o[1]+T[1]*o[2],M[2]*o[0]+A[2]*o[1]+T[2]*o[2]]),O}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(o,u,g){const v=function(A,O,U){const N=1/(1<<U.z);return new p.aa(A/p.a4*N+U.x*N,O/p.a4*N+U.y*N)}(o,u,g.canonical),T=(M=v.y,[p.bx(v.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-M*Math.PI*2))-.5*Math.PI]);var M;return this.getCircleRadiusCorrection()/Math.cos(T[1])}projectTileCoordinates(o,u,g,v){const T=g.canonical,M=nl(o,u,T.x,T.y,T.z),A=1+(v?v(o,u):0)/p.bD,O=[M[0]*A,M[1]*A,M[2]*A,1];p.aG(O,O,this._globeViewProjMatrixNoCorrection);const U=this._cachedClippingPlane,N=U[0]*M[0]+U[1]*M[1]+U[2]*M[2]+U[3]<0;return{point:new p.P(O[0]/O[3],O[1]/O[3]),signedDistanceFromCamera:O[3],isOccluded:N}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const o=ud(this.worldSize,this.center.lat),u=p.bj(),g=p.bj();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*o),p.bd(u,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const v=this.centerOffset;u[8]=2*-v.x/this._helper._width,u[9]=2*v.y/this._helper._height,this._projectionMatrix=p.be(u),this._globeProjMatrixInverted=p.bj(),p.aA(this._globeProjMatrixInverted,u),p.O(u,u,[0,0,-this.cameraToCenterDistance]),p.bf(u,u,this.rollInRadians),p.bg(u,u,-this.pitchInRadians),p.bf(u,u,this.bearingInRadians),p.O(u,u,[0,0,-o]);const T=p.by();T[0]=o,T[1]=o,T[2]=o,p.bg(g,u,this.center.lat*Math.PI/180),p.bI(g,g,-this.center.lng*Math.PI/180),p.Q(g,g,T),this._globeViewProjMatrixNoCorrection=g,p.bg(u,u,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),p.bI(u,u,-this.center.lng*Math.PI/180),p.Q(u,u,T),this._globeViewProjMatrix32f=new Float32Array(u),this._globeViewProjMatrixNoCorrectionInverted=p.bj(),p.aA(this._globeViewProjMatrixNoCorrectionInverted,g);const M=p.by();this._cameraPosition=p.by(),this._cameraPosition[2]=this.cameraToCenterDistance/o,p.bF(this._cameraPosition,this._cameraPosition,M,-this.rollInRadians),p.bG(this._cameraPosition,this._cameraPosition,M,this.pitchInRadians),p.bF(this._cameraPosition,this._cameraPosition,M,-this.bearingInRadians),p.a$(this._cameraPosition,this._cameraPosition,[0,0,1]),p.bG(this._cameraPosition,this._cameraPosition,M,-this.center.lat*Math.PI/180),p.bH(this._cameraPosition,this._cameraPosition,M,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(o);const A=p.be(this._globeViewProjMatrixNoCorrectionInverted);p.Q(A,A,[1,1,-1]),this._cachedFrustum=qs.fromInvProjectionMatrix(A,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(o){p.w("calculateFogMatrix is not supported on globe projection.");const u=p.bj();return p.ar(u),u}getVisibleUnwrappedCoordinates(o){return[new p.bb(0,o)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(o){o&&p.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(o,u){if(!this._globeViewProjMatrixNoCorrection)return 1;const g=Io(o);p.a_(g,g,1+u/p.bD);const v=p.bE();return p.aG(v,[g[0],g[1],g[2],1],this._globeViewProjMatrixNoCorrection),v[2]/v[3]}populateCache(o){}getBounds(){const o=.5*this.width,u=.5*this.height,g=[new p.P(0,0),new p.P(o,0),new p.P(this.width,0),new p.P(this.width,u),new p.P(this.width,this.height),new p.P(o,this.height),new p.P(0,this.height),new p.P(0,u)],v=[];for(const H of g)v.push(this.unprojectScreenPoint(H));let T=0,M=0,A=0,O=0;const U=this.center;for(const H of v){const q=p.bJ(U.lng,H.lng),te=p.bJ(U.lat,H.lat);q<M&&(M=q),q>T&&(T=q),te<O&&(O=te),te>A&&(A=te)}const N=[U.lng+M,U.lat+O,U.lng+T,U.lat+A];return this.isSurfacePointOnScreen([0,1,0])&&(N[3]=90,N[0]=-180,N[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(N[1]=-90,N[0]=-180,N[2]=180),new Oe(N)}calculateCenterFromCameraLngLatAlt(o,u,g,v){return this._helper.calculateCenterFromCameraLngLatAlt(o,u,g,v)}setLocationAtPoint(o,u){const g=Io(this.unprojectScreenPoint(u)),v=Io(o),T=p.by();p.bK(T);const M=p.by();p.bH(M,g,T,-this.center.lng*Math.PI/180),p.bG(M,M,T,this.center.lat*Math.PI/180);const A=v[0]*v[0]+v[2]*v[2],O=M[0]*M[0];if(A<O)return;const U=Math.sqrt(A-O),N=-U,H=p.bL(v[0],v[2],M[0],U),q=p.bL(v[0],v[2],M[0],N),te=p.by();p.bH(te,v,T,-H);const ce=p.bL(te[1],te[2],M[1],M[2]),Te=p.by();p.bH(Te,v,T,-q);const De=p.bL(Te[1],Te[2],M[1],M[2]),we=.5*Math.PI,Le=ce>=-we&&ce<=we,je=De>=-we&&De<=we;let Re,$e;if(Le&&je){const gt=this.center.lng*Math.PI/180,lt=this.center.lat*Math.PI/180;p.bM(H,gt)+p.bM(ce,lt)<p.bM(q,gt)+p.bM(De,lt)?(Re=H,$e=ce):(Re=q,$e=De)}else if(Le)Re=H,$e=ce;else{if(!je)return;Re=q,$e=De}const Ye=Re/Math.PI*180,Ne=$e/Math.PI*180,Qe=this.center.lat;this.setCenter(new p.V(Ye,p.an(Ne,-90,90))),this.setZoom(this.zoom+zr(Qe,this.center.lat))}locationToScreenPoint(o,u){const g=Io(o);if(u){const v=u.getElevationForLngLatZoom(o,this._helper._tileZoom);p.a_(g,g,1+v/p.bD)}return this._projectSurfacePointToScreen(g)}_projectSurfacePointToScreen(o){const u=p.bE();return p.aG(u,[...o,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],new p.P((.5*u[0]+.5)*this.width,(.5*-u[1]+.5)*this.height)}screenPointToMercatorCoordinate(o,u){if(u){const g=u.pointCoordinate(o);if(g)return g}return p.aa.fromLngLat(this.unprojectScreenPoint(o))}screenPointToLocation(o,u){var g;return null===(g=this.screenPointToMercatorCoordinate(o,u))||void 0===g?void 0:g.toLngLat()}isPointOnMapSurface(o,u){const g=this._cameraPosition,v=this.getRayDirectionFromPixel(o);return!!this.rayPlanetIntersection(g,v)}getRayDirectionFromPixel(o){const u=p.bE();u[0]=o.x/this.width*2-1,u[1]=-1*(o.y/this.height*2-1),u[2]=1,u[3]=1,p.aG(u,u,this._globeViewProjMatrixNoCorrectionInverted),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3];const g=p.by();g[0]=u[0]-this._cameraPosition[0],g[1]=u[1]-this._cameraPosition[1],g[2]=u[2]-this._cameraPosition[2];const v=p.by();return p.b2(v,g),v}isSurfacePointVisible(o){const u=this._cachedClippingPlane;return u[0]*o[0]+u[1]*o[1]+u[2]*o[2]+u[3]>=0}isSurfacePointOnScreen(o){if(!this.isSurfacePointVisible(o))return!1;const u=p.bE();return p.aG(u,[...o,1],this._globeViewProjMatrixNoCorrection),u[0]/=u[3],u[1]/=u[3],u[2]/=u[3],u[0]>-1&&u[0]<1&&u[1]>-1&&u[1]<1&&u[2]>-1&&u[2]<1}rayPlanetIntersection(o,u){const g=p.b4(o,u),v=p.by(),T=p.by();p.a_(T,u,g),p.b1(v,o,T);const M=1-p.b4(v,v);if(M<0)return null;const A=p.b4(o,o)-1,O=-g+(g<0?1:-1)*Math.sqrt(M),U=A/O,N=O;return{tMin:Math.min(U,N),tMax:Math.max(U,N)}}unprojectScreenPoint(o){const u=this._cameraPosition,g=this.getRayDirectionFromPixel(o),v=this.rayPlanetIntersection(u,g);if(v){const N=p.by();p.a$(N,u,[g[0]*v.tMin,g[1]*v.tMin,g[2]*v.tMin]);const H=p.by();return p.b2(H,N),Ws(H)}const T=this._cachedClippingPlane,M=T[0]*g[0]+T[1]*g[1]+T[2]*g[2],A=-p.ba(T,u)/M,O=p.by();if(A>0)p.a$(O,u,[g[0]*A,g[1]*A,g[2]*A]);else{const N=p.by();p.a$(N,u,[2*g[0],2*g[1],2*g[2]]);const H=p.ba(this._cachedClippingPlane,N);p.b1(O,N,[this._cachedClippingPlane[0]*H,this._cachedClippingPlane[1]*H,this._cachedClippingPlane[2]*H])}const U=function(N){const H=p.by();return H[0]=N[0]*-N[3],H[1]=N[1]*-N[3],H[2]=N[2]*-N[3],{center:H,radius:Math.sqrt(1-N[3]*N[3])}}(T);return Ws(function(N,H,q){const te=p.by();p.b1(te,q,N);const ce=p.by();return p.bz(ce,N,te,H/p.b8(te)),ce}(U.center,U.radius,O))}getMatrixForModel(o,u){const g=p.V.convert(o),v=1/p.bD,T=p.bi();return p.bI(T,T,g.lng/180*Math.PI),p.bg(T,T,-g.lat/180*Math.PI),p.O(T,T,[0,0,1+u/p.bD]),p.bg(T,T,.5*Math.PI),p.Q(T,T,[v,v,v]),T}getProjectionDataForCustomLayer(o=!0){const u=this.getProjectionData({overscaledTileID:new p.a1(0,0,0,0,0),applyGlobeMatrix:o});return u.tileMercatorCoords=[0,0,1,1],u}getFastPathSimpleProjectionMatrix(o){}}class hd{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(o){this._helper.setMinZoom(o)}setMaxZoom(o){this._helper.setMaxZoom(o)}setMinPitch(o){this._helper.setMinPitch(o)}setMaxPitch(o){this._helper.setMaxPitch(o)}setRenderWorldCopies(o){this._helper.setRenderWorldCopies(o)}setBearing(o){this._helper.setBearing(o)}setPitch(o){this._helper.setPitch(o)}setRoll(o){this._helper.setRoll(o)}setFov(o){this._helper.setFov(o)}setZoom(o){this._helper.setZoom(o)}setCenter(o){this._helper.setCenter(o)}setElevation(o){this._helper.setElevation(o)}setMinElevationForCurrentTile(o){this._helper.setMinElevationForCurrentTile(o)}setPadding(o){this._helper.setPadding(o)}interpolatePadding(o,u,g){return this._helper.interpolatePadding(o,u,g)}isPaddingEqual(o){return this._helper.isPaddingEqual(o)}resize(o,u,g=!0){this._helper.resize(o,u,g)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(o){this._helper.setMaxBounds(o)}setConstrainOverride(o){this._helper.setConstrainOverride(o)}overrideNearFarZ(o,u){this._helper.overrideNearFarZ(o,u)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(o){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),o)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(o,u){this._globeness=o,this._globeLatitudeErrorCorrectionRadians=u,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(o){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(u,g)=>this.currentTransform.defaultConstrain(u,g),this.applyConstrain=(u,g)=>this._helper.applyConstrain(u,g),this._helper=new ls({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(u,g)=>this.defaultConstrain(u,g)},o),this._globeness=1,this._mercatorTransform=new an,this._verticalPerspectiveTransform=new uc}clone(){const o=new hd;return o._globeness=this._globeness,o._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,o.apply(this),o}apply(o){this._helper.apply(o),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(o){const u=this._mercatorTransform.getProjectionData(o),g=this._verticalPerspectiveTransform.getProjectionData(o);return{mainMatrix:this.isGlobeRendering?g.mainMatrix:u.mainMatrix,clippingPlane:g.clippingPlane,tileMercatorCoords:g.tileMercatorCoords,projectionTransition:o.applyGlobeMatrix?this._globeness:0,fallbackMatrix:u.fallbackMatrix}}isLocationOccluded(o){return this.currentTransform.isLocationOccluded(o)}transformLightDirection(o){return this.currentTransform.transformLightDirection(o)}getPixelScale(){return p.bt(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return p.bt(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(o,u,g){const v=this._mercatorTransform.getPitchedTextCorrection(o,u,g),T=this._verticalPerspectiveTransform.getPitchedTextCorrection(o,u,g);return p.bt(v,T,this._globeness)}projectTileCoordinates(o,u,g,v){return this.currentTransform.projectTileCoordinates(o,u,g,v)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(o){return this.currentTransform.calculateFogMatrix(o)}getVisibleUnwrappedCoordinates(o){return this.currentTransform.getVisibleUnwrappedCoordinates(o)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(o){this._mercatorTransform.recalculateZoomAndCenter(o),this._verticalPerspectiveTransform.recalculateZoomAndCenter(o)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(o,u){return this.currentTransform.lngLatToCameraDepth(o,u)}populateCache(o){this._mercatorTransform.populateCache(o),this._verticalPerspectiveTransform.populateCache(o)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(o,u,g,v){return this._helper.calculateCenterFromCameraLngLatAlt(o,u,g,v)}setLocationAtPoint(o,u){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(o,u),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(o,u),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(o,u){return this.currentTransform.locationToScreenPoint(o,u)}screenPointToMercatorCoordinate(o,u){return this.currentTransform.screenPointToMercatorCoordinate(o,u)}screenPointToLocation(o,u){return this.currentTransform.screenPointToLocation(o,u)}isPointOnMapSurface(o,u){return this.currentTransform.isPointOnMapSurface(o,u)}getRayDirectionFromPixel(o){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(o)}getMatrixForModel(o,u){return this.currentTransform.getMatrixForModel(o,u)}getProjectionDataForCustomLayer(o=!0){const u=this._mercatorTransform.getProjectionDataForCustomLayer(o);if(!this.isGlobeRendering)return u;const g=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(o);return g.fallbackMatrix=u.mainMatrix,g}getFastPathSimpleProjectionMatrix(o){return this.currentTransform.getFastPathSimpleProjectionMatrix(o)}}class us{get useGlobeControls(){return!0}handlePanInertia(o,u){const g=_o(o,u);return Math.abs(g.lng-u.center.lng)>180&&(g.lng=u.center.lng+179.5*Math.sign(g.lng-u.center.lng)),{easingCenter:g,easingOffset:new p.P(0,0)}}handleMapControlsRollPitchBearingZoom(o,u){const g=o.around,v=u.screenPointToLocation(g);o.bearingDelta&&u.setBearing(u.bearing+o.bearingDelta),o.pitchDelta&&u.setPitch(u.pitch+o.pitchDelta),o.rollDelta&&u.setRoll(u.roll+o.rollDelta);const T=u.zoom;o.zoomDelta&&u.setZoom(u.zoom+o.zoomDelta);const M=u.zoom-T;if(0===M)return;const A=p.bJ(u.center.lng,v.lng),O=A/(Math.abs(A/180)+1),U=p.bJ(u.center.lat,v.lat),N=u.getRayDirectionFromPixel(g),H=u.cameraPosition,q=-1*p.b4(H,N),te=p.by();p.a$(te,H,[N[0]*q,N[1]*q,N[2]*q]);const ce=p.b6(te)-1,Te=Math.exp(.5*-Math.max(ce-.3,0)),De=ud(u.worldSize,u.center.lat)/Math.min(u.width,u.height),we=p.bw(De,.9,.5,1,.25),Le=(1-p.aq(-M))*Math.min(Te,we),je=u.center.lat,Re=u.zoom,$e=new p.V(u.center.lng+O*Le,p.an(u.center.lat+U*Le,-p.ao,p.ao));u.setLocationAtPoint(v,g);const Ye=u.center,Ne=p.bw(Math.abs(A),45,85,0,1),Qe=p.bw(De,.75,.35,0,1),gt=Math.pow(Math.max(Ne,Qe),.25),lt=p.bJ(Ye.lng,$e.lng),ft=p.bJ(Ye.lat,$e.lat);u.setCenter(new p.V(Ye.lng+lt*gt,Ye.lat+ft*gt).wrap()),u.setZoom(Re+zr(je,u.center.lat))}handleMapControlsPan(o,u,g){if(!o.panDelta)return;const v=u.center.lat,T=u.zoom;u.setCenter(_o(o.panDelta,u).wrap()),u.setZoom(T+zr(v,u.center.lat))}cameraForBoxAndBearing(o,u,g,v,T){const M=Ts(o,u,g,v,T),A=u.left/T.width*2-1,O=(T.width-u.right)/T.width*2-1,U=u.top/T.height*-2+1,N=(T.height-u.bottom)/T.height*-2+1,H=p.bJ(g.getWest(),g.getEast())<0,q=H?g.getEast():g.getWest(),te=H?g.getWest():g.getEast(),ce=Math.max(g.getNorth(),g.getSouth()),Te=Math.min(g.getNorth(),g.getSouth()),De=q+.5*p.bJ(q,te),we=ce+.5*p.bJ(ce,Te),Le=T.clone();Le.setCenter(M.center),Le.setBearing(M.bearing),Le.setPitch(0),Le.setRoll(0),Le.setZoom(M.zoom);const je=Le.modelViewProjectionMatrix,Re=[Io(g.getNorthWest()),Io(g.getNorthEast()),Io(g.getSouthWest()),Io(g.getSouthEast()),Io(new p.V(te,we)),Io(new p.V(q,we)),Io(new p.V(De,ce)),Io(new p.V(De,Te))],$e=Io(M.center);let Ye=Number.POSITIVE_INFINITY;for(const Ne of Re)A<0&&(Ye=us.getLesserNonNegativeNonNull(Ye,us.solveVectorScale(Ne,$e,je,"x",A))),O>0&&(Ye=us.getLesserNonNegativeNonNull(Ye,us.solveVectorScale(Ne,$e,je,"x",O))),U>0&&(Ye=us.getLesserNonNegativeNonNull(Ye,us.solveVectorScale(Ne,$e,je,"y",U))),N<0&&(Ye=us.getLesserNonNegativeNonNull(Ye,us.solveVectorScale(Ne,$e,je,"y",N)));if(Number.isFinite(Ye)&&0!==Ye)return M.zoom=Le.zoom+p.at(Ye),M;tl()}handleJumpToCenterZoom(o,u){const g=o.center.lat,v=o.applyConstrain(u.center?p.V.convert(u.center):o.center,o.zoom).center;o.setCenter(v.wrap());const T=void 0!==u.zoom?+u.zoom:o.zoom+zr(g,v.lat);o.zoom!==T&&o.setZoom(T)}handleEaseTo(o,u){const g=o.zoom,v=o.center,T=o.padding,M={roll:o.roll,pitch:o.pitch,bearing:o.bearing},A={roll:void 0===u.roll?o.roll:u.roll,pitch:void 0===u.pitch?o.pitch:u.pitch,bearing:void 0===u.bearing?o.bearing:u.bearing},O=void 0!==u.zoom,U=!o.isPaddingEqual(u.padding);let N=!1;const H=u.center?p.V.convert(u.center):v,q=o.applyConstrain(H,g).center;yn(o,q);const te=o.clone();te.setCenter(q),te.setZoom(O?+u.zoom:g+zr(v.lat,H.lat)),te.setBearing(u.bearing);const ce=new p.P(p.an(o.centerPoint.x+u.offsetAsPoint.x,0,o.width),p.an(o.centerPoint.y+u.offsetAsPoint.y,0,o.height));te.setLocationAtPoint(q,ce);const Te=(u.offset&&u.offsetAsPoint.mag())>0?te.center:q,De=O?+u.zoom:g+zr(v.lat,Te.lat),we=g+zr(v.lat,0),Le=De+zr(Te.lat,0),je=p.bJ(v.lng,Te.lng),Re=p.bJ(v.lat,Te.lat),$e=p.aq(Le-we);return N=De!==g,{easeFunc:Ye=>{if(p.bn(M,A)||rr({startEulerAngles:M,endEulerAngles:A,tr:o,k:Ye,useSlerp:M.roll!=A.roll}),U&&o.interpolatePadding(T,u.padding,Ye),u.around)p.w("Easing around a point is not supported under globe projection."),o.setLocationAtPoint(u.around,u.aroundPoint);else{const Ne=Le>we?Math.min(2,$e):Math.max(.5,$e),Qe=Math.pow(Ne,1-Ye),gt=ha(v,je,Re,Ye*Qe);o.setCenter(gt.wrap())}if(N){const Ne=p.G.number(we,Le,Ye)+zr(0,o.center.lat);o.setZoom(Ne)}},isZooming:N,elevationCenter:Te}}handleFlyTo(o,u){const g=void 0!==u.zoom,v=o.center,T=o.zoom,M=o.padding,A=!o.isPaddingEqual(u.padding),O=o.applyConstrain(p.V.convert(u.center||u.locationAtOffset),T).center,U=g?+u.zoom:o.zoom+zr(o.center.lat,O.lat),N=o.clone();N.setCenter(O),N.setZoom(U),N.setBearing(u.bearing);const H=new p.P(p.an(o.centerPoint.x+u.offsetAsPoint.x,0,o.width),p.an(o.centerPoint.y+u.offsetAsPoint.y,0,o.height));N.setLocationAtPoint(O,H);const q=N.center;yn(o,q);const te=function(Re,$e,Ye){const Ne=Io($e),Qe=Io(Ye),gt=p.b4(Ne,Qe),lt=Math.acos(gt),ft=Dp(Re);return lt/(2*Math.PI)*ft}(o,v,q),ce=T+zr(v.lat,0),Te=U+zr(q.lat,0),De=p.aq(Te-ce);let we;if("number"==typeof u.minZoom){const Re=+u.minZoom+zr(q.lat,0),$e=Math.min(Re,ce,Te)+zr(0,q.lat),Ye=o.applyConstrain(q,$e).zoom+zr(q.lat,0);we=p.aq(Ye-ce)}const Le=p.bJ(v.lng,q.lng),je=p.bJ(v.lat,q.lat);return{easeFunc:(Re,$e,Ye,Ne)=>{const Qe=ha(v,Le,je,Ye);A&&o.interpolatePadding(M,u.padding,Re);const gt=1===Re?q:Qe;o.setCenter(gt.wrap());const lt=ce+p.at($e);o.setZoom(1===Re?U:lt+zr(0,gt.lat))},scaleOfZoom:De,targetCenter:q,scaleOfMinZoom:we,pixelPathLength:te}}static solveVectorScale(o,u,g,v,T){const M="x"===v?[g[0],g[4],g[8],g[12]]:[g[1],g[5],g[9],g[13]],A=[g[3],g[7],g[11],g[15]],O=o[0]*M[0]+o[1]*M[1]+o[2]*M[2],U=o[0]*A[0]+o[1]*A[1]+o[2]*A[2],N=u[0]*M[0]+u[1]*M[1]+u[2]*M[2],H=u[0]*A[0]+u[1]*A[1]+u[2]*A[2];return N+T*U===O+T*H||A[3]*(O-N)+M[3]*(H-U)+O*H==N*U?null:(N+M[3]-T*H-T*A[3])/(N-O-T*H+T*U)}static getLesserNonNegativeNonNull(o,u){return null!==u&&u>=0&&u<o?u:o}}class hc{constructor(o){this._globe=o,this._mercatorCameraHelper=new cs,this._verticalPerspectiveCameraHelper=new us}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(o,u){return this.currentHelper.handlePanInertia(o,u)}handleMapControlsRollPitchBearingZoom(o,u){return this.currentHelper.handleMapControlsRollPitchBearingZoom(o,u)}handleMapControlsPan(o,u,g){this.currentHelper.handleMapControlsPan(o,u,g)}cameraForBoxAndBearing(o,u,g,v,T){return this.currentHelper.cameraForBoxAndBearing(o,u,g,v,T)}handleJumpToCenterZoom(o,u){this.currentHelper.handleJumpToCenterZoom(o,u)}handleEaseTo(o,u){return this.currentHelper.handleEaseTo(o,u)}handleFlyTo(o,u){return this.currentHelper.handleFlyTo(o,u)}}const ci=(w,o)=>p.B(w,o&&o.filter(u=>"source.canvas"!==u.identifier)),wa=p.bN();class Fc extends p.E{constructor(o,u={}){var g,v;super(),this._rtlPluginLoaded=()=>{for(const M in this.tileManagers){const A=this.tileManagers[M].getSource().type;"vector"!==A&&"geojson"!==A||this.tileManagers[M].reload()}},this.map=o,this.dispatcher=new ir(mi(),o._getMapId()),this.dispatcher.registerMessageHandler("GG",(M,A)=>this.getGlyphs(M,A)),this.dispatcher.registerMessageHandler("GI",(M,A)=>this.getImages(M,A)),this.dispatcher.registerMessageHandler("GDA",(M,A)=>this.getDashes(M,A)),this.imageManager=new Ze,this.imageManager.setEventedParent(this);const T=(null===(g=o._container)||void 0===g?void 0:g.lang)||typeof document<"u"&&(null===(v=document.documentElement)||void 0===v?void 0:v.lang)||void 0;this.glyphManager=new Bt(o._requestManager,u.localIdeographFontFamily,T),this.lineAtlas=new Sn(256,512),this.crossTileSymbolIndex=new Pl,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",p.bO()),qi().on(ur,this._rtlPluginLoaded),this.on("data",M=>{if("source"!==M.dataType||"metadata"!==M.sourceDataType)return;const A=this.tileManagers[M.sourceId];if(!A)return;const O=A.getSource();if(O&&O.vectorLayerIds)for(const U in this._layers){const N=this._layers[U];N.source===O.id&&this._validateLayer(N)}})}_setInitialValues(){var o;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new p.bP,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new((null===(o=this.crossTileSymbolIndex)||void 0===o?void 0:o.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(o,u){var g,v,T;this._checkLoaded();const M=null===u?null!==(T=null===(v=null===(g=this.stylesheet.state)||void 0===g?void 0:g[o])||void 0===v?void 0:v.default)&&void 0!==T?T:null:u;if(p.bQ(M,this._globalState[o]))return this;this._globalState[o]=M,this._applyGlobalStateChanges([o])}getGlobalState(){return this._globalState}setGlobalState(o){this._checkLoaded();const u=[];for(const g in o)!p.bQ(this._globalState[g],o[g].default)&&(u.push(g),this._globalState[g]=o[g].default);this._applyGlobalStateChanges(u)}_applyGlobalStateChanges(o){if(0===o.length)return;const u=new Set,g={};for(const v of o){g[v]=this._globalState[v];for(const T in this._layers){const M=this._layers[T],A=M.getLayoutAffectingGlobalStateRefs(),O=M.getPaintAffectingGlobalStateRefs();if(A.has(v)&&u.add(M.source),O.has(v))for(const{name:U,value:N}of O.get(v))this._updatePaintProperty(M,U,N)}}this.dispatcher.broadcast("UGS",g);for(const v in this.tileManagers)u.has(v)&&(this._reloadSource(v),this._changed=!0)}loadURL(o,u={},g){this.fire(new p.l("dataloading",{dataType:"style"})),u.validate="boolean"!=typeof u.validate||u.validate;const v=this.map._requestManager.transformRequest(o,"Style");this._loadStyleRequest=new AbortController;const T=this._loadStyleRequest;p.j(v,this._loadStyleRequest).then(M=>{this._loadStyleRequest=null,this._load(M.data,u,g)}).catch(M=>{this._loadStyleRequest=null,M&&!T.signal.aborted&&this.fire(new p.k(M))})}loadJSON(o,u={},g){this.fire(new p.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ee.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,u.validate=!1!==u.validate,this._load(o,u,g)}).catch(()=>{})}loadEmpty(){this.fire(new p.l("dataloading",{dataType:"style"})),this._load(wa,{validate:!1})}_load(o,u,g){var v,T;let M=u.transformStyle?u.transformStyle(g,o):o;if(!u.validate||!ci(this,p.C(M))){M=Object.assign({},M),this._loaded=!0,this.stylesheet=M;for(const A in M.sources)this.addSource(A,M.sources[A],{validate:!1});M.sprite?this._loadSprite(M.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(M.glyphs),this._createLayers(),this.light=new Nn(this.stylesheet.light),this._setProjectionInternal((null===(v=this.stylesheet.projection)||void 0===v?void 0:v.type)||"mercator"),this.sky=new ht(this.stylesheet.sky),this.map.setTerrain(null!==(T=this.stylesheet.terrain)&&void 0!==T?T:null),this.fire(new p.l("data",{dataType:"style"})),this.fire(new p.l("style.load"))}}_createLayers(){var o,u,g;const v=p.bR(this.stylesheet.layers);this.setGlobalState(null!==(o=this.stylesheet.state)&&void 0!==o?o:null),this.dispatcher.broadcast("SL",v),this._order=v.map(T=>T.id),this._layers={},this._serializedLayers=null;for(const T of v){const M=p.bS(T,this._globalState);if(M.setEventedParent(this,{layer:{id:T.id}}),this._layers[T.id]=M,p.bT(M)&&this.tileManagers[M.source]){const A=null!==(g=null===(u=T.paint)||void 0===u?void 0:u["raster-fade-duration"])&&void 0!==g?g:M.paint.get("raster-fade-duration");this.tileManagers[M.source].setRasterFadeDuration(A)}}}_loadSprite(o,u=!1,g=void 0){let v;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(T,M,A,O){return p._(this,void 0,void 0,function*(){const U=Mt(T),N=A>1?"@2x":"",H={},q={};for(const{id:te,url:ce}of U){const Te=M.transformRequest(on(ce,N,".json"),"SpriteJSON");H[te]=p.j(Te,O);const De=M.transformRequest(on(ce,N,".png"),"SpriteImage");q[te]=xt.getImage(De,O)}return yield Promise.all([...Object.values(H),...Object.values(q)]),function(te,ce){return p._(this,void 0,void 0,function*(){const Te={};for(const De in te){Te[De]={};const we=ee.getImageCanvasContext((yield ce[De]).data),Le=(yield te[De]).data;for(const je in Le){const{width:Re,height:$e,x:Ye,y:Ne,sdf:Qe,pixelRatio:gt,stretchX:lt,stretchY:ft,content:_t,textFitWidth:Ht,textFitHeight:$t}=Le[je];Te[De][je]={data:null,pixelRatio:gt,sdf:Qe,stretchX:lt,stretchY:ft,content:_t,textFitWidth:Ht,textFitHeight:$t,spriteData:{width:Re,height:$e,x:Ye,y:Ne,context:we}}}}return Te})}(H,q)})}(o,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(T=>{if(this._spriteRequest=null,T)for(const M in T){this._spritesImagesIds[M]=[];const A=this._spritesImagesIds[M]?this._spritesImagesIds[M].filter(O=>!(O in T)):[];for(const O of A)this.imageManager.removeImage(O),this._changedImages[O]=!0;for(const O in T[M]){const U="default"===M?O:`${M}:${O}`;this._spritesImagesIds[M].push(U),U in this.imageManager.images?this.imageManager.updateImage(U,T[M][O],!1):this.imageManager.addImage(U,T[M][O]),u&&(this._changedImages[U]=!0)}}}).catch(T=>{this._spriteRequest=null,v=T,this.fire(new p.k(v))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),u&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new p.l("data",{dataType:"style"})),g&&g(v)})}_unloadSprite(){for(const o of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(o),this._changedImages[o]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new p.l("data",{dataType:"style"}))}_validateLayer(o){const u=this.tileManagers[o.source];if(!u)return;const g=o.sourceLayer;if(!g)return;const v=u.getSource();("geojson"===v.type||v.vectorLayerIds&&-1===v.vectorLayerIds.indexOf(g))&&this.fire(new p.k(new Error(`Source layer "${g}" does not exist on source "${v.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.tileManagers)if(!this.tileManagers[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(o,u=!1){const g=this._serializedAllLayers();if(!o||0===o.length)return Object.values(u?p.bU(g):g);const v=[];for(const T of o)if(g[T]){const M=u?p.bU(g[T]):g[T];v.push(M)}return v}_serializedAllLayers(){let o=this._serializedLayers;if(o)return o;o=this._serializedLayers={};const u=Object.keys(this._layers);for(const g of u){const v=this._layers[g];"custom"!==v.type&&(o[g]=v.serialize())}return o}hasTransitions(){var o,u,g;if(null!==(o=this.light)&&void 0!==o&&o.hasTransition()||null!==(u=this.sky)&&void 0!==u&&u.hasTransition()||null!==(g=this.projection)&&void 0!==g&&g.hasTransition())return!0;for(const v in this.tileManagers)if(this.tileManagers[v].hasTransition())return!0;for(const v in this._layers)if(this._layers[v].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const u=this._changed;if(u){const v=Object.keys(this._updatedLayers),T=Object.keys(this._removedLayers);(v.length||T.length)&&this._updateWorkerLayers(v,T);for(const M in this._updatedSources){const A=this._updatedSources[M];if("reload"===A)this._reloadSource(M);else{if("clear"!==A)throw new Error(`Invalid action ${A}`);this._clearSource(M)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const M in this._updatedPaintProps)this._layers[M].updateTransitions(o);this.light.updateTransitions(o),this.sky.updateTransitions(o),this._resetUpdates()}const g={};for(const v in this.tileManagers){const T=this.tileManagers[v];g[v]=T.used,T.used=!1}for(const v of this._order){const T=this._layers[v];T.recalculate(o,this._availableImages),!T.isHidden(o.zoom)&&T.source&&(this.tileManagers[T.source].used=!0)}for(const v in g){const T=this.tileManagers[v];!!g[v]!=!!T.used&&T.fire(new p.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:v}))}this.light.recalculate(o),this.sky.recalculate(o),this.projection.recalculate(o),this.z=o.zoom,u&&this.fire(new p.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const u in this.tileManagers)this.tileManagers[u].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const o in this.tileManagers)this.tileManagers[o].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(o,u){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(o,!1),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(o,u={}){var g;this._checkLoaded();const v=this.serialize();if(o=u.transformStyle?u.transformStyle(v,o):o,(null===(g=u.validate)||void 0===g||g)&&ci(this,p.C(o)))return!1;(o=p.bU(o)).layers=p.bR(o.layers);const T=p.bV(v,o),M=this._getOperationsToPerform(T);if(M.unimplemented.length>0)throw new Error(`Unimplemented: ${M.unimplemented.join(", ")}.`);if(0===M.operations.length)return!1;for(const A of M.operations)A();return this.stylesheet=o,this._serializedLayers=null,!0}_getOperationsToPerform(o){const u=[],g=[];for(const v of o)switch(v.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":u.push(()=>this.addLayer.apply(this,v.args));break;case"removeLayer":u.push(()=>this.removeLayer.apply(this,v.args));break;case"setPaintProperty":u.push(()=>this.setPaintProperty.apply(this,v.args));break;case"setLayoutProperty":u.push(()=>this.setLayoutProperty.apply(this,v.args));break;case"setFilter":u.push(()=>this.setFilter.apply(this,v.args));break;case"addSource":u.push(()=>this.addSource.apply(this,v.args));break;case"removeSource":u.push(()=>this.removeSource.apply(this,v.args));break;case"setLayerZoomRange":u.push(()=>this.setLayerZoomRange.apply(this,v.args));break;case"setLight":u.push(()=>this.setLight.apply(this,v.args));break;case"setGeoJSONSourceData":u.push(()=>this.setGeoJSONSourceData.apply(this,v.args));break;case"setGlyphs":u.push(()=>this.setGlyphs.apply(this,v.args));break;case"setSprite":u.push(()=>this.setSprite.apply(this,v.args));break;case"setTerrain":u.push(()=>this.map.setTerrain.apply(this,v.args));break;case"setSky":u.push(()=>this.setSky.apply(this,v.args));break;case"setProjection":this.setProjection.apply(this,v.args);break;case"setGlobalState":u.push(()=>this.setGlobalState.apply(this,v.args));break;case"setTransition":u.push(()=>{});break;default:g.push(v.command)}return{operations:u,unimplemented:g}}addImage(o,u){if(this.getImage(o))return this.fire(new p.k(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,u),this._afterImageUpdated(o)}updateImage(o,u){this.imageManager.updateImage(o,u)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new p.k(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new p.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,u,g={}){if(this._checkLoaded(),void 0!==this.tileManagers[o])throw new Error(`Source "${o}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(p.C.source,`sources.${o}`,u,null,g))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const v=this.tileManagers[o]=new Ei(o,u,this.dispatcher);v.style=this,v.setEventedParent(this,()=>({isSourceLoaded:v.loaded(),source:v.serialize(),sourceId:o})),v.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),void 0===this.tileManagers[o])throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===o)return this.fire(new p.k(new Error(`Source "${o}" cannot be removed while layer "${g}" is using it.`)));const u=this.tileManagers[o];delete this.tileManagers[o],delete this._updatedSources[o],u.fire(new p.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,u){if(this._checkLoaded(),void 0===this.tileManagers[o])throw new Error(`There is no source with this ID=${o}`);const g=this.tileManagers[o].getSource();if("geojson"!==g.type)throw new Error(`geojsonSource.type is ${g.type}, which is !== 'geojson`);g.setData(u),this._changed=!0}getSource(o){return this.tileManagers[o]&&this.tileManagers[o].getSource()}addLayer(o,u,g={}){this._checkLoaded();const v=o.id;if(this.getLayer(v))return void this.fire(new p.k(new Error(`Layer "${v}" already exists on this map.`)));let T;if("custom"===o.type){if(ci(this,p.bW(o)))return;T=p.bS(o,this._globalState)}else{if("source"in o&&"object"==typeof o.source&&(this.addSource(v,o.source),o=p.bU(o),o=p.e(o,{source:v})),this._validate(p.C.layer,`layers.${v}`,o,{arrayIndex:-1},g))return;T=p.bS(o,this._globalState),this._validateLayer(T),T.setEventedParent(this,{layer:{id:v}})}const M=u?this._order.indexOf(u):this._order.length;if(u&&-1===M)this.fire(new p.k(new Error(`Cannot add layer "${v}" before non-existing layer "${u}".`)));else{if(this._order.splice(M,0,v),this._layerOrderChanged=!0,this._layers[v]=T,this._removedLayers[v]&&T.source&&"custom"!==T.type){const A=this._removedLayers[v];delete this._removedLayers[v],A.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.tileManagers[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}moveLayer(o,u){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new p.k(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===u)return;const g=this._order.indexOf(o);this._order.splice(g,1);const v=u?this._order.indexOf(u):this._order.length;u&&-1===v?this.fire(new p.k(new Error(`Cannot move layer "${o}" before non-existing layer "${u}".`))):(this._order.splice(v,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const u=this._layers[o];if(!u)return void this.fire(new p.k(new Error(`Cannot remove non-existing layer "${o}".`)));u.setEventedParent(null);const g=this._order.indexOf(o);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=u,delete this._layers[o],this._serializedLayers&&delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],u.onRemove&&u.onRemove(this.map)}getLayer(o){return this._layers[o]}getLayersOrder(){return[...this._order]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,u,g){this._checkLoaded();const v=this.getLayer(o);v?v.minzoom===u&&v.maxzoom===g||(null!=u&&(v.minzoom=u),null!=g&&(v.maxzoom=g),this._updateLayer(v)):this.fire(new p.k(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,u,g={}){this._checkLoaded();const v=this.getLayer(o);if(v){if(!p.bQ(v.filter,u))return null==u?(v.setFilter(void 0),void this._updateLayer(v)):void(this._validate(p.C.filter,`layers.${v.id}.filter`,u,null,g)||(v.setFilter(p.bU(u)),this._updateLayer(v)))}else this.fire(new p.k(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return p.bU(this.getLayer(o).filter)}setLayoutProperty(o,u,g,v={}){this._checkLoaded();const T=this.getLayer(o);T?p.bQ(T.getLayoutProperty(u),g)||(T.setLayoutProperty(u,g,v),this._updateLayer(T)):this.fire(new p.k(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,u){const g=this.getLayer(o);if(g)return g.getLayoutProperty(u);this.fire(new p.k(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,u,g,v={}){this._checkLoaded();const T=this.getLayer(o);T?p.bQ(T.getPaintProperty(u),g)||this._updatePaintProperty(T,u,g,v):this.fire(new p.k(new Error(`Cannot style non-existing layer "${o}".`)))}_updatePaintProperty(o,u,g,v={}){o.setPaintProperty(u,g,v)&&this._updateLayer(o),p.bT(o)&&"raster-fade-duration"===u&&this.tileManagers[o.source].setRasterFadeDuration(g),this._changed=!0,this._updatedPaintProps[o.id]=!0,this._serializedLayers=null}getPaintProperty(o,u){return this.getLayer(o).getPaintProperty(u)}setFeatureState(o,u){this._checkLoaded();const g=o.source,v=o.sourceLayer,T=this.tileManagers[g];if(void 0===T)return void this.fire(new p.k(new Error(`The source '${g}' does not exist in the map's style.`)));const M=T.getSource().type;"geojson"===M&&v?this.fire(new p.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==M||v?(void 0===o.id&&this.fire(new p.k(new Error("The feature id parameter must be provided."))),T.setFeatureState(v,o.id,u)):this.fire(new p.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,u){this._checkLoaded();const g=o.source,v=this.tileManagers[g];if(void 0===v)return void this.fire(new p.k(new Error(`The source '${g}' does not exist in the map's style.`)));const T=v.getSource().type,M="vector"===T?o.sourceLayer:void 0;"vector"!==T||M?u&&"string"!=typeof o.id&&"number"!=typeof o.id?this.fire(new p.k(new Error("A feature id is required to remove its specific state property."))):v.removeFeatureState(M,o.id,u):this.fire(new p.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const u=o.source,g=o.sourceLayer,v=this.tileManagers[u];if(void 0!==v)return"vector"!==v.getSource().type||g?(void 0===o.id&&this.fire(new p.k(new Error("The feature id parameter must be provided."))),v.getFeatureState(g,o.id)):void this.fire(new p.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new p.k(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return p.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const o=p.bX(this.tileManagers,T=>T.serialize()),u=this._serializeByIds(this._order,!0),g=this.map.getTerrain()||void 0,v=this.stylesheet;return p.bY({version:v.version,name:v.name,metadata:v.metadata,light:v.light,sky:v.sky,center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch,sprite:v.sprite,glyphs:v.glyphs,transition:v.transition,projection:v.projection,sources:o,layers:u,terrain:g},T=>void 0!==T)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&"raster"!==this.tileManagers[o.source].getSource().type&&(this._updatedSources[o.source]="reload",this.tileManagers[o.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(o){const u=M=>"fill-extrusion"===this._layers[M].type,g={},v=[];for(let M=this._order.length-1;M>=0;M--){const A=this._order[M];if(u(A)){g[A]=M;for(const O of o){const U=O[A];if(U)for(const N of U)v.push(N)}}}v.sort((M,A)=>A.intersectionZ-M.intersectionZ);const T=[];for(let M=this._order.length-1;M>=0;M--){const A=this._order[M];if(u(A))for(let O=v.length-1;O>=0;O--){const U=v[O].feature;if(g[U.layer.id]<M)break;T.push(U),v.pop()}else for(const O of o){const U=O[A];if(U)for(const N of U)T.push(N.feature)}}return T}queryRenderedFeatures(o,u,g){u&&u.filter&&this._validate(p.C.filter,"queryRenderedFeatures.filter",u.filter,null,u);const v={};if(u&&u.layers){if(!(Array.isArray(u.layers)||u.layers instanceof Set))return this.fire(new p.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const U of u.layers){const N=this._layers[U];if(!N)return this.fire(new p.k(new Error(`The layer '${U}' does not exist in the map's style and cannot be queried for features.`))),[];v[N.source]=!0}}const T=[];u.availableImages=this._availableImages;const M=this._serializedAllLayers(),A=u.layers instanceof Set?u.layers:Array.isArray(u.layers)?new Set(u.layers):null,O=Object.assign(Object.assign({},u),{layers:A,globalState:this._globalState});for(const U in this.tileManagers)u.layers&&!v[U]||T.push(Jr(this.tileManagers[U],this._layers,M,o,O,g,this.map.terrain?(N,H,q)=>this.map.terrain.getElevation(N,H,q):void 0));return this.placement&&T.push(function(U,N,H,q,te,ce,Te){const De={},we=ce.queryRenderedSymbols(q),Le=[];for(const je of Object.keys(we).map(Number))Le.push(Te[je]);Le.sort(ne);for(const je of Le){const Re=je.featureIndex.lookupSymbolFeatures(we[je.bucketInstanceId],N,je.bucketIndex,je.sourceLayerIndex,{filterSpec:te.filter,globalState:te.globalState},te.layers,te.availableImages,U);for(const $e in Re){const Ye=De[$e]=De[$e]||[],Ne=Re[$e];Ne.sort((Qe,gt)=>{const lt=je.featureSortOrder;if(lt){const ft=lt.indexOf(Qe.featureIndex);return lt.indexOf(gt.featureIndex)-ft}return gt.featureIndex-Qe.featureIndex});for(const Qe of Ne)Ye.push(Qe)}}return function(je,Re,$e){for(const Ye in je)for(const Ne of je[Ye])kt(Ne,$e[Re[Ye].source]);return je}(De,U,H)}(this._layers,M,this.tileManagers,o,O,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(o,u){u?.filter&&this._validate(p.C.filter,"querySourceFeatures.filter",u.filter,null,u);const g=this.tileManagers[o];return g?function(v,T){const M=v.getRenderableIds().map(U=>v.getTileByID(U)),A=[],O={};for(let U=0;U<M.length;U++){const N=M[U],H=N.tileID.canonical.key;O[H]||(O[H]=!0,N.querySourceFeatures(A,T))}return A}(g,u?Object.assign(Object.assign({},u),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(o,u={}){this._checkLoaded();const g=this.light.getLight();let v=!1;for(const M in o)if(!p.bQ(o[M],g[M])){v=!0;break}if(!v)return;const T={now:ue(),transition:p.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,u),this.light.updateTransitions(T)}getProjection(){var o;return null===(o=this.stylesheet)||void 0===o?void 0:o.projection}setProjection(o){if(this._checkLoaded(),this.projection){if(this.projection.name===o.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=o,this._setProjectionInternal(o.type)}getSky(){var o;return null===(o=this.stylesheet)||void 0===o?void 0:o.sky}setSky(o,u={}){this._checkLoaded();const g=this.getSky();let v=!1;if(!o&&!g)return;if(o&&!g)v=!0;else if(!o&&g)v=!0;else for(const M in o)if(!p.bQ(o[M],g[M])){v=!0;break}if(!v)return;const T={now:ue(),transition:p.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=o,this.sky.setSky(o,u),this.sky.updateTransitions(T)}_setProjectionInternal(o){const u=function(g,v){const T={constrainOverride:v};if(Array.isArray(g)){const M=new Oc({type:g});return{projection:M,transform:new hd(T),cameraHelper:new hc(M)}}switch(g){case"mercator":return{projection:new $n,transform:new an(T),cameraHelper:new cs};case"globe":{const M=new Oc({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:M,transform:new hd(T),cameraHelper:new hc(M)}}case"vertical-perspective":return{projection:new lc,transform:new uc(T),cameraHelper:new us};default:return p.w(`Unknown projection name: ${g}. Falling back to mercator projection.`),{projection:new $n,transform:new an(T),cameraHelper:new cs}}}(o,this.map.transformConstrain);this.projection=u.projection,this.map.migrateProjection(u.transform,u.cameraHelper);for(const g in this.tileManagers)this.tileManagers[g].reload()}_validate(o,u,g,v,T={}){return(!T||!1!==T.validate)&&ci(this,o.call(p.C,p.e({key:u,style:this.serialize(),value:g,styleSpec:p.u},v)))}_remove(o=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),qi().off(ur,this._rtlPluginLoaded);for(const u in this._layers)this._layers[u].setEventedParent(null);for(const u in this.tileManagers){const g=this.tileManagers[u];g.setEventedParent(null),g.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),o&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(o)}_clearSource(o){this.tileManagers[o].clearTiles()}_reloadSource(o){this.tileManagers[o].resume(),this.tileManagers[o].reload()}_updateSources(o){for(const u in this.tileManagers)this.tileManagers[u].update(o,this.map.terrain)}_generateCollisionBoxes(){for(const o in this.tileManagers)this._reloadSource(o)}_updatePlacement(o,u,g,v,T=!1){let M=!1,A=!1;const O={};for(const U of this._order){const N=this._layers[U];if("symbol"!==N.type)continue;if(!O[N.source]){const q=this.tileManagers[N.source];O[N.source]=q.getRenderableIds(!0).map(te=>q.getTileByID(te)).sort((te,ce)=>ce.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(ce.tileID)?-1:1))}const H=this.crossTileSymbolIndex.addLayer(N,O[N.source],o.center.lng);M=M||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||0===g)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ue(),o.zoom))&&(this.pauseablePlacement=new ti(o,this.map.terrain,this._order,T,u,g,v,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,O),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ue()),A=!0),M&&this.pauseablePlacement.placement.setStale()),A||M)for(const U of this._order){const N=this._layers[U];"symbol"===N.type&&this.placement.updateLayerOpacities(N,O[N.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ue())}_releaseSymbolFadeTiles(){for(const o in this.tileManagers)this.tileManagers[o].releaseSymbolFadeTiles()}getImages(o,u){return p._(this,void 0,void 0,function*(){const g=yield this.imageManager.getImages(u.icons);this._updateTilesForChangedImages();const v=this.tileManagers[u.source];return v&&v.setDependencies(u.tileID.key,u.type,u.icons),g})}getGlyphs(o,u){return p._(this,void 0,void 0,function*(){const g=yield this.glyphManager.getGlyphs(u.stacks),v=this.tileManagers[u.source];return v&&v.setDependencies(u.tileID.key,u.type,[""]),g})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(o,u={}){this._checkLoaded(),o&&this._validate(p.C.glyphs,"glyphs",o,null,u)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=o,this.glyphManager.entries={},this.glyphManager.setURL(o))}getDashes(o,u){return p._(this,void 0,void 0,function*(){const g={};for(const[v,T]of Object.entries(u.dashes))g[v]=this.lineAtlas.getDash(T.dasharray,T.round);return g})}addSprite(o,u,g={},v){this._checkLoaded();const T=[{id:o,url:u}],M=[...Mt(this.stylesheet.sprite),...T];this._validate(p.C.sprite,"sprite",M,null,g)||(this.stylesheet.sprite=M,this._loadSprite(T,!0,v))}removeSprite(o){this._checkLoaded();const u=Mt(this.stylesheet.sprite);if(u.find(g=>g.id===o)){if(this._spritesImagesIds[o])for(const g of this._spritesImagesIds[o])this.imageManager.removeImage(g),this._changedImages[g]=!0;u.splice(u.findIndex(g=>g.id===o),1),this.stylesheet.sprite=u.length>0?u:void 0,delete this._spritesImagesIds[o],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new p.l("data",{dataType:"style"}))}else this.fire(new p.k(new Error(`Sprite "${o}" doesn't exists on this map.`)))}getSprite(){return Mt(this.stylesheet.sprite)}setSprite(o,u={},g){this._checkLoaded(),o&&this._validate(p.C.sprite,"sprite",o,null,u)||(this.stylesheet.sprite=o,o?this._loadSprite(o,!0,g):(this._unloadSprite(),g&&g(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const o in this.tileManagers){const u=this.tileManagers[o];if(u.setEventedParent(null),u._tiles){for(const g in u._tiles)u._tiles[g].unloadVectorData();u._tiles={}}u._cache.reset(),u.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const o in this._layers){const u=this._layers[o];u.setEventedParent(null),u.onRemove&&u.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var yr=p.aT([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ys{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,u,g,v,T,M,A,O,U){this.context=o;let N=this.boundPaintVertexBuffers.length!==v.length;for(let H=0;!N&&H<v.length;H++)this.boundPaintVertexBuffers[H]!==v[H]&&(N=!0);!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==g||N||this.boundIndexBuffer!==T||this.boundVertexOffset!==M||this.boundDynamicVertexBuffer!==A||this.boundDynamicVertexBuffer2!==O||this.boundDynamicVertexBuffer3!==U?this.freshBind(u,g,v,T,M,A,O,U):(o.bindVertexArray.set(this.vao),A&&A.bind(),T&&T.dynamicDraw&&T.bind(),O&&O.bind(),U&&U.bind())}freshBind(o,u,g,v,T,M,A,O){const U=o.numAttributes,N=this.context,H=N.gl;this.vao&&this.destroy(),this.vao=N.createVertexArray(),N.bindVertexArray.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=T,this.boundDynamicVertexBuffer=M,this.boundDynamicVertexBuffer2=A,this.boundDynamicVertexBuffer3=O,u.enableAttributes(H,o);for(const q of g)q.enableAttributes(H,o);M&&M.enableAttributes(H,o),A&&A.enableAttributes(H,o),O&&O.enableAttributes(H,o),u.bind(),u.setVertexAttribPointers(H,o,T);for(const q of g)q.bind(),q.setVertexAttribPointers(H,o,T);M&&(M.bind(),M.setVertexAttribPointers(H,o,T)),v&&v.bind(),A&&(A.bind(),A.setVertexAttribPointers(H,o,T)),O&&(O.bind(),O.setVertexAttribPointers(H,o,T)),N.currentNumAttributes=U}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const dd=(w,o,u,g,v)=>({u_texture:0,u_ele_delta:w,u_fog_matrix:o,u_fog_color:u?u.properties.get("fog-color"):p.bo.white,u_fog_ground_blend:u?u.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:v?0:u?u.calculateFogBlendOpacity(g):0,u_horizon_color:u?u.properties.get("horizon-color"):p.bo.white,u_horizon_fog_blend:u?u.properties.get("horizon-fog-blend"):1,u_is_globe_mode:v?1:0}),hu={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Ms(w){const o=[];for(let u=0;u<w.length;u++){if(null===w[u])continue;const g=w[u].split(" ");o.push(g.pop())}return o}class du{constructor(o,u,g,v,T,M,A,O,U=[]){const N=o.gl;this.program=N.createProgram();const H=Ms(u.staticAttributes),q=g?g.getBinderAttributes():[],te=H.concat(q),ce=Zs.prelude.staticUniforms?Ms(Zs.prelude.staticUniforms):[],Te=A.staticUniforms?Ms(A.staticUniforms):[],De=u.staticUniforms?Ms(u.staticUniforms):[],we=g?g.getBinderUniforms():[],Le=ce.concat(Te).concat(De).concat(we),je=[];for(const lt of Le)je.indexOf(lt)<0&&je.push(lt);const Re=g?g.defines():[];sn(N)&&Re.unshift("#version 300 es"),T&&Re.push("#define OVERDRAW_INSPECTOR;"),M&&Re.push("#define TERRAIN3D;"),O&&Re.push(O),U&&Re.push(...U);let $e=Re.concat(Zs.prelude.fragmentSource,A.fragmentSource,u.fragmentSource).join("\n"),Ye=Re.concat(Zs.prelude.vertexSource,A.vertexSource,u.vertexSource).join("\n");sn(N)||($e=$e.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D("),Ye=Ye.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D("));const Ne=N.createShader(N.FRAGMENT_SHADER);if(N.isContextLost())return void(this.failedToCreate=!0);if(N.shaderSource(Ne,$e),N.compileShader(Ne),!N.getShaderParameter(Ne,N.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${N.getShaderInfoLog(Ne)}`);N.attachShader(this.program,Ne);const Qe=N.createShader(N.VERTEX_SHADER);if(N.isContextLost())return void(this.failedToCreate=!0);if(N.shaderSource(Qe,Ye),N.compileShader(Qe),!N.getShaderParameter(Qe,N.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${N.getShaderInfoLog(Qe)}`);N.attachShader(this.program,Qe),this.attributes={};const gt={};this.numAttributes=te.length;for(let lt=0;lt<this.numAttributes;lt++)te[lt]&&(N.bindAttribLocation(this.program,lt,te[lt]),this.attributes[te[lt]]=lt);if(N.linkProgram(this.program),!N.getProgramParameter(this.program,N.LINK_STATUS))throw new Error(`Program failed to link: ${N.getProgramInfoLog(this.program)}`);N.deleteShader(Qe),N.deleteShader(Ne);for(let lt=0;lt<je.length;lt++){const ft=je[lt];if(ft&&!gt[ft]){const _t=N.getUniformLocation(this.program,ft);_t&&(gt[ft]=_t)}}this.fixedUniforms=v(o,gt),this.terrainUniforms=((lt,ft)=>({u_depth:new p.bZ(lt,ft.u_depth),u_terrain:new p.bZ(lt,ft.u_terrain),u_terrain_dim:new p.bp(lt,ft.u_terrain_dim),u_terrain_matrix:new p.b$(lt,ft.u_terrain_matrix),u_terrain_unpack:new p.c0(lt,ft.u_terrain_unpack),u_terrain_exaggeration:new p.bp(lt,ft.u_terrain_exaggeration)}))(o,gt),this.projectionUniforms=((lt,ft)=>({u_projection_matrix:new p.b$(lt,ft.u_projection_matrix),u_projection_tile_mercator_coords:new p.c0(lt,ft.u_projection_tile_mercator_coords),u_projection_clipping_plane:new p.c0(lt,ft.u_projection_clipping_plane),u_projection_transition:new p.bp(lt,ft.u_projection_transition),u_projection_fallback_matrix:new p.b$(lt,ft.u_projection_fallback_matrix)}))(o,gt),this.binderUniforms=g?g.getUniforms(o,gt):[]}draw(o,u,g,v,T,M,A,O,U,N,H,q,te,ce,Te,De,we,Le,je){const Re=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(g),o.setStencilMode(v),o.setColorMode(T),o.setCullFace(M),O){o.activeTexture.set(Re.TEXTURE2),Re.bindTexture(Re.TEXTURE_2D,O.depthTexture),o.activeTexture.set(Re.TEXTURE3),Re.bindTexture(Re.TEXTURE_2D,O.texture);for(const Ye in this.terrainUniforms)this.terrainUniforms[Ye].set(O[Ye])}if(U)for(const Ye in U)this.projectionUniforms[hu[Ye]].set(U[Ye]);if(A)for(const Ye in this.fixedUniforms)this.fixedUniforms[Ye].set(A[Ye]);De&&De.setUniforms(o,this.binderUniforms,ce,{zoom:Te});let $e=0;switch(u){case Re.LINES:$e=2;break;case Re.TRIANGLES:$e=3;break;case Re.LINE_STRIP:$e=1}for(const Ye of te.get()){const Ne=Ye.vaos||(Ye.vaos={});(Ne[N]||(Ne[N]=new Ys)).bind(o,this,H,De?De.getPaintVertexBuffers():[],q,Ye.vertexOffset,we,Le,je),Re.drawElements(u,Ye.primitiveLength*$e,Re.UNSIGNED_SHORT,Ye.primitiveOffset*$e*2)}}}function Ll(w,o,u){const g=1/p.aM(u,1,o.transform.tileZoom),v=Math.pow(2,u.tileID.overscaledZ),T=u.tileSize*Math.pow(2,o.transform.tileZoom)/v,M=T*(u.tileID.canonical.x+u.tileID.wrap*v),A=T*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[g,w.fromScale,w.toScale],u_fade:w.t,u_pixel_coord_upper:[M>>16,A>>16],u_pixel_coord_lower:[65535&M,65535&A]}}const fu=(w,o,u,g)=>{const v=w.style.light,T=v.properties.get("position"),M=[T.x,T.y,T.z],A=p.c3();"viewport"===v.properties.get("anchor")&&p.c4(A,w.transform.bearingInRadians),p.c5(M,M,A);const O=w.transform.transformLightDirection(M),U=v.properties.get("color");return{u_lightpos:M,u_lightpos_globe:O,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[U.r,U.g,U.b],u_vertical_gradient:+o,u_opacity:u,u_fill_translate:g}},Nc=(w,o,u,g,v,T,M)=>p.e(fu(w,o,u,g),Ll(T,w,M),{u_height_factor:-Math.pow(2,v.overscaledZ)/M.tileSize/8}),fd=(w,o,u,g)=>p.e(Ll(o,w,u),{u_fill_translate:g}),rf=(w,o)=>({u_world:w,u_fill_translate:o}),fa=(w,o,u,g,v)=>p.e(fd(w,o,u,v),{u_world:g}),dc=(w,o,u,g,v)=>{const T=w.transform;let M,A,O=0;if("map"===u.paint.get("circle-pitch-alignment")){const U=p.aM(o,1,T.zoom);M=!0,A=[U,U],O=U/(p.a4*Math.pow(2,o.tileID.overscaledZ))*2*Math.PI*v}else M=!1,A=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+("map"===u.paint.get("circle-pitch-scale")),u_pitch_with_map:+M,u_device_pixel_ratio:w.pixelRatio,u_extrude_scale:A,u_globe_extrude_scale:O,u_translate:g}},Jn=w=>({u_pixel_extrude_scale:[1/w.width,1/w.height]}),Ca=w=>({u_viewport_size:[w.width,w.height]}),Ot=(w,o=1)=>({u_color:w,u_overlay:0,u_overlay_scale:o}),Ta=(w,o,u,g)=>{const v=p.aM(w,1,o)/(p.a4*Math.pow(2,w.tileID.overscaledZ))*2*Math.PI*g;return{u_extrude_scale:p.aM(w,1,o),u_intensity:u,u_globe_extrude_scale:v}},pu=(w,o,u,g)=>{const v=p.N();p.c6(v,0,w.width,w.height,0,0,1);const T=w.context.gl;return{u_matrix:v,u_world:[T.drawingBufferWidth,T.drawingBufferHeight],u_image:u,u_color_ramp:g,u_opacity:o.paint.get("heatmap-opacity")}},hs=(w,o,u)=>{const g=u.paint.get("hillshade-accent-color");let v;switch(u.paint.get("hillshade-method")){case"basic":v=4;break;case"combined":v=1;break;case"igor":v=2;break;case"multidirectional":v=3;break;default:v=0}const T=u.getIlluminationProperties();for(let M=0;M<T.directionRadians.length;M++)"viewport"===u.paint.get("hillshade-illumination-anchor")&&(T.directionRadians[M]+=w.transform.bearingInRadians);return{u_image:0,u_latrange:mu(0,o.tileID),u_exaggeration:u.paint.get("hillshade-exaggeration"),u_altitudes:T.altitudeRadians,u_azimuths:T.directionRadians,u_accent:g,u_method:v,u_highlights:T.highlightColor,u_shadows:T.shadowColor}},pd=(w,o)=>{const u=o.stride,g=p.N();return p.c6(g,0,p.a4,-p.a4,0,0,1),p.O(g,g,[0,-p.a4,0]),{u_matrix:g,u_image:1,u_dimension:[u,u],u_zoom:w.overscaledZ,u_unpack:o.getUnpackVector()}};function mu(w,o){const u=Math.pow(2,o.canonical.z),g=o.canonical.y;return[new p.aa(0,g/u).toLngLat().lat,new p.aa(0,(g+1)/u).toLngLat().lat]}const gu=(w,o,u=0)=>({u_image:0,u_unpack:o.getUnpackVector(),u_dimension:[o.stride,o.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:u,u_opacity:w.paint.get("color-relief-opacity")}),Da=(w,o,u,g)=>{const v=w.transform;return{u_translation:md(w,o,u),u_ratio:g/p.aM(o,1,v.zoom),u_device_pixel_ratio:w.pixelRatio,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},Na=(w,o,u,g,v)=>p.e(Da(w,o,u,g),{u_image:0,u_image_height:v}),Mp=(w,o,u,g,v)=>{const T=w.transform,M=Po(o,T);return{u_translation:md(w,o,u),u_texsize:o.imageAtlasTexture.size,u_ratio:g/p.aM(o,1,T.zoom),u_device_pixel_ratio:w.pixelRatio,u_image:0,u_scale:[M,v.fromScale,v.toScale],u_fade:v.t,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]]}},_u=(w,o,u,g,v)=>{const T=Po(o,w.transform);return p.e(Da(w,o,u,g),{u_tileratio:T,u_crossfade_from:v.fromScale,u_crossfade_to:v.toScale,u_image:0,u_mix:v.t,u_lineatlas_width:w.lineAtlas.width,u_lineatlas_height:w.lineAtlas.height})},sf=(w,o,u,g,v,T)=>{const M=Po(o,w.transform);return p.e(Da(w,o,u,g),{u_image:0,u_image_height:T,u_tileratio:M,u_crossfade_from:v.fromScale,u_crossfade_to:v.toScale,u_image_dash:1,u_mix:v.t,u_lineatlas_width:w.lineAtlas.width,u_lineatlas_height:w.lineAtlas.height})};function Po(w,o){return 1/p.aM(w,1,o.tileZoom)}function md(w,o,u){return p.aN(w.transform,o,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}const no=(w,o,u,g,v)=>{return{u_tl_parent:w,u_scale_parent:o,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(M=g.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(T=g.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:fc(g.paint.get("raster-hue-rotate")),u_coords_top:[v[0].x,v[0].y,v[1].x,v[1].y],u_coords_bottom:[v[3].x,v[3].y,v[2].x,v[2].y]};var T,M};function fc(w){w*=Math.PI/180;const o=Math.sin(w),u=Math.cos(w);return[(2*u+1)/3,(-Math.sqrt(3)*o-u+1)/3,(Math.sqrt(3)*o-u+1)/3]}const Es=(w,o,u,g,v,T,M,A,O,U,N,H,q)=>{const te=M.transform;return{u_is_size_zoom_constant:+("constant"===w||"source"===w),u_is_size_feature_constant:+("constant"===w||"camera"===w),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:te.cameraToCenterDistance,u_pitch:te.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:te.width/te.height,u_fade_change:M.options.fadeDuration?M.symbolFadeChange:1,u_label_plane_matrix:A,u_coord_matrix:O,u_is_text:+N,u_pitch_with_map:+g,u_is_along_line:v,u_is_variable_anchor:T,u_texsize:H,u_texture:0,u_translation:U,u_pitched_scale:q}},Yo=(w,o,u,g,v,T,M,A,O,U,N,H,q,te)=>{const ce=M.transform;return p.e(Es(w,o,u,g,v,T,M,A,O,U,N,H,te),{u_gamma_scale:g?Math.cos(ce.pitch*Math.PI/180)*ce.cameraToCenterDistance:1,u_device_pixel_ratio:M.pixelRatio,u_is_halo:1})},pc=(w,o,u,g,v,T,M,A,O,U,N,H,q)=>p.e(Yo(w,o,u,g,v,T,M,A,O,U,!0,N,0,q),{u_texsize_icon:H,u_texture_icon:1}),zc=(w,o)=>({u_opacity:w,u_color:o}),mc=(w,o,u,g,v)=>p.e(function(T,M,A,O){const U=A.imageManager.getPattern(T.from.toString()),N=A.imageManager.getPattern(T.to.toString()),{width:H,height:q}=A.imageManager.getPixelSize(),te=Math.pow(2,O.tileID.overscaledZ),ce=O.tileSize*Math.pow(2,A.transform.tileZoom)/te,Te=ce*(O.tileID.canonical.x+O.tileID.wrap*te),De=ce*O.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:U.tl,u_pattern_br_a:U.br,u_pattern_tl_b:N.tl,u_pattern_br_b:N.br,u_texsize:[H,q],u_mix:M.t,u_pattern_size_a:U.displaySize,u_pattern_size_b:N.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/p.aM(O,1,A.transform.tileZoom),u_pixel_coord_upper:[Te>>16,De>>16],u_pixel_coord_lower:[65535&Te,65535&De]}}(u,v,o,g),{u_opacity:w}),Ho=(w,o)=>{},Ol={fillExtrusion:(w,o)=>({u_lightpos:new p.c1(w,o.u_lightpos),u_lightpos_globe:new p.c1(w,o.u_lightpos_globe),u_lightintensity:new p.bp(w,o.u_lightintensity),u_lightcolor:new p.c1(w,o.u_lightcolor),u_vertical_gradient:new p.bp(w,o.u_vertical_gradient),u_opacity:new p.bp(w,o.u_opacity),u_fill_translate:new p.c2(w,o.u_fill_translate)}),fillExtrusionPattern:(w,o)=>({u_lightpos:new p.c1(w,o.u_lightpos),u_lightpos_globe:new p.c1(w,o.u_lightpos_globe),u_lightintensity:new p.bp(w,o.u_lightintensity),u_lightcolor:new p.c1(w,o.u_lightcolor),u_vertical_gradient:new p.bp(w,o.u_vertical_gradient),u_height_factor:new p.bp(w,o.u_height_factor),u_opacity:new p.bp(w,o.u_opacity),u_fill_translate:new p.c2(w,o.u_fill_translate),u_image:new p.bZ(w,o.u_image),u_texsize:new p.c2(w,o.u_texsize),u_pixel_coord_upper:new p.c2(w,o.u_pixel_coord_upper),u_pixel_coord_lower:new p.c2(w,o.u_pixel_coord_lower),u_scale:new p.c1(w,o.u_scale),u_fade:new p.bp(w,o.u_fade)}),fill:(w,o)=>({u_fill_translate:new p.c2(w,o.u_fill_translate)}),fillPattern:(w,o)=>({u_image:new p.bZ(w,o.u_image),u_texsize:new p.c2(w,o.u_texsize),u_pixel_coord_upper:new p.c2(w,o.u_pixel_coord_upper),u_pixel_coord_lower:new p.c2(w,o.u_pixel_coord_lower),u_scale:new p.c1(w,o.u_scale),u_fade:new p.bp(w,o.u_fade),u_fill_translate:new p.c2(w,o.u_fill_translate)}),fillOutline:(w,o)=>({u_world:new p.c2(w,o.u_world),u_fill_translate:new p.c2(w,o.u_fill_translate)}),fillOutlinePattern:(w,o)=>({u_world:new p.c2(w,o.u_world),u_image:new p.bZ(w,o.u_image),u_texsize:new p.c2(w,o.u_texsize),u_pixel_coord_upper:new p.c2(w,o.u_pixel_coord_upper),u_pixel_coord_lower:new p.c2(w,o.u_pixel_coord_lower),u_scale:new p.c1(w,o.u_scale),u_fade:new p.bp(w,o.u_fade),u_fill_translate:new p.c2(w,o.u_fill_translate)}),circle:(w,o)=>({u_camera_to_center_distance:new p.bp(w,o.u_camera_to_center_distance),u_scale_with_map:new p.bZ(w,o.u_scale_with_map),u_pitch_with_map:new p.bZ(w,o.u_pitch_with_map),u_extrude_scale:new p.c2(w,o.u_extrude_scale),u_device_pixel_ratio:new p.bp(w,o.u_device_pixel_ratio),u_globe_extrude_scale:new p.bp(w,o.u_globe_extrude_scale),u_translate:new p.c2(w,o.u_translate)}),collisionBox:(w,o)=>({u_pixel_extrude_scale:new p.c2(w,o.u_pixel_extrude_scale)}),collisionCircle:(w,o)=>({u_viewport_size:new p.c2(w,o.u_viewport_size)}),debug:(w,o)=>({u_color:new p.b_(w,o.u_color),u_overlay:new p.bZ(w,o.u_overlay),u_overlay_scale:new p.bp(w,o.u_overlay_scale)}),depth:Ho,clippingMask:Ho,heatmap:(w,o)=>({u_extrude_scale:new p.bp(w,o.u_extrude_scale),u_intensity:new p.bp(w,o.u_intensity),u_globe_extrude_scale:new p.bp(w,o.u_globe_extrude_scale)}),heatmapTexture:(w,o)=>({u_matrix:new p.b$(w,o.u_matrix),u_world:new p.c2(w,o.u_world),u_image:new p.bZ(w,o.u_image),u_color_ramp:new p.bZ(w,o.u_color_ramp),u_opacity:new p.bp(w,o.u_opacity)}),hillshade:(w,o)=>({u_image:new p.bZ(w,o.u_image),u_latrange:new p.c2(w,o.u_latrange),u_exaggeration:new p.bp(w,o.u_exaggeration),u_altitudes:new p.c8(w,o.u_altitudes),u_azimuths:new p.c8(w,o.u_azimuths),u_accent:new p.b_(w,o.u_accent),u_method:new p.bZ(w,o.u_method),u_shadows:new p.c7(w,o.u_shadows),u_highlights:new p.c7(w,o.u_highlights)}),hillshadePrepare:(w,o)=>({u_matrix:new p.b$(w,o.u_matrix),u_image:new p.bZ(w,o.u_image),u_dimension:new p.c2(w,o.u_dimension),u_zoom:new p.bp(w,o.u_zoom),u_unpack:new p.c0(w,o.u_unpack)}),colorRelief:(w,o)=>({u_image:new p.bZ(w,o.u_image),u_unpack:new p.c0(w,o.u_unpack),u_dimension:new p.c2(w,o.u_dimension),u_elevation_stops:new p.bZ(w,o.u_elevation_stops),u_color_stops:new p.bZ(w,o.u_color_stops),u_color_ramp_size:new p.bZ(w,o.u_color_ramp_size),u_opacity:new p.bp(w,o.u_opacity)}),line:(w,o)=>({u_translation:new p.c2(w,o.u_translation),u_ratio:new p.bp(w,o.u_ratio),u_device_pixel_ratio:new p.bp(w,o.u_device_pixel_ratio),u_units_to_pixels:new p.c2(w,o.u_units_to_pixels)}),lineGradient:(w,o)=>({u_translation:new p.c2(w,o.u_translation),u_ratio:new p.bp(w,o.u_ratio),u_device_pixel_ratio:new p.bp(w,o.u_device_pixel_ratio),u_units_to_pixels:new p.c2(w,o.u_units_to_pixels),u_image:new p.bZ(w,o.u_image),u_image_height:new p.bp(w,o.u_image_height)}),linePattern:(w,o)=>({u_translation:new p.c2(w,o.u_translation),u_texsize:new p.c2(w,o.u_texsize),u_ratio:new p.bp(w,o.u_ratio),u_device_pixel_ratio:new p.bp(w,o.u_device_pixel_ratio),u_image:new p.bZ(w,o.u_image),u_units_to_pixels:new p.c2(w,o.u_units_to_pixels),u_scale:new p.c1(w,o.u_scale),u_fade:new p.bp(w,o.u_fade)}),lineSDF:(w,o)=>({u_translation:new p.c2(w,o.u_translation),u_ratio:new p.bp(w,o.u_ratio),u_device_pixel_ratio:new p.bp(w,o.u_device_pixel_ratio),u_units_to_pixels:new p.c2(w,o.u_units_to_pixels),u_image:new p.bZ(w,o.u_image),u_mix:new p.bp(w,o.u_mix),u_tileratio:new p.bp(w,o.u_tileratio),u_crossfade_from:new p.bp(w,o.u_crossfade_from),u_crossfade_to:new p.bp(w,o.u_crossfade_to),u_lineatlas_width:new p.bp(w,o.u_lineatlas_width),u_lineatlas_height:new p.bp(w,o.u_lineatlas_height)}),lineGradientSDF:(w,o)=>({u_translation:new p.c2(w,o.u_translation),u_ratio:new p.bp(w,o.u_ratio),u_device_pixel_ratio:new p.bp(w,o.u_device_pixel_ratio),u_units_to_pixels:new p.c2(w,o.u_units_to_pixels),u_image:new p.bZ(w,o.u_image),u_image_height:new p.bp(w,o.u_image_height),u_tileratio:new p.bp(w,o.u_tileratio),u_crossfade_from:new p.bp(w,o.u_crossfade_from),u_crossfade_to:new p.bp(w,o.u_crossfade_to),u_image_dash:new p.bZ(w,o.u_image_dash),u_mix:new p.bp(w,o.u_mix),u_lineatlas_width:new p.bp(w,o.u_lineatlas_width),u_lineatlas_height:new p.bp(w,o.u_lineatlas_height)}),raster:(w,o)=>({u_tl_parent:new p.c2(w,o.u_tl_parent),u_scale_parent:new p.bp(w,o.u_scale_parent),u_buffer_scale:new p.bp(w,o.u_buffer_scale),u_fade_t:new p.bp(w,o.u_fade_t),u_opacity:new p.bp(w,o.u_opacity),u_image0:new p.bZ(w,o.u_image0),u_image1:new p.bZ(w,o.u_image1),u_brightness_low:new p.bp(w,o.u_brightness_low),u_brightness_high:new p.bp(w,o.u_brightness_high),u_saturation_factor:new p.bp(w,o.u_saturation_factor),u_contrast_factor:new p.bp(w,o.u_contrast_factor),u_spin_weights:new p.c1(w,o.u_spin_weights),u_coords_top:new p.c0(w,o.u_coords_top),u_coords_bottom:new p.c0(w,o.u_coords_bottom)}),symbolIcon:(w,o)=>({u_is_size_zoom_constant:new p.bZ(w,o.u_is_size_zoom_constant),u_is_size_feature_constant:new p.bZ(w,o.u_is_size_feature_constant),u_size_t:new p.bp(w,o.u_size_t),u_size:new p.bp(w,o.u_size),u_camera_to_center_distance:new p.bp(w,o.u_camera_to_center_distance),u_pitch:new p.bp(w,o.u_pitch),u_rotate_symbol:new p.bZ(w,o.u_rotate_symbol),u_aspect_ratio:new p.bp(w,o.u_aspect_ratio),u_fade_change:new p.bp(w,o.u_fade_change),u_label_plane_matrix:new p.b$(w,o.u_label_plane_matrix),u_coord_matrix:new p.b$(w,o.u_coord_matrix),u_is_text:new p.bZ(w,o.u_is_text),u_pitch_with_map:new p.bZ(w,o.u_pitch_with_map),u_is_along_line:new p.bZ(w,o.u_is_along_line),u_is_variable_anchor:new p.bZ(w,o.u_is_variable_anchor),u_texsize:new p.c2(w,o.u_texsize),u_texture:new p.bZ(w,o.u_texture),u_translation:new p.c2(w,o.u_translation),u_pitched_scale:new p.bp(w,o.u_pitched_scale)}),symbolSDF:(w,o)=>({u_is_size_zoom_constant:new p.bZ(w,o.u_is_size_zoom_constant),u_is_size_feature_constant:new p.bZ(w,o.u_is_size_feature_constant),u_size_t:new p.bp(w,o.u_size_t),u_size:new p.bp(w,o.u_size),u_camera_to_center_distance:new p.bp(w,o.u_camera_to_center_distance),u_pitch:new p.bp(w,o.u_pitch),u_rotate_symbol:new p.bZ(w,o.u_rotate_symbol),u_aspect_ratio:new p.bp(w,o.u_aspect_ratio),u_fade_change:new p.bp(w,o.u_fade_change),u_label_plane_matrix:new p.b$(w,o.u_label_plane_matrix),u_coord_matrix:new p.b$(w,o.u_coord_matrix),u_is_text:new p.bZ(w,o.u_is_text),u_pitch_with_map:new p.bZ(w,o.u_pitch_with_map),u_is_along_line:new p.bZ(w,o.u_is_along_line),u_is_variable_anchor:new p.bZ(w,o.u_is_variable_anchor),u_texsize:new p.c2(w,o.u_texsize),u_texture:new p.bZ(w,o.u_texture),u_gamma_scale:new p.bp(w,o.u_gamma_scale),u_device_pixel_ratio:new p.bp(w,o.u_device_pixel_ratio),u_is_halo:new p.bZ(w,o.u_is_halo),u_translation:new p.c2(w,o.u_translation),u_pitched_scale:new p.bp(w,o.u_pitched_scale)}),symbolTextAndIcon:(w,o)=>({u_is_size_zoom_constant:new p.bZ(w,o.u_is_size_zoom_constant),u_is_size_feature_constant:new p.bZ(w,o.u_is_size_feature_constant),u_size_t:new p.bp(w,o.u_size_t),u_size:new p.bp(w,o.u_size),u_camera_to_center_distance:new p.bp(w,o.u_camera_to_center_distance),u_pitch:new p.bp(w,o.u_pitch),u_rotate_symbol:new p.bZ(w,o.u_rotate_symbol),u_aspect_ratio:new p.bp(w,o.u_aspect_ratio),u_fade_change:new p.bp(w,o.u_fade_change),u_label_plane_matrix:new p.b$(w,o.u_label_plane_matrix),u_coord_matrix:new p.b$(w,o.u_coord_matrix),u_is_text:new p.bZ(w,o.u_is_text),u_pitch_with_map:new p.bZ(w,o.u_pitch_with_map),u_is_along_line:new p.bZ(w,o.u_is_along_line),u_is_variable_anchor:new p.bZ(w,o.u_is_variable_anchor),u_texsize:new p.c2(w,o.u_texsize),u_texsize_icon:new p.c2(w,o.u_texsize_icon),u_texture:new p.bZ(w,o.u_texture),u_texture_icon:new p.bZ(w,o.u_texture_icon),u_gamma_scale:new p.bp(w,o.u_gamma_scale),u_device_pixel_ratio:new p.bp(w,o.u_device_pixel_ratio),u_is_halo:new p.bZ(w,o.u_is_halo),u_translation:new p.c2(w,o.u_translation),u_pitched_scale:new p.bp(w,o.u_pitched_scale)}),background:(w,o)=>({u_opacity:new p.bp(w,o.u_opacity),u_color:new p.b_(w,o.u_color)}),backgroundPattern:(w,o)=>({u_opacity:new p.bp(w,o.u_opacity),u_image:new p.bZ(w,o.u_image),u_pattern_tl_a:new p.c2(w,o.u_pattern_tl_a),u_pattern_br_a:new p.c2(w,o.u_pattern_br_a),u_pattern_tl_b:new p.c2(w,o.u_pattern_tl_b),u_pattern_br_b:new p.c2(w,o.u_pattern_br_b),u_texsize:new p.c2(w,o.u_texsize),u_mix:new p.bp(w,o.u_mix),u_pattern_size_a:new p.c2(w,o.u_pattern_size_a),u_pattern_size_b:new p.c2(w,o.u_pattern_size_b),u_scale_a:new p.bp(w,o.u_scale_a),u_scale_b:new p.bp(w,o.u_scale_b),u_pixel_coord_upper:new p.c2(w,o.u_pixel_coord_upper),u_pixel_coord_lower:new p.c2(w,o.u_pixel_coord_lower),u_tile_units_to_pixels:new p.bp(w,o.u_tile_units_to_pixels)}),terrain:(w,o)=>({u_texture:new p.bZ(w,o.u_texture),u_ele_delta:new p.bp(w,o.u_ele_delta),u_fog_matrix:new p.b$(w,o.u_fog_matrix),u_fog_color:new p.b_(w,o.u_fog_color),u_fog_ground_blend:new p.bp(w,o.u_fog_ground_blend),u_fog_ground_blend_opacity:new p.bp(w,o.u_fog_ground_blend_opacity),u_horizon_color:new p.b_(w,o.u_horizon_color),u_horizon_fog_blend:new p.bp(w,o.u_horizon_fog_blend),u_is_globe_mode:new p.bp(w,o.u_is_globe_mode)}),terrainDepth:(w,o)=>({u_ele_delta:new p.bp(w,o.u_ele_delta)}),terrainCoords:(w,o)=>({u_texture:new p.bZ(w,o.u_texture),u_terrain_coords_id:new p.bp(w,o.u_terrain_coords_id),u_ele_delta:new p.bp(w,o.u_ele_delta)}),projectionErrorMeasurement:(w,o)=>({u_input:new p.bp(w,o.u_input),u_output_expected:new p.bp(w,o.u_output_expected)}),atmosphere:(w,o)=>({u_sun_pos:new p.c1(w,o.u_sun_pos),u_atmosphere_blend:new p.bp(w,o.u_atmosphere_blend),u_globe_position:new p.c1(w,o.u_globe_position),u_globe_radius:new p.bp(w,o.u_globe_radius),u_inv_proj_matrix:new p.b$(w,o.u_inv_proj_matrix)}),sky:(w,o)=>({u_sky_color:new p.b_(w,o.u_sky_color),u_horizon_color:new p.b_(w,o.u_horizon_color),u_horizon:new p.c2(w,o.u_horizon),u_horizon_normal:new p.c2(w,o.u_horizon_normal),u_sky_horizon_blend:new p.bp(w,o.u_sky_horizon_blend),u_sky_blend:new p.bp(w,o.u_sky_blend)})};class Xo{constructor(o,u,g){this.context=o;const v=o.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const u=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Bc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Xs{constructor(o,u,g,v){this.length=u.length,this.attributes=g,this.itemSize=u.bytesPerElement,this.dynamicDraw=v,this.context=o;const T=o.gl;this.buffer=T.createBuffer(),o.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,u){for(let g=0;g<this.attributes.length;g++){const v=u.attributes[this.attributes[g].name];void 0!==v&&o.enableVertexAttribArray(v)}}setVertexAttribPointers(o,u,g){for(let v=0;v<this.attributes.length;v++){const T=this.attributes[v],M=u.attributes[T.name];void 0!==M&&o.vertexAttribPointer(M,T.components,o[Bc[T.type]],!1,this.itemSize,T.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ln{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class pa extends Ln{getDefault(){return p.bo.transparent}set(o){const u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class yu extends Ln{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class ph extends Ln{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class vu extends Ln{getDefault(){return[!0,!0,!0,!0]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Ss extends Ln{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class wi extends Ln{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class yo extends Ln{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const u=this.current;(o.func!==u.func||o.ref!==u.ref||o.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Pr extends Ln{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class ma extends Ln{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=o,this.dirty=!1}}class ds extends Ln{getDefault(){return[0,1]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class gc extends Ln{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=o,this.dirty=!1}}class Vc extends Ln{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class fs extends Ln{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.BLEND):u.disable(u.BLEND),this.current=o,this.dirty=!1}}class gd extends Ln{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class il extends Ln{getDefault(){return p.bo.transparent}set(o){const u=this.current;(o.r!==u.r||o.g!==u.g||o.b!==u.b||o.a!==u.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class af extends Ln{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Is extends Ln{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;o?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=o,this.dirty=!1}}class bu extends Ln{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class _c extends Ln{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class jc extends Ln{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Ks extends Ln{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class rl extends Ln{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const u=this.current;(o[0]!==u[0]||o[1]!==u[1]||o[2]!==u[2]||o[3]!==u[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class yc extends Ln{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class ga extends Ln{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class xu extends Ln{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class vc extends Ln{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class _i extends Ln{getDefault(){return null}set(o){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Fl extends Ln{getDefault(){return null}set(o){var u;if(o===this.current&&!this.dirty)return;const g=this.gl;sn(g)?g.bindVertexArray(o):null===(u=g.getExtension("OES_vertex_array_object"))||void 0===u||u.bindVertexArrayOES(o),this.current=o,this.dirty=!1}}class ps extends Ln{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Nl extends Ln{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class zl extends Ln{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class mh extends Ln{constructor(o,u){super(o),this.context=o,this.parent=u}getDefault(){return null}}class lf extends mh{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class gh extends mh{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Uc extends mh{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,o),this.current=o,this.dirty=!1}}const ol="Framebuffer is not complete";class wu{constructor(o,u,g,v,T){this.context=o,this.width=u,this.height=g;const M=o.gl,A=this.framebuffer=M.createFramebuffer();if(this.colorAttachment=new lf(o,A),v)this.depthAttachment=T?new Uc(o,A):new gh(o,A);else if(T)throw new Error("Stencil cannot be set without depth");if(M.checkFramebufferStatus(M.FRAMEBUFFER)!==M.FRAMEBUFFER_COMPLETE)throw new Error(ol)}destroy(){const o=this.context.gl,u=this.colorAttachment.get();if(u&&o.deleteTexture(u),this.depthAttachment){const g=this.depthAttachment.get();g&&o.deleteRenderbuffer(g)}o.deleteFramebuffer(this.framebuffer)}}class Cu{constructor(o){var u,g;if(this.gl=o,this.clearColor=new pa(this),this.clearDepth=new yu(this),this.clearStencil=new ph(this),this.colorMask=new vu(this),this.depthMask=new Ss(this),this.stencilMask=new wi(this),this.stencilFunc=new yo(this),this.stencilOp=new Pr(this),this.stencilTest=new ma(this),this.depthRange=new ds(this),this.depthTest=new gc(this),this.depthFunc=new Vc(this),this.blend=new fs(this),this.blendFunc=new gd(this),this.blendColor=new il(this),this.blendEquation=new af(this),this.cullFace=new Is(this),this.cullFaceSide=new bu(this),this.frontFace=new _c(this),this.program=new jc(this),this.activeTexture=new Ks(this),this.viewport=new rl(this),this.bindFramebuffer=new yc(this),this.bindRenderbuffer=new ga(this),this.bindTexture=new xu(this),this.bindVertexBuffer=new vc(this),this.bindElementBuffer=new _i(this),this.bindVertexArray=new Fl(this),this.pixelStoreUnpack=new ps(this),this.pixelStoreUnpackPremultiplyAlpha=new Nl(this),this.pixelStoreUnpackFlipY=new zl(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),sn(o)){this.HALF_FLOAT=o.HALF_FLOAT;const v=o.getExtension("EXT_color_buffer_half_float");this.RGBA16F=null!==(u=o.RGBA16F)&&void 0!==u?u:v?.RGBA16F_EXT,this.RGB16F=null!==(g=o.RGB16F)&&void 0!==g?g:v?.RGB16F_EXT,o.getExtension("EXT_color_buffer_float")}else{o.getExtension("EXT_color_buffer_half_float"),o.getExtension("OES_texture_half_float_linear");const v=o.getExtension("OES_texture_half_float");this.HALF_FLOAT=v?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,u){return new Xo(this,o,u)}createVertexBuffer(o,u,g){return new Xs(this,o,u,g)}createRenderbuffer(o,u,g){const v=this.gl,T=v.createRenderbuffer();return this.bindRenderbuffer.set(T),v.renderbufferStorage(v.RENDERBUFFER,o,u,g),this.bindRenderbuffer.set(null),T}createFramebuffer(o,u,g,v){return new wu(this,o,u,g,v)}clear({color:o,depth:u,stencil:g}){const v=this.gl;let T=0;o&&(T|=v.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),void 0!==u&&(T|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),void 0!==g&&(T|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),v.clear(T)}setCullFace(o){!1===o.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){p.bQ(o.blendFunction,fr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}createVertexArray(){var o;return sn(this.gl)?this.gl.createVertexArray():null===(o=this.gl.getExtension("OES_vertex_array_object"))||void 0===o?void 0:o.createVertexArrayOES()}deleteVertexArray(o){var u;return sn(this.gl)?this.gl.deleteVertexArray(o):null===(u=this.gl.getExtension("OES_vertex_array_object"))||void 0===u?void 0:u.deleteVertexArrayOES(o)}unbindVAO(){this.bindVertexArray.set(null)}}let bc;function f(w,o,u,g,v){const T=w.context,M=w.transform,A=T.gl,O=w.useProgram("collisionBox"),U=[];let N=0,H=0;for(let we=0;we<g.length;we++){const Le=g[we],je=o.getTile(Le).getBucket(u);if(!je)continue;const Re=v?je.textCollisionBox:je.iconCollisionBox,$e=je.collisionCircleArray;$e.length>0&&(U.push({circleArray:$e,circleOffset:H,coord:Le}),N+=$e.length/4,H=N),Re&&O.draw(T,A.LINES,ai.disabled,Ri.disabled,w.colorModeForRenderPass(),ki.disabled,Jn(w.transform),w.style.map.terrain&&w.style.map.terrain.getTerrainData(Le),M.getProjectionData({overscaledTileID:Le,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),u.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,null,w.transform.zoom,null,null,Re.collisionVertexBuffer)}if(!v||!U.length)return;const q=w.useProgram("collisionCircle"),te=new p.c9;te.resize(4*N),te._trim();let ce=0;for(const we of U)for(let Le=0;Le<we.circleArray.length/4;Le++){const je=4*Le,Re=we.circleArray[je+0],$e=we.circleArray[je+1],Ye=we.circleArray[je+2],Ne=we.circleArray[je+3];te.emplace(ce++,Re,$e,Ye,Ne,0),te.emplace(ce++,Re,$e,Ye,Ne,1),te.emplace(ce++,Re,$e,Ye,Ne,2),te.emplace(ce++,Re,$e,Ye,Ne,3)}(!bc||bc.length<2*N)&&(bc=function(we){const Le=2*we,je=new p.cb;je.resize(Le),je._trim();for(let Re=0;Re<Le;Re++){const $e=6*Re;je.uint16[$e+0]=4*Re+0,je.uint16[$e+1]=4*Re+1,je.uint16[$e+2]=4*Re+2,je.uint16[$e+3]=4*Re+2,je.uint16[$e+4]=4*Re+3,je.uint16[$e+5]=4*Re+0}return je}(N));const Te=T.createIndexBuffer(bc,!0),De=T.createVertexBuffer(te,p.ca.members,!0);for(const we of U){const Le=Ca(w.transform);q.draw(T,A.TRIANGLES,ai.disabled,Ri.disabled,w.colorModeForRenderPass(),ki.disabled,Le,w.style.map.terrain&&w.style.map.terrain.getTerrainData(we.coord),null,u.id,De,Te,p.aW.simpleSegment(0,2*we.circleOffset,we.circleArray.length,we.circleArray.length/2),null,w.transform.zoom,null,null,null)}De.destroy(),Te.destroy()}const C=p.ar(new Float32Array(16));function P(w,o,u,g,v,T){const{horizontalAlign:M,verticalAlign:A}=p.aR(w);return new p.P((-(M-.5)*o/v+g[0])*T,(-(A-.5)*u/v+g[1])*T)}function B(w,o,u,g,v,T){const M=o.tileAnchorPoint.add(new p.P(o.translation[0],o.translation[1]));if(o.pitchWithMap){let A=g.mult(T);u||(A=A.rotate(-v));const O=M.add(A);return Mn(O.x,O.y,o.pitchedLabelPlaneMatrix,o.getElevation).point}if(u){const A=ca(o.tileAnchorPoint.x+1,o.tileAnchorPoint.y,o).point.sub(w),O=Math.atan(A.y/A.x)+(A.x<0?Math.PI:0);return w.add(g.rotate(O))}return w.add(g)}function Y(w,o,u,g,v,T,M,A,O,U,N,H){const q=w.text.placedSymbolArray,te=w.text.dynamicLayoutVertexArray,ce=w.icon.dynamicLayoutVertexArray,Te={};te.clear();for(let De=0;De<q.length;De++){const we=q.get(De),Le=we.hidden||!we.crossTileID||w.allowVerticalPlacement&&!we.placedOrientation?null:g[we.crossTileID];if(Le){const je=new p.P(we.anchorX,we.anchorY),Re={getElevation:H,width:v.width,height:v.height,pitchedLabelPlaneMatrix:T,pitchWithMap:u,transform:v,tileAnchorPoint:je,translation:U,unwrappedTileID:N},$e=u?El(je.x,je.y,Re):ca(je.x,je.y,Re),Ye=Un(v.cameraToCenterDistance,$e.signedDistanceFromCamera);let Ne=p.az(w.textSizeData,A,we)*Ye/p.aL;u&&(Ne*=w.tilePixelRatio/M);const{width:Qe,height:gt,anchor:lt,textOffset:ft,textBoxScale:_t}=Le,Ht=P(lt,Qe,gt,ft,_t,Ne),$t=v.getPitchedTextCorrection(je.x+U[0],je.y+U[1],N),Ft=B($e.point,Re,o,Ht,-v.bearingInRadians,$t),Tn=w.allowVerticalPlacement&&we.placedOrientation===p.ay.vertical?Math.PI/2:0;for(let yi=0;yi<we.numGlyphs;yi++)p.aF(te,Ft,Tn);O&&we.associatedIconIndex>=0&&(Te[we.associatedIconIndex]={shiftedAnchor:Ft,angle:Tn})}else Gs(we.numGlyphs,te)}if(O){ce.clear();const De=w.icon.placedSymbolArray;for(let we=0;we<De.length;we++){const Le=De.get(we);if(Le.hidden)Gs(Le.numGlyphs,ce);else{const je=Te[we];if(je)for(let Re=0;Re<Le.numGlyphs;Re++)p.aF(ce,je.shiftedAnchor,je.angle);else Gs(Le.numGlyphs,ce)}}w.icon.dynamicLayoutVertexBuffer.updateData(ce)}w.text.dynamicLayoutVertexBuffer.updateData(te)}function _e(w,o,u){return u.iconsInText&&o?"symbolTextAndIcon":w?"symbolSDF":"symbolIcon"}function qe(w,o,u,g,v,T,M,A,O,U,N,H,q){const te=w.context,ce=te.gl,Te=w.transform,De="map"===A,we="map"===O,Le="viewport"!==A&&"point"!==u.layout.get("symbol-placement"),je=De&&!we&&!Le,Re=!u.layout.get("symbol-sort-key").isConstant();let $e=!1;const Ye=w.getDepthModeForSublayer(0,ai.ReadOnly),Ne=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Qe=[],gt=Te.getCircleRadiusCorrection();for(const lt of g){const ft=o.getTile(lt),_t=ft.getBucket(u);if(!_t)continue;const Ht=v?_t.text:_t.icon;if(!Ht||!Ht.segments.get().length||!Ht.hasVisibleVertices)continue;const $t=Ht.programConfigurations.get(u.id),Ft=v||_t.sdfIcons,Tn=v?_t.textSizeData:_t.iconSizeData,yi=we||0!==Te.pitch,pi=w.useProgram(_e(Ft,v,_t),$t),br=p.ax(Tn,Te.zoom),xr=w.style.map.terrain&&w.style.map.terrain.getTerrainData(lt);let Or,ar,Ao,Fr,oo=[0,0],so=null;if(v)ar=ft.glyphAtlasTexture,Ao=ce.LINEAR,Or=ft.glyphAtlasTexture.size,_t.iconsInText&&(oo=ft.imageAtlasTexture.size,so=ft.imageAtlasTexture,Fr=yi||w.options.rotating||w.options.zooming||"composite"===Tn.kind||"camera"===Tn.kind?ce.LINEAR:ce.NEAREST);else{const Kr=1!==u.layout.get("icon-size").constantOr(0)||_t.iconsNeedLinear;ar=ft.imageAtlasTexture,Ao=Ft||w.options.rotating||w.options.zooming||Kr||yi?ce.LINEAR:ce.NEAREST,Or=ft.imageAtlasTexture.size}const bo=p.aM(ft,1,w.transform.zoom),na=Zr(De,w.transform,bo),Ul=p.N();p.aA(Ul,na);const Va=di(we,De,w.transform,bo),Yc=p.aN(Te,ft,T,M),Xr=Te.getProjectionData({overscaledTileID:lt,applyGlobeMatrix:!q,applyTerrainMatrix:!0}),Ma=Ne&&_t.hasTextData(),zi="none"!==u.layout.get("icon-text-fit")&&Ma&&_t.hasIconData();if(Le){const Kr=w.style.map.terrain?(wr,Er)=>w.style.map.terrain.getElevation(lt,wr,Er):null,Mr="map"===u.layout.get("text-rotation-alignment");Ir(_t,w,v,na,Ul,we,U,Mr,lt.toUnwrapped(),Te.width,Te.height,Yc,Kr)}const er=v&&Ne||zi,Ea=Le||er?C:we?na:w.transform.clipSpaceToPixelsMatrix,lr=Ft&&0!==u.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1);let Nu;Nu=Ft?_t.iconsInText?pc(Tn.kind,br,je,we,Le,er,w,Ea,Va,Yc,Or,oo,gt):Yo(Tn.kind,br,je,we,Le,er,w,Ea,Va,Yc,v,Or,0,gt):Es(Tn.kind,br,je,we,Le,er,w,Ea,Va,Yc,v,Or,gt);const Xc={program:pi,buffers:Ht,uniformValues:Nu,projectionData:Xr,atlasTexture:ar,atlasTextureIcon:so,atlasInterpolation:Ao,atlasInterpolationIcon:Fr,isSDF:Ft,hasHalo:lr};if(Re&&_t.canOverlap){$e=!0;const Kr=Ht.segments.get();for(const Mr of Kr)Qe.push({segments:new p.aW([Mr]),sortKey:Mr.sortKey,state:Xc,terrainData:xr})}else Qe.push({segments:Ht.segments,sortKey:0,state:Xc,terrainData:xr})}$e&&Qe.sort((lt,ft)=>lt.sortKey-ft.sortKey);for(const lt of Qe){const ft=lt.state;if(te.activeTexture.set(ce.TEXTURE0),ft.atlasTexture.bind(ft.atlasInterpolation,ce.CLAMP_TO_EDGE),ft.atlasTextureIcon&&(te.activeTexture.set(ce.TEXTURE1),ft.atlasTextureIcon&&ft.atlasTextureIcon.bind(ft.atlasInterpolationIcon,ce.CLAMP_TO_EDGE)),ft.isSDF){const _t=ft.uniformValues;ft.hasHalo&&(_t.u_is_halo=1,at(ft.buffers,lt.segments,u,w,ft.program,Ye,N,H,_t,ft.projectionData,lt.terrainData)),_t.u_is_halo=0}at(ft.buffers,lt.segments,u,w,ft.program,Ye,N,H,ft.uniformValues,ft.projectionData,lt.terrainData)}}function at(w,o,u,g,v,T,M,A,O,U,N){const H=g.context;v.draw(H,H.gl.TRIANGLES,T,M,A,ki.backCCW,O,N,U,u.id,w.layoutVertexBuffer,w.indexBuffer,o,u.paint,g.transform.zoom,w.programConfigurations.get(u.id),w.dynamicLayoutVertexBuffer,w.opacityVertexBuffer)}function wt(w,o,u,g,v){const T=w.context,M=T.gl,A=Ri.disabled,O=new fr([M.ONE,M.ONE],p.bo.transparent,[!0,!0,!0,!0]),U=o.getBucket(u);if(!U)return;const N=g.key;let H=u.heatmapFbos.get(N);H||(H=wn(T,o.tileSize,o.tileSize),u.heatmapFbos.set(N,H)),T.bindFramebuffer.set(H.framebuffer),T.viewport.set([0,0,o.tileSize,o.tileSize]),T.clear({color:p.bo.transparent});const q=U.programConfigurations.get(u.id),te=w.useProgram("heatmap",q,!v),ce=w.transform.getProjectionData({overscaledTileID:o.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Te=w.style.map.terrain.getTerrainData(g);te.draw(T,M.TRIANGLES,ai.disabled,A,O,ki.disabled,Ta(o,w.transform.zoom,u.paint.get("heatmap-intensity"),1),Te,ce,u.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,u.paint,w.transform.zoom,q)}function Yt(w,o,u,g,v){const T=w.context,M=T.gl,A=w.transform;T.setColorMode(w.colorModeForRenderPass());const O=ei(T,o),U=u.key,N=o.heatmapFbos.get(U);if(!N)return;T.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,N.colorAttachment.get()),T.activeTexture.set(M.TEXTURE1),O.bind(M.LINEAR,M.CLAMP_TO_EDGE);const H=A.getProjectionData({overscaledTileID:u,applyTerrainMatrix:v,applyGlobeMatrix:!g});w.useProgram("heatmapTexture").draw(T,M.TRIANGLES,ai.disabled,Ri.disabled,w.colorModeForRenderPass(),ki.disabled,pu(w,o,0,1),null,H,o.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments,o.paint,A.zoom),N.destroy(),o.heatmapFbos.delete(U)}function wn(w,o,u){var g,v;const T=w.gl,M=T.createTexture();T.bindTexture(T.TEXTURE_2D,M),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,T.CLAMP_TO_EDGE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.LINEAR),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.LINEAR);const A=null!==(g=w.HALF_FLOAT)&&void 0!==g?g:T.UNSIGNED_BYTE,O=null!==(v=w.RGBA16F)&&void 0!==v?v:T.RGBA;T.texImage2D(T.TEXTURE_2D,0,O,o,u,0,T.RGBA,A,null);const U=w.createFramebuffer(o,u,!1,!1);return U.colorAttachment.set(M),U}function ei(w,o){return o.colorRampTexture||(o.colorRampTexture=new p.T(w,o.colorRamp,w.gl.RGBA)),o.colorRampTexture}function Ti(w,o,u,g,v,T,M,A){let O=256;if(v.stepInterpolant){const U=o.getSource().maxzoom,N=M.canonical.z===U?Math.ceil(1<<w.transform.maxZoom-M.canonical.z):1;O=p.an(p.cd(T.maxLineLength/p.a4*1024*N),256,u.maxTextureSize)}return A.gradient=p.ce({expression:v.gradientExpression(),evaluationKey:"lineProgress",resolution:O,image:A.gradient||void 0,clips:T.lineClipsArray}),A.texture?A.texture.update(A.gradient):A.texture=new p.T(u,A.gradient,g.RGBA),A.version=v.gradientVersion,A.texture}function Ko(w,o,u,g,v){w.activeTexture.set(o.TEXTURE0),u.imageAtlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),g.updatePaintBuffers(v)}function Eo(w,o,u,g,v,T){(v||w.lineAtlas.dirty)&&(o.activeTexture.set(u.TEXTURE0),w.lineAtlas.bind(o)),g.updatePaintBuffers(T)}function ms(w,o,u,g,v,T,M){const A=T.gradients[v.id];let O=A.texture;v.gradientVersion!==A.version&&(O=Ti(w,o,u,g,v,T,M,A)),u.activeTexture.set(g.TEXTURE0),O.bind(v.stepInterpolant?g.NEAREST:g.LINEAR,g.CLAMP_TO_EDGE)}function Qo(w,o,u,g,v,T,M,A,O){const U=T.gradients[v.id];let N=U.texture;v.gradientVersion!==U.version&&(N=Ti(w,o,u,g,v,T,M,U)),u.activeTexture.set(g.TEXTURE0),N.bind(v.stepInterpolant?g.NEAREST:g.LINEAR,g.CLAMP_TO_EDGE),u.activeTexture.set(g.TEXTURE1),w.lineAtlas.bind(u),A.updatePaintBuffers(O)}function sl(w,o,u,g,v){if(!u||!g||!g.imageAtlas)return;const T=g.imageAtlas.patternPositions;let M=T[u.to.toString()],A=T[u.from.toString()];if(!M&&A&&(M=A),!A&&M&&(A=M),!M||!A){const O=v.getPaintProperty(o);M=T[O],A=T[O]}M&&A&&w.setConstantPatternPositions(M,A)}function $c(w,o,u,g,v,T,M,A){const O=w.context.gl,U="fill-pattern",N=u.paint.get(U),H=N&&N.constantOr(1),q=u.getCrossfadeParameters();let te,ce,Te,De,we;const Le=w.transform,je=u.paint.get("fill-translate"),Re=u.paint.get("fill-translate-anchor");M?(ce=H&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",te=O.LINES):(ce=H?"fillPattern":"fill",te=O.TRIANGLES);const $e=N.constantOr(null);for(const Ye of g){const Ne=o.getTile(Ye);if(H&&!Ne.patternsLoaded())continue;const Qe=Ne.getBucket(u);if(!Qe)continue;const gt=Qe.programConfigurations.get(u.id),lt=w.useProgram(ce,gt),ft=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ye);H&&(w.context.activeTexture.set(O.TEXTURE0),Ne.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),gt.updatePaintBuffers(q)),sl(gt,U,$e,Ne,u);const _t=Le.getProjectionData({overscaledTileID:Ye,applyGlobeMatrix:!A,applyTerrainMatrix:!0}),Ht=p.aN(Le,Ne,je,Re);if(M){De=Qe.indexBuffer2,we=Qe.segments2;const Ft=[O.drawingBufferWidth,O.drawingBufferHeight];Te="fillOutlinePattern"===ce&&H?fa(w,q,Ne,Ft,Ht):rf(Ft,Ht)}else De=Qe.indexBuffer,we=Qe.segments,Te=H?fd(w,q,Ne,Ht):{u_fill_translate:Ht};const $t=w.stencilModeForClipping(Ye);lt.draw(w.context,te,v,$t,T,ki.backCCW,Te,ft,_t,u.id,Qe.layoutVertexBuffer,De,we,u.paint,w.transform.zoom,gt)}}function ni(w,o,u,g,v,T,M,A){const O=w.context,U=O.gl,N="fill-extrusion-pattern",H=u.paint.get(N),q=H.constantOr(1),te=u.getCrossfadeParameters(),ce=u.paint.get("fill-extrusion-opacity"),Te=H.constantOr(null),De=w.transform;for(const we of g){const Le=o.getTile(we),je=Le.getBucket(u);if(!je)continue;const Re=w.style.map.terrain&&w.style.map.terrain.getTerrainData(we),$e=je.programConfigurations.get(u.id),Ye=w.useProgram(q?"fillExtrusionPattern":"fillExtrusion",$e);q&&(w.context.activeTexture.set(U.TEXTURE0),Le.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),$e.updatePaintBuffers(te));const Ne=De.getProjectionData({overscaledTileID:we,applyGlobeMatrix:!A,applyTerrainMatrix:!0});sl($e,N,Te,Le,u);const Qe=p.aN(De,Le,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),gt=u.paint.get("fill-extrusion-vertical-gradient"),lt=q?Nc(w,gt,ce,Qe,we,te,Le):fu(w,gt,ce,Qe);Ye.draw(O,O.gl.TRIANGLES,v,T,M,ki.backCCW,lt,Re,Ne,u.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,u.paint,w.transform.zoom,$e,w.style.map.terrain&&je.centroidVertexBuffer)}}function Zt(w,o,u,g,v,T,M,A,O){var U;const N=w.style.projection,H=w.context,q=w.transform,te=H.gl,ce=[`#define NUM_ILLUMINATION_SOURCES ${u.paint.get("hillshade-highlight-color").values.length}`],Te=w.useProgram("hillshade",null,!1,ce),De=!w.options.moving;for(const we of g){const Le=o.getTile(we),je=Le.fbo;if(!je)continue;const Re=N.getMeshFromTileID(H,we.canonical,A,!0,"raster"),$e=null===(U=w.style.map.terrain)||void 0===U?void 0:U.getTerrainData(we);H.activeTexture.set(te.TEXTURE0),te.bindTexture(te.TEXTURE_2D,je.colorAttachment.get());const Ye=q.getProjectionData({overscaledTileID:we,aligned:De,applyGlobeMatrix:!O,applyTerrainMatrix:!0});Te.draw(H,te.TRIANGLES,T,v[we.overscaledZ],M,ki.backCCW,hs(w,Le,u),$e,Ye,u.id,Re.vertexBuffer,Re.indexBuffer,Re.segments)}}function An(w,o,u,g,v,T,M,A,O){var U;const N=w.style.projection,H=w.context,q=w.transform,te=H.gl,ce=w.useProgram("colorRelief"),Te=!w.options.moving;let De=!0,we=0;for(const Le of g){const je=o.getTile(Le),Re=je.dem;if(De){const lt=te.getParameter(te.MAX_TEXTURE_SIZE),{elevationTexture:ft,colorTexture:_t}=u.getColorRampTextures(H,lt,Re.getUnpackVector());H.activeTexture.set(te.TEXTURE1),ft.bind(te.NEAREST,te.CLAMP_TO_EDGE),H.activeTexture.set(te.TEXTURE4),_t.bind(te.LINEAR,te.CLAMP_TO_EDGE),De=!1,we=ft.size[0]}if(!Re||!Re.data)continue;const $e=Re.stride,Ye=Re.getPixels();if(H.activeTexture.set(te.TEXTURE0),H.pixelStoreUnpackPremultiplyAlpha.set(!1),je.demTexture=je.demTexture||w.getTileTexture($e),je.demTexture){const lt=je.demTexture;lt.update(Ye,{premultiply:!1}),lt.bind(te.LINEAR,te.CLAMP_TO_EDGE)}else je.demTexture=new p.T(H,Ye,te.RGBA,{premultiply:!1}),je.demTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE);const Ne=N.getMeshFromTileID(H,Le.canonical,A,!0,"raster"),Qe=null===(U=w.style.map.terrain)||void 0===U?void 0:U.getTerrainData(Le),gt=q.getProjectionData({overscaledTileID:Le,aligned:Te,applyGlobeMatrix:!O,applyTerrainMatrix:!0});ce.draw(H,te.TRIANGLES,T,v[Le.overscaledZ],M,ki.backCCW,gu(u,je.dem,we),Qe,gt,u.id,Ne.vertexBuffer,Ne.indexBuffer,Ne.segments)}}const vr=[new p.P(0,0),new p.P(p.a4,0),new p.P(p.a4,p.a4),new p.P(0,p.a4)];function Br(w,o,u,g,v,T,M,A,O=!1,U=!1){const N=g[g.length-1].overscaledZ,H=w.context,q=H.gl,te=w.useProgram("raster"),ce=w.transform,Te=w.style.projection,De=w.colorModeForRenderPass(),we=!w.options.moving,Le=u.paint.get("raster-opacity"),je=u.paint.get("raster-resampling"),Re=u.paint.get("raster-fade-duration"),$e=!!w.style.map.terrain;for(const Ye of g){const Ne=w.getDepthModeForSublayer(Ye.overscaledZ-N,1===Le?ai.ReadWrite:ai.ReadOnly,q.LESS),Qe=o.getTile(Ye),gt="nearest"===je?q.NEAREST:q.LINEAR;H.activeTexture.set(q.TEXTURE0),Qe.texture.bind(gt,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST),H.activeTexture.set(q.TEXTURE1);const{parentTile:lt,parentScaleBy:ft,parentTopLeft:_t,fadeValues:Ht}=Ni(Qe,o,Re,$e);Qe.fadeOpacity=Ht.tileOpacity,lt?(lt.fadeOpacity=Ht.parentTileOpacity,lt.texture.bind(gt,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST)):Qe.texture.bind(gt,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST),Qe.texture.useMipmap&&H.extTextureFilterAnisotropic&&w.transform.pitch>20&&q.texParameterf(q.TEXTURE_2D,H.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,H.extTextureFilterAnisotropicMax);const $t=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ye),Ft=ce.getProjectionData({overscaledTileID:Ye,aligned:we,applyGlobeMatrix:!U,applyTerrainMatrix:!0}),Tn=no(_t,ft,Ht.fadeMix,u,A),yi=Te.getMeshFromTileID(H,Ye.canonical,T,M,"raster");te.draw(H,q.TRIANGLES,Ne,v?v[Ye.overscaledZ]:Ri.disabled,De,O?ki.frontCCW:ki.backCCW,Tn,$t,Ft,u.id,yi.vertexBuffer,yi.indexBuffer,yi.segments)}}function Ni(w,o,u,g){const v={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(0===u||g)return v;if(w.fadingParentID){const T=o.getLoadedTile(w.fadingParentID);if(!T)return v;const M=Math.pow(2,T.tileID.overscaledZ-w.tileID.overscaledZ);return{parentTile:T,parentScaleBy:M,parentTopLeft:[w.tileID.canonical.x*M%1,w.tileID.canonical.y*M%1],fadeValues:function(U,N,H){const q=ue(),te=(q-N.timeAdded)/H,ce=U.fadingDirection===He.Incoming,Te=p.an((q-U.timeAdded)/H,0,1),De=p.an(1-te,0,1),we=ce?Te:De;return{tileOpacity:we,parentTileOpacity:ce?De:Te,fadeMix:{opacity:1,mix:1-we}}}(w,T,u)}}return w.selfFading?{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:function(M,A){const O=(ue()-M.timeAdded)/A,U=p.an(O,0,1);return{tileOpacity:U,fadeMix:{opacity:U,mix:0}}}(w,u)}:v}const Vr=new p.bo(1,0,0,1),Bl=new p.bo(0,1,0,1),Xi=new p.bo(0,0,1,1),Ar=new p.bo(1,0,1,1),Qs=new p.bo(0,1,1,1);function Kn(w,o,u,g){Gc(w,0,o+u/2,w.transform.width,u,g)}function al(w,o,u,g){Gc(w,o-u/2,0,u,w.transform.height,g)}function Gc(w,o,u,g,v,T){const M=w.context,A=M.gl;A.enable(A.SCISSOR_TEST),A.scissor(o*w.pixelRatio,u*w.pixelRatio,g*w.pixelRatio,v*w.pixelRatio),M.clear({color:T}),A.disable(A.SCISSOR_TEST)}function Tu(w,o,u){const g=w.context,v=g.gl,T=w.useProgram("debug"),M=ai.disabled,A=Ri.disabled,O=w.colorModeForRenderPass(),U="$debug",N=w.style.map.terrain&&w.style.map.terrain.getTerrainData(u);g.activeTexture.set(v.TEXTURE0);const H=o.getTileByID(u.key).latestRawTileData,q=Math.floor((H&&H.byteLength||0)/1024),te=o.getTile(u).tileSize,ce=512/Math.min(te,512)*(u.overscaledZ/w.transform.zoom)*.5;let Te=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(Te+=` => ${u.overscaledZ}`),function(we,Le){we.initDebugOverlayCanvas();const je=we.debugOverlayCanvas,Re=we.context.gl,$e=we.debugOverlayCanvas.getContext("2d");$e.clearRect(0,0,je.width,je.height),$e.shadowColor="white",$e.shadowBlur=2,$e.lineWidth=1.5,$e.strokeStyle="white",$e.textBaseline="top",$e.font="bold 36px Open Sans, sans-serif",$e.fillText(Le,5,5),$e.strokeText(Le,5,5),we.debugOverlayTexture.update(je),we.debugOverlayTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)}(w,`${Te} ${q}kB`);const De=w.transform.getProjectionData({overscaledTileID:u,applyGlobeMatrix:!0,applyTerrainMatrix:!0});T.draw(g,v.TRIANGLES,M,A,fr.alphaBlended,ki.disabled,Ot(p.bo.transparent,ce),null,De,U,w.debugBuffer,w.quadTriangleIndexBuffer,w.debugSegments),T.draw(g,v.LINE_STRIP,M,A,O,ki.disabled,Ot(p.bo.red),N,De,U,w.debugBuffer,w.tileBorderIndexBuffer,w.debugSegments)}function or(w,o,u,g){const{isRenderingGlobe:v}=g,T=w.context,M=T.gl,A=w.transform,O=w.colorModeForRenderPass(),U=w.getDepthModeFor3D(),N=w.useProgram("terrain");T.bindFramebuffer.set(null),T.viewport.set([0,0,w.width,w.height]);for(const H of u){const q=o.getTerrainMesh(H.tileID),te=w.renderToTexture.getTexture(H),ce=o.getTerrainData(H.tileID);T.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,te.texture);const Te=o.getMeshFrameDelta(A.zoom),De=A.calculateFogMatrix(H.tileID.toUnwrapped()),we=dd(Te,De,w.style.sky,A.pitch,v),Le=A.getProjectionData({overscaledTileID:H.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});N.draw(T,M.TRIANGLES,U,Ri.disabled,O,ki.backCCW,we,ce,Le,"terrain",q.vertexBuffer,q.indexBuffer,q.segments)}}function xc(w,o){if(!o.mesh){const u=new p.aV;u.emplaceBack(-1,-1),u.emplaceBack(1,-1),u.emplaceBack(1,1),u.emplaceBack(-1,1);const g=new p.aX;g.emplaceBack(0,1,2),g.emplaceBack(0,2,3),o.mesh=new Oa(w.createVertexBuffer(u,go.members),w.createIndexBuffer(g),p.aW.simpleSegment(0,0,u.length,g.length))}return o.mesh}class Du{constructor(o,u){this.context=new Cu(o),this.transform=u,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:p.ar(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ei.maxOverzooming+Ei.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Pl}resize(o,u,g){if(this.width=Math.floor(o*g),this.height=Math.floor(u*g),this.pixelRatio=g,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style._order)this.style._layers[v].resize()}setup(){const o=this.context,u=new p.aV;u.emplaceBack(0,0),u.emplaceBack(p.a4,0),u.emplaceBack(0,p.a4),u.emplaceBack(p.a4,p.a4),this.tileExtentBuffer=o.createVertexBuffer(u,go.members),this.tileExtentSegments=p.aW.simpleSegment(0,0,4,2);const g=new p.aV;g.emplaceBack(0,0),g.emplaceBack(p.a4,0),g.emplaceBack(0,p.a4),g.emplaceBack(p.a4,p.a4),this.debugBuffer=o.createVertexBuffer(g,go.members),this.debugSegments=p.aW.simpleSegment(0,0,4,5);const v=new p.cg;v.emplaceBack(0,0,0,0),v.emplaceBack(p.a4,0,p.a4,0),v.emplaceBack(0,p.a4,0,p.a4),v.emplaceBack(p.a4,p.a4,p.a4,p.a4),this.rasterBoundsBuffer=o.createVertexBuffer(v,yr.members),this.rasterBoundsSegments=p.aW.simpleSegment(0,0,4,2);const T=new p.aV;T.emplaceBack(0,0),T.emplaceBack(p.a4,0),T.emplaceBack(0,p.a4),T.emplaceBack(p.a4,p.a4),this.rasterBoundsBufferPosOnly=o.createVertexBuffer(T,go.members),this.rasterBoundsSegmentsPosOnly=p.aW.simpleSegment(0,0,4,5);const M=new p.aV;M.emplaceBack(0,0),M.emplaceBack(1,0),M.emplaceBack(0,1),M.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(M,go.members),this.viewportSegments=p.aW.simpleSegment(0,0,4,2);const A=new p.ch;A.emplaceBack(0),A.emplaceBack(1),A.emplaceBack(3),A.emplaceBack(2),A.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(A);const O=new p.aX;O.emplaceBack(1,0,2),O.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(O);const U=this.context.gl;this.stencilClearMode=new Ri({func:U.ALWAYS,mask:0},0,255,U.ZERO,U.ZERO,U.ZERO),this.tileExtentMesh=new Oa(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const o=this.context,u=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const g=p.N();p.c6(g,0,this.width,this.height,0,0,1),p.Q(g,g,[u.drawingBufferWidth,u.drawingBufferHeight,0]);const v={mainMatrix:g,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:g};this.useProgram("clippingMask",null,!0).draw(o,u.TRIANGLES,ai.disabled,this.stencilClearMode,fr.disabled,ki.disabled,null,null,v,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,u,g){if(this.currentStencilSource===o.source||!o.isTileClipped()||!u||!u.length)return;this.currentStencilSource=o.source,this.nextStencilID+u.length>256&&this.clearStencil();const v=this.context;v.setColorMode(fr.disabled),v.setDepthMode(ai.disabled);const T={};for(const M of u)T[M.key]=this.nextStencilID++;this._renderTileMasks(T,u,g,!0),this._renderTileMasks(T,u,g,!1),this._tileClippingMaskIDs=T}_renderTileMasks(o,u,g,v){const T=this.context,M=T.gl,A=this.style.projection,O=this.transform,U=this.useProgram("clippingMask");for(const N of u){const H=o[N.key],q=this.style.map.terrain&&this.style.map.terrain.getTerrainData(N),te=A.getMeshFromTileID(this.context,N.canonical,v,!0,"stencil"),ce=O.getProjectionData({overscaledTileID:N,applyGlobeMatrix:!g,applyTerrainMatrix:!0});U.draw(T,M.TRIANGLES,ai.disabled,new Ri({func:M.ALWAYS,mask:0},H,255,M.KEEP,M.KEEP,M.REPLACE),fr.disabled,g?ki.disabled:ki.backCCW,null,q,ce,"$clipping",te.vertexBuffer,te.indexBuffer,te.segments)}}_renderTilesDepthBuffer(){const o=this.context,u=o.gl,g=this.style.projection,v=this.transform,T=this.useProgram("depth"),M=this.getDepthModeFor3D(),A=ri(v,{tileSize:v.tileSize});for(const O of A){const U=this.style.map.terrain&&this.style.map.terrain.getTerrainData(O),N=g.getMeshFromTileID(this.context,O.canonical,!0,!0,"raster"),H=v.getProjectionData({overscaledTileID:O,applyGlobeMatrix:!0,applyTerrainMatrix:!0});T.draw(o,u.TRIANGLES,M,Ri.disabled,fr.disabled,ki.backCCW,null,U,H,"$clipping",N.vertexBuffer,N.indexBuffer,N.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,u=this.context.gl;return new Ri({func:u.NOTEQUAL,mask:255},o,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(o){const u=this.context.gl;return new Ri({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,u.KEEP,u.KEEP,u.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(o){const u=this.context.gl,g=o.sort((M,A)=>A.overscaledZ-M.overscaledZ),v=g[g.length-1].overscaledZ,T=g[0].overscaledZ-v+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const M={};for(let A=0;A<T;A++)M[A+v]=new Ri({func:u.GEQUAL,mask:255},A+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=T,[M,g]}return[{[v]:Ri.disabled},g]}stencilConfigForOverlapTwoPass(o){const u=this.context.gl,g=o.sort((M,A)=>A.overscaledZ-M.overscaledZ),v=g[g.length-1].overscaledZ,T=g[0].overscaledZ-v+1;if(this.clearStencil(),T>1){const M={},A={};for(let O=0;O<T;O++)M[O+v]=new Ri({func:u.GREATER,mask:255},T+1+O,255,u.KEEP,u.KEEP,u.REPLACE),A[O+v]=new Ri({func:u.GREATER,mask:255},1+O,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID=2*T+1,[M,A,g]}return this.nextStencilID=3,[{[v]:new Ri({func:u.GREATER,mask:255},2,255,u.KEEP,u.KEEP,u.REPLACE)},{[v]:new Ri({func:u.GREATER,mask:255},1,255,u.KEEP,u.KEEP,u.REPLACE)},g]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new fr([o.CONSTANT_COLOR,o.ONE],new p.bo(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?fr.unblended:fr.alphaBlended}getDepthModeForSublayer(o,u,g){if(!this.opaquePassEnabledForLayer())return ai.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new ai(g||this.context.gl.LEQUAL,u,[v,v])}getDepthModeFor3D(){return new ai(this.context.gl.LEQUAL,ai.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,u){var g,v;this.style=o,this.options=u,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(ue()),this.imageManager.beginFrame();const T=this.style._order,M=this.style.tileManagers,A={},O={},U={},N={isRenderingToTexture:!1,isRenderingGlobe:(null===(g=o.projection)||void 0===g?void 0:g.transitionState)>0};for(const q in M){const te=M[q];te.used&&te.prepare(this.context),A[q]=te.getVisibleCoordinates(!1),O[q]=A[q].slice().reverse(),U[q]=te.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let q=0;q<T.length;q++)if(this.style._layers[T[q]].is3D()){this.opaquePassCutoff=q;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const q of T){const te=this.style._layers[q];if(!te.hasOffscreenPass()||te.isHidden(this.transform.zoom))continue;const ce=O[te.source];("custom"===te.type||ce.length)&&this.renderLayer(this,M[te.source],te,ce,N)}if(null===(v=this.style.projection)||void 0===v||v.updateGPUdependent({context:this.context,useProgram:q=>this.useProgram(q)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?p.bo.black:p.bo.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(q,te){const ce=q.context,Te=ce.gl,De=((Ye,Ne,Qe)=>{const gt=Math.cos(Ne.rollInRadians),lt=Math.sin(Ne.rollInRadians),ft=rt(Ne),_t=Ne.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Ye.properties.get("sky-color"),u_horizon_color:Ye.properties.get("horizon-color"),u_horizon:[(Ne.width/2-ft*lt)*Qe,(Ne.height/2+ft*gt)*Qe],u_horizon_normal:[-lt,gt],u_sky_horizon_blend:Ye.properties.get("sky-horizon-blend")*Ne.height/2*Qe,u_sky_blend:_t}})(te,q.style.map.transform,q.pixelRatio),we=new ai(Te.LEQUAL,ai.ReadWrite,[0,1]),Le=Ri.disabled,je=q.colorModeForRenderPass(),Re=q.useProgram("sky"),$e=xc(ce,te);Re.draw(ce,Te.TRIANGLES,we,Le,je,ki.disabled,De,null,void 0,"sky",$e.vertexBuffer,$e.indexBuffer,$e.segments)}(this,this.style.sky),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=T.length-1;this.currentLayer>=0;this.currentLayer--){const q=this.style._layers[T[this.currentLayer]],te=M[q.source],ce=A[q.source];this._renderTileClippingMasks(q,ce,!1),this.renderLayer(this,te,q,ce,N)}this.renderPass="translucent";let H=!1;for(this.currentLayer=0;this.currentLayer<T.length;this.currentLayer++){const q=this.style._layers[T[this.currentLayer]],te=M[q.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(q,N))continue;this.opaquePassEnabledForLayer()||H||(H=!0,N.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const ce=("symbol"===q.type?U:O)[q.source];this._renderTileClippingMasks(q,A[q.source],!!this.renderToTexture),this.renderLayer(this,te,q,ce,N)}if(N.isRenderingGlobe&&function(q,te,ce){const Te=q.context,De=Te.gl,we=q.useProgram("atmosphere"),Le=new ai(De.LEQUAL,ai.ReadOnly,[0,1]),je=q.transform,Re=function(_t,Ht){const $t=_t.properties.get("position"),Ft=[-$t.x,-$t.y,-$t.z],Tn=p.ar(new Float64Array(16));return"map"===_t.properties.get("anchor")&&(p.bf(Tn,Tn,Ht.rollInRadians),p.bg(Tn,Tn,-Ht.pitchInRadians),p.bf(Tn,Tn,Ht.bearingInRadians),p.bg(Tn,Tn,Ht.center.lat*Math.PI/180),p.bI(Tn,Tn,-Ht.center.lng*Math.PI/180)),p.cf(Ft,Ft,Tn),Ft}(ce,q.transform),$e=je.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ye=te.properties.get("atmosphere-blend")*$e.projectionTransition;if(0===Ye)return;const Ne=ud(je.worldSize,je.center.lat),Qe=je.inverseProjectionMatrix,gt=new Float64Array(4);gt[3]=1,p.aG(gt,gt,je.modelViewProjectionMatrix),gt[0]/=gt[3],gt[1]/=gt[3],gt[2]/=gt[3],gt[3]=1,p.aG(gt,gt,Qe),gt[0]/=gt[3],gt[1]/=gt[3],gt[2]/=gt[3],gt[3]=1;const lt=((_t,Ht,$t,Ft,Tn)=>({u_sun_pos:_t,u_atmosphere_blend:Ht,u_globe_position:$t,u_globe_radius:Ft,u_inv_proj_matrix:Tn}))(Re,Ye,[gt[0],gt[1],gt[2]],Ne,Qe),ft=xc(Te,te);we.draw(Te,De.TRIANGLES,Le,Ri.disabled,fr.alphaBlended,ki.disabled,lt,null,null,"atmosphere",ft.vertexBuffer,ft.indexBuffer,ft.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const q=function(te,ce){let Te=null;const De=Object.values(te._layers).flatMap(Re=>Re.source&&!Re.isHidden(ce)?[te.tileManagers[Re.source]]:[]),we=De.filter(Re=>"vector"===Re.getSource().type),Le=De.filter(Re=>"vector"!==Re.getSource().type),je=Re=>{(!Te||Te.getSource().maxzoom<Re.getSource().maxzoom)&&(Te=Re)};return we.forEach(Re=>je(Re)),Te||Le.forEach(Re=>je(Re)),Te}(this.style,this.transform.zoom);q&&function(te,ce,Te){for(let De=0;De<Te.length;De++)Tu(te,ce,Te[De])}(this,q,q.getVisibleCoordinates())}this.options.showPadding&&function(q){const te=q.transform.padding;Kn(q,q.transform.height-(te.top||0),3,Vr),Kn(q,te.bottom||0,3,Bl),al(q,te.left||0,3,Xi),al(q,q.transform.width-(te.right||0),3,Ar);const ce=q.transform.centerPoint;var Te,De,we,Le;Gc(Te=q,(De=ce.x)-1,(we=q.transform.height-ce.y)-10,2,20,Le=Qs),Gc(Te,De-10,we-1,20,2,Le)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(o){if(!this.style||!this.style.map||!this.style.map.terrain)return;const u=this.terrainFacilitator.matrix,g=this.transform.modelViewProjectionMatrix;let v=this.terrainFacilitator.dirty;v||(v=o?!p.ci(u,g):!p.cj(u,g)),v||(v=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),v&&(p.ck(u,g),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(T,M){const A=T.context,O=A.gl,U=T.transform,N=fr.unblended,H=new ai(O.LEQUAL,ai.ReadWrite,[0,1]),q=M.tileManager.getRenderableTiles(),te=T.useProgram("terrainDepth");A.bindFramebuffer.set(M.getFramebuffer("depth").framebuffer),A.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),A.clear({color:p.bo.transparent,depth:1});for(const ce of q){const Te=M.getTerrainMesh(ce.tileID),De=M.getTerrainData(ce.tileID),we=U.getProjectionData({overscaledTileID:ce.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Le={u_ele_delta:M.getMeshFrameDelta(U.zoom)};te.draw(A,O.TRIANGLES,H,Ri.disabled,N,ki.backCCW,Le,De,we,"terrain",Te.vertexBuffer,Te.indexBuffer,Te.segments)}A.bindFramebuffer.set(null),A.viewport.set([0,0,T.width,T.height])}(this,this.style.map.terrain),function(T,M){const A=T.context,O=A.gl,U=T.transform,N=fr.unblended,H=new ai(O.LEQUAL,ai.ReadWrite,[0,1]),q=M.getCoordsTexture(),te=M.tileManager.getRenderableTiles(),ce=T.useProgram("terrainCoords");A.bindFramebuffer.set(M.getFramebuffer("coords").framebuffer),A.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),A.clear({color:p.bo.transparent,depth:1}),M.coordsIndex=[];for(const Te of te){const De=M.getTerrainMesh(Te.tileID),we=M.getTerrainData(Te.tileID);A.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,q.texture);const Le={u_terrain_coords_id:(255-M.coordsIndex.length)/255,u_texture:0,u_ele_delta:M.getMeshFrameDelta(U.zoom)},je=U.getProjectionData({overscaledTileID:Te.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});ce.draw(A,O.TRIANGLES,H,Ri.disabled,N,ki.backCCW,Le,we,je,"terrain",De.vertexBuffer,De.indexBuffer,De.segments),M.coordsIndex.push(Te.tileID.key)}A.bindFramebuffer.set(null),A.viewport.set([0,0,T.width,T.height])}(this,this.style.map.terrain))}renderLayer(o,u,g,v,T){g.isHidden(this.transform.zoom)||("background"===g.type||"custom"===g.type||(v||[]).length)&&(this.id=g.id,p.cl(g)?function(M,A,O,U,N,H){if("translucent"!==M.renderPass)return;const{isRenderingToTexture:q}=H,te=Ri.disabled,ce=M.colorModeForRenderPass();(O._unevaluatedLayout.hasValue("text-variable-anchor")||O._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Te,De,we,Le,je,Re,$e,Ye,Ne){const Qe=De.transform,gt=De.style.map.terrain,lt="map"===je,ft="map"===Re;for(const _t of Te){const Ht=Le.getTile(_t),$t=Ht.getBucket(we);if(!$t||!$t.text||!$t.text.segments.get().length)continue;const Ft=p.ax($t.textSizeData,Qe.zoom),Tn=p.aM(Ht,1,De.transform.zoom),yi=Zr(lt,De.transform,Tn),pi="none"!==we.layout.get("icon-text-fit")&&$t.hasIconData();if(Ft){const br=Math.pow(2,Qe.zoom-Ht.tileID.overscaledZ),xr=gt?(Or,ar)=>gt.getElevation(_t,Or,ar):null;Y($t,lt,ft,Ne,Qe,yi,br,Ft,pi,p.aN(Qe,Ht,$e,Ye),_t.toUnwrapped(),xr)}}}(U,M,O,A,O.layout.get("text-rotation-alignment"),O.layout.get("text-pitch-alignment"),O.paint.get("text-translate"),O.paint.get("text-translate-anchor"),N),0!==O.paint.get("icon-opacity").constantOr(1)&&qe(M,A,O,U,!1,O.paint.get("icon-translate"),O.paint.get("icon-translate-anchor"),O.layout.get("icon-rotation-alignment"),O.layout.get("icon-pitch-alignment"),O.layout.get("icon-keep-upright"),te,ce,q),0!==O.paint.get("text-opacity").constantOr(1)&&qe(M,A,O,U,!0,O.paint.get("text-translate"),O.paint.get("text-translate-anchor"),O.layout.get("text-rotation-alignment"),O.layout.get("text-pitch-alignment"),O.layout.get("text-keep-upright"),te,ce,q),A.map.showCollisionBoxes&&(f(M,A,O,U,!0),f(M,A,O,U,!1))}(o,u,g,v,this.style.placement.variableOffsets,T):p.cm(g)?function(M,A,O,U,N){if("translucent"!==M.renderPass)return;const{isRenderingToTexture:H}=N,q=O.paint.get("circle-opacity"),te=O.paint.get("circle-stroke-width"),ce=O.paint.get("circle-stroke-opacity"),Te=!O.layout.get("circle-sort-key").isConstant();if(0===q.constantOr(1)&&(0===te.constantOr(1)||0===ce.constantOr(1)))return;const De=M.context,we=De.gl,Le=M.transform,je=M.getDepthModeForSublayer(0,ai.ReadOnly),Re=Ri.disabled,$e=M.colorModeForRenderPass(),Ye=[],Ne=Le.getCircleRadiusCorrection();for(let Qe=0;Qe<U.length;Qe++){const gt=U[Qe],lt=A.getTile(gt),ft=lt.getBucket(O);if(!ft)continue;const _t=O.paint.get("circle-translate"),Ht=O.paint.get("circle-translate-anchor"),$t=p.aN(Le,lt,_t,Ht),Ft=ft.programConfigurations.get(O.id),Tn=M.useProgram("circle",Ft),yi=ft.layoutVertexBuffer,pi=ft.indexBuffer,br=M.style.map.terrain&&M.style.map.terrain.getTerrainData(gt),xr={programConfiguration:Ft,program:Tn,layoutVertexBuffer:yi,indexBuffer:pi,uniformValues:dc(M,lt,O,$t,Ne),terrainData:br,projectionData:Le.getProjectionData({overscaledTileID:gt,applyGlobeMatrix:!H,applyTerrainMatrix:!0})};if(Te){const Or=ft.segments.get();for(const ar of Or)Ye.push({segments:new p.aW([ar]),sortKey:ar.sortKey,state:xr})}else Ye.push({segments:ft.segments,sortKey:0,state:xr})}Te&&Ye.sort((Qe,gt)=>Qe.sortKey-gt.sortKey);for(const Qe of Ye){const{programConfiguration:gt,program:lt,layoutVertexBuffer:ft,indexBuffer:_t,uniformValues:Ht,terrainData:$t,projectionData:Ft}=Qe.state;lt.draw(De,we.TRIANGLES,je,Re,$e,ki.backCCW,Ht,$t,Ft,O.id,ft,_t,Qe.segments,O.paint,M.transform.zoom,gt)}}(o,u,g,v,T):p.cn(g)?function(M,A,O,U,N){if(0===O.paint.get("heatmap-opacity"))return;const H=M.context,{isRenderingToTexture:q,isRenderingGlobe:te}=N;if(M.style.map.terrain){for(const ce of U){const Te=A.getTile(ce);A.hasRenderableParent(ce)||("offscreen"===M.renderPass?wt(M,Te,O,ce,te):"translucent"===M.renderPass&&Yt(M,O,ce,q,te))}H.viewport.set([0,0,M.width,M.height])}else"offscreen"===M.renderPass?function(ce,Te,De,we){const Le=ce.context,je=Le.gl,Re=ce.transform,$e=Ri.disabled,Ye=new fr([je.ONE,je.ONE],p.bo.transparent,[!0,!0,!0,!0]);(function(Ne,Qe,gt){const lt=Ne.gl;Ne.activeTexture.set(lt.TEXTURE1),Ne.viewport.set([0,0,Qe.width/4,Qe.height/4]);let ft=gt.heatmapFbos.get(p.cc);ft?(lt.bindTexture(lt.TEXTURE_2D,ft.colorAttachment.get()),Ne.bindFramebuffer.set(ft.framebuffer)):(ft=wn(Ne,Qe.width/4,Qe.height/4),gt.heatmapFbos.set(p.cc,ft))})(Le,ce,De),Le.clear({color:p.bo.transparent});for(let Ne=0;Ne<we.length;Ne++){const Qe=we[Ne];if(Te.hasRenderableParent(Qe))continue;const gt=Te.getTile(Qe),lt=gt.getBucket(De);if(!lt)continue;const ft=lt.programConfigurations.get(De.id),_t=ce.useProgram("heatmap",ft),Ht=Re.getProjectionData({overscaledTileID:Qe,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),$t=Re.getCircleRadiusCorrection();_t.draw(Le,je.TRIANGLES,ai.disabled,$e,Ye,ki.backCCW,Ta(gt,Re.zoom,De.paint.get("heatmap-intensity"),$t),null,Ht,De.id,lt.layoutVertexBuffer,lt.indexBuffer,lt.segments,De.paint,Re.zoom,ft)}Le.viewport.set([0,0,ce.width,ce.height])}(M,A,O,U):"translucent"===M.renderPass&&function(ce,Te){const De=ce.context,we=De.gl;De.setColorMode(ce.colorModeForRenderPass());const Le=Te.heatmapFbos.get(p.cc);Le&&(De.activeTexture.set(we.TEXTURE0),we.bindTexture(we.TEXTURE_2D,Le.colorAttachment.get()),De.activeTexture.set(we.TEXTURE1),ei(De,Te).bind(we.LINEAR,we.CLAMP_TO_EDGE),ce.useProgram("heatmapTexture").draw(De,we.TRIANGLES,ai.disabled,Ri.disabled,ce.colorModeForRenderPass(),ki.disabled,pu(ce,Te,0,1),null,null,Te.id,ce.viewportBuffer,ce.quadTriangleIndexBuffer,ce.viewportSegments,Te.paint,ce.transform.zoom))}(M,O)}(o,u,g,v,T):p.co(g)?function(M,A,O,U,N){if("translucent"!==M.renderPass)return;const{isRenderingToTexture:H}=N,q=O.paint.get("line-opacity"),te=O.paint.get("line-width");if(0===q.constantOr(1)||0===te.constantOr(1))return;const ce=M.getDepthModeForSublayer(0,ai.ReadOnly),Te=M.colorModeForRenderPass(),De=O.paint.get("line-dasharray"),we=De.constantOr(1),Le=O.paint.get("line-pattern"),je=Le.constantOr(1),Re=O.paint.get("line-gradient"),$e=O.getCrossfadeParameters();let Ye;Ye=je?"linePattern":we&&Re?"lineGradientSDF":we?"lineSDF":Re?"lineGradient":"line";const Ne=M.context,Qe=Ne.gl,gt=M.transform;let lt=!0;for(const ft of U){const _t=A.getTile(ft);if(je&&!_t.patternsLoaded())continue;const Ht=_t.getBucket(O);if(!Ht)continue;const $t=Ht.programConfigurations.get(O.id),Ft=M.context.program.get(),Tn=M.useProgram(Ye,$t),yi=lt||Tn.program!==Ft,pi=M.style.map.terrain&&M.style.map.terrain.getTerrainData(ft),br=Le.constantOr(null),xr=De&&De.constantOr(null);if(br&&_t.imageAtlas){const oo=_t.imageAtlas,so=oo.patternPositions[br.to.toString()],bo=oo.patternPositions[br.from.toString()];so&&bo&&$t.setConstantPatternPositions(so,bo)}else if(xr){const oo="round"===O.layout.get("line-cap"),so=M.lineAtlas.getDash(xr.to,oo),bo=M.lineAtlas.getDash(xr.from,oo);$t.setConstantDashPositions(so,bo)}const Or=gt.getProjectionData({overscaledTileID:ft,applyGlobeMatrix:!H,applyTerrainMatrix:!0}),ar=gt.getPixelScale();let Ao;je?(Ao=Mp(M,_t,O,ar,$e),Ko(Ne,Qe,_t,$t,$e)):we&&Re?(Ao=sf(M,_t,O,ar,$e,Ht.lineClipsArray.length),Qo(M,A,Ne,Qe,O,Ht,ft,$t,$e)):we?(Ao=_u(M,_t,O,ar,$e),Eo(M,Ne,Qe,$t,yi,$e)):Re?(Ao=Na(M,_t,O,ar,Ht.lineClipsArray.length),ms(M,A,Ne,Qe,O,Ht,ft)):Ao=Da(M,_t,O,ar);const Fr=M.stencilModeForClipping(ft);Tn.draw(Ne,Qe.TRIANGLES,ce,Fr,Te,ki.disabled,Ao,pi,Or,O.id,Ht.layoutVertexBuffer,Ht.indexBuffer,Ht.segments,O.paint,M.transform.zoom,$t,Ht.layoutVertexBuffer2),lt=!1}}(o,u,g,v,T):p.cp(g)?function(M,A,O,U,N){const H=O.paint.get("fill-color"),q=O.paint.get("fill-opacity");if(0===q.constantOr(1))return;const{isRenderingToTexture:te}=N,ce=M.colorModeForRenderPass(),Te=O.paint.get("fill-pattern"),De=M.opaquePassEnabledForLayer()&&!Te.constantOr(1)&&1===H.constantOr(p.bo.transparent).a&&1===q.constantOr(0)?"opaque":"translucent";if(M.renderPass===De){const we=M.getDepthModeForSublayer(1,"opaque"===M.renderPass?ai.ReadWrite:ai.ReadOnly);$c(M,A,O,U,we,ce,!1,te)}if("translucent"===M.renderPass&&O.paint.get("fill-antialias")){const we=M.getDepthModeForSublayer(O.getPaintProperty("fill-outline-color")?2:0,ai.ReadOnly);$c(M,A,O,U,we,ce,!0,te)}}(o,u,g,v,T):p.cq(g)?function(M,A,O,U,N){const H=O.paint.get("fill-extrusion-opacity");if(0===H)return;const{isRenderingToTexture:q}=N;if("translucent"===M.renderPass){const te=new ai(M.context.gl.LEQUAL,ai.ReadWrite,M.depthRangeFor3D);if(1!==H||O.paint.get("fill-extrusion-pattern").constantOr(1))ni(M,A,O,U,te,Ri.disabled,fr.disabled,q),ni(M,A,O,U,te,M.stencilModeFor3D(),M.colorModeForRenderPass(),q);else{const ce=M.colorModeForRenderPass();ni(M,A,O,U,te,Ri.disabled,ce,q)}}}(o,u,g,v,T):p.cr(g)?function(M,A,O,U,N){if("offscreen"!==M.renderPass&&"translucent"!==M.renderPass)return;const{isRenderingToTexture:H}=N,q=M.context,te=M.style.projection.useSubdivision,ce=M.getDepthModeForSublayer(0,ai.ReadOnly),Te=M.colorModeForRenderPass();if("offscreen"===M.renderPass)(function(De,we,Le,je,Re,$e,Ye){const Ne=De.context,Qe=Ne.gl;for(const gt of Le){const lt=we.getTile(gt),ft=lt.dem;if(!ft||!ft.data||!lt.needsHillshadePrepare)continue;const _t=ft.dim,Ht=ft.stride,$t=ft.getPixels();if(Ne.activeTexture.set(Qe.TEXTURE1),Ne.pixelStoreUnpackPremultiplyAlpha.set(!1),lt.demTexture=lt.demTexture||De.getTileTexture(Ht),lt.demTexture){const Tn=lt.demTexture;Tn.update($t,{premultiply:!1}),Tn.bind(Qe.NEAREST,Qe.CLAMP_TO_EDGE)}else lt.demTexture=new p.T(Ne,$t,Qe.RGBA,{premultiply:!1}),lt.demTexture.bind(Qe.NEAREST,Qe.CLAMP_TO_EDGE);Ne.activeTexture.set(Qe.TEXTURE0);let Ft=lt.fbo;if(!Ft){const Tn=new p.T(Ne,{width:_t,height:_t,data:null},Qe.RGBA);Tn.bind(Qe.LINEAR,Qe.CLAMP_TO_EDGE),Ft=lt.fbo=Ne.createFramebuffer(_t,_t,!0,!1),Ft.colorAttachment.set(Tn.texture)}Ne.bindFramebuffer.set(Ft.framebuffer),Ne.viewport.set([0,0,_t,_t]),De.useProgram("hillshadePrepare").draw(Ne,Qe.TRIANGLES,Re,$e,Ye,ki.disabled,pd(lt.tileID,ft),null,null,je.id,De.rasterBoundsBuffer,De.quadTriangleIndexBuffer,De.rasterBoundsSegments),lt.needsHillshadePrepare=!1}})(M,A,U,O,ce,Ri.disabled,Te),q.viewport.set([0,0,M.width,M.height]);else if("translucent"===M.renderPass)if(te){const[De,we,Le]=M.stencilConfigForOverlapTwoPass(U);Zt(M,A,O,Le,De,ce,Te,!1,H),Zt(M,A,O,Le,we,ce,Te,!0,H)}else{const[De,we]=M.getStencilConfigForOverlapAndUpdateStencilID(U);Zt(M,A,O,we,De,ce,Te,!1,H)}}(o,u,g,v,T):p.cs(g)?function(M,A,O,U,N){if("translucent"!==M.renderPass||!U.length)return;const{isRenderingToTexture:H}=N,q=M.style.projection.useSubdivision,te=M.getDepthModeForSublayer(0,ai.ReadOnly),ce=M.colorModeForRenderPass();if(q){const[Te,De,we]=M.stencilConfigForOverlapTwoPass(U);An(M,A,O,we,Te,te,ce,!1,H),An(M,A,O,we,De,te,ce,!0,H)}else{const[Te,De]=M.getStencilConfigForOverlapAndUpdateStencilID(U);An(M,A,O,De,Te,te,ce,!1,H)}}(o,u,g,v,T):p.bT(g)?function(M,A,O,U,N){if("translucent"!==M.renderPass||0===O.paint.get("raster-opacity")||!U.length)return;const{isRenderingToTexture:H}=N,q=A.getSource(),te=M.style.projection.useSubdivision;if(q instanceof nn)Br(M,A,O,U,null,!1,!1,q.tileCoords,q.flippedWindingOrder,H);else if(te){const[ce,Te,De]=M.stencilConfigForOverlapTwoPass(U);Br(M,A,O,De,ce,!1,!0,vr,!1,H),Br(M,A,O,De,Te,!0,!0,vr,!1,H)}else{const[ce,Te]=M.getStencilConfigForOverlapAndUpdateStencilID(U);Br(M,A,O,Te,ce,!1,!0,vr,!1,H)}}(o,u,g,v,T):p.ct(g)?function(M,A,O,U,N){const H=O.paint.get("background-color"),q=O.paint.get("background-opacity");if(0===q)return;const{isRenderingToTexture:te}=N,ce=M.context,Te=ce.gl,De=M.style.projection,we=M.transform,Le=we.tileSize,je=O.paint.get("background-pattern");if(M.isPatternMissing(je))return;const Re=!je&&1===H.a&&1===q&&M.opaquePassEnabledForLayer()?"opaque":"translucent";if(M.renderPass!==Re)return;const $e=Ri.disabled,Ye=M.getDepthModeForSublayer(0,"opaque"===Re?ai.ReadWrite:ai.ReadOnly),Ne=M.colorModeForRenderPass(),Qe=M.useProgram(je?"backgroundPattern":"background"),gt=U||ri(we,{tileSize:Le,terrain:M.style.map.terrain});je&&(ce.activeTexture.set(Te.TEXTURE0),M.imageManager.bind(M.context));const lt=O.getCrossfadeParameters();for(const ft of gt){const _t=we.getProjectionData({overscaledTileID:ft,applyGlobeMatrix:!te,applyTerrainMatrix:!0}),Ht=je?mc(q,M,je,{tileID:ft,tileSize:Le},lt):zc(q,H),$t=M.style.map.terrain&&M.style.map.terrain.getTerrainData(ft),Ft=De.getMeshFromTileID(ce,ft.canonical,!1,!0,"raster");Qe.draw(ce,Te.TRIANGLES,Ye,$e,Ne,ki.backCCW,Ht,$t,_t,O.id,Ft.vertexBuffer,Ft.indexBuffer,Ft.segments)}}(o,0,g,v,T):p.cu(g)&&function(M,A,O,U){const{isRenderingGlobe:N}=U,H=M.context,q=O.implementation,te=M.style.projection,ce=M.transform,Te=ce.getProjectionDataForCustomLayer(N),De={farZ:ce.farZ,nearZ:ce.nearZ,fov:ce.fov*Math.PI/180,modelViewProjectionMatrix:ce.modelViewProjectionMatrix,projectionMatrix:ce.projectionMatrix,shaderData:{variantName:te.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;\nuniform mat4 u_projection_matrix;\n${te.shaderPreludeCode.vertexSource}`,define:te.shaderDefine},defaultProjectionData:Te},we=q.renderingMode?q.renderingMode:"2d";if("offscreen"===M.renderPass){const Le=q.prerender;Le&&(M.setCustomLayerDefaults(),H.setColorMode(M.colorModeForRenderPass()),Le.call(q,H.gl,De),H.setDirty(),M.setBaseState())}else if("translucent"===M.renderPass){M.setCustomLayerDefaults(),H.setColorMode(M.colorModeForRenderPass()),H.setStencilMode(Ri.disabled);const Le="3d"===we?M.getDepthModeFor3D():M.getDepthModeForSublayer(0,ai.ReadOnly);H.setDepthMode(Le),q.render(H.gl,De),H.setDirty(),M.setBaseState(),H.bindFramebuffer.set(null)}}(o,0,g,T))}saveTileTexture(o){const u=this._tileTextures[o.size[0]];u?u.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const u=this._tileTextures[o];return u&&u.length>0?u.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const u=this.imageManager.getPattern(o.from.toString()),g=this.imageManager.getPattern(o.to.toString());return!u||!g}useProgram(o,u,g=!1,v=[]){this.cache=this.cache||{};const T=!!this.style.map.terrain,M=this.style.projection,A=g?Zs.projectionMercator:M.shaderPreludeCode,O=g?So:M.shaderDefine,U=o+(u?u.cacheKey:"")+`/${g?ss:M.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(T?"/terrain":"")+(v?`/${v.join("/")}`:"");return this.cache[U]||(this.cache[U]=new du(this.context,Zs[o],u,Ol[o],this._showOverdrawInspector,T,A,O,v)),this.cache[U]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var o,u;if(this._tileTextures){for(const g in this._tileTextures){const v=this._tileTextures[g];if(v)for(const T of v)T.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&(null===(o=this.tileExtentMesh.vertexBuffer)||void 0===o||o.destroy()),this.tileExtentMesh&&(null===(u=this.tileExtentMesh.indexBuffer)||void 0===u||u.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const g in this.cache){const v=this.cache[g];v&&v.program&&this.context.gl.deleteProgram(v.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:o,drawingBufferHeight:u}=this.context.gl;return this.width!==o||this.height!==u}}function ll(w,o){let u,g=!1,v=null,T=null;const M=()=>{v=null,g&&(w.apply(T,u),v=setTimeout(M,o),g=!1)};return(...A)=>(g=!0,T=this,u=A,v||M(),v)}class Mu{constructor(o){this._getCurrentHash=()=>{const u=window.location.hash.replace("#","");if(this._hashName){let g;return u.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(g=v)}),(g&&g[1]||"").split("/")}return u.split("/")},this._onHashChange=()=>{const u=this._getCurrentHash();if(!this._isValidHash(u))return!1;const g=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(u[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:g,pitch:+(u[4]||0)}),!0},this._updateHashUnthrottled=()=>{const u=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,u)},this._removeHash=()=>{const u=this._getCurrentHash();if(0===u.length)return;const g=u.join("/");let v=g;v.split("&").length>0&&(v=v.split("&")[0]),this._hashName&&(v=`${this._hashName}=${g}`);let T=window.location.hash.replace(v,"");T.startsWith("#&")?T=T.slice(0,1)+T.slice(2):"#"===T&&(T="");let M=window.location.href.replace(/(#.+)?$/,T);M=M.replace("&&","&"),window.history.replaceState(window.history.state,null,M)},this._updateHash=ll(this._updateHashUnthrottled,300),this._hashName=o&&encodeURIComponent(o)}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(o){const u=this._map.getCenter(),g=Math.round(100*this._map.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,v),M=Math.round(u.lng*T)/T,A=Math.round(u.lat*T)/T,O=this._map.getBearing(),U=this._map.getPitch();let N="";if(N+=o?`/${M}/${A}/${g}`:`${g}/${A}/${M}`,(O||U)&&(N+="/"+Math.round(10*O)/10),U&&(N+=`/${Math.round(U)}`),this._hashName){const H=this._hashName;let q=!1;const te=window.location.hash.slice(1).split("&").map(ce=>{const Te=ce.split("=")[0];return Te===H?(q=!0,`${Te}=${N}`):ce}).filter(ce=>ce);return q||te.push(`${H}=${N}`),`#${te.join("&")}`}return`#${N}`}_isValidHash(o){if(o.length<3||o.some(isNaN))return!1;try{new p.V(+o[2],+o[1])}catch{return!1}const u=+o[0],g=+(o[3]||0),v=+(o[4]||0);return u>=this._map.getMinZoom()&&u<=this._map.getMaxZoom()&&g>=-180&&g<=180&&v>=this._map.getMinPitch()&&v<=this._map.getMaxPitch()}}const Eu={linearity:.3,easing:p.cv(0,0,.3,1)},wc=p.e({deceleration:2500,maxSpeed:1400},Eu),_d=p.e({deceleration:20,maxSpeed:1400},Eu),Hc=p.e({deceleration:1e3,maxSpeed:360},Eu),Ps=p.e({deceleration:1e3,maxSpeed:90},Eu),Su=p.e({deceleration:1e3,maxSpeed:360},Eu);class bn{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ue(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,u=ue();for(;o.length>0&&u-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,roll:0,pan:new p.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)u.zoom+=T.zoomDelta||0,u.bearing+=T.bearingDelta||0,u.pitch+=T.pitchDelta||0,u.roll+=T.rollDelta||0,T.panDelta&&u.pan._add(T.panDelta),T.around&&(u.around=T.around),T.pinchAround&&(u.pinchAround=T.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(u.pan.mag()){const T=As(u.pan.mag(),g,p.e({},wc,o||{})),M=u.pan.mult(T.amount/u.pan.mag()),A=this._map.cameraHelper.handlePanInertia(M,this._map.transform);v.center=A.easingCenter,v.offset=A.easingOffset,gs(v,T)}if(u.zoom){const T=As(u.zoom,g,_d);v.zoom=this._map.transform.zoom+T.amount,gs(v,T)}if(u.bearing){const T=As(u.bearing,g,Hc);v.bearing=this._map.transform.bearing+p.an(T.amount,-179,179),gs(v,T)}if(u.pitch){const T=As(u.pitch,g,Ps);v.pitch=this._map.transform.pitch+T.amount,gs(v,T)}if(u.roll){const T=As(u.roll,g,Su);v.roll=this._map.transform.roll+p.an(T.amount,-179,179),gs(v,T)}if(v.zoom||v.bearing){const T=void 0===u.pinchAround?u.around:u.pinchAround;v.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),p.e(v,{noMoveStart:!0})}}function gs(w,o){(!w.duration||w.duration<o.duration)&&(w.duration=o.duration,w.easing=o.easing)}function As(w,o,u){const{maxSpeed:g,linearity:v,deceleration:T}=u,M=p.an(w*v/(o/1e3),-g,g),A=Math.abs(M)/(T*v);return{easing:u.easing,duration:1e3*A,amount:M*(A/2)}}class nr extends p.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,g,v={}){g=g instanceof MouseEvent?g:new MouseEvent(o,g);const T=K.mousePos(u.getCanvas(),g),M=u.unproject(T);super(o,p.e({point:T,lngLat:M,originalEvent:g},v)),this._defaultPrevented=!1,this.target=u}}class Zc extends p.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,g){const v="touchend"===o?g.changedTouches:g.touches,T=K.touchPos(u.getCanvasContainer(),v),M=T.map(O=>u.unproject(O)),A=T.reduce((O,U,N,H)=>O.add(U.div(H.length)),new p.P(0,0));super(o,{points:T,point:A,lngLats:M,lngLat:u.unproject(A),originalEvent:g}),this._defaultPrevented=!1}}class za extends p.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,u,g){super(o,{originalEvent:g}),this._defaultPrevented=!1}}class Yr{constructor(o,u){this._map=o,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new za(o.type,this._map,o))}mousedown(o,u){return this._mousedownPos=u,this._firePreventable(new nr(o.type,this._map,o))}mouseup(o){this._map.fire(new nr(o.type,this._map,o))}click(o,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new nr(o.type,this._map,o))}dblclick(o){return this._firePreventable(new nr(o.type,this._map,o))}mouseover(o){this._map.fire(new nr(o.type,this._map,o))}mouseout(o){this._map.fire(new nr(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Zc(o.type,this._map,o))}touchmove(o){this._map.fire(new Zc(o.type,this._map,o))}touchend(o){this._map.fire(new Zc(o.type,this._map,o))}touchcancel(o){this._map.fire(new Zc(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vo{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new nr(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new nr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new nr(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class io{constructor(o){this._map=o}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(o){return this.transform.screenPointToLocation(p.P.convert(o),this._map.terrain)}}class cf{constructor(o,u){this._map=o,this._tr=new io(o),this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,u){this.isEnabled()&&o.shiftKey&&0===o.button&&(K.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(o,u){if(!this._active)return;const g=u;if(this._lastPos.equals(g)||!this._box&&g.dist(this._startPos)<this._clickTolerance)return;const v=this._startPos;this._lastPos=g,this._box||(this._box=K.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",o));const T=Math.min(v.x,g.x),M=Math.max(v.x,g.x),A=Math.min(v.y,g.y),O=Math.max(v.y,g.y);K.setTransform(this._box,`translate(${T}px,${A}px)`),this._box.style.width=M-T+"px",this._box.style.height=O-A+"px"}mouseupWindow(o,u){if(!this._active||0!==o.button)return;const g=this._startPos,v=u;if(this.reset(),K.suppressClick(),g.x!==v.x||g.y!==v.y)return this._map.fire(new p.l("boxzoomend",{originalEvent:o})),{cameraAnimation:T=>T.fitScreenCoordinates(g,v,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&27===o.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(K.remove(this._box),this._box=null),K.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,u){return this._map.fire(new p.l(o,{originalEvent:u}))}}function _a(w,o){if(w.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${w.length}, points ${o.length}`);const u={};for(let g=0;g<w.length;g++)u[w[g].identifier]=o[g];return u}class qc{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,u,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=o.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){const T=new p.P(0,0);for(const M of v)T._add(M);return T.div(v.length)}(u),this.touches=_a(g,u)))}touchmove(o,u,g){if(this.aborted||!this.centroid)return;const v=_a(g,u);for(const T in this.touches){const M=v[T];(!M||M.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(o,u,g){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),0===g.length){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class ro{constructor(o){this.singleTap=new qc(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,u,g){this.singleTap.touchstart(o,u,g)}touchmove(o,u,g){this.singleTap.touchmove(o,u,g)}touchend(o,u,g){const v=this.singleTap.touchend(o,u,g);if(v){const T=o.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(v)<30;if(T&&M||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class hn{constructor(o){this._tr=new io(o),this._zoomIn=new ro({numTouches:1,numTaps:2}),this._zoomOut=new ro({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,u,g){this._zoomIn.touchstart(o,u,g),this._zoomOut.touchstart(o,u,g)}touchmove(o,u,g){this._zoomIn.touchmove(o,u,g),this._zoomOut.touchmove(o,u,g)}touchend(o,u,g){const v=this._zoomIn.touchend(o,u,g),T=this._zoomOut.touchend(o,u,g),M=this._tr;return v?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:M.zoom+1,around:M.unproject(v)},{originalEvent:o})}):T?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:M.zoom-1,around:M.unproject(T)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Iu{constructor(o){this._enabled=!!o.enable,this._moveStateManager=o.moveStateManager,this._clickTolerance=o.clickTolerance||1,this._moveFunction=o.move,this._activateOnStart=!!o.activateOnStart,o.assignEvents(this),this.reset()}reset(o){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(o)}_move(...o){const u=this._moveFunction(...o);if(u.bearingDelta||u.pitchDelta||u.rollDelta||u.around||u.panDelta)return this._active=!0,u}dragStart(o,u){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(o)&&(this._moveStateManager.startMove(o),this._lastPoint=Array.isArray(u)?u[0]:u,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(o,u){if(!this.isEnabled())return;const g=this._lastPoint;if(!g)return;if(o.preventDefault(),!this._moveStateManager.isValidMoveEvent(o))return void this.reset(o);const v=Array.isArray(u)?u[0]:u;return!this._moved&&v.dist(g)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=v,this._move(g,v))}dragEnd(o){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(o)&&(this._moved&&K.suppressClick(),this.reset(o))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ep=0,Vl=2,_h={[Ep]:1,[Vl]:2};class Cc{constructor(o){this._correctEvent=o.checkCorrectEvent}startMove(o){const u=K.mouseButton(o);this._eventButton=u}endMove(o){delete this._eventButton}isValidStartEvent(o){return this._correctEvent(o)}isValidMoveEvent(o){return!function(u,g){const v=_h[g];return void 0===u.buttons||(u.buttons&v)!==v}(o,this._eventButton)}isValidEndEvent(o){return K.mouseButton(o)===this._eventButton}}class yh{constructor(){this._firstTouch=void 0}_isOneFingerTouch(o){return 1===o.targetTouches.length}_isSameTouchEvent(o){return o.targetTouches[0].identifier===this._firstTouch}startMove(o){this._firstTouch=o.targetTouches[0].identifier}endMove(o){delete this._firstTouch}isValidStartEvent(o){return this._isOneFingerTouch(o)}isValidMoveEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}isValidEndEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}}class W0{constructor(o=new Cc({checkCorrectEvent:()=>!0}),u=new yh){this.mouseMoveStateManager=o,this.oneFingerTouchMoveStateManager=u}_executeRelevantHandler(o,u,g){return o instanceof MouseEvent?u(o):typeof TouchEvent<"u"&&o instanceof TouchEvent?g(o):void 0}startMove(o){this._executeRelevantHandler(o,u=>this.mouseMoveStateManager.startMove(u),u=>this.oneFingerTouchMoveStateManager.startMove(u))}endMove(o){this._executeRelevantHandler(o,u=>this.mouseMoveStateManager.endMove(u),u=>this.oneFingerTouchMoveStateManager.endMove(u))}isValidStartEvent(o){return this._executeRelevantHandler(o,u=>this.mouseMoveStateManager.isValidStartEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidStartEvent(u))}isValidMoveEvent(o){return this._executeRelevantHandler(o,u=>this.mouseMoveStateManager.isValidMoveEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(u))}isValidEndEvent(o){return this._executeRelevantHandler(o,u=>this.mouseMoveStateManager.isValidEndEvent(u),u=>this.oneFingerTouchMoveStateManager.isValidEndEvent(u))}}const yd=w=>{w.mousedown=w.dragStart,w.mousemoveWindow=w.dragMove,w.mouseup=w.dragEnd,w.contextmenu=o=>{o.preventDefault()}};class oy{constructor(o,u){this._clickTolerance=o.clickTolerance||1,this._map=u,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new p.P(0,0)}_shouldBePrevented(o){return o<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(o,u,g){return this._calculateTransform(o,u,g)}touchmove(o,u,g){if(this._active){if(!this._shouldBePrevented(g.length))return o.preventDefault(),this._calculateTransform(o,u,g);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",o)}}touchend(o,u,g){this._calculateTransform(o,u,g),this._active&&this._shouldBePrevented(g.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,u,g){g.length>0&&(this._active=!0);const v=_a(g,u),T=new p.P(0,0),M=new p.P(0,0);let A=0;for(const U in v){const N=v[U],H=this._touches[U];H&&(T._add(N),M._add(N.sub(H)),A++,v[U]=N)}if(this._touches=v,this._shouldBePrevented(A)||!M.mag())return;const O=M.div(A);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(A),panDelta:O}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uf{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(o,u,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([u[0],u[1]]))}touchmove(o,u,g){if(!this._firstTwoTouches)return;o.preventDefault();const[v,T]=this._firstTwoTouches,M=Sp(g,u,v),A=Sp(g,u,T);if(!M||!A)return;const O=this._aroundCenter?null:M.add(A).div(2);return this._move([M,A],O,o)}touchend(o,u,g){if(!this._firstTwoTouches)return;const[v,T]=this._firstTwoTouches,M=Sp(g,u,v),A=Sp(g,u,T);M&&A||(this._active&&K.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Sp(w,o,u){for(let g=0;g<w.length;g++)if(w[g].identifier===u)return o[g]}function rg(w,o){return Math.log(w/o)/Math.LN2}class Ip extends uf{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,u){const g=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(rg(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:rg(this._distance,g),pinchAround:u}}}function sy(w,o){return 180*w.angleWith(o)/Math.PI}class og extends uf{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,u,g){const v=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:sy(this._vector,v),pinchAround:u}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const u=25/(Math.PI*this._minDiameter)*360,g=sy(o,this._startVector);return Math.abs(g)<u}}function sg(w){return Math.abs(w.y)>Math.abs(w.x)}class ag extends uf{constructor(o){super(),this._currentTouchCount=0,this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,u,g){super.touchstart(o,u,g),this._currentTouchCount=g.length}_start(o){this._lastPoints=o,sg(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,u,g){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const v=o[0].sub(this._lastPoints[0]),T=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(v,T,g.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(v.y+T.y)/2*-.5}):void 0}gestureBeginsVertically(o,u,g){if(void 0!==this._valid)return this._valid;const v=o.mag()>=2,T=u.mag()>=2;if(!v&&!T)return;if(!v||!T)return void 0===this._firstMove&&(this._firstMove=g),g-this._firstMove<100&&void 0;const M=o.y>0==u.y>0;return sg(o)&&sg(u)&&M}}const lg={panStep:100,bearingStep:15,pitchStep:10};class Pp{constructor(o){this._tr=new io(o);const u=lg;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let u=0,g=0,v=0,T=0,M=0;switch(o.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:o.shiftKey?g=-1:(o.preventDefault(),T=-1);break;case 39:o.shiftKey?g=1:(o.preventDefault(),T=1);break;case 38:o.shiftKey?v=1:(o.preventDefault(),M=-1);break;case 40:o.shiftKey?v=-1:(o.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:A=>{const O=this._tr;A.easeTo({duration:300,easeId:"keyboardHandler",easing:Pu,zoom:u?Math.round(O.zoom)+u*(o.shiftKey?2:1):O.zoom,bearing:O.bearing+g*this._bearingStep,pitch:O.pitch+v*this._pitchStep,offset:[-T*this._panStep,-M*this._panStep],center:O.center},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Pu(w){return w*(2-w)}const Dr=4.000244140625,Y0=1/450;class vd{constructor(o,u){this._onTimeout=g=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(g)},this._map=o,this._tr=new io(o),this._triggerRenderFrame=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Y0}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&"center"===o.around)}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(o){return!!this._map.cooperativeGestures.isEnabled()&&!(o.ctrlKey||this._map.cooperativeGestures.isBypassed(o))}wheel(o){if(!this.isEnabled())return;if(this._shouldBePrevented(o))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",o);let u=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const g=ue(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,0!==u&&u%Dr==0?this._type="wheel":0!==u&&Math.abs(u)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(v*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),o.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=o,this._delta-=u,this._active||this._start(o)),o.preventDefault()}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=K.mousePos(this._map.getCanvas(),o),g=this._tr;this._aroundPoint=this._aroundCenter?g.transform.locationToScreenPoint(p.V.convert(g.center)):u,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._tr.transform;if("number"==typeof this._lastExpectedZoom){const A=o.zoom-this._lastExpectedZoom;"number"==typeof this._startZoom&&(this._startZoom+=A),"number"==typeof this._targetZoom&&(this._targetZoom+=A)}if(0!==this._delta){const A="wheel"===this._type&&Math.abs(this._delta)>Dr?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&0!==O&&(O=1/O);const U="number"!=typeof this._targetZoom?o.scale:p.aq(this._targetZoom);this._targetZoom=o.applyConstrain(o.getCameraLngLat(),p.at(U*O)).zoom,"wheel"===this._type&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const u="number"!=typeof this._targetZoom?o.zoom:this._targetZoom,g=this._startZoom,v=this._easing;let T,M=!1;if("wheel"===this._type&&g&&v){const A=ue()-this._lastWheelEventTime,O=Math.min((A+5)/200,1),U=v(O);T=p.G.number(g,u,U),O<1?this._frameId||(this._frameId=!0):M=!0}else T=u,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=T,{noInertia:!0,needsRenderFrame:!M,zoomDelta:T-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let u=p.cx;if(this._prevEase){const g=this._prevEase,v=(ue()-g.start)/g.duration,T=g.easing(v+.01)-g.easing(v),M=.27/Math.sqrt(T*T+1e-4)*.01,A=Math.sqrt(.0729-M*M);u=p.cv(M,A,.25,1)}return this._prevEase={start:ue(),duration:o,easing:u},u}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class vh{constructor(o,u){this._clickZoom=o,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Js{constructor(o){this._tr=new io(o),this.reset()}reset(){this._active=!1}dblclick(o,u){return o.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:this._tr.zoom+(o.shiftKey?-1:1),around:this._tr.unproject(u)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ap{constructor(){this._tap=new ro({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(o,u,g){if(!this._swipePoint)if(this._tapTime){const v=u[0],T=o.timeStamp-this._tapTime<500,M=this._tapPoint.dist(v)<30;T&&M?g.length>0&&(this._swipePoint=v,this._swipeTouch=g[0].identifier):this.reset()}else this._tap.touchstart(o,u,g)}touchmove(o,u,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const v=u[0],T=v.y-this._swipePoint.y;return this._swipePoint=v,o.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(o,u,g)}touchend(o,u,g){if(this._tapTime)this._swipePoint&&0===g.length&&this.reset();else{const v=this._tap.touchend(o,u,g);v&&(this._tapTime=o.timeStamp,this._tapPoint=v)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kp{constructor(o,u,g){this._el=o,this._mousePan=u,this._touchPan=g}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Rp{constructor(o,u,g,v){this._pitchWithRotate=o.pitchWithRotate,this._rollEnabled=o.rollEnabled,this._mouseRotate=u,this._mousePitch=g,this._mouseRoll=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Lp{constructor(o,u,g,v){this._el=o,this._touchZoom=u,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Ba{constructor(o,u){this._bypassKey=-1!==navigator.userAgent.indexOf("Mac")?"metaKey":"ctrlKey",this._map=o,this._options=u,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const o=this._map.getCanvasContainer();o.classList.add("maplibregl-cooperative-gestures"),this._container=K.create("div","maplibregl-cooperative-gesture-screen",o);let u=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");"metaKey"===this._bypassKey&&(u=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const g=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),v=document.createElement("div");v.className="maplibregl-desktop-message",v.textContent=u,this._container.appendChild(v);const T=document.createElement("div");T.className="maplibregl-mobile-message",T.textContent=g,this._container.appendChild(T),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(K.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(o){return o[this._bypassKey]}notifyGestureBlocked(o,u){this._enabled&&(this._map.fire(new p.l("cooperativegestureprevented",{gestureType:o,originalEvent:u})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Au=w=>w.zoom||w.drag||w.roll||w.pitch||w.rotate;class In extends p.l{}function Wn(w){return w.panDelta&&w.panDelta.mag()||w.zoomDelta||w.bearingDelta||w.pitchDelta||w.rollDelta}class Ji{constructor(o,u){this.handleWindowEvent=v=>{this.handleEvent(v,`${v.type}Window`)},this.handleEvent=(v,T)=>{if("blur"===v.type)return void this.stop(!0);this._updatingCamera=!0;const M="renderFrame"===v.type?void 0:v,A={needsRenderFrame:!1},O={},U={};for(const{handlerName:q,handler:te,allowed:ce}of this._handlers){if(!te.isEnabled())continue;let Te;if(this._blockedByActive(U,ce,q))te.reset();else if(te[T||v.type]){if(p.cy(v,T||v.type)){const De=K.mousePos(this._map.getCanvas(),v);Te=te[T||v.type](v,De)}else if(p.cz(v,T||v.type)){const De=this._getMapTouches(v.touches),we=K.touchPos(this._map.getCanvas(),De);Te=te[T||v.type](v,we,De)}else p.cA(T||v.type)||(Te=te[T||v.type](v));this.mergeHandlerResult(A,O,Te,q,M),Te&&Te.needsRenderFrame&&this._triggerRenderFrame()}(Te||te.isActive())&&(U[q]=te)}const N={};for(const q in this._previousActiveHandlers)U[q]||(N[q]=M);this._previousActiveHandlers=U,(Object.keys(N).length||Wn(A))&&(this._changes.push([A,O,N]),this._triggerRenderFrame()),(Object.keys(U).length||Wn(A))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=A;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))},this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new bn(o),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,T,M]of this._listeners)K.addEventListener(v,T,v===document?this.handleWindowEvent:this.handleEvent,M)}destroy(){for(const[o,u,g]of this._listeners)K.removeEventListener(o,u,o===document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(o){const u=this._map,g=u.getCanvasContainer();this._add("mapEvent",new Yr(u,o));const v=u.boxZoom=new cf(u,o);this._add("boxZoom",v),o.interactive&&o.boxZoom&&v.enable();const T=u.cooperativeGestures=new Ba(u,o.cooperativeGestures);this._add("cooperativeGestures",T),o.cooperativeGestures&&T.enable();const M=new hn(u),A=new Js(u);u.doubleClickZoom=new vh(A,M),this._add("tapZoom",M),this._add("clickZoom",A),o.interactive&&o.doubleClickZoom&&u.doubleClickZoom.enable();const O=new Ap;this._add("tapDragZoom",O);const U=u.touchPitch=new ag(u);this._add("touchPitch",U),o.interactive&&o.touchPitch&&u.touchPitch.enable(o.touchPitch);const N=()=>u.project(u.getCenter()),H=function({enable:Re,clickTolerance:$e,aroundCenter:Ye=!0,minPixelCenterThreshold:Ne=100,rotateDegreesPerPixelMoved:Qe=.8},gt){const lt=new Cc({checkCorrectEvent:ft=>0===K.mouseButton(ft)&&ft.ctrlKey||2===K.mouseButton(ft)&&!ft.ctrlKey});return new Iu({clickTolerance:$e,move:(ft,_t)=>{const Ht=gt();if(Ye&&Math.abs(Ht.y-ft.y)>Ne)return{bearingDelta:p.cw(new p.P(ft.x,_t.y),_t,Ht)};let $t=(_t.x-ft.x)*Qe;return Ye&&_t.y<Ht.y&&($t=-$t),{bearingDelta:$t}},moveStateManager:lt,enable:Re,assignEvents:yd})}(o,N),q=function({enable:Re,clickTolerance:$e,pitchDegreesPerPixelMoved:Ye=-.5}){const Ne=new Cc({checkCorrectEvent:Qe=>0===K.mouseButton(Qe)&&Qe.ctrlKey||2===K.mouseButton(Qe)});return new Iu({clickTolerance:$e,move:(Qe,gt)=>({pitchDelta:(gt.y-Qe.y)*Ye}),moveStateManager:Ne,enable:Re,assignEvents:yd})}(o),te=function({enable:Re,clickTolerance:$e,rollDegreesPerPixelMoved:Ye=.3},Ne){const Qe=new Cc({checkCorrectEvent:gt=>2===K.mouseButton(gt)&&gt.ctrlKey});return new Iu({clickTolerance:$e,move:(gt,lt)=>{const ft=Ne();let _t=(lt.x-gt.x)*Ye;return lt.y<ft.y&&(_t=-_t),{rollDelta:_t}},moveStateManager:Qe,enable:Re,assignEvents:yd})}(o,N);u.dragRotate=new Rp(o,H,q,te),this._add("mouseRotate",H,["mousePitch"]),this._add("mousePitch",q,["mouseRotate","mouseRoll"]),this._add("mouseRoll",te,["mousePitch"]),o.interactive&&o.dragRotate&&u.dragRotate.enable();const ce=function({enable:Re,clickTolerance:$e}){const Ye=new Cc({checkCorrectEvent:Ne=>0===K.mouseButton(Ne)&&!Ne.ctrlKey});return new Iu({clickTolerance:$e,move:(Ne,Qe)=>({around:Qe,panDelta:Qe.sub(Ne)}),activateOnStart:!0,moveStateManager:Ye,enable:Re,assignEvents:yd})}(o),Te=new oy(o,u);u.dragPan=new kp(g,ce,Te),this._add("mousePan",ce),this._add("touchPan",Te,["touchZoom","touchRotate"]),o.interactive&&o.dragPan&&u.dragPan.enable(o.dragPan);const De=new og,we=new Ip;u.touchZoomRotate=new Lp(g,we,De,O),this._add("touchRotate",De,["touchPan","touchZoom"]),this._add("touchZoom",we,["touchPan","touchRotate"]),o.interactive&&o.touchZoomRotate&&u.touchZoomRotate.enable(o.touchZoomRotate),this._add("blockableMapEvent",new vo(u));const Le=u.scrollZoom=new vd(u,()=>this._triggerRenderFrame());this._add("scrollZoom",Le,["mousePan"]),o.interactive&&o.scrollZoom&&u.scrollZoom.enable(o.scrollZoom);const je=u.keyboard=new Pp(u);this._add("keyboard",je),o.interactive&&o.keyboard&&u.keyboard.enable()}_add(o,u,g){this._handlers.push({handlerName:o,handler:u,allowed:g}),this._handlersById[o]=u}stop(o){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Au(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,u,g){for(const v in o)if(v!==g&&(!u||u.indexOf(v)<0))return!0;return!1}_getMapTouches(o){const u=[];for(const g of o)this._el.contains(g.target)&&u.push(g);return u}mergeHandlerResult(o,u,g,v,T){if(!g)return;p.e(o,g);const M={handlerName:v,originalEvent:g.originalEvent||T};void 0!==g.zoomDelta&&(u.zoom=M),void 0!==g.panDelta&&(u.drag=M),void 0!==g.rollDelta&&(u.roll=M),void 0!==g.pitchDelta&&(u.pitch=M),void 0!==g.bearingDelta&&(u.rotate=M)}_applyChanges(){const o={},u={},g={};for(const[v,T,M]of this._changes)v.panDelta&&(o.panDelta=(o.panDelta||new p.P(0,0))._add(v.panDelta)),v.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+v.pitchDelta),v.rollDelta&&(o.rollDelta=(o.rollDelta||0)+v.rollDelta),void 0!==v.around&&(o.around=v.around),void 0!==v.pinchAround&&(o.pinchAround=v.pinchAround),v.noInertia&&(o.noInertia=v.noInertia),p.e(u,T),p.e(g,M);this._updateMapTransform(o,u,g),this._changes=[]}_updateMapTransform(o,u,g){const v=this._map,T=v._getTransformForUpdate(),M=v.terrain;if(!(Wn(o)||M&&this._terrainMovement))return this._fireEvents(u,g,!0);v._stop(!0);let{panDelta:A,zoomDelta:O,bearingDelta:U,pitchDelta:N,rollDelta:H,around:q,pinchAround:te}=o;void 0!==te&&(q=te),q=q||v.transform.centerPoint,M&&!T.isPointOnMapSurface(q)&&(q=T.centerPoint);const ce={panDelta:A,zoomDelta:O,rollDelta:H,pitchDelta:N,bearingDelta:U,around:q};this._map.cameraHelper.useGlobeControls&&!T.isPointOnMapSurface(q)&&(q=T.centerPoint);const Te=q.distSqr(T.centerPoint)<.01?T.center:T.screenPointToLocation(A?q.sub(A):q);this._handleMapControls({terrain:M,tr:T,deltasForHelper:ce,preZoomAroundLoc:Te,combinedEventsInProgress:u,panDelta:A}),v._applyUpdatedTransform(T),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(u,g,!0)}_handleMapControls({terrain:o,tr:u,deltasForHelper:g,preZoomAroundLoc:v,combinedEventsInProgress:T,panDelta:M}){const A=this._map.cameraHelper;if(A.handleMapControlsRollPitchBearingZoom(g,u),o)return A.useGlobeControls?(this._terrainMovement||!T.drag&&!T.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void A.handleMapControlsPan(g,u,v)):this._terrainMovement||!T.drag&&!T.zoom?void(T.drag&&this._terrainMovement&&M?u.setCenter(u.screenPointToLocation(u.centerPoint.sub(M))):A.handleMapControlsPan(g,u,v)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void A.handleMapControlsPan(g,u,v));A.handleMapControlsPan(g,u,v)}_fireEvents(o,u,g){const v=Au(this._eventsInProgress),T=Au(o),M={};for(const H in o){const{originalEvent:q}=o[H];this._eventsInProgress[H]||(M[`${H}start`]=q),this._eventsInProgress[H]=o[H]}!v&&T&&this._fireEvent("movestart",T.originalEvent);for(const H in M)this._fireEvent(H,M[H]);T&&this._fireEvent("move",T.originalEvent);for(const H in o){const{originalEvent:q}=o[H];this._fireEvent(H,q)}const A={};let O;for(const H in this._eventsInProgress){const{handlerName:q,originalEvent:te}=this._eventsInProgress[H];this._handlersById[q].isActive()||(delete this._eventsInProgress[H],O=u[q]||te,A[`${H}end`]=O)}for(const H in A)this._fireEvent(H,A[H]);const U=Au(this._eventsInProgress),N=(v||T)&&!U;if(N&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const H=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&H.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(H)}if(g&&N){this._updatingCamera=!0;const H=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=te=>0!==te&&-this._bearingSnap<te&&te<this._bearingSnap;!H||!H.essential&&ee.prefersReducedMotion?(this._map.fire(new p.l("moveend",{originalEvent:O})),q(this._map.getBearing())&&this._map.resetNorth()):(q(H.bearing||this._map.getBearing())&&(H.bearing=0),H.freezeElevation=!0,this._map.easeTo(H,{originalEvent:O})),this._updatingCamera=!1}}_fireEvent(o,u){this._map.fire(new p.l(o,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new In("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class Op extends p.E{constructor(o,u,g){super(),this._renderFrameCallback=()=>{const v=Math.min((ue()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(v)),v<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=g.bearingSnap,this.cameraHelper=u,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(o,u){o.apply(this.transform),this.transform=o,this.cameraHelper=u}getCenter(){return new p.V(this.transform.center.lng,this.transform.center.lat)}setCenter(o,u){return this.jumpTo({center:o},u)}getCenterElevation(){return this.transform.elevation}setCenterElevation(o,u){return this.jumpTo({elevation:o},u),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(o){this._centerClampedToGround=o}panBy(o,u,g){return o=p.P.convert(o).mult(-1),this.panTo(this.transform.center,p.e({offset:o},u),g)}panTo(o,u,g){return this.easeTo(p.e({center:o},u),g)}getZoom(){return this.transform.zoom}setZoom(o,u){return this.jumpTo({zoom:o},u),this}zoomTo(o,u,g){return this.easeTo(p.e({zoom:o},u),g)}zoomIn(o,u){return this.zoomTo(this.getZoom()+1,o,u),this}zoomOut(o,u){return this.zoomTo(this.getZoom()-1,o,u),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(o,u){return o!=this.transform.fov&&(this.transform.setFov(o),this.fire(new p.l("movestart",u)).fire(new p.l("move",u)).fire(new p.l("moveend",u))),this}getBearing(){return this.transform.bearing}setBearing(o,u){return this.jumpTo({bearing:o},u),this}getPadding(){return this.transform.padding}setPadding(o,u){return this.jumpTo({padding:o},u),this}rotateTo(o,u,g){return this.easeTo(p.e({bearing:o},u),g)}resetNorth(o,u){return this.rotateTo(0,p.e({duration:1e3},o),u),this}resetNorthPitch(o,u){return this.easeTo(p.e({bearing:0,pitch:0,roll:0,duration:1e3},o),u),this}snapToNorth(o,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,u):this}getPitch(){return this.transform.pitch}setPitch(o,u){return this.jumpTo({pitch:o},u),this}getRoll(){return this.transform.roll}setRoll(o,u){return this.jumpTo({roll:o},u),this}cameraForBounds(o,u){o=Oe.convert(o).adjustAntiMeridian();const g=u&&u.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),g,u)}_cameraForBoxAndBearing(o,u,g,v){const T={top:0,bottom:0,right:0,left:0};if("number"==typeof(v=p.e({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},v)).padding){const U=v.padding;v.padding={top:U,bottom:U,right:U,left:U}}const M=p.e(T,v.padding);v.padding=M;const A=this.transform,O=new Oe(o,u);return this.cameraHelper.cameraForBoxAndBearing(v,M,O,g,A)}fitBounds(o,u,g){return this._fitInternal(this.cameraForBounds(o,u),u,g)}fitScreenCoordinates(o,u,g,v,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(p.P.convert(o)),this.transform.screenPointToLocation(p.P.convert(u)),g,v),v,T)}_fitInternal(o,u,g){return o?(delete(u=p.e(o,u)).padding,u.linear?this.easeTo(u,g):this.flyTo(u,g)):this}jumpTo(o,u){this.stop();const g=this._getTransformForUpdate();let v=!1,T=!1,M=!1;const A=g.zoom;this.cameraHelper.handleJumpToCenterZoom(g,o);const O=g.zoom!==A;return"elevation"in o&&g.elevation!==+o.elevation&&g.setElevation(+o.elevation),"bearing"in o&&g.bearing!==+o.bearing&&(v=!0,g.setBearing(+o.bearing)),"pitch"in o&&g.pitch!==+o.pitch&&(T=!0,g.setPitch(+o.pitch)),"roll"in o&&g.roll!==+o.roll&&(M=!0,g.setRoll(+o.roll)),null==o.padding||g.isPaddingEqual(o.padding)||g.setPadding(o.padding),this._applyUpdatedTransform(g),this.fire(new p.l("movestart",u)).fire(new p.l("move",u)),O&&this.fire(new p.l("zoomstart",u)).fire(new p.l("zoom",u)).fire(new p.l("zoomend",u)),v&&this.fire(new p.l("rotatestart",u)).fire(new p.l("rotate",u)).fire(new p.l("rotateend",u)),T&&this.fire(new p.l("pitchstart",u)).fire(new p.l("pitch",u)).fire(new p.l("pitchend",u)),M&&this.fire(new p.l("rollstart",u)).fire(new p.l("roll",u)).fire(new p.l("rollend",u)),this.fire(new p.l("moveend",u))}calculateCameraOptionsFromTo(o,u,g,v=0){const T=p.aa.fromLngLat(o,u),M=p.aa.fromLngLat(g,v),A=M.x-T.x,O=M.y-T.y,U=M.z-T.z,N=Math.hypot(A,O,U);if(0===N)throw new Error("Can't calculate camera options with same From and To");const H=Math.hypot(A,O),q=p.at(this.transform.cameraToCenterDistance/N/this.transform.tileSize),te=180*Math.atan2(A,-O)/Math.PI;let ce=180*Math.acos(H/N)/Math.PI;return ce=U<0?90-ce:90+ce,{center:M.toLngLat(),elevation:v,zoom:q,pitch:ce,bearing:te}}calculateCameraOptionsFromCameraLngLatAltRotation(o,u,g,v,T){const M=this.transform.calculateCenterFromCameraLngLatAlt(o,u,g,v);return{center:M.center,elevation:M.elevation,zoom:M.zoom,bearing:g,pitch:v,roll:T}}easeTo(o,u){this._stop(!1,o.easeId),(!1===(o=p.e({offset:[0,0],duration:500,easing:p.cx},o)).animate||!o.essential&&ee.prefersReducedMotion)&&(o.duration=0);const g=this._getTransformForUpdate(),v=this.getBearing(),T=g.pitch,M=g.roll,A="bearing"in o?this._normalizeBearing(o.bearing,v):v,O="pitch"in o?+o.pitch:T,U="roll"in o?this._normalizeBearing(o.roll,M):M,N="padding"in o?o.padding:g.padding,H=p.P.convert(o.offset);let q,te;o.around&&(q=p.V.convert(o.around),te=g.locationToScreenPoint(q));const ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Te=this.cameraHelper.handleEaseTo(g,{bearing:A,pitch:O,roll:U,padding:N,around:q,aroundPoint:te,offsetAsPoint:H,offset:o.offset,zoom:o.zoom,center:o.center});return this._rotating=this._rotating||v!==A,this._pitching=this._pitching||O!==T,this._rolling=this._rolling||U!==M,this._padding=!g.isPaddingEqual(N),this._zooming=this._zooming||Te.isZooming,this._easeId=o.easeId,this._prepareEase(u,o.noMoveStart,ce),this.terrain&&this._prepareElevation(Te.elevationCenter),this._ease(De=>{Te.easeFunc(De),this.terrain&&!o.freezeElevation&&this._updateElevation(De),this._applyUpdatedTransform(g),this._fireMoveEvents(u)},De=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(u,De)},o),this}_prepareEase(o,u,g={}){this._moving=!0,u||g.moving||this.fire(new p.l("movestart",o)),this._zooming&&!g.zooming&&this.fire(new p.l("zoomstart",o)),this._rotating&&!g.rotating&&this.fire(new p.l("rotatestart",o)),this._pitching&&!g.pitching&&this.fire(new p.l("pitchstart",o)),this._rolling&&!g.rolling&&this.fire(new p.l("rollstart",o))}_prepareElevation(o){this._elevationCenter=o,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(o){void 0!==this._elevationStart&&void 0!==this._elevationCenter||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const u=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(o<1&&u!==this._elevationTarget){const g=this._elevationTarget-this._elevationStart;this._elevationStart+=o*(g-(u-(g*o+this._elevationStart))/(1-o)),this._elevationTarget=u}this.transform.setElevation(p.G.number(this._elevationStart,this._elevationTarget,o))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(o){if(!this.terrain&&o.elevation>=0&&o.pitch<=90)return{};const u=o.getCameraLngLat(),g=o.getCameraAltitude(),v=this.terrain?this.terrain.getElevationForLngLatZoom(u,o.zoom):0;if(g<v){const T=this.calculateCameraOptionsFromTo(u,v,o.center,o.elevation);return{pitch:T.pitch,zoom:T.zoom}}return{}}_applyUpdatedTransform(o){const u=[];if(u.push(v=>this._elevateCameraIfInsideTerrain(v)),this.transformCameraUpdate&&u.push(v=>this.transformCameraUpdate(v)),!u.length)return;const g=o.clone();for(const v of u){const T=g.clone(),{center:M,zoom:A,roll:O,pitch:U,bearing:N,elevation:H}=v(T);M&&T.setCenter(M),void 0!==H&&T.setElevation(H),void 0!==A&&T.setZoom(A),void 0!==O&&T.setRoll(O),void 0!==U&&T.setPitch(U),void 0!==N&&T.setBearing(N),g.apply(T)}this.transform.apply(g)}_fireMoveEvents(o){this.fire(new p.l("move",o)),this._zooming&&this.fire(new p.l("zoom",o)),this._rotating&&this.fire(new p.l("rotate",o)),this._pitching&&this.fire(new p.l("pitch",o)),this._rolling&&this.fire(new p.l("roll",o))}_afterEase(o,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId;const g=this._zooming,v=this._rotating,T=this._pitching,M=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,g&&this.fire(new p.l("zoomend",o)),v&&this.fire(new p.l("rotateend",o)),T&&this.fire(new p.l("pitchend",o)),M&&this.fire(new p.l("rollend",o)),this.fire(new p.l("moveend",o))}flyTo(o,u){if(!o.essential&&ee.prefersReducedMotion){const _t=p.U(o,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(_t,u)}this.stop(),o=p.e({offset:[0,0],speed:1.2,curve:1.42,easing:p.cx},o);const g=this._getTransformForUpdate(),v=g.bearing,T=g.pitch,M=g.roll,A=g.padding,O="bearing"in o?this._normalizeBearing(o.bearing,v):v,U="pitch"in o?+o.pitch:T,N="roll"in o?this._normalizeBearing(o.roll,M):M,H="padding"in o?o.padding:g.padding,q=p.P.convert(o.offset);let te=g.centerPoint.add(q);const ce=g.screenPointToLocation(te),Te=this.cameraHelper.handleFlyTo(g,{bearing:O,pitch:U,roll:N,padding:H,locationAtOffset:ce,offsetAsPoint:q,center:o.center,minZoom:o.minZoom,zoom:o.zoom});let De=o.curve;const we=Math.max(g.width,g.height),Le=we/Te.scaleOfZoom,je=Te.pixelPathLength;"number"==typeof Te.scaleOfMinZoom&&(De=Math.sqrt(we/Te.scaleOfMinZoom/je*2));const Re=De*De;function $e(_t){const Ht=(Le*Le-we*we+(_t?-1:1)*Re*Re*je*je)/(2*(_t?Le:we)*Re*je);return Math.log(Math.sqrt(Ht*Ht+1)-Ht)}function Ye(_t){return(Math.exp(_t)-Math.exp(-_t))/2}function Ne(_t){return(Math.exp(_t)+Math.exp(-_t))/2}const Qe=$e(!1);let gt=function(_t){return Ne(Qe)/Ne(Qe+De*_t)},lt=function(_t){return we*((Ne(Qe)*(Ye(Ht=Qe+De*_t)/Ne(Ht))-Ye(Qe))/Re)/je;var Ht},ft=($e(!0)-Qe)/De;if(Math.abs(je)<2e-6||!isFinite(ft)){if(Math.abs(we-Le)<1e-6)return this.easeTo(o,u);const _t=Le<we?-1:1;ft=Math.abs(Math.log(Le/we))/De,lt=()=>0,gt=Ht=>Math.exp(_t*De*Ht)}return o.duration="duration"in o?+o.duration:1e3*ft/("screenSpeed"in o?+o.screenSpeed/De:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=v!==O,this._pitching=U!==T,this._rolling=N!==M,this._padding=!g.isPaddingEqual(H),this._prepareEase(u,!1),this.terrain&&this._prepareElevation(Te.targetCenter),this._ease(_t=>{const Ht=_t*ft,$t=1/gt(Ht),Ft=lt(Ht);this._rotating&&g.setBearing(p.G.number(v,O,_t)),this._pitching&&g.setPitch(p.G.number(T,U,_t)),this._rolling&&g.setRoll(p.G.number(M,N,_t)),this._padding&&(g.interpolatePadding(A,H,_t),te=g.centerPoint.add(q)),Te.easeFunc(_t,$t,Ft,te),this.terrain&&!o.freezeElevation&&this._updateElevation(_t),this._applyUpdatedTransform(g),this._fireMoveEvents(u)},()=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(u)},o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,u){var g;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const v=this._onEaseEnd;delete this._onEaseEnd,v.call(this,u)}return o||null===(g=this.handlers)||void 0===g||g.stop(!1),this}_ease(o,u,g){!1===g.animate||0===g.duration?(o(1),u()):(this._easeStart=ue(),this._easeOptions=g,this._onEaseFrame=o,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(o,u){o=p.W(o,-180,180);const g=Math.abs(o-u);return Math.abs(o-360-u)<g&&(o-=360),Math.abs(o+360-u)<g&&(o+=360),o}queryTerrainElevation(o){return this.terrain?this.terrain.getElevationForLngLatZoom(p.V.convert(o),this.transform.tileZoom):null}}const bh={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class gi{constructor(o=bh){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=u=>{!u||"metadata"!==u.sourceDataType&&"visibility"!==u.sourceDataType&&"style"!==u.dataType&&"terrain"!==u.type||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=o}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options.compact,this._container=K.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=K.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=K.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){K.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,u){const g=this._map._getUIString(`AttributionControl.${u}`);o.title=g,o.setAttribute("aria-label",g)}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(v=>"string"!=typeof v?"":v)):"string"==typeof this.options.customAttribution&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const u=this._map.style.tileManagers;for(const v in u){const T=u[v];if(T.used||T.usedForTerrain){const M=T.getSource();M.attribution&&o.indexOf(M.attribution)<0&&o.push(M.attribution)}}o=o.filter(v=>String(v).trim()),o.sort((v,T)=>v.length-T.length),o=o.filter((v,T)=>{for(let M=T+1;M<o.length;M++)if(o[M].indexOf(v)>=0)return!1;return!0});const g=o.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,o.length?(this._innerContainer.innerHTML=K.sanitize(g),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ya{constructor(o={}){this._updateCompact=()=>{const u=this._container.children;if(u.length){const g=u[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&g.classList.add("maplibregl-compact"):g.classList.remove("maplibregl-compact")}},this.options=o}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=K.create("div","maplibregl-ctrl");const u=K.create("a","maplibregl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){K.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ku{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const u=++this._id;return this._queue.push({callback:o,id:u,cancelled:!1}),u}remove(o){const u=this._currentlyRunning,g=u?this._queue.concat(u):this._queue;for(const v of g)if(v.id===o)return void(v.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const u=this._currentlyRunning=this._queue;this._queue=[];for(const g of u)if(!g.cancelled&&(g.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var ea=p.aT([{name:"a_pos3d",type:"Int16",components:3}]);class ay extends p.E{constructor(o){super(),this._lastTilesetChange=ue(),this.tileManager=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=o._source.tileSize*2**this.deltaZoom,o.usedForTerrain=!0,o.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(o,u){this.tileManager.update(o,u),this._renderableTilesKeys=[];const g={};for(const v of ri(o,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:u,calculateTileZoom:this.tileManager._source.calculateTileZoom}))g[v.key]=!0,this._renderableTilesKeys.push(v.key),this._tiles[v.key]||(v.terrainRttPosMatrix32f=new Float64Array(16),p.c6(v.terrainRttPosMatrix32f,0,p.a4,p.a4,0,0,1),this._tiles[v.key]=new ie(v,this.tileSize),this._lastTilesetChange=ue());for(const v in this._tiles)g[v]||delete this._tiles[v]}freeRtt(o){for(const u in this._tiles){const g=this._tiles[u];(!o||g.tileID.equals(o)||g.tileID.isChildOf(o)||o.isChildOf(g.tileID))&&(g.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o,u){return u?this._getTerrainCoordsForTileRanges(o,u):this._getTerrainCoordsForRegularTile(o)}_getTerrainCoordsForRegularTile(o){const u={};for(const g of this._renderableTilesKeys){const v=this._tiles[g].tileID,T=o.clone(),M=p.bj();if(v.canonical.equals(o.canonical))p.c6(M,0,p.a4,p.a4,0,0,1);else if(v.canonical.isChildOf(o.canonical)){const A=v.canonical.z-o.canonical.z,O=v.canonical.x-(v.canonical.x>>A<<A),U=v.canonical.y-(v.canonical.y>>A<<A),N=p.a4>>A;p.c6(M,0,N,N,0,0,1),p.O(M,M,[-O*N,-U*N,0])}else{if(!o.canonical.isChildOf(v.canonical))continue;{const A=o.canonical.z-v.canonical.z,O=o.canonical.x-(o.canonical.x>>A<<A),U=o.canonical.y-(o.canonical.y>>A<<A),N=p.a4>>A;p.c6(M,0,p.a4,p.a4,0,0,1),p.O(M,M,[O*N,U*N,0]),p.Q(M,M,[1/2**A,1/2**A,0])}}T.terrainRttPosMatrix32f=new Float32Array(M),u[g]=T}return u}_getTerrainCoordsForTileRanges(o,u){const g={};for(const v of this._renderableTilesKeys){const T=this._tiles[v].tileID;if(!this._isWithinTileRanges(T,u))continue;const M=o.clone(),A=p.bj();if(T.canonical.z===o.canonical.z){const O=o.canonical.x-T.canonical.x,U=o.canonical.y-T.canonical.y;p.c6(A,0,p.a4,p.a4,0,0,1),p.O(A,A,[O*p.a4,U*p.a4,0])}else if(T.canonical.z>o.canonical.z){const O=T.canonical.z-o.canonical.z,U=T.canonical.x-(T.canonical.x>>O<<O),N=T.canonical.y-(T.canonical.y>>O<<O),H=o.canonical.x-(T.canonical.x>>O),q=o.canonical.y-(T.canonical.y>>O),te=p.a4>>O;p.c6(A,0,te,te,0,0,1),p.O(A,A,[-U*te+H*p.a4,-N*te+q*p.a4,0])}else{const O=o.canonical.z-T.canonical.z,U=o.canonical.x-(o.canonical.x>>O<<O),N=o.canonical.y-(o.canonical.y>>O<<O),H=(o.canonical.x>>O)-T.canonical.x,q=(o.canonical.y>>O)-T.canonical.y,te=p.a4<<O;p.c6(A,0,te,te,0,0,1),p.O(A,A,[U*p.a4+H*te,N*p.a4+q*te,0])}M.terrainRttPosMatrix32f=new Float32Array(A),g[v]=M}return g}getSourceTile(o,u){const g=this.tileManager._source;let v=o.overscaledZ-this.deltaZoom;if(v>g.maxzoom&&(v=g.maxzoom),v<g.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(v).key);let T=this.tileManager.getTileByID(this._sourceTileCache[o.key]);if((!T||!T.dem)&&u)for(;v>=g.minzoom&&(!T||!T.dem);)T=this.tileManager.getTileByID(o.scaledTo(v--).key);return T}anyTilesAfterTime(o=Date.now()){return this._lastTilesetChange>=o}_isWithinTileRanges(o,u){return u[o.canonical.z]&&o.canonical.x>=u[o.canonical.z].minTileX&&o.canonical.x<=u[o.canonical.z].maxTileX&&o.canonical.y>=u[o.canonical.z].minTileY&&o.canonical.y<=u[o.canonical.z].maxTileY}}class Ru{constructor(o,u,g){this._meshCache={},this.painter=o,this.tileManager=new ay(u),this.options=g,this.exaggeration="number"==typeof g.exaggeration?g.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(o,u,g,v=p.a4){var T;if(!(u>=0&&u<v&&g>=0&&g<v))return 0;const M=this.getTerrainData(o),A=null===(T=M.tile)||void 0===T?void 0:T.dem;if(!A)return 0;const O=p.cB([],[u/v*p.a4,g/v*p.a4],M.u_terrain_matrix),U=[O[0]*A.dim,O[1]*A.dim],N=Math.floor(U[0]),H=Math.floor(U[1]),q=U[0]-N,te=U[1]-H;return A.get(N,H)*(1-q)*(1-te)+A.get(N+1,H)*q*(1-te)+A.get(N,H+1)*(1-q)*te+A.get(N+1,H+1)*q*te}getElevationForLngLatZoom(o,u){if(!p.cC(u,o.wrap()))return 0;const{tileID:g,mercatorX:v,mercatorY:T}=this._getOverscaledTileIDFromLngLatZoom(o,u);return this.getElevation(g,v%p.a4,T%p.a4,p.a4)}getElevation(o,u,g,v=p.a4){return this.getDEMElevation(o,u,g,v)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const v=this.painter.context,T=new p.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new p.T(v,T,v.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new p.T(v,new p.R({width:1,height:1}),v.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=p.ar([])}const u=this.tileManager.getSourceTile(o,!0);if(u&&u.dem&&(!u.demTexture||u.needsTerrainPrepare)){const v=this.painter.context;u.demTexture=this.painter.getTileTexture(u.dem.stride),u.demTexture?u.demTexture.update(u.dem.getPixels(),{premultiply:!1}):u.demTexture=new p.T(v,u.dem.getPixels(),v.gl.RGBA,{premultiply:!1}),u.demTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),u.needsTerrainPrepare=!1}const g=u&&u+u.tileID.key+o.key;if(g&&!this._demMatrixCache[g]){const v=this.tileManager.getSource().maxzoom;let T=o.canonical.z-u.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=v?T=o.canonical.z-v:p.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const M=o.canonical.x-(o.canonical.x>>T<<T),A=o.canonical.y-(o.canonical.y>>T<<T),O=p.cD(new Float64Array(16),[1/(p.a4<<T),1/(p.a4<<T),0]);p.O(O,O,[M*p.a4,A*p.a4,0]),this._demMatrixCache[o.key]={matrix:O,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:u&&u.dem&&u.dem.dim||1,u_terrain_matrix:g?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:u&&u.dem&&u.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(u&&u.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:u}}getFramebuffer(o){const u=this.painter,g=u.width/devicePixelRatio,v=u.height/devicePixelRatio;return!this._fbo||this._fbo.width===g&&this._fbo.height===v||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new p.T(u.context,{width:g,height:v,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new p.T(u.context,{width:g,height:v,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=u.context.createFramebuffer(g,v,!0,!1),this._fbo.depthAttachment.set(u.context.createRenderbuffer(u.context.gl.DEPTH_COMPONENT16,g,v))),this._fbo.colorAttachment.set("coords"===o?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const u=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let T=0,M=0;T<this._coordsTextureSize;T++)for(let A=0;A<this._coordsTextureSize;A++,M+=4)u[M+0]=255&A,u[M+1]=255&T,u[M+2]=A>>8<<4|T>>8,u[M+3]=0;const g=new p.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(u.buffer)),v=new p.T(o,g,o.gl.RGBA,{premultiply:!1});return v.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=v,v}pointCoordinate(o){this.painter.maybeDrawDepthAndCoords(!0);const u=new Uint8Array(4),g=this.painter.context,v=g.gl,T=Math.round(o.x*this.painter.pixelRatio/devicePixelRatio),M=Math.round(o.y*this.painter.pixelRatio/devicePixelRatio),A=Math.round(this.painter.height/devicePixelRatio);g.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),v.readPixels(T,A-M-1,1,1,v.RGBA,v.UNSIGNED_BYTE,u),g.bindFramebuffer.set(null);const O=u[0]+(u[2]>>4<<8),U=u[1]+((15&u[2])<<8),N=this.coordsIndex[255-u[3]],H=N&&this.tileManager.getTileByID(N);if(!H)return null;const q=this._coordsTextureSize,te=(1<<H.tileID.canonical.z)*q;return new p.aa((H.tileID.canonical.x*q+O)/te+H.tileID.wrap,(H.tileID.canonical.y*q+U)/te,this.getElevation(H.tileID,O,U,q))}depthAtPoint(o){const u=new Uint8Array(4),g=this.painter.context,v=g.gl;return g.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),v.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,u),g.bindFramebuffer.set(null),(u[0]/16777216+u[1]/65536+u[2]/256+u[3])/256}getTerrainMesh(o){var u;const g=(null===(u=this.painter.style.projection)||void 0===u?void 0:u.transitionState)>0,v=g&&0===o.canonical.y,T=g&&o.canonical.y===(1<<o.canonical.z)-1,M=`m_${v?"n":""}_${T?"s":""}`;if(this._meshCache[M])return this._meshCache[M];const A=this.painter.context,O=new p.cE,U=new p.aX,N=this.meshSize,H=p.a4/N,q=N*N;for(let Ne=0;Ne<=N;Ne++)for(let Qe=0;Qe<=N;Qe++)O.emplaceBack(Qe*H,Ne*H,0);for(let Ne=0;Ne<q;Ne+=N+1)for(let Qe=0;Qe<N;Qe++)U.emplaceBack(Qe+Ne,N+Qe+Ne+1,N+Qe+Ne+2),U.emplaceBack(Qe+Ne,N+Qe+Ne+2,Qe+Ne+1);const te=O.length,ce=te+(N+1),Te=(N+1)*N,De=v?p.bq:0,we=v?0:1,Le=T?p.br:p.a4,je=T?0:1;for(let Ne=0;Ne<=N;Ne++)O.emplaceBack(Ne*H,De,we);for(let Ne=0;Ne<=N;Ne++)O.emplaceBack(Ne*H,Le,je);for(let Ne=0;Ne<N;Ne++)U.emplaceBack(Te+Ne,ce+Ne,ce+Ne+1),U.emplaceBack(Te+Ne,ce+Ne+1,Te+Ne+1),U.emplaceBack(0+Ne,te+Ne+1,te+Ne),U.emplaceBack(0+Ne,0+Ne+1,te+Ne+1);const Re=O.length,$e=Re+2*(N+1);for(const Ne of[0,1])for(let Qe=0;Qe<=N;Qe++)for(const gt of[0,1])O.emplaceBack(Ne*p.a4,Qe*H,gt);for(let Ne=0;Ne<2*N;Ne+=2)U.emplaceBack(Re+Ne,Re+Ne+1,Re+Ne+3),U.emplaceBack(Re+Ne,Re+Ne+3,Re+Ne+2),U.emplaceBack($e+Ne,$e+Ne+3,$e+Ne+1),U.emplaceBack($e+Ne,$e+Ne+2,$e+Ne+3);const Ye=new Oa(A.createVertexBuffer(O,ea.members),A.createIndexBuffer(U),p.aW.simpleSegment(0,0,O.length,U.length));return this._meshCache[M]=Ye,Ye}getMeshFrameDelta(o){return 2*Math.PI*p.bD/Math.pow(2,Math.max(o,0))/5}getMinTileElevationForLngLatZoom(o,u){var g;const{tileID:v}=this._getOverscaledTileIDFromLngLatZoom(o,u);return null!==(g=this.getMinMaxElevation(v).minElevation)&&void 0!==g?g:0}getMinMaxElevation(o){const u=this.getTerrainData(o).tile,g={minElevation:null,maxElevation:null};return u&&u.dem&&(g.minElevation=u.dem.min*this.exaggeration,g.maxElevation=u.dem.max*this.exaggeration),g}_getOverscaledTileIDFromLngLatZoom(o,u){const g=p.aa.fromLngLat(o.wrap()),v=(1<<u)*p.a4,T=g.x*v,M=g.y*v,A=Math.floor(T/p.a4),O=Math.floor(M/p.a4);return{tileID:new p.a1(u,0,u,A,O),mercatorX:T,mercatorY:M}}}class cl{constructor(o,u,g){this._context=o,this._size=u,this._tileSize=g,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const o of this._objects)o.texture.destroy(),o.fbo.destroy()}_createObject(o){const u=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),g=new p.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return g.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),u.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),u.colorAttachment.set(g.texture),{id:o,fbo:u,texture:g,stamp:-1,inUse:!1}}getObjectForId(o){return this._objects[o]}useObject(o){o.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(u=>o.id!==u),this._recentlyUsed.push(o.id)}stampObject(o){o.stamp=++this._stamp}getOrCreateFreeObject(){for(const u of this._recentlyUsed)if(!this._objects[u].inUse)return this._objects[u];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const o=this._createObject(this._objects.length);return this._objects.push(o),o}freeObject(o){o.inUse=!1}freeAllObjects(){for(const o of this._objects)this.freeObject(o)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some(o=>!o.inUse)}}const sr={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Ki{constructor(o,u){this.painter=o,this.terrain=u,this.pool=new cl(o.context,30,u.tileManager.tileSize*u.qualityFactor)}destruct(){this.pool.destruct()}getTexture(o){return this.pool.getObjectForId(o.rtt[this._stacks.length-1].id).texture}prepareForRender(o,u){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=o._order.filter(g=>!o._layers[g].isHidden(u)),this._coordsAscending={};for(const g in o.tileManagers){this._coordsAscending[g]={};const v=o.tileManagers[g].getVisibleCoordinates(),T=o.tileManagers[g].getSource(),M=T instanceof nn?T.terrainTileRanges:null;for(const A of v){const O=this.terrain.tileManager.getTerrainCoords(A,M);for(const U in O)this._coordsAscending[g][U]||(this._coordsAscending[g][U]=[]),this._coordsAscending[g][U].push(O[U])}}this._coordsAscendingStr={};for(const g of o._order){const v=o._layers[g],T=v.source;if(sr[v.type]&&!this._coordsAscendingStr[T]){this._coordsAscendingStr[T]={};for(const M in this._coordsAscending[T])this._coordsAscendingStr[T][M]=this._coordsAscending[T][M].map(A=>A.key).sort().join()}}for(const g of this._renderableTiles)for(const v in this._coordsAscendingStr){const T=this._coordsAscendingStr[v][g.tileID.key];T&&T!==g.rttCoords[v]&&(g.rtt=[])}}renderLayer(o,u){if(o.isHidden(this.painter.transform.zoom))return!1;const g=Object.assign(Object.assign({},u),{isRenderingToTexture:!0}),v=o.type,T=this.painter,M=this._renderableLayerIds[this._renderableLayerIds.length-1]===o.id;if(sr[v]&&(this._prevType&&sr[this._prevType]||this._stacks.push([]),this._prevType=v,this._stacks[this._stacks.length-1].push(o.id),!M))return!0;if(sr[this._prevType]||sr[v]&&M){this._prevType=v;const A=this._stacks.length-1,O=this._stacks[A]||[];for(const U of this._renderableTiles){if(this.pool.isFull()&&(or(this.painter,this.terrain,this._rttTiles,g),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(U),U.rtt[A]){const H=this.pool.getObjectForId(U.rtt[A].id);if(H.stamp===U.rtt[A].stamp){this.pool.useObject(H);continue}}const N=this.pool.getOrCreateFreeObject();this.pool.useObject(N),this.pool.stampObject(N),U.rtt[A]={id:N.id,stamp:N.stamp},T.context.bindFramebuffer.set(N.fbo.framebuffer),T.context.clear({color:p.bo.transparent,stencil:0}),T.currentStencilSource=void 0;for(let H=0;H<O.length;H++){const q=T.style._layers[O[H]],te=q.source?this._coordsAscending[q.source][U.tileID.key]:[U.tileID];T.context.viewport.set([0,0,N.fbo.width,N.fbo.height]),T._renderTileClippingMasks(q,te,!0),T.renderLayer(T,T.style.tileManagers[q.source],q,te,g),q.source&&(U.rttCoords[q.source]=this._coordsAscendingStr[q.source][U.tileID.key])}}return or(this.painter,this.terrain,this._rttTiles,g),this._rttTiles=[],this.pool.freeAllObjects(),sr[v]}return!1}}const cg={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Lu=Z,bd={hash:!1,interactive:!0,bearingSnap:7,attributionControl:bh,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:p.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},va={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class hf{constructor(o,u,g=!1){this.mousedown=T=>{this.startMove(T,K.mousePos(this.element,T)),K.addEventListener(window,"mousemove",this.mousemove),K.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=T=>{this.move(T,K.mousePos(this.element,T))},this.mouseup=T=>{this._rotatePitchHandler.dragEnd(T),this.offTemp()},this.touchstart=T=>{1!==T.targetTouches.length?this.reset():(this._startPos=this._lastPos=K.touchPos(this.element,T.targetTouches)[0],this.startMove(T,this._startPos),K.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),K.addEventListener(window,"touchend",this.touchend))},this.touchmove=T=>{1!==T.targetTouches.length?this.reset():(this._lastPos=K.touchPos(this.element,T.targetTouches)[0],this.move(T,this._lastPos))},this.touchend=T=>{0===T.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=u;const v=new W0;this._rotatePitchHandler=new Iu({clickTolerance:3,move:(T,M)=>{const A=u.getBoundingClientRect(),O=new p.P((A.bottom-A.top)/2,(A.right-A.left)/2);return{bearingDelta:p.cw(new p.P(T.x,M.y),M,O),pitchDelta:g?-.5*(M.y-T.y):void 0}},moveStateManager:v,enable:!0,assignEvents:()=>{}}),this.map=o,K.addEventListener(u,"mousedown",this.mousedown),K.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),K.addEventListener(u,"touchcancel",this.reset)}startMove(o,u){this._rotatePitchHandler.dragStart(o,u),K.disableDrag()}move(o,u){const g=this.map,{bearingDelta:v,pitchDelta:T}=this._rotatePitchHandler.dragMove(o,u)||{};v&&g.setBearing(g.getBearing()+v),T&&g.setPitch(g.getPitch()+T)}off(){const o=this.element;K.removeEventListener(o,"mousedown",this.mousedown),K.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),K.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),K.removeEventListener(window,"touchend",this.touchend),K.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){K.enableDrag(),K.removeEventListener(window,"mousemove",this.mousemove),K.removeEventListener(window,"mouseup",this.mouseup),K.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),K.removeEventListener(window,"touchend",this.touchend)}}let ul;function Ou(w,o,u,g=!1){if(g||!u.getCoveringTilesDetailsProvider().allowWorldCopies())return w?.wrap();const v=new p.V(w.lng,w.lat);if(w=new p.V(w.lng,w.lat),o){const T=new p.V(w.lng-360,w.lat),M=new p.V(w.lng+360,w.lat),A=u.locationToScreenPoint(w).distSqr(o);u.locationToScreenPoint(T).distSqr(o)<A?w=T:u.locationToScreenPoint(M).distSqr(o)<A&&(w=M)}for(;Math.abs(w.lng-u.center.lng)>180;){const T=u.locationToScreenPoint(w);if(T.x>=0&&T.y>=0&&T.x<=u.width&&T.y<=u.height)break;w.lng>u.center.lng?w.lng-=360:w.lng+=360}return w.lng!==v.lng&&u.isPointOnMapSurface(u.locationToScreenPoint(w))?w:v}const Tc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function xh(w,o,u){const g=w.classList;for(const v in Tc)g.remove(`maplibregl-${u}-anchor-${v}`);g.add(`maplibregl-${u}-anchor-${o}`)}class jl extends p.E{constructor(o){if(super(),this._onKeyPress=u=>{const g=u.code,v=u.charCode||u.keyCode;"Space"!==g&&"Enter"!==g&&32!==v&&13!==v||this.togglePopup()},this._onMapClick=u=>{const g=u.originalEvent.target,v=this._element;this._popup&&(g===v||v.contains(g))&&this.togglePopup()},this._update=u=>{if(!this._map)return;const g=this._map.loaded()&&!this._map.isMoving();("terrain"===u?.type||"render"===u?.type&&!g)&&this._map.once("render",this._update),this._lngLat=Ou(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let v="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?v=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(v=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let T="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?T="rotateX(0deg)":"map"===this._pitchAlignment&&(T=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||u&&"moveend"!==u.type||(this._pos=this._pos.round()),K.setTransform(this._element,`${Tc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${T} ${v}`),ee.frameAsync(new AbortController).then(()=>{this._updateOpacity(u&&"moveend"===u.type)}).catch(()=>{})},this._onMove=u=>{if(!this._isDragging){const g=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.l("dragstart"))),this.fire(new p.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new p.l("dragend")),this._state="inactive"},this._addDragHandler=u=>{this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._subpixelPositioning=o&&o.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&"auto"!==o.pitchAlignment?o.pitchAlignment:this._rotationAlignment,this.setOpacity(o?.opacity,o?.opacityWhenCovered),o&&o.element)this._element=o.element,this._offset=p.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=K.create("div");const u=K.createNS("http://www.w3.org/2000/svg","svg"),g=41,v=27;u.setAttributeNS(null,"display","block"),u.setAttributeNS(null,"height",`${g}px`),u.setAttributeNS(null,"width",`${v}px`),u.setAttributeNS(null,"viewBox",`0 0 ${v} ${g}`);const T=K.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"stroke","none"),T.setAttributeNS(null,"stroke-width","1"),T.setAttributeNS(null,"fill","none"),T.setAttributeNS(null,"fill-rule","evenodd");const M=K.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");const A=K.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"transform","translate(3.0, 29.0)"),A.setAttributeNS(null,"fill","#000000");const O=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const we of O){const Le=K.createNS("http://www.w3.org/2000/svg","ellipse");Le.setAttributeNS(null,"opacity","0.04"),Le.setAttributeNS(null,"cx","10.5"),Le.setAttributeNS(null,"cy","5.80029008"),Le.setAttributeNS(null,"rx",we.rx),Le.setAttributeNS(null,"ry",we.ry),A.appendChild(Le)}const U=K.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"fill",this._color);const N=K.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),U.appendChild(N);const H=K.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"fill","#000000");const q=K.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),H.appendChild(q);const te=K.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(6.0, 7.0)"),te.setAttributeNS(null,"fill","#FFFFFF");const ce=K.createNS("http://www.w3.org/2000/svg","g");ce.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Te=K.createNS("http://www.w3.org/2000/svg","circle");Te.setAttributeNS(null,"fill","#000000"),Te.setAttributeNS(null,"opacity","0.25"),Te.setAttributeNS(null,"cx","5.5"),Te.setAttributeNS(null,"cy","5.5"),Te.setAttributeNS(null,"r","5.4999962");const De=K.createNS("http://www.w3.org/2000/svg","circle");De.setAttributeNS(null,"fill","#FFFFFF"),De.setAttributeNS(null,"cx","5.5"),De.setAttributeNS(null,"cy","5.5"),De.setAttributeNS(null,"r","5.4999962"),ce.appendChild(Te),ce.appendChild(De),M.appendChild(A),M.appendChild(U),M.appendChild(H),M.appendChild(te),M.appendChild(ce),u.appendChild(M),u.setAttributeNS(null,"height",g*this._scale+"px"),u.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(u),this._offset=p.P.convert(o&&o.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",u=>{u.preventDefault()}),this._element.addEventListener("mousedown",u=>{u.preventDefault()}),xh(this._element,this._anchor,"marker"),o&&o.className)for(const u of o.className.split(" "))this._element.classList.add(u);this._popup=null}addTo(o){return this.remove(),this._map=o,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",o._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("terrain",this._update),o.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),K.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=p.V.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const v=Math.abs(13.5)/Math.SQRT2;o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(24.6+v)],"bottom-right":[-v,-1*(24.6+v)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(o){return this._subpixelPositioning=o,this}getPopup(){return this._popup}togglePopup(){const o=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:o?(o.isOpen()?o.remove():(o.setLngLat(this._lngLat),o.addTo(this._map)),this):this}_updateOpacity(o=!1){var u,g;const v=null===(u=this._map)||void 0===u?void 0:u.terrain,T=this._map.transform.isLocationOccluded(this._lngLat);if(!v||T){const te=T?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==te&&(this._element.style.opacity=te))}if(o)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const M=this._map,A=M.terrain.depthAtPoint(this._pos),O=M.terrain.getElevationForLngLatZoom(this._lngLat,M.transform.tileZoom);if(M.transform.lngLatToCameraDepth(this._lngLat,O)-A<.006)return void(this._element.style.opacity=this._opacity);const U=-this._offset.y/M.transform.pixelsPerMeter,N=Math.sin(M.getPitch()*Math.PI/180)*U,H=M.terrain.depthAtPoint(new p.P(this._pos.x,this._pos.y-this._offset.y)),q=M.transform.lngLatToCameraDepth(this._lngLat,O+N)-H>.006;!(null===(g=this._popup)||void 0===g)&&g.isOpen()&&q&&this._popup.remove(),this._element.style.opacity=q?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(o){return this._offset=p.P.convert(o),this._update(),this}addClassName(o){this._element.classList.add(o)}removeClassName(o){this._element.classList.remove(o)}toggleClassName(o){return this._element.classList.toggle(o)}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&"auto"!==o?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(o,u){return(void 0===this._opacity||void 0===o&&void 0===u)&&(this._opacity="1",this._opacityWhenCovered="0.2"),void 0!==o&&(this._opacity=o),void 0!==u&&(this._opacityWhenCovered=u),this._map&&this._updateOpacity(!0),this}}const wh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Wc=0,ta=!1;const xd={maxWidth:100,unit:"metric"};function Ch(w,o,u){const g=u&&u.maxWidth||100,v=w._container.clientHeight/2,T=w._container.clientWidth/2,M=w.unproject([T-g/2,v]),A=w.unproject([T+g/2,v]),O=Math.round(w.project(A).x-w.project(M).x),U=Math.min(g,O,w._container.clientWidth),N=M.distanceTo(A);if(u&&"imperial"===u.unit){const H=3.2808*N;H>5280?Fu(o,U,H/5280,w._getUIString("ScaleControl.Miles")):Fu(o,U,H,w._getUIString("ScaleControl.Feet"))}else u&&"nautical"===u.unit?Fu(o,U,N/1852,w._getUIString("ScaleControl.NauticalMiles")):N>=1e3?Fu(o,U,N/1e3,w._getUIString("ScaleControl.Kilometers")):Fu(o,U,N,w._getUIString("ScaleControl.Meters"))}function Fu(w,o,u,g){const v=function(T){const M=Math.pow(10,`${Math.floor(T)}`.length-1);let A=T/M;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(O){const U=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*U)/U}(A),M*A}(u);w.style.width=o*(v/u)+"px",w.innerHTML=`${v}&nbsp;${g}`}const fi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Th=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Dh(w){if(w){if("number"==typeof w){const o=Math.round(Math.abs(w)/Math.SQRT2);return{center:new p.P(0,0),top:new p.P(0,w),"top-left":new p.P(o,o),"top-right":new p.P(-o,o),bottom:new p.P(0,-w),"bottom-left":new p.P(o,-o),"bottom-right":new p.P(-o,-o),left:new p.P(w,0),right:new p.P(-w,0)}}if(w instanceof p.P||Array.isArray(w)){const o=p.P.convert(w);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:p.P.convert(w.center||[0,0]),top:p.P.convert(w.top||[0,0]),"top-left":p.P.convert(w["top-left"]||[0,0]),"top-right":p.P.convert(w["top-right"]||[0,0]),bottom:p.P.convert(w.bottom||[0,0]),"bottom-left":p.P.convert(w["bottom-left"]||[0,0]),"bottom-right":p.P.convert(w["bottom-right"]||[0,0]),left:p.P.convert(w.left||[0,0]),right:p.P.convert(w.right||[0,0])}}return Dh(new p.P(0,0))}const Mh=Z;I.AJAXError=p.cI,I.Event=p.l,I.Evented=p.E,I.LngLat=p.V,I.MercatorCoordinate=p.aa,I.Point=p.P,I.addProtocol=p.cJ,I.config=p.a,I.removeProtocol=p.cK,I.AttributionControl=gi,I.BoxZoomHandler=cf,I.CanvasSource=ji,I.CooperativeGesturesHandler=Ba,I.DoubleClickZoomHandler=vh,I.DragPanHandler=kp,I.DragRotateHandler=Rp,I.EdgeInsets=si,I.FullscreenControl=class extends p.E{constructor(w={}){super(),this._onFullscreenChange=()=>{var o;let u=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;null!==(o=u?.shadowRoot)&&void 0!==o&&o.fullscreenElement;)u=u.shadowRoot.fullscreenElement;u===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,w&&w.container&&(w.container instanceof HTMLElement?this._container=w.container:p.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(w){return this._map=w,this._container||(this._container=this._map.getContainer()),this._controlContainer=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){K.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const w=this._fullscreenButton=K.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);K.create("span","maplibregl-ctrl-icon",w).setAttribute("aria-hidden","true"),w.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const w=this._getTitle();this._fullscreenButton.setAttribute("aria-label",w),this._fullscreenButton.title=w}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new p.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new p.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},I.GeoJSONSource=Cn,I.GeolocateControl=class extends p.E{constructor(w){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new p.l("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(o),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new p.l("geolocate",o)),this._finish()}},this._updateCamera=o=>{const u=new p.V(o.coords.longitude,o.coords.latitude),g=o.coords.accuracy,v=this._map.getBearing(),T=p.e({bearing:v},this.options.fitBoundsOptions),M=Oe.fromLngLat(u,g);this._map.fitBounds(M,T,{geolocateSource:!0})},this._updateMarker=o=>{if(o){const u=new p.V(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=o.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=o=>{if(this._map){if(1===o.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===o.code&&ta)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new p.l("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=K.create("button","maplibregl-ctrl-geolocate",this._container),K.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=o=>{if(this._map){if(!1===o){p.w("Geolocation support is not available so the GeolocateControl will be disabled.");const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}else{const u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=K.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new jl({element:this._dotElement}),this._circleElement=K.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new jl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",u=>{const g=u?.[0]instanceof ResizeObserverEntry;u.geolocateSource||"ACTIVE_LOCK"!==this._watchState||g||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new p.l("trackuserlocationend")),this.fire(new p.l("userlocationlostfocus")))})}},this.options=p.e({},wh,w)}onAdd(w){return this._map=w,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return p._(this,arguments,void 0,function*(o=!1){if(void 0!==ul&&!o)return ul;if(void 0===window.navigator.permissions)return ul=!!window.navigator.geolocation,ul;try{ul="denied"!==(yield window.navigator.permissions.query({name:"geolocation"})).state}catch{ul=!!window.navigator.geolocation}return ul})}().then(o=>this._finishSetupUI(o)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),K.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Wc=0,ta=!1}_isOutOfMapMaxBounds(w){const o=this._map.getMaxBounds(),u=w.coords;return o&&(u.longitude<o.getWest()||u.longitude>o.getEast()||u.latitude<o.getSouth()||u.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const w=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&w))return;const o=this._map.project(w),u=this._map.unproject([o.x+100,o.y]),g=w.distanceTo(u)/100,v=2*this._accuracy/g;this._circleElement.style.width=`${v.toFixed(2)}px`,this._circleElement.style.height=`${v.toFixed(2)}px`}trigger(){if(!this._setup)return p.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Wc--,ta=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new p.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.l("trackuserlocationstart")),this.fire(new p.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let w;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Wc++,Wc>1?(w={maximumAge:6e5,timeout:0},ta=!0):(w=this.options.positionOptions,ta=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,w)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},I.GlobeControl=class{constructor(){this._toggleProjection=()=>{var w;const o=null===(w=this._map.getProjection())||void 0===w?void 0:w.type;this._map.setProjection("mercator"!==o&&o?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var w;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),"globe"===(null===(w=this._map.getProjection())||void 0===w?void 0:w.type)?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(w){return this._map=w,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=K.create("button","maplibregl-ctrl-globe",this._container),K.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){K.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},I.Hash=Mu,I.ImageSource=nn,I.KeyboardHandler=Pp,I.LngLatBounds=Oe,I.LogoControl=ya,I.Map=class extends Op{constructor(w){var o,u;p.cF.mark(p.cG.create);const g=Object.assign(Object.assign(Object.assign({},bd),w),{canvasContextAttributes:Object.assign(Object.assign({},bd.canvasContextAttributes),w.canvasContextAttributes)});if(null!=g.minZoom&&null!=g.maxZoom&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=g.minPitch&&null!=g.maxPitch&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=g.minPitch&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=g.maxPitch&&g.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const v=new an,T=new cs;if(void 0!==g.minZoom&&v.setMinZoom(g.minZoom),void 0!==g.maxZoom&&v.setMaxZoom(g.maxZoom),void 0!==g.minPitch&&v.setMinPitch(g.minPitch),void 0!==g.maxPitch&&v.setMaxPitch(g.maxPitch),void 0!==g.renderWorldCopies&&v.setRenderWorldCopies(g.renderWorldCopies),null!==g.transformConstrain&&v.setConstrainOverride(g.transformConstrain),super(v,T,{bearingSnap:g.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new ku,this._controls=[],this._mapId=p.ag(),this._lostContextStyle={style:null,images:null},this._contextLost=A=>{A.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const O of Object.values(this.style._layers))if("custom"===O.type&&console.warn(`Custom layer with id '${O.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),O._listeners)for(const[U]of Object.entries(O._listeners))console.warn(`Custom layer with id '${O.id}' had event listeners for event '${U}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new p.l("webglcontextlost",{originalEvent:A}))},this._contextRestored=A=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new p.l("webglcontextrestored",{originalEvent:A}))},this._onMapScroll=A=>{if(A.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._maxTileCacheZoomLevels=g.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},g.canvasContextAttributes),this._trackResize=!0===g.trackResize,this._bearingSnap=g.bearingSnap,this._centerClampedToGround=g.centerClampedToGround,this._refreshExpiredTiles=!0===g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=!0===g.crossSourceCollisions,this._collectResourceTiming=!0===g.collectResourceTiming,this._locale=Object.assign(Object.assign({},cg),g.locale),this._clickTolerance=g.clickTolerance,this._overridePixelRatio=g.pixelRatio,this._maxCanvasSize=g.maxCanvasSize,this._zoomLevelsToOverscale=g.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=g.transformCameraUpdate,this.transformConstrain=g.transformConstrain,this.cancelPendingTileRequestsWhileZooming=!0===g.cancelPendingTileRequestsWhileZooming,void 0!==g.reduceMotion&&(ee.prefersReducedMotion=g.reduceMotion),this._imageQueueHandle=xt.addThrottleControl(()=>this.isMoving()),this._requestManager=new Qt(g.transformRequest),"string"==typeof g.container){if(this._container=document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let A=!1;const O=ll(U=>{this._trackResize&&!this._removed&&(this.resize(U),this.redraw())},50);this._resizeObserver=new ResizeObserver(U=>{A?O(U):A=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Ji(this,g),this._hash=g.hash&&new Mu("string"==typeof g.hash&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,elevation:g.elevation,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,roll:g.roll}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,p.e({},g.fitBoundsOptions,{duration:0}))));const M="string"==typeof g.style||"globe"!==(null===(u=null===(o=g.style)||void 0===o?void 0:o.projection)||void 0===u?void 0:u.type);this.resize(null,M),this._localIdeographFontFamily=g.localIdeographFontFamily,this._validateStyle=g.validateStyle,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new gi("boolean"==typeof g.attributionControl?void 0:g.attributionControl)),g.maplibreLogo&&this.addControl(new ya,g.logoPosition),this.on("style.load",()=>{if(M||this._resizeTransform(),this.transform.unmodified){const A=p.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(A)}}),this.on("data",A=>{this._update("style"===A.dataType),this.fire(new p.l(`${A.dataType}data`,A))}),this.on("dataloading",A=>{this.fire(new p.l(`${A.dataType}dataloading`,A))}),this.on("dataabort",A=>{this.fire(new p.l("sourcedataabort",A))})}_getMapId(){return this._mapId}setGlobalStateProperty(w,o){return this.style.setGlobalStateProperty(w,o),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(w,o){if(void 0===o&&(o=w.getDefaultPosition?w.getDefaultPosition():"top-right"),!w||!w.onAdd)return this.fire(new p.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=w.onAdd(this);this._controls.push(w);const g=this._controlPositions[o];return-1!==o.indexOf("bottom")?g.insertBefore(u,g.firstChild):g.appendChild(u),this}removeControl(w){if(!w||!w.onRemove)return this.fire(new p.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(w);return o>-1&&this._controls.splice(o,1),w.onRemove(this),this}hasControl(w){return this._controls.indexOf(w)>-1}coveringTiles(w){return ri(this.transform,w)}calculateCameraOptionsFromTo(w,o,u,g){return null==g&&this.terrain&&(g=this.terrain.getElevationForLngLatZoom(u,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(w,o,u,g)}resize(w,o=!0){const[u,g]=this._containerDimensions(),v=this._getClampedPixelRatio(u,g);if(this._resizeCanvas(u,g,v),this.painter.resize(u,g,v),this.painter.overLimit()){const M=this.painter.context.gl;this._maxCanvasSize=[M.drawingBufferWidth,M.drawingBufferHeight];const A=this._getClampedPixelRatio(u,g);this._resizeCanvas(u,g,A),this.painter.resize(u,g,A)}this._resizeTransform(o);const T=!this._moving;return T&&(this.stop(),this.fire(new p.l("movestart",w)).fire(new p.l("move",w))),this.fire(new p.l("resize",w)),T&&this.fire(new p.l("moveend",w)),this}_resizeTransform(w=!0){var o;const[u,g]=this._containerDimensions();this.transform.resize(u,g,w),null===(o=this._requestedCameraState)||void 0===o||o.resize(u,g,w)}_getClampedPixelRatio(w,o){const{0:u,1:g}=this._maxCanvasSize,v=this.getPixelRatio(),T=w*v,M=o*v;return Math.min(T>u?u/T:1,M>g?g/M:1)*v}getPixelRatio(){var w;return null!==(w=this._overridePixelRatio)&&void 0!==w?w:devicePixelRatio}setPixelRatio(w){this._overridePixelRatio=w,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(w){return this.transform.setMaxBounds(Oe.convert(w)),this._update()}setMinZoom(w){if((w=w??-2)>=-2&&w<=this.transform.maxZoom)return this.transform.setMinZoom(w),this._update(),this.getZoom()<w&&this.setZoom(w),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(w){if((w=w??22)>=this.transform.minZoom)return this.transform.setMaxZoom(w),this._update(),this.getZoom()>w&&this.setZoom(w),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(w){if((w=w??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(w>=0&&w<=this.transform.maxPitch)return this.transform.setMinPitch(w),this._update(),this.getPitch()<w&&this.setPitch(w),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(w){if((w=w??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(w>=this.transform.minPitch)return this.transform.setMaxPitch(w),this._update(),this.getPitch()>w&&this.setPitch(w),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(w){return this.transform.setRenderWorldCopies(w),this._update()}setTransformConstrain(w){return this.transform.setConstrainOverride(w),this._update()}project(w){return this.transform.locationToScreenPoint(p.V.convert(w),this.style&&this.terrain)}unproject(w){return this.transform.screenPointToLocation(p.P.convert(w),this.terrain)}isMoving(){var w;return this._moving||(null===(w=this.handlers)||void 0===w?void 0:w.isMoving())}isZooming(){var w;return this._zooming||(null===(w=this.handlers)||void 0===w?void 0:w.isZooming())}isRotating(){var w;return this._rotating||(null===(w=this.handlers)||void 0===w?void 0:w.isRotating())}_createDelegatedListener(w,o,u){if("mouseenter"===w||"mouseover"===w){let g=!1;return{layers:o,listener:u,delegates:{mousemove:T=>{const M=o.filter(O=>this.getLayer(O)),A=0!==M.length?this.queryRenderedFeatures(T.point,{layers:M}):[];A.length?g||(g=!0,u.call(this,new nr(w,this,T.originalEvent,{features:A}))):g=!1},mouseout:()=>{g=!1}}}}if("mouseleave"===w||"mouseout"===w){let g=!1;return{layers:o,listener:u,delegates:{mousemove:M=>{const A=o.filter(O=>this.getLayer(O));(0!==A.length?this.queryRenderedFeatures(M.point,{layers:A}):[]).length?g=!0:g&&(g=!1,u.call(this,new nr(w,this,M.originalEvent)))},mouseout:M=>{g&&(g=!1,u.call(this,new nr(w,this,M.originalEvent)))}}}}{const g=v=>{const T=o.filter(A=>this.getLayer(A)),M=0!==T.length?this.queryRenderedFeatures(v.point,{layers:T}):[];M.length&&(v.features=M,u.call(this,v),delete v.features)};return{layers:o,listener:u,delegates:{[w]:g}}}}_saveDelegatedListener(w,o){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[w]=this._delegatedListeners[w]||[],this._delegatedListeners[w].push(o)}_removeDelegatedListener(w,o,u){if(!this._delegatedListeners||!this._delegatedListeners[w])return;const g=this._delegatedListeners[w];for(let v=0;v<g.length;v++){const T=g[v];if(T.listener===u&&T.layers.length===o.length&&T.layers.every(M=>o.includes(M))){for(const M in T.delegates)this.off(M,T.delegates[M]);return void g.splice(v,1)}}}on(w,o,u){if(void 0===u)return super.on(w,o);const g="string"==typeof o?[o]:o,v=this._createDelegatedListener(w,g,u);this._saveDelegatedListener(w,v);for(const T in v.delegates)this.on(T,v.delegates[T]);return{unsubscribe:()=>{this._removeDelegatedListener(w,g,u)}}}once(w,o,u){if(void 0===u)return super.once(w,o);const g="string"==typeof o?[o]:o,v=this._createDelegatedListener(w,g,u);for(const T in v.delegates){const M=v.delegates[T];v.delegates[T]=(...A)=>{this._removeDelegatedListener(w,g,u),M(...A)}}this._saveDelegatedListener(w,v);for(const T in v.delegates)this.once(T,v.delegates[T]);return this}off(w,o,u){return void 0===u?super.off(w,o):(this._removeDelegatedListener(w,"string"==typeof o?[o]:o,u),this)}queryRenderedFeatures(w,o){if(!this.style)return[];let u;const g=w instanceof p.P||Array.isArray(w),v=g?w:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(g?{}:w)||{},v instanceof p.P||"number"==typeof v[0])u=[p.P.convert(v)];else{const T=p.P.convert(v[0]),M=p.P.convert(v[1]);u=[T,new p.P(M.x,T.y),M,new p.P(T.x,M.y),T]}return this.style.queryRenderedFeatures(u,o,this.transform)}querySourceFeatures(w,o){return this.style.querySourceFeatures(w,o)}setStyle(w,o){return!1!==(o=p.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o)).diff&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&w?(this._diffStyle(w,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(w,o))}setTransformRequest(w){return this._requestManager.setTransformRequest(w),this}_getUIString(w){const o=this._locale[w];if(null==o)throw new Error(`Missing UI string '${w}'`);return o}_updateStyle(w,o){var u,g;if(o.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(w,o));const v=this.style&&o.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!w)),w?(this.style=new Fc(this,o||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof w?this.style.loadURL(w,o,v):this.style.loadJSON(w,o,v),this):(null===(g=null===(u=this.style)||void 0===u?void 0:u.projection)||void 0===g||g.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Fc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(w,o){if("string"==typeof w){const u=this._requestManager.transformRequest(w,"Style");p.j(u,new AbortController).then(g=>{this._updateDiff(g.data,o)}).catch(g=>{g&&this.fire(new p.k(g))})}else"object"==typeof w&&this._updateDiff(w,o)}_updateDiff(w,o){try{this.style.setState(w,o)&&this._update(!0)}catch(u){p.w(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(w,o)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():p.w("There is no style added to the map.")}addSource(w,o){return this._lazyInitEmptyStyle(),this.style.addSource(w,o),this._update(!0)}isSourceLoaded(w){const o=this.style&&this.style.tileManagers[w];if(void 0!==o)return o.loaded();this.fire(new p.k(new Error(`There is no tile manager with ID '${w}'`)))}setTerrain(w){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),w){const o=this.style.tileManagers[w.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${w.source}`);null===this.terrain&&o.reload();for(const u in this.style._layers){const g=this.style._layers[u];"hillshade"===g.type&&g.source===w.source&&p.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),"color-relief"===g.type&&g.source===w.source&&p.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ru(this.painter,o,w),this.painter.renderToTexture=new Ki(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=u=>{var g;"style"===u.dataType?this.terrain.tileManager.freeRtt():"source"===u.dataType&&u.tile&&(u.sourceId!==w.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),"image"===(null===(g=u.source)||void 0===g?void 0:g.type)?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(u.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new p.l("terrain",{terrain:w})),this}getTerrain(){var w,o;return null!==(o=null===(w=this.terrain)||void 0===w?void 0:w.options)&&void 0!==o?o:null}areTilesLoaded(){const w=this.style&&this.style.tileManagers;for(const o in w){const u=w[o]._tiles;for(const g in u){const v=u[g];if("loaded"!==v.state&&"errored"!==v.state)return!1}}return!0}removeSource(w){return this.style.removeSource(w),this._update(!0)}getSource(w){return this.style.getSource(w)}setSourceTileLodParams(w,o,u){if(u){const g=this.getSource(u);if(!g)throw new Error(`There is no source with ID "${u}", cannot set LOD parameters`);g.calculateTileZoom=Tt(Math.max(1,w),Math.max(1,o))}else for(const g in this.style.tileManagers)this.style.tileManagers[g].getSource().calculateTileZoom=Tt(Math.max(1,w),Math.max(1,o));return this._update(!0),this}refreshTiles(w,o){const u=this.style.tileManagers[w];if(!u)throw new Error(`There is no tile manager with ID "${w}", cannot refresh tile`);void 0===o?u.reload(!0):u.refreshTiles(o.map(g=>new p.ad(g.z,g.x,g.y)))}addImage(w,o,u={}){const{pixelRatio:g=1,sdf:v=!1,stretchX:T,stretchY:M,content:A,textFitWidth:O,textFitHeight:U}=u;if(this._lazyInitEmptyStyle(),!(o instanceof HTMLImageElement||p.b(o))){if(void 0===o.width||void 0===o.height)return this.fire(new p.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:N,height:H,data:q}=o,te=o;return this.style.addImage(w,{data:new p.R({width:N,height:H},new Uint8Array(q)),pixelRatio:g,stretchX:T,stretchY:M,content:A,textFitWidth:O,textFitHeight:U,sdf:v,version:0,userImage:te}),te.onAdd&&te.onAdd(this,w),this}}{const{width:N,height:H,data:q}=ee.getImageData(o);this.style.addImage(w,{data:new p.R({width:N,height:H},q),pixelRatio:g,stretchX:T,stretchY:M,content:A,textFitWidth:O,textFitHeight:U,sdf:v,version:0})}}updateImage(w,o){const u=this.style.getImage(w);if(!u)return this.fire(new p.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=o instanceof HTMLImageElement||p.b(o)?ee.getImageData(o):o,{width:v,height:T,data:M}=g;if(void 0===v||void 0===T)return this.fire(new p.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==u.data.width||T!==u.data.height)return this.fire(new p.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const A=!(o instanceof HTMLImageElement||p.b(o));return u.data.replace(M,A),this.style.updateImage(w,u),this}getImage(w){return this.style.getImage(w)}hasImage(w){return w?!!this.style.getImage(w):(this.fire(new p.k(new Error("Missing required image id"))),!1)}removeImage(w){this.style.removeImage(w)}loadImage(w){return xt.getImage(this._requestManager.transformRequest(w,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(w,o){return this._lazyInitEmptyStyle(),this.style.addLayer(w,o),this._update(!0)}moveLayer(w,o){return this.style.moveLayer(w,o),this._update(!0)}removeLayer(w){return this.style.removeLayer(w),this._update(!0)}getLayer(w){return this.style.getLayer(w)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(w,o,u){return this.style.setLayerZoomRange(w,o,u),this._update(!0)}setFilter(w,o,u={}){return this.style.setFilter(w,o,u),this._update(!0)}getFilter(w){return this.style.getFilter(w)}setPaintProperty(w,o,u,g={}){return this.style.setPaintProperty(w,o,u,g),this._update(!0)}getPaintProperty(w,o){return this.style.getPaintProperty(w,o)}setLayoutProperty(w,o,u,g={}){return this.style.setLayoutProperty(w,o,u,g),this._update(!0)}getLayoutProperty(w,o){return this.style.getLayoutProperty(w,o)}setGlyphs(w,o={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(w,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(w,o,u={}){return this._lazyInitEmptyStyle(),this.style.addSprite(w,o,u,g=>{g||this._update(!0)}),this}removeSprite(w){return this._lazyInitEmptyStyle(),this.style.removeSprite(w),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(w,o={}){return this._lazyInitEmptyStyle(),this.style.setSprite(w,o,u=>{u||this._update(!0)}),this}setLight(w,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(w,o),this._update(!0)}getLight(){return this.style.getLight()}setSky(w,o={}){return this._lazyInitEmptyStyle(),this.style.setSky(w,o),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(w,o){return this.style.setFeatureState(w,o),this._update()}removeFeatureState(w,o){return this.style.removeFeatureState(w,o),this._update()}getFeatureState(w){return this.style.getFeatureState(w)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let w=0,o=0;return this._container&&(w=this._container.clientWidth||400,o=this._container.clientHeight||300),[w,o]}_setupContainer(){const w=this._container;w.classList.add("maplibregl-map");const o=this._canvasContainer=K.create("div","maplibregl-canvas-container",w);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=K.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const u=this._containerDimensions(),g=this._getClampedPixelRatio(u[0],u[1]);this._resizeCanvas(u[0],u[1],g);const v=this._controlContainer=K.create("div","maplibregl-control-container",w),T=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(M=>{T[M]=K.create("div",`maplibregl-ctrl-${M} `,v)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(w,o,u){this._canvas.width=Math.floor(u*w),this._canvas.height=Math.floor(u*o),this._canvas.style.width=`${w}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const w=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let o=null;this._canvas.addEventListener("webglcontextcreationerror",g=>{o={requestedAttributes:w},g&&(o.statusMessage=g.statusMessage,o.type=g.type)},{once:!0});let u=null;if(u=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,w):this._canvas.getContext("webgl2",w)||this._canvas.getContext("webgl",w),!u){const g="Failed to initialize WebGL";throw o?(o.message=g,new Error(JSON.stringify(o))):new Error(g)}this.painter=new Du(u,this.transform),Ee.testSupport(u)}migrateProjection(w,o){super.migrateProjection(w,o),this.painter.transform=w,this.fire(new p.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(w){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||w,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(w){return this._update(),this._renderTaskQueue.add(w)}_cancelRenderFrame(w){this._renderTaskQueue.remove(w)}_render(w){var o,u,g,v,T;const M=this._idleTriggered?this._fadeDuration:0,A=(null===(o=this.style.projection)||void 0===o?void 0:o.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(w),this._removed)return;let O=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const H=this.transform.zoom,q=ue();this.style.zoomHistory.update(H,q);const te=new p.H(H,{now:q,fadeDuration:M,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ce=te.crossFadingFactor();1===ce&&ce===this._crossFadingFactor||(O=!0,this._crossFadingFactor=ce),this.style.update(te)}const U=(null===(u=this.style.projection)||void 0===u?void 0:u.transitionState)>0!==A;null===(g=this.style.projection)||void 0===g||g.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState(null===(v=this.style.projection)||void 0===v?void 0:v.transitionState,null===(T=this.style.projection)||void 0===T?void 0:T.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||U)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,M,this._crossSourceCollisions,U),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:M,showPadding:this.showPadding}),this.fire(new p.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,p.cF.mark(p.cG.load),this.fire(new p.l("load"))),this.style&&(this.style.hasTransitions()||O)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const N=this._sourcesDirty||this._styleDirty||this._placementDirty;return N||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new p.l("idle")),!this._loaded||this._fullyLoaded||N||(this._fullyLoaded=!0,p.cF.mark(p.cG.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var w;this._hash&&this._hash.remove();for(const u of this._controls)u.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),xt.removeThrottleControl(this._imageQueueHandle),null===(w=this._resizeObserver)||void 0===w||w.disconnect();const o=this.painter.context.gl.getExtension("WEBGL_lose_context");o?.loseContext&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),K.remove(this._canvasContainer),K.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),p.cF.clearMetrics(),this._removed=!0,this.fire(new p.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ee.frame(this._frameRequest,w=>{p.cF.frame(w),this._frameRequest=null;try{this._render(w)}catch(o){if(!p.cH(o)&&o.message!==ol)throw o}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(w){this._showTileBoundaries!==w&&(this._showTileBoundaries=w,this._update())}get showPadding(){return!!this._showPadding}set showPadding(w){this._showPadding!==w&&(this._showPadding=w,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(w){this._showCollisionBoxes!==w&&(this._showCollisionBoxes=w,w?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(w){this._showOverdrawInspector!==w&&(this._showOverdrawInspector=w,this._update())}get repaint(){return!!this._repaint}set repaint(w){this._repaint!==w&&(this._repaint=w,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(w){this._vertices=w,this._update()}get version(){return Lu}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(w){return this._lazyInitEmptyStyle(),this.style.setProjection(w),this._update(!0)}},I.MapMouseEvent=nr,I.MapTouchEvent=Zc,I.MapWheelEvent=za,I.Marker=jl,I.NavigationControl=class{constructor(w){this._updateZoomButtons=()=>{const o=this._map.getZoom(),u=o===this._map.getMaxZoom(),g=o===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(o,u)=>{const g=this._map._getUIString(`NavigationControl.${u}`);o.title=g,o.setAttribute("aria-label",g)},this.options=p.e({},va,w),this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),K.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),K.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=K.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(w){return this._map=w,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new hf(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){K.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(w,o){const u=K.create("button",w,this._container);return u.type="button",u.addEventListener("click",o),u}},I.Popup=class extends p.E{constructor(w){super(),this._updateOpacity=()=>{void 0!==this.options.locationOccludedOpacity&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&K.remove(this._content),this._container&&(K.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new p.l("close"))),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=K.create("div","maplibregl-popup",this._map.getContainer()),this._tip=K.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const M of this.options.className.split(" "))this._container.classList.add(M);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Ou(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!o)return;const u=this._flatPos=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&o?o:this._map.transform.locationToScreenPoint(this._lngLat));let g=this.options.anchor;const v=Dh(this.options.offset);if(!g){const M=this._container.offsetWidth,A=this._container.offsetHeight;let O;O=u.y+v.bottom.y<A?["top"]:u.y>this._map.transform.height-A?["bottom"]:[],u.x<M/2?O.push("left"):u.x>this._map.transform.width-M/2&&O.push("right"),g=0===O.length?"bottom":O.join("-")}let T=u.add(v[g]);this.options.subpixelPositioning||(T=T.round()),K.setTransform(this._container,`${Tc[g]} translate(${T.x}px,${T.y}px)`),xh(this._container,g,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=p.e(Object.create(fi),w)}addTo(w){return this._map&&this.remove(),this._map=w,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new p.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(w){return this._lngLat=p.V.convert(w),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(w){return this.setDOMContent(document.createTextNode(w))}setHTML(w){const o=document.createDocumentFragment(),u=document.createElement("body");let g;for(u.innerHTML=w;g=u.firstChild,g;)o.appendChild(g);return this.setDOMContent(o)}getMaxWidth(){var w;return null===(w=this._container)||void 0===w?void 0:w.style.maxWidth}setMaxWidth(w){return this.options.maxWidth=w,this._update(),this}setDOMContent(w){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=K.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(w),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(w){return this._container&&this._container.classList.add(w),this}removeClassName(w){return this._container&&this._container.classList.remove(w),this}setOffset(w){return this.options.offset=w,this._update(),this}toggleClassName(w){if(this._container)return this._container.classList.toggle(w)}setSubpixelPositioning(w){this.options.subpixelPositioning=w}_createCloseButton(){this.options.closeButton&&(this._closeButton=K.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const w=this._container.querySelector(Th);w&&w.focus()}},I.RasterDEMTileSource=Ut,I.RasterTileSource=jt,I.ScaleControl=class{constructor(w){this._onMove=()=>{Ch(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,Ch(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},xd),w)}getDefaultPosition(){return"bottom-left"}onAdd(w){return this._map=w,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-scale",w.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){K.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},I.ScrollZoomHandler=vd,I.Style=Fc,I.TerrainControl=class{constructor(w){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=w}onAdd(w){return this._map=w,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=K.create("button","maplibregl-ctrl-terrain",this._container),K.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){K.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},I.TwoFingersTouchPitchHandler=ag,I.TwoFingersTouchRotateHandler=og,I.TwoFingersTouchZoomHandler=Ip,I.TwoFingersTouchZoomRotateHandler=Lp,I.VectorTileSource=it,I.VideoSource=mn,I.addSourceType=(w,o)=>p._(void 0,void 0,void 0,function*(){if(Hr(w))throw new Error(`A source type called "${w}" already exists.`);bi[w]=o}),I.clearPrewarmedResources=function(){const w=zn;w&&(w.isPreloaded()&&1===w.numActive()?(w.release(ln),zn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},I.createTileMesh=Lc,I.getMaxParallelImageRequests=function(){return p.a.MAX_PARALLEL_IMAGE_REQUESTS},I.getRTLTextPluginStatus=function(){return qi().getRTLTextPluginStatus()},I.getVersion=function(){return Mh},I.getWorkerCount=function(){return Wt.workerCount},I.getWorkerUrl=function(){return p.a.WORKER_URL},I.importScriptInWorkers=function(w){return tr().broadcast("IS",w)},I.isTimeFrozen=function(){return fe.isFrozen()},I.now=ue,I.prewarm=function(){mi().acquire(ln)},I.restoreNow=function(){fe.restoreNow()},I.setMaxParallelImageRequests=function(w){p.a.MAX_PARALLEL_IMAGE_REQUESTS=w},I.setNow=function(w){fe.setNow(w)},I.setRTLTextPlugin=function(w,o){return qi().setRTLTextPlugin(w,o)},I.setWorkerCount=function(w){Wt.workerCount=w},I.setWorkerUrl=function(w){p.a.WORKER_URL=w}}),Je}()},239:(uu,Je,et)=>{"use strict";function st(e,t,n,i,s,c,d){try{var _=e[c](d),x=_.value}catch(E){return void n(E)}_.done?t(x):Promise.resolve(x).then(i,s)}function Pe(e){return function(){var t=this,n=arguments;return new Promise(function(i,s){var c=e.apply(t,n);function d(x){st(c,i,s,d,_,"next",x)}function _(x){st(c,i,s,d,_,"throw",x)}d(void 0)})}}function I(e,t){return Object.is(e,t)}let p=null,Z=!1,he=1;const be=Symbol("SIGNAL");function me(e){const t=p;return p=e,t}const ue={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function K(e){if(Z)throw new Error("");if(null===p)return;p.consumerOnSignalRead(e);const t=p.nextProducerIndex++;pe(p),t<p.producerNode.length&&p.producerNode[t]!==e&&Dt(p)&&Ze(p.producerNode[t],p.producerIndexOfThis[t]),p.producerNode[t]!==e&&(p.producerNode[t]=e,p.producerIndexOfThis[t]=Dt(p)?Hn(e,p,t):0),p.producerLastReadVersion[t]=e.version}function Ie(e){if((!Dt(e)||e.dirty)&&(e.dirty||e.lastCleanEpoch!==he)){if(!e.producerMustRecompute(e)&&!Mt(e))return void St(e);e.producerRecomputeValue(e),St(e)}}function Ue(e){if(void 0===e.liveConsumerNode)return;const t=Z;Z=!0;try{for(const n of e.liveConsumerNode)n.dirty||ct(n)}finally{Z=t}}function ot(){return!1!==p?.consumerAllowSignalWrites}function ct(e){e.dirty=!0,Ue(e),e.consumerMarkedDirty?.(e)}function St(e){e.dirty=!1,e.lastCleanEpoch=he}function xt(e){return e&&(e.nextProducerIndex=0),me(e)}function Qt(e,t){if(me(t),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if(Dt(e))for(let n=e.nextProducerIndex;n<e.producerNode.length;n++)Ze(e.producerNode[n],e.producerIndexOfThis[n]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}function Mt(e){pe(e);for(let t=0;t<e.producerNode.length;t++){const n=e.producerNode[t],i=e.producerLastReadVersion[t];if(i!==n.version||(Ie(n),i!==n.version))return!0}return!1}function on(e){if(pe(e),Dt(e))for(let t=0;t<e.producerNode.length;t++)Ze(e.producerNode[t],e.producerIndexOfThis[t]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}function Hn(e,t,n){if(Rt(e),0===e.liveConsumerNode.length&&ii(e))for(let i=0;i<e.producerNode.length;i++)e.producerIndexOfThis[i]=Hn(e.producerNode[i],e,i);return e.liveConsumerIndexOfThis.push(n),e.liveConsumerNode.push(t)-1}function Ze(e,t){if(Rt(e),1===e.liveConsumerNode.length&&ii(e))for(let i=0;i<e.producerNode.length;i++)Ze(e.producerNode[i],e.producerIndexOfThis[i]);const n=e.liveConsumerNode.length-1;if(e.liveConsumerNode[t]=e.liveConsumerNode[n],e.liveConsumerIndexOfThis[t]=e.liveConsumerIndexOfThis[n],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,t<e.liveConsumerNode.length){const i=e.liveConsumerIndexOfThis[t],s=e.liveConsumerNode[t];pe(s),s.producerIndexOfThis[i]=t}}function Dt(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function pe(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}function Rt(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}function ii(e){return void 0!==e.producerNode}const Qn=Symbol("UNSET"),pt=Symbol("COMPUTING"),Nn=Symbol("ERRORED"),nt={...ue,value:Qn,dirty:!0,error:null,equal:I,kind:"computed",producerMustRecompute:e=>e.value===Qn||e.value===pt,producerRecomputeValue(e){if(e.value===pt)throw new Error("Detected cycle in computations.");const t=e.value;e.value=pt;const n=xt(e);let i,s=!1;try{i=e.computation(),me(null),s=t!==Qn&&t!==Nn&&i!==Nn&&e.equal(t,i)}catch(c){i=Nn,e.error=c}finally{Qt(e,n)}s?e.value=t:(e.value=i,e.version++)}};let Sn=function ht(){throw new Error};function ln(e){Sn(e)}function mi(e,t){ot()||ln(e),e.equal(e.value,t)||(e.value=t,function Jr(e){e.version++,function Ee(){he++}(),Ue(e)}(e))}const pr={...ue,equal:I,value:void 0,kind:"signal"};let jt;function Ut(){return jt}function dt(e){const t=jt;return jt=e,t}const tn=Symbol("NotFound");function mn(e){return"function"==typeof e}function ji(e){const n=e(i=>{Error.call(i),i.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}Error;const bi=ji(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((i,s)=>`${s+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function Hr(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class ur{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const c of n)c.remove(this);else n.remove(this);const{initialTeardown:i}=this;if(mn(i))try{i()}catch(c){t=c instanceof bi?c.errors:[c]}const{_finalizers:s}=this;if(s){this._finalizers=null;for(const c of s)try{qi(c)}catch(d){t=t??[],d instanceof bi?t=[...t,...d.errors]:t.push(d)}}if(t)throw new bi(t)}}add(t){var n;if(t&&t!==this)if(this.closed)qi(t);else{if(t instanceof ur){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&Hr(n,t)}remove(t){const{_finalizers:n}=this;n&&Hr(n,t),t instanceof ur&&t._removeParent(this)}}ur.EMPTY=(()=>{const e=new ur;return e.closed=!0,e})();const Mo=ur.EMPTY;function is(e){return e instanceof ur||e&&"closed"in e&&mn(e.remove)&&mn(e.add)&&mn(e.unsubscribe)}function qi(e){mn(e)?e():e.unsubscribe()}const Sr={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},He={setTimeout(e,t,...n){const{delegate:i}=He;return i?.setTimeout?i.setTimeout(e,t,...n):setTimeout(e,t,...n)},clearTimeout(e){const{delegate:t}=He;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function ie(e){He.setTimeout(()=>{const{onUnhandledError:t}=Sr;if(!t)throw e;t(e)})}function oe(){}const ge=rt("C",void 0,void 0);function rt(e,t,n){return{kind:e,value:t,error:n}}let xe=null;function Ke(e){if(Sr.useDeprecatedSynchronousErrorHandling){const t=!xe;if(t&&(xe={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:i}=xe;if(xe=null,n)throw i}}else e()}class bt extends ur{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,is(t)&&t.add(this)):this.destination=mr}static create(t,n,i){return new ri(t,n,i)}next(t){this.isStopped?$i(function Ve(e){return rt("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?$i(function Fe(e){return rt("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?$i(ge,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Tt=Function.prototype.bind;function vn(e,t){return Tt.call(e,t)}class Bn{constructor(t){this.partialObserver=t}next(t){const{partialObserver:n}=this;if(n.next)try{n.next(t)}catch(i){hr(i)}}error(t){const{partialObserver:n}=this;if(n.error)try{n.error(t)}catch(i){hr(i)}else hr(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(n){hr(n)}}}class ri extends bt{constructor(t,n,i){let s;if(super(),mn(t)||!t)s={next:t??void 0,error:n??void 0,complete:i??void 0};else{let c;this&&Sr.useDeprecatedNextContext?(c=Object.create(t),c.unsubscribe=()=>this.unsubscribe(),s={next:t.next&&vn(t.next,c),error:t.error&&vn(t.error,c),complete:t.complete&&vn(t.complete,c)}):s=t}this.destination=new Bn(s)}}function hr(e){Sr.useDeprecatedSynchronousErrorHandling?function yt(e){Sr.useDeprecatedSynchronousErrorHandling&&xe&&(xe.errorThrown=!0,xe.error=e)}(e):ie(e)}function $i(e,t){const{onStoppedNotification:n}=Sr;n&&He.setTimeout(()=>n(e,t))}const mr={closed:!0,next:oe,error:function Ei(e){throw e},complete:oe},Gt="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ci(e){return e}function Zr(e){return 0===e.length?Ci:1===e.length?e[0]:function(n){return e.reduce((i,s)=>s(i),n)}}let di=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const i=new e;return i.source=this,i.operator=n,i}subscribe(n,i,s){const c=function Un(e){return e&&e instanceof bt||function Mn(e){return e&&mn(e.next)&&mn(e.error)&&mn(e.complete)}(e)&&is(e)}(n)?n:new ri(n,i,s);return Ke(()=>{const{operator:d,source:_}=this;c.add(d?d.call(c,_):_?this._subscribe(c):this._trySubscribe(c))}),c}_trySubscribe(n){try{return this._subscribe(n)}catch(i){n.error(i)}}forEach(n,i){return new(i=qt(i))((s,c)=>{const d=new ri({next:_=>{try{n(_)}catch(x){c(x),d.unsubscribe()}},error:c,complete:s});this.subscribe(d)})}_subscribe(n){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(n)}[Gt](){return this}pipe(...n){return Zr(n)(this)}toPromise(n){return new(n=qt(n))((i,s)=>{let c;this.subscribe(d=>c=d,d=>s(d),()=>i(c))})}}return e.create=t=>new e(t),e})();function qt(e){var t;return null!==(t=e??Sr.Promise)&&void 0!==t?t:Promise}const rs=ji(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Ir=(()=>{class e extends di{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const i=new mo(this,this);return i.operator=n,i}_throwIfClosed(){if(this.closed)throw new rs}next(n){Ke(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(n)}})}error(n){Ke(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:i}=this;for(;i.length;)i.shift().error(n)}})}complete(){Ke(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:i,isStopped:s,observers:c}=this;return i||s?Mo:(this.currentObservers=null,c.push(n),new ur(()=>{this.currentObservers=null,Hr(c,n)}))}_checkFinalizedStatuses(n){const{hasError:i,thrownError:s,isStopped:c}=this;i?n.error(s):c&&n.complete()}asObservable(){const n=new di;return n.source=this,n}}return e.create=(t,n)=>new mo(t,n),e})();class mo extends Ir{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,i;null===(i=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===i||i.call(n,t)}error(t){var n,i;null===(i=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===i||i.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,i;return null!==(i=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==i?i:Mo}}class kn extends Ir{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){const{hasError:t,thrownError:n,_value:i}=this;if(t)throw n;return this._throwIfClosed(),i}next(t){super.next(this._value=t)}}function ka(e){return mn(e?.lift)}function qr(e){return t=>{if(ka(t))return t.lift(function(n){try{return e(n,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Lr(e,t,n,i,s){return new ca(e,t,n,i,s)}class ca extends bt{constructor(t,n,i,s,c,d){super(t),this.onFinalize=c,this.shouldUnsubscribe=d,this._next=n?function(_){try{n(_)}catch(x){t.error(x)}}:super._next,this._error=s?function(_){try{s(_)}catch(x){t.error(x)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(_){t.error(_)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function Si(e,t){return qr((n,i)=>{let s=0;n.subscribe(Lr(i,c=>{i.next(e.call(t,c,s++))}))})}const oc="https://angular.dev/best-practices/security#preventing-cross-site-scripting-xss";class Et extends Error{code;constructor(t,n){super(function Ja(e,t){return`${function gr(e){return`NG0${Math.abs(e)}`}(e)}${t?": "+t:""}`}(t,n)),this.code=t}}const Gs=Symbol("InputSignalNode#UNSET"),Sl={...pr,transformFn:void 0,applyValueToInputSignal(e,t){mi(e,t)}};function Ra(e,t){const n=Object.create(Sl);function i(){if(K(n),n.value===Gs)throw new Et(-950,null);return n.value}return n.value=e,n.transformFn=t?.transform,i[be]=n,i}function ua(e){return{toString:e}.toString()}const Ai="__parameters__";function xa(e,t,n){return ua(()=>{const i=function el(e){return function(...n){if(e){const i=e(...n);for(const s in i)this[s]=i[s]}}}(t);function s(...c){if(this instanceof s)return i.apply(this,c),this;const d=new s(...c);return _.annotation=d,_;function _(x,E,R){const z=x.hasOwnProperty(Ai)?x[Ai]:Object.defineProperty(x,Ai,{value:[]})[Ai];for(;z.length<=R;)z.push(null);return(z[R]=z[R]||[]).push(d),x}}return s.prototype.ngMetadataName=e,s.annotationCls=s,s})}const On=globalThis;function Wi(e){for(let t in e)if(e[t]===Wi)return t;throw Error("Could not find renamed property on target object.")}function Hs(e,t){for(const n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function to(e){if("string"==typeof e)return e;if(Array.isArray(e))return`[${e.map(to).join(", ")}]`;if(null==e)return""+e;const t=e.overriddenName||e.name;if(t)return`${t}`;const n=e.toString();if(null==n)return""+n;const i=n.indexOf("\n");return i>=0?n.slice(0,i):n}function Il(e,t){return e?t?`${e} ${t}`:e:t||""}const dr=Wi({__forward_ref__:Wi});function Gi(e){return e.__forward_ref__=Gi,e.toString=function(){return to(this())},e}function ti(e){return Uo(e)?e():e}function Uo(e){return"function"==typeof e&&e.hasOwnProperty(dr)&&e.__forward_ref__===Gi}function an(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function rr(e){return{providers:e.providers||[],imports:e.imports||[]}}function Ts(e){return fr(e,ai)||fr(e,Ri)}function fr(e,t){return e.hasOwnProperty(t)?e[t]:null}function ki(e){return e&&(e.hasOwnProperty(Al)||e.hasOwnProperty(Li))?e[Al]:null}const ai=Wi({\u0275prov:Wi}),Al=Wi({\u0275inj:Wi}),Ri=Wi({ngInjectableDef:Wi}),Li=Wi({ngInjectorDef:Wi});class sn{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(t,n){this._desc=t,this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=an({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function Ws(e){return e&&!!e.\u0275providers}const Wr=Wi({\u0275cmp:Wi}),zr=Wi({\u0275dir:Wi}),_o=Wi({\u0275pipe:Wi}),kl=Wi({\u0275mod:Wi}),ha=Wi({\u0275fac:Wi}),Rl=Wi({__NG_ELEMENT_ID__:Wi}),da=Wi({__NG_ENV_ID__:Wi});function li(e){return"string"==typeof e?e:null==e?"":String(e)}function uc(e,t){throw new Et(-200,e)}function hc(e,t){throw new Et(-201,!1)}var ci=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(ci||{});let wa;function Fc(){return wa}function yr(e){const t=wa;return wa=e,t}function Ys(e,t,n){const i=Ts(e);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:n&ci.Optional?null:void 0!==t?t:void hc()}const Ms={},du="__NG_DI_FLAG__";class Ll{injector;constructor(t){this.injector=t}retrieve(t,n){return this.injector.get(t,n.optional?tn:Ms,n)}}const fu="ngTempTokenPath",fd=/\n/gm,fa="__source";function dc(e,t=ci.Default){if(void 0===Ut())throw new Et(-203,!1);if(null===Ut())return Ys(e,void 0,t);{const n=Ut();let i;return i=n instanceof Ll?n.injector:n,i.get(e,t&ci.Optional?null:void 0,t)}}function Jn(e,t=ci.Default){return(Fc()||dc)(ti(e),t)}function Ot(e,t=ci.Default){return Jn(e,Ta(t))}function Ta(e){return typeof e>"u"||"number"==typeof e?e:(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function pu(e){const t=[];for(let n=0;n<e.length;n++){const i=ti(e[n]);if(Array.isArray(i)){if(0===i.length)throw new Et(900,!1);let s,c=ci.Default;for(let d=0;d<i.length;d++){const _=i[d],x=pd(_);"number"==typeof x?-1===x?s=_.token:c|=x:s=_}t.push(Jn(s,c))}else t.push(Jn(i))}return t}function hs(e,t){return e[du]=t,e.prototype[du]=t,e}function pd(e){return e[du]}const Na=hs(xa("Optional"),8),_u=hs(xa("SkipSelf"),4);function Po(e,t){return e.hasOwnProperty(ha)?e[ha]:null}function fc(e,t){e.forEach(n=>Array.isArray(n)?fc(n,t):t(n))}function Es(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function Yo(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function Ho(e,t,n){let i=Xo(e,t);return i>=0?e[1|i]=n:(i=~i,function mc(e,t,n,i){let s=e.length;if(s==t)e.push(n,i);else if(1===s)e.push(i,e[0]),e[0]=n;else{for(s--,e.push(e[s-1],e[s]);s>t;)e[s]=e[s-2],s--;e[t]=n,e[t+1]=i}}(e,i,t,n)),i}function Ol(e,t){const n=Xo(e,t);if(n>=0)return e[1|n]}function Xo(e,t){return function Bc(e,t,n){let i=0,s=e.length>>n;for(;s!==i;){const c=i+(s-i>>1),d=e[c<<n];if(t===d)return c<<n;d>t?s=c:i=c+1}return~(s<<n)}(e,t,1)}const Xs={},Ln=[],pa=new sn(""),yu=new sn("",-1),ph=new sn("");class vu{get(t,n=Ms){if(n===Ms){const i=new Error(`NullInjectorError: No provider for ${to(t)}!`);throw i.name="NullInjectorError",i}return n}}function Ss(e,t){const n=e[kl]||null;if(!n&&!0===t)throw new Error(`Type ${to(e)} does not have '\u0275mod' property.`);return n}function wi(e){return e[Wr]||null}function Pr(e){return e[_o]||null}function ds(e){return{\u0275providers:e}}function Vc(...e){return{\u0275providers:fs(0,e),\u0275fromNgModule:!0}}function fs(e,...t){const n=[],i=new Set;let s;const c=d=>{n.push(d)};return fc(t,d=>{const _=d;il(_,c,[],i)&&(s||=[],s.push(_))}),void 0!==s&&gd(s,c),n}function gd(e,t){for(let n=0;n<e.length;n++){const{ngModule:i,providers:s}=e[n];Is(s,c=>{t(c,i)})}}function il(e,t,n,i){if(!(e=ti(e)))return!1;let s=null,c=ki(e);const d=!c&&wi(e);if(c||d){if(d&&!d.standalone)return!1;s=e}else{const x=e.ngModule;if(c=ki(x),!c)return!1;s=x}const _=i.has(s);if(d){if(_)return!1;if(i.add(s),d.dependencies){const x="function"==typeof d.dependencies?d.dependencies():d.dependencies;for(const E of x)il(E,t,n,i)}}else{if(!c)return!1;{if(null!=c.imports&&!_){let E;i.add(s);try{fc(c.imports,R=>{il(R,t,n,i)&&(E||=[],E.push(R))})}finally{}void 0!==E&&gd(E,t)}if(!_){const E=Po(s)||(()=>new s);t({provide:s,useFactory:E,deps:Ln},s),t({provide:ph,useValue:s,multi:!0},s),t({provide:pa,useValue:()=>Jn(s),multi:!0},s)}const x=c.providers;if(null!=x&&!_){const E=e;Is(x,R=>{t(R,E)})}}}return s!==e&&void 0!==e.providers}function Is(e,t){for(let n of e)Ws(n)&&(n=n.\u0275providers),Array.isArray(n)?Is(n,t):t(n)}const bu=Wi({provide:String,useValue:Wi});function _c(e){return null!==e&&"object"==typeof e&&bu in e}function rl(e){return"function"==typeof e}const ga=new sn(""),xu={},vc={};let _i;function Fl(){return void 0===_i&&(_i=new vu),_i}class ps{}class Nl extends ps{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(t,n,i,s){super(),this.parent=n,this.source=i,this.scopes=s,f(t,d=>this.processProvider(d)),this.records.set(yu,ol(void 0,this)),s.has("environment")&&this.records.set(ps,ol(void 0,this));const c=this.records.get(ga);null!=c&&"string"==typeof c.value&&this.scopes.add(c.value),this.injectorDefTypes=new Set(this.get(ph,Ln,ci.Self))}retrieve(t,n){return this.get(t,n.optional?tn:Ms,n)}destroy(){Uc(this),this._destroyed=!0;const t=me(null);try{for(const i of this._ngOnDestroyHooks)i.ngOnDestroy();const n=this._onDestroyHooks;this._onDestroyHooks=[];for(const i of n)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),me(t)}}onDestroy(t){return Uc(this),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){Uc(this);const n=dt(this),i=yr(void 0);try{return t()}finally{dt(n),yr(i)}}get(t,n=Ms,i=ci.Default){if(Uc(this),t.hasOwnProperty(da))return t[da](this);i=Ta(i);const c=dt(this),d=yr(void 0);try{if(!(i&ci.SkipSelf)){let x=this.records.get(t);if(void 0===x){const E=function bc(e){return"function"==typeof e||"object"==typeof e&&e instanceof sn}(t)&&Ts(t);x=E&&this.injectableDefInScope(E)?ol(zl(t),xu):null,this.records.set(t,x)}if(null!=x)return this.hydrate(t,x,i)}return(i&ci.Self?Fl():this.parent).get(t,n=i&ci.Optional&&n===Ms?null:n)}catch(_){if("NullInjectorError"===_.name){if((_[fu]=_[fu]||[]).unshift(to(t)),c)throw _;return function mu(e,t,n,i){const s=e[fu];throw t[fa]&&s.unshift(t[fa]),e.message=function gu(e,t,n,i=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let s=to(t);if(Array.isArray(t))s=t.map(to).join(" -> ");else if("object"==typeof t){let c=[];for(let d in t)if(t.hasOwnProperty(d)){let _=t[d];c.push(d+":"+("string"==typeof _?JSON.stringify(_):to(_)))}s=`{${c.join(", ")}}`}return`${n}${i?"("+i+")":""}[${s}]: ${e.replace(fd,"\n  ")}`}("\n"+e.message,s,n,i),e.ngTokenPath=s,e[fu]=null,e}(_,t,"R3InjectorError",this.source)}throw _}finally{yr(d),dt(c)}}resolveInjectorInitializers(){const t=me(null),n=dt(this),i=yr(void 0);try{const c=this.get(pa,Ln,ci.Self);for(const d of c)d()}finally{dt(n),yr(i),me(t)}}toString(){const t=[],n=this.records;for(const i of n.keys())t.push(to(i));return`R3Injector[${t.join(", ")}]`}processProvider(t){let n=rl(t=ti(t))?t:ti(t&&t.provide);const i=function lf(e){return _c(e)?ol(void 0,e.useValue):ol(gh(e),xu)}(t);if(!rl(t)&&!0===t.multi){let s=this.records.get(n);s||(s=ol(void 0,xu,!0),s.factory=()=>pu(s.multi),this.records.set(n,s)),n=t,s.multi.push(t)}this.records.set(n,i)}hydrate(t,n,i){const s=me(null);try{return n.value===vc?uc(to(t)):n.value===xu&&(n.value=vc,n.value=n.factory(void 0,i)),"object"==typeof n.value&&n.value&&function Cu(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}finally{me(s)}}injectableDefInScope(t){if(!t.providedIn)return!1;const n=ti(t.providedIn);return"string"==typeof n?"any"===n||this.scopes.has(n):this.injectorDefTypes.has(n)}removeOnDestroy(t){const n=this._onDestroyHooks.indexOf(t);-1!==n&&this._onDestroyHooks.splice(n,1)}}function zl(e){const t=Ts(e),n=null!==t?t.factory:Po(e);if(null!==n)return n;if(e instanceof sn)throw new Et(204,!1);if(e instanceof Function)return function mh(e){if(e.length>0)throw new Et(204,!1);const n=function Fa(e){return e&&(e[ai]||e[Ri])||null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new Et(204,!1)}function gh(e,t,n){let i;if(rl(e)){const s=ti(e);return Po(s)||zl(s)}if(_c(e))i=()=>ti(e.useValue);else if(function Ks(e){return!(!e||!e.useFactory)}(e))i=()=>e.useFactory(...pu(e.deps||[]));else if(function jc(e){return!(!e||!e.useExisting)}(e))i=(s,c)=>Jn(ti(e.useExisting),void 0!==c&&c&ci.Optional?ci.Optional:void 0);else{const s=ti(e&&(e.useClass||e.provide));if(!function wu(e){return!!e.deps}(e))return Po(s)||zl(s);i=()=>new s(...pu(e.deps))}return i}function Uc(e){if(e.destroyed)throw new Et(205,!1)}function ol(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function f(e,t){for(const n of e)Array.isArray(n)?f(n,t):n&&Ws(n)?f(n.\u0275providers,t):t(n)}function C(e,t){let n;e instanceof Nl?(Uc(e),n=e):n=new Ll(e);const s=dt(n),c=yr(void 0);try{return t()}finally{dt(s),yr(c)}}function vo(e){return Array.isArray(e)&&"object"==typeof e[1]}function io(e){return Array.isArray(e)&&!0===e[1]}function cf(e){return!!(4&e.flags)}function _a(e){return e.componentOffset>-1}function qc(e){return!(1&~e.flags)}function ro(e){return!!e.template}function hn(e){return!!(512&e[2])}function Vl(e){return!(256&~e[2])}class vd{previousValue;currentValue;firstChange;constructor(t,n,i){this.previousValue=t,this.currentValue=n,this.firstChange=i}isFirstChange(){return this.firstChange}}function vh(e,t,n,i){null!==t?t.applyValueToInputSignal(t,i):e[n]=i}const Js=(()=>{const e=()=>Ap;return e.ngInherit=!0,e})();function Ap(e){return e.type.prototype.ngOnChanges&&(e.setInput=Rp),kp}function kp(){const e=Ba(this),t=e?.current;if(t){const n=e.previous;if(n===Xs)e.previous=t;else for(let i in t)n[i]=t[i];e.current=null,this.ngOnChanges(t)}}function Rp(e,t,n,i,s){const c=this.declaredInputs[i],d=Ba(e)||function Au(e,t){return e[Lp]=t}(e,{previous:Xs,current:null}),_=d.current||(d.current={}),x=d.previous,E=x[c];_[c]=new vd(E&&E.currentValue,n,x===Xs),vh(e,t,s,n)}const Lp="__ngSimpleChanges__";function Ba(e){return e[Lp]||null}function gi(e){for(;Array.isArray(e);)e=e[0];return e}function ku(e,t){return gi(t[e])}function ea(e,t){return gi(t[e.index])}function Ru(e,t){return e.data[t]}function Ki(e,t){const n=t[e];return vo(n)?n:n[0]}function Lu(e){return!(128&~e[2])}function va(e,t){return null==t?null:e[t]}function hf(e){e[17]=0}function ul(e){1024&e[2]||(e[2]|=1024,Lu(e)&&jl(e))}function Tc(e){return!!(9216&e[2]||e[24]?.dirty)}function xh(e){e[10].changeDetectionScheduler?.notify(8),64&e[2]&&(e[2]|=1024),Tc(e)&&jl(e)}function jl(e){e[10].changeDetectionScheduler?.notify(0);let t=ta(e);for(;null!==t&&!(8192&t[2])&&(t[2]|=8192,Lu(t));)t=ta(t)}function wh(e,t){if(Vl(e))throw new Et(911,!1);null===e[21]&&(e[21]=[]),e[21].push(t)}function ta(e){const t=e[3];return io(t)?t[3]:t}function xd(e){return e[7]??=[]}function Ch(e){return e.cleanup??=[]}const fi={lFrame:bo(null),bindingsEnabled:!0,skipHydrationRootTNode:null};let Mh=!1;function g(){return fi.bindingsEnabled}function N(){return fi.lFrame.lView}function H(){return fi.lFrame.tView}function q(e){return fi.lFrame.contextLView=e,e[8]}function te(e){return fi.lFrame.contextLView=null,e}function ce(){let e=Te();for(;null!==e&&64===e.type;)e=e.parent;return e}function Te(){return fi.lFrame.currentTNode}function we(e,t){const n=fi.lFrame;n.currentTNode=e,n.isParent=t}function Le(){return fi.lFrame.isParent}function je(){fi.lFrame.isParent=!1}function Qe(){return Mh}function gt(e){const t=Mh;return Mh=e,t}function Ht(){return fi.lFrame.bindingIndex++}function $t(e){const t=fi.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}function yi(e,t){const n=fi.lFrame;n.bindingIndex=n.bindingRootIndex=e,br(t)}function br(e){fi.lFrame.currentDirectiveIndex=e}function Or(){return fi.lFrame.currentQueryIndex}function ar(e){fi.lFrame.currentQueryIndex=e}function Ao(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[5]:null}function Fr(e,t,n){if(n&ci.SkipSelf){let s=t,c=e;for(;!(s=s.parent,null!==s||n&ci.Host||(s=Ao(c),null===s||(c=c[14],10&s.type))););if(null===s)return!1;t=s,e=c}const i=fi.lFrame=so();return i.currentTNode=t,i.lView=e,!0}function oo(e){const t=so(),n=e[1];fi.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function so(){const e=fi.lFrame,t=null===e?null:e.child;return null===t?bo(e):t}function bo(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function na(){const e=fi.lFrame;return fi.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const Ul=na;function Va(){const e=na();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function Xr(){return fi.lFrame.selectedIndex}function Ma(e){fi.lFrame.selectedIndex=e}function zi(){const e=fi.lFrame;return Ru(e.tView,e.selectedIndex)}function er(){fi.lFrame.currentNamespace="svg"}function lr(){!function Nu(){fi.lFrame.currentNamespace=null}()}let Kr=!0;function Mr(){return Kr}function wr(e){Kr=e}function $l(e,t){for(let n=t.directiveStart,i=t.directiveEnd;n<i;n++){const c=e.data[n].type.prototype,{ngAfterContentInit:d,ngAfterContentChecked:_,ngAfterViewInit:x,ngAfterViewChecked:E,ngOnDestroy:R}=c;d&&(e.contentHooks??=[]).push(-n,d),_&&((e.contentHooks??=[]).push(n,_),(e.contentCheckHooks??=[]).push(n,_)),x&&(e.viewHooks??=[]).push(-n,x),E&&((e.viewHooks??=[]).push(n,E),(e.viewCheckHooks??=[]).push(n,E)),null!=R&&(e.destroyHooks??=[]).push(n,R)}}function wd(e,t,n){Kc(e,t,3,n)}function Cd(e,t,n,i){(3&e[2])===n&&Kc(e,t,n,i)}function df(e,t){let n=e[2];(3&n)===t&&(n&=16383,n+=1,e[2]=n)}function Kc(e,t,n,i){const c=i??-1,d=t.length-1;let _=0;for(let x=void 0!==i?65535&e[17]:0;x<d;x++)if("number"==typeof t[x+1]){if(_=t[x],null!=i&&_>=i)break}else t[x]<0&&(e[17]+=65536),(_<c||-1==c)&&(Qc(e,n,t,x),e[17]=(4294901760&e[17])+x+2),x++}function ug(e,t){const n=me(null);try{t.call(e)}finally{me(n)}}function Qc(e,t,n,i){const s=n[i]<0,c=n[i+1],_=e[s?-n[i]:n[i]];s?e[2]>>14<e[17]>>16&&(3&e[2])===t&&(e[2]+=16384,ug(_,c)):ug(_,c)}class zu{factory;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(t,n,i){this.factory=t,this.canSeeViewProviders=n,this.injectImpl=i}}function K0(e){return 3===e||4===e||6===e}function hg(e){return 64===e.charCodeAt(0)}function ff(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let i=0;i<t.length;i++){const s=t[i];"number"==typeof s?n=s:0===n||dg(e,n,s,0,-1===n||2===n?t[++i]:null)}}return e}function dg(e,t,n,i,s){let c=0,d=e.length;if(-1===t)d=-1;else for(;c<e.length;){const _=e[c++];if("number"==typeof _){if(_===t){d=-1;break}if(_>t){d=c-1;break}}}for(;c<e.length;){const _=e[c];if("number"==typeof _)break;if(_===n)return void(null!==s&&(e[c+1]=s));c++,null!==s&&c++}-1!==d&&(e.splice(d,0,t),c=d+1),e.splice(c++,0,n),null!==s&&e.splice(c++,0,s)}function fg(e){return-1!==e}function pf(e){return 32767&e}function zp(e,t){let n=function mf(e){return e>>16}(e),i=t;for(;n>0;)i=i[14],n--;return i}let Eh=!0;function Td(e){const t=Eh;return Eh=e,t}let Yw=0;const Jc={};function gf(e,t){const n=hy(e,t);if(-1!==n)return n;const i=t[1];i.firstCreatePass&&(e.injectorIndex=t.length,pg(i.data,e),pg(t,null),pg(i.blueprint,null));const s=mg(e,t),c=e.injectorIndex;if(fg(s)){const d=pf(s),_=zp(s,t),x=_[1].data;for(let E=0;E<8;E++)t[c+E]=_[d+E]|x[d+E]}return t[c+8]=s,c}function pg(e,t){e.push(0,0,0,0,0,0,0,0,t)}function hy(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function mg(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,i=null,s=t;for(;null!==s;){if(i=gy(s),null===i)return-1;if(n++,s=s[14],-1!==i.injectorIndex)return i.injectorIndex|n<<16}return-1}function dy(e,t,n){!function eb(e,t,n){let i;"string"==typeof n?i=n.charCodeAt(0)||0:n.hasOwnProperty(Rl)&&(i=n[Rl]),null==i&&(i=n[Rl]=Yw++);const s=255&i;t.data[e+(s>>5)]|=1<<s}(e,t,n)}function fy(e,t,n){if(n&ci.Optional||void 0!==e)return e;hc()}function nb(e,t,n,i){if(n&ci.Optional&&void 0===i&&(i=null),!(n&(ci.Self|ci.Host))){const s=e[9],c=yr(void 0);try{return s?s.get(t,i,n&ci.Optional):Ys(t,i,n&ci.Optional)}finally{yr(c)}}return fy(i,0,n)}function gg(e,t,n,i=ci.Default,s){if(null!==e){if(2048&t[2]&&!(i&ci.Self)){const d=function sb(e,t,n,i,s){let c=e,d=t;for(;null!==c&&null!==d&&2048&d[2]&&!hn(d);){const _=py(c,d,n,i|ci.Self,Jc);if(_!==Jc)return _;let x=c.parent;if(!x){const E=d[20];if(E){const R=E.get(n,Jc,i);if(R!==Jc)return R}x=gy(d),d=d[14]}c=x}return s}(e,t,n,i,Jc);if(d!==Jc)return d}const c=py(e,t,n,i,Jc);if(c!==Jc)return c}return nb(t,n,i,s)}function py(e,t,n,i,s){const c=function ib(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(Rl)?e[Rl]:void 0;return"number"==typeof t?t>=0?255&t:ob:t}(n);if("function"==typeof c){if(!Fr(t,e,i))return i&ci.Host?fy(s,0,i):nb(t,n,i,s);try{let d;if(d=c(i),null!=d||i&ci.Optional)return d;hc()}finally{Ul()}}else if("number"==typeof c){let d=null,_=hy(e,t),x=-1,E=i&ci.Host?t[15][5]:null;for((-1===_||i&ci.SkipSelf)&&(x=-1===_?mg(e,t):t[_+8],-1!==x&&rb(i,!1)?(d=t[1],_=pf(x),t=zp(x,t)):_=-1);-1!==_;){const R=t[1];if(_g(c,_,R.data)){const z=my(_,t,n,d,i,E);if(z!==Jc)return z}x=t[_+8],-1!==x&&rb(i,t[1].data[_+8]===E)&&_g(c,_,t)?(d=R,_=pf(x),t=zp(x,t)):_=-1}}return s}function my(e,t,n,i,s,c){const d=t[1],_=d.data[e+8],R=Sh(_,d,n,null==i?_a(_)&&Eh:i!=d&&!!(3&_.type),s&ci.Host&&c===_);return null!==R?_s(t,d,R,_,s):Jc}function Sh(e,t,n,i,s){const c=e.providerIndexes,d=t.data,_=1048575&c,x=e.directiveStart,R=c>>20,V=s?_+R:e.directiveEnd;for(let j=i?_:_+R;j<V;j++){const J=d[j];if(j<x&&n===J||j>=x&&J.type===n)return j}if(s){const j=d[x];if(j&&ro(j)&&j.type===n)return x}return null}function _s(e,t,n,i,s){let c=e[n];const d=t.data;if(c instanceof zu){const _=c;_.resolving&&uc(function Yi(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():li(e)}(d[n]));const x=Td(_.canSeeViewProviders);_.resolving=!0;const R=_.injectImpl?yr(_.injectImpl):null;Fr(e,i,ci.Default);try{c=e[n]=_.factory(void 0,s,d,e,i),t.firstCreatePass&&n>=i.directiveStart&&function Er(e,t,n){const{ngOnChanges:i,ngOnInit:s,ngDoCheck:c}=t.type.prototype;if(i){const d=Ap(t);(n.preOrderHooks??=[]).push(e,d),(n.preOrderCheckHooks??=[]).push(e,d)}s&&(n.preOrderHooks??=[]).push(0-e,s),c&&((n.preOrderHooks??=[]).push(e,c),(n.preOrderCheckHooks??=[]).push(e,c))}(n,d[n],t)}finally{null!==R&&yr(R),Td(x),_.resolving=!1,Ul()}}return c}function _g(e,t,n){return!!(n[t+(e>>5)]&1<<e)}function rb(e,t){return!(e&ci.Self||e&ci.Host&&t)}class ko{_tNode;_lView;constructor(t,n){this._tNode=t,this._lView=n}get(t,n,i){return gg(this._tNode,this._lView,t,Ta(i),n)}}function ob(){return new ko(ce(),N())}function ks(e){return ua(()=>{const t=e.prototype.constructor,n=t[ha]||Bp(t),i=Object.prototype;let s=Object.getPrototypeOf(e.prototype).constructor;for(;s&&s!==i;){const c=s[ha]||Bp(s);if(c&&c!==n)return c;s=Object.getPrototypeOf(s)}return c=>new c})}function Bp(e){return Uo(e)?()=>{const t=Bp(ti(e));return t&&t()}:Po(e)}function gy(e){const t=e[1],n=t.type;return 2===n?t.declTNode:1===n?e[5]:null}function yg(e,t=null,n=null,i){const s=ub(e,t,n,i);return s.resolveInjectorInitializers(),s}function ub(e,t=null,n=null,i,s=new Set){const c=[n||Ln,Vc(e)];return i=i||("object"==typeof e?void 0:to(e)),new Nl(c,t||Fl(),i||null,s)}class ys{static THROW_IF_NOT_FOUND=Ms;static NULL=new vu;static create(t,n){if(Array.isArray(t))return yg({name:""},n,t,"");{const i=t.name??"";return yg({name:i},t.parent,t.providers,i)}}static \u0275prov=an({token:ys,providedIn:"any",factory:()=>Jn(yu)});static __NG_ELEMENT_ID__=-1}new sn("").__NG_ELEMENT_ID__=e=>{const t=ce();if(null===t)throw new Et(204,!1);if(2&t.type)return t.value;if(e&ci.Optional)return null;throw new Et(204,!1)};const Ed=!1;let Hl=(()=>class e{static __NG_ELEMENT_ID__=bg;static __NG_ENV_ID__=n=>n})();class Up extends Hl{_lView;constructor(t){super(),this._lView=t}onDestroy(t){const n=this._lView;return Vl(n)?(t(),()=>{}):(wh(n,t),()=>function Wc(e,t){if(null===e[21])return;const n=e[21].indexOf(t);-1!==n&&e[21].splice(n,1)}(n,t))}}function bg(){return new Up(N())}class dl{}const vf=new sn("",{providedIn:"root",factory:()=>!1}),bf=new sn(""),$p=new sn("");let fl=(()=>{class e{taskId=0;pendingTasks=new Set;get _hasPendingTasks(){return this.hasPendingTasks.value}hasPendingTasks=new kn(!1);add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);const n=this.taskId++;return this.pendingTasks.add(n),n}has(n){return this.pendingTasks.has(n)}remove(n){this.pendingTasks.delete(n),0===this.pendingTasks.size&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static \u0275prov=an({token:e,providedIn:"root",factory:()=>new e})}return e})();const ao=class xf extends Ir{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(t=!1){super(),this.__isAsync=t,function P(){return void 0!==Fc()||null!=Ut()}()&&(this.destroyRef=Ot(Hl,{optional:!0})??void 0,this.pendingTasks=Ot(fl,{optional:!0})??void 0)}emit(t){const n=me(null);try{super.next(t)}finally{me(n)}}subscribe(t,n,i){let s=t,c=n||(()=>null),d=i;if(t&&"object"==typeof t){const x=t;s=x.next?.bind(x),c=x.error?.bind(x),d=x.complete?.bind(x)}this.__isAsync&&(c=this.wrapInTimeout(c),s&&(s=this.wrapInTimeout(s)),d&&(d=this.wrapInTimeout(d)));const _=super.subscribe({next:s,error:c,complete:d});return t instanceof ur&&t.add(_),_}wrapInTimeout(t){return n=>{const i=this.pendingTasks?.add();setTimeout(()=>{try{t(n)}finally{void 0!==i&&this.pendingTasks?.remove(i)}})}}};function Hp(...e){}function yy(e){let t,n;function i(){e=Hp;try{void 0!==n&&"function"==typeof cancelAnimationFrame&&cancelAnimationFrame(n),void 0!==t&&clearTimeout(t)}catch{}}return t=setTimeout(()=>{e(),i()}),"function"==typeof requestAnimationFrame&&(n=requestAnimationFrame(()=>{e(),i()})),()=>i()}function Ih(e){return queueMicrotask(()=>e()),()=>{e=Hp}}const xg="isAngularZone",Ph=xg+"_ID";let vy=0;class Cr{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new ao(!1);onMicrotaskEmpty=new ao(!1);onStable=new ao(!1);onError=new ao(!1);constructor(t){const{enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:s=!1,scheduleInRootZone:c=Ed}=t;if(typeof Zone>"u")throw new Et(908,!1);Zone.assertZonePatched();const d=this;d._nesting=0,d._outer=d._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(d._inner=d._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(d._inner=d._inner.fork(Zone.longStackTraceZoneSpec)),d.shouldCoalesceEventChangeDetection=!s&&i,d.shouldCoalesceRunChangeDetection=s,d.callbackScheduled=!1,d.scheduleInRootZone=c,function rC(e){const t=()=>{!function iC(e){function t(){yy(()=>{e.callbackScheduled=!1,xy(e),e.isCheckStableRunning=!0,by(e),e.isCheckStableRunning=!1})}e.isCheckStableRunning||e.callbackScheduled||(e.callbackScheduled=!0,e.scheduleInRootZone?Zone.root.run(()=>{t()}):e._outer.run(()=>{t()}),xy(e))}(e)},n=vy++;e._inner=e._inner.fork({name:"angular",properties:{[xg]:!0,[Ph]:n,[Ph+n]:!0},onInvokeTask:(i,s,c,d,_,x)=>{if(function oC(e){return pb(e,"__ignore_ng_zone__")}(x))return i.invokeTask(c,d,_,x);try{return db(e),i.invokeTask(c,d,_,x)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===d.type||e.shouldCoalesceRunChangeDetection)&&t(),Sd(e)}},onInvoke:(i,s,c,d,_,x,E)=>{try{return db(e),i.invoke(c,d,_,x,E)}finally{e.shouldCoalesceRunChangeDetection&&!e.callbackScheduled&&!function fb(e){return pb(e,"__scheduler_tick__")}(x)&&t(),Sd(e)}},onHasTask:(i,s,c,d)=>{i.hasTask(c,d),s===c&&("microTask"==d.change?(e._hasPendingMicrotasks=d.microTask,xy(e),by(e)):"macroTask"==d.change&&(e.hasPendingMacrotasks=d.macroTask))},onHandleError:(i,s,c,d)=>(i.handleError(c,d),e.runOutsideAngular(()=>e.onError.emit(d)),!1)})}(d)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get(xg)}static assertInAngularZone(){if(!Cr.isInAngularZone())throw new Et(909,!1)}static assertNotInAngularZone(){if(Cr.isInAngularZone())throw new Et(909,!1)}run(t,n,i){return this._inner.run(t,n,i)}runTask(t,n,i,s){const c=this._inner,d=c.scheduleEventTask("NgZoneEvent: "+s,t,hb,Hp,Hp);try{return c.runTask(d,n,i)}finally{c.cancelTask(d)}}runGuarded(t,n,i){return this._inner.runGuarded(t,n,i)}runOutsideAngular(t){return this._outer.run(t)}}const hb={};function by(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function xy(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&!0===e.callbackScheduled)}function db(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function Sd(e){e._nesting--,by(e)}class wy{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new ao;onMicrotaskEmpty=new ao;onStable=new ao;onError=new ao;run(t,n,i){return t.apply(n,i)}runGuarded(t,n,i){return t.apply(n,i)}runOutsideAngular(t){return t()}runTask(t,n,i,s){return t.apply(n,i)}}function pb(e,t){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0]?.data?.[t]}class Mc{_console=console;handleError(t){this._console.error("ERROR",t)}}const Cy=new sn("",{providedIn:"root",factory:()=>{const e=Ot(Cr),t=Ot(Mc);return n=>e.runOutsideAngular(()=>t.handleError(n))}});function _b(e,t){return Ra(e,t)}const vb=(_b.required=function yb(e){return Ra(Gs,e)},_b);function sC(){return Cf(ce(),N())}function Cf(e,t){return new Rs(ea(e,t))}let Rs=(()=>class e{nativeElement;constructor(n){this.nativeElement=n}static __NG_ELEMENT_ID__=sC})();function Ty(e){return e instanceof Rs?e.nativeElement:e}function pl(e,t){const n=function zn(e,t){const n=Object.create(pr);n.value=e,void 0!==t&&(n.equal=t);const i=()=>(K(n),n.value);return i[be]=n,i}(e,t?.equal),i=n[be];return n.set=s=>mi(i,s),n.update=s=>function ir(e,t){ot()||ln(e),mi(e,t(e.value))}(i,s),n.asReadonly=wg.bind(n),n}function wg(){const e=this[be];if(void 0===e.readonlyFn){const t=()=>this();t[be]=e,e.readonlyFn=t}return e.readonlyFn}function xb(e){return function bb(e){return"function"==typeof e&&void 0!==e[be]}(e)&&"function"==typeof e.set}function wb(){return this._results[Symbol.iterator]()}class Dy{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new Ir}constructor(t=!1){this._emitDistinctChangesOnly=t}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,n){return this._results.reduce(t,n)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,n){this.dirty=!1;const i=function no(e){return e.flat(Number.POSITIVE_INFINITY)}(t);(this._changesDetected=!function md(e,t,n){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++){let s=e[i],c=t[i];if(n&&(s=n(s),c=n(c)),c!==s)return!1}return!0}(this._results,i,n))&&(this._results=i,this.length=i.length,this.last=i[this.length-1],this.first=i[0])}notifyOnChanges(){void 0!==this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(t){this._onDirty=t}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){void 0!==this._changes&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=wb}function Ah(e){return!(128&~e.flags)}var Tg=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(Tg||{});const Dg=new Map;let aC=0;function Lo(e){Dg.delete(e[19])}const Sy="__ngContext__";function Sa(e,t){vo(t)?(e[Sy]=t[19],function lC(e){Dg.set(e[19],e)}(t)):e[Sy]=t}function Pb(e){return kb(e[12])}function Ab(e){return kb(e[4])}function kb(e){for(;null!==e&&!io(e);)e=e[4];return e}let Ly;function Ec(){if(void 0!==Ly)return Ly;if(typeof document<"u")return document;throw new Et(210,!1)}const eu=new sn("",{providedIn:"root",factory:()=>Vu}),Vu="ng",tu=new sn(""),Pg=new sn("",{providedIn:"platform",factory:()=>"unknown"}),Wp=new sn("",{providedIn:"root",factory:()=>Ec().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null}),Vy=new sn("",{providedIn:"root",factory:()=>!1});var Oh=function(e){return e[e.CHANGE_DETECTION=0]="CHANGE_DETECTION",e[e.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",e}(Oh||{});const nu=new sn(""),$b=new Set;function Ua(e){$b.has(e)||($b.add(e),performance?.mark?.("mark_feature_usage",{detail:{feature:e}}))}let nm=(()=>{class e{impl=null;execute(){this.impl?.execute()}static \u0275prov=an({token:e,providedIn:"root",factory:()=>new e})}return e})();function Yg(e,t){const n=e.contentQueries;if(null!==n){const i=me(null);try{for(let s=0;s<n.length;s+=2){const d=n[s+1];if(-1!==d){const _=e.data[d];ar(n[s]),_.contentQueries(2,t[d],d)}}}finally{me(i)}}}function Xg(e,t,n){ar(0);const i=me(null);try{t(e,n)}finally{me(i)}}function Od(e,t,n){if(cf(t)){const i=me(null);try{const c=t.directiveEnd;for(let d=t.directiveStart;d<c;d++){const _=e.data[d];_.contentQueries&&_.contentQueries(1,n[d],d)}}finally{me(i)}}}var Ga=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(Ga||{});let pm,Zf;function Gu(e){return function Kg(){if(void 0===pm&&(pm=null,On.trustedTypes))try{pm=On.trustedTypes.createPolicy("angular",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return pm}()?.createHTML(e)||e}function gm(){if(void 0===Zf&&(Zf=null,On.trustedTypes))try{Zf=On.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return Zf}function Qg(e){return gm()?.createHTML(e)||e}function l(e){return gm()?.createScriptURL(e)||e}class r{changingThisBreaksApplicationSecurity;constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${oc})`}}class a extends r{getTypeName(){return"HTML"}}class h extends r{getTypeName(){return"Style"}}class m extends r{getTypeName(){return"Script"}}class y extends r{getTypeName(){return"URL"}}class b extends r{getTypeName(){return"ResourceURL"}}function D(e){return e instanceof r?e.changingThisBreaksApplicationSecurity:e}function S(e,t){const n=function k(e){return e instanceof r&&e.getTypeName()||null}(e);if(null!=n&&n!==t){if("ResourceURL"===n&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${n} (see ${oc})`)}return n===t}class re{inertDocumentHelper;constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const n=(new window.DOMParser).parseFromString(Gu(t),"text/html").body;return null===n?this.inertDocumentHelper.getInertBodyElement(t):(n.firstChild?.remove(),n)}catch{return null}}}class ye{defaultDoc;inertDocument;constructor(t){this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(t){const n=this.inertDocument.createElement("template");return n.innerHTML=Gu(t),n}}const Ce=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function Me(e){return(e=String(e)).match(Ce)?e:"unsafe:"+e}function Ge(e){const t={};for(const n of e.split(","))t[n]=!0;return t}function Xe(...e){const t={};for(const n of e)for(const i in n)n.hasOwnProperty(i)&&(t[i]=!0);return t}const mt=Ge("area,br,col,hr,img,wbr"),Lt=Ge("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),Pt=Ge("rp,rt"),Kt=Xe(mt,Xe(Lt,Ge("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Xe(Pt,Ge("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Xe(Pt,Lt)),It=Ge("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),qn=Xe(It,Ge("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Ge("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),Dn=Ge("script,style,template");class Ii{sanitizedSomething=!1;buf=[];sanitizeChildren(t){let n=t.firstChild,i=!0,s=[];for(;n;)if(n.nodeType===Node.ELEMENT_NODE?i=this.startElement(n):n.nodeType===Node.TEXT_NODE?this.chars(n.nodeValue):this.sanitizedSomething=!0,i&&n.firstChild)s.push(n),n=Os(n);else for(;n;){n.nodeType===Node.ELEMENT_NODE&&this.endElement(n);let c=Fo(n);if(c){n=c;break}n=s.pop()}return this.buf.join("")}startElement(t){const n=gl(t).toLowerCase();if(!Kt.hasOwnProperty(n))return this.sanitizedSomething=!0,!Dn.hasOwnProperty(n);this.buf.push("<"),this.buf.push(n);const i=t.attributes;for(let s=0;s<i.length;s++){const c=i.item(s),d=c.name,_=d.toLowerCase();if(!qn.hasOwnProperty(_)){this.sanitizedSomething=!0;continue}let x=c.value;It[_]&&(x=Me(x)),this.buf.push(" ",d,'="',uo(x),'"')}return this.buf.push(">"),!0}endElement(t){const n=gl(t).toLowerCase();Kt.hasOwnProperty(n)&&!mt.hasOwnProperty(n)&&(this.buf.push("</"),this.buf.push(n),this.buf.push(">"))}chars(t){this.buf.push(uo(t))}}function Fo(e){const t=e.nextSibling;if(t&&e!==t.previousSibling)throw oa(t);return t}function Os(e){const t=e.firstChild;if(t&&function jr(e,t){return(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)!==Node.DOCUMENT_POSITION_CONTAINED_BY}(e,t))throw oa(t);return t}function gl(e){const t=e.nodeName;return"string"==typeof t?t:"FORM"}function oa(e){return new Error(`Failed to sanitize html because the element is clobbered: ${e.outerHTML}`)}const bs=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Fs=/([^\#-~ |!])/g;function uo(e){return e.replace(/&/g,"&amp;").replace(bs,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(Fs,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let No;function Ns(e,t){let n=null;try{No=No||function Q(e){const t=new ye(e);return function Ae(){try{return!!(new window.DOMParser).parseFromString(Gu(""),"text/html")}catch{return!1}}()?new re(t):t}(e);let i=t?String(t):"";n=No.getInertBodyElement(i);let s=5,c=i;do{if(0===s)throw new Error("Failed to sanitize html because the input is unstable");s--,i=c,c=n.innerHTML,n=No.getInertBodyElement(i)}while(i!==c);return Gu((new Ii).sanitizeChildren(xs(n)||n))}finally{if(n){const i=xs(n)||n;for(;i.firstChild;)i.firstChild.remove()}}}function xs(e){return"content"in e&&function Pa(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var Rr=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}(Rr||{});function zs(e){const t=Sc();return t?Qg(t.sanitize(Rr.HTML,e)||""):S(e,"HTML")?Qg(D(e)):Ns(Ec(),li(e))}function zo(e){const t=Sc();return t?t.sanitize(Rr.URL,e)||"":S(e,"URL")?D(e):Me(li(e))}function Ur(e){const t=Sc();if(t)return l(t.sanitize(Rr.RESOURCE_URL,e)||"");if(S(e,"ResourceURL"))return l(D(e));throw new Et(904,!1)}function Sc(){const e=N();return e&&e[10].sanitizer}const qf=/^>|^->|<!--|-->|--!>|<!-$/g,Wf=/(<|>)/g;function Bs(e){return e.ownerDocument}function es(e){return e instanceof Function?e():e}function sz(e,t,n){let i=e.length;for(;;){const s=e.indexOf(t,n);if(-1===s)return s;if(0===s||e.charCodeAt(s-1)<=32){const c=t.length;if(s+c===i||e.charCodeAt(s+c)<=32)return s}n=s+1}}const T2="ng-template";function az(e,t,n,i){let s=0;if(i){for(;s<t.length&&"string"==typeof t[s];s+=2)if("class"===t[s]&&-1!==sz(t[s+1].toLowerCase(),n,0))return!0}else if(LC(e))return!1;if(s=t.indexOf(1,s),s>-1){let c;for(;++s<t.length&&"string"==typeof(c=t[s]);)if(c.toLowerCase()===n)return!0}return!1}function LC(e){return 4===e.type&&e.value!==T2}function lz(e,t,n){return t===(4!==e.type||n?e.value:T2)}function cz(e,t,n){let i=4;const s=e.attrs,c=null!==s?function dz(e){for(let t=0;t<e.length;t++)if(K0(e[t]))return t;return e.length}(s):0;let d=!1;for(let _=0;_<t.length;_++){const x=t[_];if("number"!=typeof x){if(!d)if(4&i){if(i=2|1&i,""!==x&&!lz(e,x,n)||""===x&&1===t.length){if(Wu(i))return!1;d=!0}}else if(8&i){if(null===s||!az(e,s,x,n)){if(Wu(i))return!1;d=!0}}else{const E=t[++_],R=uz(x,s,LC(e),n);if(-1===R){if(Wu(i))return!1;d=!0;continue}if(""!==E){let z;if(z=R>c?"":s[R+1].toLowerCase(),2&i&&E!==z){if(Wu(i))return!1;d=!0}}}}else{if(!d&&!Wu(i)&&!Wu(x))return!1;if(d&&Wu(x))continue;d=!1,i=x|1&i}}return Wu(i)||d}function Wu(e){return!(1&e)}function uz(e,t,n,i){if(null===t)return-1;let s=0;if(i||!n){let c=!1;for(;s<t.length;){const d=t[s];if(d===e)return s;if(3===d||6===d)c=!0;else{if(1===d||2===d){let _=t[++s];for(;"string"==typeof _;)_=t[++s];continue}if(4===d)break;if(0===d){s+=4;continue}}s+=c?1:2}return-1}return function fz(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const i=e[n];if("number"==typeof i)return-1;if(i===t)return n;n++}return-1}(t,e)}function D2(e,t,n=!1){for(let i=0;i<t.length;i++)if(cz(e,t[i],n))return!0;return!1}function M2(e,t){return e?":not("+t.trim()+")":t}function mz(e){let t=e[0],n=1,i=2,s="",c=!1;for(;n<e.length;){let d=e[n];if("string"==typeof d)if(2&i){const _=e[++n];s+="["+d+(_.length>0?'="'+_+'"':"")+"]"}else 8&i?s+="."+d:4&i&&(s+=" "+d);else""!==s&&!Wu(d)&&(t+=M2(c,s),s=""),i=d,c=c||!Wu(i);n++}return""!==s&&(t+=M2(c,s)),t}const Oi={};function FC(e,t){return e.createComment(function av(e){return e.replace(qf,t=>t.replace(Wf,"\u200b$1\u200b"))}(t))}function gx(e,t,n){return e.createElement(t,n)}function _m(e,t,n,i,s){e.insertBefore(t,n,i,s)}function S2(e,t,n){e.appendChild(t,n)}function I2(e,t,n,i,s){null!==i?_m(e,t,n,i,s):S2(e,t,n)}function A2(e,t,n){const{mergedAttrs:i,classes:s,styles:c}=n;null!==i&&function X0(e,t,n){let i=0;for(;i<n.length;){const s=n[i];if("number"==typeof s){if(0!==s)break;i++;const c=n[i++],d=n[i++],_=n[i++];e.setAttribute(t,d,_,c)}else{const c=s,d=n[++i];hg(c)?e.setProperty(t,c,d):e.setAttribute(t,c,d),i++}}}(e,t,i),null!==s&&function vz(e,t,n){""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n)}(e,t,s),null!==c&&function yz(e,t,n){e.setAttribute(t,"style",n)}(e,t,c)}function NC(e,t,n,i,s,c,d,_,x,E,R){const z=26+i,V=z+s,j=function bz(e,t){const n=[];for(let i=0;i<t;i++)n.push(i<e?null:Oi);return n}(z,V),J="function"==typeof E?E():E;return j[1]={type:e,blueprint:j,template:n,queries:null,viewQuery:_,declTNode:t,data:j.slice().fill(null,z),bindingStartIndex:z,expandoStartIndex:V,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof c?c():c,pipeRegistry:"function"==typeof d?d():d,firstChild:null,schemas:x,consts:J,incompleteFirstPass:!1,ssrId:R}}function _x(e,t,n,i,s,c,d,_,x,E,R){const z=t.blueprint.slice();return z[0]=s,z[2]=1228|i,(null!==E||e&&2048&e[2])&&(z[2]|=2048),hf(z),z[3]=z[14]=e,z[8]=n,z[10]=d||e&&e[10],z[11]=_||e&&e[11],z[9]=x||e&&e[9]||null,z[5]=c,z[19]=function Db(){return aC++}(),z[6]=R,z[20]=E,z[15]=2==t.type?e[15]:z,z}function zC(e){let t=16;return e.signals?t=4096:e.onPush&&(t=64),t}function fv(e,t,n,i){if(0===n)return-1;const s=t.length;for(let c=0;c<n;c++)t.push(i),e.blueprint.push(i),e.data.push(null);return s}function BC(e,t){return e[12]?e[13][4]=t:e[12]=t,e[13]=t,t}function Xt(e=1){R2(H(),N(),Xr()+e,!1)}function R2(e,t,n,i){if(!i)if(3&~t[2]){const c=e.preOrderHooks;null!==c&&Cd(t,c,0,n)}else{const c=e.preOrderCheckHooks;null!==c&&wd(t,c,n)}Ma(n)}var yx=function(e){return e[e.None=0]="None",e[e.SignalBased=1]="SignalBased",e[e.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",e}(yx||{});function VC(e,t,n,i){const s=me(null);try{const[c,d,_]=e.inputs[n];let x=null;!!(d&yx.SignalBased)&&(x=t[c][be]),null!==x&&void 0!==x.transformFn?i=x.transformFn(i):null!==_&&(i=_.call(t,i)),null!==e.setInput?e.setInput(t,x,i,n,c):vh(t,x,c,i)}finally{me(s)}}function L2(e,t,n,i,s){const c=Xr(),d=2&i;try{Ma(-1),d&&t.length>26&&R2(e,t,26,!1),n(i,s)}finally{Ma(c)}}function vx(e,t,n){(function Sz(e,t,n){const i=n.directiveStart,s=n.directiveEnd;_a(n)&&function xz(e,t,n){const i=ea(t,e),s=function k2(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=NC(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):t}(n),c=e[10].rendererFactory,d=BC(e,_x(e,s,null,zC(n),i,t,null,c.createRenderer(i,n),null,null,null));e[t.index]=d}(t,n,e.data[i+n.componentOffset]),e.firstCreatePass||gf(n,t);const c=n.initialInputs;for(let d=i;d<s;d++){const _=e.data[d],x=_s(t,e,d,n);Sa(x,t),null!==c&&Az(0,d-i,x,_,0,c),ro(_)&&(Ki(n.index,t)[8]=_s(t,e,d,n))}})(e,t,n),!(64&~n.flags)&&function Iz(e,t,n){const i=n.directiveStart,s=n.directiveEnd,c=n.index,d=function pi(){return fi.lFrame.currentDirectiveIndex}();try{Ma(c);for(let _=i;_<s;_++){const x=e.data[_],E=t[_];br(_),(null!==x.hostBindings||0!==x.hostVars||null!==x.hostAttrs)&&Pz(x,E)}}finally{Ma(-1),br(d)}}(e,t,n)}function jC(e,t,n=ea){const i=t.localNames;if(null!==i){let s=t.index+1;for(let c=0;c<i.length;c+=2){const d=i[c+1],_=-1===d?n(t,e):e[d];e[s++]=_}}}let O2=()=>null;function Ql(e,t,n,i,s,c,d,_){if(_||!HC(t,e,n,i,s)){if(3&t.type){const x=ea(t,n);i=function Mz(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(i),s=null!=d?d(s,t.value||"",i):s,c.setProperty(x,i,s)}}else _a(t)&&function Ez(e,t){const n=Ki(t,e);16&n[2]||(n[2]|=64)}(n,t.index)}function Pz(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function UC(e,t){const n=e.directiveRegistry;let i=null;if(n)for(let s=0;s<n.length;s++){const c=n[s];D2(t,c.selectors,!1)&&(i??=[],ro(c)?i.unshift(c):i.push(c))}return i}function Uh(e,t,n,i,s,c){const d=ea(e,t);!function $C(e,t,n,i,s,c,d){if(null==c)e.removeAttribute(t,s,n);else{const _=null==d?li(c):d(c,i||"",s);e.setAttribute(t,s,_,n)}}(t[11],d,c,e.value,n,i,s)}function Az(e,t,n,i,s,c){const d=c[t];if(null!==d)for(let _=0;_<d.length;_+=2)VC(i,n,d[_],d[_+1])}function HC(e,t,n,i,s){const c=e.inputs?.[i],d=e.hostDirectiveInputs?.[i];let _=!1;if(d)for(let x=0;x<d.length;x+=2){const E=d[x];VC(t.data[E],n[E],d[x+1],s),_=!0}if(c)for(const x of c)VC(t.data[x],n[x],i,s),_=!0;return _}function kz(e,t){const n=Ki(t,e),i=n[1];!function Rz(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])}(i,n);const s=n[0];null!==s&&null===n[6]&&(n[6]=null),bx(i,n,n[8])}function bx(e,t,n){oo(t);try{const i=e.viewQuery;null!==i&&Xg(1,i,n);const s=e.template;null!==s&&L2(e,t,s,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),t[18]?.finishViewCreation(e),e.staticContentQueries&&Yg(e,t),e.staticViewQueries&&Xg(2,e.viewQuery,n);const c=e.components;null!==c&&function Lz(e,t){for(let n=0;n<t.length;n++)kz(e,t[n])}(t,c)}catch(i){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),i}finally{t[2]&=-5,Va()}}function ym(e,t){return!t||null===t.firstChild||Ah(e)}function qC(e,t){return undefined(e,t)}var Xf=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(Xf||{});function Kf(e){return!(32&~e.flags)}function n_(e,t,n,i,s){if(null!=i){let c,d=!1;io(i)?c=i:vo(i)&&(d=!0,i=i[0]);const _=gi(i);0===e&&null!==n?null==s?S2(t,n,_):_m(t,n,_,s||null,!0):1===e&&null!==n?_m(t,n,_,s||null,!0):2===e?function dv(e,t,n){e.removeChild(null,t,n)}(t,_,d):3===e&&t.destroyNode(_),null!=c&&function jz(e,t,n,i,s){const c=n[7];c!==gi(n)&&n_(t,e,i,c,s);for(let _=10;_<n.length;_++){const x=n[_];wx(x[1],x,e,t,i,c)}}(t,e,c,n,s)}}function B2(e,t){t[10].changeDetectionScheduler?.notify(9),wx(e,t,t[11],2,null,null)}function WC(e,t){const n=e[9],i=n.indexOf(t);n.splice(i,1)}function pv(e,t){if(Vl(t))return;const n=t[11];n.destroyNode&&wx(e,t,n,3,null,null),function Nz(e){let t=e[12];if(!t)return YC(e[1],e);for(;t;){let n=null;if(vo(t))n=t[12];else{const i=t[10];i&&(n=i)}if(!n){for(;t&&!t[4]&&t!==e;)vo(t)&&YC(t[1],t),t=t[3];null===t&&(t=e),vo(t)&&YC(t[1],t),n=t&&t[4]}t=n}}(t)}function YC(e,t){if(Vl(t))return;const n=me(null);try{t[2]&=-129,t[2]|=256,t[24]&&on(t[24]),function Bz(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let i=0;i<n.length;i+=2){const s=t[n[i]];if(!(s instanceof zu)){const c=n[i+1];if(Array.isArray(c))for(let d=0;d<c.length;d+=2){const _=s[c[d]],x=c[d+1];try{x.call(_)}finally{}}else try{c.call(s)}finally{}}}}(e,t),function zz(e,t){const n=e.cleanup,i=t[7];if(null!==n)for(let d=0;d<n.length-1;d+=2)if("string"==typeof n[d]){const _=n[d+3];_>=0?i[_]():i[-_].unsubscribe(),d+=2}else n[d].call(i[n[d+1]]);null!==i&&(t[7]=null);const s=t[21];if(null!==s){t[21]=null;for(let d=0;d<s.length;d++)(0,s[d])()}const c=t[23];if(null!==c){t[23]=null;for(const d of c)d.destroy()}}(e,t),1===t[1].type&&t[11].destroy();const i=t[16];if(null!==i&&io(t[3])){i!==t[3]&&WC(i,t);const s=t[18];null!==s&&s.detachView(e)}Lo(t)}finally{me(n)}}function XC(e,t,n){return function V2(e,t,n){let i=t;for(;null!==i&&168&i.type;)i=(t=i).parent;if(null===i)return n[0];if(_a(i)){const{encapsulation:s}=e.data[i.directiveStart+i.componentOffset];if(s===Ga.None||s===Ga.Emulated)return null}return ea(i,n)}(e,t.parent,n)}let $2=function U2(e,t,n){return 40&e.type?ea(e,n):null};function xx(e,t,n,i){const s=XC(e,i,t),c=t[11],_=function j2(e,t,n){return $2(e,t,n)}(i.parent||t[5],i,t);if(null!=s)if(Array.isArray(n))for(let x=0;x<n.length;x++)I2(c,s,n[x],_,!1);else I2(c,s,n,_,!1)}function vm(e,t){if(null!==t){const n=t.type;if(3&n)return ea(t,e);if(4&n)return QC(-1,e[t.index]);if(8&n){const i=t.child;if(null!==i)return vm(e,i);{const s=e[t.index];return io(s)?QC(-1,s):gi(s)}}if(128&n)return vm(e,t.next);if(32&n)return qC(t,e)()||gi(e[t.index]);{const i=H2(e,t);return null!==i?Array.isArray(i)?i[0]:vm(ta(e[15]),i):vm(e,t.next)}}return null}function H2(e,t){return null!==t?e[15][5].projection[t.projection]:null}function QC(e,t){const n=10+e+1;if(n<t.length){const i=t[n],s=i[1].firstChild;if(null!==s)return vm(i,s)}return t[7]}function JC(e,t,n,i,s,c,d){for(;null!=n;){if(128===n.type){n=n.next;continue}const _=i[n.index],x=n.type;if(d&&0===t&&(_&&Sa(gi(_),i),n.flags|=2),!Kf(n))if(8&x)JC(e,t,n.child,i,s,c,!1),n_(t,e,s,_,c);else if(32&x){const E=qC(n,i);let R;for(;R=E();)n_(t,e,s,R,c);n_(t,e,s,_,c)}else 16&x?Z2(e,t,i,n,s,c):n_(t,e,s,_,c);n=d?n.projectionNext:n.next}}function wx(e,t,n,i,s,c){JC(n,i,e.firstChild,t,s,c,!1)}function Z2(e,t,n,i,s,c){const d=n[15],x=d[5].projection[i.projection];if(Array.isArray(x))for(let E=0;E<x.length;E++)n_(t,e,s,x[E],c);else{let E=x;const R=d[3];Ah(i)&&(E.flags|=128),JC(e,t,E,R,s,c,!0)}}function i_(e,t,n,i,s=!1){for(;null!==n;){if(128===n.type){n=s?n.projectionNext:n.next;continue}const c=t[n.index];null!==c&&i.push(gi(c)),io(c)&&eT(c,i);const d=n.type;if(8&d)i_(e,t,n.child,i);else if(32&d){const _=qC(n,t);let x;for(;x=_();)i.push(x)}else if(16&d){const _=H2(t,n);if(Array.isArray(_))i.push(..._);else{const x=ta(t[15]);i_(x[1],x,_,i,!0)}}n=s?n.projectionNext:n.next}return i}function eT(e,t){for(let n=10;n<e.length;n++){const i=e[n],s=i[1].firstChild;null!==s&&i_(i[1],i,s,t)}e[7]!==e[0]&&t.push(e[7])}function q2(e){if(null!==e[25]){for(const t of e[25])t.impl.addSequence(t);e[25].length=0}}let W2=[];const Zz={...ue,consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:e=>{jl(e.lView)},consumerOnSignalRead(){this.lView[24]=this}},Wz={...ue,consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:e=>{let t=ta(e.lView);for(;t&&!Y2(t[1]);)t=ta(t);t&&ul(t)},consumerOnSignalRead(){this.lView[24]=this}};function Y2(e){return 2!==e.type}function X2(e){if(null===e[23])return;let t=!0;for(;t;){let n=!1;for(const i of e[23])i.dirty&&(n=!0,null===i.zone||Zone.current===i.zone?i.run():i.zone.run(()=>i.run()));t=n&&!!(8192&e[2])}}function Cx(e,t=!0,n=0){const s=e[10].rendererFactory;s.begin?.();try{!function Xz(e,t){const n=Qe();try{gt(!0),tT(e,t);let i=0;for(;Tc(e);){if(100===i)throw new Et(103,!1);i++,tT(e,1)}}finally{gt(n)}}(e,n)}catch(d){throw t&&function GC(e,t){const n=e[9],i=n?n.get(Mc,null):null;i&&i.handleError(t)}(e,d),d}finally{s.end?.()}}function Q2(e,t,n,i){if(Vl(t))return;const s=t[2];oo(t);let _=!0,x=null,E=null;Y2(e)?(E=function $z(e){return e[24]??function Gz(e){const t=W2.pop()??Object.create(Zz);return t.lView=e,t}(e)}(t),x=xt(E)):null===function ve(){return p}()?(_=!1,E=function qz(e){const t=e[24]??Object.create(Wz);return t.lView=e,t}(t),x=xt(E)):t[24]&&(on(t[24]),t[24]=null);try{hf(t),function _t(e){return fi.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&L2(e,t,n,2,i);const R=!(3&~s);if(R){const j=e.preOrderCheckHooks;null!==j&&wd(t,j,null)}else{const j=e.preOrderHooks;null!==j&&Cd(t,j,0,null),df(t,0)}if(function Kz(e){for(let t=Pb(e);null!==t;t=Ab(t)){if(!(2&t[2]))continue;const n=t[9];for(let i=0;i<n.length;i++)ul(n[i])}}(t),X2(t),J2(t,0),null!==e.contentQueries&&Yg(e,t),R){const j=e.contentCheckHooks;null!==j&&wd(t,j)}else{const j=e.contentHooks;null!==j&&Cd(t,j,1),df(t,1)}!function Jz(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let i=0;i<n.length;i++){const s=n[i];if(s<0)Ma(~s);else{const c=s,d=n[++i],_=n[++i];yi(d,c);const x=t[c];_(2,x)}}}finally{Ma(-1)}}(e,t);const z=e.components;null!==z&&tS(t,z,0);const V=e.viewQuery;if(null!==V&&Xg(2,V,i),R){const j=e.viewCheckHooks;null!==j&&wd(t,j)}else{const j=e.viewHooks;null!==j&&Cd(t,j,2),df(t,2)}if(!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[22]){for(const j of t[22])j();t[22]=null}q2(t),t[2]&=-73}catch(R){throw jl(t),R}finally{null!==E&&(Qt(E,x),_&&function Hz(e){e.lView[24]!==e&&(e.lView=null,W2.push(e))}(E)),Va()}}function J2(e,t){for(let n=Pb(e);null!==n;n=Ab(n))for(let i=10;i<n.length;i++)eS(n[i],t)}function Qz(e,t,n){const i=Ki(t,e);eS(i,n)}function eS(e,t){Lu(e)&&tT(e,t)}function tT(e,t){const i=e[1],s=e[2],c=e[24];let d=!!(0===t&&16&s);if(d||=!!(64&s&&0===t),d||=!!(1024&s),d||=!(!c?.dirty||!Mt(c)),d||=!1,c&&(c.dirty=!1),e[2]&=-9217,d)Q2(i,e,i.template,e[8]);else if(8192&s){X2(e),J2(e,1);const _=i.components;null!==_&&tS(e,_,1),q2(e)}}function tS(e,t,n){for(let i=0;i<t.length;i++)Qz(e,t[i],n)}function mv(e,t){const n=Qe()?64:1088;for(e[10].changeDetectionScheduler?.notify(t);e;){e[2]|=n;const i=ta(e);if(hn(e)&&!i)return e;e=i}return null}function nS(e,t,n,i){return[e,!0,0,t,null,i,null,n,null,null]}function gv(e,t){if(e.length<=10)return;const n=10+t,i=e[n];if(i){const s=i[16];null!==s&&s!==e&&WC(s,i),t>0&&(e[n-1][4]=i[4]);const c=Yo(e,10+t);!function z2(e,t){B2(e,t),t[0]=null,t[5]=null}(i[1],i);const d=c[18];null!==d&&d.detachView(c[1]),i[3]=null,i[4]=null,i[2]&=-129}return i}function rS(e,t){const n=e[9],i=t[3];(vo(i)||t[15]!==i[3][15])&&(e[2]|=2),null===n?e[9]=[t]:n.push(t)}let _v=class{_lView;_cdRefInjectingView;notifyErrorHandler;_appRef=null;_attachedToViewContainer=!1;get rootNodes(){const t=this._lView,n=t[1];return i_(n,t,n.firstChild,[])}constructor(t,n,i=!0){this._lView=t,this._cdRefInjectingView=n,this.notifyErrorHandler=i}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return Vl(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(io(t)){const n=t[8],i=n?n.indexOf(this):-1;i>-1&&(gv(t,i),Yo(n,i))}this._attachedToViewContainer=!1}pv(this._lView[1],this._lView)}onDestroy(t){wh(this._lView,t)}markForCheck(){mv(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[2]&=-129}reattach(){xh(this._lView),this._lView[2]|=128}detectChanges(){this._lView[2]|=1024,Cx(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Et(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;const t=hn(this._lView),n=this._lView[16];null!==n&&!t&&WC(n,this._lView),B2(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Et(902,!1);this._appRef=t;const n=hn(this._lView),i=this._lView[16];null!==i&&!n&&rS(i,this._lView),xh(this._lView)}},$h=(()=>class e{static __NG_ELEMENT_ID__=i3})();const t3=$h,n3=class extends t3{_declarationLView;_declarationTContainer;elementRef;constructor(t,n,i){super(),this._declarationLView=t,this._declarationTContainer=n,this.elementRef=i}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,n){return this.createEmbeddedViewImpl(t,n)}createEmbeddedViewImpl(t,n,i){const s=function t_(e,t,n,i){const s=me(null);try{const c=t.tView,x=_x(e,c,n,4096&e[2]?4096:16,null,t,null,null,i?.injector??null,i?.embeddedViewInjector??null,i?.dehydratedView??null);x[16]=e[t.index];const R=e[18];return null!==R&&(x[18]=R.createEmbeddedView(c)),bx(c,x,n),x}finally{me(s)}}(this._declarationLView,this._declarationTContainer,t,{embeddedViewInjector:n,dehydratedView:i});return new _v(s)}};function i3(){return Tx(ce(),N())}function Tx(e,t){return 4&e.type?new n3(t,e,Cf(e,t)):null}function o_(e,t,n,i,s){let c=e.data[t];if(null===c)c=function sT(e,t,n,i,s){const c=Te(),d=Le(),x=e.data[t]=function f3(e,t,n,i,s,c){let d=t?t.injectorIndex:-1,_=0;return function v(){return null!==fi.skipHydrationRootTNode}()&&(_|=128),{type:n,index:i,insertBeforeIndex:null,injectorIndex:d,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:_,providerIndexes:0,value:s,attrs:c,mergedAttrs:null,localNames:null,initialInputs:null,inputs:null,hostDirectiveInputs:null,outputs:null,hostDirectiveOutputs:null,directiveToIndex:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,d?c:c&&c.parent,n,t,i,s);return function d3(e,t,n,i){null===e.firstChild&&(e.firstChild=t),null!==n&&(i?null==n.child&&null!==t.parent&&(n.child=t):null===n.next&&(n.next=t,t.prev=n))}(e,x,c,d),x}(e,t,n,i,s),function Ft(){return fi.lFrame.inI18n}()&&(c.flags|=32);else if(64&c.type){c.type=n,c.value=i,c.attrs=s;const d=function De(){const e=fi.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();c.injectorIndex=null===d?-1:d.injectorIndex}return we(c,!0),c}let J3=class{},ES=class{};class eB{resolveComponentFactory(t){throw Error(`No component factory found for ${to(t)}.`)}}let Ax=class{static NULL=new eB};class pT{}let Gh=(()=>class e{destroyNode=null;static __NG_ELEMENT_ID__=()=>function tB(){const e=N(),n=Ki(ce().index,e);return(vo(n)?n:e)[11]}()})(),nB=(()=>{class e{static \u0275prov=an({token:e,providedIn:"root",factory:()=>null})}return e})();const gT={};class l_{injector;parentInjector;constructor(t,n){this.injector=t,this.parentInjector=n}get(t,n,i){i=Ta(i);const s=this.injector.get(t,gT,i);return s!==gT||n===gT?s:this.parentInjector.get(t,n,i)}}function _T(e,t,n){let i=n?e.styles:null,s=n?e.classes:null,c=0;if(null!==t)for(let d=0;d<t.length;d++){const _=t[d];"number"==typeof _?c=_:1==c?s=Il(s,_):2==c&&(i=Il(i,_+": "+t[++d]+";"))}n?e.styles=i:e.stylesWithoutHost=i,n?e.classes=s:e.classesWithoutHost=s}function rn(e,t=ci.Default){const n=N();return null===n?Jn(e,t):gg(ce(),n,ti(e),t)}function yT(e,t,n,i,s){const c=null===i?null:{"":-1},d=s(e,n);if(null!==d){let _,x=null,E=null;const R=function lB(e){let t=null,n=!1;for(let d=0;d<e.length;d++){const _=e[d];if(0===d&&ro(_)&&(t=_),null!==_.findHostDirectiveDefs){n=!0;break}}if(!n)return null;let i=null,s=null,c=null;for(const d of e)null!==d.findHostDirectiveDefs&&(i??=[],s??=new Map,c??=new Map,cB(d,i,c,s)),d===t&&(i??=[],i.push(d));return null!==i?(i.push(...null===t?e:e.slice(1)),[i,s,c]):null}(d);null===R?_=d:[_,x,E]=R,function hB(e,t,n,i,s,c,d){const _=i.length;let x=!1;for(let V=0;V<_;V++){const j=i[V];!x&&ro(j)&&(x=!0,uB(e,n,V)),dy(gf(n,t),e,j.type)}!function _B(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}(n,e.data.length,_);for(let V=0;V<_;V++){const j=i[V];j.providersResolver&&j.providersResolver(j)}let E=!1,R=!1,z=fv(e,t,_,null);_>0&&(n.directiveToIndex=new Map);for(let V=0;V<_;V++){const j=i[V];if(n.mergedAttrs=ff(n.mergedAttrs,j.hostAttrs),fB(e,n,t,z,j),gB(z,j,s),null!==d&&d.has(j)){const[se,le]=d.get(j);n.directiveToIndex.set(j.type,[z,se+n.directiveStart,le+n.directiveStart])}else(null===c||!c.has(j))&&n.directiveToIndex.set(j.type,z);null!==j.contentQueries&&(n.flags|=4),(null!==j.hostBindings||null!==j.hostAttrs||0!==j.hostVars)&&(n.flags|=64);const J=j.type.prototype;!E&&(J.ngOnChanges||J.ngOnInit||J.ngDoCheck)&&((e.preOrderHooks??=[]).push(n.index),E=!0),!R&&(J.ngOnChanges||J.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(n.index),R=!0),z++}!function dB(e,t,n){for(let i=t.directiveStart;i<t.directiveEnd;i++){const s=e.data[i];if(null!==n&&n.has(s)){const c=n.get(s);PS(0,t,c,i),PS(1,t,c,i),kS(t,i,!0)}else IS(0,t,s,i),IS(1,t,s,i),kS(t,i,!1)}}(e,n,c)}(e,t,n,_,c,x,E)}null!==c&&null!==i&&function aB(e,t,n){const i=e.localNames=[];for(let s=0;s<t.length;s+=2){const c=n[t[s+1]];if(null==c)throw new Et(-301,!1);i.push(t[s],c)}}(n,i,c)}function cB(e,t,n,i){const s=t.length;e.findHostDirectiveDefs(e,t,i),n.set(e,[s,t.length-1])}function uB(e,t,n){t.componentOffset=n,(e.components??=[]).push(t.index)}function IS(e,t,n,i){const s=0===e?n.inputs:n.outputs;for(const c in s)if(s.hasOwnProperty(c)){let d;d=0===e?t.inputs??={}:t.outputs??={},d[c]??=[],d[c].push(i),AS(t,c)}}function PS(e,t,n,i){const s=0===e?n.inputs:n.outputs;for(const c in s)if(s.hasOwnProperty(c)){const d=s[c];let _;_=0===e?t.hostDirectiveInputs??={}:t.hostDirectiveOutputs??={},_[d]??=[],_[d].push(i,c),AS(t,d)}}function AS(e,t){"class"===t?e.flags|=8:"style"===t&&(e.flags|=16)}function kS(e,t,n){const{attrs:i,inputs:s,hostDirectiveInputs:c}=e;if(null===i||!n&&null===s||n&&null===c||LC(e))return e.initialInputs??=[],void e.initialInputs.push(null);let d=null,_=0;for(;_<i.length;){const x=i[_];if(0!==x)if(5!==x){if("number"==typeof x)break;if(!n&&s.hasOwnProperty(x)){const E=s[x];for(const R of E)if(R===t){d??=[],d.push(x,i[_+1]);break}}else if(n&&c.hasOwnProperty(x)){const E=c[x];for(let R=0;R<E.length;R+=2)if(E[R]===t){d??=[],d.push(E[R+1],i[_+1]);break}}_+=2}else _+=2;else _+=4}e.initialInputs??=[],e.initialInputs.push(d)}function fB(e,t,n,i,s){e.data[i]=s;const c=s.factory||(s.factory=Po(s.type)),d=new zu(c,ro(s),rn);e.blueprint[i]=d,n[i]=d,function pB(e,t,n,i,s){const c=s.hostBindings;if(c){let d=e.hostBindingOpCodes;null===d&&(d=e.hostBindingOpCodes=[]);const _=~t.index;(function mB(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(d)!=_&&d.push(_),d.push(n,i,c)}}(e,t,i,fv(e,n,s.hostVars,Oi),s)}function gB(e,t,n){if(n){if(t.exportAs)for(let i=0;i<t.exportAs.length;i++)n[t.exportAs[i]]=e;ro(t)&&(n[""]=e)}}function RS(e,t,n,i,s,c,d,_){const x=t.consts,R=o_(t,e,2,i,va(x,d));return c&&yT(t,n,R,va(x,_),s),R.mergedAttrs=ff(R.mergedAttrs,R.attrs),null!==R.attrs&&_T(R,R.attrs,!1),null!==R.mergedAttrs&&_T(R,R.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,R),R}function LS(e,t){$l(e,t),cf(t)&&e.queries.elementEnd(t)}class OS extends Ax{ngModule;constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=wi(t);return new Ev(n,this.ngModule)}}class Ev extends ES{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;cachedInputs=null;cachedOutputs=null;get inputs(){return this.cachedInputs??=function yB(e){return Object.keys(e).map(t=>{const[n,i,s]=e[t],c={propName:n,templateName:t,isSignal:!!(i&yx.SignalBased)};return s&&(c.transform=s),c})}(this.componentDef.inputs),this.cachedInputs}get outputs(){return this.cachedOutputs??=function vB(e){return Object.keys(e).map(t=>({propName:e[t],templateName:t}))}(this.componentDef.outputs),this.cachedOutputs}constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function gz(e){return e.map(mz).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors??[],this.isBoundToModule=!!n}create(t,n,i,s){const c=me(null);try{const d=this.componentDef,_=i?["ng-version","19.2.15"]:function _z(e){const t=[],n=[];let i=1,s=2;for(;i<e.length;){let c=e[i];if("string"==typeof c)2===s?""!==c&&t.push(c,e[++i]):8===s&&n.push(c);else{if(!Wu(s))break;s=c}i++}return n.length&&t.push(1,...n),t}(this.componentDef.selectors[0]),x=NC(0,null,null,1,0,null,null,null,null,[_],null),E=function bB(e,t,n){let i=t instanceof ps?t:t?.injector;return i&&null!==e.getStandaloneInjector&&(i=e.getStandaloneInjector(i)||i),i?new l_(n,i):n}(d,s||this.ngModule,t),R=function xB(e){const t=e.get(pT,null);if(null===t)throw new Et(407,!1);return{rendererFactory:t,sanitizer:e.get(nB,null),changeDetectionScheduler:e.get(dl,null)}}(E),z=R.rendererFactory.createRenderer(null,d),V=i?function wz(e,t,n,i){const c=i.get(Vy,!1)||n===Ga.ShadowDom,d=e.selectRootElement(t,c);return function Cz(e){O2(e)}(d),d}(z,i,d.encapsulation,E):function wB(e,t){const n=(e.selectors[0][0]||"div").toLowerCase();return gx(t,n,"svg"===n?"svg":"math"===n?"math":null)}(d,z),j=_x(null,x,null,512|zC(d),null,null,R,z,E,null,null);j[26]=V,oo(j);let J=null;try{const se=RS(26,x,j,"#host",()=>[this.componentDef],!0,0);V&&(A2(z,V,se),Sa(V,j)),vx(x,j,se),Od(x,se,j),LS(x,se),void 0!==n&&function TB(e,t,n){const i=e.projection=[];for(let s=0;s<t.length;s++){const c=n[s];i.push(null!=c&&c.length?Array.from(c):null)}}(se,this.ngContentSelectors,n),J=Ki(se.index,j),j[8]=J[8],bx(x,j,null)}catch(se){throw null!==J&&Lo(J),Lo(j),se}finally{Va()}return new CB(this.componentType,j)}finally{me(c)}}}class CB extends J3{_rootLView;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(t,n){super(),this._rootLView=n,this._tNode=Ru(n[1],26),this.location=Cf(this._tNode,n),this.instance=Ki(this._tNode.index,n)[8],this.hostView=this.changeDetectorRef=new _v(n,void 0,!1),this.componentType=t}setInput(t,n){const i=this._tNode;if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),n))return;const s=this._rootLView;HC(i,s[1],s,t,n),this.previousInputValues.set(t,n),mv(Ki(i.index,s),1)}get injector(){return new ko(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}let Yu=(()=>class e{static __NG_ELEMENT_ID__=DB})();function DB(){return zS(ce(),N())}const MB=Yu,FS=class extends MB{_lContainer;_hostTNode;_hostLView;constructor(t,n,i){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=i}get element(){return Cf(this._hostTNode,this._hostLView)}get injector(){return new ko(this._hostTNode,this._hostLView)}get parentInjector(){const t=mg(this._hostTNode,this._hostLView);if(fg(t)){const n=zp(t,this._hostLView),i=pf(t);return new ko(n[1].data[i+8],n)}return new ko(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const n=NS(this._lContainer);return null!==n&&n[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,n,i){let s,c;"number"==typeof i?s=i:null!=i&&(s=i.index,c=i.injector);const _=t.createEmbeddedViewImpl(n||{},c,null);return this.insertImpl(_,s,ym(this._hostTNode,null)),_}createComponent(t,n,i,s,c){const d=t&&!function wn(e){return"function"==typeof e}(t);let _;if(d)_=n;else{const J=n||{};_=J.index,i=J.injector,s=J.projectableNodes,c=J.environmentInjector||J.ngModuleRef}const x=d?t:new Ev(wi(t)),E=i||this.parentInjector;if(!c&&null==x.ngModule){const se=(d?E:this.parentInjector).get(ps,null);se&&(c=se)}wi(x.componentType??{});const j=x.create(E,s,null,c);return this.insertImpl(j.hostView,_,ym(this._hostTNode,null)),j}insert(t,n){return this.insertImpl(t,n,!0)}insertImpl(t,n,i){const s=t._lView;if(function bd(e){return io(e[3])}(s)){const _=this.indexOf(t);if(-1!==_)this.detach(_);else{const x=s[3],E=new FS(x,x[5],x[3]);E.detach(E.indexOf(t))}}const c=this._adjustIndex(n),d=this._lContainer;return function r_(e,t,n,i=!0){const s=t[1];if(function e3(e,t,n,i){const s=10+i,c=n.length;i>0&&(n[s-1][4]=t),i<c-10?(t[4]=n[s],Es(n,10+i,t)):(n.push(t),t[4]=null),t[3]=n;const d=t[16];null!==d&&n!==d&&rS(d,t);const _=t[18];null!==_&&_.insertView(e),xh(t),t[2]|=128}(s,t,e,n),i){const d=QC(n,e),_=t[11],x=_.parentNode(e[7]);null!==x&&function Fz(e,t,n,i,s,c){i[0]=s,i[5]=t,wx(e,i,n,1,s,c)}(s,e[5],_,t,x,d)}const c=t[6];null!==c&&null!==c.firstChild&&(c.firstChild=null)}(d,s,c,i),t.attachToViewContainerRef(),Es(vT(d),c,t),t}move(t,n){return this.insert(t,n)}indexOf(t){const n=NS(this._lContainer);return null!==n?n.indexOf(t):-1}remove(t){const n=this._adjustIndex(t,-1),i=gv(this._lContainer,n);i&&(Yo(vT(this._lContainer),n),pv(i[1],i))}detach(t){const n=this._adjustIndex(t,-1),i=gv(this._lContainer,n);return i&&null!=Yo(vT(this._lContainer),n)?new _v(i):null}_adjustIndex(t,n=0){return t??this.length+n}};function NS(e){return e[8]}function vT(e){return e[8]||(e[8]=[])}function zS(e,t){let n;const i=t[e.index];return io(i)?n=i:(n=nS(i,t,null,e),t[e.index]=n,BC(t,n)),BS(n,t,e,i),new FS(n,e,t)}let BS=function jS(e,t,n,i){if(e[7])return;let s;s=8&n.type?gi(i):function EB(e,t){const n=e[11],i=n.createComment(""),s=ea(t,e),c=n.parentNode(s);return _m(n,c,i,n.nextSibling(s),!1),i}(t,n),e[7]=s};class xT{queryList;matches=null;constructor(t){this.queryList=t}clone(){return new xT(this.queryList)}setDirty(){this.queryList.setDirty()}}class wT{queries;constructor(t=[]){this.queries=t}createEmbeddedView(t){const n=t.queries;if(null!==n){const i=null!==t.contentQueries?t.contentQueries[0]:n.length,s=[];for(let c=0;c<i;c++){const d=n.getByIndex(c);s.push(this.queries[d.indexInDeclarationView].clone())}return new wT(s)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}finishViewCreation(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let n=0;n<this.queries.length;n++)null!==ET(t,n).matches&&this.queries[n].setDirty()}}class US{flags;read;predicate;constructor(t,n,i=null){this.flags=n,this.read=i,this.predicate="string"==typeof t?function OB(e){return e.split(",").map(t=>t.trim())}(t):t}}class CT{queries;constructor(t=[]){this.queries=t}elementStart(t,n){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(t,n)}elementEnd(t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(t)}embeddedTView(t){let n=null;for(let i=0;i<this.length;i++){const s=null!==n?n.length:0,c=this.getByIndex(i).embeddedTView(t,s);c&&(c.indexInDeclarationView=i,null!==n?n.push(c):n=[c])}return null!==n?new CT(n):null}template(t,n){for(let i=0;i<this.queries.length;i++)this.queries[i].template(t,n)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class TT{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(t,n=-1){this.metadata=t,this._declarationNodeIndex=n}elementStart(t,n){this.isApplyingToNode(n)&&this.matchTNode(t,n)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,n){this.elementStart(t,n)}embeddedTView(t,n){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,n),new TT(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1&~this.metadata.flags){const n=this._declarationNodeIndex;let i=t.parent;for(;null!==i&&8&i.type&&i.index!==n;)i=i.parent;return n===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(t,n){const i=this.metadata.predicate;if(Array.isArray(i))for(let s=0;s<i.length;s++){const c=i[s];this.matchTNodeWithReadOption(t,n,AB(n,c)),this.matchTNodeWithReadOption(t,n,Sh(n,t,c,!1,!1))}else i===$h?4&n.type&&this.matchTNodeWithReadOption(t,n,-1):this.matchTNodeWithReadOption(t,n,Sh(n,t,i,!1,!1))}matchTNodeWithReadOption(t,n,i){if(null!==i){const s=this.metadata.read;if(null!==s)if(s===Rs||s===Yu||s===$h&&4&n.type)this.addMatch(n.index,-2);else{const c=Sh(n,t,s,!1,!1);null!==c&&this.addMatch(n.index,c)}else this.addMatch(n.index,i)}}addMatch(t,n){null===this.matches?this.matches=[t,n]:this.matches.push(t,n)}}function AB(e,t){const n=e.localNames;if(null!==n)for(let i=0;i<n.length;i+=2)if(n[i]===t)return n[i+1];return null}function RB(e,t,n,i){return-1===n?function kB(e,t){return 11&e.type?Cf(e,t):4&e.type?Tx(e,t):null}(t,e):-2===n?function LB(e,t,n){return n===Rs?Cf(t,e):n===$h?Tx(t,e):n===Yu?zS(t,e):void 0}(e,t,i):_s(e,e[1],n,t)}function $S(e,t,n,i){const s=t[18].queries[i];if(null===s.matches){const c=e.data,d=n.matches,_=[];for(let x=0;null!==d&&x<d.length;x+=2){const E=d[x];_.push(E<0?null:RB(t,c[E],d[x+1],n.metadata.read))}s.matches=_}return s.matches}function DT(e,t,n,i){const s=e.queries.getByIndex(n),c=s.matches;if(null!==c){const d=$S(e,t,s,n);for(let _=0;_<c.length;_+=2){const x=c[_];if(x>0)i.push(d[_/2]);else{const E=c[_+1],R=t[-x];for(let z=10;z<R.length;z++){const V=R[z];V[16]===V[3]&&DT(V[1],V,E,i)}if(null!==R[9]){const z=R[9];for(let V=0;V<z.length;V++){const j=z[V];DT(j[1],j,E,i)}}}}}return i}function HS(e,t,n){const i=H();return i.firstCreatePass&&(function qS(e,t,n){null===e.queries&&(e.queries=new CT),e.queries.track(new TT(t,n))}(i,new US(e,t,n),-1),!(2&~t)&&(i.staticViewQueries=!0)),function GS(e,t,n){const i=new Dy(!(4&~n));return function Fu(e,t,n,i){const s=xd(t);s.push(n),e.firstCreatePass&&Ch(e).push(i,s.length-1)}(e,t,i,i.destroy),(t[18]??=new wT).queries.push(new xT(i))-1}(i,N(),t)}function ET(e,t){return e.queries.getByIndex(t)}function WS(e,t){const n=e[1],i=ET(n,t);return i.crossesNgTemplate?DT(n,e,t,[]):$S(n,e,i,t)}let wm=class{},oI=class{};class PT extends wm{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new OS(this);constructor(t,n,i,s=!0){super(),this.ngModuleType=t,this._parent=n;const c=Ss(t);this._bootstrapComponents=es(c.bootstrap),this._r3Injector=ub(t,n,[{provide:wm,useValue:this},{provide:Ax,useValue:this.componentFactoryResolver},...i],to(t),new Set(["environment"])),s&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class AT extends oI{moduleType;constructor(t){super(),this.moduleType=t}create(t){return new PT(this.moduleType,t,[])}}class sI extends wm{injector;componentFactoryResolver=new OS(this);instance=null;constructor(t){super();const n=new Nl([...t.providers,{provide:wm,useValue:this},{provide:Ax,useValue:this.componentFactoryResolver}],t.parent||Fl(),t.debugName,new Set(["environment"]));this.injector=n,t.runEnvironmentInitializers&&n.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function kT(e,t,n=null){return new sI({providers:e,parent:t,debugName:n,runEnvironmentInitializers:!0}).injector}let WB=(()=>{class e{_injector;cachedInjectors=new Map;constructor(n){this._injector=n}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n)){const i=fs(0,n.type),s=i.length>0?kT([i],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n,s)}return this.cachedInjectors.get(n)}ngOnDestroy(){try{for(const n of this.cachedInjectors.values())null!==n&&n.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=an({token:e,providedIn:"environment",factory:()=>new e(Jn(ps))})}return e})();function _l(e){return ua(()=>{const t=aI(e),n={...t,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===Tg.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&e.dependencies||null,getStandaloneInjector:t.standalone?s=>s.get(WB).getOrCreateStandaloneInjector(n):null,getExternalStyles:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||Ga.Emulated,styles:e.styles||Ln,_:null,schemas:e.schemas||null,tView:null,id:""};t.standalone&&Ua("NgStandalone"),lI(n);const i=e.dependencies;return n.directiveDefs=Rx(i,!1),n.pipeDefs=Rx(i,!0),n.id=function e5(e){let t=0;const i=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,"function"==typeof e.consts?"":e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery];for(const c of i.join("|"))t=Math.imul(31,t)+c.charCodeAt(0)|0;return t+=2147483648,"c"+t}(n),n})}function YB(e){return wi(e)||function yo(e){return e[zr]||null}(e)}function XB(e){return null!==e}function Iv(e){return ua(()=>({type:e.type,bootstrap:e.bootstrap||Ln,declarations:e.declarations||Ln,imports:e.imports||Ln,exports:e.exports||Ln,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function KB(e,t){if(null==e)return Xs;const n={};for(const i in e)if(e.hasOwnProperty(i)){const s=e[i];let c,d,_,x;Array.isArray(s)?(_=s[0],c=s[1],d=s[2]??c,x=s[3]||null):(c=s,d=s,_=yx.None,x=null),n[c]=[i,_,x],t[c]=d}return n}function QB(e){if(null==e)return Xs;const t={};for(const n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}function Di(e){return ua(()=>{const t=aI(e);return lI(t),t})}function aI(e){const t={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputConfig:e.inputs||Xs,exportAs:e.exportAs||null,standalone:e.standalone??!0,signals:!0===e.signals,selectors:e.selectors||Ln,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:KB(e.inputs,t),outputs:QB(e.outputs),debugInfo:null}}function lI(e){e.features?.forEach(t=>t(e))}function Rx(e,t){if(!e)return null;const n=t?Pr:YB;return()=>("function"==typeof e?e():e).map(i=>n(i)).filter(XB)}function $r(e){let t=function cI(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),n=!0;const i=[e];for(;t;){let s;if(ro(e))s=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Et(903,!1);s=t.\u0275dir}if(s){if(n){i.push(s);const d=e;d.inputs=RT(e.inputs),d.declaredInputs=RT(e.declaredInputs),d.outputs=RT(e.outputs);const _=s.hostBindings;_&&o5(e,_);const x=s.viewQuery,E=s.contentQueries;if(x&&i5(e,x),E&&r5(e,E),t5(e,s),Hs(e.outputs,s.outputs),ro(s)&&s.data.animation){const R=e.data;R.animation=(R.animation||[]).concat(s.data.animation)}}const c=s.features;if(c)for(let d=0;d<c.length;d++){const _=c[d];_&&_.ngInherit&&_(e),_===$r&&(n=!1)}}t=Object.getPrototypeOf(t)}!function n5(e){let t=0,n=null;for(let i=e.length-1;i>=0;i--){const s=e[i];s.hostVars=t+=s.hostVars,s.hostAttrs=ff(s.hostAttrs,n=ff(n,s.hostAttrs))}}(i)}function t5(e,t){for(const n in t.inputs){if(!t.inputs.hasOwnProperty(n)||e.inputs.hasOwnProperty(n))continue;const i=t.inputs[n];void 0!==i&&(e.inputs[n]=i,e.declaredInputs[n]=t.declaredInputs[n])}}function RT(e){return e===Xs?{}:e===Ln?[]:e}function i5(e,t){const n=e.viewQuery;e.viewQuery=n?(i,s)=>{t(i,s),n(i,s)}:t}function r5(e,t){const n=e.contentQueries;e.contentQueries=n?(i,s,c)=>{t(i,s,c),n(i,s,c)}:t}function o5(e,t){const n=e.hostBindings;e.hostBindings=n?(i,s)=>{t(i,s),n(i,s)}:t}function Lx(e){return!!function OT(e){return null!==e&&("function"==typeof e||"object"==typeof e)}(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}function ts(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function Cm(e,t,n,i){const s=ts(e,t,n);return ts(e,t+1,i)||s}function ws(e,t,n,i,s,c,d,_){const x=N(),E=H();return function Av(e,t,n,i,s,c,d,_,x,E){const R=n+26,z=t.firstCreatePass?function p5(e,t,n,i,s,c,d,_,x){const E=t.consts,R=o_(t,e,4,d||null,_||null);g()&&yT(t,n,R,va(E,x),UC),R.mergedAttrs=ff(R.mergedAttrs,R.attrs),$l(t,R);const z=R.tView=NC(2,R,i,s,c,t.directiveRegistry,t.pipeRegistry,null,t.schemas,E,null);return null!==t.queries&&(t.queries.template(t,R),z.queries=t.queries.embeddedTView(R)),R}(R,t,e,i,s,c,d,_,x):t.data[R];we(z,!1);const V=pI(t,e,z,n);Mr()&&xx(t,e,V,z),Sa(V,e);const j=nS(V,e,V,z);return e[R]=j,BC(e,j),qc(z)&&vx(t,e,z),null!=x&&jC(e,z,E),z}(x,E,e,t,n,i,s,va(E.consts,c),d,_),ws}let pI=function mI(e,t,n,i){return wr(!0),t[11].createComment("")};let zT=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}static \u0275fac=function(i){return new(i||e)};static \u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const SI=new sn("");let II=(()=>{class e{static \u0275prov=an({token:e,providedIn:"root",factory:()=>new f4})}return e})();class f4{queuedEffectCount=0;queues=new Map;schedule(t){this.enqueue(t)}remove(t){const i=this.queues.get(t.zone);i.has(t)&&(i.delete(t),this.queuedEffectCount--)}enqueue(t){const n=t.zone;this.queues.has(n)||this.queues.set(n,new Set);const i=this.queues.get(n);i.has(t)||(this.queuedEffectCount++,i.add(t))}flush(){for(;this.queuedEffectCount>0;)for(const[t,n]of this.queues)null===t?this.flushQueue(n):t.run(()=>this.flushQueue(n))}flushQueue(t){for(const n of t)t.delete(n),this.queuedEffectCount--,n.run()}}function Rv(e){return!!e&&"function"==typeof e.then}function PI(e){return!!e&&"function"==typeof e.subscribe}const AI=new sn("");let kI=(()=>{class e{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((n,i)=>{this.resolve=n,this.reject=i});appInits=Ot(AI,{optional:!0})??[];injector=Ot(ys);constructor(){}runInitializers(){if(this.initialized)return;const n=[];for(const s of this.appInits){const c=C(this.injector,s);if(Rv(c))n.push(c);else if(PI(c)){const d=new Promise((_,x)=>{c.subscribe({complete:_,error:x})});n.push(d)}}const i=()=>{this.done=!0,this.resolve()};Promise.all(n).then(()=>{i()}).catch(s=>{this.reject(s)}),0===n.length&&i(),this.initialized=!0}static \u0275fac=function(i){return new(i||e)};static \u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Lv=new sn("");let ec=(()=>{class e{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=Ot(Cy);afterRenderManager=Ot(nm);zonelessEnabled=Ot(vf);rootEffectScheduler=Ot(II);dirtyFlags=0;tracingSnapshot=null;externalTestViews=new Set;afterTick=new Ir;get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];isStable=Ot(fl).hasPendingTasks.pipe(Si(n=>!n));constructor(){Ot(nu,{optional:!0})}whenStable(){let n;return new Promise(i=>{n=this.isStable.subscribe({next:s=>{s&&i()}})}).finally(()=>{n.unsubscribe()})}_injector=Ot(ps);_rendererFactory=null;get injector(){return this._injector}bootstrap(n,i){return this.bootstrapImpl(n,i)}bootstrapImpl(n,i,s=ys.NULL){const c=n instanceof ES;if(!this._injector.get(kI).done)throw new Et(405,"");let _;_=c?n:this._injector.get(Ax).resolveComponentFactory(n),this.componentTypes.push(_.componentType);const x=function p4(e){return e.isBoundToModule}(_)?void 0:this._injector.get(wm),R=_.create(s,[],i||_.selector,x),z=R.location.nativeElement,V=R.injector.get(SI,null);return V?.registerApplication(z),R.onDestroy(()=>{this.detachView(R.hostView),Vx(this.components,R),V?.unregisterApplication(z)}),this._loadComponent(R),R}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick(){null!==this.tracingSnapshot?this.tracingSnapshot.run(Oh.CHANGE_DETECTION,this.tickImpl):this.tickImpl()}tickImpl=()=>{if(this._runningTick)throw new Et(101,!1);const n=me(null);try{this._runningTick=!0,this.synchronize()}catch(i){this.internalErrorHandler(i)}finally{this._runningTick=!1,this.tracingSnapshot?.dispose(),this.tracingSnapshot=null,me(n),this.afterTick.next()}};synchronize(){null===this._rendererFactory&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(pT,null,{optional:!0}));let n=0;for(;0!==this.dirtyFlags&&n++<10;)this.synchronizeOnce()}synchronizeOnce(){if(16&this.dirtyFlags&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush()),7&this.dirtyFlags){const n=!!(1&this.dirtyFlags);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:i,notifyErrorHandler:s}of this.allViews)g4(i,s,n,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),23&this.dirtyFlags)return}else this._rendererFactory?.begin?.(),this._rendererFactory?.end?.();8&this.dirtyFlags&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){this.allViews.some(({_lView:n})=>Tc(n))?this.dirtyFlags|=2:this.dirtyFlags&=-8}attachView(n){const i=n;this._views.push(i),i.attachToAppRef(this)}detachView(n){const i=n;Vx(this._views,i),i.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n),this._injector.get(Lv,[]).forEach(s=>s(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>Vx(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new Et(406,!1);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(i){return new(i||e)};static \u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function Vx(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}function g4(e,t,n,i){(n||Tc(e))&&Cx(e,t,n&&!i?0:1)}function Xu(e,t,n,i){const s=N();return ts(s,Ht(),t)&&(H(),Uh(zi(),s,e,t,n,i)),Xu}function p_(e,t,n,i,s,c){const _=Cm(e,function ft(){return fi.lFrame.bindingIndex}(),n,s);return $t(2),_?t+li(n)+i+li(s)+c:Oi}function jx(e,t){return e<<17|t<<2}function Dm(e){return e>>17&32767}function YT(e){return 2|e}function x_(e){return(131068&e)>>2}function XT(e,t){return-131069&e|t<<2}function KT(e){return 1|e}function QI(e,t,n,i){const s=e[n+1],c=null===t;let d=i?Dm(s):x_(s),_=!1;for(;0!==d&&(!1===_||c);){const E=e[d+1];nV(e[d],t)&&(_=!0,e[d+1]=i?KT(E):YT(E)),d=i?Dm(E):x_(E)}_&&(e[n+1]=i?YT(s):KT(s))}function nV(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&Xo(e,t)>=0}const sa={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function JI(e){return e.substring(sa.key,sa.keyEnd)}function eP(e,t){const n=sa.textEnd;return n===t?-1:(t=sa.keyEnd=function sV(e,t,n){for(;t<n&&e.charCodeAt(t)>32;)t++;return t}(e,sa.key=t,n),w_(e,t,n))}function w_(e,t,n){for(;t<n&&e.charCodeAt(t)<=32;)t++;return t}function Mi(e,t,n){const i=N();return ts(i,Ht(),t)&&Ql(H(),zi(),i,e,t,i[11],n,!1),Mi}function QT(e,t,n,i,s){HC(t,e,n,s?"class":"style",i)}function JT(e,t,n){return Ku(e,t,n,!1),JT}function Tr(e,t){return Ku(e,t,null,!0),Tr}function qh(e,t){for(let n=function rV(e){return function nP(e){sa.key=0,sa.keyEnd=0,sa.value=0,sa.valueEnd=0,sa.textEnd=e.length}(e),eP(e,w_(e,0,sa.textEnd))}(t);n>=0;n=eP(t,n))Ho(e,JI(t),!0)}function Ku(e,t,n,i){const s=N(),c=H(),d=$t(2);c.firstUpdatePass&&sP(c,e,d,i),t!==Oi&&ts(s,d,t)&&lP(c,c.data[Xr()],s,s[11],e,s[d+1]=function yV(e,t){return null==e||""===e||("string"==typeof t?e+=t:"object"==typeof e&&(e=to(D(e)))),e}(t,n),i,d)}function oP(e,t){return t>=e.expandoStartIndex}function sP(e,t,n,i){const s=e.data;if(null===s[n+1]){const c=s[Xr()],d=oP(e,n);uP(c,i)&&null===t&&!d&&(t=!1),t=function hV(e,t,n,i){const s=function xr(e){const t=fi.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let c=i?t.residualClasses:t.residualStyles;if(null===s)0===(i?t.classBindings:t.styleBindings)&&(n=Fv(n=eD(null,e,t,n,i),t.attrs,i),c=null);else{const d=t.directiveStylingLast;if(-1===d||e[d]!==s)if(n=eD(s,e,t,n,i),null===c){let x=function dV(e,t,n){const i=n?t.classBindings:t.styleBindings;if(0!==x_(i))return e[Dm(i)]}(e,t,i);void 0!==x&&Array.isArray(x)&&(x=eD(null,e,t,x[1],i),x=Fv(x,t.attrs,i),function fV(e,t,n,i){e[Dm(n?t.classBindings:t.styleBindings)]=i}(e,t,i,x))}else c=function pV(e,t,n){let i;const s=t.directiveEnd;for(let c=1+t.directiveStylingLast;c<s;c++)i=Fv(i,e[c].hostAttrs,n);return Fv(i,t.attrs,n)}(e,t,i)}return void 0!==c&&(i?t.residualClasses=c:t.residualStyles=c),n}(s,c,t,i),function eV(e,t,n,i,s,c){let d=c?t.classBindings:t.styleBindings,_=Dm(d),x=x_(d);e[i]=n;let R,E=!1;if(Array.isArray(n)?(R=n[1],(null===R||Xo(n,R)>0)&&(E=!0)):R=n,s)if(0!==x){const V=Dm(e[_+1]);e[i+1]=jx(V,_),0!==V&&(e[V+1]=XT(e[V+1],i)),e[_+1]=function Q4(e,t){return 131071&e|t<<17}(e[_+1],i)}else e[i+1]=jx(_,0),0!==_&&(e[_+1]=XT(e[_+1],i)),_=i;else e[i+1]=jx(x,0),0===_?_=i:e[x+1]=XT(e[x+1],i),x=i;E&&(e[i+1]=YT(e[i+1])),QI(e,R,i,!0),QI(e,R,i,!1),function tV(e,t,n,i,s){const c=s?e.residualClasses:e.residualStyles;null!=c&&"string"==typeof t&&Xo(c,t)>=0&&(n[i+1]=KT(n[i+1]))}(t,R,e,i,c),d=jx(_,x),c?t.classBindings=d:t.styleBindings=d}(s,c,t,n,d,i)}}function eD(e,t,n,i,s){let c=null;const d=n.directiveEnd;let _=n.directiveStylingLast;for(-1===_?_=n.directiveStart:_++;_<d&&(c=t[_],i=Fv(i,c.hostAttrs,s),c!==e);)_++;return null!==e&&(n.directiveStylingLast=_),i}function Fv(e,t,n){const i=n?1:2;let s=-1;if(null!==t)for(let c=0;c<t.length;c++){const d=t[c];"number"==typeof d?s=d:s===i&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),Ho(e,d,!!n||t[++c]))}return void 0===e?null:e}function lP(e,t,n,i,s,c,d,_){if(!(3&t.type))return;const x=e.data,E=x[_+1],R=function J4(e){return!(1&~e)}(E)?cP(x,t,n,s,x_(E),d):void 0;Ux(R)||(Ux(c)||function K4(e){return!(2&~e)}(E)&&(c=cP(x,null,n,s,_,d)),function Uz(e,t,n,i,s){if(t)s?e.addClass(n,i):e.removeClass(n,i);else{let c=-1===i.indexOf("-")?void 0:Xf.DashCase;null==s?e.removeStyle(n,i,c):("string"==typeof s&&s.endsWith("!important")&&(s=s.slice(0,-10),c|=Xf.Important),e.setStyle(n,i,s,c))}}(i,d,ku(Xr(),n),s,c))}function cP(e,t,n,i,s,c){const d=null===t;let _;for(;s>0;){const x=e[s],E=Array.isArray(x),R=E?x[1]:x,z=null===R;let V=n[s+1];V===Oi&&(V=z?Ln:void 0);let j=z?Ol(V,i):R===i?V:void 0;if(E&&!Ux(j)&&(j=Ol(x,i)),Ux(j)&&(_=j,d))return _;const J=e[s+1];s=d?Dm(J):x_(J)}if(null!==t){let x=c?t.residualClasses:t.residualStyles;null!=x&&(_=Ol(x,i))}return _}function Ux(e){return void 0!==e}function uP(e,t){return!!(e.flags&(t?8:16))}function hP(e,t,n,i,s){!function Qu(e,t,n,i){const s=H(),c=$t(2);s.firstUpdatePass&&sP(s,null,c,i);const d=N();if(n!==Oi&&ts(d,c,n)){const _=s.data[Xr()];if(uP(_,i)&&!oP(s,c)){let x=i?_.classesWithoutHost:_.stylesWithoutHost;null!==x&&(n=Il(x,n||"")),QT(s,_,d,n,i)}else!function _V(e,t,n,i,s,c,d,_){s===Oi&&(s=Ln);let x=0,E=0,R=0<s.length?s[0]:null,z=0<c.length?c[0]:null;for(;null!==R||null!==z;){const V=x<s.length?s[x+1]:void 0,j=E<c.length?c[E+1]:void 0;let se,J=null;R===z?(x+=2,E+=2,V!==j&&(J=z,se=j)):null===z||null!==R&&R<z?(x+=2,J=R):(E+=2,J=z,se=j),null!==J&&lP(e,t,n,i,J,se,d,_),R=x<s.length?s[x]:null,z=E<c.length?c[E]:null}}(s,_,d,d[11],d[c+1],d[c+1]=function mV(e,t,n){if(null==n||""===n)return Ln;const i=[],s=D(n);if(Array.isArray(s))for(let c=0;c<s.length;c++)e(i,s[c],!0);else if("object"==typeof s)for(const c in s)s.hasOwnProperty(c)&&e(i,c,s[c]);else"string"==typeof s&&t(i,s);return i}(e,t,n),i,c)}}(Ho,qh,p_(N(),e,t,n,i,s),!0)}function Be(e,t,n,i){const s=N(),c=H(),d=26+e,_=s[11],x=c.firstCreatePass?RS(d,c,s,t,UC,g(),n,i):c.data[d],E=mP(c,s,x,_,t,e);s[d]=E;const R=qc(x);return we(x,!0),A2(_,E,x),!Kf(x)&&Mr()&&xx(c,s,E,x),(0===function w(){return fi.lFrame.elementDepthCount}()||R)&&Sa(E,s),function o(){fi.lFrame.elementDepthCount++}(),R&&(vx(c,s,x),Od(c,x,s)),null!==i&&jC(s,x),Be}function We(){let e=ce();Le()?je():(e=e.parent,we(e,!1));const t=e;(function T(e){return fi.skipHydrationRootTNode===e})(t)&&function U(){fi.skipHydrationRootTNode=null}(),function u(){fi.lFrame.elementDepthCount--}();const n=H();return n.firstCreatePass&&LS(n,t),null!=t.classesWithoutHost&&function Np(e){return!!(8&e.flags)}(t)&&QT(n,t,N(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function ly(e){return!!(16&e.flags)}(t)&&QT(n,t,N(),t.stylesWithoutHost,!1),We}function pn(e,t,n,i){return Be(e,t,n,i),We(),pn}let mP=(e,t,n,i,s,c)=>(wr(!0),gx(i,s,function Xc(){return fi.lFrame.currentNamespace}()));function Nv(e,t,n){const i=N(),s=H(),c=e+26,d=s.firstCreatePass?function UV(e,t,n,i,s){const c=t.consts,d=va(c,i),_=o_(t,e,8,"ng-container",d);null!==d&&_T(_,d,!0);const x=va(c,s);return g()&&yT(t,n,_,x,UC),_.mergedAttrs=ff(_.mergedAttrs,_.attrs),null!==t.queries&&t.queries.elementStart(t,_),_}(c,s,i,t,n):s.data[c];we(d,!0);const _=_P(s,i,d,e);return i[c]=_,Mr()&&xx(s,i,_,d),Sa(_,i),qc(d)&&(vx(s,i,d),Od(s,d,i)),null!=n&&jC(i,d),Nv}function zv(){let e=ce();const t=H();return Le()?je():(e=e.parent,we(e,!1)),t.firstCreatePass&&($l(t,e),cf(e)&&t.queries.elementEnd(e)),zv}let _P=(e,t,n,i)=>(wr(!0),FC(t[11],""));function yl(){return N()}const Gx="en-US";let wP=Gx;function VP(e,t,n){return function i(s){if(s===Function)return n;mv(_a(e)?Ki(e.index,t):t,5);const d=t[8];let _=jP(t,d,n,s),x=i.__ngNextListenerFn__;for(;x;)_=jP(t,d,x,s)&&_,x=x.__ngNextListenerFn__;return _}}function jP(e,t,n,i){const s=me(null);try{return!1!==n(i)}catch(c){return function O6(e,t){const n=e[9],i=n?n.get(Mc,null):null;i&&i.handleError(t)}(e,c),!1}finally{me(s)}}function UP(e,t,n,i,s,c){const _=t[1],R=t[n][_.data[n].outputs[i]],z=_.firstCreatePass?Ch(_):null,V=xd(t),j=R.subscribe(c),J=V.length;V.push(c,j),z&&z.push(s,e.index,J,-(J+1))}function xi(e,t,n,i){const s=N(),c=H(),d=ce();return sD(c,s,s[11],d,e,t,i),xi}function sD(e,t,n,i,s,c,d){const _=qc(i),E=e.firstCreatePass?Ch(e):null,R=xd(t);let z=!0;if(3&i.type||d){const V=ea(i,t),j=d?d(V):V,J=R.length,se=d?de=>d(gi(de[i.index])):i.index;let le=null;if(!d&&_&&(le=function F6(e,t,n,i){const s=e.cleanup;if(null!=s)for(let c=0;c<s.length-1;c+=2){const d=s[c];if(d===n&&s[c+1]===i){const _=t[7],x=s[c+2];return _.length>x?_[x]:null}"string"==typeof d&&(c+=2)}return null}(e,t,s,i.index)),null!==le)(le.__ngLastListenerFn__||le).__ngNextListenerFn__=c,le.__ngLastListenerFn__=c,z=!1;else{c=VP(i,t,c);const de=n.listen(j,s,c);R.push(c,de),E&&E.push(s,se,J,J+1)}}else c=VP(i,t,c);if(z){const V=i.outputs?.[s],j=i.hostDirectiveOutputs?.[s];if(j&&j.length)for(let J=0;J<j.length;J+=2)UP(i,t,j[J],j[J+1],s,c);if(V&&V.length)for(const J of V)UP(i,t,J,s,s,c)}}function ui(e=1){return function Yc(e){return(fi.lFrame.contextLView=function Ou(e,t){for(;e>0;)t=t[14],e--;return t}(e,fi.lFrame.contextLView))[8]}(e)}function np(e,t,n){HS(e,t,n)}function zd(e){const t=N(),n=H(),i=Or();ar(i+1);const s=ET(n,i);if(e.dirty&&function cg(e){return!(4&~e[2])}(t)===!(2&~s.metadata.flags)){if(null===s.matches)e.reset([]);else{const c=WS(t,i);e.reset(c,Ty),e.notifyOnChanges()}return!0}return!1}function Bd(){return function MT(e,t){return e[18].queries[t].queryList}(N(),Or())}function vt(e,t=""){const n=N(),i=H(),s=e+26,c=i.firstCreatePass?o_(i,s,1,t,null):i.data[s],d=cA(i,n,c,t,e);n[s]=d,Mr()&&xx(i,n,d,c),we(c,!1)}let cA=(e,t,n,i,s)=>(wr(!0),function OC(e,t){return e.createText(t)}(t[11],i));function wo(e){return Ju("",e,""),wo}function Ju(e,t,n){const i=N(),s=function f_(e,t,n,i){return ts(e,Ht(),n)?t+li(n)+i:Oi}(i,e,t,n);return s!==Oi&&function Vd(e,t,n){const i=ku(t,e);!function E2(e,t,n){e.setValue(t,n)}(e[11],i,n)}(i,Xr(),s),Ju}function jd(e,t,n){xb(t)&&(t=t());const i=N();return ts(i,Ht(),t)&&Ql(H(),zi(),i,e,t,i[11],n,!1),jd}function ip(e,t){const n=xb(e);return n&&e.set(t),n}function Ud(e,t){const n=N(),i=H(),s=ce();return sD(i,n,n[11],s,e,t),Ud}function lD(e,t,n,i,s){if(e=ti(e),Array.isArray(e))for(let c=0;c<e.length;c++)lD(e[c],t,n,i,s);else{const c=H(),d=N(),_=ce();let x=rl(e)?e:ti(e.provide);const E=gh(e),R=1048575&_.providerIndexes,z=_.directiveStart,V=_.providerIndexes>>20;if(rl(e)||!e.multi){const j=new zu(E,s,rn),J=uD(x,t,s?R:R+V,z);-1===J?(dy(gf(_,d),c,x),cD(c,e,t.length),t.push(x),_.directiveStart++,_.directiveEnd++,s&&(_.providerIndexes+=1048576),n.push(j),d.push(j)):(n[J]=j,d[J]=j)}else{const j=uD(x,t,R+V,z),J=uD(x,t,R,R+V),le=J>=0&&n[J];if(s&&!le||!s&&!(j>=0&&n[j])){dy(gf(_,d),c,x);const de=function lj(e,t,n,i,s){const c=new zu(e,n,rn);return c.multi=[],c.index=t,c.componentProviders=0,bA(c,s,i&&!n),c}(s?aj:sj,n.length,s,i,E);!s&&le&&(n[J].providerFactory=de),cD(c,e,t.length,0),t.push(x),_.directiveStart++,_.directiveEnd++,s&&(_.providerIndexes+=1048576),n.push(de),d.push(de)}else cD(c,e,j>-1?j:J,bA(n[s?J:j],E,!s&&i));!s&&i&&le&&n[J].componentProviders++}}}function cD(e,t,n,i){const s=rl(t),c=function yc(e){return!!e.useClass}(t);if(s||c){const x=(c?ti(t.useClass):t).prototype.ngOnDestroy;if(x){const E=e.destroyHooks||(e.destroyHooks=[]);if(!s&&t.multi){const R=E.indexOf(n);-1===R?E.push(n,[i,x]):E[R+1].push(i,x)}else E.push(n,x)}}}function bA(e,t,n){return n&&e.componentProviders++,e.multi.push(t)-1}function uD(e,t,n,i){for(let s=n;s<i;s++)if(t[s]===e)return s;return-1}function sj(e,t,n,i,s){return hD(this.multi,[])}function aj(e,t,n,i,s){const c=this.multi;let d;if(this.providerFactory){const _=this.providerFactory.componentProviders,x=_s(i,i[1],this.providerFactory.index,s);d=x.slice(0,_),hD(c,d);for(let E=_;E<x.length;E++)d.push(x[E])}else d=[],hD(c,d);return d}function hD(e,t){for(let n=0;n<e.length;n++)t.push((0,e[n])());return t}function Vo(e,t=[]){return n=>{n.providersResolver=(i,s)=>function oj(e,t,n){const i=H();if(i.firstCreatePass){const s=ro(e);lD(n,i.data,i.blueprint,s,!0),lD(t,i.data,i.blueprint,s,!1)}}(i,s?s(e):e,t)}}function wA(e,t,n,i,s){return function TA(e,t,n,i,s,c,d){const _=t+n;return Cm(e,_,s,c)?function Hh(e,t,n){return e[t]=n}(e,_+2,d?i.call(d,s,c):i(s,c)):function Gv(e,t){const n=e[t];return n===Oi?void 0:n}(e,_+2)}(N(),function lt(){const e=fi.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}(),e,t,n,i,s)}class n8{ngModuleFactory;componentFactories;constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}}let i8=(()=>{class e{compileModuleSync(n){return new AT(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const i=this.compileModuleSync(n),c=es(Ss(n).declarations).reduce((d,_)=>{const x=wi(_);return x&&d.push(new Ev(x)),d},[]);return new n8(i,c)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}static \u0275fac=function(i){return new(i||e)};static \u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),s8=(()=>{class e{zone=Ot(Cr);changeDetectionScheduler=Ot(dl);applicationRef=Ot(ec);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(i){return new(i||e)};static \u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const a8=new sn("",{factory:()=>!1});function _D({ngZoneFactory:e,ignoreChangesOutsideZone:t,scheduleInRootZone:n}){return e??=()=>new Cr({...yD(),scheduleInRootZone:n}),[{provide:Cr,useFactory:e},{provide:pa,multi:!0,useFactory:()=>{const i=Ot(s8,{optional:!0});return()=>i.initialize()}},{provide:pa,multi:!0,useFactory:()=>{const i=Ot(c8);return()=>{i.initialize()}}},!0===t?{provide:bf,useValue:!0}:[],{provide:$p,useValue:n??Ed}]}function yD(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}let c8=(()=>{class e{subscription=new ur;initialized=!1;zone=Ot(Cr);pendingTasks=Ot(fl);initialize(){if(this.initialized)return;this.initialized=!0;let n=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(n=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Cr.assertNotInAngularZone(),queueMicrotask(()=>{null!==n&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(n),n=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Cr.assertInAngularZone(),n??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(i){return new(i||e)};static \u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),qv=(()=>{class e{appRef=Ot(ec);taskService=Ot(fl);ngZone=Ot(Cr);zonelessEnabled=Ot(vf);tracing=Ot(nu,{optional:!0});disableScheduling=Ot(bf,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new ur;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(Ph):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(Ot($p,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof wy||!this.zoneIsDefined)}notify(n){if(!this.zonelessEnabled&&5===n)return;let i=!1;switch(n){case 0:this.appRef.dirtyFlags|=2;break;case 3:case 2:case 4:case 5:case 1:this.appRef.dirtyFlags|=4;break;case 6:case 13:this.appRef.dirtyFlags|=2,i=!0;break;case 12:this.appRef.dirtyFlags|=16,i=!0;break;case 11:i=!0;break;default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(i))return;const s=this.useMicrotaskScheduler?Ih:yy;this.pendingRenderTaskId=this.taskService.add(),this.cancelScheduledCallback=this.scheduleInRootZone?Zone.root.run(()=>s(()=>this.tick())):this.ngZone.runOutsideAngular(()=>s(()=>this.tick()))}shouldScheduleTick(n){return!(this.disableScheduling&&!n||this.appRef.destroyed||null!==this.pendingRenderTaskId||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(Ph+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(0===this.appRef.dirtyFlags)return void this.cleanup();!this.zonelessEnabled&&7&this.appRef.dirtyFlags&&(this.appRef.dirtyFlags|=1);const n=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(i){throw this.taskService.remove(n),i}finally{this.cleanup()}this.useMicrotaskScheduler=!0,Ih(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(n)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,null!==this.pendingRenderTaskId){const n=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(n)}}static \u0275fac=function(i){return new(i||e)};static \u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const rp=new sn("",{providedIn:"root",factory:()=>Ot(rp,ci.Optional|ci.SkipSelf)||function u8(){return typeof $localize<"u"&&$localize.locale||Gx}()}),Kx=new sn(""),g8=new sn("");function Wv(e){return!e.moduleRef}let D_=null;let Yv=(()=>class e{static __NG_ELEMENT_ID__=w8})();function w8(e){return function C8(e,t,n){if(_a(e)&&!n){const i=Ki(e.index,t);return new _v(i,i)}return 175&e.type?new _v(t[15],t):null}(ce(),N(),!(16&~e))}class ik{constructor(){}supports(t){return Lx(t)}create(t){return new S8(t)}}const E8=(e,t)=>t;class S8{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(t){this._trackByFn=t||E8}forEachItem(t){let n;for(n=this._itHead;null!==n;n=n._next)t(n)}forEachOperation(t){let n=this._itHead,i=this._removalsHead,s=0,c=null;for(;n||i;){const d=!i||n&&n.currentIndex<ok(i,s,c)?n:i,_=ok(d,s,c),x=d.currentIndex;if(d===i)s--,i=i._nextRemoved;else if(n=n._next,null==d.previousIndex)s++;else{c||(c=[]);const E=_-s,R=x-s;if(E!=R){for(let V=0;V<E;V++){const j=V<c.length?c[V]:c[V]=0,J=j+V;R<=J&&J<E&&(c[V]=j+1)}c[d.previousIndex]=R-E}}_!==x&&t(d,_,x)}}forEachPreviousItem(t){let n;for(n=this._previousItHead;null!==n;n=n._nextPrevious)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachMovedItem(t){let n;for(n=this._movesHead;null!==n;n=n._nextMoved)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}forEachIdentityChange(t){let n;for(n=this._identityChangesHead;null!==n;n=n._nextIdentityChange)t(n)}diff(t){if(null==t&&(t=[]),!Lx(t))throw new Et(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let s,c,d,n=this._itHead,i=!1;if(Array.isArray(t)){this.length=t.length;for(let _=0;_<this.length;_++)c=t[_],d=this._trackByFn(_,c),null!==n&&Object.is(n.trackById,d)?(i&&(n=this._verifyReinsertion(n,c,d,_)),Object.is(n.item,c)||this._addIdentityChange(n,c)):(n=this._mismatch(n,c,d,_),i=!0),n=n._next}else s=0,function d5(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[Symbol.iterator]();let i;for(;!(i=n.next()).done;)t(i.value)}}(t,_=>{d=this._trackByFn(s,_),null!==n&&Object.is(n.trackById,d)?(i&&(n=this._verifyReinsertion(n,_,d,s)),Object.is(n.item,_)||this._addIdentityChange(n,_)):(n=this._mismatch(n,_,d,s),i=!0),n=n._next,s++}),this.length=s;return this._truncate(n),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,n,i,s){let c;return null===t?c=this._itTail:(c=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._reinsertAfter(t,c,s)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(i,s))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._moveAfter(t,c,s)):t=this._addAfter(new I8(n,i),c,s),t}_verifyReinsertion(t,n,i,s){let c=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==c?t=this._reinsertAfter(c,t._prev,s):t.currentIndex!=s&&(t.currentIndex=s,this._addToMoves(t,s)),t}_truncate(t){for(;null!==t;){const n=t._next;this._addToRemovals(this._unlink(t)),t=n}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,n,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const s=t._prevRemoved,c=t._nextRemoved;return null===s?this._removalsHead=c:s._nextRemoved=c,null===c?this._removalsTail=s:c._prevRemoved=s,this._insertAfter(t,n,i),this._addToMoves(t,i),t}_moveAfter(t,n,i){return this._unlink(t),this._insertAfter(t,n,i),this._addToMoves(t,i),t}_addAfter(t,n,i){return this._insertAfter(t,n,i),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,n,i){const s=null===n?this._itHead:n._next;return t._next=s,t._prev=n,null===s?this._itTail=t:s._prev=t,null===n?this._itHead=t:n._next=t,null===this._linkedRecords&&(this._linkedRecords=new rk),this._linkedRecords.put(t),t.currentIndex=i,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const n=t._prev,i=t._next;return null===n?this._itHead=i:n._next=i,null===i?this._itTail=n:i._prev=n,t}_addToMoves(t,n){return t.previousIndex===n||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new rk),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,n){return t.item=n,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class I8{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(t,n){this.item=t,this.trackById=n}}class P8{_head=null;_tail=null;add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,n){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===n||n<=i.currentIndex)&&Object.is(i.trackById,t))return i;return null}remove(t){const n=t._prevDup,i=t._nextDup;return null===n?this._head=i:n._nextDup=i,null===i?this._tail=n:i._prevDup=n,null===this._head}}class rk{map=new Map;put(t){const n=t.trackById;let i=this.map.get(n);i||(i=new P8,this.map.set(n,i)),i.add(t)}get(t,n){const s=this.map.get(t);return s?s.get(t,n):null}remove(t){const n=t.trackById;return this.map.get(n).remove(t)&&this.map.delete(n),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function ok(e,t,n){const i=e.previousIndex;if(null===i)return i;let s=0;return n&&i<n.length&&(s=n[i]),i+t+s}function ak(){return new CD([new ik])}let CD=(()=>{class e{factories;static \u0275prov=an({token:e,providedIn:"root",factory:ak});constructor(n){this.factories=n}static create(n,i){if(null!=i){const s=i.factories.slice();n=n.concat(s)}return new e(n)}static extend(n){return{provide:e,useFactory:i=>e.create(n,i||ak()),deps:[[e,new _u,new Na]]}}find(n){const i=this.factories.find(s=>s.supports(n));if(null!=i)return i;throw new Et(901,!1)}}return e})();function O8(e){const{rootComponent:t,appProviders:n,platformProviders:i,platformRef:s}=e;try{const c=s?.injector??function x8(e=[]){if(D_)return D_;const t=function KA(e=[],t){return ys.create({name:t,providers:[{provide:ga,useValue:"platform"},{provide:Kx,useValue:new Set([()=>D_=null])},...e]})}(e);return D_=t,function RI(){!function Wt(e){Sn=e}(()=>{throw new Et(600,!1)})}(),function QA(e){const t=e.get(tu,null);C(e,()=>{t?.forEach(n=>n())})}(t),t}(i),d=[_D({}),{provide:dl,useExisting:qv},...n||[]];return function YA(e){const t=Wv(e)?e.r3Injector:e.moduleRef.injector,n=t.get(Cr);return n.run(()=>{Wv(e)?e.r3Injector.resolveInjectorInitializers():e.moduleRef.resolveInjectorInitializers();const i=t.get(Mc,null);let s;if(n.runOutsideAngular(()=>{s=n.onError.subscribe({next:c=>{i.handleError(c)}})}),Wv(e)){const c=()=>t.destroy(),d=e.platformInjector.get(Kx);d.add(c),t.onDestroy(()=>{s.unsubscribe(),d.delete(c)})}else{const c=()=>e.moduleRef.destroy(),d=e.platformInjector.get(Kx);d.add(c),e.moduleRef.onDestroy(()=>{Vx(e.allPlatformModules,e.moduleRef),s.unsubscribe(),d.delete(c)})}return function y8(e,t,n){try{const i=n();return Rv(i)?i.catch(s=>{throw t.runOutsideAngular(()=>e.handleError(s)),s}):i}catch(i){throw t.runOutsideAngular(()=>e.handleError(i)),i}}(i,n,()=>{const c=t.get(kI);return c.runInitializers(),c.donePromise.then(()=>{if(function KV(e){"string"==typeof e&&(wP=e.toLowerCase().replace(/_/g,"-"))}(t.get(rp,Gx)||Gx),!t.get(g8,!0))return Wv(e)?t.get(ec):(e.allPlatformModules.push(e.moduleRef),e.moduleRef);if(Wv(e)){const x=t.get(ec);return void 0!==e.rootComponent&&x.bootstrap(e.rootComponent),x}return function _8(e,t){const n=e.injector.get(ec);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(i=>n.bootstrap(i));else{if(!e.instance.ngDoBootstrap)throw new Et(-403,!1);e.instance.ngDoBootstrap(n)}t.push(e)}(e.moduleRef,e.allPlatformModules),e.moduleRef})})})}({r3Injector:new sI({providers:d,parent:c,debugName:"",runEnvironmentInitializers:!1}).injector,platformInjector:c,rootComponent:t})}catch(c){return Promise.reject(c)}}function M_(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}function Vs(e){return function it(e){const t=me(null);try{return e()}finally{me(t)}}(e)}function $d(e,t){return function Bt(e,t){const n=Object.create(nt);n.computation=e,void 0!==t&&(n.equal=t);const i=()=>{if(Ie(n),K(n),n.value===Nn)throw n.error;return n.value};return i[be]=n,i}(e,t?.equal)}function Sk(e,t){const n=wi(e),i=t.elementInjector||Fl();return new Ev(n).create(i,t.projectableNodes,t.hostElement,t.environmentInjector)}const su=new sn("");let Ik=null;function op(){return Ik}class TU{}let Pk=(()=>{class e{historyGo(n){throw new Error("")}static \u0275fac=function(i){return new(i||e)};static \u0275prov=an({token:e,factory:()=>Ot(DU),providedIn:"platform"})}return e})(),DU=(()=>{class e extends Pk{_location;_history;_doc=Ot(su);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return op().getBaseHref(this._doc)}onPopState(n){const i=op().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",n,!1),()=>i.removeEventListener("popstate",n)}onHashChange(n){const i=op().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",n,!1),()=>i.removeEventListener("hashchange",n)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(n){this._location.pathname=n}pushState(n,i,s){this._history.pushState(n,i,s)}replaceState(n,i,s){this._history.replaceState(n,i,s)}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}static \u0275fac=function(i){return new(i||e)};static \u0275prov=an({token:e,factory:()=>new e,providedIn:"platform"})}return e})();function Ak(e,t){return e?t?e.endsWith("/")?t.startsWith("/")?e+t.slice(1):e+t:t.startsWith("/")?e+t:`${e}/${t}`:e:t}function kk(e){const t=e.search(/#|\?|$/);return"/"===e[t-1]?e.slice(0,t-1)+e.slice(t):e}function Sm(e){return e&&"?"!==e[0]?`?${e}`:e}let s1=(()=>{class e{historyGo(n){throw new Error("")}static \u0275fac=function(i){return new(i||e)};static \u0275prov=an({token:e,factory:()=>Ot(EU),providedIn:"root"})}return e})();const MU=new sn("");let EU=(()=>{class e extends s1{_platformLocation;_baseHref;_removeListenerFns=[];constructor(n,i){super(),this._platformLocation=n,this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??Ot(su).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return Ak(this._baseHref,n)}path(n=!1){const i=this._platformLocation.pathname+Sm(this._platformLocation.search),s=this._platformLocation.hash;return s&&n?`${i}${s}`:i}pushState(n,i,s,c){const d=this.prepareExternalUrl(s+Sm(c));this._platformLocation.pushState(n,i,d)}replaceState(n,i,s,c){const d=this.prepareExternalUrl(s+Sm(c));this._platformLocation.replaceState(n,i,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}static \u0275fac=function(i){return new(i||e)(Jn(Pk),Jn(MU,8))};static \u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Kv=(()=>{class e{_subject=new Ir;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(n){this._locationStrategy=n;const i=this._locationStrategy.getBaseHref();this._basePath=function PU(e){if(new RegExp("^(https?:)?//").test(e)){const[,n]=e.split(/\/\/[^\/]+/);return n}return e}(kk(Rk(i))),this._locationStrategy.onPopState(s=>{this._subject.next({url:this.path(!0),pop:!0,state:s.state,type:s.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,i=""){return this.path()==this.normalize(n+Sm(i))}normalize(n){return e.stripTrailingSlash(function IU(e,t){if(!e||!t.startsWith(e))return t;const n=t.substring(e.length);return""===n||["/",";","?","#"].includes(n[0])?n:t}(this._basePath,Rk(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,i="",s=null){this._locationStrategy.pushState(s,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Sm(i)),s)}replaceState(n,i="",s=null){this._locationStrategy.replaceState(s,"",n,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Sm(i)),s)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription??=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)}),()=>{const i=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(i,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",i){this._urlChangeListeners.forEach(s=>s(n,i))}subscribe(n,i,s){return this._subject.subscribe({next:n,error:i??void 0,complete:s??void 0})}static normalizeQueryParams=Sm;static joinWithSlash=Ak;static stripTrailingSlash=kk;static \u0275fac=function(i){return new(i||e)(Jn(s1))};static \u0275prov=an({token:e,factory:()=>function SU(){return new Kv(Jn(s1))}(),providedIn:"root"})}return e})();function Rk(e){return e.replace(/\/index.html$/,"")}function Lk(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const i=n.indexOf("="),[s,c]=-1==i?[n,""]:[n.slice(0,i),n.slice(i+1)];if(s.trim()===t)return decodeURIComponent(c)}return null}function Fk(e){return"server"===e}class Nk{}const ED=new sn("");let zk=(()=>{class e{_zone;_plugins;_eventNameToPlugin=new Map;constructor(n,i){this._zone=i,n.forEach(s=>{s.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,i,s,c){return this._findPluginFor(i).addEventListener(n,i,s,c)}getZone(){return this._zone}_findPluginFor(n){let i=this._eventNameToPlugin.get(n);if(i)return i;if(i=this._plugins.find(c=>c.supports(n)),!i)throw new Et(5101,!1);return this._eventNameToPlugin.set(n,i),i}static \u0275fac=function(i){return new(i||e)(Jn(ED),Jn(Cr))};static \u0275prov=an({token:e,factory:e.\u0275fac})}return e})();class Bk{_doc;constructor(t){this._doc=t}manager}const a1="ng-app-id";function Vk(e){for(const t of e)t.remove()}function jk(e,t){const n=t.createElement("style");return n.textContent=e,n}function SD(e,t){const n=t.createElement("link");return n.setAttribute("rel","stylesheet"),n.setAttribute("href",e),n}let Uk=(()=>{class e{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(n,i,s,c={}){this.doc=n,this.appId=i,this.nonce=s,this.isServer=Fk(c),function kU(e,t,n,i){const s=e.head?.querySelectorAll(`style[${a1}="${t}"],link[${a1}="${t}"]`);if(s)for(const c of s)c.removeAttribute(a1),c instanceof HTMLLinkElement?i.set(c.href.slice(c.href.lastIndexOf("/")+1),{usage:0,elements:[c]}):c.textContent&&n.set(c.textContent,{usage:0,elements:[c]})}(n,i,this.inline,this.external),this.hosts.add(n.head)}addStyles(n,i){for(const s of n)this.addUsage(s,this.inline,jk);i?.forEach(s=>this.addUsage(s,this.external,SD))}removeStyles(n,i){for(const s of n)this.removeUsage(s,this.inline);i?.forEach(s=>this.removeUsage(s,this.external))}addUsage(n,i,s){const c=i.get(n);c?c.usage++:i.set(n,{usage:1,elements:[...this.hosts].map(d=>this.addElement(d,s(n,this.doc)))})}removeUsage(n,i){const s=i.get(n);s&&(s.usage--,s.usage<=0&&(Vk(s.elements),i.delete(n)))}ngOnDestroy(){for(const[,{elements:n}]of[...this.inline,...this.external])Vk(n);this.hosts.clear()}addHost(n){this.hosts.add(n);for(const[i,{elements:s}]of this.inline)s.push(this.addElement(n,jk(i,this.doc)));for(const[i,{elements:s}]of this.external)s.push(this.addElement(n,SD(i,this.doc)))}removeHost(n){this.hosts.delete(n)}addElement(n,i){return this.nonce&&i.setAttribute("nonce",this.nonce),this.isServer&&i.setAttribute(a1,this.appId),n.appendChild(i)}static \u0275fac=function(i){return new(i||e)(Jn(su),Jn(eu),Jn(Wp,8),Jn(Pg))};static \u0275prov=an({token:e,factory:e.\u0275fac})}return e})();const ID={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},PD=/%COMP%/g,zU=new sn("",{providedIn:"root",factory:()=>!0});function Gk(e,t){return t.map(n=>n.replace(PD,e))}let Hk=(()=>{class e{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(n,i,s,c,d,_,x,E=null,R=null){this.eventManager=n,this.sharedStylesHost=i,this.appId=s,this.removeStylesOnCompDestroy=c,this.doc=d,this.platformId=_,this.ngZone=x,this.nonce=E,this.tracingService=R,this.platformIsServer=Fk(_),this.defaultRenderer=new AD(n,d,x,this.platformIsServer,this.tracingService)}createRenderer(n,i){if(!n||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===Ga.ShadowDom&&(i={...i,encapsulation:Ga.Emulated});const s=this.getOrCreateRenderer(n,i);return s instanceof qk?s.applyToHost(n):s instanceof kD&&s.applyStyles(),s}getOrCreateRenderer(n,i){const s=this.rendererByCompId;let c=s.get(i.id);if(!c){const d=this.doc,_=this.ngZone,x=this.eventManager,E=this.sharedStylesHost,R=this.removeStylesOnCompDestroy,z=this.platformIsServer,V=this.tracingService;switch(i.encapsulation){case Ga.Emulated:c=new qk(x,E,i,this.appId,R,d,_,z,V);break;case Ga.ShadowDom:return new UU(x,E,n,i,d,_,this.nonce,z,V);default:c=new kD(x,E,i,R,d,_,z,V)}s.set(i.id,c)}return c}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(n){this.rendererByCompId.delete(n)}static \u0275fac=function(i){return new(i||e)(Jn(zk),Jn(Uk),Jn(eu),Jn(zU),Jn(su),Jn(Pg),Jn(Cr),Jn(Wp),Jn(nu,8))};static \u0275prov=an({token:e,factory:e.\u0275fac})}return e})();class AD{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(t,n,i,s,c){this.eventManager=t,this.doc=n,this.ngZone=i,this.platformIsServer=s,this.tracingService=c}destroy(){}destroyNode=null;createElement(t,n){return n?this.doc.createElementNS(ID[n]||n,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,n){(Zk(t)?t.content:t).appendChild(n)}insertBefore(t,n,i){t&&(Zk(t)?t.content:t).insertBefore(n,i)}removeChild(t,n){n.remove()}selectRootElement(t,n){let i="string"==typeof t?this.doc.querySelector(t):t;if(!i)throw new Et(-5104,!1);return n||(i.textContent=""),i}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,i,s){if(s){n=s+":"+n;const c=ID[s];c?t.setAttributeNS(c,n,i):t.setAttribute(n,i)}else t.setAttribute(n,i)}removeAttribute(t,n,i){if(i){const s=ID[i];s?t.removeAttributeNS(s,n):t.removeAttribute(`${i}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,i,s){s&(Xf.DashCase|Xf.Important)?t.style.setProperty(n,i,s&Xf.Important?"important":""):t.style[n]=i}removeStyle(t,n,i){i&Xf.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,i){null!=t&&(t[n]=i)}setValue(t,n){t.nodeValue=n}listen(t,n,i,s){if("string"==typeof t&&!(t=op().getGlobalEventTarget(this.doc,t)))throw new Et(5102,!1);let c=this.decoratePreventDefault(i);return this.tracingService?.wrapEventListener&&(c=this.tracingService.wrapEventListener(t,n,c)),this.eventManager.addEventListener(t,n,c,s)}decoratePreventDefault(t){return n=>{if("__ngUnwrap__"===n)return t;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>t(n)):t(n))&&n.preventDefault()}}}function Zk(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class UU extends AD{sharedStylesHost;hostEl;shadowRoot;constructor(t,n,i,s,c,d,_,x,E){super(t,c,d,x,E),this.sharedStylesHost=n,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let R=s.styles;R=Gk(s.id,R);for(const V of R){const j=document.createElement("style");_&&j.setAttribute("nonce",_),j.textContent=V,this.shadowRoot.appendChild(j)}const z=s.getExternalStyles?.();if(z)for(const V of z){const j=SD(V,c);_&&j.setAttribute("nonce",_),this.shadowRoot.appendChild(j)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,i){return super.insertBefore(this.nodeOrShadowRoot(t),n,i)}removeChild(t,n){return super.removeChild(null,n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class kD extends AD{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(t,n,i,s,c,d,_,x,E){super(t,c,d,_,x),this.sharedStylesHost=n,this.removeStylesOnCompDestroy=s;let R=i.styles;this.styles=E?Gk(E,R):R,this.styleUrls=i.getExternalStyles?.(E)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}}class qk extends kD{contentAttr;hostAttr;constructor(t,n,i,s,c,d,_,x,E){const R=s+"-"+i.id;super(t,n,i,c,d,_,x,E,R),this.contentAttr=function BU(e){return"_ngcontent-%COMP%".replace(PD,e)}(R),this.hostAttr=function VU(e){return"_nghost-%COMP%".replace(PD,e)}(R)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,n){const i=super.createElement(t,n);return super.setAttribute(i,this.contentAttr,""),i}}class RD extends TU{supportsDOMEvents=!0;static makeCurrent(){!function CU(e){Ik??=e}(new RD)}onAndCancel(t,n,i,s){return t.addEventListener(n,i,s),()=>{t.removeEventListener(n,i,s)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.remove()}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function $U(){return Qv=Qv||document.head.querySelector("base"),Qv?Qv.getAttribute("href"):null}();return null==n?null:function GU(e){return new URL(e,document.baseURI).pathname}(n)}resetBaseElement(){Qv=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return Lk(document.cookie,t)}}let Qv=null,ZU=(()=>{class e{build(){return new XMLHttpRequest}static \u0275fac=function(i){return new(i||e)};static \u0275prov=an({token:e,factory:e.\u0275fac})}return e})();const Wk=["alt","control","meta","shift"],WU={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},YU={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};function Yk(e){return{appProviders:[...i$,...e?.providers??[]],platformProviders:t$}}const t$=[{provide:Pg,useValue:"browser"},{provide:tu,useValue:function QU(){RD.makeCurrent()},multi:!0},{provide:su,useFactory:function e$(){return function gC(e){Ly=e}(document),document}}],i$=[{provide:ga,useValue:"root"},{provide:Mc,useFactory:function JU(){return new Mc}},{provide:ED,useClass:(()=>{class e extends Bk{constructor(n){super(n)}supports(n){return!0}addEventListener(n,i,s,c){return n.addEventListener(i,s,c),()=>this.removeEventListener(n,i,s,c)}removeEventListener(n,i,s,c){return n.removeEventListener(i,s,c)}static \u0275fac=function(i){return new(i||e)(Jn(su))};static \u0275prov=an({token:e,factory:e.\u0275fac})}return e})(),multi:!0,deps:[su]},{provide:ED,useClass:(()=>{class e extends Bk{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,i,s,c){const d=e.parseEventName(i),_=e.eventCallback(d.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>op().onAndCancel(n,d.domEventName,_,c))}static parseEventName(n){const i=n.toLowerCase().split("."),s=i.shift();if(0===i.length||"keydown"!==s&&"keyup"!==s)return null;const c=e._normalizeKey(i.pop());let d="",_=i.indexOf("code");if(_>-1&&(i.splice(_,1),d="code."),Wk.forEach(E=>{const R=i.indexOf(E);R>-1&&(i.splice(R,1),d+=E+".")}),d+=c,0!=i.length||0===c.length)return null;const x={};return x.domEventName=s,x.fullKey=d,x}static matchEventFullKeyCode(n,i){let s=WU[n.key]||n.key,c="";return i.indexOf("code.")>-1&&(s=n.code,c="code."),!(null==s||!s)&&(s=s.toLowerCase()," "===s?s="space":"."===s&&(s="dot"),Wk.forEach(d=>{d!==s&&(0,YU[d])(n)&&(c+=d+".")}),c+=s,c===i)}static eventCallback(n,i,s){return c=>{e.matchEventFullKeyCode(c,n)&&s.runGuarded(()=>i(c))}}static _normalizeKey(n){return"esc"===n?"escape":n}static \u0275fac=function(i){return new(i||e)(Jn(su))};static \u0275prov=an({token:e,factory:e.\u0275fac})}return e})(),multi:!0,deps:[su]},Hk,Uk,zk,{provide:pT,useExisting:Hk},{provide:Nk,useClass:ZU},[]];function sp(e){return this instanceof sp?(this.v=e,this):new sp(e)}function Jk(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function ND(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(c){n[c]=e[c]&&function(d){return new Promise(function(_,x){!function s(c,d,_,x){Promise.resolve(x).then(function(E){c({value:E,done:_})},d)}(_,x,(d=e[c](d)).done,d.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const eR=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function tR(e){return mn(e?.then)}function nR(e){return mn(e[Gt])}function iR(e){return Symbol.asyncIterator&&mn(e?.[Symbol.asyncIterator])}function rR(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const oR=function A$(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function sR(e){return mn(e?.[oR])}function aR(e){return function Qk(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,i=n.apply(e,t||[]),c=[];return s=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),_("next"),_("throw"),_("return",function d(j){return function(J){return Promise.resolve(J).then(j,z)}}),s[Symbol.asyncIterator]=function(){return this},s;function _(j,J){i[j]&&(s[j]=function(se){return new Promise(function(le,de){c.push([j,se,le,de])>1||x(j,se)})},J&&(s[j]=J(s[j])))}function x(j,J){try{!function E(j){j.value instanceof sp?Promise.resolve(j.value.v).then(R,z):V(c[0][2],j)}(i[j](J))}catch(se){V(c[0][3],se)}}function R(j){x("next",j)}function z(j){x("throw",j)}function V(j,J){j(J),c.shift(),c.length&&x(c[0][0],c[0][1])}}(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:i,done:s}=yield sp(n.read());if(s)return yield sp(void 0);yield yield sp(i)}}finally{n.releaseLock()}})}function lR(e){return mn(e?.getReader)}function Wh(e){if(e instanceof di)return e;if(null!=e){if(nR(e))return function k$(e){return new di(t=>{const n=e[Gt]();if(mn(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(eR(e))return function R$(e){return new di(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(tR(e))return function L$(e){return new di(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,ie)})}(e);if(iR(e))return cR(e);if(sR(e))return function O$(e){return new di(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(lR(e))return function F$(e){return cR(aR(e))}(e)}throw rR(e)}function cR(e){return new di(t=>{(function N$(e,t){var n,i,s,c;return function Xk(e,t,n,i){return new(n||(n=Promise))(function(c,d){function _(R){try{E(i.next(R))}catch(z){d(z)}}function x(R){try{E(i.throw(R))}catch(z){d(z)}}function E(R){R.done?c(R.value):function s(c){return c instanceof n?c:new n(function(d){d(c)})}(R.value).then(_,x)}E((i=i.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=Jk(e);!(i=yield n.next()).done;)if(t.next(i.value),t.closed)return}catch(d){s={error:d}}finally{try{i&&!i.done&&(c=n.return)&&(yield c.call(n))}finally{if(s)throw s.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function Gd(e,t,n,i=0,s=!1){const c=t.schedule(function(){n(),s?e.add(this.schedule(null,i)):this.unsubscribe()},i);if(e.add(c),!s)return c}function uR(e,t=0){return qr((n,i)=>{n.subscribe(Lr(i,s=>Gd(i,e,()=>i.next(s),t),()=>Gd(i,e,()=>i.complete(),t),s=>Gd(i,e,()=>i.error(s),t)))})}function hR(e,t=0){return qr((n,i)=>{i.add(e.schedule(()=>n.subscribe(i),t))})}function dR(e,t){if(!e)throw new Error("Iterable cannot be null");return new di(n=>{Gd(n,t,()=>{const i=e[Symbol.asyncIterator]();Gd(n,t,()=>{i.next().then(s=>{s.done?n.complete():n.next(s.value)})},0,!0)})})}function Aa(e,t){return t?function $$(e,t){if(null!=e){if(nR(e))return function z$(e,t){return Wh(e).pipe(hR(t),uR(t))}(e,t);if(eR(e))return function V$(e,t){return new di(n=>{let i=0;return t.schedule(function(){i===e.length?n.complete():(n.next(e[i++]),n.closed||this.schedule())})})}(e,t);if(tR(e))return function B$(e,t){return Wh(e).pipe(hR(t),uR(t))}(e,t);if(iR(e))return dR(e,t);if(sR(e))return function j$(e,t){return new di(n=>{let i;return Gd(n,t,()=>{i=e[oR](),Gd(n,t,()=>{let s,c;try{({value:s,done:c}=i.next())}catch(d){return void n.error(d)}c?n.complete():n.next(s)},0,!0)}),()=>mn(i?.return)&&i.return()})}(e,t);if(lR(e))return function U$(e,t){return dR(aR(e),t)}(e,t)}throw rR(e)}(e,t):Wh(e)}function BD(e){return e[e.length-1]}function fR(e){return mn(BD(e))?e.pop():void 0}function l1(e){return function G$(e){return e&&mn(e.schedule)}(BD(e))?e.pop():void 0}function Pi(...e){return Aa(e,l1(e))}const c1=ji(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:H$}=Array,{getPrototypeOf:Z$,prototype:q$,keys:W$}=Object;function pR(e){if(1===e.length){const t=e[0];if(H$(t))return{args:t,keys:null};if(function Y$(e){return e&&"object"==typeof e&&Z$(e)===q$}(t)){const n=W$(t);return{args:n.map(i=>t[i]),keys:n}}}return{args:e,keys:null}}const{isArray:X$}=Array;function mR(e){return Si(t=>function K$(e,t){return X$(t)?e(...t):e(t)}(e,t))}function gR(e,t){return e.reduce((n,i,s)=>(n[i]=t[s],n),{})}function _R(...e){const t=l1(e),n=fR(e),{args:i,keys:s}=pR(e);if(0===i.length)return Aa([],t);const c=new di(function Q$(e,t,n=Ci){return i=>{yR(t,()=>{const{length:s}=e,c=new Array(s);let d=s,_=s;for(let x=0;x<s;x++)yR(t,()=>{const E=Aa(e[x],t);let R=!1;E.subscribe(Lr(i,z=>{c[x]=z,R||(R=!0,_--),_||i.next(n(c.slice()))},()=>{--d||i.complete()}))},i)},i)}}(i,t,s?d=>gR(s,d):Ci));return n?c.pipe(mR(n)):c}function yR(e,t,n){e?Gd(n,e,t):t()}function xl(e,t,n=1/0){return mn(t)?xl((i,s)=>Si((c,d)=>t(i,c,s,d))(Wh(e(i,s))),n):("number"==typeof t&&(n=t),qr((i,s)=>function J$(e,t,n,i,s,c,d,_){const x=[];let E=0,R=0,z=!1;const V=()=>{z&&!x.length&&!E&&t.complete()},j=se=>E<i?J(se):x.push(se),J=se=>{c&&t.next(se),E++;let le=!1;Wh(n(se,R++)).subscribe(Lr(t,de=>{s?.(de),c?j(de):t.next(de)},()=>{le=!0},void 0,()=>{if(le)try{for(E--;x.length&&E<i;){const de=x.shift();d?Gd(t,d,()=>J(de)):J(de)}V()}catch(de){t.error(de)}}))};return e.subscribe(Lr(t,j,()=>{z=!0,V()})),()=>{_?.()}}(i,s,e,n)))}function jD(...e){return function eG(){return function VD(e=1/0){return xl(Ci,e)}(1)}()(Aa(e,l1(e)))}function vR(e){return new di(t=>{Wh(e()).subscribe(t)})}function u1(e,t){const n=mn(e)?e:()=>e,i=s=>s.error(n());return new di(t?s=>t.schedule(i,0,s):i)}const eh=new di(e=>e.complete());function UD(){return qr((e,t)=>{let n=null;e._refCount++;const i=Lr(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const s=e._connection,c=n;n=null,s&&(!c||s===c)&&s.unsubscribe(),t.unsubscribe()});e.subscribe(i),i.closed||(n=e.connect())})}class bR extends di{constructor(t,n){super(),this.source=t,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,ka(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new ur;const n=this.getSubject();t.add(this.source.subscribe(Lr(n,void 0,()=>{this._teardown(),n.complete()},i=>{this._teardown(),n.error(i)},()=>this._teardown()))),t.closed&&(this._connection=null,t=ur.EMPTY)}return t}refCount(){return UD()(this)}}function Yh(e,t){return qr((n,i)=>{let s=null,c=0,d=!1;const _=()=>d&&!s&&i.complete();n.subscribe(Lr(i,x=>{s?.unsubscribe();let E=0;const R=c++;Wh(e(x,R)).subscribe(s=Lr(i,z=>i.next(t?t(x,z,R,E++):z),()=>{s=null,_()}))},()=>{d=!0,_()}))})}function E_(e){return e<=0?()=>eh:qr((t,n)=>{let i=0;t.subscribe(Lr(n,s=>{++i<=e&&(n.next(s),e<=i&&n.complete())}))})}function ap(e,t){return qr((n,i)=>{let s=0;n.subscribe(Lr(i,c=>e.call(t,c,s++)&&i.next(c)))})}function h1(e){return qr((t,n)=>{let i=!1;t.subscribe(Lr(n,s=>{i=!0,n.next(s)},()=>{i||n.next(e),n.complete()}))})}function xR(e=iG){return qr((t,n)=>{let i=!1;t.subscribe(Lr(n,s=>{i=!0,n.next(s)},()=>i?n.complete():n.error(e())))})}function iG(){return new c1}function Im(e,t){const n=arguments.length>=2;return i=>i.pipe(e?ap((s,c)=>e(s,c,i)):Ci,E_(1),n?h1(t):xR(()=>new c1))}function Jv(e,t){return mn(t)?xl(e,t,1):xl(e,1)}function qa(e,t,n){const i=mn(e)||t||n?{next:e,error:t,complete:n}:e;return i?qr((s,c)=>{var d;null===(d=i.subscribe)||void 0===d||d.call(i);let _=!0;s.subscribe(Lr(c,x=>{var E;null===(E=i.next)||void 0===E||E.call(i,x),c.next(x)},()=>{var x;_=!1,null===(x=i.complete)||void 0===x||x.call(i),c.complete()},x=>{var E;_=!1,null===(E=i.error)||void 0===E||E.call(i,x),c.error(x)},()=>{var x,E;_&&(null===(x=i.unsubscribe)||void 0===x||x.call(i)),null===(E=i.finalize)||void 0===E||E.call(i)}))}):Ci}function Pm(e){return qr((t,n)=>{let c,i=null,s=!1;i=t.subscribe(Lr(n,void 0,void 0,d=>{c=Wh(e(d,Pm(e)(t))),i?(i.unsubscribe(),i=null,c.subscribe(n)):s=!0})),s&&(i.unsubscribe(),i=null,c.subscribe(n))})}function $D(e){return e<=0?()=>eh:qr((t,n)=>{let i=[];t.subscribe(Lr(n,s=>{i.push(s),e<i.length&&i.shift()},()=>{for(const s of i)n.next(s);n.complete()},void 0,()=>{i=null}))})}function d1(e){return qr((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}let lG=(()=>{class e{_doc;constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}static \u0275fac=function(i){return new(i||e)(Jn(su))};static \u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),TR=(()=>{class e{static \u0275fac=function(i){return new(i||e)};static \u0275prov=an({token:e,factory:function(i){let s=null;return s=i?new(i||e):Jn(dG),s},providedIn:"root"})}return e})(),dG=(()=>{class e extends TR{_doc;constructor(n){super(),this._doc=n}sanitize(n,i){if(null==i)return null;switch(n){case Rr.NONE:return i;case Rr.HTML:return S(i,"HTML")?D(i):Ns(this._doc,String(i)).toString();case Rr.STYLE:return S(i,"Style")?D(i):i;case Rr.SCRIPT:if(S(i,"Script"))return D(i);throw new Et(5200,!1);case Rr.URL:return S(i,"URL")?D(i):Me(String(i));case Rr.RESOURCE_URL:if(S(i,"ResourceURL"))return D(i);throw new Et(5201,!1);default:throw new Et(5202,!1)}}bypassSecurityTrustHtml(n){return function F(e){return new a(e)}(n)}bypassSecurityTrustStyle(n){return function $(e){return new h(e)}(n)}bypassSecurityTrustScript(n){return function G(e){return new m(e)}(n)}bypassSecurityTrustUrl(n){return function W(e){return new y(e)}(n)}bypassSecurityTrustResourceUrl(n){return function X(e){return new b(e)}(n)}static \u0275fac=function(i){return new(i||e)(Jn(su))};static \u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Hi="primary",t0=Symbol("RouteTitle");class fG{params;constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n[0]:n}return null}getAll(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function S_(e){return new fG(e)}function pG(e,t,n){const i=n.path.split("/");if(i.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||i.length<e.length))return null;const s={};for(let c=0;c<i.length;c++){const d=i[c],_=e[c];if(":"===d[0])s[d.substring(1)]=_;else if(d!==_.path)return null}return{consumed:e.slice(0,i.length),posParams:s}}function Xh(e,t){const n=e?GD(e):void 0,i=t?GD(t):void 0;if(!n||!i||n.length!=i.length)return!1;let s;for(let c=0;c<n.length;c++)if(s=n[c],!DR(e[s],t[s]))return!1;return!0}function GD(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function DR(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),i=[...t].sort();return n.every((s,c)=>i[c]===s)}return e===t}function MR(e){return e.length>0?e[e.length-1]:null}function cp(e){return function r$(e){return!!e&&(e instanceof di||mn(e.lift)&&mn(e.subscribe))}(e)?e:Rv(e)?Aa(Promise.resolve(e)):Pi(e)}const gG={exact:function IR(e,t,n){if(!km(e.segments,t.segments)||!f1(e.segments,t.segments,n)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const i in t.children)if(!e.children[i]||!IR(e.children[i],t.children[i],n))return!1;return!0},subset:PR},ER={exact:function _G(e,t){return Xh(e,t)},subset:function yG(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>DR(e[n],t[n]))},ignored:()=>!0};function SR(e,t,n){return gG[n.paths](e.root,t.root,n.matrixParams)&&ER[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function PR(e,t,n){return AR(e,t,t.segments,n)}function AR(e,t,n,i){if(e.segments.length>n.length){const s=e.segments.slice(0,n.length);return!(!km(s,n)||t.hasChildren()||!f1(s,n,i))}if(e.segments.length===n.length){if(!km(e.segments,n)||!f1(e.segments,n,i))return!1;for(const s in t.children)if(!e.children[s]||!PR(e.children[s],t.children[s],i))return!1;return!0}{const s=n.slice(0,e.segments.length),c=n.slice(e.segments.length);return!!(km(e.segments,s)&&f1(e.segments,s,i)&&e.children[Hi])&&AR(e.children[Hi],t,c,i)}}function f1(e,t,n){return t.every((i,s)=>ER[n](e[s].parameters,i.parameters))}class Am{root;queryParams;fragment;_queryParamMap;constructor(t=new Qr([],{}),n={},i=null){this.root=t,this.queryParams=n,this.fragment=i}get queryParamMap(){return this._queryParamMap??=S_(this.queryParams),this._queryParamMap}toString(){return xG.serialize(this)}}class Qr{segments;children;parent=null;constructor(t,n){this.segments=t,this.children=n,Object.values(n).forEach(i=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return g1(this)}}class n0{path;parameters;_parameterMap;constructor(t,n){this.path=t,this.parameters=n}get parameterMap(){return this._parameterMap??=S_(this.parameters),this._parameterMap}toString(){return LR(this)}}function km(e,t){return e.length===t.length&&e.every((n,i)=>n.path===t[i].path)}let p1=(()=>{class e{static \u0275fac=function(i){return new(i||e)};static \u0275prov=an({token:e,factory:()=>new m1,providedIn:"root"})}return e})();class m1{parse(t){const n=new kG(t);return new Am(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(t){const n=`/${r0(t.root,!0)}`,i=function TG(e){const t=Object.entries(e).map(([n,i])=>Array.isArray(i)?i.map(s=>`${_1(n)}=${_1(s)}`).join("&"):`${_1(n)}=${_1(i)}`).filter(n=>n);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${n}${i}${"string"==typeof t.fragment?`#${function wG(e){return encodeURI(e)}(t.fragment)}`:""}`}}const xG=new m1;function g1(e){return e.segments.map(t=>LR(t)).join("/")}function r0(e,t){if(!e.hasChildren())return g1(e);if(t){const n=e.children[Hi]?r0(e.children[Hi],!1):"",i=[];return Object.entries(e.children).forEach(([s,c])=>{s!==Hi&&i.push(`${s}:${r0(c,!1)}`)}),i.length>0?`${n}(${i.join("//")})`:n}{const n=function bG(e,t){let n=[];return Object.entries(e.children).forEach(([i,s])=>{i===Hi&&(n=n.concat(t(s,i)))}),Object.entries(e.children).forEach(([i,s])=>{i!==Hi&&(n=n.concat(t(s,i)))}),n}(e,(i,s)=>s===Hi?[r0(e.children[Hi],!1)]:[`${s}:${r0(i,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[Hi]?`${g1(e)}/${n[0]}`:`${g1(e)}/(${n.join("//")})`}}function kR(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function _1(e){return kR(e).replace(/%3B/gi,";")}function HD(e){return kR(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function y1(e){return decodeURIComponent(e)}function RR(e){return y1(e.replace(/\+/g,"%20"))}function LR(e){return`${HD(e.path)}${function CG(e){return Object.entries(e).map(([t,n])=>`;${HD(t)}=${HD(n)}`).join("")}(e.parameters)}`}const DG=/^[^\/()?;#]+/;function ZD(e){const t=e.match(DG);return t?t[0]:""}const MG=/^[^\/()?;=#]+/,SG=/^[^=?&#]+/,PG=/^[^&#]+/;class kG{url;remaining;constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Qr([],{}):new Qr([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(t.length>0||Object.keys(n).length>0)&&(i[Hi]=new Qr(t,n)),i}parseSegment(){const t=ZD(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Et(4009,!1);return this.capture(t),new n0(y1(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const n=function EG(e){const t=e.match(MG);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let i="";if(this.consumeOptional("=")){const s=ZD(this.remaining);s&&(i=s,this.capture(i))}t[y1(n)]=y1(i)}parseQueryParam(t){const n=function IG(e){const t=e.match(SG);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let i="";if(this.consumeOptional("=")){const d=function AG(e){const t=e.match(PG);return t?t[0]:""}(this.remaining);d&&(i=d,this.capture(i))}const s=RR(n),c=RR(i);if(t.hasOwnProperty(s)){let d=t[s];Array.isArray(d)||(d=[d],t[s]=d),d.push(c)}else t[s]=c}parseParens(t){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=ZD(this.remaining),s=this.remaining[i.length];if("/"!==s&&")"!==s&&";"!==s)throw new Et(4010,!1);let c;i.indexOf(":")>-1?(c=i.slice(0,i.indexOf(":")),this.capture(c),this.capture(":")):t&&(c=Hi);const d=this.parseChildren();n[c]=1===Object.keys(d).length?d[Hi]:new Qr([],d),this.consumeOptional("//")}return n}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Et(4011,!1)}}function OR(e){return e.segments.length>0?new Qr([],{[Hi]:e}):e}function FR(e){const t={};for(const[i,s]of Object.entries(e.children)){const c=FR(s);if(i===Hi&&0===c.segments.length&&c.hasChildren())for(const[d,_]of Object.entries(c.children))t[d]=_;else(c.segments.length>0||c.hasChildren())&&(t[i]=c)}return function RG(e){if(1===e.numberOfChildren&&e.children[Hi]){const t=e.children[Hi];return new Qr(e.segments.concat(t.segments),t.children)}return e}(new Qr(e.segments,t))}function Rm(e){return e instanceof Am}function NR(e){let t;const s=OR(function n(c){const d={};for(const x of c.children){const E=n(x);d[x.outlet]=E}const _=new Qr(c.url,d);return c===e&&(t=_),_}(e.root));return t??s}function zR(e,t,n,i){let s=e;for(;s.parent;)s=s.parent;if(0===t.length)return qD(s,s,s,n,i);const c=function OG(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new VR(!0,0,e);let t=0,n=!1;const i=e.reduce((s,c,d)=>{if("object"==typeof c&&null!=c){if(c.outlets){const _={};return Object.entries(c.outlets).forEach(([x,E])=>{_[x]="string"==typeof E?E.split("/"):E}),[...s,{outlets:_}]}if(c.segmentPath)return[...s,c.segmentPath]}return"string"!=typeof c?[...s,c]:0===d?(c.split("/").forEach((_,x)=>{0==x&&"."===_||(0==x&&""===_?n=!0:".."===_?t++:""!=_&&s.push(_))}),s):[...s,c]},[]);return new VR(n,t,i)}(t);if(c.toRoot())return qD(s,s,new Qr([],{}),n,i);const d=function FG(e,t,n){if(e.isAbsolute)return new b1(t,!0,0);if(!n)return new b1(t,!1,NaN);if(null===n.parent)return new b1(n,!0,0);const i=v1(e.commands[0])?0:1;return function NG(e,t,n){let i=e,s=t,c=n;for(;c>s;){if(c-=s,i=i.parent,!i)throw new Et(4005,!1);s=i.segments.length}return new b1(i,!1,s-c)}(n,n.segments.length-1+i,e.numberOfDoubleDots)}(c,s,e),_=d.processChildren?s0(d.segmentGroup,d.index,c.commands):jR(d.segmentGroup,d.index,c.commands);return qD(s,d.segmentGroup,_,n,i)}function v1(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function o0(e){return"object"==typeof e&&null!=e&&e.outlets}function qD(e,t,n,i,s){let d,c={};i&&Object.entries(i).forEach(([x,E])=>{c[x]=Array.isArray(E)?E.map(R=>`${R}`):`${E}`}),d=e===t?n:BR(e,t,n);const _=OR(FR(d));return new Am(_,c,s)}function BR(e,t,n){const i={};return Object.entries(e.children).forEach(([s,c])=>{i[s]=c===t?n:BR(c,t,n)}),new Qr(e.segments,i)}class VR{isAbsolute;numberOfDoubleDots;commands;constructor(t,n,i){if(this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=i,t&&i.length>0&&v1(i[0]))throw new Et(4003,!1);const s=i.find(o0);if(s&&s!==MR(i))throw new Et(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class b1{segmentGroup;processChildren;index;constructor(t,n,i){this.segmentGroup=t,this.processChildren=n,this.index=i}}function jR(e,t,n){if(e??=new Qr([],{}),0===e.segments.length&&e.hasChildren())return s0(e,t,n);const i=function BG(e,t,n){let i=0,s=t;const c={match:!1,pathIndex:0,commandIndex:0};for(;s<e.segments.length;){if(i>=n.length)return c;const d=e.segments[s],_=n[i];if(o0(_))break;const x=`${_}`,E=i<n.length-1?n[i+1]:null;if(s>0&&void 0===x)break;if(x&&E&&"object"==typeof E&&void 0===E.outlets){if(!$R(x,E,d))return c;i+=2}else{if(!$R(x,{},d))return c;i++}s++}return{match:!0,pathIndex:s,commandIndex:i}}(e,t,n),s=n.slice(i.commandIndex);if(i.match&&i.pathIndex<e.segments.length){const c=new Qr(e.segments.slice(0,i.pathIndex),{});return c.children[Hi]=new Qr(e.segments.slice(i.pathIndex),e.children),s0(c,0,s)}return i.match&&0===s.length?new Qr(e.segments,{}):i.match&&!e.hasChildren()?WD(e,t,n):i.match?s0(e,0,s):WD(e,t,n)}function s0(e,t,n){if(0===n.length)return new Qr(e.segments,{});{const i=function zG(e){return o0(e[0])?e[0].outlets:{[Hi]:e}}(n),s={};if(Object.keys(i).some(c=>c!==Hi)&&e.children[Hi]&&1===e.numberOfChildren&&0===e.children[Hi].segments.length){const c=s0(e.children[Hi],t,n);return new Qr(e.segments,c.children)}return Object.entries(i).forEach(([c,d])=>{"string"==typeof d&&(d=[d]),null!==d&&(s[c]=jR(e.children[c],t,d))}),Object.entries(e.children).forEach(([c,d])=>{void 0===i[c]&&(s[c]=d)}),new Qr(e.segments,s)}}function WD(e,t,n){const i=e.segments.slice(0,t);let s=0;for(;s<n.length;){const c=n[s];if(o0(c)){const x=VG(c.outlets);return new Qr(i,x)}if(0===s&&v1(n[0])){i.push(new n0(e.segments[t].path,UR(n[0]))),s++;continue}const d=o0(c)?c.outlets[Hi]:`${c}`,_=s<n.length-1?n[s+1]:null;d&&_&&v1(_)?(i.push(new n0(d,UR(_))),s+=2):(i.push(new n0(d,{})),s++)}return new Qr(i,{})}function VG(e){const t={};return Object.entries(e).forEach(([n,i])=>{"string"==typeof i&&(i=[i]),null!==i&&(t[n]=WD(new Qr([],{}),0,i))}),t}function UR(e){const t={};return Object.entries(e).forEach(([n,i])=>t[n]=`${i}`),t}function $R(e,t,n){return e==n.path&&Xh(t,n.parameters)}const x1="imperative";var cr=function(e){return e[e.NavigationStart=0]="NavigationStart",e[e.NavigationEnd=1]="NavigationEnd",e[e.NavigationCancel=2]="NavigationCancel",e[e.NavigationError=3]="NavigationError",e[e.RoutesRecognized=4]="RoutesRecognized",e[e.ResolveStart=5]="ResolveStart",e[e.ResolveEnd=6]="ResolveEnd",e[e.GuardsCheckStart=7]="GuardsCheckStart",e[e.GuardsCheckEnd=8]="GuardsCheckEnd",e[e.RouteConfigLoadStart=9]="RouteConfigLoadStart",e[e.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",e[e.ChildActivationStart=11]="ChildActivationStart",e[e.ChildActivationEnd=12]="ChildActivationEnd",e[e.ActivationStart=13]="ActivationStart",e[e.ActivationEnd=14]="ActivationEnd",e[e.Scroll=15]="Scroll",e[e.NavigationSkipped=16]="NavigationSkipped",e}(cr||{});class Kh{id;url;constructor(t,n){this.id=t,this.url=n}}class YD extends Kh{type=cr.NavigationStart;navigationTrigger;restoredState;constructor(t,n,i="imperative",s=null){super(t,n),this.navigationTrigger=i,this.restoredState=s}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Lm extends Kh{urlAfterRedirects;type=cr.NavigationEnd;constructor(t,n,i){super(t,n),this.urlAfterRedirects=i}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}var Ic=function(e){return e[e.Redirect=0]="Redirect",e[e.SupersededByNewNavigation=1]="SupersededByNewNavigation",e[e.NoDataFromResolver=2]="NoDataFromResolver",e[e.GuardRejected=3]="GuardRejected",e}(Ic||{}),XD=function(e){return e[e.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",e[e.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",e}(XD||{});class Om extends Kh{reason;code;type=cr.NavigationCancel;constructor(t,n,i,s){super(t,n),this.reason=i,this.code=s}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class a0 extends Kh{reason;code;type=cr.NavigationSkipped;constructor(t,n,i,s){super(t,n),this.reason=i,this.code=s}}class KD extends Kh{error;target;type=cr.NavigationError;constructor(t,n,i,s){super(t,n),this.error=i,this.target=s}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class GR extends Kh{urlAfterRedirects;state;type=cr.RoutesRecognized;constructor(t,n,i,s){super(t,n),this.urlAfterRedirects=i,this.state=s}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class jG extends Kh{urlAfterRedirects;state;type=cr.GuardsCheckStart;constructor(t,n,i,s){super(t,n),this.urlAfterRedirects=i,this.state=s}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class UG extends Kh{urlAfterRedirects;state;shouldActivate;type=cr.GuardsCheckEnd;constructor(t,n,i,s,c){super(t,n),this.urlAfterRedirects=i,this.state=s,this.shouldActivate=c}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class $G extends Kh{urlAfterRedirects;state;type=cr.ResolveStart;constructor(t,n,i,s){super(t,n),this.urlAfterRedirects=i,this.state=s}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class GG extends Kh{urlAfterRedirects;state;type=cr.ResolveEnd;constructor(t,n,i,s){super(t,n),this.urlAfterRedirects=i,this.state=s}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class HG{route;type=cr.RouteConfigLoadStart;constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class ZG{route;type=cr.RouteConfigLoadEnd;constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class qG{snapshot;type=cr.ChildActivationStart;constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class WG{snapshot;type=cr.ChildActivationEnd;constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class YG{snapshot;type=cr.ActivationStart;constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class XG{snapshot;type=cr.ActivationEnd;constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class QD{}class w1{url;navigationBehaviorOptions;constructor(t,n){this.url=t,this.navigationBehaviorOptions=n}}function th(e){return e.outlet||Hi}function l0(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n?._loadedInjector)return n._loadedInjector;if(n?._injector)return n._injector}return null}class nH{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return l0(this.route?.snapshot)??this.rootInjector}constructor(t){this.rootInjector=t,this.children=new c0(this.rootInjector)}}let c0=(()=>{class e{rootInjector;contexts=new Map;constructor(n){this.rootInjector=n}onChildOutletCreated(n,i){const s=this.getOrCreateContext(n);s.outlet=i,this.contexts.set(n,s)}onChildOutletDestroyed(n){const i=this.getContext(n);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let i=this.getContext(n);return i||(i=new nH(this.rootInjector),this.contexts.set(n,i)),i}getContext(n){return this.contexts.get(n)||null}static \u0275fac=function(i){return new(i||e)(Jn(ps))};static \u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class HR{_root;constructor(t){this._root=t}get root(){return this._root.value}parent(t){const n=this.pathFromRoot(t);return n.length>1?n[n.length-2]:null}children(t){const n=JD(t,this._root);return n?n.children.map(i=>i.value):[]}firstChild(t){const n=JD(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const n=eM(t,this._root);return n.length<2?[]:n[n.length-2].children.map(s=>s.value).filter(s=>s!==t)}pathFromRoot(t){return eM(t,this._root).map(n=>n.value)}}function JD(e,t){if(e===t.value)return t;for(const n of t.children){const i=JD(e,n);if(i)return i}return null}function eM(e,t){if(e===t.value)return[t];for(const n of t.children){const i=eM(e,n);if(i.length)return i.unshift(t),i}return[]}class nh{value;children;constructor(t,n){this.value=t,this.children=n}toString(){return`TreeNode(${this.value})`}}function I_(e){const t={};return e&&e.children.forEach(n=>t[n.value.outlet]=n),t}class ZR extends HR{snapshot;constructor(t,n){super(t),this.snapshot=n,tM(this,t)}toString(){return this.snapshot.toString()}}function qR(e){const t=function iH(e){const c=new T1([],{},{},"",{},Hi,e,null,{});return new WR("",new nh(c,[]))}(e),n=new kn([new n0("",{})]),i=new kn({}),s=new kn({}),c=new kn({}),d=new kn(""),_=new P_(n,i,c,d,s,Hi,e,t.root);return _.snapshot=t.root,new ZR(new nh(_,[]),t)}class P_{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(t,n,i,s,c,d,_,x){this.urlSubject=t,this.paramsSubject=n,this.queryParamsSubject=i,this.fragmentSubject=s,this.dataSubject=c,this.outlet=d,this.component=_,this._futureSnapshot=x,this.title=this.dataSubject?.pipe(Si(E=>E[t0]))??Pi(void 0),this.url=t,this.params=n,this.queryParams=i,this.fragment=s,this.data=c}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Si(t=>S_(t))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Si(t=>S_(t))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function C1(e,t,n="emptyOnly"){let i;const{routeConfig:s}=e;return i=null===t||"always"!==n&&""!==s?.path&&(t.component||t.routeConfig?.loadComponent)?{params:{...e.params},data:{...e.data},resolve:{...e.data,...e._resolvedData??{}}}:{params:{...t.params,...e.params},data:{...t.data,...e.data},resolve:{...e.data,...t.data,...s?.data,...e._resolvedData}},s&&XR(s)&&(i.resolve[t0]=s.title),i}class T1{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[t0]}constructor(t,n,i,s,c,d,_,x,E){this.url=t,this.params=n,this.queryParams=i,this.fragment=s,this.data=c,this.outlet=d,this.component=_,this.routeConfig=x,this._resolve=E}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=S_(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=S_(this.queryParams),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class WR extends HR{url;constructor(t,n){super(n),this.url=t,tM(this,n)}toString(){return YR(this._root)}}function tM(e,t){t.value._routerState=e,t.children.forEach(n=>tM(e,n))}function YR(e){const t=e.children.length>0?` { ${e.children.map(YR).join(", ")} } `:"";return`${e.value}${t}`}function nM(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,Xh(t.queryParams,n.queryParams)||e.queryParamsSubject.next(n.queryParams),t.fragment!==n.fragment&&e.fragmentSubject.next(n.fragment),Xh(t.params,n.params)||e.paramsSubject.next(n.params),function mG(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Xh(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.urlSubject.next(n.url),Xh(t.data,n.data)||e.dataSubject.next(n.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function iM(e,t){const n=Xh(e.params,t.params)&&function vG(e,t){return km(e,t)&&e.every((n,i)=>Xh(n.parameters,t[i].parameters))}(e.url,t.url);return n&&!(!e.parent!=!t.parent)&&(!e.parent||iM(e.parent,t.parent))}function XR(e){return"string"==typeof e.title||null===e.title}const rH=new sn("");let rM=(()=>{class e{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=Hi;activateEvents=new ao;deactivateEvents=new ao;attachEvents=new ao;detachEvents=new ao;routerOutletData=vb(void 0);parentContexts=Ot(c0);location=Ot(Yu);changeDetector=Ot(Yv);inputBinder=Ot(oM,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(n){if(n.name){const{firstChange:i,previousValue:s}=n.name;if(i)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Et(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Et(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Et(4012,!1);this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,i){this.activated=n,this._activatedRoute=i,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,i){if(this.isActivated)throw new Et(4013,!1);this._activatedRoute=n;const s=this.location,d=n.snapshot.component,_=this.parentContexts.getOrCreateContext(this.name).children,x=new oH(n,_,s.injector,this.routerOutletData);this.activated=s.createComponent(d,{index:s.length,injector:x,environmentInjector:i}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(i){return new(i||e)};static \u0275dir=Di({type:e,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[Js]})}return e})();class oH{route;childContexts;parent;outletData;constructor(t,n,i,s){this.route=t,this.childContexts=n,this.parent=i,this.outletData=s}get(t,n){return t===P_?this.route:t===c0?this.childContexts:t===rH?this.outletData:this.parent.get(t,n)}}const oM=new sn("");let KR=(()=>{class e{static \u0275fac=function(i){return new(i||e)};static \u0275cmp=_l({type:e,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(i,s){1&i&&pn(0,"router-outlet")},dependencies:[rM],encapsulation:2})}return e})();function sM(e){const t=e.children&&e.children.map(sM),n=t?{...e,children:t}:{...e};return!n.component&&!n.loadComponent&&(t||n.loadChildren)&&n.outlet&&n.outlet!==Hi&&(n.component=KR),n}function u0(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const i=n.value;i._futureSnapshot=t.value;const s=function aH(e,t,n){return t.children.map(i=>{for(const s of n.children)if(e.shouldReuseRoute(i.value,s.value.snapshot))return u0(e,i,s);return u0(e,i)})}(e,t,n);return new nh(i,s)}{if(e.shouldAttach(t.value)){const c=e.retrieve(t.value);if(null!==c){const d=c.route;return d.value._futureSnapshot=t.value,d.children=t.children.map(_=>u0(e,_)),d}}const i=function lH(e){return new P_(new kn(e.url),new kn(e.params),new kn(e.queryParams),new kn(e.fragment),new kn(e.data),e.outlet,e.component,e)}(t.value),s=t.children.map(c=>u0(e,c));return new nh(i,s)}}class aM{redirectTo;navigationBehaviorOptions;constructor(t,n){this.redirectTo=t,this.navigationBehaviorOptions=n}}const QR="ngNavigationCancelingError";function D1(e,t){const{redirectTo:n,navigationBehaviorOptions:i}=Rm(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,s=JR(!1,Ic.Redirect);return s.url=n,s.navigationBehaviorOptions=i,s}function JR(e,t){const n=new Error(`NavigationCancelingError: ${e||""}`);return n[QR]=!0,n.cancellationCode=t,n}function eL(e){return!!e&&e[QR]}class hH{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(t,n,i,s,c){this.routeReuseStrategy=t,this.futureState=n,this.currState=i,this.forwardEvent=s,this.inputBindingEnabled=c}activate(t){const n=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,i,t),nM(this.futureState.root),this.activateChildRoutes(n,i,t)}deactivateChildRoutes(t,n,i){const s=I_(n);t.children.forEach(c=>{const d=c.value.outlet;this.deactivateRoutes(c,s[d],i),delete s[d]}),Object.values(s).forEach(c=>{this.deactivateRouteAndItsChildren(c,i)})}deactivateRoutes(t,n,i){const s=t.value,c=n?n.value:null;if(s===c)if(s.component){const d=i.getContext(s.outlet);d&&this.deactivateChildRoutes(t,n,d.children)}else this.deactivateChildRoutes(t,n,i);else c&&this.deactivateRouteAndItsChildren(n,i)}deactivateRouteAndItsChildren(t,n){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,n):this.deactivateRouteAndOutlet(t,n)}detachAndStoreRouteSubtree(t,n){const i=n.getContext(t.value.outlet),s=i&&t.value.component?i.children:n,c=I_(t);for(const d of Object.values(c))this.deactivateRouteAndItsChildren(d,s);if(i&&i.outlet){const d=i.outlet.detach(),_=i.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:d,route:t,contexts:_})}}deactivateRouteAndOutlet(t,n){const i=n.getContext(t.value.outlet),s=i&&t.value.component?i.children:n,c=I_(t);for(const d of Object.values(c))this.deactivateRouteAndItsChildren(d,s);i&&(i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated()),i.attachRef=null,i.route=null)}activateChildRoutes(t,n,i){const s=I_(n);t.children.forEach(c=>{this.activateRoutes(c,s[c.value.outlet],i),this.forwardEvent(new XG(c.value.snapshot))}),t.children.length&&this.forwardEvent(new WG(t.value.snapshot))}activateRoutes(t,n,i){const s=t.value,c=n?n.value:null;if(nM(s),s===c)if(s.component){const d=i.getOrCreateContext(s.outlet);this.activateChildRoutes(t,n,d.children)}else this.activateChildRoutes(t,n,i);else if(s.component){const d=i.getOrCreateContext(s.outlet);if(this.routeReuseStrategy.shouldAttach(s.snapshot)){const _=this.routeReuseStrategy.retrieve(s.snapshot);this.routeReuseStrategy.store(s.snapshot,null),d.children.onOutletReAttached(_.contexts),d.attachRef=_.componentRef,d.route=_.route.value,d.outlet&&d.outlet.attach(_.componentRef,_.route.value),nM(_.route.value),this.activateChildRoutes(t,null,d.children)}else d.attachRef=null,d.route=s,d.outlet&&d.outlet.activateWith(s,d.injector),this.activateChildRoutes(t,null,d.children)}else this.activateChildRoutes(t,null,i)}}class tL{path;route;constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class M1{component;route;constructor(t,n){this.component=t,this.route=n}}function dH(e,t,n){const i=e._root;return h0(i,t?t._root:null,n,[i.value])}function A_(e,t){const n=Symbol(),i=t.get(e,n);return i===n?"function"!=typeof e||function cs(e){return null!==Ts(e)}(e)?t.get(e):e:i}function h0(e,t,n,i,s={canDeactivateChecks:[],canActivateChecks:[]}){const c=I_(t);return e.children.forEach(d=>{(function pH(e,t,n,i,s={canDeactivateChecks:[],canActivateChecks:[]}){const c=e.value,d=t?t.value:null,_=n?n.getContext(e.value.outlet):null;if(d&&c.routeConfig===d.routeConfig){const x=function mH(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!km(e.url,t.url);case"pathParamsOrQueryParamsChange":return!km(e.url,t.url)||!Xh(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!iM(e,t)||!Xh(e.queryParams,t.queryParams);default:return!iM(e,t)}}(d,c,c.routeConfig.runGuardsAndResolvers);x?s.canActivateChecks.push(new tL(i)):(c.data=d.data,c._resolvedData=d._resolvedData),h0(e,t,c.component?_?_.children:null:n,i,s),x&&_&&_.outlet&&_.outlet.isActivated&&s.canDeactivateChecks.push(new M1(_.outlet.component,d))}else d&&d0(t,_,s),s.canActivateChecks.push(new tL(i)),h0(e,null,c.component?_?_.children:null:n,i,s)})(d,c[d.value.outlet],n,i.concat([d.value]),s),delete c[d.value.outlet]}),Object.entries(c).forEach(([d,_])=>d0(_,n.getContext(d),s)),s}function d0(e,t,n){const i=I_(e),s=e.value;Object.entries(i).forEach(([c,d])=>{d0(d,s.component?t?t.children.getContext(c):null:t,n)}),n.canDeactivateChecks.push(new M1(s.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,s))}function f0(e){return"function"==typeof e}function nL(e){return e instanceof c1||"EmptyError"===e?.name}const E1=Symbol("INITIAL_VALUE");function k_(){return Yh(e=>_R(e.map(t=>t.pipe(E_(1),function nG(...e){const t=l1(e);return qr((n,i)=>{(t?jD(e,n,t):jD(e,n)).subscribe(i)})}(E1)))).pipe(Si(t=>{for(const n of t)if(!0!==n){if(n===E1)return E1;if(!1===n||wH(n))return n}return!0}),ap(t=>t!==E1),E_(1)))}function wH(e){return Rm(e)||e instanceof aM}function iL(e){return function gn(...e){return Zr(e)}(qa(t=>{if("boolean"!=typeof t)throw D1(0,t)}),Si(t=>!0===t))}class lM{segmentGroup;constructor(t){this.segmentGroup=t||null}}class cM extends Error{urlTree;constructor(t){super(),this.urlTree=t}}function R_(e){return u1(new lM(e))}class OH{urlSerializer;urlTree;constructor(t,n){this.urlSerializer=t,this.urlTree=n}lineralizeSegments(t,n){let i=[],s=n.root;for(;;){if(i=i.concat(s.segments),0===s.numberOfChildren)return Pi(i);if(s.numberOfChildren>1||!s.children[Hi])return u1(new Et(4e3,!1));s=s.children[Hi]}}applyRedirectCommands(t,n,i,s,c){if("string"!=typeof n){const _=n,{queryParams:x,fragment:E,routeConfig:R,url:z,outlet:V,params:j,data:J,title:se}=s,le=C(c,()=>_({params:j,data:J,queryParams:x,fragment:E,routeConfig:R,url:z,outlet:V,title:se}));if(le instanceof Am)throw new cM(le);n=le}const d=this.applyRedirectCreateUrlTree(n,this.urlSerializer.parse(n),t,i);if("/"===n[0])throw new cM(d);return d}applyRedirectCreateUrlTree(t,n,i,s){const c=this.createSegmentGroup(t,n.root,i,s);return new Am(c,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(t,n){const i={};return Object.entries(t).forEach(([s,c])=>{if("string"==typeof c&&":"===c[0]){const _=c.substring(1);i[s]=n[_]}else i[s]=c}),i}createSegmentGroup(t,n,i,s){const c=this.createSegments(t,n.segments,i,s);let d={};return Object.entries(n.children).forEach(([_,x])=>{d[_]=this.createSegmentGroup(t,x,i,s)}),new Qr(c,d)}createSegments(t,n,i,s){return n.map(c=>":"===c.path[0]?this.findPosParam(t,c,s):this.findOrReturn(c,i))}findPosParam(t,n,i){const s=i[n.path.substring(1)];if(!s)throw new Et(4001,!1);return s}findOrReturn(t,n){let i=0;for(const s of n){if(s.path===t.path)return n.splice(i),s;i++}return t}}const uM={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function FH(e,t,n,i,s){const c=rL(e,t,n);return c.matched?(i=function KG(e,t){return e.providers&&!e._injector&&(e._injector=kT(e.providers,t,`Route: ${e.path}`)),e._injector??t}(t,i),function kH(e,t,n,i){const s=t.canMatch;return s&&0!==s.length?Pi(s.map(d=>{const _=A_(d,e);return cp(function xH(e){return e&&f0(e.canMatch)}(_)?_.canMatch(t,n):C(e,()=>_(t,n)))})).pipe(k_(),iL()):Pi(!0)}(i,t,n).pipe(Si(d=>!0===d?c:{...uM}))):Pi(c)}function rL(e,t,n){if("**"===t.path)return function NH(e){return{matched:!0,parameters:e.length>0?MR(e).parameters:{},consumedSegments:e,remainingSegments:[],positionalParamSegments:{}}}(n);if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{...uM}:{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const s=(t.matcher||pG)(n,e,t);if(!s)return{...uM};const c={};Object.entries(s.posParams??{}).forEach(([_,x])=>{c[_]=x.path});const d=s.consumed.length>0?{...c,...s.consumed[s.consumed.length-1].parameters}:c;return{matched:!0,consumedSegments:s.consumed,remainingSegments:n.slice(s.consumed.length),parameters:d,positionalParamSegments:s.posParams??{}}}function oL(e,t,n,i){return n.length>0&&function VH(e,t,n){return n.some(i=>S1(e,t,i)&&th(i)!==Hi)}(e,n,i)?{segmentGroup:new Qr(t,BH(i,new Qr(n,e.children))),slicedSegments:[]}:0===n.length&&function jH(e,t,n){return n.some(i=>S1(e,t,i))}(e,n,i)?{segmentGroup:new Qr(e.segments,zH(e,n,i,e.children)),slicedSegments:n}:{segmentGroup:new Qr(e.segments,e.children),slicedSegments:n}}function zH(e,t,n,i){const s={};for(const c of n)if(S1(e,t,c)&&!i[th(c)]){const d=new Qr([],{});s[th(c)]=d}return{...i,...s}}function BH(e,t){const n={};n[Hi]=t;for(const i of e)if(""===i.path&&th(i)!==Hi){const s=new Qr([],{});n[th(i)]=s}return n}function S1(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}class $H{}class ZH{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(t,n,i,s,c,d,_){this.injector=t,this.configLoader=n,this.rootComponentType=i,this.config=s,this.urlTree=c,this.paramsInheritanceStrategy=d,this.urlSerializer=_,this.applyRedirects=new OH(this.urlSerializer,this.urlTree)}noMatchError(t){return new Et(4002,`'${t.segmentGroup}'`)}recognize(){const t=oL(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(t).pipe(Si(({children:n,rootSnapshot:i})=>{const s=new nh(i,n),c=new WR("",s),d=function LG(e,t,n=null,i=null){return zR(NR(e),t,n,i)}(i,[],this.urlTree.queryParams,this.urlTree.fragment);return d.queryParams=this.urlTree.queryParams,c.url=this.urlSerializer.serialize(d),{state:c,tree:d}}))}match(t){const n=new T1([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Object.freeze({}),Hi,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,t,Hi,n).pipe(Si(i=>({children:i,rootSnapshot:n})),Pm(i=>{if(i instanceof cM)return this.urlTree=i.urlTree,this.match(i.urlTree.root);throw i instanceof lM?this.noMatchError(i):i}))}processSegmentGroup(t,n,i,s,c){return 0===i.segments.length&&i.hasChildren()?this.processChildren(t,n,i,c):this.processSegment(t,n,i,i.segments,s,!0,c).pipe(Si(d=>d instanceof nh?[d]:[]))}processChildren(t,n,i,s){const c=[];for(const d of Object.keys(i.children))"primary"===d?c.unshift(d):c.push(d);return Aa(c).pipe(Jv(d=>{const _=i.children[d],x=function tH(e,t){const n=e.filter(i=>th(i)===t);return n.push(...e.filter(i=>th(i)!==t)),n}(n,d);return this.processSegmentGroup(t,x,_,d,s)}),function oG(e,t){return qr(function rG(e,t,n,i,s){return(c,d)=>{let _=n,x=t,E=0;c.subscribe(Lr(d,R=>{const z=E++;x=_?e(x,R,z):(_=!0,R),i&&d.next(x)},s&&(()=>{_&&d.next(x),d.complete()})))}}(e,t,arguments.length>=2,!0))}((d,_)=>(d.push(..._),d)),h1(null),function sG(e,t){const n=arguments.length>=2;return i=>i.pipe(e?ap((s,c)=>e(s,c,i)):Ci,$D(1),n?h1(t):xR(()=>new c1))}(),xl(d=>{if(null===d)return R_(i);const _=sL(d);return function qH(e){e.sort((t,n)=>t.value.outlet===Hi?-1:n.value.outlet===Hi?1:t.value.outlet.localeCompare(n.value.outlet))}(_),Pi(_)}))}processSegment(t,n,i,s,c,d,_){return Aa(n).pipe(Jv(x=>this.processSegmentAgainstRoute(x._injector??t,n,x,i,s,c,d,_).pipe(Pm(E=>{if(E instanceof lM)return Pi(null);throw E}))),Im(x=>!!x),Pm(x=>{if(nL(x))return function UH(e,t,n){return 0===t.length&&!e.children[n]}(i,s,c)?Pi(new $H):R_(i);throw x}))}processSegmentAgainstRoute(t,n,i,s,c,d,_,x){return th(i)===d||d!==Hi&&S1(s,c,i)?void 0===i.redirectTo?this.matchSegmentAgainstRoute(t,s,i,c,d,x):this.allowRedirects&&_?this.expandSegmentAgainstRouteUsingRedirect(t,s,n,i,c,d,x):R_(s):R_(s)}expandSegmentAgainstRouteUsingRedirect(t,n,i,s,c,d,_){const{matched:x,parameters:E,consumedSegments:R,positionalParamSegments:z,remainingSegments:V}=rL(n,s,c);if(!x)return R_(n);"string"==typeof s.redirectTo&&"/"===s.redirectTo[0]&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const j=new T1(c,E,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,aL(s),th(s),s.component??s._loadedComponent??null,s,lL(s)),J=C1(j,_,this.paramsInheritanceStrategy);j.params=Object.freeze(J.params),j.data=Object.freeze(J.data);const se=this.applyRedirects.applyRedirectCommands(R,s.redirectTo,z,j,t);return this.applyRedirects.lineralizeSegments(s,se).pipe(xl(le=>this.processSegment(t,i,n,le.concat(V),d,!1,_)))}matchSegmentAgainstRoute(t,n,i,s,c,d){const _=FH(n,i,s,t);return"**"===i.path&&(n.children={}),_.pipe(Yh(x=>x.matched?this.getChildConfig(t=i._injector??t,i,s).pipe(Yh(({routes:E})=>{const R=i._loadedInjector??t,{parameters:z,consumedSegments:V,remainingSegments:j}=x,J=new T1(V,z,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,aL(i),th(i),i.component??i._loadedComponent??null,i,lL(i)),se=C1(J,d,this.paramsInheritanceStrategy);J.params=Object.freeze(se.params),J.data=Object.freeze(se.data);const{segmentGroup:le,slicedSegments:de}=oL(n,V,j,E);if(0===de.length&&le.hasChildren())return this.processChildren(R,E,le,J).pipe(Si(ze=>new nh(J,ze)));if(0===E.length&&0===de.length)return Pi(new nh(J,[]));const ae=th(i)===c;return this.processSegment(R,E,le,de,ae?Hi:c,!0,J).pipe(Si(ze=>new nh(J,ze instanceof nh?[ze]:[])))})):R_(n)))}getChildConfig(t,n,i){return n.children?Pi({routes:n.children,injector:t}):n.loadChildren?void 0!==n._loadedRoutes?Pi({routes:n._loadedRoutes,injector:n._loadedInjector}):function AH(e,t,n,i){const s=t.canLoad;return void 0===s||0===s.length?Pi(!0):Pi(s.map(d=>{const _=A_(d,e);return cp(function _H(e){return e&&f0(e.canLoad)}(_)?_.canLoad(t,n):C(e,()=>_(t,n)))})).pipe(k_(),iL())}(t,n,i).pipe(xl(s=>s?this.configLoader.loadChildren(t,n).pipe(qa(c=>{n._loadedRoutes=c.routes,n._loadedInjector=c.injector})):function LH(){return u1(JR(!1,Ic.GuardRejected))}())):Pi({routes:[],injector:t})}}function WH(e){const t=e.value.routeConfig;return t&&""===t.path}function sL(e){const t=[],n=new Set;for(const i of e){if(!WH(i)){t.push(i);continue}const s=t.find(c=>i.value.routeConfig===c.value.routeConfig);void 0!==s?(s.children.push(...i.children),n.add(s)):t.push(i)}for(const i of n){const s=sL(i.children);t.push(new nh(i.value,s))}return t.filter(i=>!n.has(i))}function aL(e){return e.data||{}}function lL(e){return e.resolve||{}}function cL(e){const t=e.children.map(n=>cL(n)).flat();return[e,...t]}function hM(e){return Yh(t=>{const n=e(t);return n?Aa(n).pipe(Si(()=>t)):Pi(t)})}let uL=(()=>{class e{buildTitle(n){let i,s=n.root;for(;void 0!==s;)i=this.getResolvedTitleForRoute(s)??i,s=s.children.find(c=>c.outlet===Hi);return i}getResolvedTitleForRoute(n){return n.data[t0]}static \u0275fac=function(i){return new(i||e)};static \u0275prov=an({token:e,factory:()=>Ot(eZ),providedIn:"root"})}return e})(),eZ=(()=>{class e extends uL{title;constructor(n){super(),this.title=n}updateTitle(n){const i=this.buildTitle(n);void 0!==i&&this.title.setTitle(i)}static \u0275fac=function(i){return new(i||e)(Jn(lG))};static \u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const dM=new sn("",{providedIn:"root",factory:()=>({})}),fM=new sn("");let hL=(()=>{class e{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=Ot(i8);loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return Pi(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);const i=cp(n.loadComponent()).pipe(Si(dL),qa(c=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=c}),d1(()=>{this.componentLoaders.delete(n)})),s=new bR(i,()=>new Ir).pipe(UD());return this.componentLoaders.set(n,s),s}loadChildren(n,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return Pi({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const c=function tZ(e,t,n,i){return cp(e.loadChildren()).pipe(Si(dL),xl(s=>s instanceof oI||Array.isArray(s)?Pi(s):Aa(t.compileModuleAsync(s))),Si(s=>{i&&i(e);let c,d,_=!1;return Array.isArray(s)?(d=s,!0):(c=s.create(n).injector,d=c.get(fM,[],{optional:!0,self:!0}).flat()),{routes:d.map(sM),injector:c}}))}(i,this.compiler,n,this.onLoadEndListener).pipe(d1(()=>{this.childrenLoaders.delete(i)})),d=new bR(c,()=>new Ir).pipe(UD());return this.childrenLoaders.set(i,d),d}static \u0275fac=function(i){return new(i||e)};static \u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function dL(e){return function nZ(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let pM=(()=>{class e{static \u0275fac=function(i){return new(i||e)};static \u0275prov=an({token:e,factory:()=>Ot(iZ),providedIn:"root"})}return e})(),iZ=(()=>{class e{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,i){return n}static \u0275fac=function(i){return new(i||e)};static \u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const rZ=new sn(""),aZ=new sn("");let lZ=(()=>{class e{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new Ir;transitionAbortSubject=new Ir;configLoader=Ot(hL);environmentInjector=Ot(ps);destroyRef=Ot(Hl);urlSerializer=Ot(p1);rootContexts=Ot(c0);location=Ot(Kv);inputBindingEnabled=null!==Ot(oM,{optional:!0});titleStrategy=Ot(uL);options=Ot(dM,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=Ot(pM);createViewTransition=Ot(rZ,{optional:!0});navigationErrorHandler=Ot(aZ,{optional:!0});navigationId=0;get hasRequestedNavigation(){return 0!==this.navigationId}transitions;afterPreactivation=()=>Pi(void 0);rootComponentType=null;destroyed=!1;constructor(){this.configLoader.onLoadEndListener=s=>this.events.next(new ZG(s)),this.configLoader.onLoadStartListener=s=>this.events.next(new HG(s)),this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(n){const i=++this.navigationId;this.transitions?.next({...n,extractedUrl:this.urlHandlingStrategy.extract(n.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,id:i})}setupNavigations(n){return this.transitions=new kn(null),this.transitions.pipe(ap(i=>null!==i),Yh(i=>{let s=!1,c=!1;return Pi(i).pipe(Yh(d=>{if(this.navigationId>i.id)return this.cancelNavigationTransition(i,"",Ic.SupersededByNewNavigation),eh;this.currentTransition=i,this.currentNavigation={id:d.id,initialUrl:d.rawUrl,extractedUrl:d.extractedUrl,targetBrowserUrl:"string"==typeof d.extras.browserUrl?this.urlSerializer.parse(d.extras.browserUrl):d.extras.browserUrl,trigger:d.source,extras:d.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null};const _=!n.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!_&&"reload"!==(d.extras.onSameUrlNavigation??n.onSameUrlNavigation)){const E="";return this.events.next(new a0(d.id,this.urlSerializer.serialize(d.rawUrl),E,XD.IgnoredSameUrlNavigation)),d.resolve(!1),eh}if(this.urlHandlingStrategy.shouldProcessUrl(d.rawUrl))return Pi(d).pipe(Yh(E=>(this.events.next(new YD(E.id,this.urlSerializer.serialize(E.extractedUrl),E.source,E.restoredState)),E.id!==this.navigationId?eh:Promise.resolve(E))),function YH(e,t,n,i,s,c){return xl(d=>function GH(e,t,n,i,s,c,d="emptyOnly"){return new ZH(e,t,n,i,s,d,c).recognize()}(e,t,n,i,d.extractedUrl,s,c).pipe(Si(({state:_,tree:x})=>({...d,targetSnapshot:_,urlAfterRedirects:x}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,this.paramsInheritanceStrategy),qa(E=>{i.targetSnapshot=E.targetSnapshot,i.urlAfterRedirects=E.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:E.urlAfterRedirects};const R=new GR(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot);this.events.next(R)}));if(_&&this.urlHandlingStrategy.shouldProcessUrl(d.currentRawUrl)){const{id:E,extractedUrl:R,source:z,restoredState:V,extras:j}=d,J=new YD(E,this.urlSerializer.serialize(R),z,V);this.events.next(J);const se=qR(this.rootComponentType).snapshot;return this.currentTransition=i={...d,targetSnapshot:se,urlAfterRedirects:R,extras:{...j,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.finalUrl=R,Pi(i)}{const E="";return this.events.next(new a0(d.id,this.urlSerializer.serialize(d.extractedUrl),E,XD.IgnoredByUrlHandlingStrategy)),d.resolve(!1),eh}}),qa(d=>{const _=new jG(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(_)}),Si(d=>(this.currentTransition=i={...d,guards:dH(d.targetSnapshot,d.currentSnapshot,this.rootContexts)},i)),function CH(e,t){return xl(n=>{const{targetSnapshot:i,currentSnapshot:s,guards:{canActivateChecks:c,canDeactivateChecks:d}}=n;return 0===d.length&&0===c.length?Pi({...n,guardsResult:!0}):function TH(e,t,n,i){return Aa(e).pipe(xl(s=>function PH(e,t,n,i,s){const c=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return c&&0!==c.length?Pi(c.map(_=>{const x=l0(t)??s,E=A_(_,x);return cp(function bH(e){return e&&f0(e.canDeactivate)}(E)?E.canDeactivate(e,t,n,i):C(x,()=>E(e,t,n,i))).pipe(Im())})).pipe(k_()):Pi(!0)}(s.component,s.route,n,t,i)),Im(s=>!0!==s,!0))}(d,i,s,e).pipe(xl(_=>_&&function gH(e){return"boolean"==typeof e}(_)?function DH(e,t,n,i){return Aa(t).pipe(Jv(s=>jD(function EH(e,t){return null!==e&&t&&t(new qG(e)),Pi(!0)}(s.route.parent,i),function MH(e,t){return null!==e&&t&&t(new YG(e)),Pi(!0)}(s.route,i),function IH(e,t,n){const i=t[t.length-1],c=t.slice(0,t.length-1).reverse().map(d=>function fH(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(d)).filter(d=>null!==d).map(d=>vR(()=>Pi(d.guards.map(x=>{const E=l0(d.node)??n,R=A_(x,E);return cp(function vH(e){return e&&f0(e.canActivateChild)}(R)?R.canActivateChild(i,e):C(E,()=>R(i,e))).pipe(Im())})).pipe(k_())));return Pi(c).pipe(k_())}(e,s.path,n),function SH(e,t,n){const i=t.routeConfig?t.routeConfig.canActivate:null;if(!i||0===i.length)return Pi(!0);const s=i.map(c=>vR(()=>{const d=l0(t)??n,_=A_(c,d);return cp(function yH(e){return e&&f0(e.canActivate)}(_)?_.canActivate(t,e):C(d,()=>_(t,e))).pipe(Im())}));return Pi(s).pipe(k_())}(e,s.route,n))),Im(s=>!0!==s,!0))}(i,c,e,t):Pi(_)),Si(_=>({...n,guardsResult:_})))})}(this.environmentInjector,d=>this.events.next(d)),qa(d=>{if(i.guardsResult=d.guardsResult,d.guardsResult&&"boolean"!=typeof d.guardsResult)throw D1(0,d.guardsResult);const _=new UG(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot,!!d.guardsResult);this.events.next(_)}),ap(d=>!!d.guardsResult||(this.cancelNavigationTransition(d,"",Ic.GuardRejected),!1)),hM(d=>{if(0!==d.guards.canActivateChecks.length)return Pi(d).pipe(qa(_=>{const x=new $G(_.id,this.urlSerializer.serialize(_.extractedUrl),this.urlSerializer.serialize(_.urlAfterRedirects),_.targetSnapshot);this.events.next(x)}),Yh(_=>{let x=!1;return Pi(_).pipe(function XH(e,t){return xl(n=>{const{targetSnapshot:i,guards:{canActivateChecks:s}}=n;if(!s.length)return Pi(n);const c=new Set(s.map(x=>x.route)),d=new Set;for(const x of c)if(!d.has(x))for(const E of cL(x))d.add(E);let _=0;return Aa(d).pipe(Jv(x=>c.has(x)?function KH(e,t,n,i){const s=e.routeConfig,c=e._resolve;return void 0!==s?.title&&!XR(s)&&(c[t0]=s.title),function QH(e,t,n,i){const s=GD(e);if(0===s.length)return Pi({});const c={};return Aa(s).pipe(xl(d=>function JH(e,t,n,i){const s=l0(t)??i,c=A_(e,s);return cp(c.resolve?c.resolve(t,n):C(s,()=>c(t,n)))}(e[d],t,n,i).pipe(Im(),qa(_=>{if(_ instanceof aM)throw D1(new m1,_);c[d]=_}))),$D(1),Si(()=>c),Pm(d=>nL(d)?eh:u1(d)))}(c,e,t,i).pipe(Si(d=>(e._resolvedData=d,e.data=C1(e,e.parent,n).resolve,null)))}(x,i,e,t):(x.data=C1(x,x.parent,e).resolve,Pi(void 0))),qa(()=>_++),$D(1),xl(x=>_===d.size?Pi(n):eh))})}(this.paramsInheritanceStrategy,this.environmentInjector),qa({next:()=>x=!0,complete:()=>{x||this.cancelNavigationTransition(_,"",Ic.NoDataFromResolver)}}))}),qa(_=>{const x=new GG(_.id,this.urlSerializer.serialize(_.extractedUrl),this.urlSerializer.serialize(_.urlAfterRedirects),_.targetSnapshot);this.events.next(x)}))}),hM(d=>{const _=x=>{const E=[];x.routeConfig?.loadComponent&&!x.routeConfig._loadedComponent&&E.push(this.configLoader.loadComponent(x.routeConfig).pipe(qa(R=>{x.component=R}),Si(()=>{})));for(const R of x.children)E.push(..._(R));return E};return _R(_(d.targetSnapshot.root)).pipe(h1(null),E_(1))}),hM(()=>this.afterPreactivation()),Yh(()=>{const{currentSnapshot:d,targetSnapshot:_}=i,x=this.createViewTransition?.(this.environmentInjector,d.root,_.root);return x?Aa(x).pipe(Si(()=>i)):Pi(i)}),Si(d=>{const _=function sH(e,t,n){const i=u0(e,t._root,n?n._root:void 0);return new ZR(i,t)}(n.routeReuseStrategy,d.targetSnapshot,d.currentRouterState);return this.currentTransition=i={...d,targetRouterState:_},this.currentNavigation.targetRouterState=_,i}),qa(()=>{this.events.next(new QD)}),((e,t,n,i)=>Si(s=>(new hH(t,s.targetRouterState,s.currentRouterState,n,i).activate(e),s)))(this.rootContexts,n.routeReuseStrategy,d=>this.events.next(d),this.inputBindingEnabled),E_(1),qa({next:d=>{s=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Lm(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects))),this.titleStrategy?.updateTitle(d.targetRouterState.snapshot),d.resolve(!0)},complete:()=>{s=!0}}),function aG(e){return qr((t,n)=>{Wh(e).subscribe(Lr(n,()=>n.complete(),oe)),!n.closed&&t.subscribe(n)})}(this.transitionAbortSubject.pipe(qa(d=>{throw d}))),d1(()=>{!s&&!c&&this.cancelNavigationTransition(i,"",Ic.SupersededByNewNavigation),this.currentTransition?.id===i.id&&(this.currentNavigation=null,this.currentTransition=null)}),Pm(d=>{if(this.destroyed)return i.resolve(!1),eh;if(c=!0,eL(d))this.events.next(new Om(i.id,this.urlSerializer.serialize(i.extractedUrl),d.message,d.cancellationCode)),function cH(e){return eL(e)&&Rm(e.url)}(d)?this.events.next(new w1(d.url,d.navigationBehaviorOptions)):i.resolve(!1);else{const _=new KD(i.id,this.urlSerializer.serialize(i.extractedUrl),d,i.targetSnapshot??void 0);try{const x=C(this.environmentInjector,()=>this.navigationErrorHandler?.(_));if(!(x instanceof aM))throw this.events.next(_),d;{const{message:E,cancellationCode:R}=D1(0,x);this.events.next(new Om(i.id,this.urlSerializer.serialize(i.extractedUrl),E,R)),this.events.next(new w1(x.redirectTo,x.navigationBehaviorOptions))}}catch(x){this.options.resolveNavigationPromiseOnError?i.resolve(!1):i.reject(x)}}return eh}))}))}cancelNavigationTransition(n,i,s){const c=new Om(n.id,this.urlSerializer.serialize(n.extractedUrl),i,s);this.events.next(c),n.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){const n=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),i=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return n.toString()!==i?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static \u0275fac=function(i){return new(i||e)};static \u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function cZ(e){return e!==x1}let uZ=(()=>{class e{static \u0275fac=function(i){return new(i||e)};static \u0275prov=an({token:e,factory:()=>Ot(dZ),providedIn:"root"})}return e})();class hZ{shouldDetach(t){return!1}store(t,n){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,n){return t.routeConfig===n.routeConfig}}let dZ=(()=>{class e extends hZ{static \u0275fac=(()=>{let n;return function(s){return(n||(n=ks(e)))(s||e)}})();static \u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),fL=(()=>{class e{urlSerializer=Ot(p1);options=Ot(dM,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=Ot(Kv);urlHandlingStrategy=Ot(pM);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new Am;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:n,initialUrl:i,targetBrowserUrl:s}){const c=void 0!==n?this.urlHandlingStrategy.merge(n,i):i,d=s??c;return d instanceof Am?this.urlSerializer.serialize(d):d}commitTransition({targetRouterState:n,finalUrl:i,initialUrl:s}){i&&n?(this.currentUrlTree=i,this.rawUrlTree=this.urlHandlingStrategy.merge(i,s),this.routerState=n):this.rawUrlTree=s}routerState=qR(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:n}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n??this.rawUrlTree)}static \u0275fac=function(i){return new(i||e)};static \u0275prov=an({token:e,factory:()=>Ot(fZ),providedIn:"root"})}return e})(),fZ=(()=>{class e extends fL{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(n){return this.location.subscribe(i=>{"popstate"===i.type&&setTimeout(()=>{n(i.url,i.state,"popstate")})})}handleRouterEvent(n,i){n instanceof YD?this.updateStateMemento():n instanceof a0?this.commitTransition(i):n instanceof GR?"eager"===this.urlUpdateStrategy&&(i.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(i),i)):n instanceof QD?(this.commitTransition(i),"deferred"===this.urlUpdateStrategy&&!i.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(i),i)):n instanceof Om&&(n.code===Ic.GuardRejected||n.code===Ic.NoDataFromResolver)?this.restoreHistory(i):n instanceof KD?this.restoreHistory(i,!0):n instanceof Lm&&(this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId)}setBrowserUrl(n,{extras:i,id:s}){const{replaceUrl:c,state:d}=i;if(this.location.isCurrentPathEqualTo(n)||c){const _=this.browserPageId,x={...d,...this.generateNgRouterState(s,_)};this.location.replaceState(n,"",x)}else{const _={...d,...this.generateNgRouterState(s,this.browserPageId+1)};this.location.go(n,"",_)}}restoreHistory(n,i=!1){if("computed"===this.canceledNavigationResolution){const c=this.currentPageId-this.browserPageId;0!==c?this.location.historyGo(c):this.getCurrentUrlTree()===n.finalUrl&&0===c&&(this.resetInternalState(n),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(i&&this.resetInternalState(n),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,i){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:i}:{navigationId:n}}static \u0275fac=(()=>{let n;return function(s){return(n||(n=ks(e)))(s||e)}})();static \u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const mZ={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},gZ={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let L_=(()=>{class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=Ot(zT);stateManager=Ot(fL);options=Ot(dM,{optional:!0})||{};pendingTasks=Ot(fl);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=Ot(lZ);urlSerializer=Ot(p1);location=Ot(Kv);urlHandlingStrategy=Ot(pM);_events=new Ir;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=Ot(uZ);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=Ot(fM,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!Ot(oM,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:n=>{this.console.warn(n)}}),this.subscribeToNavigationEvents()}eventsSubscription=new ur;subscribeToNavigationEvents(){const n=this.navigationTransitions.events.subscribe(i=>{try{const s=this.navigationTransitions.currentTransition,c=this.navigationTransitions.currentNavigation;if(null!==s&&null!==c)if(this.stateManager.handleRouterEvent(i,c),i instanceof Om&&i.code!==Ic.Redirect&&i.code!==Ic.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof Lm)this.navigated=!0;else if(i instanceof w1){const d=i.navigationBehaviorOptions,_=this.urlHandlingStrategy.merge(i.url,s.currentRawUrl),x={browserUrl:s.extras.browserUrl,info:s.extras.info,skipLocationChange:s.extras.skipLocationChange,replaceUrl:s.extras.replaceUrl||"eager"===this.urlUpdateStrategy||cZ(s.source),...d};this.scheduleNavigation(_,x1,null,x,{resolve:s.resolve,reject:s.reject,promise:s.promise})}(function yZ(e){return!(e instanceof QD||e instanceof w1)})(i)&&this._events.next(i)}catch(s){this.navigationTransitions.transitionAbortSubject.next(s)}});this.eventsSubscription.add(n)}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),x1,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((n,i,s)=>{this.navigateToSyncWithBrowser(n,s,i)})}navigateToSyncWithBrowser(n,i,s){const c={replaceUrl:!0},d=s?.navigationId?s:null;if(s){const x={...s};delete x.navigationId,delete x.\u0275routerPageId,0!==Object.keys(x).length&&(c.state=x)}const _=this.parseUrl(n);this.scheduleNavigation(_,i,d,c)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map(sM),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(n,i={}){const{relativeTo:s,queryParams:c,fragment:d,queryParamsHandling:_,preserveFragment:x}=i,E=x?this.currentUrlTree.fragment:d;let z,R=null;switch(_??this.options.defaultQueryParamsHandling){case"merge":R={...this.currentUrlTree.queryParams,...c};break;case"preserve":R=this.currentUrlTree.queryParams;break;default:R=c||null}null!==R&&(R=this.removeEmptyProps(R));try{z=NR(s?s.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof n[0]||"/"!==n[0][0])&&(n=[]),z=this.currentUrlTree.root}return zR(z,n,R,E??null)}navigateByUrl(n,i={skipLocationChange:!1}){const s=Rm(n)?n:this.parseUrl(n),c=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(c,x1,null,i)}navigate(n,i={skipLocationChange:!1}){return function _Z(e){for(let t=0;t<e.length;t++)if(null==e[t])throw new Et(4008,!1)}(n),this.navigateByUrl(this.createUrlTree(n,i),i)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){try{return this.urlSerializer.parse(n)}catch{return this.urlSerializer.parse("/")}}isActive(n,i){let s;if(s=!0===i?{...mZ}:!1===i?{...gZ}:i,Rm(n))return SR(this.currentUrlTree,n,s);const c=this.parseUrl(n);return SR(this.currentUrlTree,c,s)}removeEmptyProps(n){return Object.entries(n).reduce((i,[s,c])=>(null!=c&&(i[s]=c),i),{})}scheduleNavigation(n,i,s,c,d){if(this.disposed)return Promise.resolve(!1);let _,x,E;d?(_=d.resolve,x=d.reject,E=d.promise):E=new Promise((z,V)=>{_=z,x=V});const R=this.pendingTasks.add();return function pZ(e,t){e.events.pipe(ap(n=>n instanceof Lm||n instanceof Om||n instanceof KD||n instanceof a0),Si(n=>n instanceof Lm||n instanceof a0?0:n instanceof Om&&(n.code===Ic.Redirect||n.code===Ic.SupersededByNewNavigation)?2:1),ap(n=>2!==n),E_(1)).subscribe(()=>{t()})}(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(R))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:c,resolve:_,reject:x,promise:E,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),E.catch(z=>Promise.reject(z))}static \u0275fac=function(i){return new(i||e)};static \u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),p0=(()=>{class e{router;route;tabIndexAttribute;renderer;el;locationStrategy;href=null;target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new Ir;constructor(n,i,s,c,d,_){this.router=n,this.route=i,this.tabIndexAttribute=s,this.renderer=c,this.el=d,this.locationStrategy=_;const x=d.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===x||"area"===x,this.isAnchorElement?this.subscription=n.events.subscribe(E=>{E instanceof Lm&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(n){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",n)}ngOnChanges(n){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}routerLinkInput=null;set routerLink(n){null==n?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(this.routerLinkInput=Rm(n)||Array.isArray(n)?n:[n],this.setTabIndexIfNotOnNativeEl("0"))}onClick(n,i,s,c,d){const _=this.urlTree;return!!(null===_||this.isAnchorElement&&(0!==n||i||s||c||d||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(_,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){const n=this.urlTree;this.href=null!==n&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(n)):null;const i=null===this.href?null:function Xl(e,t,n){return function Hu(e,t){return"src"===t&&("embed"===e||"frame"===e||"iframe"===e||"media"===e||"script"===e)||"href"===t&&("base"===e||"link"===e)?Ur:zo}(t,n)(e)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",i)}applyAttributeValue(n,i){const s=this.renderer,c=this.el.nativeElement;null!==i?s.setAttribute(c,n,i):s.removeAttribute(c,n)}get urlTree(){return null===this.routerLinkInput?null:Rm(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(i){return new(i||e)(rn(L_),rn(P_),function Vp(e){return function tb(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const n=e.attrs;if(n){const i=n.length;let s=0;for(;s<i;){const c=n[s];if(K0(c))break;if(0===c)s+=2;else if("number"==typeof c)for(s++;s<i&&"string"==typeof n[s];)s++;else{if(c===t)return n[s+1];s+=2}}}return null}(ce(),e)}("tabindex"),rn(Gh),rn(Rs),rn(s1))};static \u0275dir=Di({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(i,s){1&i&&xi("click",function(d){return s.onClick(d.button,d.ctrlKey,d.shiftKey,d.altKey,d.metaKey)}),2&i&&Xu("target",s.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",M_],skipLocationChange:[2,"skipLocationChange","skipLocationChange",M_],replaceUrl:[2,"replaceUrl","replaceUrl",M_],routerLink:"routerLink"},features:[Js]})}return e})();const mM=new sn("");function mL(e){return e.routerState.root}function gL(){const e=Ot(ys);return t=>{const n=e.get(ec);if(t!==n.components[0])return;const i=e.get(L_),s=e.get(_L);1===e.get(gM)&&i.initialNavigation(),e.get(yL,null,ci.Optional)?.setUpPreloading(),e.get(mM,null,ci.Optional)?.init(),i.resetRootComponentType(n.componentTypes[0]),s.closed||(s.next(),s.complete(),s.unsubscribe())}}const _L=new sn("",{factory:()=>new Ir}),gM=new sn("",{providedIn:"root",factory:()=>1}),yL=new sn("");class I1{}class P1{}class ih{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(t){t?"string"==typeof t?this.lazyInit=()=>{this.headers=new Map,t.split("\n").forEach(n=>{const i=n.indexOf(":");if(i>0){const s=n.slice(0,i),c=n.slice(i+1).trim();this.addHeaderEntry(s,c)}})}:typeof Headers<"u"&&t instanceof Headers?(this.headers=new Map,t.forEach((n,i)=>{this.addHeaderEntry(i,n)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(t).forEach(([n,i])=>{this.setHeaderEntries(n,i)})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const n=this.headers.get(t.toLowerCase());return n&&n.length>0?n[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,n){return this.clone({name:t,value:n,op:"a"})}set(t,n){return this.clone({name:t,value:n,op:"s"})}delete(t,n){return this.clone({name:t,value:n,op:"d"})}maybeSetNormalizedName(t,n){this.normalizedNames.has(n)||this.normalizedNames.set(n,t)}init(){this.lazyInit&&(this.lazyInit instanceof ih?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(n=>{this.headers.set(n,t.headers.get(n)),this.normalizedNames.set(n,t.normalizedNames.get(n))})}clone(t){const n=new ih;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof ih?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([t]),n}applyUpdate(t){const n=t.name.toLowerCase();switch(t.op){case"a":case"s":let i=t.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(t.name,n);const s=("a"===t.op?this.headers.get(n):void 0)||[];s.push(...i),this.headers.set(n,s);break;case"d":const c=t.value;if(c){let d=this.headers.get(n);if(!d)return;d=d.filter(_=>-1===c.indexOf(_)),0===d.length?(this.headers.delete(n),this.normalizedNames.delete(n)):this.headers.set(n,d)}else this.headers.delete(n),this.normalizedNames.delete(n)}}addHeaderEntry(t,n){const i=t.toLowerCase();this.maybeSetNormalizedName(t,i),this.headers.has(i)?this.headers.get(i).push(n):this.headers.set(i,[n])}setHeaderEntries(t,n){const i=(Array.isArray(n)?n:[n]).map(c=>c.toString()),s=t.toLowerCase();this.headers.set(s,i),this.maybeSetNormalizedName(t,s)}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(n=>t(this.normalizedNames.get(n),this.headers.get(n)))}}class EZ{encodeKey(t){return bL(t)}encodeValue(t){return bL(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const IZ=/%(\d[a-f0-9])/gi,PZ={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function bL(e){return encodeURIComponent(e).replace(IZ,(t,n)=>PZ[n]??t)}function A1(e){return`${e}`}class up{map;encoder;updates=null;cloneFrom=null;constructor(t={}){if(this.encoder=t.encoder||new EZ,t.fromString){if(t.fromObject)throw new Et(2805,!1);this.map=function SZ(e,t){const n=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(s=>{const c=s.indexOf("="),[d,_]=-1==c?[t.decodeKey(s),""]:[t.decodeKey(s.slice(0,c)),t.decodeValue(s.slice(c+1))],x=n.get(d)||[];x.push(_),n.set(d,x)}),n}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(n=>{const i=t.fromObject[n],s=Array.isArray(i)?i.map(A1):[A1(i)];this.map.set(n,s)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const n=this.map.get(t);return n?n[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,n){return this.clone({param:t,value:n,op:"a"})}appendAll(t){const n=[];return Object.keys(t).forEach(i=>{const s=t[i];Array.isArray(s)?s.forEach(c=>{n.push({param:i,value:c,op:"a"})}):n.push({param:i,value:s,op:"a"})}),this.clone(n)}set(t,n){return this.clone({param:t,value:n,op:"s"})}delete(t,n){return this.clone({param:t,value:n,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const n=this.encoder.encodeKey(t);return this.map.get(t).map(i=>n+"="+this.encoder.encodeValue(i)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const n=new up({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat(t),n}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const n=("a"===t.op?this.map.get(t.param):void 0)||[];n.push(A1(t.value)),this.map.set(t.param,n);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let i=this.map.get(t.param)||[];const s=i.indexOf(A1(t.value));-1!==s&&i.splice(s,1),i.length>0?this.map.set(t.param,i):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class AZ{map=new Map;set(t,n){return this.map.set(t,n),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function xL(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function wL(e){return typeof Blob<"u"&&e instanceof Blob}function CL(e){return typeof FormData<"u"&&e instanceof FormData}const m0="Content-Type",_M="X-Request-URL",TL="text/plain",DL="application/json",ML=`${DL}, ${TL}, */*`;class g0{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;responseType="json";method;params;urlWithParams;transferCache;constructor(t,n,i,s){let c;if(this.url=n,this.method=t.toUpperCase(),function kZ(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||s?(this.body=void 0!==i?i:null,c=s):c=i,c&&(this.reportProgress=!!c.reportProgress,this.withCredentials=!!c.withCredentials,c.responseType&&(this.responseType=c.responseType),c.headers&&(this.headers=c.headers),c.context&&(this.context=c.context),c.params&&(this.params=c.params),this.transferCache=c.transferCache),this.headers??=new ih,this.context??=new AZ,this.params){const d=this.params.toString();if(0===d.length)this.urlWithParams=n;else{const _=n.indexOf("?");this.urlWithParams=n+(-1===_?"?":_<n.length-1?"&":"")+d}}else this.params=new up,this.urlWithParams=n}serializeBody(){return null===this.body?null:"string"==typeof this.body||xL(this.body)||wL(this.body)||CL(this.body)||function RZ(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}(this.body)?this.body:this.body instanceof up?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||CL(this.body)?null:wL(this.body)?this.body.type||null:xL(this.body)?null:"string"==typeof this.body?TL:this.body instanceof up?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?DL:null}clone(t={}){const n=t.method||this.method,i=t.url||this.url,s=t.responseType||this.responseType,c=t.transferCache??this.transferCache,d=void 0!==t.body?t.body:this.body,_=t.withCredentials??this.withCredentials,x=t.reportProgress??this.reportProgress;let E=t.headers||this.headers,R=t.params||this.params;const z=t.context??this.context;return void 0!==t.setHeaders&&(E=Object.keys(t.setHeaders).reduce((V,j)=>V.set(j,t.setHeaders[j]),E)),t.setParams&&(R=Object.keys(t.setParams).reduce((V,j)=>V.set(j,t.setParams[j]),R)),new g0(n,i,d,{params:R,headers:E,context:z,reportProgress:x,responseType:s,withCredentials:_,transferCache:c})}}var hp=function(e){return e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e}(hp||{});class yM{headers;status;statusText;url;ok;type;constructor(t,n=200,i="OK"){this.headers=t.headers||new ih,this.status=void 0!==t.status?t.status:n,this.statusText=t.statusText||i,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class R1 extends yM{constructor(t={}){super(t)}type=hp.ResponseHeader;clone(t={}){return new R1({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class _0 extends yM{body;constructor(t={}){super(t),this.body=void 0!==t.body?t.body:null}type=hp.Response;clone(t={}){return new _0({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class O_ extends yM{name="HttpErrorResponse";message;error;ok=!1;constructor(t){super(t,0,"Unknown Error"),this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function vM(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials,transferCache:e.transferCache}}let L1=(()=>{class e{handler;constructor(n){this.handler=n}request(n,i,s={}){let c;if(n instanceof g0)c=n;else{let x,E;x=s.headers instanceof ih?s.headers:new ih(s.headers),s.params&&(E=s.params instanceof up?s.params:new up({fromObject:s.params})),c=new g0(n,i,void 0!==s.body?s.body:null,{headers:x,context:s.context,params:E,reportProgress:s.reportProgress,responseType:s.responseType||"json",withCredentials:s.withCredentials,transferCache:s.transferCache})}const d=Pi(c).pipe(Jv(x=>this.handler.handle(x)));if(n instanceof g0||"events"===s.observe)return d;const _=d.pipe(ap(x=>x instanceof _0));switch(s.observe||"body"){case"body":switch(c.responseType){case"arraybuffer":return _.pipe(Si(x=>{if(null!==x.body&&!(x.body instanceof ArrayBuffer))throw new Et(2806,!1);return x.body}));case"blob":return _.pipe(Si(x=>{if(null!==x.body&&!(x.body instanceof Blob))throw new Et(2807,!1);return x.body}));case"text":return _.pipe(Si(x=>{if(null!==x.body&&"string"!=typeof x.body)throw new Et(2808,!1);return x.body}));default:return _.pipe(Si(x=>x.body))}case"response":return _;default:throw new Et(2809,!1)}}delete(n,i={}){return this.request("DELETE",n,i)}get(n,i={}){return this.request("GET",n,i)}head(n,i={}){return this.request("HEAD",n,i)}jsonp(n,i){return this.request("JSONP",n,{params:(new up).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,i={}){return this.request("OPTIONS",n,i)}patch(n,i,s={}){return this.request("PATCH",n,vM(s,i))}post(n,i,s={}){return this.request("POST",n,vM(s,i))}put(n,i,s={}){return this.request("PUT",n,vM(s,i))}static \u0275fac=function(i){return new(i||e)(Jn(I1))};static \u0275prov=an({token:e,factory:e.\u0275fac})}return e})();const IL=new sn("");function PL(e,t){return t(e)}const y0=new sn(""),UZ=new sn(""),AL=new sn("",{providedIn:"root",factory:()=>!0});let kL=(()=>{class e extends I1{backend;injector;chain=null;pendingTasks=Ot(fl);contributeToStability=Ot(AL);constructor(n,i){super(),this.backend=n,this.injector=i}handle(n){if(null===this.chain){const i=Array.from(new Set([...this.injector.get(y0),...this.injector.get(UZ,[])]));this.chain=i.reduceRight((s,c)=>function VZ(e,t,n){return(i,s)=>C(n,()=>t(i,c=>e(c,s)))}(s,c,this.injector),PL)}if(this.contributeToStability){const i=this.pendingTasks.add();return this.chain(n,s=>this.backend.handle(s)).pipe(d1(()=>this.pendingTasks.remove(i)))}return this.chain(n,i=>this.backend.handle(i))}static \u0275fac=function(i){return new(i||e)(Jn(P1),Jn(ps))};static \u0275prov=an({token:e,factory:e.\u0275fac})}return e})();const qZ=/^\)\]\}',?\n/,WZ=RegExp(`^${_M}:`,"m");let LL=(()=>{class e{xhrFactory;constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new Et(-2800,!1);const i=this.xhrFactory;return(i.\u0275loadImpl?Aa(i.\u0275loadImpl()):Pi(null)).pipe(Yh(()=>new di(c=>{const d=i.build();if(d.open(n.method,n.urlWithParams),n.withCredentials&&(d.withCredentials=!0),n.headers.forEach((se,le)=>d.setRequestHeader(se,le.join(","))),n.headers.has("Accept")||d.setRequestHeader("Accept",ML),!n.headers.has(m0)){const se=n.detectContentTypeHeader();null!==se&&d.setRequestHeader(m0,se)}if(n.responseType){const se=n.responseType.toLowerCase();d.responseType="json"!==se?se:"text"}const _=n.serializeBody();let x=null;const E=()=>{if(null!==x)return x;const se=d.statusText||"OK",le=new ih(d.getAllResponseHeaders()),de=function YZ(e){return"responseURL"in e&&e.responseURL?e.responseURL:WZ.test(e.getAllResponseHeaders())?e.getResponseHeader(_M):null}(d)||n.url;return x=new R1({headers:le,status:d.status,statusText:se,url:de}),x},R=()=>{let{headers:se,status:le,statusText:de,url:ae}=E(),ze=null;204!==le&&(ze=typeof d.response>"u"?d.responseText:d.response),0===le&&(le=ze?200:0);let Se=le>=200&&le<300;if("json"===n.responseType&&"string"==typeof ze){const ut=ze;ze=ze.replace(qZ,"");try{ze=""!==ze?JSON.parse(ze):null}catch(Nt){ze=ut,Se&&(Se=!1,ze={error:Nt,text:ze})}}Se?(c.next(new _0({body:ze,headers:se,status:le,statusText:de,url:ae||void 0})),c.complete()):c.error(new O_({error:ze,headers:se,status:le,statusText:de,url:ae||void 0}))},z=se=>{const{url:le}=E(),de=new O_({error:se,status:d.status||0,statusText:d.statusText||"Unknown Error",url:le||void 0});c.error(de)};let V=!1;const j=se=>{V||(c.next(E()),V=!0);let le={type:hp.DownloadProgress,loaded:se.loaded};se.lengthComputable&&(le.total=se.total),"text"===n.responseType&&d.responseText&&(le.partialText=d.responseText),c.next(le)},J=se=>{let le={type:hp.UploadProgress,loaded:se.loaded};se.lengthComputable&&(le.total=se.total),c.next(le)};return d.addEventListener("load",R),d.addEventListener("error",z),d.addEventListener("timeout",z),d.addEventListener("abort",z),n.reportProgress&&(d.addEventListener("progress",j),null!==_&&d.upload&&d.upload.addEventListener("progress",J)),d.send(_),c.next({type:hp.Sent}),()=>{d.removeEventListener("error",z),d.removeEventListener("abort",z),d.removeEventListener("load",R),d.removeEventListener("timeout",z),n.reportProgress&&(d.removeEventListener("progress",j),null!==_&&d.upload&&d.upload.removeEventListener("progress",J)),d.readyState!==d.DONE&&d.abort()}})))}static \u0275fac=function(i){return new(i||e)(Jn(Nk))};static \u0275prov=an({token:e,factory:e.\u0275fac})}return e})();const wM=new sn(""),OL=new sn("",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),FL=new sn("",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class NL{}let QZ=(()=>{class e{doc;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(n,i){this.doc=n,this.cookieName=i}getToken(){const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=Lk(n,this.cookieName),this.lastCookieString=n),this.lastToken}static \u0275fac=function(i){return new(i||e)(Jn(su),Jn(OL))};static \u0275prov=an({token:e,factory:e.\u0275fac})}return e})();function JZ(e,t){const n=e.url.toLowerCase();if(!Ot(wM)||"GET"===e.method||"HEAD"===e.method||n.startsWith("http://")||n.startsWith("https://"))return t(e);const i=Ot(NL).getToken(),s=Ot(FL);return null!=i&&!e.headers.has(s)&&(e=e.clone({headers:e.headers.set(s,i)})),t(e)}const kM=/\s+/,qL=[];let RM=(()=>{class e{_ngEl;_renderer;initialClasses=qL;rawClass;stateMap=new Map;constructor(n,i){this._ngEl=n,this._renderer=i}set klass(n){this.initialClasses=null!=n?n.trim().split(kM):qL}set ngClass(n){this.rawClass="string"==typeof n?n.trim().split(kM):n}ngDoCheck(){for(const i of this.initialClasses)this._updateState(i,!0);const n=this.rawClass;if(Array.isArray(n)||n instanceof Set)for(const i of n)this._updateState(i,!0);else if(null!=n)for(const i of Object.keys(n))this._updateState(i,!!n[i]);this._applyStateDiff()}_updateState(n,i){const s=this.stateMap.get(n);void 0!==s?(s.enabled!==i&&(s.changed=!0,s.enabled=i),s.touched=!0):this.stateMap.set(n,{enabled:i,changed:!0,touched:!0})}_applyStateDiff(){for(const n of this.stateMap){const i=n[0],s=n[1];s.changed?(this._toggleClass(i,s.enabled),s.changed=!1):s.touched||(s.enabled&&this._toggleClass(i,!1),this.stateMap.delete(i)),s.touched=!1}}_toggleClass(n,i){(n=n.trim()).length>0&&n.split(kM).forEach(s=>{i?this._renderer.addClass(this._ngEl.nativeElement,s):this._renderer.removeClass(this._ngEl.nativeElement,s)})}static \u0275fac=function(i){return new(i||e)(rn(Rs),rn(Gh))};static \u0275dir=Di({type:e,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return e})();class B7{$implicit;ngForOf;index;count;constructor(t,n,i,s){this.$implicit=t,this.ngForOf=n,this.index=i,this.count=s}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let b0=(()=>{class e{_viewContainer;_template;_differs;set ngForOf(n){this._ngForOf=n,this._ngForOfDirty=!0}set ngForTrackBy(n){this._trackByFn=n}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(n,i,s){this._viewContainer=n,this._template=i,this._differs=s}set ngForTemplate(n){n&&(this._template=n)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;!this._differ&&n&&(this._differ=this._differs.find(n).create(this.ngForTrackBy))}if(this._differ){const n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}_applyChanges(n){const i=this._viewContainer;n.forEachOperation((s,c,d)=>{if(null==s.previousIndex)i.createEmbeddedView(this._template,new B7(s.item,this._ngForOf,-1,-1),null===d?void 0:d);else if(null==d)i.remove(null===c?void 0:c);else if(null!==c){const _=i.get(c);i.move(_,d),YL(_,s)}});for(let s=0,c=i.length;s<c;s++){const _=i.get(s).context;_.index=s,_.count=c,_.ngForOf=this._ngForOf}n.forEachIdentityChange(s=>{YL(i.get(s.currentIndex),s)})}static ngTemplateContextGuard(n,i){return!0}static \u0275fac=function(i){return new(i||e)(rn(Yu),rn($h),rn(CD))};static \u0275dir=Di({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return e})();function YL(e,t){e.context.$implicit=t.item}let Nm=(()=>{class e{_viewContainer;_context=new V7;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(n,i){this._viewContainer=n,this._thenTemplateRef=i}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){XL(n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){XL(n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(n,i){return!0}static \u0275fac=function(i){return new(i||e)(rn(Yu),rn($h))};static \u0275dir=Di({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return e})();class V7{$implicit=null;ngIf=null}function XL(e,t){if(e&&!e.createEmbeddedView)throw new Et(2020,!1)}let zm=(()=>{class e{static \u0275fac=function(i){return new(i||e)};static \u0275mod=Iv({type:e});static \u0275inj=rr({})}return e})();var sh=et(244),h9=(et(484),et(247)),d9=et.n(h9);const f9=["mapContainer"];function p9(e,t){if(1&e){const n=yl();Be(0,"div",5)(1,"div",6)(2,"button",7),xi("click",function(){return q(n),te(ui().toggleLegend())}),er(),Be(3,"svg",8),pn(4,"path",9),We()(),lr(),Be(5,"div",10)(6,"button",11),xi("click",function(){return q(n),te(ui().toggleDenomination(1))}),Be(7,"div",12),pn(8,"img",13),We(),Be(9,"span",14),vt(10),We()(),Be(11,"button",11),xi("click",function(){return q(n),te(ui().toggleDenomination(2))}),Be(12,"div",12),pn(13,"img",15),We(),Be(14,"span",14),vt(15),We()(),Be(16,"button",11),xi("click",function(){return q(n),te(ui().toggleDenomination(3))}),Be(17,"div",12),pn(18,"img",16),We(),Be(19,"span",14),vt(20),We()(),Be(21,"button",11),xi("click",function(){return q(n),te(ui().toggleDenomination(4))}),Be(22,"div",12),pn(23,"img",17),We(),Be(24,"span",14),vt(25),We()(),Be(26,"button",11),xi("click",function(){return q(n),te(ui().toggleDenomination(5))}),Be(27,"div",12),pn(28,"img",18),We(),Be(29,"span",14),vt(30),We()(),Be(31,"button",11),xi("click",function(){return q(n),te(ui().toggleDenomination(6))}),Be(32,"div",12),pn(33,"img",19),We(),Be(34,"span",14),vt(35),We()()()()()}if(2&e){const n=ui();Xt(6),Tr("opacity-50",!n.selectedDenominations.has(1)),Xt(),Tr("border-fuchsia-400",n.selectedDenominations.has(1))("border-slate-600",!n.selectedDenominations.has(1)),Xt(3),wo(n.denomCounts[1]||0),Xt(),Tr("opacity-50",!n.selectedDenominations.has(2)),Xt(),Tr("border-fuchsia-400",n.selectedDenominations.has(2))("border-slate-600",!n.selectedDenominations.has(2)),Xt(3),wo(n.denomCounts[2]||0),Xt(),Tr("opacity-50",!n.selectedDenominations.has(3)),Xt(),Tr("border-fuchsia-400",n.selectedDenominations.has(3))("border-slate-600",!n.selectedDenominations.has(3)),Xt(3),wo(n.denomCounts[3]||0),Xt(),Tr("opacity-50",!n.selectedDenominations.has(4)),Xt(),Tr("border-fuchsia-400",n.selectedDenominations.has(4))("border-slate-600",!n.selectedDenominations.has(4)),Xt(3),wo(n.denomCounts[4]||0),Xt(),Tr("opacity-50",!n.selectedDenominations.has(5)),Xt(),Tr("border-fuchsia-400",n.selectedDenominations.has(5))("border-slate-600",!n.selectedDenominations.has(5)),Xt(3),wo(n.denomCounts[5]||0),Xt(),Tr("opacity-50",!n.selectedDenominations.has(6)),Xt(),Tr("border-fuchsia-400",n.selectedDenominations.has(6))("border-slate-600",!n.selectedDenominations.has(6)),Xt(3),wo(n.denomCounts[6]||0)}}function m9(e,t){if(1&e){const n=yl();Be(0,"button",20),xi("click",function(){return q(n),te(ui().toggleLegend())}),vt(1," Show Legend "),We()}}let g9=(()=>{class e{http;mapContainer;statsUpdated=new ao;map;resizeObserver;allMarkers=[];markerClusterGroup;selectedDenominations=new Set([1,2,3,4,5,6]);denomCounts={};legendVisible=!0;constructor(n){this.http=n}ngOnInit(){}ngAfterViewInit(){this.initializeMap(),this.loadChurchData(),this.setupResizeObserver()}ngOnDestroy(){this.map&&this.map.remove(),this.resizeObserver&&this.resizeObserver.disconnect()}initializeMap(){this.map=sh.map(this.mapContainer.nativeElement,{center:[44.03226794579251,-92.75978994999998],zoom:10,zoomControl:!0,attributionControl:!1}),sh.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19}).addTo(this.map)}loadChurchData(){var n=this;return Pe(function*(){if(!n.map)return;const i="theoviz_kml_cache";try{const s=localStorage.getItem(i);let c="";if(s)console.log("Using cached KML data from localStorage"),c=s;else{console.log("No cache found, fetching KMZ from server...");const x=yield(yield fetch("https://www.google.com/maps/d/kml?mid=1PNd_sJagci84PyKmGC6M5VJtaLMEWxg")).arrayBuffer();console.log("KMZ Data fetched, size:",x.byteLength,"bytes");const E=yield d9().loadAsync(x),R=E.file("doc.kml");if(R)c=yield R.async("text"),console.log("KML content extracted from KMZ");else{const z=Object.keys(E.files).filter(V=>V.endsWith(".kml"));if(z.length>0){const V=E.file(z[0]);V&&(c=yield V.async("text"),console.log("KML content extracted from:",z[0]))}}c?(localStorage.setItem(i,c),console.log("KML cached to localStorage, length:",c.length)):console.warn("No KML file found in KMZ")}c?(console.log("Successfully loaded KML, parsing..."),n.parseAndDisplayKML(c)):(console.warn("No KML content available, using sample data"),n.addSampleChurches())}catch(s){console.error("Error fetching/processing KMZ data:",s),n.addSampleChurches()}})()}parseAndDisplayKML(n){if(this.map)try{const c=(new DOMParser).parseFromString(n,"text/xml").getElementsByTagName("Placemark");console.log(`Found ${c.length} placemarks in KML`);const d=[];for(let _=0;_<c.length;_++){const x=c[_],R=x.getElementsByTagName("name")[0]?.textContent||"Unnamed Location",V=x.getElementsByTagName("description")[0]?.textContent||"",J=x.getElementsByTagName("styleUrl")[0]?.textContent||"";let se;const le=J.match(/#icon-ci-(\d+)/);le&&(se=parseInt(le[1])),console.log("Placemark:",{name:R,styleUrl:J,iconNumber:se});const de=x.getElementsByTagName("coordinates")[0];if(de&&de.textContent){const ae=de.textContent.trim().split(",");if(ae.length>=2){const ze=parseFloat(ae[0]),Se=parseFloat(ae[1]);!isNaN(Se)&&!isNaN(ze)&&d.push({name:R,lat:Se,lng:ze,description:V,iconNumber:se})}}}if(console.log(`Parsed ${d.length} valid church locations`),d.length>0){const _={};d.forEach(E=>{void 0!==E.iconNumber&&(_[E.iconNumber]=(_[E.iconNumber]||0)+1)}),this.denomCounts=_,this.statsUpdated.emit({total:d.length,denominations:_}),this.displayChurches(d);const x=sh.latLngBounds(d.map(E=>[E.lat,E.lng]));this.map.fitBounds(x,{padding:[50,50]})}else console.warn("No valid churches found, using sample data"),this.addSampleChurches()}catch(i){console.error("Error parsing KML:",i),this.addSampleChurches()}}toggleDenomination(n){this.selectedDenominations.has(n)?this.selectedDenominations.delete(n):this.selectedDenominations.add(n),this.filterMarkers()}toggleLegend(){this.legendVisible=!this.legendVisible}filterMarkers(){!this.map||!this.markerClusterGroup||(this.markerClusterGroup.clearLayers(),this.allMarkers.forEach(n=>{const i=n._iconNumber;(!i||this.selectedDenominations.has(i))&&this.markerClusterGroup.addLayer(n)}))}displayChurches(n){this.map&&(this.markerClusterGroup=sh.markerClusterGroup({maxClusterRadius:80,spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,zoomToBoundsOnClick:!0,iconCreateFunction:i=>{const s=i.getChildCount();let c="small";return s>10&&(c="medium"),s>50&&(c="large"),sh.divIcon({html:`<div class="cluster-icon cluster-${c}">${s}</div>`,className:"marker-cluster",iconSize:sh.point(40,40)})}}),this.allMarkers=[],n.forEach(i=>{let s;s=void 0!==i.iconNumber&&i.iconNumber>=1&&i.iconNumber<=8?sh.icon({iconUrl:`./icon-${i.iconNumber}.png`,iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}):sh.divIcon({html:'\n            <div class="church-marker">\n              <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">\n                <path d="M18,15H16V12H18M6,15H8V12H6M20,19H4V8L12,3L20,8V19Z" />\n              </svg>\n            </div>\n          ',className:"church-icon",iconSize:[32,32],iconAnchor:[16,16]});const c=sh.marker([i.lat,i.lng],{icon:s});c._iconNumber=i.iconNumber,c.bindPopup(`\n        <div class="church-popup">\n          <h3 class="font-semibold text-slate-800 mb-2">${i.name}</h3>\n          ${i.description?`<p class="text-sm text-slate-600 leading-relaxed mb-2">${i.description}</p>`:""}\n          <div class="mt-3 flex gap-2">\n            <button class="px-3 py-1 bg-fuchsia-500 text-white text-xs rounded-md hover:bg-fuchsia-600 transition-colors">\n              Visit Website\n            </button>\n            <button class="px-3 py-1 bg-slate-200 text-slate-700 text-xs rounded-md hover:bg-slate-300 transition-colors">\n              Get Directions\n            </button>\n          </div>\n        </div>\n      `,{maxWidth:300,className:"custom-popup"}),this.allMarkers.push(c),this.markerClusterGroup.addLayer(c)}),this.map.addLayer(this.markerClusterGroup))}addSampleChurches(){if(!this.map)return;const i=sh.divIcon({html:'\n        <div class="church-marker">\n          <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">\n            <path d="M18,15H16V12H18M6,15H8V12H6M20,19H4V8L12,3L20,8V19Z" />\n          </svg>\n        </div>\n      ',className:"church-icon",iconSize:[32,32],iconAnchor:[16,16]});[{name:"Grace Reformed Church",lat:44.03226794579251,lng:-92.75978994999998,denomination:"Reformed",description:"A faithful congregation committed to biblical truth and reformed theology."},{name:"Bethany Baptist Church",lat:44.025,lng:-92.765,denomination:"Baptist",description:"Sound biblical preaching and traditional Baptist values."},{name:"Trinity Presbyterian",lat:44.038,lng:-92.745,denomination:"Presbyterian",description:"Presbyterian Church in America congregation with solid doctrine."},{name:"Christ Lutheran Church",lat:44.028,lng:-92.77,denomination:"Lutheran",description:"Missouri Synod Lutheran church holding to biblical inerrancy."},{name:"St. Paul's Anglican",lat:44.035,lng:-92.76,denomination:"Anglican",description:"Traditional Anglican worship with orthodox theology."}].forEach(s=>{sh.marker([s.lat,s.lng],{icon:i}).addTo(this.map).bindPopup(`\n        <div class="church-popup">\n          <h3 class="font-semibold text-slate-800 mb-2">${s.name}</h3>\n          <p class="text-sm text-violet-600 font-medium mb-2">${s.denomination}</p>\n          <p class="text-sm text-slate-600 leading-relaxed">${s.description}</p>\n          <div class="mt-3 flex gap-2">\n            <button class="px-3 py-1 bg-fuchsia-500 text-white text-xs rounded-md hover:bg-fuchsia-600 transition-colors">\n              Visit Website\n            </button>\n            <button class="px-3 py-1 bg-slate-200 text-slate-700 text-xs rounded-md hover:bg-slate-300 transition-colors">\n              Get Directions\n            </button>\n          </div>\n        </div>\n      `,{maxWidth:300,className:"custom-popup"})})}setupResizeObserver(){this.map&&(this.resizeObserver=new ResizeObserver(()=>{this.map?.invalidateSize()}),this.resizeObserver.observe(this.mapContainer.nativeElement))}downloadKML(n){const i=new Blob([n],{type:"application/vnd.google-earth.kml+xml"}),s=window.URL.createObjectURL(i),c=document.createElement("a");c.href=s,c.download="churches.kml",document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(s),console.log("KML file download triggered")}static \u0275fac=function(i){return new(i||e)(rn(L1))};static \u0275cmp=_l({type:e,selectors:[["app-church-map"]],viewQuery:function(i,s){if(1&i&&np(f9,7),2&i){let c;zd(c=Bd())&&(s.mapContainer=c.first)}},outputs:{statsUpdated:"statsUpdated"},decls:5,vars:2,consts:[["mapContainer",""],[1,"relative","w-full","h-full","group"],[1,"w-full","h-full","overflow-hidden"],["class","absolute bottom-4 left-1/2 transform -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none group-hover:pointer-events-auto z-[1000]",4,"ngIf"],["class","absolute bottom-4 left-1/2 transform -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none group-hover:pointer-events-auto z-[1000] bg-slate-800/95 backdrop-blur-md rounded-lg px-4 py-2 border border-violet-500/30 shadow-xl hover:bg-slate-700 text-slate-200 text-sm font-medium",3,"click",4,"ngIf"],[1,"absolute","bottom-4","left-1/2","transform","-translate-x-1/2","opacity-0","group-hover:opacity-100","transition-opacity","duration-300","pointer-events-none","group-hover:pointer-events-auto","z-[1000]"],[1,"bg-slate-800/95","backdrop-blur-md","rounded-xl","px-4","py-3","border","border-violet-500/30","shadow-2xl","relative"],[1,"absolute","-top-2","-right-2","w-6","h-6","bg-slate-700","hover:bg-slate-600","rounded-full","flex","items-center","justify-center","text-slate-300","hover:text-white","transition-colors","border","border-violet-500/30",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-3","h-3"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"flex","items-center","gap-3"],[1,"flex","flex-col","items-center","gap-1","transition-all","duration-200","hover:scale-110",3,"click"],[1,"w-8","h-8","rounded-md","bg-slate-700/50","border","flex","items-center","justify-center"],["src","./icon-1.png","alt","Reformed",1,"w-6","h-6","object-contain"],[1,"text-[8px]","text-slate-300"],["src","./icon-2.png","alt","Lutheran",1,"w-6","h-6","object-contain"],["src","./icon-3.png","alt","Anglican",1,"w-6","h-6","object-contain"],["src","./icon-4.png","alt","Baptist",1,"w-6","h-6","object-contain"],["src","./icon-5.png","alt","Methodist",1,"w-6","h-6","object-contain"],["src","./icon-6.png","alt","Presbyterian",1,"w-6","h-6","object-contain"],[1,"absolute","bottom-4","left-1/2","transform","-translate-x-1/2","opacity-0","group-hover:opacity-100","transition-opacity","duration-300","pointer-events-none","group-hover:pointer-events-auto","z-[1000]","bg-slate-800/95","backdrop-blur-md","rounded-lg","px-4","py-2","border","border-violet-500/30","shadow-xl","hover:bg-slate-700","text-slate-200","text-sm","font-medium",3,"click"]],template:function(i,s){1&i&&(Be(0,"div",1),pn(1,"div",2,0),ws(3,p9,36,42,"div",3)(4,m9,2,0,"button",4),We()),2&i&&(Xt(3),Mi("ngIf",s.legendVisible),Xt(),Mi("ngIf",!s.legendVisible))},dependencies:[zm,Nm],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}.group[_ngcontent-%COMP%]{display:block;width:100%;height:100%}[_nghost-%COMP%]     .church-marker{width:32px;height:32px;background:linear-gradient(135deg,#e879f9,#c026d3);border-radius:50%;display:flex;align-items:center;justify-content:center;border:2px solid #ffffff;box-shadow:0 4px 12px #e879f94d;transition:all .2s ease}[_nghost-%COMP%]     .church-marker:hover{transform:scale(1.1);box-shadow:0 6px 16px #e879f966}[_nghost-%COMP%]     .custom-popup .leaflet-popup-content-wrapper{background:#fff;border-radius:12px;box-shadow:0 8px 32px #00000026;border:1px solid #e2e8f0}[_nghost-%COMP%]     .custom-popup .leaflet-popup-content{margin:16px;font-family:Roboto,Segoe UI,sans-serif}[_nghost-%COMP%]     .custom-popup .leaflet-popup-tip{background:#fff;border:1px solid #e2e8f0}[_nghost-%COMP%]     .church-popup h3{font-size:16px;font-weight:600;color:#1e293b;margin-bottom:8px}[_nghost-%COMP%]     .church-popup p{font-size:14px;line-height:1.4}[_nghost-%COMP%]     .leaflet-control-zoom a{background-color:#1e293b;border:1px solid #475569;color:#e2e8f0}[_nghost-%COMP%]     .leaflet-control-zoom a:hover{background-color:#334155;color:#f8fafc}[_nghost-%COMP%]     .marker-cluster{background:transparent}[_nghost-%COMP%]     .cluster-icon{display:flex;align-items:center;justify-content:center;width:40px;height:40px;border-radius:50%;font-weight:700;color:#fff;box-shadow:0 4px 12px #0003;transition:all .2s ease}[_nghost-%COMP%]     .cluster-icon:hover{transform:scale(1.1)}[_nghost-%COMP%]     .cluster-small{background:linear-gradient(135deg,#a78bfa,#7c3aed);font-size:14px}[_nghost-%COMP%]     .cluster-medium{background:linear-gradient(135deg,#e879f9,#c026d3);font-size:16px}[_nghost-%COMP%]     .cluster-large{background:linear-gradient(135deg,#f472b6,#db2777);font-size:18px}"]})}return e})();function _9(){}function zM(e){return null==e?_9:function(){return this.querySelector(e)}}function JL(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}function v9(){return[]}function eO(e){return null==e?v9:function(){return this.querySelectorAll(e)}}function tO(e){return function(){return this.matches(e)}}function nO(e){return function(t){return t.matches(e)}}var w9=Array.prototype.find;function T9(){return this.firstElementChild}var M9=Array.prototype.filter;function E9(){return Array.from(this.children)}function iO(e){return new Array(e.length)}function Z1(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function R9(e,t,n,i,s,c){for(var _,d=0,x=t.length,E=c.length;d<E;++d)(_=t[d])?(_.__data__=c[d],i[d]=_):n[d]=new Z1(e,c[d]);for(;d<x;++d)(_=t[d])&&(s[d]=_)}function L9(e,t,n,i,s,c,d){var _,x,j,E=new Map,R=t.length,z=c.length,V=new Array(R);for(_=0;_<R;++_)(x=t[_])&&(V[_]=j=d.call(x,x.__data__,_,t)+"",E.has(j)?s[_]=x:E.set(j,x));for(_=0;_<z;++_)j=d.call(e,c[_],_,c)+"",(x=E.get(j))?(i[_]=x,x.__data__=c[_],E.delete(j)):n[_]=new Z1(e,c[_]);for(_=0;_<R;++_)(x=t[_])&&E.get(V[_])===x&&(s[_]=x)}function O9(e){return e.__data__}function N9(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function $9(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}Z1.prototype={constructor:Z1,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var BM="http://www.w3.org/1999/xhtml";const rO={svg:"http://www.w3.org/2000/svg",xhtml:BM,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function q1(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),rO.hasOwnProperty(t)?{space:rO[t],local:e}:e}function X9(e){return function(){this.removeAttribute(e)}}function K9(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Q9(e,t){return function(){this.setAttribute(e,t)}}function J9(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function eq(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function tq(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function oO(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function iq(e){return function(){this.style.removeProperty(e)}}function rq(e,t,n){return function(){this.style.setProperty(e,t,n)}}function oq(e,t,n){return function(){var i=t.apply(this,arguments);null==i?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function N_(e,t){return e.style.getPropertyValue(t)||oO(e).getComputedStyle(e,null).getPropertyValue(t)}function aq(e){return function(){delete this[e]}}function lq(e,t){return function(){this[e]=t}}function cq(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function sO(e){return e.trim().split(/^|\s+/)}function VM(e){return e.classList||new aO(e)}function aO(e){this._node=e,this._names=sO(e.getAttribute("class")||"")}function lO(e,t){for(var n=VM(e),i=-1,s=t.length;++i<s;)n.add(t[i])}function cO(e,t){for(var n=VM(e),i=-1,s=t.length;++i<s;)n.remove(t[i])}function hq(e){return function(){lO(this,e)}}function dq(e){return function(){cO(this,e)}}function fq(e,t){return function(){(t.apply(this,arguments)?lO:cO)(this,e)}}function mq(){this.textContent=""}function gq(e){return function(){this.textContent=e}}function _q(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function vq(){this.innerHTML=""}function bq(e){return function(){this.innerHTML=e}}function xq(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function Cq(){this.nextSibling&&this.parentNode.appendChild(this)}function Dq(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Eq(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===BM&&t.documentElement.namespaceURI===BM?t.createElement(e):t.createElementNS(n,e)}}function Sq(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function uO(e){var t=q1(e);return(t.local?Sq:Eq)(t)}function Pq(){return null}function kq(){var e=this.parentNode;e&&e.removeChild(this)}function Lq(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Oq(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Vq(e){return function(){var t=this.__on;if(t){for(var c,n=0,i=-1,s=t.length;n<s;++n)c=t[n],e.type&&c.type!==e.type||c.name!==e.name?t[++i]=c:this.removeEventListener(c.type,c.listener,c.options);++i?t.length=i:delete this.__on}}}function jq(e,t,n){return function(){var s,i=this.__on,c=function zq(e){return function(t){e.call(this,t,this.__data__)}}(t);if(i)for(var d=0,_=i.length;d<_;++d)if((s=i[d]).type===e.type&&s.name===e.name)return this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=c,s.options=n),void(s.value=t);this.addEventListener(e.type,c,n),s={type:e.type,name:e.name,value:t,listener:c,options:n},i?i.push(s):this.__on=[s]}}function hO(e,t,n){var i=oO(e),s=i.CustomEvent;"function"==typeof s?s=new s(t,n):(s=i.document.createEvent("Event"),n?(s.initEvent(t,n.bubbles,n.cancelable),s.detail=n.detail):s.initEvent(t,!1,!1)),e.dispatchEvent(s)}function $q(e,t){return function(){return hO(this,e,t)}}function Gq(e,t){return function(){return hO(this,e,t.apply(this,arguments))}}aO.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var jM=[null];function Cl(e,t){this._groups=e,this._parents=t}function dO(){return new Cl([[document.documentElement]],jM)}Cl.prototype=dO.prototype={constructor:Cl,select:function y9(e){"function"!=typeof e&&(e=zM(e));for(var t=this._groups,n=t.length,i=new Array(n),s=0;s<n;++s)for(var x,E,c=t[s],d=c.length,_=i[s]=new Array(d),R=0;R<d;++R)(x=c[R])&&(E=e.call(x,x.__data__,R,c))&&("__data__"in x&&(E.__data__=x.__data__),_[R]=E);return new Cl(i,this._parents)},selectAll:function x9(e){e="function"==typeof e?function b9(e){return function(){return JL(e.apply(this,arguments))}}(e):eO(e);for(var t=this._groups,n=t.length,i=[],s=[],c=0;c<n;++c)for(var x,d=t[c],_=d.length,E=0;E<_;++E)(x=d[E])&&(i.push(e.call(x,x.__data__,E,d)),s.push(x));return new Cl(i,s)},selectChild:function D9(e){return this.select(null==e?T9:function C9(e){return function(){return w9.call(this.children,e)}}("function"==typeof e?e:nO(e)))},selectChildren:function I9(e){return this.selectAll(null==e?E9:function S9(e){return function(){return M9.call(this.children,e)}}("function"==typeof e?e:nO(e)))},filter:function P9(e){"function"!=typeof e&&(e=tO(e));for(var t=this._groups,n=t.length,i=new Array(n),s=0;s<n;++s)for(var x,c=t[s],d=c.length,_=i[s]=[],E=0;E<d;++E)(x=c[E])&&e.call(x,x.__data__,E,c)&&_.push(x);return new Cl(i,this._parents)},data:function F9(e,t){if(!arguments.length)return Array.from(this,O9);var n=t?L9:R9,i=this._parents,s=this._groups;"function"!=typeof e&&(e=function k9(e){return function(){return e}}(e));for(var c=s.length,d=new Array(c),_=new Array(c),x=new Array(c),E=0;E<c;++E){var R=i[E],z=s[E],V=z.length,j=N9(e.call(R,R&&R.__data__,E,i)),J=j.length,se=_[E]=new Array(J),le=d[E]=new Array(J);n(R,z,se,le,x[E]=new Array(V),j,t);for(var Se,ut,ae=0,ze=0;ae<J;++ae)if(Se=se[ae]){for(ae>=ze&&(ze=ae+1);!(ut=le[ze])&&++ze<J;);Se._next=ut||null}}return(d=new Cl(d,i))._enter=_,d._exit=x,d},enter:function A9(){return new Cl(this._enter||this._groups.map(iO),this._parents)},exit:function z9(){return new Cl(this._exit||this._groups.map(iO),this._parents)},join:function B9(e,t,n){var i=this.enter(),s=this,c=this.exit();return"function"==typeof e?(i=e(i))&&(i=i.selection()):i=i.append(e+""),null!=t&&(s=t(s))&&(s=s.selection()),null==n?c.remove():n(c),i&&s?i.merge(s).order():s},merge:function V9(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,s=n.length,d=Math.min(s,i.length),_=new Array(s),x=0;x<d;++x)for(var j,E=n[x],R=i[x],z=E.length,V=_[x]=new Array(z),J=0;J<z;++J)(j=E[J]||R[J])&&(V[J]=j);for(;x<s;++x)_[x]=n[x];return new Cl(_,this._parents)},selection:function qq(){return this},order:function j9(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var d,i=e[t],s=i.length-1,c=i[s];--s>=0;)(d=i[s])&&(c&&4^d.compareDocumentPosition(c)&&c.parentNode.insertBefore(d,c),c=d);return this},sort:function U9(e){function t(z,V){return z&&V?e(z.__data__,V.__data__):!z-!V}e||(e=$9);for(var n=this._groups,i=n.length,s=new Array(i),c=0;c<i;++c){for(var E,d=n[c],_=d.length,x=s[c]=new Array(_),R=0;R<_;++R)(E=d[R])&&(x[R]=E);x.sort(t)}return new Cl(s,this._parents).order()},call:function G9(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function H9(){return Array.from(this)},node:function Z9(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],s=0,c=i.length;s<c;++s){var d=i[s];if(d)return d}return null},size:function q9(){let e=0;for(const t of this)++e;return e},empty:function W9(){return!this.node()},each:function Y9(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var _,s=t[n],c=0,d=s.length;c<d;++c)(_=s[c])&&e.call(_,_.__data__,c,s);return this},attr:function nq(e,t){var n=q1(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==t?n.local?K9:X9:"function"==typeof t?n.local?tq:eq:n.local?J9:Q9)(n,t))},style:function sq(e,t,n){return arguments.length>1?this.each((null==t?iq:"function"==typeof t?oq:rq)(e,t,n??"")):N_(this.node(),e)},property:function uq(e,t){return arguments.length>1?this.each((null==t?aq:"function"==typeof t?cq:lq)(e,t)):this.node()[e]},classed:function pq(e,t){var n=sO(e+"");if(arguments.length<2){for(var i=VM(this.node()),s=-1,c=n.length;++s<c;)if(!i.contains(n[s]))return!1;return!0}return this.each(("function"==typeof t?fq:t?hq:dq)(n,t))},text:function yq(e){return arguments.length?this.each(null==e?mq:("function"==typeof e?_q:gq)(e)):this.node().textContent},html:function wq(e){return arguments.length?this.each(null==e?vq:("function"==typeof e?xq:bq)(e)):this.node().innerHTML},raise:function Tq(){return this.each(Cq)},lower:function Mq(){return this.each(Dq)},append:function Iq(e){var t="function"==typeof e?e:uO(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function Aq(e,t){var n="function"==typeof e?e:uO(e),i=null==t?Pq:"function"==typeof t?t:zM(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})},remove:function Rq(){return this.each(kq)},clone:function Fq(e){return this.select(e?Oq:Lq)},datum:function Nq(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function Uq(e,t,n){var s,d,i=function Bq(e){return e.trim().split(/^|\s+/).map(function(t){var n="",i=t.indexOf(".");return i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),{type:t,name:n}})}(e+""),c=i.length;if(!(arguments.length<2)){for(_=t?jq:Vq,s=0;s<c;++s)this.each(_(i[s],t,n));return this}var _=this.node().__on;if(_)for(var R,x=0,E=_.length;x<E;++x)for(s=0,R=_[x];s<c;++s)if((d=i[s]).type===R.type&&d.name===R.name)return R.value},dispatch:function Hq(e,t){return this.each(("function"==typeof t?Gq:$q)(e,t))},[Symbol.iterator]:function*Zq(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var d,i=e[t],s=0,c=i.length;s<c;++s)(d=i[s])&&(yield d)}};const x0=dO;var Wq={value:()=>{}};function fO(){for(var i,e=0,t=arguments.length,n={};e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new W1(n)}function W1(e){this._=e}function Xq(e,t){for(var s,n=0,i=e.length;n<i;++n)if((s=e[n]).name===t)return s.value}function pO(e,t,n){for(var i=0,s=e.length;i<s;++i)if(e[i].name===t){e[i]=Wq,e=e.slice(0,i).concat(e.slice(i+1));break}return null!=n&&e.push({name:t,value:n}),e}W1.prototype=fO.prototype={constructor:W1,on:function(e,t){var s,n=this._,i=function Yq(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",s=n.indexOf(".");if(s>=0&&(i=n.slice(s+1),n=n.slice(0,s)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}(e+"",n),c=-1,d=i.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++c<d;)if(s=(e=i[c]).type)n[s]=pO(n[s],e.name,t);else if(null==t)for(s in n)n[s]=pO(n[s],e.name,null);return this}for(;++c<d;)if((s=(e=i[c]).type)&&(s=Xq(n[s],e.name)))return s},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new W1(e)},call:function(e,t){if((s=arguments.length-2)>0)for(var s,c,n=new Array(s),i=0;i<s;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=0,s=(c=this._[e]).length;i<s;++i)c[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],s=0,c=i.length;s<c;++s)i[s].value.apply(t,n)}};const Y1=fO;var X1,T0,z_=0,w0=0,C0=0,K1=0,Bm=0,Q1=0,D0="object"==typeof performance&&performance.now?performance:Date,gO="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function UM(){return Bm||(gO(Kq),Bm=D0.now()+Q1)}function Kq(){Bm=0}function J1(){this._call=this._time=this._next=null}function $M(e,t,n){var i=new J1;return i.restart(e,t,n),i}function _O(){Bm=(K1=D0.now())+Q1,z_=w0=0;try{!function Qq(){UM(),++z_;for(var t,e=X1;e;)(t=Bm-e._time)>=0&&e._call.call(void 0,t),e=e._next;--z_}()}finally{z_=0,function eW(){for(var e,n,t=X1,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:X1=n);T0=e,GM(i)}(),Bm=0}}function Jq(){var e=D0.now(),t=e-K1;t>1e3&&(Q1-=t,K1=e)}function GM(e){z_||(w0&&(w0=clearTimeout(w0)),e-Bm>24?(e<1/0&&(w0=setTimeout(_O,e-D0.now()-Q1)),C0&&(C0=clearInterval(C0))):(C0||(K1=D0.now(),C0=setInterval(Jq,1e3)),z_=1,gO(_O)))}function yO(e,t,n){var i=new J1;return i.restart(s=>{i.stop(),e(s+t)},t=null==t?0:+t,n),i}J1.prototype=$M.prototype={constructor:J1,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?UM():+n)+(null==t?0:+t),!this._next&&T0!==this&&(T0?T0._next=this:X1=this,T0=this),this._call=e,this._time=n,GM()},stop:function(){this._call&&(this._call=null,this._time=1/0,GM())}};var tW=Y1("start","end","cancel","interrupt"),nW=[];function nw(e,t,n,i,s,c){var d=e.__transition;if(d){if(n in d)return}else e.__transition={};!function iW(e,t,n){var s,i=e.__transition;function d(E){var R,z,V,j;if(1!==n.state)return x();for(R in i)if((j=i[R]).name===n.name){if(3===j.state)return yO(d);4===j.state?(j.state=6,j.timer.stop(),j.on.call("interrupt",e,e.__data__,j.index,j.group),delete i[R]):+R<t&&(j.state=6,j.timer.stop(),j.on.call("cancel",e,e.__data__,j.index,j.group),delete i[R])}if(yO(function(){3===n.state&&(n.state=4,n.timer.restart(_,n.delay,n.time),_(E))}),n.state=2,n.on.call("start",e,e.__data__,n.index,n.group),2===n.state){for(n.state=3,s=new Array(V=n.tween.length),R=0,z=-1;R<V;++R)(j=n.tween[R].value.call(e,e.__data__,n.index,n.group))&&(s[++z]=j);s.length=z+1}}function _(E){for(var R=E<n.duration?n.ease.call(null,E/n.duration):(n.timer.restart(x),n.state=5,1),z=-1,V=s.length;++z<V;)s[z].call(e,R);5===n.state&&(n.on.call("end",e,e.__data__,n.index,n.group),x())}function x(){for(var E in n.state=6,n.timer.stop(),delete i[t],i)return;delete e.__transition}i[t]=n,n.timer=$M(function c(E){n.state=1,n.timer.restart(d,n.delay,n.time),n.delay<=E&&d(E-n.delay)},0,n.time)}(e,n,{name:t,index:i,group:s,on:tW,tween:nW,time:c.time,delay:c.delay,duration:c.duration,ease:c.ease,timer:null,state:0})}function qM(e,t){var n=ah(e,t);if(n.state>0)throw new Error("too late; already scheduled");return n}function Jh(e,t){var n=ah(e,t);if(n.state>3)throw new Error("too late; already running");return n}function ah(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function iw(e,t){var i,s,d,n=e.__transition,c=!0;if(n){for(d in t=null==t?null:t+"",n)(i=n[d]).name===t?(s=i.state>2&&i.state<5,i.state=6,i.timer.stop(),i.on.call(s?"interrupt":"cancel",e,e.__data__,i.index,i.group),delete n[d]):c=!1;c&&delete e.__transition}}function fp(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var rw,wO=180/Math.PI,WM={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function CO(e,t,n,i,s,c){var d,_,x;return(d=Math.sqrt(e*e+t*t))&&(e/=d,t/=d),(x=e*n+t*i)&&(n-=e*x,i-=t*x),(_=Math.sqrt(n*n+i*i))&&(n/=_,i/=_,x/=_),e*i<t*n&&(e=-e,t=-t,x=-x,d=-d),{translateX:s,translateY:c,rotate:Math.atan2(t,e)*wO,skewX:Math.atan(x)*wO,scaleX:d,scaleY:_}}function TO(e,t,n,i){function s(E){return E.length?E.pop()+" ":""}return function(E,R){var z=[],V=[];return E=e(E),R=e(R),function c(E,R,z,V,j,J){if(E!==z||R!==V){var se=j.push("translate(",null,t,null,n);J.push({i:se-4,x:fp(E,z)},{i:se-2,x:fp(R,V)})}else(z||V)&&j.push("translate("+z+t+V+n)}(E.translateX,E.translateY,R.translateX,R.translateY,z,V),function d(E,R,z,V){E!==R?(E-R>180?R+=360:R-E>180&&(E+=360),V.push({i:z.push(s(z)+"rotate(",null,i)-2,x:fp(E,R)})):R&&z.push(s(z)+"rotate("+R+i)}(E.rotate,R.rotate,z,V),function _(E,R,z,V){E!==R?V.push({i:z.push(s(z)+"skewX(",null,i)-2,x:fp(E,R)}):R&&z.push(s(z)+"skewX("+R+i)}(E.skewX,R.skewX,z,V),function x(E,R,z,V,j,J){if(E!==z||R!==V){var se=j.push(s(j)+"scale(",null,",",null,")");J.push({i:se-4,x:fp(E,z)},{i:se-2,x:fp(R,V)})}else(1!==z||1!==V)&&j.push(s(j)+"scale("+z+","+V+")")}(E.scaleX,E.scaleY,R.scaleX,R.scaleY,z,V),E=R=null,function(j){for(var le,J=-1,se=V.length;++J<se;)z[(le=V[J]).i]=le.x(j);return z.join("")}}}var aW=TO(function oW(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?WM:CO(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),lW=TO(function sW(e){return null!=e&&(rw||(rw=document.createElementNS("http://www.w3.org/2000/svg","g")),rw.setAttribute("transform",e),e=rw.transform.baseVal.consolidate())?CO((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):WM},", ",")",")");function cW(e,t){var n,i;return function(){var s=Jh(this,e),c=s.tween;if(c!==n)for(var d=0,_=(i=n=c).length;d<_;++d)if(i[d].name===t){(i=i.slice()).splice(d,1);break}s.tween=i}}function uW(e,t,n){var i,s;if("function"!=typeof n)throw new Error;return function(){var c=Jh(this,e),d=c.tween;if(d!==i){s=(i=d).slice();for(var _={name:t,value:n},x=0,E=s.length;x<E;++x)if(s[x].name===t){s[x]=_;break}x===E&&s.push(_)}c.tween=s}}function YM(e,t,n){var i=e._id;return e.each(function(){var s=Jh(this,i);(s.value||(s.value={}))[t]=n.apply(this,arguments)}),function(s){return ah(s,i).value[t]}}function XM(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function DO(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function M0(){}var ow=1/.7,B_="\\s*([+-]?\\d+)\\s*",S0="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ed="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",dW=/^#([0-9a-f]{3,8})$/,fW=new RegExp(`^rgb\\(${B_},${B_},${B_}\\)$`),pW=new RegExp(`^rgb\\(${ed},${ed},${ed}\\)$`),mW=new RegExp(`^rgba\\(${B_},${B_},${B_},${S0}\\)$`),gW=new RegExp(`^rgba\\(${ed},${ed},${ed},${S0}\\)$`),_W=new RegExp(`^hsl\\(${S0},${ed},${ed}\\)$`),yW=new RegExp(`^hsla\\(${S0},${ed},${ed},${S0}\\)$`),MO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function EO(){return this.rgb().formatHex()}function SO(){return this.rgb().formatRgb()}function I0(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=dW.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?IO(t):3===n?new nc(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?sw(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?sw(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=fW.exec(e))?new nc(t[1],t[2],t[3],1):(t=pW.exec(e))?new nc(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=mW.exec(e))?sw(t[1],t[2],t[3],t[4]):(t=gW.exec(e))?sw(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=_W.exec(e))?kO(t[1],t[2]/100,t[3]/100,1):(t=yW.exec(e))?kO(t[1],t[2]/100,t[3]/100,t[4]):MO.hasOwnProperty(e)?IO(MO[e]):"transparent"===e?new nc(NaN,NaN,NaN,0):null}function IO(e){return new nc(e>>16&255,e>>8&255,255&e,1)}function sw(e,t,n,i){return i<=0&&(e=t=n=NaN),new nc(e,t,n,i)}function aw(e,t,n,i){return 1===arguments.length?function xW(e){return e instanceof M0||(e=I0(e)),e?new nc((e=e.rgb()).r,e.g,e.b,e.opacity):new nc}(e):new nc(e,t,n,i??1)}function nc(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}function PO(){return`#${jm(this.r)}${jm(this.g)}${jm(this.b)}`}function AO(){const e=lw(this.opacity);return`${1===e?"rgb(":"rgba("}${Vm(this.r)}, ${Vm(this.g)}, ${Vm(this.b)}${1===e?")":`, ${e})`}`}function lw(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Vm(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function jm(e){return((e=Vm(e))<16?"0":"")+e.toString(16)}function kO(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new lh(e,t,n,i)}function RO(e){if(e instanceof lh)return new lh(e.h,e.s,e.l,e.opacity);if(e instanceof M0||(e=I0(e)),!e)return new lh;if(e instanceof lh)return e;var t=(e=e.rgb()).r/255,n=e.g/255,i=e.b/255,s=Math.min(t,n,i),c=Math.max(t,n,i),d=NaN,_=c-s,x=(c+s)/2;return _?(d=t===c?(n-i)/_+6*(n<i):n===c?(i-t)/_+2:(t-n)/_+4,_/=x<.5?c+s:2-c-s,d*=60):_=x>0&&x<1?0:d,new lh(d,_,x,e.opacity)}function lh(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function LO(e){return(e=(e||0)%360)<0?e+360:e}function cw(e){return Math.max(0,Math.min(1,e||0))}function KM(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function OO(e,t,n,i,s){var c=e*e,d=c*e;return((1-3*e+3*c-d)*t+(4-6*c+3*d)*n+(1+3*e+3*c-3*d)*i+d*s)/6}XM(M0,I0,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:EO,formatHex:EO,formatHex8:function vW(){return this.rgb().formatHex8()},formatHsl:function bW(){return RO(this).formatHsl()},formatRgb:SO,toString:SO}),XM(nc,aw,DO(M0,{brighter(e){return e=null==e?ow:Math.pow(ow,e),new nc(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new nc(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new nc(Vm(this.r),Vm(this.g),Vm(this.b),lw(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:PO,formatHex:PO,formatHex8:function wW(){return`#${jm(this.r)}${jm(this.g)}${jm(this.b)}${jm(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:AO,toString:AO})),XM(lh,function CW(e,t,n,i){return 1===arguments.length?RO(e):new lh(e,t,n,i??1)},DO(M0,{brighter(e){return e=null==e?ow:Math.pow(ow,e),new lh(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new lh(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,s=2*n-i;return new nc(KM(e>=240?e-240:e+120,s,i),KM(e,s,i),KM(e<120?e+240:e-120,s,i),this.opacity)},clamp(){return new lh(LO(this.h),cw(this.s),cw(this.l),lw(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=lw(this.opacity);return`${1===e?"hsl(":"hsla("}${LO(this.h)}, ${100*cw(this.s)}%, ${100*cw(this.l)}%${1===e?")":`, ${e})`}`}}));const FO=e=>()=>e;function zO(e,t){var n=t-e;return n?function NO(e,t){return function(n){return e+n*t}}(e,n):FO(isNaN(e)?t:e)}const BO=function e(t){var n=function EW(e){return 1==(e=+e)?zO:function(t,n){return n-t?function MW(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}(t,n,e):FO(isNaN(t)?n:t)}}(t);function i(s,c){var d=n((s=aw(s)).r,(c=aw(c)).r),_=n(s.g,c.g),x=n(s.b,c.b),E=zO(s.opacity,c.opacity);return function(R){return s.r=d(R),s.g=_(R),s.b=x(R),s.opacity=E(R),s+""}}return i.gamma=e,i}(1);function VO(e){return function(t){var d,_,n=t.length,i=new Array(n),s=new Array(n),c=new Array(n);for(d=0;d<n;++d)_=aw(t[d]),i[d]=_.r||0,s[d]=_.g||0,c[d]=_.b||0;return i=e(i),s=e(s),c=e(c),_.opacity=1,function(x){return _.r=i(x),_.g=s(x),_.b=c(x),_+""}}}VO(function TW(e){var t=e.length-1;return function(n){var i=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),s=e[i],c=e[i+1];return OO((n-i/t)*t,i>0?e[i-1]:2*s-c,s,c,i<t-1?e[i+2]:2*c-s)}}),VO(function DW(e){var t=e.length;return function(n){var i=Math.floor(((n%=1)<0?++n:n)*t);return OO((n-i/t)*t,e[(i+t-1)%t],e[i%t],e[(i+1)%t],e[(i+2)%t])}});var QM=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,JM=new RegExp(QM.source,"g");function PW(e,t){var i,s,c,n=QM.lastIndex=JM.lastIndex=0,d=-1,_=[],x=[];for(e+="",t+="";(i=QM.exec(e))&&(s=JM.exec(t));)(c=s.index)>n&&(c=t.slice(n,c),_[d]?_[d]+=c:_[++d]=c),(i=i[0])===(s=s[0])?_[d]?_[d]+=s:_[++d]=s:(_[++d]=null,x.push({i:d,x:fp(i,s)})),n=JM.lastIndex;return n<t.length&&(c=t.slice(n),_[d]?_[d]+=c:_[++d]=c),_.length<2?x[0]?function IW(e){return function(t){return e(t)+""}}(x[0].x):function SW(e){return function(){return e}}(t):(t=x.length,function(E){for(var z,R=0;R<t;++R)_[(z=x[R]).i]=z.x(E);return _.join("")})}function jO(e,t){var n;return("number"==typeof t?fp:t instanceof I0?BO:(n=I0(t))?(t=n,BO):PW)(e,t)}function AW(e){return function(){this.removeAttribute(e)}}function kW(e){return function(){this.removeAttributeNS(e.space,e.local)}}function RW(e,t,n){var i,c,s=n+"";return function(){var d=this.getAttribute(e);return d===s?null:d===i?c:c=t(i=d,n)}}function LW(e,t,n){var i,c,s=n+"";return function(){var d=this.getAttributeNS(e.space,e.local);return d===s?null:d===i?c:c=t(i=d,n)}}function OW(e,t,n){var i,s,c;return function(){var d,x,_=n(this);return null==_?void this.removeAttribute(e):(d=this.getAttribute(e))===(x=_+"")?null:d===i&&x===s?c:(s=x,c=t(i=d,_))}}function FW(e,t,n){var i,s,c;return function(){var d,x,_=n(this);return null==_?void this.removeAttributeNS(e.space,e.local):(d=this.getAttributeNS(e.space,e.local))===(x=_+"")?null:d===i&&x===s?c:(s=x,c=t(i=d,_))}}function VW(e,t){var n,i;function s(){var c=t.apply(this,arguments);return c!==i&&(n=(i=c)&&function BW(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}(e,c)),n}return s._value=t,s}function jW(e,t){var n,i;function s(){var c=t.apply(this,arguments);return c!==i&&(n=(i=c)&&function zW(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}(e,c)),n}return s._value=t,s}function $W(e,t){return function(){qM(this,e).delay=+t.apply(this,arguments)}}function GW(e,t){return t=+t,function(){qM(this,e).delay=t}}function ZW(e,t){return function(){Jh(this,e).duration=+t.apply(this,arguments)}}function qW(e,t){return t=+t,function(){Jh(this,e).duration=t}}var lY=x0.prototype.constructor;function UO(e){return function(){this.style.removeProperty(e)}}var MY=0;function Zd(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function $O(){return++MY}var qd=x0.prototype;Zd.prototype=function EY(e){return x0().transition(e)}.prototype={constructor:Zd,select:function sY(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=zM(e));for(var i=this._groups,s=i.length,c=new Array(s),d=0;d<s;++d)for(var R,z,_=i[d],x=_.length,E=c[d]=new Array(x),V=0;V<x;++V)(R=_[V])&&(z=e.call(R,R.__data__,V,_))&&("__data__"in R&&(z.__data__=R.__data__),E[V]=z,nw(E[V],t,n,V,E,ah(R,n)));return new Zd(c,this._parents,t,n)},selectAll:function aY(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=eO(e));for(var i=this._groups,s=i.length,c=[],d=[],_=0;_<s;++_)for(var R,x=i[_],E=x.length,z=0;z<E;++z)if(R=x[z]){for(var j,V=e.call(R,R.__data__,z,x),J=ah(R,n),se=0,le=V.length;se<le;++se)(j=V[se])&&nw(j,t,n,se,V,J);c.push(V),d.push(R)}return new Zd(c,d,t,n)},selectChild:qd.selectChild,selectChildren:qd.selectChildren,filter:function JW(e){"function"!=typeof e&&(e=tO(e));for(var t=this._groups,n=t.length,i=new Array(n),s=0;s<n;++s)for(var x,c=t[s],d=c.length,_=i[s]=[],E=0;E<d;++E)(x=c[E])&&e.call(x,x.__data__,E,c)&&_.push(x);return new Zd(i,this._parents,this._name,this._id)},merge:function eY(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,c=Math.min(i,n.length),d=new Array(i),_=0;_<c;++_)for(var V,x=t[_],E=n[_],R=x.length,z=d[_]=new Array(R),j=0;j<R;++j)(V=x[j]||E[j])&&(z[j]=V);for(;_<i;++_)d[_]=t[_];return new Zd(d,this._parents,this._name,this._id)},selection:function cY(){return new lY(this._groups,this._parents)},transition:function TY(){for(var e=this._name,t=this._id,n=$O(),i=this._groups,s=i.length,c=0;c<s;++c)for(var x,d=i[c],_=d.length,E=0;E<_;++E)if(x=d[E]){var R=ah(x,t);nw(x,e,n,E,d,{time:R.time+R.delay+R.duration,delay:0,duration:R.duration,ease:R.ease})}return new Zd(i,this._parents,e,n)},call:qd.call,nodes:qd.nodes,node:qd.node,size:qd.size,empty:qd.empty,each:qd.each,on:function iY(e,t){var n=this._id;return arguments.length<2?ah(this.node(),n).on.on(e):this.each(function nY(e,t,n){var i,s,c=function tY(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||"start"===t})}(t)?qM:Jh;return function(){var d=c(this,e),_=d.on;_!==i&&(s=(i=_).copy()).on(t,n),d.on=s}}(n,e,t))},attr:function NW(e,t){var n=q1(e),i="transform"===n?lW:jO;return this.attrTween(e,"function"==typeof t?(n.local?FW:OW)(n,i,YM(this,"attr."+e,t)):null==t?(n.local?kW:AW)(n):(n.local?LW:RW)(n,i,t))},attrTween:function UW(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;var i=q1(e);return this.tween(n,(i.local?VW:jW)(i,t))},style:function pY(e,t,n){var i="transform"==(e+="")?aW:jO;return null==t?this.styleTween(e,function uY(e,t){var n,i,s;return function(){var c=N_(this,e),d=(this.style.removeProperty(e),N_(this,e));return c===d?null:c===n&&d===i?s:s=t(n=c,i=d)}}(e,i)).on("end.style."+e,UO(e)):"function"==typeof t?this.styleTween(e,function dY(e,t,n){var i,s,c;return function(){var d=N_(this,e),_=n(this),x=_+"";return null==_&&(this.style.removeProperty(e),x=_=N_(this,e)),d===x?null:d===i&&x===s?c:(s=x,c=t(i=d,_))}}(e,i,YM(this,"style."+e,t))).each(function fY(e,t){var n,i,s,_,c="style."+t,d="end."+c;return function(){var x=Jh(this,e),E=x.on,R=null==x.value[c]?_||(_=UO(t)):void 0;(E!==n||s!==R)&&(i=(n=E).copy()).on(d,s=R),x.on=i}}(this._id,e)):this.styleTween(e,function hY(e,t,n){var i,c,s=n+"";return function(){var d=N_(this,e);return d===s?null:d===i?c:c=t(i=d,n)}}(e,i,t),n).on("end.style."+e,null)},styleTween:function _Y(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==t)return this.tween(i,null);if("function"!=typeof t)throw new Error;return this.tween(i,function gY(e,t,n){var i,s;function c(){var d=t.apply(this,arguments);return d!==s&&(i=(s=d)&&function mY(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}(e,d,n)),i}return c._value=t,c}(e,t,n??""))},text:function bY(e){return this.tween("text","function"==typeof e?function vY(e){return function(){var t=e(this);this.textContent=t??""}}(YM(this,"text",e)):function yY(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function CY(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,function wY(e){var t,n;function i(){var s=e.apply(this,arguments);return s!==n&&(t=(n=s)&&function xY(e){return function(t){this.textContent=e.call(this,t)}}(s)),t}return i._value=e,i}(e))},remove:function oY(){return this.on("end.remove",function rY(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}(this._id))},tween:function hW(e,t){var n=this._id;if(e+="",arguments.length<2){for(var d,i=ah(this.node(),n).tween,s=0,c=i.length;s<c;++s)if((d=i[s]).name===e)return d.value;return null}return this.each((null==t?cW:uW)(n,e,t))},delay:function HW(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?$W:GW)(t,e)):ah(this.node(),t).delay},duration:function WW(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?ZW:qW)(t,e)):ah(this.node(),t).duration},ease:function XW(e){var t=this._id;return arguments.length?this.each(function YW(e,t){if("function"!=typeof t)throw new Error;return function(){Jh(this,e).ease=t}}(t,e)):ah(this.node(),t).ease},easeVarying:function QW(e){if("function"!=typeof e)throw new Error;return this.each(function KW(e,t){return function(){var n=t.apply(this,arguments);if("function"!=typeof n)throw new Error;Jh(this,e).ease=n}}(this._id,e))},end:function DY(){var e,t,n=this,i=n._id,s=n.size();return new Promise(function(c,d){var _={value:d},x={value:function(){0==--s&&c()}};n.each(function(){var E=Jh(this,i),R=E.on;R!==e&&((t=(e=R).copy())._.cancel.push(_),t._.interrupt.push(_),t._.end.push(x)),E.on=t}),0===s&&c()})},[Symbol.iterator]:qd[Symbol.iterator]};var IY={time:null,delay:0,duration:250,ease:function SY(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function PY(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}x0.prototype.interrupt=function rW(e){return this.each(function(){iw(this,e)})},x0.prototype.transition=function AY(e){var t,n;e instanceof Zd?(t=e._id,e=e._name):(t=$O(),(n=IY).time=UM(),e=null==e?null:e+"");for(var i=this._groups,s=i.length,c=0;c<s;++c)for(var x,d=i[c],_=d.length,E=0;E<_;++E)(x=d[E])&&nw(x,e,t,E,d,n||PY(x,t));return new Zd(i,this._parents,e,t)};Math;function P0(e){return{type:e}}function Ui(e){return"string"==typeof e?new Cl([[document.querySelector(e)]],[document.documentElement]):new Cl([[e]],jM)}function Yd(e,t){if(e=function BY(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();return i.x=e.clientX,i.y=e.clientY,[(i=i.matrixTransform(t.getScreenCTM().inverse())).x,i.y]}if(t.getBoundingClientRect){var s=t.getBoundingClientRect();return[e.clientX-s.left-t.clientLeft,e.clientY-s.top-t.clientTop]}}return[e.pageX,e.pageY]}["w","e"].map(P0),["n","s"].map(P0),["n","w","e","s","nw","ne","sw","se"].map(P0);const VY={passive:!1},A0={capture:!0,passive:!1};function rE(e){e.stopImmediatePropagation()}function U_(e){e.preventDefault(),e.stopImmediatePropagation()}function YO(e){var t=e.document.documentElement,n=Ui(e).on("dragstart.drag",U_,A0);"onselectstart"in t?n.on("selectstart.drag",U_,A0):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function XO(e,t){var n=e.document.documentElement,i=Ui(e).on("dragstart.drag",null);t&&(i.on("click.drag",U_,A0),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in n?i.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}const dw=e=>()=>e;function oE(e,{sourceEvent:t,subject:n,target:i,identifier:s,active:c,x:d,y:_,dx:x,dy:E,dispatch:R}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:s,enumerable:!0,configurable:!0},active:{value:c,enumerable:!0,configurable:!0},x:{value:d,enumerable:!0,configurable:!0},y:{value:_,enumerable:!0,configurable:!0},dx:{value:x,enumerable:!0,configurable:!0},dy:{value:E,enumerable:!0,configurable:!0},_:{value:R}})}function jY(e){return!e.ctrlKey&&!e.button}function UY(){return this.parentNode}function $Y(e,t){return t??{x:e.x,y:e.y}}function GY(){return navigator.maxTouchPoints||"ontouchstart"in this}oE.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};const ZY=e=>+e;function KO(e,t,n,i){if(isNaN(t)||isNaN(n))return e;var s,z,V,j,J,se,le,de,ae,c=e._root,d={data:i},_=e._x0,x=e._y0,E=e._x1,R=e._y1;if(!c)return e._root=d,e;for(;c.length;)if((se=t>=(z=(_+E)/2))?_=z:E=z,(le=n>=(V=(x+R)/2))?x=V:R=V,s=c,!(c=c[de=le<<1|se]))return s[de]=d,e;if(j=+e._x.call(null,c.data),J=+e._y.call(null,c.data),t===j&&n===J)return d.next=c,s?s[de]=d:e._root=d,e;do{s=s?s[de]=new Array(4):e._root=new Array(4),(se=t>=(z=(_+E)/2))?_=z:E=z,(le=n>=(V=(x+R)/2))?x=V:R=V}while((de=le<<1|se)==(ae=(J>=V)<<1|j>=z));return s[ae]=c,s[de]=d,e}function Tl(e,t,n,i,s){this.node=e,this.x0=t,this.y0=n,this.x1=i,this.y1=s}function sX(e){return e[0]}function lX(e){return e[1]}function sE(e,t,n){var i=new aE(t??sX,n??lX,NaN,NaN,NaN,NaN);return null==e?i:i.addAll(e)}function aE(e,t,n,i,s,c){this._x=e,this._y=t,this._x0=n,this._y0=i,this._x1=s,this._y1=c,this._root=void 0}function QO(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var Dl=sE.prototype=aE.prototype;function Um(e){return function(){return e}}function pp(e){return 1e-6*(e()-.5)}function uX(e){return e.x+e.vx}function hX(e){return e.y+e.vy}function fX(e){return e.index}function JO(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}Dl.copy=function(){var n,i,e=new aE(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root;if(!t)return e;if(!t.length)return e._root=QO(t),e;for(n=[{source:t,target:e._root=new Array(4)}];t=n.pop();)for(var s=0;s<4;++s)(i=t.source[s])&&(i.length?n.push({source:i,target:t.target[s]=new Array(4)}):t.target[s]=QO(i));return e},Dl.add=function WY(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return KO(this.cover(t,n),t,n,e)},Dl.addAll=function YY(e){var t,n,s,c,i=e.length,d=new Array(i),_=new Array(i),x=1/0,E=1/0,R=-1/0,z=-1/0;for(n=0;n<i;++n)isNaN(s=+this._x.call(null,t=e[n]))||isNaN(c=+this._y.call(null,t))||(d[n]=s,_[n]=c,s<x&&(x=s),s>R&&(R=s),c<E&&(E=c),c>z&&(z=c));if(x>R||E>z)return this;for(this.cover(x,E).cover(R,z),n=0;n<i;++n)KO(this,d[n],_[n],e[n]);return this},Dl.cover=function XY(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,i=this._y0,s=this._x1,c=this._y1;if(isNaN(n))s=(n=Math.floor(e))+1,c=(i=Math.floor(t))+1;else{for(var x,E,d=s-n||1,_=this._root;n>e||e>=s||i>t||t>=c;)switch(E=(t<i)<<1|e<n,x=new Array(4),x[E]=_,_=x,d*=2,E){case 0:s=n+d,c=i+d;break;case 1:n=s-d,c=i+d;break;case 2:s=n+d,i=c-d;break;case 3:n=s-d,i=c-d}this._root&&this._root.length&&(this._root=_)}return this._x0=n,this._y0=i,this._x1=s,this._y1=c,this},Dl.data=function KY(){var e=[];return this.visit(function(t){if(!t.length)do{e.push(t.data)}while(t=t.next)}),e},Dl.extent=function QY(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},Dl.find=function JY(e,t,n){var i,d,_,x,E,J,se,s=this._x0,c=this._y0,R=this._x1,z=this._y1,V=[],j=this._root;for(j&&V.push(new Tl(j,s,c,R,z)),null==n?n=1/0:(s=e-n,c=t-n,R=e+n,z=t+n,n*=n);J=V.pop();)if(!(!(j=J.node)||(d=J.x0)>R||(_=J.y0)>z||(x=J.x1)<s||(E=J.y1)<c))if(j.length){var le=(d+x)/2,de=(_+E)/2;V.push(new Tl(j[3],le,de,x,E),new Tl(j[2],d,de,le,E),new Tl(j[1],le,_,x,de),new Tl(j[0],d,_,le,de)),(se=(t>=de)<<1|e>=le)&&(J=V[V.length-1],V[V.length-1]=V[V.length-1-se],V[V.length-1-se]=J)}else{var ae=e-+this._x.call(null,j.data),ze=t-+this._y.call(null,j.data),Se=ae*ae+ze*ze;if(Se<n){var ut=Math.sqrt(n=Se);s=e-ut,c=t-ut,R=e+ut,z=t+ut,i=j.data}}return i},Dl.remove=function eX(e){if(isNaN(R=+this._x.call(null,e))||isNaN(z=+this._y.call(null,e)))return this;var t,i,s,c,R,z,V,j,J,se,le,de,n=this._root,d=this._x0,_=this._y0,x=this._x1,E=this._y1;if(!n)return this;if(n.length)for(;;){if((J=R>=(V=(d+x)/2))?d=V:x=V,(se=z>=(j=(_+E)/2))?_=j:E=j,t=n,!(n=n[le=se<<1|J]))return this;if(!n.length)break;(t[le+1&3]||t[le+2&3]||t[le+3&3])&&(i=t,de=le)}for(;n.data!==e;)if(s=n,!(n=n.next))return this;return(c=n.next)&&delete n.next,s?(c?s.next=c:delete s.next,this):t?(c?t[le]=c:delete t[le],(n=t[0]||t[1]||t[2]||t[3])&&n===(t[3]||t[2]||t[1]||t[0])&&!n.length&&(i?i[de]=n:this._root=n),this):(this._root=c,this)},Dl.removeAll=function tX(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this},Dl.root=function nX(){return this._root},Dl.size=function iX(){var e=0;return this.visit(function(t){if(!t.length)do{++e}while(t=t.next)}),e},Dl.visit=function rX(e){var n,s,c,d,_,x,t=[],i=this._root;for(i&&t.push(new Tl(i,this._x0,this._y0,this._x1,this._y1));n=t.pop();)if(!e(i=n.node,c=n.x0,d=n.y0,_=n.x1,x=n.y1)&&i.length){var E=(c+_)/2,R=(d+x)/2;(s=i[3])&&t.push(new Tl(s,E,R,_,x)),(s=i[2])&&t.push(new Tl(s,c,R,E,x)),(s=i[1])&&t.push(new Tl(s,E,d,_,R)),(s=i[0])&&t.push(new Tl(s,c,d,E,R))}return this},Dl.visitAfter=function oX(e){var i,t=[],n=[];for(this._root&&t.push(new Tl(this._root,this._x0,this._y0,this._x1,this._y1));i=t.pop();){var s=i.node;if(s.length){var c,d=i.x0,_=i.y0,x=i.x1,E=i.y1,R=(d+x)/2,z=(_+E)/2;(c=s[0])&&t.push(new Tl(c,d,_,R,z)),(c=s[1])&&t.push(new Tl(c,R,_,x,z)),(c=s[2])&&t.push(new Tl(c,d,z,R,E)),(c=s[3])&&t.push(new Tl(c,R,z,x,E))}n.push(i)}for(;i=n.pop();)e(i.node,i.x0,i.y0,i.x1,i.y1);return this},Dl.x=function aX(e){return arguments.length?(this._x=e,this):this._x},Dl.y=function cX(e){return arguments.length?(this._y=e,this):this._y};const eF=4294967296;function yX(e){return e.x}function vX(e){return e.y}var xX=Math.PI*(3-Math.sqrt(5));function TX(e){var t=0,n=e.children,i=n&&n.length;if(i)for(;--i>=0;)t+=n[i].value;else t=1;e.value=t}function $_(e,t){e instanceof Map?(e=[void 0,e],void 0===t&&(t=jX)):void 0===t&&(t=VX);for(var i,c,d,_,x,n=new k0(e),s=[n];i=s.pop();)if((d=t(i.data))&&(x=(d=Array.from(d)).length))for(i.children=d,_=x-1;_>=0;--_)s.push(c=d[_]=new k0(d[_])),c.parent=i,c.depth=i.depth+1;return n.eachBefore($X)}function VX(e){return e.children}function jX(e){return Array.isArray(e)?e[1]:null}function UX(e){void 0!==e.data.value&&(e.value=e.data.value),e.data=e.data.data}function $X(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function k0(e){this.data=e,this.depth=this.height=0,this.parent=null}function GX(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function tF(){var e=1,t=1,n=0,i=!1;function s(d){var _=d.height+1;return d.x0=d.y0=n,d.x1=e,d.y1=t/_,d.eachBefore(function c(d,_){return function(x){x.children&&function HX(e,t,n,i,s){for(var d,c=e.children,_=-1,x=c.length,E=e.value&&(i-t)/e.value;++_<x;)(d=c[_]).y0=n,d.y1=s,d.x0=t,d.x1=t+=d.value*E}(x,x.x0,d*(x.depth+1)/_,x.x1,d*(x.depth+2)/_);var E=x.x0,R=x.y0,z=x.x1-n,V=x.y1-n;z<E&&(E=z=(E+z)/2),V<R&&(R=V=(R+V)/2),x.x0=E,x.y0=R,x.x1=z,x.y1=V}}(t,_)),i&&d.eachBefore(GX),d}return s.round=function(d){return arguments.length?(i=!!d,s):i},s.size=function(d){return arguments.length?(e=+d[0],t=+d[1],s):[e,t]},s.padding=function(d){return arguments.length?(n=+d,s):n},s}function ZX(e,t){return e.parent===t.parent?1:2}function lE(e){var t=e.children;return t?t[0]:e.t}function cE(e){var t=e.children;return t?t[t.length-1]:e.t}function qX(e,t,n){var i=n/(t.i-e.i);t.c-=i,t.s+=n,e.c+=i,t.z+=n,t.m+=n}function YX(e,t,n){return e.a.parent===t.parent?e.a:n}function fw(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}function nF(){var e=ZX,t=1,n=1,i=null;function s(E){var R=function XX(e){for(var n,s,c,d,_,t=new fw(e,0),i=[t];n=i.pop();)if(c=n._.children)for(n.children=new Array(_=c.length),d=_-1;d>=0;--d)i.push(s=n.children[d]=new fw(c[d],d)),s.parent=n;return(t.parent=new fw(null,0)).children=[t],t}(E);if(R.eachAfter(c),R.parent.m=-R.z,R.eachBefore(d),i)E.eachBefore(x);else{var z=E,V=E,j=E;E.eachBefore(function(ae){ae.x<z.x&&(z=ae),ae.x>V.x&&(V=ae),ae.depth>j.depth&&(j=ae)});var J=z===V?1:e(z,V)/2,se=J-z.x,le=t/(V.x+J+se),de=n/(j.depth||1);E.eachBefore(function(ae){ae.x=(ae.x+se)*le,ae.y=ae.depth*de})}return E}function c(E){var R=E.children,z=E.parent.children,V=E.i?z[E.i-1]:null;if(R){!function WX(e){for(var c,t=0,n=0,i=e.children,s=i.length;--s>=0;)(c=i[s]).z+=t,c.m+=t,t+=c.s+(n+=c.c)}(E);var j=(R[0].z+R[R.length-1].z)/2;V?(E.z=V.z+e(E._,V._),E.m=E.z-j):E.z=j}else V&&(E.z=V.z+e(E._,V._));E.parent.A=function _(E,R,z){if(R){for(var Se,V=E,j=E,J=R,se=V.parent.children[0],le=V.m,de=j.m,ae=J.m,ze=se.m;J=cE(J),V=lE(V),J&&V;)se=lE(se),(j=cE(j)).a=E,(Se=J.z+ae-V.z-le+e(J._,V._))>0&&(qX(YX(J,E,z),E,Se),le+=Se,de+=Se),ae+=J.m,le+=V.m,ze+=se.m,de+=j.m;J&&!cE(j)&&(j.t=J,j.m+=ae-de),V&&!lE(se)&&(se.t=V,se.m+=le-ze,z=E)}return z}(E,V,E.parent.A||z[0])}function d(E){E._.x=E.z+E.parent.m,E.m+=E.parent.m}function x(E){E.x*=t,E.y=E.depth*n}return s.separation=function(E){return arguments.length?(e=E,s):e},s.size=function(E){return arguments.length?(i=!1,t=+E[0],n=+E[1],s):i?null:[t,n]},s.nodeSize=function(E){return arguments.length?(i=!0,t=+E[0],n=+E[1],s):i?[t,n]:null},s}function iF(e){return"string"==typeof e?new Cl([document.querySelectorAll(e)],[document.documentElement]):new Cl([JL(e)],jM)}function mp(e){return function(){return e}}k0.prototype=$_.prototype={constructor:k0,count:function DX(){return this.eachAfter(TX)},each:function MX(e,t){let n=-1;for(const i of this)e.call(t,i,++n,this);return this},eachAfter:function SX(e,t){for(var c,d,_,n=this,i=[n],s=[],x=-1;n=i.pop();)if(s.push(n),c=n.children)for(d=0,_=c.length;d<_;++d)i.push(c[d]);for(;n=s.pop();)e.call(t,n,++x,this);return this},eachBefore:function EX(e,t){for(var s,c,n=this,i=[n],d=-1;n=i.pop();)if(e.call(t,n,++d,this),s=n.children)for(c=s.length-1;c>=0;--c)i.push(s[c]);return this},find:function IX(e,t){let n=-1;for(const i of this)if(e.call(t,i,++n,this))return i},sum:function PX(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,i=t.children,s=i&&i.length;--s>=0;)n+=i[s].value;t.value=n})},sort:function AX(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})},path:function kX(e){for(var t=this,n=function RX(e,t){if(e===t)return e;var n=e.ancestors(),i=t.ancestors(),s=null;for(e=n.pop(),t=i.pop();e===t;)s=e,e=n.pop(),t=i.pop();return s}(t,e),i=[t];t!==n;)i.push(t=t.parent);for(var s=i.length;e!==n;)i.splice(s,0,e),e=e.parent;return i},ancestors:function LX(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function OX(){return Array.from(this)},leaves:function FX(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e},links:function NX(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t},copy:function BX(){return $_(this).eachBefore(UX)},[Symbol.iterator]:function*zX(){var t,i,s,c,e=this,n=[e];do{for(t=n.reverse(),n=[];e=t.pop();)if(yield e,i=e.children)for(s=0,c=i.length;s<c;++s)n.push(i[s])}while(n.length)}},fw.prototype=Object.create(k0.prototype);const rF=Math.abs,Xa=Math.atan2,$m=Math.cos,KX=Math.max,uE=Math.min,td=Math.sin,G_=Math.sqrt,ic=1e-12,R0=Math.PI,pw=R0/2,QX=2*R0;function oF(e){return e>=1?pw:e<=-1?-pw:Math.asin(e)}const hE=Math.PI,dE=2*hE,Gm=1e-6,eK=dE-Gm;function sF(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}class mw{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==t?sF:function tK(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return sF;const n=10**t;return function(i){this._+=i[0];for(let s=1,c=i.length;s<c;++s)this._+=Math.round(arguments[s]*n)/n+i[s]}}(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,i,s){this._append`Q${+t},${+n},${this._x1=+i},${this._y1=+s}`}bezierCurveTo(t,n,i,s,c,d){this._append`C${+t},${+n},${+i},${+s},${this._x1=+c},${this._y1=+d}`}arcTo(t,n,i,s,c){if(t=+t,n=+n,i=+i,s=+s,(c=+c)<0)throw new Error(`negative radius: ${c}`);let d=this._x1,_=this._y1,x=i-t,E=s-n,R=d-t,z=_-n,V=R*R+z*z;if(null===this._x1)this._append`M${this._x1=t},${this._y1=n}`;else if(V>Gm)if(Math.abs(z*x-E*R)>Gm&&c){let j=i-d,J=s-_,se=x*x+E*E,le=j*j+J*J,de=Math.sqrt(se),ae=Math.sqrt(V),ze=c*Math.tan((hE-Math.acos((se+V-le)/(2*de*ae)))/2),Se=ze/ae,ut=ze/de;Math.abs(Se-1)>Gm&&this._append`L${t+Se*R},${n+Se*z}`,this._append`A${c},${c},0,0,${+(z*j>R*J)},${this._x1=t+ut*x},${this._y1=n+ut*E}`}else this._append`L${this._x1=t},${this._y1=n}`}arc(t,n,i,s,c,d){if(t=+t,n=+n,d=!!d,(i=+i)<0)throw new Error(`negative radius: ${i}`);let _=i*Math.cos(s),x=i*Math.sin(s),E=t+_,R=n+x,z=1^d,V=d?s-c:c-s;null===this._x1?this._append`M${E},${R}`:(Math.abs(this._x1-E)>Gm||Math.abs(this._y1-R)>Gm)&&this._append`L${E},${R}`,i&&(V<0&&(V=V%dE+dE),V>eK?this._append`A${i},${i},0,1,${z},${t-_},${n-x}A${i},${i},0,1,${z},${this._x1=E},${this._y1=R}`:V>Gm&&this._append`A${i},${i},0,${+(V>=hE)},${z},${this._x1=t+i*Math.cos(c)},${this._y1=n+i*Math.sin(c)}`)}rect(t,n,i,s){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${i=+i}v${+s}h${-i}Z`}toString(){return this._}}function rK(e){return e.innerRadius}function oK(e){return e.outerRadius}function sK(e){return e.startAngle}function aK(e){return e.endAngle}function lK(e){return e&&e.padAngle}function gw(e,t,n,i,s,c,d){var _=e-n,x=t-i,E=(d?c:-c)/G_(_*_+x*x),R=E*x,z=-E*_,V=e+R,j=t+z,J=n+R,se=i+z,le=(V+J)/2,de=(j+se)/2,ae=J-V,ze=se-j,Se=ae*ae+ze*ze,ut=s-c,Nt=V*se-J*j,en=(ze<0?-1:1)*G_(KX(0,ut*ut*Se-Nt*Nt)),fn=(Nt*ze-ae*en)/Se,Gn=(-Nt*ae-ze*en)/Se,At=(Nt*ze+ae*en)/Se,xn=(-Nt*ae+ze*en)/Se,Fn=fn-le,un=Gn-de,tt=At-le,_n=xn-de;return Fn*Fn+un*un>tt*tt+_n*_n&&(fn=At,Gn=xn),{cx:fn,cy:Gn,x01:-R,y01:-z,x11:fn*(s/ut-1),y11:Gn*(s/ut-1)}}function aF(){var e=rK,t=oK,n=mp(0),i=null,s=sK,c=aK,d=lK,_=null,x=function iK(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(null==n)t=null;else{const i=Math.floor(n);if(!(i>=0))throw new RangeError(`invalid digits: ${n}`);t=i}return e},()=>new mw(t)}(E);function E(){var R,z,V=+e.apply(this,arguments),j=+t.apply(this,arguments),J=s.apply(this,arguments)-pw,se=c.apply(this,arguments)-pw,le=rF(se-J),de=se>J;if(_||(_=R=x()),j<V&&(z=j,j=V,V=z),j>ic)if(le>QX-ic)_.moveTo(j*$m(J),j*td(J)),_.arc(0,0,j,J,se,!de),V>ic&&(_.moveTo(V*$m(se),V*td(se)),_.arc(0,0,V,se,J,de));else{var un,tt,ae=J,ze=se,Se=J,ut=se,Nt=le,en=le,fn=d.apply(this,arguments)/2,Gn=fn>ic&&(i?+i.apply(this,arguments):G_(V*V+j*j)),At=uE(rF(j-V)/2,+n.apply(this,arguments)),xn=At,Fn=At;if(Gn>ic){var _n=oF(Gn/V*td(fn)),zt=oF(Gn/j*td(fn));(Nt-=2*_n)>ic?(Se+=_n*=de?1:-1,ut-=_n):(Nt=0,Se=ut=(J+se)/2),(en-=2*zt)>ic?(ae+=zt*=de?1:-1,ze-=zt):(en=0,ae=ze=(J+se)/2)}var cn=j*$m(ae),Yn=j*td(ae),Rn=V*$m(ut),En=V*td(ut);if(At>ic){var Do,Xn=j*$m(ze),hi=j*td(ze),$s=V*$m(Se),To=V*td(Se);if(le<R0)if(Do=function cK(e,t,n,i,s,c,d,_){var x=n-e,E=i-t,R=d-s,z=_-c,V=z*x-R*E;if(!(V*V<ic))return[e+(V=(R*(t-c)-z*(e-s))/V)*x,t+V*E]}(cn,Yn,$s,To,Xn,hi,Rn,En)){var ba=cn-Do[0],Nr=Yn-Do[1],aa=Xn-Do[0],ad=hi-Do[1],Cp=1/td(function JX(e){return e>1?0:e<-1?R0:Math.acos(e)}((ba*aa+Nr*ad)/(G_(ba*ba+Nr*Nr)*G_(aa*aa+ad*ad)))/2),Z0=G_(Do[0]*Do[0]+Do[1]*Do[1]);xn=uE(At,(V-Z0)/(Cp-1)),Fn=uE(At,(j-Z0)/(Cp+1))}else xn=Fn=0}en>ic?Fn>ic?(un=gw($s,To,cn,Yn,j,Fn,de),tt=gw(Xn,hi,Rn,En,j,Fn,de),_.moveTo(un.cx+un.x01,un.cy+un.y01),Fn<At?_.arc(un.cx,un.cy,Fn,Xa(un.y01,un.x01),Xa(tt.y01,tt.x01),!de):(_.arc(un.cx,un.cy,Fn,Xa(un.y01,un.x01),Xa(un.y11,un.x11),!de),_.arc(0,0,j,Xa(un.cy+un.y11,un.cx+un.x11),Xa(tt.cy+tt.y11,tt.cx+tt.x11),!de),_.arc(tt.cx,tt.cy,Fn,Xa(tt.y11,tt.x11),Xa(tt.y01,tt.x01),!de))):(_.moveTo(cn,Yn),_.arc(0,0,j,ae,ze,!de)):_.moveTo(cn,Yn),V>ic&&Nt>ic?xn>ic?(un=gw(Rn,En,Xn,hi,V,-xn,de),tt=gw(cn,Yn,$s,To,V,-xn,de),_.lineTo(un.cx+un.x01,un.cy+un.y01),xn<At?_.arc(un.cx,un.cy,xn,Xa(un.y01,un.x01),Xa(tt.y01,tt.x01),!de):(_.arc(un.cx,un.cy,xn,Xa(un.y01,un.x01),Xa(un.y11,un.x11),!de),_.arc(0,0,V,Xa(un.cy+un.y11,un.cx+un.x11),Xa(tt.cy+tt.y11,tt.cx+tt.x11),de),_.arc(tt.cx,tt.cy,xn,Xa(tt.y11,tt.x11),Xa(tt.y01,tt.x01),!de))):_.arc(0,0,V,ut,Se,de):_.lineTo(Rn,En)}else _.moveTo(0,0);if(_.closePath(),R)return _=null,R+""||null}return E.centroid=function(){var R=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,z=(+s.apply(this,arguments)+ +c.apply(this,arguments))/2-R0/2;return[$m(z)*R,td(z)*R]},E.innerRadius=function(R){return arguments.length?(e="function"==typeof R?R:mp(+R),E):e},E.outerRadius=function(R){return arguments.length?(t="function"==typeof R?R:mp(+R),E):t},E.cornerRadius=function(R){return arguments.length?(n="function"==typeof R?R:mp(+R),E):n},E.padRadius=function(R){return arguments.length?(i=null==R?null:"function"==typeof R?R:mp(+R),E):i},E.startAngle=function(R){return arguments.length?(s="function"==typeof R?R:mp(+R),E):s},E.endAngle=function(R){return arguments.length?(c="function"==typeof R?R:mp(+R),E):c},E.padAngle=function(R){return arguments.length?(d="function"==typeof R?R:mp(+R),E):d},E.context=function(R){return arguments.length?(_=R??null,E):_},E}function lF(e){return((e=Math.exp(e))+1/e)/2}const fK=function e(t,n,i){function s(c,d){var le,de,_=c[0],x=c[1],E=c[2],V=d[2],j=d[0]-_,J=d[1]-x,se=j*j+J*J;if(se<1e-12)de=Math.log(V/E)/t,le=function(en){return[_+en*j,x+en*J,E*Math.exp(t*en*de)]};else{var ae=Math.sqrt(se),ze=(V*V-E*E+i*se)/(2*E*n*ae),Se=(V*V-E*E-i*se)/(2*V*n*ae),ut=Math.log(Math.sqrt(ze*ze+1)-ze),Nt=Math.log(Math.sqrt(Se*Se+1)-Se);de=(Nt-ut)/t,le=function(en){var fn=en*de,Gn=lF(ut),At=E/(n*ae)*(Gn*function dK(e){return((e=Math.exp(2*e))-1)/(e+1)}(t*fn+ut)-function hK(e){return((e=Math.exp(e))-1/e)/2}(ut));return[_+At*j,x+At*J,E*Gn/lF(t*fn+ut)]}}return le.duration=1e3*de*t/Math.SQRT2,le}return s.rho=function(c){var d=Math.max(.001,+c),_=d*d;return e(d,_,_*_)},s}(Math.SQRT2,2,4),_w=e=>()=>e;function pK(e,{sourceEvent:t,target:n,transform:i,dispatch:s}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:s}})}function Xd(e,t,n){this.k=e,this.x=t,this.y=n}Xd.prototype={constructor:Xd,scale:function(e){return 1===e?this:new Xd(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new Xd(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var yw=new Xd(1,0,0);function fE(e){e.stopImmediatePropagation()}function L0(e){e.preventDefault(),e.stopImmediatePropagation()}function gK(e){return!(e.ctrlKey&&"wheel"!==e.type||e.button)}function _K(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function cF(){return this.__zoom||yw}function yK(e){return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function vK(){return navigator.maxTouchPoints||"ontouchstart"in this}function bK(e,t,n){var i=e.invertX(t[0][0])-n[0][0],s=e.invertX(t[1][0])-n[1][0],c=e.invertY(t[0][1])-n[0][1],d=e.invertY(t[1][1])-n[1][1];return e.translate(s>i?(i+s)/2:Math.min(0,i)||Math.max(0,s),d>c?(c+d)/2:Math.min(0,c)||Math.max(0,d))}const wK=["treeContainer"];let CK=(()=>{class e{treeContainer;svg;width=400;height=300;treeData={id:"root",question:"What denomination are you?",children:[{id:"bible-authority",question:"Does the Bible have MORE authority than the Church?",children:[{id:"bible-no",answer:"No",denomination:"Catholic",color:"#FFD700"},{id:"bible-yes",answer:"Yes",question:"Should infants be baptized?",children:[{id:"infant-yes",answer:"Yes",children:[{id:"anglican",denomination:"Anglican",color:"#FFC0CB"},{id:"orthodox-lutheran",children:[{id:"orthodox",denomination:"Orthodox",color:"#FF8C00"},{id:"lutheran-presbyterian",children:[{id:"lutheran",denomination:"Lutheran",color:"#4169E1"},{id:"presbyterian",denomination:"Presbyterian",color:"#DC143C"}]}]}]},{id:"infant-no",answer:"No",children:[{id:"baptist",denomination:"Baptist",color:"#32CD32"},{id:"pentecostal",denomination:"Pentecostal",color:"#FF6347"}]}]}]}]};ngOnInit(){}ngAfterViewInit(){this.createTree()}createTree(){const n=this.treeContainer.nativeElement;Ui(n).select("svg").remove(),this.svg=Ui(n).append("svg").attr("width","100%").attr("height","100%").attr("viewBox",`0 0 ${this.width} ${this.height}`).attr("preserveAspectRatio","xMidYMid meet");const i=this.svg.append("g").attr("transform","translate(0,20)"),d=nF().size([this.width-40,this.height-60])($_(this.treeData));i.selectAll(".link").data(d.links()).enter().append("path").attr("class","link").attr("d",x=>`M${x.source.x},${x.source.y}\n                C${x.source.x},${(x.source.y+x.target.y)/2}\n                 ${x.target.x},${(x.source.y+x.target.y)/2}\n                 ${x.target.x},${x.target.y}`).attr("fill","none").attr("stroke","#c084fc").attr("stroke-width",1.5).attr("opacity",.4),i.selectAll(".node").data(d.descendants()).enter().append("g").attr("class","node").attr("transform",x=>`translate(${x.x},${x.y})`).append("circle").attr("r",x=>x.data.denomination?6:8).attr("fill",x=>x.data.denomination&&x.data.color?x.data.color:0===x.depth?"#e879f9":"#c084fc").attr("opacity",x=>x.data.denomination?.7:.5).attr("stroke","#fff").attr("stroke-width",.5)}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=_l({type:e,selectors:[["app-tree-preview"]],viewQuery:function(i,s){if(1&i&&np(wK,7),2&i){let c;zd(c=Bd())&&(s.treeContainer=c.first)}},decls:2,vars:0,consts:[["treeContainer",""],[1,"w-full","h-full"]],template:function(i,s){1&i&&pn(0,"div",1,0)},styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}"]})}return e})();const TK=["wheelContainer"];let DK=(()=>{class e{wheelContainer;svg;width=400;height=300;hierarchyData={name:"Christianity",children:[{name:"Core",children:[{name:"Protestant",color:"#60A5FA",children:[{name:"SOLA",color:"#93C5FD",children:[{name:"Lutheran",color:"#3B82F6",value:1},{name:"Reformed",color:"#EF4444",value:1},{name:"Anglican",color:"#EC4899",value:1},{name:"Baptist",color:"#92400E",value:1},{name:"Methodist",color:"#10B981",value:1},{name:"Pentecostal",color:"#A855F7",value:1}]}]},{name:"Catholic",color:"#FBBF24",children:[{name:"Papacy",color:"#FCD34D",value:1}]},{name:"E. Orthodox",color:"#FB923C",children:[{name:"Theosis",color:"#FDBA74",value:1}]},{name:"O. Orthodox",color:"#84CC16",children:[{name:"Miaphysite",color:"#BEF264",value:1}]}]}]};ngOnInit(){}ngAfterViewInit(){this.createWheel()}createWheel(){const n=this.wheelContainer.nativeElement;Ui(n).select("svg").remove(),this.svg=Ui(n).append("svg").attr("width","100%").attr("height","100%").attr("viewBox",`0 0 ${this.width} ${this.height}`).attr("preserveAspectRatio","xMidYMid meet");const i=this.width/2,s=this.height/2,d=this.svg.append("g").attr("transform",`translate(${i},${s})`),_=$_(this.hierarchyData).sum(j=>j.value||0).sort((j,J)=>(J.value||0)-(j.value||0));tF().size([2*Math.PI,120])(_);const E=aF().startAngle(j=>j.x0).endAngle(j=>j.x1).padAngle(j=>Math.min((j.x1-j.x0)/2,.005)).padRadius(60).innerRadius(j=>j.y0).outerRadius(j=>j.y1);d.selectAll("path").data(_.descendants().filter(j=>j.depth>=1)).enter().append("path").attr("fill",j=>1===j.depth?"#1e293b":j.data.color||j.parent?.data.color||"#1e293b").attr("opacity",j=>1===j.depth?1:2===j.depth?.95:3===j.depth||4===j.depth?.9:1).attr("stroke","#0f172a").attr("stroke-width",1.5).style("filter","drop-shadow(0 2px 4px rgba(0, 0, 0, 0.4))").attr("d",E);const R=_.children[0];d.append("circle").attr("r",R.y0).attr("fill","transparent").attr("stroke","#475569").attr("stroke-width",1.5).style("filter","drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3))");d.append("rect").attr("x",-1.25).attr("y",-6).attr("width",2.5).attr("height",12).attr("fill","#FBBF24").attr("stroke","#F59E0B").attr("stroke-width",.5).style("filter","drop-shadow(0 1px 2px rgba(0, 0, 0, 0.5))"),d.append("rect").attr("x",-6).attr("y",-3.75).attr("width",12).attr("height",2.5).attr("fill","#FBBF24").attr("stroke","#F59E0B").attr("stroke-width",.5).style("filter","drop-shadow(0 1px 2px rgba(0, 0, 0, 0.5))")}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=_l({type:e,selectors:[["app-denomination-wheel-preview"]],viewQuery:function(i,s){if(1&i&&np(TK,7),2&i){let c;zd(c=Bd())&&(s.wheelContainer=c.first)}},decls:2,vars:0,consts:[["wheelContainer",""],[1,"w-full","h-full"]],template:function(i,s){1&i&&pn(0,"div",1,0)},styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}"]})}return e})(),MK=(()=>{class e{totalChurches=0;denomCounts={};onStatsUpdated(n){this.totalChurches=n.total,this.denomCounts=n.denominations,console.log("Stats updated:",n)}getDenomCount(n){return this.denomCounts[n]||0}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=_l({type:e,selectors:[["app-home"]],decls:247,vars:7,consts:[[1,"fixed","top-0","left-0","right-0","z-50","bg-slate-900/80","backdrop-blur-lg","border-b","border-violet-500/20"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"flex","items-center","justify-between","h-16"],[1,"flex","items-center","gap-3"],[1,"w-8","h-8","bg-gradient-to-br","from-fuchsia-500","to-violet-600","rounded-lg","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-white"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"],[1,"text-xl","font-semibold","text-slate-50"],[1,"text-fuchsia-400"],[1,"hidden"],["href","#",1,"text-slate-300","hover:text-fuchsia-400","transition-colors","duration-200","font-medium"],[1,"flex","items-center","gap-4"],[1,"md:hidden","p-2","rounded-lg","text-slate-300","hover:text-fuchsia-400","hover:bg-slate-800/50","transition-colors","duration-200"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 6h16M4 12h16M4 18h16"],[1,"min-h-screen","bg-gradient-to-br","from-slate-900","via-purple-900","to-slate-900","relative","overflow-hidden","pt-4"],[1,"relative","z-10","max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8","py-16"],[1,"text-center","space-y-16"],[1,"relative","mt-10"],[1,"w-full","flex","items-center","justify-center"],["role","region","aria-label","Church locator card",1,"w-full","max-w-7xl","mx-auto","rounded-3xl","overflow-hidden","border","border-violet-500/20","bg-slate-800/50","relative"],[1,"group","w-full","h-72","md:h-96","relative","transition-all","duration-300","hover:shadow-2xl","hover:shadow-violet-500/10"],[1,"w-full","h-full","block",3,"statsUpdated"],[1,"absolute","inset-0","pointer-events-none",2,"z-index","9999"],[1,"absolute","inset-y-0","left-0","w-full","md:w-2/5","bg-gradient-to-br","from-fuchsia-500/95","to-violet-600/95","transition-all","duration-700","ease-in-out","group-hover:opacity-0","group-hover:translate-x-[-300px]","flex","flex-col","justify-center","py-6","px-4","md:px-8","text-white"],[1,"pointer-events-auto"],[1,"text-xl","md:text-2xl","font-semibold","leading-tight"],[1,"mt-1","text-xs","md:text-sm","text-fuchsia-100/90"],[1,"mt-4","pointer-events-auto"],[1,"text-[10px]","uppercase","tracking-wide","text-fuchsia-100/80","mb-2","font-semibold"],[1,"grid","grid-cols-3","gap-2"],[1,"flex","flex-col","items-center","gap-1"],[1,"w-12","h-12","rounded-md","bg-white/10","backdrop-blur-sm","border","border-white/20","flex","items-center","justify-center","overflow-hidden"],["src","./icon-1.png","alt","Denomination 1",1,"w-8","h-8","object-contain"],[1,"w-12","h-6","rounded-md","bg-white/20","backdrop-blur-sm","border","border-white/30","flex","items-center","justify-center"],[1,"text-sm","font-bold","text-white"],[1,"text-[10px]","text-fuchsia-100/70"],["src","./icon-2.png","alt","Denomination 2",1,"w-8","h-8","object-contain"],["src","./icon-3.png","alt","Denomination 3",1,"w-8","h-8","object-contain"],["src","./icon-4.png","alt","Denomination 4",1,"w-8","h-8","object-contain"],["src","./icon-5.png","alt","Denomination 5",1,"w-8","h-8","object-contain"],["src","./icon-6.png","alt","Denomination 6",1,"w-8","h-8","object-contain"],[1,"mt-4","flex","gap-3","items-center","pointer-events-auto"],[1,"text-center"],[1,"text-2xl","md:text-3xl","font-bold","text-white"],[1,"text-[10px]","text-fuchsia-100/80"],[1,"h-6","w-px","bg-white/20"],[1,"hidden","md:flex","absolute","top-3","right-3","items-center","gap-2","bg-slate-800/60","backdrop-blur","rounded-full","px-3","py-1","text-xs","text-slate-100","transition-opacity","duration-700","group-hover:opacity-0","pointer-events-none","z-30"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-3","h-3"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"],[1,"relative","mt-16"],[1,"text-center","mb-12"],[1,"text-3xl","md:text-4xl","font-bold","text-slate-50","mb-4"],[1,"text-lg","text-violet-300","max-w-2xl","mx-auto"],[1,"grid","md:grid-cols-2","lg:grid-cols-3","gap-6"],["routerLink","/denomination-quiz",1,"group","block","bg-slate-800/50","backdrop-blur-sm","border","border-violet-500/20","rounded-2xl","overflow-hidden","hover:border-violet-400/40","transition-all","duration-300","hover:shadow-xl","hover:shadow-fuchsia-500/10","hover:-translate-y-2"],[1,"aspect-video","bg-gradient-to-br","from-fuchsia-500/20","to-violet-600/20","flex","items-center","justify-center","relative","overflow-hidden"],[1,"absolute","inset-0","bg-gradient-to-br","from-fuchsia-500/10","to-transparent"],[1,"absolute","inset-0","opacity-60","group-hover:opacity-80","transition-opacity","duration-300"],[1,"p-6"],[1,"text-xl","font-semibold","text-slate-50","mb-2","group-hover:text-fuchsia-400","transition-colors"],[1,"text-violet-300","text-sm","leading-relaxed","mb-4"],[1,"flex","items-center","gap-2","text-fuchsia-400","text-sm","font-medium"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","group-hover:translate-x-1","transition-transform"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"group","block","bg-slate-800/50","backdrop-blur-sm","border","border-violet-500/20","rounded-2xl","overflow-hidden","transition-all","duration-300","cursor-not-allowed","relative"],[1,"absolute","inset-0","bg-slate-900/60","backdrop-blur-sm","z-10"],[1,"aspect-video","bg-gradient-to-br","from-amber-500/20","to-orange-600/20","flex","items-center","justify-center","relative","overflow-hidden"],[1,"absolute","inset-0","bg-gradient-to-br","from-amber-500/10","to-transparent"],[1,"absolute","inset-0","opacity-60","transition-opacity","duration-300"],[1,"flex","items-center","gap-2","mb-2"],[1,"text-xs","px-2","py-1","bg-amber-500/20","text-amber-300","rounded-full"],[1,"flex","items-center","gap-2","text-amber-400","text-sm","font-medium"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],[1,"absolute","inset-0","bg-slate-900/60","backdrop-blur-sm","z-20"],[1,"aspect-video","bg-gradient-to-br","from-cyan-500/20","to-blue-600/20","flex","items-center","justify-center","relative","overflow-hidden"],[1,"absolute","inset-0","bg-gradient-to-br","from-cyan-500/10","to-transparent"],[1,"fas","fa-timeline","text-6xl","text-cyan-400","relative"],[1,"text-xs","px-2","py-1","bg-cyan-500/20","text-cyan-300","rounded-full"],[1,"flex","items-center","gap-2","text-cyan-400","text-sm","font-medium"],[1,"aspect-video","bg-gradient-to-br","from-emerald-500/20","to-green-600/20","flex","items-center","justify-center","relative","overflow-hidden"],[1,"absolute","inset-0","bg-gradient-to-br","from-emerald-500/10","to-transparent"],[1,"fas","fa-balance-scale","text-6xl","text-emerald-400","relative"],[1,"text-xs","px-2","py-1","bg-emerald-500/20","text-emerald-300","rounded-full"],[1,"flex","items-center","gap-2","text-emerald-400","text-sm","font-medium"],[1,"fas","fa-scroll","text-6xl","text-amber-400","relative"],[1,"aspect-video","bg-gradient-to-br","from-rose-500/20","to-pink-600/20","flex","items-center","justify-center","relative","overflow-hidden"],[1,"absolute","inset-0","bg-gradient-to-br","from-rose-500/10","to-transparent"],[1,"fas","fa-shield-alt","text-6xl","text-rose-400","relative"],[1,"text-xs","px-2","py-1","bg-rose-500/20","text-rose-300","rounded-full"],[1,"flex","items-center","gap-2","text-rose-400","text-sm","font-medium"],[1,"aspect-video","bg-gradient-to-br","from-indigo-500/20","to-purple-600/20","flex","items-center","justify-center","relative","overflow-hidden"],[1,"absolute","inset-0","bg-gradient-to-br","from-indigo-500/10","to-transparent"],[1,"fas","fa-book-open","text-6xl","text-indigo-400","relative"],[1,"text-xs","px-2","py-1","bg-indigo-500/20","text-indigo-300","rounded-full"],[1,"flex","items-center","gap-2","text-indigo-400","text-sm","font-medium"],[1,"absolute","inset-0","overflow-hidden","pointer-events-none"],[1,"absolute","-top-40","-right-40","w-80","h-80","bg-fuchsia-500/20","rounded-full","blur-3xl"],[1,"absolute","-bottom-40","-left-40","w-80","h-80","bg-cyan-500/20","rounded-full","blur-3xl"],[1,"absolute","top-1/2","left-1/2","transform","-translate-x-1/2","-translate-y-1/2","w-96","h-96","bg-violet-500/10","rounded-full","blur-3xl"]],template:function(i,s){1&i&&(Be(0,"nav",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),er(),Be(5,"svg",5),pn(6,"path",6),We()(),lr(),Be(7,"div",7),vt(8," Theo"),Be(9,"span",8),vt(10,"Viz"),We()()(),Be(11,"div",9)(12,"a",10),vt(13," Reformed Theology "),We(),Be(14,"a",10),vt(15," Kingdom Badges "),We(),Be(16,"a",10),vt(17," Defending Faith "),We(),Be(18,"a",10),vt(19," My Story "),We(),Be(20,"a",10),vt(21," Contact "),We()(),Be(22,"div",11)(23,"button",12),er(),Be(24,"svg",13),pn(25,"path",14),We()()()()()(),lr(),Be(26,"section",15)(27,"div",16),pn(28,"div",17),Be(29,"section",18)(30,"div",19)(31,"div",20)(32,"div",21)(33,"app-church-map",22),xi("statsUpdated",function(d){return s.onStatsUpdated(d)}),We(),Be(34,"div",23)(35,"div",24)(36,"div",25)(37,"h3",26),vt(38,"Church Locator"),We(),Be(39,"p",27),vt(40,"Sound theological communities near you "),We()(),Be(41,"div",28)(42,"h4",29),vt(43,"Featured Denominations"),We(),Be(44,"div",30)(45,"div",31)(46,"div",32),pn(47,"img",33),We(),Be(48,"div",34)(49,"span",35),vt(50),We()(),Be(51,"span",36),vt(52,"Reformed"),We()(),Be(53,"div",31)(54,"div",32),pn(55,"img",37),We(),Be(56,"div",34)(57,"span",35),vt(58),We()(),Be(59,"span",36),vt(60,"Lutheran"),We()(),Be(61,"div",31)(62,"div",32),pn(63,"img",38),We(),Be(64,"div",34)(65,"span",35),vt(66),We()(),Be(67,"span",36),vt(68,"Anglican"),We()(),Be(69,"div",31)(70,"div",32),pn(71,"img",39),We(),Be(72,"div",34)(73,"span",35),vt(74),We()(),Be(75,"span",36),vt(76,"Baptist"),We()(),Be(77,"div",31)(78,"div",32),pn(79,"img",40),We(),Be(80,"div",34)(81,"span",35),vt(82),We()(),Be(83,"span",36),vt(84,"Methodist"),We()(),Be(85,"div",31)(86,"div",32),pn(87,"img",41),We(),Be(88,"div",34)(89,"span",35),vt(90),We()(),Be(91,"span",36),vt(92,"Presby."),We()()()(),Be(93,"div",42)(94,"div",43)(95,"div",44),vt(96),We(),Be(97,"div",45),vt(98,"Churches"),We()(),pn(99,"div",46),Be(100,"div",43)(101,"div",44),vt(102,"6"),We(),Be(103,"div",45),vt(104,"Traditions"),We()()()()(),Be(105,"div",47),er(),Be(106,"svg",48),pn(107,"path",49)(108,"path",50),We(),vt(109," Hover to explore "),We()()()()(),lr(),Be(110,"section",51)(111,"div",52)(112,"h2",53),vt(113," Explore "),Be(114,"span",8),vt(115,"Interactive Visualizations"),We()(),Be(116,"p",54),vt(117," Discover theological concepts through engaging, interactive decision trees and visual guides "),We()(),Be(118,"div",55)(119,"a",56)(120,"div",57),pn(121,"div",58),Be(122,"div",59),pn(123,"app-tree-preview"),We()(),Be(124,"div",60)(125,"h3",61),vt(126," Denomination Decision Tree "),We(),Be(127,"p",62),vt(128," Navigate through theological questions to discover which Christian denomination aligns with your beliefs "),We(),Be(129,"div",63)(130,"span"),vt(131,"Start Quiz"),We(),er(),Be(132,"svg",64),pn(133,"path",65),We()()()(),lr(),Be(134,"div",66),pn(135,"div",67),Be(136,"div",68),pn(137,"div",69),Be(138,"div",70),pn(139,"app-denomination-wheel-preview"),We()(),Be(140,"div",60)(141,"div",71)(142,"h3",7),vt(143," Denomination Wheel "),We(),Be(144,"span",72),vt(145,"Coming Soon"),We()(),Be(146,"p",62),vt(147," Visualize the theological relationships between Christian denominations in a circular diagram "),We(),Be(148,"div",73)(149,"span"),vt(150,"Explore Wheel"),We(),er(),Be(151,"svg",74),pn(152,"path",65),We()()()(),lr(),Be(153,"div",66),pn(154,"div",75),Be(155,"div",76),pn(156,"div",77)(157,"i",78),We(),Be(158,"div",60)(159,"div",71)(160,"h3",7),vt(161," Church History Timeline "),We(),Be(162,"span",79),vt(163,"Coming Soon"),We()(),Be(164,"p",62),vt(165," Explore 2000 years of church history through an interactive timeline of key events and figures "),We(),Be(166,"div",80)(167,"span"),vt(168,"View Timeline"),We(),er(),Be(169,"svg",74),pn(170,"path",65),We()()()(),lr(),Be(171,"div",66),pn(172,"div",75),Be(173,"div",81),pn(174,"div",82)(175,"i",83),We(),Be(176,"div",60)(177,"div",71)(178,"h3",7),vt(179," Doctrine Comparison "),We(),Be(180,"span",84),vt(181,"Coming Soon"),We()(),Be(182,"p",62),vt(183," Compare theological positions across denominations on key doctrinal issues side-by-side "),We(),Be(184,"div",85)(185,"span"),vt(186,"Compare Doctrines"),We(),er(),Be(187,"svg",74),pn(188,"path",65),We()()()(),lr(),Be(189,"div",66),pn(190,"div",75),Be(191,"div",68),pn(192,"div",69)(193,"i",86),We(),Be(194,"div",60)(195,"div",71)(196,"h3",7),vt(197," Historic Creeds "),We(),Be(198,"span",72),vt(199,"Coming Soon"),We()(),Be(200,"p",62),vt(201," Study the historic creeds and confessions that have shaped Christian orthodoxy "),We(),Be(202,"div",73)(203,"span"),vt(204,"Explore Creeds"),We(),er(),Be(205,"svg",74),pn(206,"path",65),We()()()(),lr(),Be(207,"div",66),pn(208,"div",75),Be(209,"div",87),pn(210,"div",88)(211,"i",89),We(),Be(212,"div",60)(213,"div",71)(214,"h3",7),vt(215," Apologetics Guide "),We(),Be(216,"span",90),vt(217,"Coming Soon"),We()(),Be(218,"p",62),vt(219," Interactive guide to classical arguments for the Christian faith and responses to objections "),We(),Be(220,"div",91)(221,"span"),vt(222,"Learn More"),We(),er(),Be(223,"svg",74),pn(224,"path",65),We()()()(),lr(),Be(225,"div",66),pn(226,"div",75),Be(227,"div",92),pn(228,"div",93)(229,"i",94),We(),Be(230,"div",60)(231,"div",71)(232,"h3",7),vt(233," Biblical Themes "),We(),Be(234,"span",95),vt(235,"Coming Soon"),We()(),Be(236,"p",62),vt(237," Visualize connections between major biblical themes and how they develop throughout Scripture "),We(),Be(238,"div",96)(239,"span"),vt(240,"Explore Themes"),We(),er(),Be(241,"svg",74),pn(242,"path",65),We()()()()()()(),lr(),Be(243,"div",97),pn(244,"div",98)(245,"div",99)(246,"div",100),We()()),2&i&&(Xt(50),wo(s.getDenomCount(1)),Xt(8),wo(s.getDenomCount(2)),Xt(8),wo(s.getDenomCount(3)),Xt(8),wo(s.getDenomCount(4)),Xt(8),wo(s.getDenomCount(5)),Xt(8),wo(s.getDenomCount(6)),Xt(6),wo(s.totalChurches))},dependencies:[p0,g9,CK,DK],encapsulation:2})}return e})(),EK=(()=>{class e{constructor(n){this._host=n,this._content=pl(""),this._idForAriaDescribedBy=`__${btoa(String(Math.random()+Math.random())).substring(5,15).toLowerCase()}__`,this._className=pl(void 0),this._theme=pl("light"),this._placement="vertical",this._isVisible=!1}hide(){this._isVisible=!1,this._tooltip.classList.remove("enter"),this._tooltip.classList.add("leave")}ngOnDestroy(){this._afterClosedListener=void 0}setClassName(n){this._className.set(n)}setTheme(n){this._theme.set(n)}setAfterClosedListener(n){this._afterClosedListener=n}setPlacement(n){this._placement=n}show(n,i){document.body.contains(n)&&(n.setAttribute("aria-describedby",this._idForAriaDescribedBy),this._showTooltip(n.getBoundingClientRect(),i))}_showTooltip(n,i){switch(this._tooltip=this._host.nativeElement.firstElementChild,this._tooltip.querySelector(".lc-tooltip__content")?.appendChild(i),this._placement){case"vertical":this._showBottom(n);break;case"horizontal":this._showRight(n);break;default:throw new Error(`Invalid placement: ${String(this._placement)}`)}}_showBottom(n){this._tooltip.classList.add("bottom"),setTimeout(()=>{const i=this._tooltip.getBoundingClientRect(),d=n.left+(n.width-i.width)/2;let _=n.bottom+10;_+15+i.height+10>=window.innerHeight&&(_=n.top-i.height-10,_<0&&(this._tooltip.style.height=n.top-15+"px",_=5),this._tooltip.classList.remove("bottom"),this._tooltip.classList.add("top"));const E=this._calculateRightEdgeOverflowingDistance(d,i.width)||this._calculateLeftEdgeOverflowingDistance(d);this._tooltip.style.left=d-E+"px",this._tooltip.style.top=`${_}px`,this._tooltip.style.visibility="visible",this._isVisible=!0,this._tooltip.classList.add("enter")},0)}_calculateRightEdgeOverflowingDistance(n,i){const c=n+i-window.innerWidth+5;return c>5?(this._tooltip.querySelector(".lc-tooltip__arrow").style.left=`calc(50% + ${c}px)`,c):0}_calculateLeftEdgeOverflowingDistance(n){if(n<0){const s=`calc(50% - ${Math.abs(n)+5}px)`;return this._tooltip.querySelector(".lc-tooltip__arrow").style.left=s,n-5}return 0}_showRight(n){this._tooltip.classList.add("right"),setTimeout(()=>{const i=this._tooltip.getBoundingClientRect(),d=n.top+(n.height-i.height)/2;let _=n.right+10;if(n.right+15+i.width+10>=window.innerWidth)_=n.left-i.width-10,_<0&&(this._tooltip.style.width=n.left-15+"px",_=5),this._tooltip.classList.remove("right"),this._tooltip.classList.add("left");else{const z=_+i.width-window.innerWidth;z>0&&(this._tooltip.style.width=i.width-z-5+"px")}const E=this._calculateRightEdgeOverflowingDistance(_,i.width)||this._calculateLeftEdgeOverflowingDistance(_);this._tooltip.style.left=_-E+"px",this._tooltip.style.top=`${d}px`,this._tooltip.style.visibility="visible",this._isVisible=!0,this._tooltip.classList.add("enter")},0)}_onAnimationDone(){!this._isVisible&&this._afterClosedListener&&this._afterClosedListener()}showAt(n,i,s){this._showTooltip({bottom:i+1,height:1,left:n,right:n+1,top:i,width:1,x:n,y:i},s)}static{this.\u0275fac=function(i){return new(i||e)(rn(Rs,1))}}static{this.\u0275cmp=_l({type:e,selectors:[["lc-tooltip"]],hostAttrs:[1,"lc-tooltip-container"],decls:3,vars:6,consts:[[3,"animationend"],[1,"lc-tooltip__arrow"],[1,"lc-tooltip__content",3,"id","innerHTML"]],template:function(i,s){1&i&&(Be(0,"div",0),xi("animationend",function(){return s._onAnimationDone()}),pn(1,"div",1)(2,"div",2),We()),2&i&&(hP("lc-tooltip ",s._theme(),"",s._className()?" "+s._className():"",""),Xt(2),Mi("id",s._idForAriaDescribedBy)("innerHTML",s._content(),zs))},styles:['.lc-tooltip-container{position:fixed;display:block;inset:0;z-index:1000;pointer-events:none!important}.lc-tooltip{position:absolute;border-radius:5px;animation-duration:.3s;animation-timing-function:cubic-bezier(.04,.54,.25,1);animation-fill-mode:forwards;max-width:98vw;max-height:98vw;background-color:var(--tooltip-bg-color);box-shadow:var(--tooltip-shadow);border:var(--tooltip-border);pointer-events:auto;visibility:hidden}.lc-tooltip.dark{--tooltip-bg-color: #353535;--tooltip-text-color: #fff;--tooltip-shadow: 0px .5rem .75rem rgba(0, 0, 0, .15), 0px .25rem 3rem rgba(0, 0, 0, .15);--tooltip-border: 1px solid rgba(255, 255, 255, .03)}.lc-tooltip.light{--tooltip-bg-color: #fff;--tooltip-text-color: #000;--tooltip-shadow: 1px .5rem .75rem rgba(0, 0, 0, .05), 1px .25rem 3rem rgba(0, 0, 0, .05);--tooltip-border: 1px solid rgba(0, 0, 0, .08)}.lc-tooltip.enter{animation-name:enter}.lc-tooltip.leave{animation-name:leave}@keyframes enter{0%{opacity:0;visibility:hidden}to{opacity:1;visibility:visible}}@keyframes leave{0%{opacity:1;visibility:visible}to{opacity:0;visibility:hidden}}.lc-tooltip__arrow{overflow:hidden;position:absolute;width:20px;height:20px;pointer-events:none}.lc-tooltip__arrow:after{content:"";background-color:var(--tooltip-bg-color);position:relative;width:inherit;height:inherit;display:inline-block;box-shadow:var(--tooltip-shadow);border-radius:3px;border:var(--tooltip-border)}.lc-tooltip__content{padding:10px 8px;font-family:inherit;color:var(--tooltip-text-color);white-space:pre-wrap;font-size:.98em;box-sizing:border-box;height:100%;overflow-y:auto;position:relative}.lc-tooltip.top .lc-tooltip__arrow{transform:translate(-50%);top:100%;left:50%}.lc-tooltip.top .lc-tooltip__arrow:after{transform:translateY(-16.5px) rotate(45deg);box-shadow:none}.lc-tooltip.bottom .lc-tooltip__arrow{transform:translate(-50%);top:-20px;left:50%}.lc-tooltip.bottom .lc-tooltip__arrow:after{transform:translateY(15px) rotate(45deg);box-shadow:none}.lc-tooltip.left .lc-tooltip__arrow{transform:translateY(-55%);top:50%;left:100%}.lc-tooltip.left .lc-tooltip__arrow:after{transform:translate(-75%) rotate(45deg);box-shadow:none}.lc-tooltip.right .lc-tooltip__arrow{transform:translateY(-55%) translate(-20px);top:50%;left:0}.lc-tooltip.right .lc-tooltip__arrow:after{transform:translate(67%) rotate(45deg);box-shadow:none}\n'],encapsulation:2,changeDetection:0})}}return e})(),SK=(()=>{class e{static{this._defaultTheme="light"}constructor(n){this._applicationRef=n,this._openedTooltips=new Set}static setDefaultTheme(n){e._defaultTheme=n}show(n,i){const s=this._prepareTooltip(i);s.tooltipRef.instance.show(n,s.content.rootNode),this._openedTooltips.add(s.tooltipRef.instance)}_prepareTooltip(n){const i=Sk(EK,{environmentInjector:this._applicationRef.injector}),s=this._createContent(n);return n.className&&i.instance.setClassName(n.className),n.placement&&i.instance.setPlacement(n.placement),i.instance.setTheme(n.theme||e._defaultTheme),i.instance.setAfterClosedListener(()=>{this._applicationRef.detachView(i.hostView),i.destroy(),s.ref?.destroy()}),this._applicationRef.attachView(i.hostView),i.changeDetectorRef.detectChanges(),document.body.appendChild(i.location.nativeElement),{content:s,tooltipRef:i}}_createContent(n){if("string"==typeof n.content){const s=document.createElement("div");return s.innerHTML=n.content,{ref:null,rootNode:s}}if(n.content instanceof $h){const s=n.content.createEmbeddedView(n.context||{});return this._applicationRef.attachView(s),{ref:s,rootNode:s.rootNodes.reduce((c,d)=>(c.appendChild(d),c),document.createDocumentFragment())}}const i=Sk(n.content,{environmentInjector:this._applicationRef.injector});return this._applicationRef.attachView(i.hostView),{ref:i,rootNode:i.location.nativeElement}}showAt(n,i,s){const c=this._prepareTooltip(s);c.tooltipRef.instance.showAt(n,i,c.content.rootNode),this._openedTooltips.add(c.tooltipRef.instance)}hide(){for(const n of this._openedTooltips)n.hide();this._openedTooltips.clear()}static{this.\u0275fac=function(i){return new(i||e)(Jn(ec))}}static{this.\u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function H_(e){return e instanceof HTMLElement}function gp(e){return"function"==typeof e}function O0(e){return"string"==typeof e}function Ka(e){return void 0===e}class pE{on(t,n,i,s=!1){var c;return Ka(this.bindings)&&(this.bindings={}),Ka(this.bindings[t])&&(this.bindings[t]=[]),null==(c=this.bindings[t])||c.push({handler:n,ctx:i,once:s}),this}once(t,n,i){return this.on(t,n,i,!0)}off(t,n){return Ka(this.bindings)||Ka(this.bindings[t])||(Ka(n)?delete this.bindings[t]:null==(i=this.bindings[t])||i.forEach((s,c)=>{var d;s.handler===n&&(null==(d=this.bindings[t])||d.splice(c,1))})),this;var i}trigger(t,...n){var i;return!Ka(this.bindings)&&this.bindings[t]&&(null==(i=this.bindings[t])||i.forEach((s,c)=>{const{ctx:d,handler:_,once:x}=s;var R;_.apply(d||this,n),x&&(null==(R=this.bindings[t])||R.splice(c,1))})),this}}function rc(){return rc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},rc.apply(null,arguments)}function mE(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(t.includes(i))continue;n[i]=e[i]}return n}const _p={defaultMerge:Symbol("deepmerge-ts: default merge"),skip:Symbol("deepmerge-ts: skip")};function PK(e,t){return t}function AK(e,t){return e.filter(n=>void 0!==n)}function uF(e){return"object"!=typeof e||null===e?0:Array.isArray(e)?2:function OK(e){if(!dF.has(Object.prototype.toString.call(e)))return!1;const{constructor:t}=e;if(void 0===t)return!0;const n=t.prototype;return!(null===n||"object"!=typeof n||!dF.has(Object.prototype.toString.call(n))||!n.hasOwnProperty("isPrototypeOf"))}(e)?1:e instanceof Set?3:e instanceof Map?4:5}function LK(e,t){return"object"==typeof e&&Object.prototype.propertyIsEnumerable.call(e,t)}function hF(e){return{*[Symbol.iterator](){for(const t of e)for(const n of t)yield n}}}const dF=new Set(["[object Object]","[object Module]"]),vw={mergeRecords:function FK(e,t,n){const i={};for(const s of function RK(e){const t=new Set;for(const n of e)for(const i of[...Object.keys(n),...Object.getOwnPropertySymbols(n)])t.add(i);return t}(e)){const c=[];for(const x of e)LK(x,s)&&c.push(x[s]);if(0===c.length)continue;const d=t.metaDataUpdater(n,{key:s,parents:e}),_=fF(c,t,d);_!==_p.skip&&("__proto__"===s?Object.defineProperty(i,s,{value:_,configurable:!0,enumerable:!0,writable:!0}):i[s]=_)}return i},mergeArrays:function NK(e){return e.flat()},mergeSets:function zK(e){return new Set(hF(e))},mergeMaps:function BK(e){return new Map(hF(e))},mergeOthers:function VK(e){return e.at(-1)}};function gE(...e){return function jK(e,t){const n=function UK(e,t){var n,i,s;return{defaultMergeFunctions:vw,mergeFunctions:rc({},vw,Object.fromEntries(Object.entries(e).filter(([c,d])=>Object.hasOwn(vw,c)).map(([c,d])=>!1===d?[c,vw.mergeOthers]:[c,d]))),metaDataUpdater:null!=(n=e.metaDataUpdater)?n:PK,deepmerge:t,useImplicitDefaultMerging:null!=(i=e.enableImplicitDefaultMerging)&&i,filterValues:!1===e.filterValues?void 0:null!=(s=e.filterValues)?s:AK,actions:_p}}(e,i);function i(...s){return fF(s,n,t)}return i}({})(...e)}function fF(e,t,n){var i;const s=null!=(i=null==t.filterValues?void 0:t.filterValues(e,n))?i:e;if(0===s.length)return;if(1===s.length)return _E(s,t,n);const c=uF(s[0]);if(0!==c&&5!==c)for(let d=1;d<s.length;d++)if(uF(s[d])!==c)return _E(s,t,n);switch(c){case 1:return function $K(e,t,n){const i=t.mergeFunctions.mergeRecords(e,t,n);return i===_p.defaultMerge||t.useImplicitDefaultMerging&&void 0===i&&t.mergeFunctions.mergeRecords!==t.defaultMergeFunctions.mergeRecords?t.defaultMergeFunctions.mergeRecords(e,t,n):i}(s,t,n);case 2:return function GK(e,t,n){const i=t.mergeFunctions.mergeArrays(e,t,n);return i===_p.defaultMerge||t.useImplicitDefaultMerging&&void 0===i&&t.mergeFunctions.mergeArrays!==t.defaultMergeFunctions.mergeArrays?t.defaultMergeFunctions.mergeArrays(e):i}(s,t,n);case 3:return function HK(e,t,n){const i=t.mergeFunctions.mergeSets(e,t,n);return i===_p.defaultMerge||t.useImplicitDefaultMerging&&void 0===i&&t.mergeFunctions.mergeSets!==t.defaultMergeFunctions.mergeSets?t.defaultMergeFunctions.mergeSets(e):i}(s,t,n);case 4:return function ZK(e,t,n){const i=t.mergeFunctions.mergeMaps(e,t,n);return i===_p.defaultMerge||t.useImplicitDefaultMerging&&void 0===i&&t.mergeFunctions.mergeMaps!==t.defaultMergeFunctions.mergeMaps?t.defaultMergeFunctions.mergeMaps(e):i}(s,t,n);default:return _E(s,t,n)}}function _E(e,t,n){const i=t.mergeFunctions.mergeOthers(e,t,n);return i===_p.defaultMerge||t.useImplicitDefaultMerging&&void 0===i&&t.mergeFunctions.mergeOthers!==t.defaultMergeFunctions.mergeOthers?t.defaultMergeFunctions.mergeOthers(e):i}function yE(e){const t=Object.getOwnPropertyNames(e.constructor.prototype);for(let n=0;n<t.length;n++){const i=t[n],s=e[i];"constructor"!==i&&"function"==typeof s&&(e[i]=s.bind(e))}return e}function pF(e){return O0(e)&&""!==e?"-"!==e.charAt(e.length-1)?`${e}-`:e:""}function mF(e){return null==e||!e.element||!e.on}function gF(){let e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)})}const _F=["start","end"],yF=["top","right","bottom","left"].reduce((e,t)=>e.concat(t,t+"-"+_F[0],t+"-"+_F[1]),[]),Z_=Math.min,Hm=Math.max,bw=Math.round,xw=Math.floor,nd=e=>({x:e,y:e}),eQ={left:"right",right:"left",bottom:"top",top:"bottom"},tQ={start:"end",end:"start"};function vE(e,t,n){return Hm(e,Z_(t,n))}function Zm(e,t){return"function"==typeof e?e(t):e}function Kd(e){return e.split("-")[0]}function Qd(e){return e.split("-")[1]}function bE(e){return"x"===e?"y":"x"}function xE(e){return"y"===e?"height":"width"}function qm(e){return["top","bottom"].includes(Kd(e))?"y":"x"}function wE(e){return bE(qm(e))}function vF(e,t,n){void 0===n&&(n=!1);const i=Qd(e),s=wE(e),c=xE(s);let d="x"===s?i===(n?"end":"start")?"right":"left":"start"===i?"bottom":"top";return t.reference[c]>t.floating[c]&&(d=Cw(d)),[d,Cw(d)]}function ww(e){return e.replace(/start|end/g,t=>tQ[t])}function Cw(e){return e.replace(/left|right|bottom|top/g,t=>eQ[t])}function bF(e){return"number"!=typeof e?function oQ(e){return rc({top:0,right:0,bottom:0,left:0},e)}(e):{top:e,right:e,bottom:e,left:e}}function Tw(e){const{x:t,y:n,width:i,height:s}=e;return{width:i,height:s,top:n,left:t,right:t+i,bottom:n+s,x:t,y:n}}const sQ=["crossAxis","alignment","allowedPlacements","autoAlignment"],aQ=["mainAxis","crossAxis","fallbackPlacements","fallbackStrategy","fallbackAxisSideDirection","flipAlignment"],lQ=["mainAxis","crossAxis","limiter"];function xF(e,t,n){let{reference:i,floating:s}=e;const c=qm(t),d=wE(t),_=xE(d),x=Kd(t),E="y"===c,R=i.x+i.width/2-s.width/2,z=i.y+i.height/2-s.height/2,V=i[_]/2-s[_]/2;let j;switch(x){case"top":j={x:R,y:i.y-s.height};break;case"bottom":j={x:R,y:i.y+i.height};break;case"right":j={x:i.x+i.width,y:z};break;case"left":j={x:i.x-s.width,y:z};break;default:j={x:i.x,y:i.y}}switch(Qd(t)){case"start":j[d]-=V*(n&&E?-1:1);break;case"end":j[d]+=V*(n&&E?-1:1)}return j}const cQ=function(){var e=Pe(function*(t,n,i){const{placement:s="bottom",strategy:c="absolute",middleware:d=[],platform:_}=i,x=d.filter(Boolean),E=yield null==_.isRTL?void 0:_.isRTL(n);let R=yield _.getElementRects({reference:t,floating:n,strategy:c}),{x:z,y:V}=xF(R,s,E),j=s,J={},se=0;for(let le=0;le<x.length;le++){const{name:de,fn:ae}=x[le],{x:ze,y:Se,data:ut,reset:Nt}=yield ae({x:z,y:V,initialPlacement:s,placement:j,strategy:c,middlewareData:J,rects:R,platform:_,elements:{reference:t,floating:n}});z=ze??z,V=Se??V,J=rc({},J,{[de]:rc({},J[de],ut)}),Nt&&se<=50&&(se++,"object"==typeof Nt&&(Nt.placement&&(j=Nt.placement),Nt.rects&&(R=!0===Nt.rects?yield _.getElementRects({reference:t,floating:n,strategy:c}):Nt.rects),({x:z,y:V}=xF(R,j,E))),le=-1)}return{x:z,y:V,placement:j,strategy:c,middlewareData:J}});return function(n,i,s){return e.apply(this,arguments)}}();function CE(e,t){return TE.apply(this,arguments)}function TE(){return(TE=Pe(function*(e,t){var n;void 0===t&&(t={});const{x:i,y:s,platform:c,rects:d,elements:_,strategy:x}=e,{boundary:E="clippingAncestors",rootBoundary:R="viewport",elementContext:z="floating",altBoundary:V=!1,padding:j=0}=Zm(t,e),J=bF(j),le=_[V?"floating"===z?"reference":"floating":z],de=Tw(yield c.getClippingRect({element:null==(n=yield null==c.isElement?void 0:c.isElement(le))||n?le:le.contextElement||(yield null==c.getDocumentElement?void 0:c.getDocumentElement(_.floating)),boundary:E,rootBoundary:R,strategy:x})),ae="floating"===z?{x:i,y:s,width:d.floating.width,height:d.floating.height}:d.reference,ze=yield null==c.getOffsetParent?void 0:c.getOffsetParent(_.floating),Se=(yield null==c.isElement?void 0:c.isElement(ze))&&(yield null==c.getScale?void 0:c.getScale(ze))||{x:1,y:1},ut=Tw(c.convertOffsetParentRelativeRectToViewportRelativeRect?yield c.convertOffsetParentRelativeRectToViewportRelativeRect({elements:_,rect:ae,offsetParent:ze,strategy:x}):ae);return{top:(de.top-ut.top+J.top)/Se.y,bottom:(ut.bottom-de.bottom+J.bottom)/Se.y,left:(de.left-ut.left+J.left)/Se.x,right:(ut.right-de.right+J.right)/Se.x}})).apply(this,arguments)}function Dw(){return typeof window<"u"}function q_(e){return wF(e)?(e.nodeName||"").toLowerCase():"#document"}function Ac(e){var t;return(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function id(e){var t;return null==(t=(wF(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function wF(e){return!!Dw()&&(e instanceof Node||e instanceof Ac(e).Node)}function ch(e){return!!Dw()&&(e instanceof Element||e instanceof Ac(e).Element)}function rd(e){return!!Dw()&&(e instanceof HTMLElement||e instanceof Ac(e).HTMLElement)}function CF(e){return!(!Dw()||typeof ShadowRoot>"u")&&(e instanceof ShadowRoot||e instanceof Ac(e).ShadowRoot)}function F0(e){const{overflow:t,overflowX:n,overflowY:i,display:s}=uh(e);return/auto|scroll|overlay|hidden|clip/.test(t+i+n)&&!["inline","contents"].includes(s)}function gQ(e){return["table","td","th"].includes(q_(e))}function Mw(e){return[":popover-open",":modal"].some(t=>{try{return e.matches(t)}catch{return!1}})}function DE(e){const t=ME(),n=ch(e)?uh(e):e;return["transform","translate","scale","rotate","perspective"].some(i=>!!n[i]&&"none"!==n[i])||!!n.containerType&&"normal"!==n.containerType||!t&&!!n.backdropFilter&&"none"!==n.backdropFilter||!t&&!!n.filter&&"none"!==n.filter||["transform","translate","scale","rotate","perspective","filter"].some(i=>(n.willChange||"").includes(i))||["paint","layout","strict","content"].some(i=>(n.contain||"").includes(i))}function ME(){return!(typeof CSS>"u"||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}function W_(e){return["html","body","#document"].includes(q_(e))}function uh(e){return Ac(e).getComputedStyle(e)}function Ew(e){return ch(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function yp(e){if("html"===q_(e))return e;const t=e.assignedSlot||e.parentNode||CF(e)&&e.host||id(e);return CF(t)?t.host:t}function TF(e){const t=yp(e);return W_(t)?e.ownerDocument?e.ownerDocument.body:e.body:rd(t)&&F0(t)?t:TF(t)}function N0(e,t,n){var i;void 0===t&&(t=[]),void 0===n&&(n=!0);const s=TF(e),c=s===(null==(i=e.ownerDocument)?void 0:i.body),d=Ac(s);if(c){const _=EE(d);return t.concat(d,d.visualViewport||[],F0(s)?s:[],_&&n?N0(_):[])}return t.concat(s,N0(s,[],n))}function EE(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function DF(e){const t=uh(e);let n=parseFloat(t.width)||0,i=parseFloat(t.height)||0;const s=rd(e),c=s?e.offsetWidth:n,d=s?e.offsetHeight:i,_=bw(n)!==c||bw(i)!==d;return _&&(n=c,i=d),{width:n,height:i,$:_}}function SE(e){return ch(e)?e:e.contextElement}function Y_(e){const t=SE(e);if(!rd(t))return nd(1);const n=t.getBoundingClientRect(),{width:i,height:s,$:c}=DF(t);let d=(c?bw(n.width):n.width)/i,_=(c?bw(n.height):n.height)/s;return(!d||!Number.isFinite(d))&&(d=1),(!_||!Number.isFinite(_))&&(_=1),{x:d,y:_}}const yQ=nd(0);function MF(e){const t=Ac(e);return ME()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:yQ}function Wm(e,t,n,i){void 0===t&&(t=!1),void 0===n&&(n=!1);const s=e.getBoundingClientRect(),c=SE(e);let d=nd(1);t&&(i?ch(i)&&(d=Y_(i)):d=Y_(e));const _=function vQ(e,t,n){return void 0===t&&(t=!1),!(!n||t&&n!==Ac(e))&&t}(c,n,i)?MF(c):nd(0);let x=(s.left+_.x)/d.x,E=(s.top+_.y)/d.y,R=s.width/d.x,z=s.height/d.y;if(c){const V=Ac(c),j=i&&ch(i)?Ac(i):i;let J=V,se=EE(J);for(;se&&i&&j!==J;){const le=Y_(se),de=se.getBoundingClientRect(),ae=uh(se),ze=de.left+(se.clientLeft+parseFloat(ae.paddingLeft))*le.x,Se=de.top+(se.clientTop+parseFloat(ae.paddingTop))*le.y;x*=le.x,E*=le.y,R*=le.x,z*=le.y,x+=ze,E+=Se,J=Ac(se),se=EE(J)}}return Tw({width:R,height:z,x,y:E})}function IE(e,t){const n=Ew(e).scrollLeft;return t?t.left+n:Wm(id(e)).left+n}function EF(e,t,n){void 0===n&&(n=!1);const i=e.getBoundingClientRect();return{x:i.left+t.scrollLeft-(n?0:IE(e,i)),y:i.top+t.scrollTop}}function SF(e,t,n){let i;if("viewport"===t)i=function CQ(e,t){const n=Ac(e),i=id(e),s=n.visualViewport;let c=i.clientWidth,d=i.clientHeight,_=0,x=0;if(s){c=s.width,d=s.height;const E=ME();(!E||E&&"fixed"===t)&&(_=s.offsetLeft,x=s.offsetTop)}return{width:c,height:d,x:_,y:x}}(e,n);else if("document"===t)i=function wQ(e){const t=id(e),n=Ew(e),i=e.ownerDocument.body,s=Hm(t.scrollWidth,t.clientWidth,i.scrollWidth,i.clientWidth),c=Hm(t.scrollHeight,t.clientHeight,i.scrollHeight,i.clientHeight);let d=-n.scrollLeft+IE(e);const _=-n.scrollTop;return"rtl"===uh(i).direction&&(d+=Hm(t.clientWidth,i.clientWidth)-s),{width:s,height:c,x:d,y:_}}(id(e));else if(ch(t))i=function TQ(e,t){const n=Wm(e,!0,"fixed"===t),i=n.top+e.clientTop,s=n.left+e.clientLeft,c=rd(e)?Y_(e):nd(1);return{width:e.clientWidth*c.x,height:e.clientHeight*c.y,x:s*c.x,y:i*c.y}}(t,n);else{const s=MF(e);i={x:t.x-s.x,y:t.y-s.y,width:t.width,height:t.height}}return Tw(i)}function IF(e,t){const n=yp(e);return!(n===t||!ch(n)||W_(n))&&("fixed"===uh(n).position||IF(n,t))}function DQ(e,t){const n=t.get(e);if(n)return n;let i=N0(e,[],!1).filter(_=>ch(_)&&"body"!==q_(_)),s=null;const c="fixed"===uh(e).position;let d=c?yp(e):e;for(;ch(d)&&!W_(d);){const _=uh(d),x=DE(d);!x&&"fixed"===_.position&&(s=null),(c?!x&&!s:!x&&"static"===_.position&&s&&["absolute","fixed"].includes(s.position)||F0(d)&&!x&&IF(e,d))?i=i.filter(R=>R!==d):s=_,d=yp(d)}return t.set(e,i),i}function SQ(e,t,n){const i=rd(t),s=id(t),c="fixed"===n,d=Wm(e,!0,c,t);let _={scrollLeft:0,scrollTop:0};const x=nd(0);function E(){x.x=IE(s)}if(i||!i&&!c)if(("body"!==q_(t)||F0(s))&&(_=Ew(t)),i){const j=Wm(t,!0,c,t);x.x=j.x+t.clientLeft,x.y=j.y+t.clientTop}else s&&E();c&&!i&&s&&E();const R=!s||i||c?nd(0):EF(s,_);return{x:d.left+_.scrollLeft-x.x-R.x,y:d.top+_.scrollTop-x.y-R.y,width:d.width,height:d.height}}function PE(e){return"static"===uh(e).position}function PF(e,t){if(!rd(e)||"fixed"===uh(e).position)return null;if(t)return t(e);let n=e.offsetParent;return id(e)===n&&(n=n.ownerDocument.body),n}function AF(e,t){const n=Ac(e);if(Mw(e))return n;if(!rd(e)){let s=yp(e);for(;s&&!W_(s);){if(ch(s)&&!PE(s))return s;s=yp(s)}return n}let i=PF(e,t);for(;i&&gQ(i)&&PE(i);)i=PF(i,t);return i&&W_(i)&&PE(i)&&!DE(i)?n:i||function _Q(e){let t=yp(e);for(;rd(t)&&!W_(t);){if(DE(t))return t;if(Mw(t))return null;t=yp(t)}return null}(e)||n}const AQ={convertOffsetParentRelativeRectToViewportRelativeRect:function bQ(e){let{elements:t,rect:n,offsetParent:i,strategy:s}=e;const c="fixed"===s,d=id(i),_=!!t&&Mw(t.floating);if(i===d||_&&c)return n;let x={scrollLeft:0,scrollTop:0},E=nd(1);const R=nd(0),z=rd(i);if((z||!z&&!c)&&(("body"!==q_(i)||F0(d))&&(x=Ew(i)),rd(i))){const j=Wm(i);E=Y_(i),R.x=j.x+i.clientLeft,R.y=j.y+i.clientTop}const V=!d||z||c?nd(0):EF(d,x,!0);return{width:n.width*E.x,height:n.height*E.y,x:n.x*E.x-x.scrollLeft*E.x+R.x+V.x,y:n.y*E.y-x.scrollTop*E.y+R.y+V.y}},getDocumentElement:id,getClippingRect:function MQ(e){let{element:t,boundary:n,rootBoundary:i,strategy:s}=e;const d=[..."clippingAncestors"===n?Mw(t)?[]:DQ(t,this._c):[].concat(n),i],x=d.reduce((E,R)=>{const z=SF(t,R,s);return E.top=Hm(z.top,E.top),E.right=Z_(z.right,E.right),E.bottom=Z_(z.bottom,E.bottom),E.left=Hm(z.left,E.left),E},SF(t,d[0],s));return{width:x.right-x.left,height:x.bottom-x.top,x:x.left,y:x.top}},getOffsetParent:AF,getElementRects:function(){var e=Pe(function*(n){const i=this.getOffsetParent||AF,s=this.getDimensions,c=yield s(n.floating);return{reference:SQ(n.reference,yield i(n.floating),n.strategy),floating:{x:0,y:0,width:c.width,height:c.height}}});return function t(n){return e.apply(this,arguments)}}(),getClientRects:function xQ(e){return Array.from(e.getClientRects())},getDimensions:function EQ(e){const{width:t,height:n}=DF(e);return{width:t,height:n}},getScale:Y_,isElement:ch,isRTL:function PQ(e){return"rtl"===uh(e).direction}};function kF(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}const zQ=function(t){return void 0===t&&(t={}),{options:t,fn(n){const{x:i,y:s,placement:c,rects:d,middlewareData:_}=n,{offset:x=0,mainAxis:E=!0,crossAxis:R=!0}=Zm(t,n),z={x:i,y:s},V=qm(c),j=bE(V);let J=z[j],se=z[V];const le=Zm(x,n),de="number"==typeof le?{mainAxis:le,crossAxis:0}:rc({mainAxis:0,crossAxis:0},le);if(E){const Se="y"===j?"height":"width",ut=d.reference[j]-d.floating[Se]+de.mainAxis,Nt=d.reference[j]+d.reference[Se]-de.mainAxis;J<ut?J=ut:J>Nt&&(J=Nt)}if(R){var ae,ze;const Se="y"===j?"width":"height",ut=["top","left"].includes(Kd(c)),Nt=d.reference[V]-d.floating[Se]+(ut&&(null==(ae=_.offset)?void 0:ae[V])||0)+(ut?0:de.crossAxis),en=d.reference[V]+d.reference[Se]+(ut?0:(null==(ze=_.offset)?void 0:ze[V])||0)-(ut?de.crossAxis:0);se<Nt?se=Nt:se>en&&(se=en)}return{[j]:J,[V]:se}}}};function VQ(e){e.cleanup&&e.cleanup();const t=e._getResolvedAttachToOptions();let n=t.element;const i=function ZQ(e,t){var n,i,s;const c={strategy:"absolute",middleware:[]},d=function qQ(e){return!(!e.options.arrow||!e.el)&&e.el.querySelector(".shepherd-arrow")}(t),_=mF(e),x=null==(n=e.on)?void 0:n.includes("auto"),E=(null==e||null==(i=e.on)?void 0:i.includes("-start"))||(null==e||null==(s=e.on)?void 0:s.includes("-end"));var R;_||(c.middleware.push(x?function(t){return void 0===t&&(t={}),{name:"autoPlacement",options:t,fn:n=>Pe(function*(){var i,s,c;const{rects:d,middlewareData:_,placement:x,platform:E,elements:R}=n,z=Zm(t,n),{crossAxis:V=!1,alignment:j,allowedPlacements:J=yF,autoAlignment:se=!0}=z,le=mE(z,sQ),de=void 0!==j||J===yF?function hQ(e,t,n){return(e?[...n.filter(s=>Qd(s)===e),...n.filter(s=>Qd(s)!==e)]:n.filter(s=>Kd(s)===s)).filter(s=>!e||Qd(s)===e||!!t&&ww(s)!==s)}(j||null,se,J):J,ae=yield CE(n,le),ze=(null==(i=_.autoPlacement)?void 0:i.index)||0,Se=de[ze];if(null==Se)return{};const ut=vF(Se,d,yield null==E.isRTL?void 0:E.isRTL(R.floating));if(x!==Se)return{reset:{placement:de[0]}};const Nt=[ae[Kd(Se)],ae[ut[0]],ae[ut[1]]],en=[...(null==(s=_.autoPlacement)?void 0:s.overflows)||[],{placement:Se,overflows:Nt}],fn=de[ze+1];if(fn)return{data:{index:ze+1,overflows:en},reset:{placement:fn}};const Gn=en.map(Fn=>{const un=Qd(Fn.placement);return[Fn.placement,un&&V?Fn.overflows.slice(0,2).reduce((tt,_n)=>tt+_n,0):Fn.overflows[0],Fn.overflows]}).sort((Fn,un)=>Fn[1]-un[1]),xn=(null==(c=Gn.filter(Fn=>Fn[2].slice(0,Qd(Fn[0])?2:3).every(un=>un<=0))[0])?void 0:c[0])||Gn[0][0];return xn!==x?{data:{index:ze+1,overflows:en},reset:{placement:xn}}:{}})()}}({crossAxis:!0,alignment:E?null==e||null==(R=e.on)?void 0:R.split("-").pop():null}):function(t){return void 0===t&&(t={}),{name:"flip",options:t,fn:n=>Pe(function*(){var i,s;const{placement:c,middlewareData:d,rects:_,initialPlacement:x,platform:E,elements:R}=n,z=Zm(t,n),{mainAxis:V=!0,crossAxis:j=!0,fallbackPlacements:J,fallbackStrategy:se="bestFit",fallbackAxisSideDirection:le="none",flipAlignment:de=!0}=z,ae=mE(z,aQ);if(null!=(i=d.arrow)&&i.alignmentOffset)return{};const ze=Kd(c),Se=qm(x),ut=Kd(x)===x,Nt=yield null==E.isRTL?void 0:E.isRTL(R.floating),en=J||(ut||!de?[Cw(x)]:function nQ(e){const t=Cw(e);return[ww(e),t,ww(t)]}(x)),fn="none"!==le;!J&&fn&&en.push(...function rQ(e,t,n,i){const s=Qd(e);let c=function iQ(e,t,n){const i=["left","right"],s=["right","left"],c=["top","bottom"],d=["bottom","top"];switch(e){case"top":case"bottom":return n?t?s:i:t?i:s;case"left":case"right":return t?c:d;default:return[]}}(Kd(e),"start"===n,i);return s&&(c=c.map(d=>d+"-"+s),t&&(c=c.concat(c.map(ww)))),c}(x,de,le,Nt));const Gn=[x,...en],At=yield CE(n,ae),xn=[];let Fn=(null==(s=d.flip)?void 0:s.overflows)||[];if(V&&xn.push(At[ze]),j){const cn=vF(c,_,Nt);xn.push(At[cn[0]],At[cn[1]])}if(Fn=[...Fn,{placement:c,overflows:xn}],!xn.every(cn=>cn<=0)){var un,tt;const cn=((null==(un=d.flip)?void 0:un.index)||0)+1,Yn=Gn[cn];if(Yn){var _n;const En="alignment"===j&&Se!==qm(Yn),Xn=(null==(_n=Fn[0])?void 0:_n.overflows[0])>0;if(!En||Xn)return{data:{index:cn,overflows:Fn},reset:{placement:Yn}}}let Rn=null==(tt=Fn.filter(En=>En.overflows[0]<=0).sort((En,Xn)=>En.overflows[1]-Xn.overflows[1])[0])?void 0:tt.placement;if(!Rn)switch(se){case"bestFit":{var zt;const En=null==(zt=Fn.filter(Xn=>{if(fn){const hi=qm(Xn.placement);return hi===Se||"y"===hi}return!0}).map(Xn=>[Xn.placement,Xn.overflows.filter(hi=>hi>0).reduce((hi,$s)=>hi+$s,0)]).sort((Xn,hi)=>Xn[1]-hi[1])[0])?void 0:zt[0];En&&(Rn=En);break}case"initialPlacement":Rn=x}if(c!==Rn)return{reset:{placement:Rn}}}return{}})()}}()),c.middleware.push(function(t){return void 0===t&&(t={}),{name:"shift",options:t,fn:n=>Pe(function*(){const{x:i,y:s,placement:c}=n,d=Zm(t,n),{mainAxis:_=!0,crossAxis:x=!1,limiter:E={fn:ae=>{let{x:ze,y:Se}=ae;return{x:ze,y:Se}}}}=d,R=mE(d,lQ),z={x:i,y:s},V=yield CE(n,R),j=qm(Kd(c)),J=bE(j);let se=z[J],le=z[j];_&&(se=vE(se+V["y"===J?"top":"left"],se,se-V["y"===J?"bottom":"right"])),x&&(le=vE(le+V["y"===j?"top":"left"],le,le-V["y"===j?"bottom":"right"]));const de=E.fn(rc({},n,{[J]:se,[j]:le}));return rc({},de,{data:{x:de.x-i,y:de.y-s,enabled:{[J]:_,[j]:x}}})})()}}({limiter:zQ(),crossAxis:!0})),d&&c.middleware.push((e=>({name:"arrow",options:e,fn:t=>Pe(function*(){const{x:n,y:i,placement:s,rects:c,platform:d,elements:_,middlewareData:x}=t,{element:E,padding:R=0}=Zm(e,t)||{};if(null==E)return{};const z=bF(R),V={x:n,y:i},j=wE(s),J=xE(j),se=yield d.getDimensions(E),le="y"===j,de=le?"top":"left",ae=le?"bottom":"right",ze=le?"clientHeight":"clientWidth",Se=c.reference[J]+c.reference[j]-V[j]-c.floating[J],ut=V[j]-c.reference[j],Nt=yield null==d.getOffsetParent?void 0:d.getOffsetParent(E);let en=Nt?Nt[ze]:0;(!en||!(yield null==d.isElement?void 0:d.isElement(Nt)))&&(en=_.floating[ze]||c.floating[J]);const fn=Se/2-ut/2,Gn=en/2-se[J]/2-1,At=Z_(z[de],Gn),xn=Z_(z[ae],Gn),Fn=At,un=en-se[J]-xn,tt=en/2-se[J]/2+fn,_n=vE(Fn,tt,un),zt=!x.arrow&&null!=Qd(s)&&tt!==_n&&c.reference[J]/2-(tt<Fn?At:xn)-se[J]/2<0,cn=zt?tt<Fn?tt-Fn:tt-un:0;return{[j]:V[j]+cn,data:rc({[j]:_n,centerOffset:tt-_n-cn},zt&&{alignmentOffset:cn}),reset:zt}})()}))({element:d,padding:E?("object"==typeof t.options.arrow?t.options.arrow:{padding:4}).padding:0})),x||(c.placement=e.on));return gE(c,t.options.floatingUIOptions||{})}(t,e),s=mF(t);return s&&(n=document.body,e.shepherdElementComponent.getElement().classList.add("shepherd-centered")),e.cleanup=function RQ(e,t,n,i){void 0===i&&(i={});const{ancestorScroll:s=!0,ancestorResize:c=!0,elementResize:d="function"==typeof ResizeObserver,layoutShift:_="function"==typeof IntersectionObserver,animationFrame:x=!1}=i,E=SE(e),R=s||c?[...E?N0(E):[],...N0(t)]:[];R.forEach(de=>{s&&de.addEventListener("scroll",n,{passive:!0}),c&&de.addEventListener("resize",n)});const z=E&&_?function kQ(e,t){let i,n=null;const s=id(e);function c(){var _;clearTimeout(i),null==(_=n)||_.disconnect(),n=null}return function d(_,x){void 0===_&&(_=!1),void 0===x&&(x=1),c();const E=e.getBoundingClientRect(),{left:R,top:z,width:V,height:j}=E;if(_||t(),!V||!j)return;const ze={rootMargin:-xw(z)+"px "+-xw(s.clientWidth-(R+V))+"px "+-xw(s.clientHeight-(z+j))+"px "+-xw(R)+"px",threshold:Hm(0,Z_(1,x))||1};let Se=!0;function ut(Nt){const en=Nt[0].intersectionRatio;if(en!==x){if(!Se)return d();en?d(!1,en):i=setTimeout(()=>{d(!1,1e-7)},1e3)}1===en&&!kF(E,e.getBoundingClientRect())&&d(),Se=!1}try{n=new IntersectionObserver(ut,rc({},ze,{root:s.ownerDocument}))}catch{n=new IntersectionObserver(ut,ze)}n.observe(e)}(!0),c}(E,n):null;let V=-1,j=null;d&&(j=new ResizeObserver(de=>{let[ae]=de;ae&&ae.target===E&&j&&(j.unobserve(t),cancelAnimationFrame(V),V=requestAnimationFrame(()=>{var ze;null==(ze=j)||ze.observe(t)})),n()}),E&&!x&&j.observe(E),j.observe(t));let J,se=x?Wm(e):null;return x&&function le(){const de=Wm(e);se&&!kF(se,de)&&n(),se=de,J=requestAnimationFrame(le)}(),n(),()=>{var de;R.forEach(ae=>{s&&ae.removeEventListener("scroll",n),c&&ae.removeEventListener("resize",n)}),z?.(),null==(de=j)||de.disconnect(),j=null,x&&cancelAnimationFrame(J)}}(n,e.el,()=>{e.el?function $Q(e,t,n,i){((e,t,n)=>{const i=new Map,s=rc({platform:AQ},n),c=rc({},s.platform,{_c:i});return cQ(e,t,rc({},s,{platform:c}))})(e,t.el,n).then(function GQ(e,t){return({x:n,y:i,placement:s,middlewareData:c})=>(e.el&&(Object.assign(e.el.style,t?{position:"fixed",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}:{position:"absolute",left:`${n}px`,top:`${i}px`}),e.el.dataset.popperPlacement=s,function HQ(e,t){const n=e.querySelector(".shepherd-arrow");if(H_(n)&&t.arrow){const{x:i,y:s}=t.arrow;Object.assign(n.style,{left:null!=i?`${i}px`:"",top:null!=s?`${s}px`:""})}}(e.el,c)),e)}(t,i)).then(s=>new Promise(c=>{setTimeout(()=>c(s),300)})).then(s=>{null!=s&&s.el&&(s.el.tabIndex=0,s.el.focus({preventScroll:!0}))})}(n,e,i,s):null==e.cleanup||e.cleanup()}),e.target=t.element,i}function kc(){}function WQ(e,t){for(const n in t)e[n]=t[n];return e}function RF(e){return e()}function LF(){return Object.create(null)}function z0(e){e.forEach(RF)}function AE(e){return"function"==typeof e}function Jd(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function X_(e,t){e.appendChild(t)}function hh(e,t,n){e.insertBefore(t,n||null)}function cu(e){e.parentNode&&e.parentNode.removeChild(e)}function od(e){return document.createElement(e)}function OF(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function FF(e){return document.createTextNode(e)}function Sw(){return FF(" ")}function Iw(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function po(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}const QQ=["width","height"];function NF(e,t){const n=Object.getOwnPropertyDescriptors(e.__proto__);for(const i in t)null==t[i]?e.removeAttribute(i):"style"===i?e.style.cssText=t[i]:"__value"===i?e.value=e[i]=t[i]:n[i]&&n[i].set&&-1===QQ.indexOf(i)?e[i]=t[i]:po(e,i,t[i])}function K_(e,t,n){e.classList.toggle(t,!!n)}let B0;function V0(e){B0=e}function kE(){if(!B0)throw new Error("Function called outside component initialization");return B0}function RE(e){kE().$$.after_update.push(e)}const Q_=[],J_=[];let ey=[];const zF=[],nJ=Promise.resolve();let LE=!1;function OE(e){ey.push(e)}const FE=new Set;let ty=0;function BF(){if(0!==ty)return;const e=B0;do{try{for(;ty<Q_.length;){const t=Q_[ty];ty++,V0(t),rJ(t.$$)}}catch(t){throw Q_.length=0,ty=0,t}for(V0(null),Q_.length=0,ty=0;J_.length;)J_.pop()();for(let t=0;t<ey.length;t+=1){const n=ey[t];FE.has(n)||(FE.add(n),n())}ey.length=0}while(Q_.length);for(;zF.length;)zF.pop()();LE=!1,FE.clear(),V0(e)}function rJ(e){if(null!==e.fragment){e.update(),z0(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(OE)}}const Pw=new Set;let Ym;function Xm(){Ym={r:0,c:[],p:Ym}}function Km(){Ym.r||z0(Ym.c),Ym=Ym.p}function Gr(e,t){e&&e.i&&(Pw.delete(e),e.i(t))}function Cs(e,t,n,i){if(e&&e.o){if(Pw.has(e))return;Pw.add(e),Ym.c.push(()=>{Pw.delete(e),i&&(n&&e.d(1),i())}),e.o(t)}else i&&i()}function VF(e){return void 0!==e?.length?e:Array.from(e)}function Qm(e){e&&e.c()}function vp(e,t,n){const{fragment:i,after_update:s}=e.$$;i&&i.m(t,n),OE(()=>{const c=e.$$.on_mount.map(RF).filter(AE);e.$$.on_destroy?e.$$.on_destroy.push(...c):z0(c),e.$$.on_mount=[]}),s.forEach(OE)}function bp(e,t){const n=e.$$;null!==n.fragment&&(function oJ(e){const t=[],n=[];ey.forEach(i=>-1===e.indexOf(i)?t.push(i):n.push(i)),n.forEach(i=>i()),ey=t}(n.after_update),z0(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function ef(e,t,n,i,s,c,d=null,_=[-1]){const x=B0;V0(e);const E=e.$$={fragment:null,ctx:[],props:c,update:kc,not_equal:s,bound:LF(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(x?x.$$.context:[])),callbacks:LF(),dirty:_,skip_bound:!1,root:t.target||x.$$.root};d&&d(E.root);let R=!1;if(E.ctx=n?n(e,t.props||{},(z,V,...j)=>{const J=j.length?j[0]:V;return E.ctx&&s(E.ctx[z],E.ctx[z]=J)&&(!E.skip_bound&&E.bound[z]&&E.bound[z](J),R&&function aJ(e,t){-1===e.$$.dirty[0]&&(Q_.push(e),function iJ(){LE||(LE=!0,nJ.then(BF))}(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}(e,z)),V}):[],E.update(),R=!0,z0(E.before_update),E.fragment=!!i&&i(E.ctx),t.target){if(t.hydrate){const z=function JQ(e){return Array.from(e.childNodes)}(t.target);E.fragment&&E.fragment.l(z),z.forEach(cu)}else E.fragment&&E.fragment.c();t.intro&&Gr(e.$$.fragment),vp(e,t.target,t.anchor),BF()}V0(x)}class tf{constructor(){this.$$=void 0,this.$$set=void 0}$destroy(){bp(this,1),this.$destroy=kc}$on(t,n){if(!AE(n))return kc;const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(n),()=>{const s=i.indexOf(n);-1!==s&&i.splice(s,1)}}$set(t){this.$$set&&!function YQ(e){return 0===Object.keys(e).length}(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function cJ(e){let t,n,i,s,c;return{c(){t=od("button"),po(t,"aria-label",n=e[3]?e[3]:null),po(t,"class",i=`${e[1]||""} shepherd-button ${e[4]?"shepherd-button-secondary":""}`),t.disabled=e[2],po(t,"tabindex","0"),po(t,"type","button")},m(d,_){hh(d,t,_),t.innerHTML=e[5],s||(c=Iw(t,"click",function(){AE(e[0])&&e[0].apply(this,arguments)}),s=!0)},p(d,[_]){e=d,32&_&&(t.innerHTML=e[5]),8&_&&n!==(n=e[3]?e[3]:null)&&po(t,"aria-label",n),18&_&&i!==(i=`${e[1]||""} shepherd-button ${e[4]?"shepherd-button-secondary":""}`)&&po(t,"class",i),4&_&&(t.disabled=e[2])},i:kc,o:kc,d(d){d&&cu(t),s=!1,c()}}}function uJ(e,t,n){let c,d,_,x,E,R,{config:i,step:s}=t;function z(V){return gp(V)?V=V.call(s):V}return e.$$set=V=>{"config"in V&&n(6,i=V.config),"step"in V&&n(7,s=V.step)},e.$$.update=()=>{192&e.$$.dirty&&(n(0,c=i.action?i.action.bind(s.tour):null),n(1,d=i.classes),n(2,_=!!i.disabled&&z(i.disabled)),n(3,x=i.label?z(i.label):null),n(4,E=i.secondary),n(5,R=i.text?z(i.text):null))},[c,d,_,x,E,R,i,s]}typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add("4");class hJ extends tf{constructor(t){super(),ef(this,t,uJ,cJ,Jd,{config:6,step:7})}}function jF(e,t,n){const i=e.slice();return i[2]=t[n],i}function UF(e){let t,n,i=VF(e[1]),s=[];for(let d=0;d<i.length;d+=1)s[d]=$F(jF(e,i,d));const c=d=>Cs(s[d],1,1,()=>{s[d]=null});return{c(){for(let d=0;d<s.length;d+=1)s[d].c();t=function KQ(){return FF("")}()},m(d,_){for(let x=0;x<s.length;x+=1)s[x]&&s[x].m(d,_);hh(d,t,_),n=!0},p(d,_){if(3&_){let x;for(i=VF(d[1]),x=0;x<i.length;x+=1){const E=jF(d,i,x);s[x]?(s[x].p(E,_),Gr(s[x],1)):(s[x]=$F(E),s[x].c(),Gr(s[x],1),s[x].m(t.parentNode,t))}for(Xm(),x=i.length;x<s.length;x+=1)c(x);Km()}},i(d){if(!n){for(let _=0;_<i.length;_+=1)Gr(s[_]);n=!0}},o(d){s=s.filter(Boolean);for(let _=0;_<s.length;_+=1)Cs(s[_]);n=!1},d(d){d&&cu(t),function XQ(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}(s,d)}}}function $F(e){let t,n;return t=new hJ({props:{config:e[2],step:e[0]}}),{c(){Qm(t.$$.fragment)},m(i,s){vp(t,i,s),n=!0},p(i,s){const c={};2&s&&(c.config=i[2]),1&s&&(c.step=i[0]),t.$set(c)},i(i){n||(Gr(t.$$.fragment,i),n=!0)},o(i){Cs(t.$$.fragment,i),n=!1},d(i){bp(t,i)}}}function dJ(e){let t,n,i=e[1]&&UF(e);return{c(){t=od("footer"),i&&i.c(),po(t,"class","shepherd-footer")},m(s,c){hh(s,t,c),i&&i.m(t,null),n=!0},p(s,[c]){s[1]?i?(i.p(s,c),2&c&&Gr(i,1)):(i=UF(s),i.c(),Gr(i,1),i.m(t,null)):i&&(Xm(),Cs(i,1,1,()=>{i=null}),Km())},i(s){n||(Gr(i),n=!0)},o(s){Cs(i),n=!1},d(s){s&&cu(t),i&&i.d()}}}function fJ(e,t,n){let i,{step:s}=t;return e.$$set=c=>{"step"in c&&n(0,s=c.step)},e.$$.update=()=>{1&e.$$.dirty&&n(1,i=s.options.buttons)},[s,i]}class pJ extends tf{constructor(t){super(),ef(this,t,fJ,dJ,Jd,{step:0})}}function mJ(e){let t,n,i,s,c;return{c(){t=od("button"),n=od("span"),n.textContent="\xd7",po(n,"aria-hidden","true"),po(t,"aria-label",i=e[0].label?e[0].label:"Close Tour"),po(t,"class","shepherd-cancel-icon"),po(t,"type","button")},m(d,_){hh(d,t,_),X_(t,n),s||(c=Iw(t,"click",e[1]),s=!0)},p(d,[_]){1&_&&i!==(i=d[0].label?d[0].label:"Close Tour")&&po(t,"aria-label",i)},i:kc,o:kc,d(d){d&&cu(t),s=!1,c()}}}function gJ(e,t,n){let{cancelIcon:i,step:s}=t;return e.$$set=d=>{"cancelIcon"in d&&n(0,i=d.cancelIcon),"step"in d&&n(2,s=d.step)},[i,d=>{d.preventDefault(),s.cancel()},s]}class _J extends tf{constructor(t){super(),ef(this,t,gJ,mJ,Jd,{cancelIcon:0,step:2})}}function yJ(e){let t;return{c(){t=od("h3"),po(t,"id",e[1]),po(t,"class","shepherd-title")},m(n,i){hh(n,t,i),e[3](t)},p(n,[i]){2&i&&po(t,"id",n[1])},i:kc,o:kc,d(n){n&&cu(t),e[3](null)}}}function vJ(e,t,n){let{labelId:i,element:s,title:c}=t;return RE(()=>{gp(c)&&n(2,c=c()),n(0,s.innerHTML=c,s)}),e.$$set=_=>{"labelId"in _&&n(1,i=_.labelId),"element"in _&&n(0,s=_.element),"title"in _&&n(2,c=_.title)},[s,i,c,function d(_){J_[_?"unshift":"push"](()=>{s=_,n(0,s)})}]}class bJ extends tf{constructor(t){super(),ef(this,t,vJ,yJ,Jd,{labelId:1,element:0,title:2})}}function GF(e){let t,n;return t=new bJ({props:{labelId:e[0],title:e[2]}}),{c(){Qm(t.$$.fragment)},m(i,s){vp(t,i,s),n=!0},p(i,s){const c={};1&s&&(c.labelId=i[0]),4&s&&(c.title=i[2]),t.$set(c)},i(i){n||(Gr(t.$$.fragment,i),n=!0)},o(i){Cs(t.$$.fragment,i),n=!1},d(i){bp(t,i)}}}function HF(e){let t,n;return t=new _J({props:{cancelIcon:e[3],step:e[1]}}),{c(){Qm(t.$$.fragment)},m(i,s){vp(t,i,s),n=!0},p(i,s){const c={};8&s&&(c.cancelIcon=i[3]),2&s&&(c.step=i[1]),t.$set(c)},i(i){n||(Gr(t.$$.fragment,i),n=!0)},o(i){Cs(t.$$.fragment,i),n=!1},d(i){bp(t,i)}}}function xJ(e){let t,n,i,s=e[2]&&GF(e),c=e[3]&&e[3].enabled&&HF(e);return{c(){t=od("header"),s&&s.c(),n=Sw(),c&&c.c(),po(t,"class","shepherd-header")},m(d,_){hh(d,t,_),s&&s.m(t,null),X_(t,n),c&&c.m(t,null),i=!0},p(d,[_]){d[2]?s?(s.p(d,_),4&_&&Gr(s,1)):(s=GF(d),s.c(),Gr(s,1),s.m(t,n)):s&&(Xm(),Cs(s,1,1,()=>{s=null}),Km()),d[3]&&d[3].enabled?c?(c.p(d,_),8&_&&Gr(c,1)):(c=HF(d),c.c(),Gr(c,1),c.m(t,null)):c&&(Xm(),Cs(c,1,1,()=>{c=null}),Km())},i(d){i||(Gr(s),Gr(c),i=!0)},o(d){Cs(s),Cs(c),i=!1},d(d){d&&cu(t),s&&s.d(),c&&c.d()}}}function wJ(e,t,n){let c,d,{labelId:i,step:s}=t;return e.$$set=_=>{"labelId"in _&&n(0,i=_.labelId),"step"in _&&n(1,s=_.step)},e.$$.update=()=>{2&e.$$.dirty&&(n(2,c=s.options.title),n(3,d=s.options.cancelIcon))},[i,s,c,d]}class CJ extends tf{constructor(t){super(),ef(this,t,wJ,xJ,Jd,{labelId:0,step:1})}}function TJ(e){let t;return{c(){t=od("div"),po(t,"class","shepherd-text"),po(t,"id",e[1])},m(n,i){hh(n,t,i),e[3](t)},p(n,[i]){2&i&&po(t,"id",n[1])},i:kc,o:kc,d(n){n&&cu(t),e[3](null)}}}function DJ(e,t,n){let{descriptionId:i,element:s,step:c}=t;return RE(()=>{let{text:_}=c.options;gp(_)&&(_=_.call(c)),H_(_)?s.appendChild(_):n(0,s.innerHTML=_,s)}),e.$$set=_=>{"descriptionId"in _&&n(1,i=_.descriptionId),"element"in _&&n(0,s=_.element),"step"in _&&n(2,c=_.step)},[s,i,c,function d(_){J_[_?"unshift":"push"](()=>{s=_,n(0,s)})}]}class MJ extends tf{constructor(t){super(),ef(this,t,DJ,TJ,Jd,{descriptionId:1,element:0,step:2})}}function ZF(e){let t,n;return t=new CJ({props:{labelId:e[1],step:e[2]}}),{c(){Qm(t.$$.fragment)},m(i,s){vp(t,i,s),n=!0},p(i,s){const c={};2&s&&(c.labelId=i[1]),4&s&&(c.step=i[2]),t.$set(c)},i(i){n||(Gr(t.$$.fragment,i),n=!0)},o(i){Cs(t.$$.fragment,i),n=!1},d(i){bp(t,i)}}}function qF(e){let t,n;return t=new MJ({props:{descriptionId:e[0],step:e[2]}}),{c(){Qm(t.$$.fragment)},m(i,s){vp(t,i,s),n=!0},p(i,s){const c={};1&s&&(c.descriptionId=i[0]),4&s&&(c.step=i[2]),t.$set(c)},i(i){n||(Gr(t.$$.fragment,i),n=!0)},o(i){Cs(t.$$.fragment,i),n=!1},d(i){bp(t,i)}}}function WF(e){let t,n;return t=new pJ({props:{step:e[2]}}),{c(){Qm(t.$$.fragment)},m(i,s){vp(t,i,s),n=!0},p(i,s){const c={};4&s&&(c.step=i[2]),t.$set(c)},i(i){n||(Gr(t.$$.fragment,i),n=!0)},o(i){Cs(t.$$.fragment,i),n=!1},d(i){bp(t,i)}}}function EJ(e){let t,i,c,_,n=!Ka(e[2].options.title)||e[2].options.cancelIcon&&e[2].options.cancelIcon.enabled,s=!Ka(e[2].options.text),d=Array.isArray(e[2].options.buttons)&&e[2].options.buttons.length,x=n&&ZF(e),E=s&&qF(e),R=d&&WF(e);return{c(){t=od("div"),x&&x.c(),i=Sw(),E&&E.c(),c=Sw(),R&&R.c(),po(t,"class","shepherd-content")},m(z,V){hh(z,t,V),x&&x.m(t,null),X_(t,i),E&&E.m(t,null),X_(t,c),R&&R.m(t,null),_=!0},p(z,[V]){4&V&&(n=!Ka(z[2].options.title)||z[2].options.cancelIcon&&z[2].options.cancelIcon.enabled),n?x?(x.p(z,V),4&V&&Gr(x,1)):(x=ZF(z),x.c(),Gr(x,1),x.m(t,i)):x&&(Xm(),Cs(x,1,1,()=>{x=null}),Km()),4&V&&(s=!Ka(z[2].options.text)),s?E?(E.p(z,V),4&V&&Gr(E,1)):(E=qF(z),E.c(),Gr(E,1),E.m(t,c)):E&&(Xm(),Cs(E,1,1,()=>{E=null}),Km()),4&V&&(d=Array.isArray(z[2].options.buttons)&&z[2].options.buttons.length),d?R?(R.p(z,V),4&V&&Gr(R,1)):(R=WF(z),R.c(),Gr(R,1),R.m(t,null)):R&&(Xm(),Cs(R,1,1,()=>{R=null}),Km())},i(z){_||(Gr(x),Gr(E),Gr(R),_=!0)},o(z){Cs(x),Cs(E),Cs(R),_=!1},d(z){z&&cu(t),x&&x.d(),E&&E.d(),R&&R.d()}}}function SJ(e,t,n){let{descriptionId:i,labelId:s,step:c}=t;return e.$$set=d=>{"descriptionId"in d&&n(0,i=d.descriptionId),"labelId"in d&&n(1,s=d.labelId),"step"in d&&n(2,c=d.step)},[i,s,c]}class IJ extends tf{constructor(t){super(),ef(this,t,SJ,EJ,Jd,{descriptionId:0,labelId:1,step:2})}}function YF(e){let t;return{c(){t=od("div"),po(t,"class","shepherd-arrow"),po(t,"data-popper-arrow","")},m(n,i){hh(n,t,i)},d(n){n&&cu(t)}}}function PJ(e){let t,n,i,s,c,d,_,x,E=e[4].options.arrow&&e[4].options.attachTo&&e[4].options.attachTo.element&&e[4].options.attachTo.on&&YF();i=new IJ({props:{descriptionId:e[2],labelId:e[3],step:e[4]}});let R=[{"aria-describedby":s=Ka(e[4].options.text)?null:e[2]},{"aria-labelledby":c=e[4].options.title?e[3]:null},e[1],{open:"true"}],z={};for(let V=0;V<R.length;V+=1)z=WQ(z,R[V]);return{c(){t=od("dialog"),E&&E.c(),n=Sw(),Qm(i.$$.fragment),NF(t,z),K_(t,"shepherd-has-cancel-icon",e[5]),K_(t,"shepherd-has-title",e[6]),K_(t,"shepherd-element",!0)},m(V,j){hh(V,t,j),E&&E.m(t,null),X_(t,n),vp(i,t,null),e[18](t),d=!0,_||(x=Iw(t,"keydown",e[7]),_=!0)},p(V,[j]){V[4].options.arrow&&V[4].options.attachTo&&V[4].options.attachTo.element&&V[4].options.attachTo.on?E||(E=YF(),E.c(),E.m(t,n)):E&&(E.d(1),E=null);const J={};4&j&&(J.descriptionId=V[2]),8&j&&(J.labelId=V[3]),16&j&&(J.step=V[4]),i.$set(J),NF(t,z=function sJ(e,t){const n={},i={},s={$$scope:1};let c=e.length;for(;c--;){const d=e[c],_=t[c];if(_){for(const x in d)x in _||(i[x]=1);for(const x in _)s[x]||(n[x]=_[x],s[x]=1);e[c]=_}else for(const x in d)s[x]=1}for(const d in i)d in n||(n[d]=void 0);return n}(R,[(!d||20&j&&s!==(s=Ka(V[4].options.text)?null:V[2]))&&{"aria-describedby":s},(!d||24&j&&c!==(c=V[4].options.title?V[3]:null))&&{"aria-labelledby":c},2&j&&V[1],{open:"true"}])),K_(t,"shepherd-has-cancel-icon",V[5]),K_(t,"shepherd-has-title",V[6]),K_(t,"shepherd-element",!0)},i(V){d||(Gr(i.$$.fragment,V),d=!0)},o(V){Cs(i.$$.fragment,V),d=!1},d(V){V&&cu(t),E&&E.d(),bp(i),e[18](null),_=!1,x()}}}function XF(e){return e.split(" ").filter(t=>!!t.length)}function OJ(e,t,n){let de,ae,ze,{attachToElement:i,attachTofocusableDialogElements:s,classPrefix:c,element:d,descriptionId:_,focusableAttachToElements:x,firstFocusableAttachToElement:E,lastFocusableAttachToElement:R,firstFocusableDialogElement:z,focusableDialogElements:V,lastFocusableDialogElement:j,labelId:J,step:se,dataStepId:le}=t;(function eJ(e){kE().$$.on_mount.push(e)})(()=>{n(1,le={[`data-${c}shepherd-step-id`]:se.id}),n(13,V=[...d.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]')]),n(12,z=V[0]),n(14,j=V[V.length-1]);const At=se._getResolvedAttachToOptions();null!=At&&At.element&&(n(8,i=At.element),n(8,i.tabIndex=0,i),n(9,x=[i,...i.querySelectorAll('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex="0"]')]),n(10,E=x[0]),n(11,R=x[x.length-1]),i.addEventListener("keydown",fn))}),function tJ(e){kE().$$.on_destroy.push(e)}(()=>{var At;null==(At=i)||At.removeEventListener("keydown",fn)}),RE(()=>{ze!==se.options.classes&&function ut(){(function Nt(At){if(O0(At)){const xn=XF(At);xn.length&&d.classList.remove(...xn)}})(ze),ze=se.options.classes,function en(At){if(O0(At)){const xn=XF(At);xn.length&&d.classList.add(...xn)}}(ze)}()});const fn=At=>{const{tour:xn}=se;switch(At.keyCode){case 9:if((!x||0===x.length)&&0===V.length){At.preventDefault();break}if(At.shiftKey)if(document.activeElement===z||document.activeElement.classList.contains("shepherd-element")){var Fn;At.preventDefault(),(null!=(Fn=R)?Fn:j).focus()}else document.activeElement===E&&(At.preventDefault(),j.focus());else if(document.activeElement===j){var un;At.preventDefault(),(null!=(un=E)?un:z).focus()}else document.activeElement===R&&(At.preventDefault(),z.focus());break;case 27:xn.options.exitOnEsc&&(At.preventDefault(),At.stopPropagation(),se.cancel());break;case 37:xn.options.keyboardNavigation&&(At.preventDefault(),At.stopPropagation(),xn.back());break;case 39:xn.options.keyboardNavigation&&(At.preventDefault(),At.stopPropagation(),xn.next())}};return e.$$set=At=>{"attachToElement"in At&&n(8,i=At.attachToElement),"attachTofocusableDialogElements"in At&&n(15,s=At.attachTofocusableDialogElements),"classPrefix"in At&&n(16,c=At.classPrefix),"element"in At&&n(0,d=At.element),"descriptionId"in At&&n(2,_=At.descriptionId),"focusableAttachToElements"in At&&n(9,x=At.focusableAttachToElements),"firstFocusableAttachToElement"in At&&n(10,E=At.firstFocusableAttachToElement),"lastFocusableAttachToElement"in At&&n(11,R=At.lastFocusableAttachToElement),"firstFocusableDialogElement"in At&&n(12,z=At.firstFocusableDialogElement),"focusableDialogElements"in At&&n(13,V=At.focusableDialogElements),"lastFocusableDialogElement"in At&&n(14,j=At.lastFocusableDialogElement),"labelId"in At&&n(3,J=At.labelId),"step"in At&&n(4,se=At.step),"dataStepId"in At&&n(1,le=At.dataStepId)},e.$$.update=()=>{16&e.$$.dirty&&(n(5,de=se.options&&se.options.cancelIcon&&se.options.cancelIcon.enabled),n(6,ae=se.options&&se.options.title))},[d,le,_,J,se,de,ae,fn,i,x,E,R,z,V,j,s,c,()=>d,function Gn(At){J_[At?"unshift":"push"](()=>{d=At,n(0,d)})}]}class FJ extends tf{constructor(t){super(),ef(this,t,OJ,PJ,Jd,{attachToElement:8,attachTofocusableDialogElements:15,classPrefix:16,element:0,descriptionId:2,focusableAttachToElements:9,firstFocusableAttachToElement:10,lastFocusableAttachToElement:11,firstFocusableDialogElement:12,focusableDialogElements:13,lastFocusableDialogElement:14,labelId:3,step:4,dataStepId:1,getElement:17})}get getElement(){return this.$$.ctx[17]}}class NE extends pE{constructor(t,n={}){return super(),this._resolvedAttachTo=void 0,this._resolvedExtraHighlightElements=void 0,this.classPrefix=void 0,this.el=void 0,this.target=void 0,this.tour=void 0,this.tour=t,this.classPrefix=this.tour.options?pF(this.tour.options.classPrefix):"",this.styles=t.styles,this._resolvedAttachTo=null,yE(this),this._setOptions(n),this}cancel(){this.tour.cancel(),this.trigger("cancel")}complete(){this.tour.complete(),this.trigger("complete")}destroy(){(function UQ(e){e.cleanup&&e.cleanup(),e.cleanup=null})(this),H_(this.el)&&(this.el.remove(),this.el=null),this._updateStepTargetOnHide(),this.trigger("destroy")}getTour(){return this.tour}hide(){var t;null==(t=this.tour.modal)||t.hide(),this.trigger("before-hide"),this.el&&(this.el.hidden=!0),this._updateStepTargetOnHide(),this.trigger("hide")}_resolveExtraHiglightElements(){return this._resolvedExtraHighlightElements=function QK(e){return e.options.extraHighlights?e.options.extraHighlights.flatMap(t=>Array.from(document.querySelectorAll(t))):[]}(this),this._resolvedExtraHighlightElements}_resolveAttachToOptions(){return this._resolvedAttachTo=function KK(e){const t=e.options.attachTo||{},n=Object.assign({},t);if(gp(n.element)&&(n.element=n.element.call(e)),O0(n.element)){try{n.element=document.querySelector(n.element)}catch{}n.element||console.error(`The element for this Shepherd step was not found ${t.element}`)}return n}(this),this._resolvedAttachTo}_getResolvedAttachToOptions(){return null===this._resolvedAttachTo?this._resolveAttachToOptions():this._resolvedAttachTo}isOpen(){return!(!this.el||this.el.hidden)}show(){return gp(this.options.beforeShowPromise)?Promise.resolve(this.options.beforeShowPromise()).then(()=>this._show()):Promise.resolve(this._show())}updateStepOptions(t){Object.assign(this.options,t),this.shepherdElementComponent&&this.shepherdElementComponent.$set({step:this})}getElement(){return this.el}getTarget(){return this.target}_createTooltipContent(){return this.shepherdElementComponent=new FJ({target:this.tour.options.stepsContainer||document.body,props:{classPrefix:this.classPrefix,descriptionId:`${this.id}-description`,labelId:`${this.id}-label`,step:this,styles:this.styles}}),this.shepherdElementComponent.getElement()}_scrollTo(t){const{element:n}=this._getResolvedAttachToOptions();gp(this.options.scrollToHandler)?this.options.scrollToHandler(n):function IK(e){return e instanceof Element}(n)&&"function"==typeof n.scrollIntoView&&n.scrollIntoView(t)}_getClassOptions(t){const n=this.tour&&this.tour.options&&this.tour.options.defaultStepOptions,s=n&&n.classes?n.classes:"",c=[...(t.classes?t.classes:"").split(" "),...s.split(" ")],d=new Set(c);return Array.from(d).join(" ").trim()}_setOptions(t={}){let n=this.tour&&this.tour.options&&this.tour.options.defaultStepOptions;n=gE({},n||{}),this.options=Object.assign({arrow:!0},n,t,function jQ(e,t){return{floatingUIOptions:gE(e.floatingUIOptions||{},t.floatingUIOptions||{})}}(n,t));const{when:i}=this.options;this.options.classes=this._getClassOptions(t),this.destroy(),this.id=this.options.id||`step-${gF()}`,i&&Object.keys(i).forEach(s=>{this.on(s,i[s],this)})}_setupElements(){Ka(this.el)||this.destroy(),this.el=this._createTooltipContent(),this.options.advanceOn&&function WK(e){const{event:t,selector:n}=e.options.advanceOn||{};if(!t)return console.error("advanceOn was defined, but no event name was passed.");{const i=function qK(e,t){return n=>{if(e.isOpen()){const i=e.el&&n.currentTarget===e.el;(!Ka(t)&&n.currentTarget.matches(t)||i)&&e.tour.next()}}}(e,n);let s=null;if(!Ka(n)&&(s=document.querySelector(n),!s))return console.error(`No element was found for the selector supplied to advanceOn: ${n}`);s?(s.addEventListener(t,i),e.on("destroy",()=>s.removeEventListener(t,i))):(document.body.addEventListener(t,i,!0),e.on("destroy",()=>document.body.removeEventListener(t,i,!0)))}}(this),VQ(this)}_show(){var t;this.trigger("before-show"),this._resolveAttachToOptions(),this._resolveExtraHiglightElements(),this._setupElements(),this.tour.modal||this.tour.setupModal(),null==(t=this.tour.modal)||t.setupForStep(this),this._styleTargetElementForStep(this),this.el&&(this.el.hidden=!1),this.options.scrollTo&&setTimeout(()=>{this._scrollTo(this.options.scrollTo)}),this.el&&(this.el.hidden=!1);const n=this.shepherdElementComponent.getElement(),i=this.target||document.body,s=this._resolvedExtraHighlightElements;i.classList.add(`${this.classPrefix}shepherd-enabled`),i.classList.add(`${this.classPrefix}shepherd-target`),n.classList.add("shepherd-enabled"),s?.forEach(c=>{c.classList.add(`${this.classPrefix}shepherd-enabled`),c.classList.add(`${this.classPrefix}shepherd-target`)}),this.trigger("show")}_styleTargetElementForStep(t){const n=t.target,i=t._resolvedExtraHighlightElements;if(!n)return;const s=t.options.highlightClass;s&&(n.classList.add(s),i?.forEach(c=>c.classList.add(s))),n.classList.remove("shepherd-target-click-disabled"),i?.forEach(c=>c.classList.remove("shepherd-target-click-disabled")),!1===t.options.canClickTarget&&(n.classList.add("shepherd-target-click-disabled"),i?.forEach(c=>c.classList.add("shepherd-target-click-disabled")))}_updateStepTargetOnHide(){const t=this.target||document.body,n=this._resolvedExtraHighlightElements,i=this.options.highlightClass;i&&(t.classList.remove(i),n?.forEach(s=>s.classList.remove(i))),t.classList.remove("shepherd-target-click-disabled",`${this.classPrefix}shepherd-enabled`,`${this.classPrefix}shepherd-target`),n?.forEach(s=>{s.classList.remove("shepherd-target-click-disabled",`${this.classPrefix}shepherd-enabled`,`${this.classPrefix}shepherd-target`)})}}function BJ(e){let t,n,i,s,c;return{c(){t=OF("svg"),n=OF("path"),po(n,"d",e[2]),po(t,"class",i=(e[1]?"shepherd-modal-is-visible":"")+" shepherd-modal-overlay-container")},m(d,_){hh(d,t,_),X_(t,n),e[11](t),s||(c=Iw(t,"touchmove",e[3]),s=!0)},p(d,[_]){4&_&&po(n,"d",d[2]),2&_&&i!==(i=(d[1]?"shepherd-modal-is-visible":"")+" shepherd-modal-overlay-container")&&po(t,"class",i)},i:kc,o:kc,d(d){d&&cu(t),e[11](null),s=!1,c()}}}function KF(e){if(!e)return null;const n=e instanceof HTMLElement&&window.getComputedStyle(e).overflowY;return"hidden"!==n&&"visible"!==n&&e.scrollHeight>=e.clientHeight?e:KF(e.parentElement)}function jJ(e,t){const n=e.getBoundingClientRect();let i=n.y||n.top,s=n.bottom||i+n.height;if(t){const d=t.getBoundingClientRect(),_=d.y||d.top,x=d.bottom||_+d.height;i=Math.max(i,_),s=Math.min(s,x)}return{y:i,height:Math.max(s-i,0)}}function UJ(e,t,n){let d,_,{element:i,openingProperties:s}=t,c=!1;function E(){n(4,s=[{width:0,height:0,x:0,y:0,r:0}])}function R(){n(1,c=!1),de()}function z(Se=0,ut=0,Nt=0,en=0,fn,Gn,At){if(Gn){const xn=[Gn,...At||[]];n(4,s=[]);for(const Fn of xn){if(!Fn||xn.indexOf(Fn)!==xn.lastIndexOf(Fn))continue;const{y:un,height:tt}=jJ(Fn,fn),{x:_n,width:zt,left:cn}=Fn.getBoundingClientRect();xn.some(Rn=>{if(Rn===Fn)return!1;const En=Rn.getBoundingClientRect();return _n>=En.left&&_n+zt<=En.right&&un>=En.top&&un+tt<=En.bottom})||s.push({width:zt+2*Se,height:tt+2*Se,x:(_n||cn)+Nt-Se,y:un+en-Se,r:ut})}}else E()}function j(){n(1,c=!0)}E();const J=Se=>{Se.preventDefault()};function de(){d&&(cancelAnimationFrame(d),d=void 0),window.removeEventListener("touchmove",J,{passive:!1})}return e.$$set=Se=>{"element"in Se&&n(0,i=Se.element),"openingProperties"in Se&&n(4,s=Se.openingProperties)},e.$$.update=()=>{16&e.$$.dirty&&n(2,_=function zJ(e){let t="";const{innerWidth:n,innerHeight:i}=window;return e.forEach(s=>{const{width:c,height:d,x:_=0,y:x=0,r:E=0}=s,{topLeft:R=0,topRight:z=0,bottomRight:V=0,bottomLeft:j=0}="number"==typeof E?{topLeft:E,topRight:E,bottomRight:E,bottomLeft:E}:E;t+=`M${_+R},${x}      a${R},${R},0,0,0-${R},${R}      V${d+x-j}      a${j},${j},0,0,0,${j},${j}      H${c+_-V}      a${V},${V},0,0,0,${V}-${V}      V${x+z}      a${z},${z},0,0,0-${z}-${z}      Z`}),`M${n},${i}          H0          V0          H${n}          V${i}          Z          ${t}`.replace(/\s/g,"")}(s))},[i,c,_,Se=>{Se.stopPropagation()},s,()=>i,E,R,z,function V(Se){de(),Se.tour.options.useModalOverlay?(function ae(Se){const{modalOverlayOpeningPadding:ut,modalOverlayOpeningRadius:Nt,modalOverlayOpeningXOffset:en=0,modalOverlayOpeningYOffset:fn=0}=Se.options,Gn=function VJ(e){let t={top:0,left:0};if(!e)return t;let n=e.ownerDocument.defaultView;for(;n!==window.top;){var i;const d=null==(i=n)?void 0:i.frameElement;if(d){var s,c;const _=d.getBoundingClientRect();t.top+=_.top+(null!=(s=_.scrollTop)?s:0),t.left+=_.left+(null!=(c=_.scrollLeft)?c:0)}n=n.parent}return t}(Se.target),At=KF(Se.target),xn=()=>{d=void 0,z(ut,Nt,en+Gn.left,fn+Gn.top,At,Se.target,Se._resolvedExtraHighlightElements),d=requestAnimationFrame(xn)};xn(),function le(){window.addEventListener("touchmove",J,{passive:!1})}()}(Se),j()):R()},j,function ze(Se){J_[Se?"unshift":"push"](()=>{i=Se,n(0,i)})}]}class $J extends tf{constructor(t){super(),ef(this,t,UJ,BJ,Jd,{element:0,openingProperties:4,getElement:5,closeModalOpening:6,hide:7,positionModal:8,setupForStep:9,show:10})}get getElement(){return this.$$.ctx[5]}get closeModalOpening(){return this.$$.ctx[6]}get hide(){return this.$$.ctx[7]}get positionModal(){return this.$$.ctx[8]}get setupForStep(){return this.$$.ctx[9]}get show(){return this.$$.ctx[10]}}const Jm=new class GJ extends pE{constructor(){super(),this.activeTour=void 0,yE(this)}},QF=typeof window>"u";Jm.Step=QF?class YK{constructor(t){}}:NE,Jm.Tour=QF?class XK{constructor(t,n){}}:class HJ extends pE{constructor(t={}){return super(),this.trackedEvents=["active","cancel","complete","show"],this.classPrefix=void 0,this.currentStep=void 0,this.focusedElBeforeOpen=void 0,this.id=void 0,this.modal=void 0,this.options=void 0,this.steps=void 0,yE(this),this.options=Object.assign({},{exitOnEsc:!0,keyboardNavigation:!0},t),this.classPrefix=pF(this.options.classPrefix),this.steps=[],this.addSteps(this.options.steps),["active","cancel","complete","inactive","show","start"].map(s=>{(c=>{this.on(c,d=>{(d=d||{}).tour=this,Jm.trigger(c,d)})})(s)}),this._setTourID(t.id),this}addStep(t,n){let i=t;return i instanceof NE?i.tour=this:i=new NE(this,i),Ka(n)?this.steps.push(i):this.steps.splice(n,0,i),i}addSteps(t){return Array.isArray(t)&&t.forEach(n=>{this.addStep(n)}),this}back(){const t=this.steps.indexOf(this.currentStep);this.show(t-1,!1)}cancel(){var t=this;return Pe(function*(){if(t.options.confirmCancel){const n=t.options.confirmCancelMessage||"Are you sure you want to stop the tour?";let i;i=gp(t.options.confirmCancel)?yield t.options.confirmCancel():window.confirm(n),i&&t._done("cancel")}else t._done("cancel")})()}complete(){this._done("complete")}getById(t){return this.steps.find(n=>n.id===t)}getCurrentStep(){return this.currentStep}hide(){const t=this.getCurrentStep();if(t)return t.hide()}isActive(){return Jm.activeTour===this}next(){const t=this.steps.indexOf(this.currentStep);t===this.steps.length-1?this.complete():this.show(t+1,!0)}removeStep(t){const n=this.getCurrentStep();this.steps.some((i,s)=>{if(i.id===t)return i.isOpen()&&i.hide(),i.destroy(),this.steps.splice(s,1),!0}),n&&n.id===t&&(this.currentStep=void 0,this.steps.length?this.show(0):this.cancel())}show(t=0,n=!0){const i=O0(t)?this.getById(t):this.steps[t];i&&(this._updateStateBeforeShow(),gp(i.options.showOn)&&!i.options.showOn()?this._skipStep(i,n):(this.currentStep=i,this.trigger("show",{step:i,previous:this.currentStep}),i.show()))}start(){var t=this;return Pe(function*(){t.trigger("start"),t.focusedElBeforeOpen=document.activeElement,t.currentStep=null,t.setupModal(),t._setupActiveTour(),t.next()})()}_done(t){const n=this.steps.indexOf(this.currentStep);if(Array.isArray(this.steps)&&this.steps.forEach(i=>i.destroy()),function NJ(e){if(e){const{steps:t}=e;t.forEach(n=>{n.options&&!1===n.options.canClickTarget&&n.options.attachTo&&(H_(n.target)&&n.target.classList.remove("shepherd-target-click-disabled"),n._resolvedExtraHighlightElements&&n._resolvedExtraHighlightElements.forEach(i=>{H_(i)&&i.classList.remove("shepherd-target-click-disabled")}))})}}(this),this.trigger(t,{index:n}),Jm.activeTour=null,this.trigger("inactive",{tour:this}),this.modal&&this.modal.hide(),("cancel"===t||"complete"===t)&&this.modal){const i=document.querySelector(".shepherd-modal-overlay-container");i&&(i.remove(),this.modal=null)}H_(this.focusedElBeforeOpen)&&this.focusedElBeforeOpen.focus()}_setupActiveTour(){this.trigger("active",{tour:this}),Jm.activeTour=this}setupModal(){this.modal=new $J({target:this.options.modalContainer||document.body,props:{styles:this.styles}})}_skipStep(t,n){const i=this.steps.indexOf(t);i===this.steps.length-1?this.complete():this.show(n?i+1:i-1,n)}_updateStateBeforeShow(){this.currentStep&&this.currentStep.hide(),this.isActive()||this._setupActiveTour()}_setTourID(t){const n=this.options.tourName||"tour",i=t||gF();this.id=`${n}--${i}`}};let ZJ=(()=>{class e{tour=null;STORAGE_KEY="hasSeenDenominationQuizTutorial";constructor(){}hasSeenTutorial(){return"true"===localStorage.getItem(this.STORAGE_KEY)}markTutorialAsSeen(){localStorage.setItem(this.STORAGE_KEY,"true")}resetTutorial(){localStorage.removeItem(this.STORAGE_KEY)}startTutorial(){this.tour&&this.tour.cancel(),this.tour=new Jm.Tour({useModalOverlay:!0,defaultStepOptions:{cancelIcon:{enabled:!0},classes:"shepherd-theme-custom",scrollTo:{behavior:"smooth",block:"center"}}}),this.tour.addStep({id:"welcome",text:'\n        <h3 class="shepherd-title">Welcome to the Denomination Flow Chart!</h3>\n        <p>This interactive visualization helps you explore Christian denominations based on theological beliefs.</p>\n        <p>Let\'s take a quick tour of the features.</p>\n      ',buttons:[{text:"Skip",action:()=>{this.markTutorialAsSeen(),this.tour?.cancel()},classes:"shepherd-button-secondary"},{text:"Next",action:this.tour.next}]}),this.tour.addStep({id:"header",attachTo:{element:".drawer-card",on:"bottom"},text:'\n        <h3 class="shepherd-title">Header Panel</h3>\n        <p>This panel contains important controls:</p>\n        <ul>\n          <li><strong>Quiz Mode</strong>: Guided step-by-step questions</li>\n          <li><strong>Free Mode</strong>: Explore the entire tree freely</li>\n        </ul>\n        <p>You can collapse this panel using the arrow button.</p>\n      ',buttons:[{text:"Back",action:this.tour.back,classes:"shepherd-button-secondary"},{text:"Next",action:this.tour.next}]}),this.tour.addStep({id:"question-node",text:'\n        <h3 class="shepherd-title">Question Nodes</h3>\n        <p>The purple rectangles are theological questions. Click any visible question to read more details about what it means.</p>\n        <p>Each question represents a historic point of division in Christian tradition.</p>\n      ',buttons:[{text:"Back",action:this.tour.back,classes:"shepherd-button-secondary"},{text:"Next",action:this.tour.next}]}),this.tour.addStep({id:"answer-buttons",text:'\n        <h3 class="shepherd-title">Answering Questions (Quiz Mode)</h3>\n        <p>In <strong>Quiz Mode</strong>, you\'ll see colored buttons below each active question:</p>\n        <ul>\n          <li><strong>Blue button</strong>: "Yes" answer</li>\n          <li><strong>Purple button</strong>: "No" answer</li>\n        </ul>\n        <p>Click a button to answer and reveal the next question in your path.</p>\n      ',buttons:[{text:"Back",action:this.tour.back,classes:"shepherd-button-secondary"},{text:"Next",action:this.tour.next}]}),this.tour.addStep({id:"free-mode",attachTo:{element:".mode-toggle",on:"bottom"},text:'\n        <h3 class="shepherd-title">Free Mode Exploration</h3>\n        <p>Switch to <strong>Free Mode</strong> to see the entire decision tree at once.</p>\n        <p>In Free Mode:</p>\n        <ul>\n          <li>All nodes are visible</li>\n          <li>Answer labels appear on the connecting lines</li>\n          <li>You can explore any path freely</li>\n        </ul>\n      ',buttons:[{text:"Back",action:this.tour.back,classes:"shepherd-button-secondary"},{text:"Next",action:this.tour.next}]}),this.tour.addStep({id:"navigation",text:'\n        <h3 class="shepherd-title">Navigation Controls</h3>\n        <p>You can navigate the visualization using:</p>\n        <ul>\n          <li><strong>Scroll</strong> or <strong>pinch</strong> to zoom in/out</li>\n          <li><strong>Click and drag</strong> to pan around</li>\n          <li>The tree will auto-focus on active questions in Quiz Mode</li>\n        </ul>\n      ',buttons:[{text:"Back",action:this.tour.back,classes:"shepherd-button-secondary"},{text:"Next",action:this.tour.next}]}),this.tour.addStep({id:"results",text:'\n        <h3 class="shepherd-title">Denomination Results</h3>\n        <p>At the end of each path, you\'ll find denomination circles with icons.</p>\n        <p>Click any denomination to learn more about that Christian tradition.</p>\n        <p>The denomination name appears below the icon.</p>\n      ',buttons:[{text:"Back",action:this.tour.back,classes:"shepherd-button-secondary"},{text:"Finish",action:()=>{this.markTutorialAsSeen(),this.tour?.complete()}}]}),this.tour.start()}cancelTour(){this.tour&&(this.tour.cancel(),this.tour=null)}static \u0275fac=function(i){return new(i||e)};static \u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const qJ=["treeContainer"];function WJ(e,t){1&e&&(Be(0,"p",14),vt(1," Discover which Christian denomination aligns with your theological beliefs through a series of questions about Biblical authority, sacraments, and church governance. "),We())}function YJ(e,t){if(1&e){const n=yl();Be(0,"div",15)(1,"button",16),xi("click",function(){return q(n),te(ui().setMode("quiz"))}),vt(2," Guided Mode "),We(),Be(3,"button",16),xi("click",function(){return q(n),te(ui().setMode("free"))}),vt(4," Free Mode "),We(),Be(5,"button",17),xi("click",function(){return q(n),te(ui().reset())}),er(),Be(6,"svg",18),pn(7,"path",19),We(),vt(8," Reset "),We(),lr(),Be(9,"button",20),xi("click",function(){return q(n),te(ui().startTutorial())}),er(),Be(10,"svg",18),pn(11,"path",21),We(),vt(12," Help "),We()()}if(2&e){const n=ui();Xt(),Tr("active","quiz"===n.mode),Xt(2),Tr("active","free"===n.mode)}}function XJ(e,t){1&e&&(Be(0,"div",22)(1,"span",23),vt(2,"Based on content by Redeemed Zoomer"),We(),Be(3,"a",24),er(),Be(4,"svg",25),pn(5,"path",26),We()()())}function KJ(e,t){if(1&e&&(Be(0,"div",37),pn(1,"img",38),We()),2&e){const n=ui(2);Xt(),Mi("src",n.currentResultIcon,zo)("alt",n.currentResultDenomination)}}function QJ(e,t){if(1&e&&(Be(0,"h3",39),vt(1),We()),2&e){const n=ui(2);Xt(),wo(n.currentResultDenomination)}}function JJ(e,t){if(1&e){const n=yl();Be(0,"div",27,1)(2,"div",28)(3,"div",29)(4,"div",30),ws(5,KJ,2,2,"div",31)(6,QJ,2,1,"h3",32),We(),Be(7,"button",33),xi("click",function(){return q(n),te(ui().closeResult())}),er(),Be(8,"svg",34),pn(9,"path",35),We()()(),lr(),pn(10,"p",36),We()()}if(2&e){const n=ui();Xt(5),Mi("ngIf",n.currentResultIcon),Xt(),Mi("ngIf",n.currentResultDenomination),Xt(4),Mi("innerHTML",n.formattedResult,zs)}}let eee=(()=>{class e{renderer;sanitizer;tooltipService;tutorialService;treeContainer;width=0;height=0;svg;g;zoom;currentLevel=0;resizeListener=null;nodePositions=new Map;visitHistory=["root","bible-authority"];mode="quiz";_currentResult=null;currentResultIcon=null;currentResultDenomination=null;headerExpanded=!0;selectedNodeId=null;formattedResult="";get currentResult(){return this._currentResult}set currentResult(n){this._currentResult!==n&&(this._currentResult=n,this.formattedResult=this.formatResult(n))}hideTooltipTimeout=null;get isMobile(){return this.width<960}get isSmallMobile(){return this.width<600}get scaleFactor(){return this.isSmallMobile?.7:this.isMobile?.85:1}treeData={id:"root",question:"Loading...",children:[]};visibleNodes=new Set(["root","bible-authority"]);constructor(n,i,s,c){this.renderer=n,this.sanitizer=i,this.tooltipService=s,this.tutorialService=c}ngOnInit(){this.loadTreeData()}onMouseOver(n){const i=n.target;i&&i.classList.contains("tooltip-term")&&(this.hideTooltipTimeout&&(clearTimeout(this.hideTooltipTimeout),this.hideTooltipTimeout=null),this.tooltipService.show(i,{content:i.getAttribute("data-tooltip")||"",theme:"dark",className:"custom-tooltip"}))}onMouseOut(n){const i=n.target;i&&i.classList.contains("tooltip-term")&&(this.hideTooltipTimeout=setTimeout(()=>{this.tooltipService.hide()},50))}tooltips={Filioque:'Latin phrase meaning "and the Son", added to the Nicene Creed by the Western church, stating that the Holy Spirit proceeds from both the Father and the Son',"Sola Scriptura":'Latin phrase meaning "Scripture alone", the Protestant doctrine that the Bible is the sole infallible authority for faith and practice',Magisterium:"The teaching authority of the Catholic Church, exercised by the Pope and bishops in communion with him",miaphysitism:"The Christological doctrine that Christ has one united nature (divine and human together), held by Oriental Orthodox churches",dyophysitism:"The Christological doctrine that Christ has two distinct natures (divine and human) united in one person, affirmed at Chalcedon",theosis:"The Orthodox doctrine of becoming partakers of the divine nature through union with Christ, also called deification","apostolic succession":"The unbroken line of bishops tracing back to the apostles, believed to preserve authentic church authority and sacramental validity","ex cathedra":'Latin phrase meaning "from the chair", referring to the Pope\'s most solemn and authoritative pronouncements',"papal infallibility":"The Catholic doctrine that the Pope cannot err when officially defining doctrine on faith or morals","icon veneration":"The practice of showing reverence to sacred images, distinguished from worship which is due to God alone",TULIP:"Acronym for the five points of Calvinism: Total depravity, Unconditional election, Limited atonement, Irresistible grace, Perseverance of the saints","covenant theology":"Reformed theological framework viewing God's relationship with humanity through successive covenants","regulative principle":"The Reformed principle that worship should include only what God has commanded in Scripture","prevenient grace":"The Wesleyan/Arminian doctrine of God's grace that precedes and enables human response to the Gospel","entire sanctification":"The Wesleyan doctrine of complete cleansing from sin and full consecration to God, possible in this life","baptismal regeneration":"The doctrine that baptism effects spiritual rebirth and washing away of sin","Real Presence":"The doctrine that Christ is truly present in the Eucharist, understood differently by various traditions",transubstantiation:"The Catholic doctrine that the bread and wine become the actual body and blood of Christ while retaining the appearance of bread and wine",consubstantiation:'The Lutheran view that Christ\'s body and blood are present "in, with, and under" the bread and wine',"memorial view":"The belief that the Lord's Supper is primarily a symbolic remembrance of Christ's sacrifice",cessationism:"The doctrine that miraculous spiritual gifts like prophecy and tongues ceased with the apostolic age",continuationism:"The belief that all spiritual gifts, including miraculous ones, continue to be active in the church today","believer's baptism":"The practice of baptizing only those who personally profess faith in Christ, typically associated with Baptist and Anabaptist traditions","infant baptism":"The practice of baptizing children of believers, based on covenant theology or sacramental regeneration","episcopal polity":"Church government by bishops in hierarchical succession","presbyterian polity":"Church government by elders (presbyters) in representative assemblies","congregational polity":"Church government where each local congregation is self-governing and autonomous"};formatResult(n){if(!n)return"";console.log("Formatting result:",n);let i=n;return Object.entries(this.tooltips).forEach(([s,c])=>{const d=new RegExp(`\\b${s}\\b`,"gi");i=i.replace(d,_=>(console.log(`Found and replacing: ${_}`),`<span class="tooltip-term" data-tooltip="${c.replace(/"/g,"&quot;")}">${_}</span>`))}),console.log("Formatted HTML:",i),this.sanitizer.bypassSecurityTrustHtml(i)}loadTreeData(){var n=this;return Pe(function*(){try{const i=yield fetch("./tree-data.json");n.treeData=yield i.json(),n.visibleNodes=new Set(["root",n.treeData.children?.[0]?.id||"bible-authority"]),n.visitHistory=["root",n.treeData.children?.[0]?.id||"bible-authority"],n.createTree(),setTimeout(()=>{n.tutorialService.hasSeenTutorial()||n.tutorialService.startTutorial()},500)}catch(i){console.error("Failed to load tree data:",i)}})()}ngAfterViewInit(){this.setDimensions(),this.resizeListener=()=>{this.setDimensions(),this.updateTree()},window.addEventListener("resize",this.resizeListener)}ngOnDestroy(){this.resizeListener&&window.removeEventListener("resize",this.resizeListener),this.tutorialService.cancelTour()}setDimensions(){const n=this.treeContainer.nativeElement;this.width=n.clientWidth,this.height=n.clientHeight,console.log("Container dimensions:",this.width,"x",this.height,"Device pixel ratio:",window.devicePixelRatio)}makeSpecificChildVisible(n,i){this.visibleNodes.add(n),this.visitHistory[this.visitHistory.length-1]!==n&&this.visitHistory.push(n);const s=this.findNodeById(this.treeData,n);s?.result&&(this.currentResult=s.result,this.currentResultIcon=s.icon||null,this.currentResultDenomination=s.denomination||null),i&&this.animateFuseEffect(i,n),this.updateTreeStructure(),setTimeout(()=>this.panToNode(n),100)}setMode(n){this.mode=n,"free"===n?this.showAllNodes():this.resetQuiz(),this.updateLinkLabels()}toggleHeader(){this.headerExpanded=!this.headerExpanded}reset(){this.resetQuiz()}startTutorial(){this.tutorialService.startTutorial()}updateLinkLabels(){this.g&&this.g.selectAll(".link-label").style("display","free"===this.mode?"block":"none")}showAllNodes(){const n=i=>{this.visibleNodes.add(i.id),i.children&&i.children.forEach(s=>n(s))};n(this.treeData),this.updateTreeStructure()}resetQuiz(){this.visibleNodes=new Set(["root","bible-authority"]),this.visitHistory=["root","bible-authority"],this.currentLevel=0,this.currentResult=null,this.currentResultIcon=null,this.currentResultDenomination=null,this.selectedNodeId=null,this.clearAllFuseEffects(),this.updateTree(),this.panToNode("root")}clearAllFuseEffects(){this.g&&(this.g.selectAll(".fuse-effect").remove(),this.svg&&this.svg.selectAll('defs linearGradient[id^="fuseGradient"]').remove())}panToNode(n){if(!this.svg||!this.g)return;const i=this.setupTreeLayout(),c=this.createHierarchy(i).descendants().find(V=>V.data.id===n);if(!c)return;const z=yw.translate(this.width/2-1*c.x,this.height/2-1*c.y).scale(1);this.svg.transition().duration(750).call(this.zoom.transform,z)}enablePanZoom(){this.svg&&(this.zoom=function xK(){var R,z,V,e=gK,t=_K,n=bK,i=yK,s=vK,c=[0,1/0],d=[[-1/0,-1/0],[1/0,1/0]],_=250,x=fK,E=Y1("start","zoom","end"),se=0,le=10;function de(tt){tt.property("__zoom",cF).on("wheel.zoom",fn,{passive:!1}).on("mousedown.zoom",Gn).on("dblclick.zoom",At).filter(s).on("touchstart.zoom",xn).on("touchmove.zoom",Fn).on("touchend.zoom touchcancel.zoom",un).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function ae(tt,_n){return(_n=Math.max(c[0],Math.min(c[1],_n)))===tt.k?tt:new Xd(_n,tt.x,tt.y)}function ze(tt,_n,zt){var cn=_n[0]-zt[0]*tt.k,Yn=_n[1]-zt[1]*tt.k;return cn===tt.x&&Yn===tt.y?tt:new Xd(tt.k,cn,Yn)}function Se(tt){return[(+tt[0][0]+ +tt[1][0])/2,(+tt[0][1]+ +tt[1][1])/2]}function ut(tt,_n,zt,cn){tt.on("start.zoom",function(){Nt(this,arguments).event(cn).start()}).on("interrupt.zoom end.zoom",function(){Nt(this,arguments).event(cn).end()}).tween("zoom",function(){var Yn=this,Rn=arguments,En=Nt(Yn,Rn).event(cn),Xn=t.apply(Yn,Rn),hi=null==zt?Se(Xn):"function"==typeof zt?zt.apply(Yn,Rn):zt,$s=Math.max(Xn[1][0]-Xn[0][0],Xn[1][1]-Xn[0][1]),To=Yn.__zoom,Do="function"==typeof _n?_n.apply(Yn,Rn):_n,ba=x(To.invert(hi).concat($s/To.k),Do.invert(hi).concat($s/Do.k));return function(Nr){if(1===Nr)Nr=Do;else{var aa=ba(Nr),ad=$s/aa[2];Nr=new Xd(ad,hi[0]-aa[0]*ad,hi[1]-aa[1]*ad)}En.zoom(null,Nr)}})}function Nt(tt,_n,zt){return!zt&&tt.__zooming||new en(tt,_n)}function en(tt,_n){this.that=tt,this.args=_n,this.active=0,this.sourceEvent=null,this.extent=t.apply(tt,_n),this.taps=0}function fn(tt,..._n){if(e.apply(this,arguments)){var zt=Nt(this,_n).event(tt),cn=this.__zoom,Yn=Math.max(c[0],Math.min(c[1],cn.k*Math.pow(2,i.apply(this,arguments)))),Rn=Yd(tt);if(zt.wheel)(zt.mouse[0][0]!==Rn[0]||zt.mouse[0][1]!==Rn[1])&&(zt.mouse[1]=cn.invert(zt.mouse[0]=Rn)),clearTimeout(zt.wheel);else{if(cn.k===Yn)return;zt.mouse=[Rn,cn.invert(Rn)],iw(this),zt.start()}L0(tt),zt.wheel=setTimeout(function En(){zt.wheel=null,zt.end()},150),zt.zoom("mouse",n(ze(ae(cn,Yn),zt.mouse[0],zt.mouse[1]),zt.extent,d))}}function Gn(tt,..._n){if(!V&&e.apply(this,arguments)){var zt=tt.currentTarget,cn=Nt(this,_n,!0).event(tt),Yn=Ui(tt.view).on("mousemove.zoom",function hi(To){if(L0(To),!cn.moved){var Do=To.clientX-En,ba=To.clientY-Xn;cn.moved=Do*Do+ba*ba>se}cn.event(To).zoom("mouse",n(ze(cn.that.__zoom,cn.mouse[0]=Yd(To,zt),cn.mouse[1]),cn.extent,d))},!0).on("mouseup.zoom",function $s(To){Yn.on("mousemove.zoom mouseup.zoom",null),XO(To.view,cn.moved),L0(To),cn.event(To).end()},!0),Rn=Yd(tt,zt),En=tt.clientX,Xn=tt.clientY;YO(tt.view),fE(tt),cn.mouse=[Rn,this.__zoom.invert(Rn)],iw(this),cn.start()}}function At(tt,..._n){if(e.apply(this,arguments)){var zt=this.__zoom,cn=Yd(tt.changedTouches?tt.changedTouches[0]:tt,this),Yn=zt.invert(cn),En=n(ze(ae(zt,zt.k*(tt.shiftKey?.5:2)),cn,Yn),t.apply(this,_n),d);L0(tt),_>0?Ui(this).transition().duration(_).call(ut,En,cn,tt):Ui(this).call(de.transform,En,cn,tt)}}function xn(tt,..._n){if(e.apply(this,arguments)){var Rn,En,Xn,hi,zt=tt.touches,cn=zt.length,Yn=Nt(this,_n,tt.changedTouches.length===cn).event(tt);for(fE(tt),En=0;En<cn;++En)hi=[hi=Yd(Xn=zt[En],this),this.__zoom.invert(hi),Xn.identifier],Yn.touch0?!Yn.touch1&&Yn.touch0[2]!==hi[2]&&(Yn.touch1=hi,Yn.taps=0):(Yn.touch0=hi,Rn=!0,Yn.taps=1+!!R);R&&(R=clearTimeout(R)),Rn&&(Yn.taps<2&&(z=hi[0],R=setTimeout(function(){R=null},500)),iw(this),Yn.start())}}function Fn(tt,..._n){if(this.__zooming){var Rn,En,Xn,hi,zt=Nt(this,_n).event(tt),cn=tt.changedTouches,Yn=cn.length;for(L0(tt),Rn=0;Rn<Yn;++Rn)Xn=Yd(En=cn[Rn],this),zt.touch0&&zt.touch0[2]===En.identifier?zt.touch0[0]=Xn:zt.touch1&&zt.touch1[2]===En.identifier&&(zt.touch1[0]=Xn);if(En=zt.that.__zoom,zt.touch1){var $s=zt.touch0[0],To=zt.touch0[1],Do=zt.touch1[0],ba=zt.touch1[1],Nr=(Nr=Do[0]-$s[0])*Nr+(Nr=Do[1]-$s[1])*Nr,aa=(aa=ba[0]-To[0])*aa+(aa=ba[1]-To[1])*aa;En=ae(En,Math.sqrt(Nr/aa)),Xn=[($s[0]+Do[0])/2,($s[1]+Do[1])/2],hi=[(To[0]+ba[0])/2,(To[1]+ba[1])/2]}else{if(!zt.touch0)return;Xn=zt.touch0[0],hi=zt.touch0[1]}zt.zoom("touch",n(ze(En,Xn,hi),zt.extent,d))}}function un(tt,..._n){if(this.__zooming){var Rn,En,zt=Nt(this,_n).event(tt),cn=tt.changedTouches,Yn=cn.length;for(fE(tt),V&&clearTimeout(V),V=setTimeout(function(){V=null},500),Rn=0;Rn<Yn;++Rn)En=cn[Rn],zt.touch0&&zt.touch0[2]===En.identifier?delete zt.touch0:zt.touch1&&zt.touch1[2]===En.identifier&&delete zt.touch1;if(zt.touch1&&!zt.touch0&&(zt.touch0=zt.touch1,delete zt.touch1),zt.touch0)zt.touch0[1]=this.__zoom.invert(zt.touch0[0]);else if(zt.end(),2===zt.taps&&(En=Yd(En,this),Math.hypot(z[0]-En[0],z[1]-En[1])<le)){var Xn=Ui(this).on("dblclick.zoom");Xn&&Xn.apply(this,arguments)}}}return de.transform=function(tt,_n,zt,cn){var Yn=tt.selection?tt.selection():tt;Yn.property("__zoom",cF),tt!==Yn?ut(tt,_n,zt,cn):Yn.interrupt().each(function(){Nt(this,arguments).event(cn).start().zoom(null,"function"==typeof _n?_n.apply(this,arguments):_n).end()})},de.scaleBy=function(tt,_n,zt,cn){de.scaleTo(tt,function(){return this.__zoom.k*("function"==typeof _n?_n.apply(this,arguments):_n)},zt,cn)},de.scaleTo=function(tt,_n,zt,cn){de.transform(tt,function(){var Yn=t.apply(this,arguments),Rn=this.__zoom,En=null==zt?Se(Yn):"function"==typeof zt?zt.apply(this,arguments):zt,Xn=Rn.invert(En),hi="function"==typeof _n?_n.apply(this,arguments):_n;return n(ze(ae(Rn,hi),En,Xn),Yn,d)},zt,cn)},de.translateBy=function(tt,_n,zt,cn){de.transform(tt,function(){return n(this.__zoom.translate("function"==typeof _n?_n.apply(this,arguments):_n,"function"==typeof zt?zt.apply(this,arguments):zt),t.apply(this,arguments),d)},null,cn)},de.translateTo=function(tt,_n,zt,cn,Yn){de.transform(tt,function(){var Rn=t.apply(this,arguments),En=this.__zoom,Xn=null==cn?Se(Rn):"function"==typeof cn?cn.apply(this,arguments):cn;return n(yw.translate(Xn[0],Xn[1]).scale(En.k).translate("function"==typeof _n?-_n.apply(this,arguments):-_n,"function"==typeof zt?-zt.apply(this,arguments):-zt),Rn,d)},cn,Yn)},en.prototype={event:function(tt){return tt&&(this.sourceEvent=tt),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(tt,_n){return this.mouse&&"mouse"!==tt&&(this.mouse[1]=_n.invert(this.mouse[0])),this.touch0&&"touch"!==tt&&(this.touch0[1]=_n.invert(this.touch0[0])),this.touch1&&"touch"!==tt&&(this.touch1[1]=_n.invert(this.touch1[0])),this.that.__zoom=_n,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(tt){var _n=Ui(this.that).datum();E.call(tt,this.that,new pK(tt,{sourceEvent:this.sourceEvent,target:de,type:tt,transform:this.that.__zoom,dispatch:E}),_n)}},de.wheelDelta=function(tt){return arguments.length?(i="function"==typeof tt?tt:_w(+tt),de):i},de.filter=function(tt){return arguments.length?(e="function"==typeof tt?tt:_w(!!tt),de):e},de.touchable=function(tt){return arguments.length?(s="function"==typeof tt?tt:_w(!!tt),de):s},de.extent=function(tt){return arguments.length?(t="function"==typeof tt?tt:_w([[+tt[0][0],+tt[0][1]],[+tt[1][0],+tt[1][1]]]),de):t},de.scaleExtent=function(tt){return arguments.length?(c[0]=+tt[0],c[1]=+tt[1],de):[c[0],c[1]]},de.translateExtent=function(tt){return arguments.length?(d[0][0]=+tt[0][0],d[1][0]=+tt[1][0],d[0][1]=+tt[0][1],d[1][1]=+tt[1][1],de):[[d[0][0],d[0][1]],[d[1][0],d[1][1]]]},de.constrain=function(tt){return arguments.length?(n=tt,de):n},de.duration=function(tt){return arguments.length?(_=+tt,de):_},de.interpolate=function(tt){return arguments.length?(x=tt,de):x},de.on=function(){var tt=E.on.apply(E,arguments);return tt===E?de:tt},de.clickDistance=function(tt){return arguments.length?(se=(tt=+tt)*tt,de):Math.sqrt(se)},de.tapDistance=function(tt){return arguments.length?(le=+tt,de):le},de}().scaleExtent([.3,3]).on("zoom",n=>{this.g.attr("transform",n.transform)}),this.svg.call(this.zoom))}findNodeById(n,i){if(n.id===i)return n;if(n.children)for(const s of n.children){const c=this.findNodeById(s,i);if(c)return c}return null}updateTree(){this.createTree(),this.g.attr("transform",`translate(${this.isMobile?50:100}, ${(this.isMobile?50:100)-this.currentLevel*(200*this.scaleFactor)})`)}updateTreeStructure(){const n=this.setupTreeLayout(),i=this.createHierarchy(n);this.updateLinks(i),this.updateNodes(i),this.updateButtonStates()}getMaxTreeDepth(n,i=0){return n.children&&0!==n.children.length?Math.max(...n.children.map(s=>this.getMaxTreeDepth(s,i+1))):i}setupTreeLayout(){const n=this.getMaxTreeDepth(this.treeData),c=Math.max(this.height-100,n*(200*this.scaleFactor));return nF().size([1.1*this.width,c]).separation((d,_)=>.5)}createHierarchy(n){const i=$_(this.treeData);return n(i),this.nodePositions.clear(),i.descendants().forEach(s=>{const c=s.depth;this.nodePositions.has(c)||this.nodePositions.set(c,s.y||0)}),i}updateLinks(n){this.renderLinks(n,!0)}renderLinks(n,i=!1){const s=this,c=this.scaleFactor;if(i){const d=this.g.selectAll(".link").data(n.links(),x=>`${x.source.data.id}-${x.target.data.id}`);d.exit().remove(),d.enter().append("path").attr("class","link").style("stroke","#fff").style("stroke-width",2).style("fill","none").style("opacity",.2).style("filter","blur(2px)").merge(d).transition().duration(500).style("opacity",x=>s.visibleNodes.has(x.target.data.id)?.8:.2).style("filter",x=>s.visibleNodes.has(x.target.data.id)?"none":"blur(2px)").attr("d",x=>`M${x.source.x},${x.source.y}\n                L${x.target.x},${x.target.y}`);const _=this.g.selectAll(".link-label").data(n.links().filter(x=>x.target.data.answer),x=>`${x.source.data.id}-${x.target.data.id}`);_.exit().remove(),_.enter().append("text").attr("class","link-label").merge(_).attr("x",x=>(x.source.x+x.target.x)/2).attr("y",x=>(x.source.y+x.target.y)/2).attr("text-anchor","middle").attr("dy",-5*c).style("font-size",12*c+"px").style("font-weight","600").style("fill",x=>"Yes"===x.target.data.answer?"#6366f1":"#8b5cf6").style("pointer-events","none").style("font-family",'Roboto, "Segoe UI", Tahoma, Geneva, Verdana, sans-serif').style("text-shadow","0px 1px 3px rgba(0, 0, 0, 0.8)").style("display","free"===s.mode?"block":"none").text(x=>x.target.data.answer||"")}else this.g.selectAll(".link").data(n.links()).enter().append("path").attr("class","link").attr("d",d=>`M${d.source.x},${d.source.y}\n                L${d.target.x},${d.target.y}`).style("stroke","#fff").style("stroke-width",2).style("fill","none").style("opacity",d=>s.visibleNodes.has(d.target.data.id)?.8:.2).style("filter",d=>s.visibleNodes.has(d.target.data.id)?"none":"blur(2px)"),this.g.selectAll(".link-label").data(n.links().filter(d=>d.target.data.answer)).enter().append("text").attr("class","link-label").attr("x",d=>(d.source.x+d.target.x)/2).attr("y",d=>(d.source.y+d.target.y)/2).attr("text-anchor","middle").attr("dy",-5*c).style("font-size",12*c+"px").style("font-weight","600").style("fill",d=>"Yes"===d.target.data.answer?"#6366f1":"#8b5cf6").style("pointer-events","none").style("font-family",'Roboto, "Segoe UI", Tahoma, Geneva, Verdana, sans-serif').style("text-shadow","0px 1px 3px rgba(0, 0, 0, 0.8)").style("display","free"===s.mode?"block":"none").text(d=>d.target.data.answer||"")}updateNodes(n){const i=this,s=this.g.selectAll(".node").data(n.descendants(),_=>_.data.id);s.exit().remove();const c=s.enter().append("g").attr("class","node").style("opacity",.3).style("filter","blur(3px)");c.merge(s).transition().duration(500).style("opacity",_=>i.visibleNodes.has(_.data.id)?1:.3).style("filter",_=>i.visibleNodes.has(_.data.id)?"none":"blur(3px)").attr("transform",_=>`translate(${_.x},${_.y})`),this.addNodeContent(c)}addNodeContent(n){const i=this,s=this.scaleFactor,c=240*s,d=60*s,_=35*s,x=13*s,E=100*s,R=32*s;n.filter(V=>V.data.question&&!V.data.denomination).append("rect").attr("x",-c/2).attr("y",-d/2).attr("width",c).attr("height",d).attr("rx",12*s).style("fill","rgba(30, 41, 59, 0.95)").style("stroke","#a855f7").style("stroke-width",2*s).style("cursor",V=>"quiz"!==i.mode||i.visibleNodes.has(V.data.id)?"pointer":"default").style("filter","drop-shadow(0px 4px 12px rgba(168, 85, 247, 0.3))").on("click",(V,j)=>{V.stopPropagation(),("quiz"!==i.mode||i.visibleNodes.has(j.data.id))&&j.data.result&&(i.selectedNodeId=j.data.id,i.currentResult=j.data.result,i.currentResultIcon=j.data.icon||null,i.currentResultDenomination=j.data.denomination||null,i.updateSelectedState())}).on("mouseover",function(V,j){"quiz"===i.mode&&!i.visibleNodes.has(j.data.id)||Ui(this).interrupt().transition().duration(150).style("stroke-width",3*s).style("filter","drop-shadow(0px 6px 16px rgba(168, 85, 247, 0.5))")}).on("mouseout",function(V,j){"quiz"===i.mode&&!i.visibleNodes.has(j.data.id)||Ui(this).interrupt().transition().duration(150).style("stroke-width",2*s).style("filter","drop-shadow(0px 4px 12px rgba(168, 85, 247, 0.3))")});const z=n.filter(V=>V.data.denomination);z.append("circle").attr("r",_).style("fill",V=>V.data.color||"#ffffff").style("stroke","none").style("cursor",V=>"quiz"!==i.mode||i.visibleNodes.has(V.data.id)?"pointer":"default").style("filter","drop-shadow(0px 6px 12px rgba(0, 0, 0, 0.2))").on("click",(V,j)=>{V.stopPropagation(),("quiz"!==i.mode||i.visibleNodes.has(j.data.id))&&j.data.result&&(i.selectedNodeId=j.data.id,i.currentResult=j.data.result,i.currentResultIcon=j.data.icon||null,i.currentResultDenomination=j.data.denomination||null,i.updateSelectedState())}).on("mouseover",function(V,j){"quiz"===i.mode&&!i.visibleNodes.has(j.data.id)||Ui(this).interrupt().transition().duration(150).attr("r",1.15*_).style("filter","drop-shadow(0px 8px 16px rgba(0, 0, 0, 0.25))")}).on("mouseout",function(V,j){"quiz"===i.mode&&!i.visibleNodes.has(j.data.id)||Ui(this).interrupt().transition().duration(150).attr("r",_).style("filter","drop-shadow(0px 6px 12px rgba(0, 0, 0, 0.2))")}),z.filter(V=>V.data.icon).append("image").attr("xlink:href",V=>V.data.icon).attr("x",1.1*-_).attr("y",1.1*-_).attr("width",2.2*_).attr("height",2.2*_).style("pointer-events","none").attr("clip-path",`circle(${_}px at ${1.1*_}px ${1.1*_}px)`),n.filter(V=>V.data.question&&!V.data.denomination).append("text").attr("text-anchor","middle").attr("dy",0).style("font-size",`${x}px`).style("font-weight","500").style("fill","#e2e8f0").style("pointer-events","none").style("font-family",'Inter, "Segoe UI", Tahoma, Geneva, Verdana, sans-serif').each(function(V){const j=Ui(this),J=V.data.question.split(" "),se=16*s,le=.9*c;let de=[],ze=j.append("tspan").attr("x",0).attr("dy",0);J.forEach(Nt=>{de.push(Nt),ze.text(de.join(" ")),ze.node().getComputedTextLength()>le&&(de.pop(),ze.text(de.join(" ")),de=[Nt],ze=j.append("tspan").attr("x",0).attr("dy",se).text(Nt))});const ut=-(j.selectAll("tspan").size()-1)*se/2;j.selectAll("tspan").each(function(Nt,en){Ui(this).attr("dy",0===en?ut:se)})}),n.filter(V=>V.data.denomination).append("text").attr("text-anchor","middle").attr("dy",_+20*s).style("font-size",12*s+"px").style("font-weight","600").style("fill","#ffffff").style("pointer-events","none").style("font-family",'Roboto, "Segoe UI", Tahoma, Geneva, Verdana, sans-serif').style("text-shadow","0px 1px 2px rgba(0, 0, 0, 0.3)").text(V=>V.data.denomination),n.filter(V=>{const j=i.findNodeById(i.treeData,V.data.id);return j&&j.children&&!V.data.denomination}).each(function(V){const j=Ui(this);(i.findNodeById(i.treeData,V.data.id)?.children||[]).forEach((le,de)=>{if(le.answer){const ae=i.visibleNodes.has(V.data.id),ze="free"===i.mode||ae,Se=j.append("g").attr("class","answer-button").style("cursor",ze?"pointer":"default").style("opacity",ze?1:.4).style("display","free"===i.mode?"none":"block").on("click",en=>{en.stopPropagation();const fn=i.visibleNodes.has(V.data.id);"quiz"===i.mode&&!fn||i.makeSpecificChildVisible(le.id,V.data.id)}),ut=60*s,Nt=0===de?-60*s:60*s;Se.append("rect").attr("x",Nt-E/2).attr("y",ut-R/2).attr("width",E).attr("height",R).attr("rx",16*s).style("fill","Yes"===le.answer?"#6366f1":"#8b5cf6").style("stroke","none").style("opacity",1).style("filter","drop-shadow(0px 3px 6px rgba(0, 0, 0, 0.16))").on("mouseover",function(){"true"===Ui(this.parentNode).attr("data-clickable")&&Ui(this).interrupt().transition().duration(150).style("filter","drop-shadow(0px 4px 8px rgba(0, 0, 0, 0.24))").attr("y",ut-R/2-2)}).on("mouseout",function(){"true"===Ui(this.parentNode).attr("data-clickable")&&Ui(this).interrupt().transition().duration(150).style("filter","drop-shadow(0px 3px 6px rgba(0, 0, 0, 0.16))").attr("y",ut-R/2)}),Se.append("text").attr("x",Nt).attr("y",ut+4*s).attr("text-anchor","middle").style("font-size",13*s+"px").style("font-weight","500").style("fill","#ffffff").style("pointer-events","none").style("font-family",'Roboto, "Segoe UI", Tahoma, Geneva, Verdana, sans-serif').text(le.answer||"")}})})}createTree(){Ui(this.treeContainer.nativeElement).selectAll("*").remove(),(this.width<=0||this.height<=0)&&this.setDimensions();const n=this.isMobile?50:100,i=this.isMobile?50:100;this.svg=Ui(this.treeContainer.nativeElement).append("svg").attr("width","100%").attr("height","100%").attr("viewBox",`0 0 ${this.width} ${this.height}`).style("background","linear-gradient(135deg, #0f172a 0%, #581c87 50%, #0f172a 100%)"),this.g=this.svg.append("g").attr("transform",`translate(${n}, ${i})`);const s=this.setupTreeLayout(),c=this.createHierarchy(s);this.renderLinks(c,!1);const d=this.g.selectAll(".node").data(c.descendants()).enter().append("g").attr("class","node").attr("transform",_=>`translate(${_.x},${_.y})`).style("opacity",_=>this.visibleNodes.has(_.data.id)?1:.3).style("filter",_=>this.visibleNodes.has(_.data.id)?"none":"blur(3px)");this.addNodeContent(d),this.enablePanZoom(),setTimeout(()=>this.panToNode("root"),100)}updateSelectedState(){this.svg.selectAll(".node rect").classed("selected",n=>n.data.id===this.selectedNodeId),this.svg.selectAll(".node circle").classed("selected",n=>n.data.id===this.selectedNodeId)}updateButtonStates(){const n=this;this.svg.selectAll(".answer-button").each(function(i){const s=Ui(this),d=n.visibleNodes.has(i.data.id),_="free"===n.mode||d;s.style("cursor",_?"pointer":"default").style("opacity",_?1:.4).style("display","free"===n.mode?"none":"block").attr("data-clickable",_?"true":"false")})}closeResult(){this.currentResult=null,this.currentResultIcon=null,this.currentResultDenomination=null,this.selectedNodeId=null,this.updateSelectedState()}animateFuseEffect(n,i){const s=this.setupTreeLayout(),c=this.createHierarchy(s),d=c.descendants().find(j=>j.data.id===n),_=c.descendants().find(j=>j.data.id===i);if(!d||!_)return;const E=this.g.insert("g",":first-child").attr("class","fuse-effect").append("path").attr("d",`M${d.x},${d.y} L${_.x},${_.y}`).style("stroke","url(#fuseGradient)").style("stroke-width",4).style("fill","none").style("stroke-linecap","round").style("filter","drop-shadow(0px 0px 8px rgba(251, 191, 36, 0.8))"),z=(this.svg.select("defs").empty()?this.svg.append("defs"):this.svg.select("defs")).append("linearGradient").attr("id","fuseGradient").attr("gradientUnits","userSpaceOnUse").attr("x1",d.x).attr("y1",d.y).attr("x2",_.x).attr("y2",_.y);z.append("stop").attr("offset","0%").attr("stop-color","#fbbf24").attr("stop-opacity",0),z.append("stop").attr("offset","30%").attr("stop-color","#f59e0b").attr("stop-opacity",1),z.append("stop").attr("offset","100%").attr("stop-color","#ef4444").attr("stop-opacity",0);const V=E.node().getTotalLength();E.attr("stroke-dasharray",`${V} ${V}`).attr("stroke-dashoffset",V).transition().duration(600).ease(ZY).attr("stroke-dashoffset",0).on("end",()=>{E.transition().duration(200).style("stroke","#f59e0b").style("filter","none").on("end",()=>{z.remove()})})}static \u0275fac=function(i){return new(i||e)(rn(Gh),rn(TR),rn(SK),rn(ZJ))};static \u0275cmp=_l({type:e,selectors:[["app-denomination-quiz"]],viewQuery:function(i,s){if(1&i&&np(qJ,7),2&i){let c;zd(c=Bd())&&(s.treeContainer=c.first)}},hostBindings:function(i,s){1&i&&xi("mouseover",function(d){return s.onMouseOver(d)},0,Bs)("mouseout",function(d){return s.onMouseOut(d)})},decls:14,vars:8,consts:[["treeContainer",""],["resultCard",""],[1,"header-drawer"],[1,"drawer-card"],[1,"drawer-content"],[1,"drawer-title"],["class","drawer-description",4,"ngIf"],["class","mode-toggle",4,"ngIf"],["class","attribution",4,"ngIf"],[1,"drawer-toggle",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","transition-transform","duration-300"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],["class","fixed top-4 right-4 w-96 bg-slate-800/95 backdrop-blur-md rounded-xl shadow-2xl border-2 border-purple-500 overflow-hidden z-50 animate-slide-in",4,"ngIf"],[1,"tree-container"],[1,"drawer-description"],[1,"mode-toggle"],[1,"mode-button",3,"click"],["title","Reset the chart",1,"reset-button",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],["title","Show tutorial",1,"reset-button",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"attribution"],[1,"attribution-text"],["href","https://www.youtube.com/watch?v=4cug_xLQe8U","target","_blank","rel","noopener noreferrer","title","Visit Redeemed Zoomer on YouTube",1,"youtube-link"],["viewBox","0 0 24 24","fill","currentColor",1,"w-5","h-5"],["d","M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"],[1,"fixed","top-4","right-4","w-96","bg-slate-800/95","backdrop-blur-md","rounded-xl","shadow-2xl","border-2","border-purple-500","overflow-hidden","z-50","animate-slide-in"],[1,"p-6"],[1,"flex","items-start","justify-between","mb-4"],[1,"flex","items-center","gap-3","flex-1"],["class","w-12 h-12 rounded-full bg-white flex items-center justify-center overflow-hidden flex-shrink-0",4,"ngIf"],["class","text-lg font-semibold text-purple-300",4,"ngIf"],[1,"text-white","hover:text-red-400","transition-colors","flex-shrink-0","ml-2",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18L18 6M6 6l12 12"],[1,"text-sm","text-slate-200","leading-relaxed",3,"innerHTML"],[1,"w-12","h-12","rounded-full","bg-white","flex","items-center","justify-center","overflow-hidden","flex-shrink-0"],[1,"w-full","h-full","object-cover",3,"src","alt"],[1,"text-lg","font-semibold","text-purple-300"]],template:function(i,s){if(1&i){const c=yl();Be(0,"div",2)(1,"div",3)(2,"div",4)(3,"h1",5),vt(4,"Denomination Flow Chart"),We(),ws(5,WJ,2,0,"p",6)(6,YJ,13,4,"div",7)(7,XJ,6,0,"div",8),We(),Be(8,"button",9),xi("click",function(){return q(c),te(s.toggleHeader())}),er(),Be(9,"svg",10),pn(10,"path",11),We()()()(),ws(11,JJ,11,3,"div",12),lr(),pn(12,"div",13,0)}2&i&&(Tr("collapsed",!s.headerExpanded),Xt(5),Mi("ngIf",s.headerExpanded),Xt(),Mi("ngIf",s.headerExpanded),Xt(),Mi("ngIf",s.headerExpanded),Xt(2),Tr("rotate-180",!s.headerExpanded),Xt(2),Mi("ngIf",s.currentResult))},dependencies:[zm,Nm],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;width:100%;height:100vh;min-height:100vh;background:linear-gradient(135deg,#0f172a,#581c87,#0f172a);user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.header-drawer[_ngcontent-%COMP%]{position:fixed;top:20px;left:20px;z-index:100;max-width:500px;transition:all .4s cubic-bezier(.4,0,.2,1)}.header-drawer.collapsed[_ngcontent-%COMP%]{transform:translate(-440px)}.drawer-card[_ngcontent-%COMP%]{background:#1e293bd9;backdrop-filter:blur(16px);border:1px solid rgba(168,85,247,.3);border-radius:16px;padding:20px 24px;box-shadow:0 8px 32px #0000004d;position:relative;transition:all .4s cubic-bezier(.4,0,.2,1);width:500px}.drawer-content[_ngcontent-%COMP%]{transition:all .4s cubic-bezier(.4,0,.2,1)}.drawer-title[_ngcontent-%COMP%]{font-size:28px;font-weight:700;color:#fff;margin:0 0 12px;font-family:Inter,Segoe UI,Tahoma,Geneva,Verdana,sans-serif;text-shadow:0px 2px 4px rgba(0,0,0,.3);transition:all .3s ease}.drawer-description[_ngcontent-%COMP%]{font-size:14px;color:#e2e8f0;margin:0 0 16px;line-height:1.6;font-family:Inter,Segoe UI,Tahoma,Geneva,Verdana,sans-serif;opacity:1;transition:all .4s cubic-bezier(.4,0,.2,1)}.mode-toggle[_ngcontent-%COMP%]{display:flex;gap:10px;opacity:1;transition:all .4s cubic-bezier(.4,0,.2,1)}.mode-button[_ngcontent-%COMP%]{padding:8px 20px;border-radius:20px;border:2px solid #a855f7;background:#0f172a99;color:#e2e8f0;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s ease;font-family:Inter,Segoe UI,Tahoma,Geneva,Verdana,sans-serif}.mode-button[_ngcontent-%COMP%]:hover{background:#a855f74d;border-color:#c084fc;transform:translateY(-1px);box-shadow:0 4px 12px #a855f733}.mode-button.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#a855f7,#7c3aed);color:#fff;border-color:#a855f7;box-shadow:0 4px 16px #a855f766}.reset-button[_ngcontent-%COMP%]{padding:8px 16px;border-radius:20px;border:2px solid #f59e0b;background:#f59e0b1a;color:#fbbf24;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s ease;font-family:Inter,Segoe UI,Tahoma,Geneva,Verdana,sans-serif;display:flex;align-items:center;gap:6px;margin-left:auto}.reset-button[_ngcontent-%COMP%]:hover{background:#f59e0b33;border-color:#fbbf24;transform:translateY(-1px);box-shadow:0 4px 12px #fbbf244d}.reset-button[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:16px;height:16px}.attribution[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-top:16px;padding-top:16px;border-top:1px solid rgba(168,85,247,.2)}.attribution-text[_ngcontent-%COMP%]{font-size:12px;color:#cbd5e1;font-family:Inter,Segoe UI,Tahoma,Geneva,Verdana,sans-serif}.youtube-link[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:32px;height:32px;border-radius:8px;background:#ff00001a;color:red;transition:all .3s ease;text-decoration:none}.youtube-link[_ngcontent-%COMP%]:hover{background:red;color:#fff;transform:translateY(-2px);box-shadow:0 4px 12px #f006}.drawer-toggle[_ngcontent-%COMP%]{position:absolute;top:50%;right:-16px;transform:translateY(-50%);width:32px;height:32px;border-radius:50%;background:#a855f7e6;border:2px solid rgba(255,255,255,.2);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s ease;color:#fff;box-shadow:0 4px 12px #a855f74d}.drawer-toggle[_ngcontent-%COMP%]:hover{background:#a855f7;transform:translateY(-50%) scale(1.1);box-shadow:0 6px 16px #a855f780}.drawer-toggle[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{pointer-events:none}.rotate-180[_ngcontent-%COMP%]{transform:rotate(180deg)}.tree-container[_ngcontent-%COMP%]{flex:1;width:100vw;overflow:hidden;border-radius:0;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.node[_ngcontent-%COMP%]{cursor:default}.node[_ngcontent-%COMP%]   rect[_ngcontent-%COMP%]{transition:all .3s ease}.node[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%]{transition:all .3s ease}.answer-button[_ngcontent-%COMP%]{cursor:pointer}.answer-button[_ngcontent-%COMP%]   rect[_ngcontent-%COMP%]{transition:all .2s ease}.answer-button[_ngcontent-%COMP%]:hover   rect[_ngcontent-%COMP%]{stroke-width:2px;filter:drop-shadow(0 4px 8px rgba(0,0,0,.4))}.start-button[_ngcontent-%COMP%]{cursor:pointer}.start-button[_ngcontent-%COMP%]   rect[_ngcontent-%COMP%]{transition:all .3s ease}.start-button[_ngcontent-%COMP%]:hover   rect[_ngcontent-%COMP%]{filter:drop-shadow(0 6px 12px rgba(217,70,239,.4));transform:translateY(-2px)}.node[_ngcontent-%COMP%]   text[_ngcontent-%COMP%]{pointer-events:none;font-family:Inter,Segoe UI,Tahoma,Geneva,Verdana,sans-serif}.link[_ngcontent-%COMP%]{opacity:.6;transition:opacity .3s ease}.link[_ngcontent-%COMP%]:hover{opacity:1}.answer-label[_ngcontent-%COMP%]{pointer-events:none;text-shadow:1px 1px 2px rgba(0,0,0,.8)}@keyframes _ngcontent-%COMP%_slide-in{0%{transform:translate(100%);opacity:0}to{transform:translate(0);opacity:1}}.animate-slide-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slide-in .3s ease-out}@media (max-width: 768px){.tree-container[_ngcontent-%COMP%]{height:100vh}.header-drawer[_ngcontent-%COMP%]{max-width:calc(100vw - 80px);top:10px;left:10px}.drawer-card[_ngcontent-%COMP%]{width:calc(100vw - 100px);padding:16px 20px}.header-drawer.collapsed[_ngcontent-%COMP%]{transform:translate(calc(-100vw + 80px))}.drawer-title[_ngcontent-%COMP%]{font-size:20px}.drawer-description[_ngcontent-%COMP%]{font-size:12px}.mode-button[_ngcontent-%COMP%]{padding:6px 16px;font-size:12px}}@media (max-width: 480px){.header-drawer[_ngcontent-%COMP%]{top:5px;left:5px;max-width:calc(100vw - 60px)}.drawer-card[_ngcontent-%COMP%]{width:calc(100vw - 70px);padding:12px 16px}.drawer-title[_ngcontent-%COMP%]{font-size:18px;margin-bottom:8px}.drawer-description[_ngcontent-%COMP%]{font-size:11px;margin-bottom:12px}.mode-toggle[_ngcontent-%COMP%]{flex-direction:column;gap:8px}.mode-button[_ngcontent-%COMP%]{width:100%;text-align:center}.attribution[_ngcontent-%COMP%]{margin-top:12px;padding-top:12px}.attribution-text[_ngcontent-%COMP%]{font-size:10px}.youtube-link[_ngcontent-%COMP%]{width:28px;height:28px}}  .tooltip-term{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;text-decoration-color:#a855f7;text-decoration-thickness:1px;text-underline-offset:2px;cursor:help;position:relative}  .tooltip-term:hover{text-decoration-color:#c084fc}"]})}return e})();const tee=["wheelContainer"];let nee=(()=>{class e{wheelContainer;svg;width=800;height=800;radius=350;resizeObserver;hierarchyData={name:"Christianity",children:[{name:"Core Beliefs",children:[{name:"Protestant",color:"#60A5FA",children:[{name:"SOLA FIDE / SOLA SCRIPTURA",color:"#93C5FD",children:[{name:"Law/Gospel Distinction",color:"#BFDBFE",children:[{name:"Lutheran",color:"#3B82F6",value:1}]},{name:"Predestination",color:"#DBEAFE",children:[{name:"Reformed",color:"#EF4444",value:1},{name:"Congregational Church Polity",color:"#FEE2E2",children:[{name:"Congregationalist",color:"#F59E0B",value:1}]}]},{name:"Episcopal Polity",color:"#E0E7FF",children:[{name:"Anglican",color:"#EC4899",value:1}]},{name:"Credobaptism",color:"#FEF3C7",children:[{name:"Baptist",color:"#92400E",value:1}]},{name:"Wesleyan Perfectionism",color:"#D1FAE5",children:[{name:"Methodist",color:"#10B981",value:1}]},{name:"Spirit Baptism",color:"#E9D5FF",children:[{name:"Pentecostal",color:"#A855F7",value:1}]}]}]},{name:"Catholic",color:"#FBBF24",children:[{name:"Papacy",color:"#FCD34D",value:1},{name:"Purgatory",color:"#FDE68A",value:1},{name:"Transubstantiation",color:"#FEF3C7",value:1},{name:"Immaculate Conception",color:"#FFFBEB",value:1}]},{name:"Eastern Orthodox",color:"#FB923C",children:[{name:"Theosis",color:"#FDBA74",value:1}]},{name:"Oriental Orthodox",color:"#84CC16",children:[{name:"Miaphysite Christology",color:"#BEF264",value:1}]}]}]};ngOnInit(){}ngAfterViewInit(){this.createSunburst(),this.setupResizeObserver()}ngOnDestroy(){this.resizeObserver&&this.resizeObserver.disconnect()}setupResizeObserver(){this.resizeObserver=new ResizeObserver(()=>{this.createSunburst()}),this.resizeObserver.observe(this.wheelContainer.nativeElement)}createSunburst(){const n=this.wheelContainer.nativeElement,c=.9*Math.min(n.clientWidth,n.clientHeight);this.width=c,this.height=c,this.radius=Math.min(this.width,this.height)/2,Ui(n).select("svg").remove(),this.svg=Ui(n).append("svg").attr("width","100%").attr("height","100%").attr("viewBox",`0 0 ${this.width} ${this.height}`).attr("preserveAspectRatio","xMidYMid meet");const d=this.svg.append("g").attr("transform",`translate(${this.width/2},${this.height/2})`),_=$_(this.hierarchyData).sum(ae=>ae.value||0).sort((ae,ze)=>(ze.value||0)-(ae.value||0));tF().size([2*Math.PI,this.radius])(_);const E=aF().startAngle(ae=>ae.x0).endAngle(ae=>ae.x1).padAngle(ae=>Math.min((ae.x1-ae.x0)/2,.005)).padRadius(this.radius/2).innerRadius(ae=>ae.y0).outerRadius(ae=>ae.y1);d.selectAll("path").data(_.descendants().filter(ae=>ae.depth>=1)).enter().append("path").attr("fill",ae=>1===ae.depth?"#1e293b":2===ae.depth?ae.data.color||"#1e293b":3===ae.depth?ae.data.color||ae.parent.data.color||"#1e293b":4===ae.depth?ae.data.color||ae.parent.parent.data.color||"#1e293b":5===ae.depth?ae.data.color||ae.parent.parent.parent.data.color||"#1e293b":6===ae.depth&&ae.data.color||"#1e293b").attr("opacity",ae=>1===ae.depth?1:2===ae.depth?.95:3===ae.depth?.9:4===ae.depth?.85:5===ae.depth?.9:6===ae.depth?.95:1).attr("stroke","#0f172a").attr("stroke-width",2).style("filter","drop-shadow(0 4px 8px rgba(0, 0, 0, 0.6))").attr("d",E);const z=this.svg.append("defs").append("filter").attr("id","matte").attr("x","-50%").attr("y","-50%").attr("width","200%").attr("height","200%");z.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",1).attr("result","blur"),z.append("feOffset").attr("in","blur").attr("dx",0).attr("dy",1).attr("result","offsetBlur");const V=z.append("feMerge");V.append("feMergeNode").attr("in","offsetBlur"),V.append("feMergeNode").attr("in","SourceGraphic"),d.selectAll("text.first-ring").data(_.descendants().filter(ae=>1===ae.depth)).enter().append("text").attr("class","first-ring").attr("transform",function(ae){const ze=(ae.x0+ae.x1)/2*180/Math.PI;return`rotate(${ze-90}) translate(${(ae.y0+ae.y1)/2},0) rotate(${ze<180?0:180})`}).attr("dy","0.35em").attr("text-anchor","middle").attr("font-size","10px").attr("fill","#e2e8f0").attr("font-weight","bold").text(ae=>ae.data.name),d.selectAll("text.second-ring").data(_.descendants().filter(ae=>2===ae.depth)).enter().append("text").attr("class","second-ring").attr("transform",function(ae){const ze=(ae.x0+ae.x1)/2*180/Math.PI;return`rotate(${ze-90}) translate(${(ae.y0+ae.y1)/2},0) rotate(${ze<180?0:180})`}).attr("dy","0.35em").attr("text-anchor","middle").attr("font-size","11px").attr("font-weight","bold").attr("fill","#0f172a").style("text-shadow","0 1px 3px rgba(255,255,255,0.2)").text(ae=>ae.data.name),d.selectAll("text.third-ring").data(_.descendants().filter(ae=>3===ae.depth)).enter().append("text").attr("class","third-ring").attr("transform",function(ae){const ze=(ae.x0+ae.x1)/2*180/Math.PI;return`rotate(${ze-90}) translate(${(ae.y0+ae.y1)/2},0) rotate(${ze<180?0:180})`}).attr("dy","0.35em").attr("text-anchor","middle").attr("font-size","9px").attr("font-weight",ae=>"Protestant"===ae.parent.data.name?"bold":"normal").attr("fill","#0f172a").style("text-shadow","0 1px 2px rgba(255,255,255,0.2)").text(ae=>ae.data.name),d.selectAll("text.fourth-ring").data(_.descendants().filter(ae=>4===ae.depth)).enter().append("text").attr("class","fourth-ring").attr("transform",function(ae){const ze=(ae.x0+ae.x1)/2*180/Math.PI;return`rotate(${ze-90}) translate(${(ae.y0+ae.y1)/2},0) rotate(${ze<180?0:180})`}).attr("dy","0.35em").attr("text-anchor","middle").attr("font-size","8px").attr("fill","#0f172a").style("text-shadow","0 1px 2px rgba(255,255,255,0.2)").text(ae=>ae.data.name),d.selectAll("text.fifth-ring").data(_.descendants().filter(ae=>5===ae.depth)).enter().append("text").attr("class","fifth-ring").attr("transform",function(ae){const ze=(ae.x0+ae.x1)/2*180/Math.PI;return`rotate(${ze-90}) translate(${(ae.y0+ae.y1)/2},0) rotate(${ze<180?0:180})`}).attr("dy","0.35em").attr("text-anchor","middle").attr("font-size","7px").attr("font-weight",ae=>ae.data.color&&ae.children?"normal":"bold").attr("fill",ae=>ae.data.color&&!ae.children?"#ffffff":"#0f172a").style("text-shadow",ae=>ae.data.color&&!ae.children?"0 1px 2px rgba(0,0,0,0.5)":"0 1px 2px rgba(255,255,255,0.2)").text(ae=>ae.data.name),d.selectAll("text.sixth-ring").data(_.descendants().filter(ae=>6===ae.depth)).enter().append("text").attr("class","sixth-ring").attr("transform",function(ae){const ze=(ae.x0+ae.x1)/2*180/Math.PI;return`rotate(${ze-90}) translate(${(ae.y0+ae.y1)/2},0) rotate(${ze<180?0:180})`}).attr("dy","0.35em").attr("text-anchor","middle").attr("font-size","7px").attr("font-weight","bold").attr("fill","#ffffff").style("text-shadow","0 1px 2px rgba(0,0,0,0.3)").text(ae=>ae.data.name);const j=_.children[0];d.append("circle").attr("r",j.y0).attr("fill","transparent").attr("stroke","#475569").attr("stroke-width",2).style("filter","drop-shadow(0 2px 4px rgba(0, 0, 0, 0.4))");const se=.7*j.y0;["Trinity","Nicene Creed","Divinity of Christ","Virgin Birth","Resurrection"].forEach((ae,ze)=>{const Se=(72*ze-90)*Math.PI/180,ut=Math.cos(Se)*se,Nt=Math.sin(Se)*se;d.append("text").attr("x",ut).attr("y",Nt).attr("text-anchor","middle").attr("font-size","9px").attr("fill","#e2e8f0").attr("font-weight","bold").style("text-shadow","0 2px 4px rgba(0,0,0,0.6)").text(ae)}),d.append("rect").attr("x",-2.5).attr("y",-12.5).attr("width",5).attr("height",25).attr("fill","#FBBF24").attr("stroke","#F59E0B").attr("stroke-width",1).style("filter","drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5))"),d.append("rect").attr("x",-12.5).attr("y",-7.5).attr("width",25).attr("height",5).attr("fill","#FBBF24").attr("stroke","#F59E0B").attr("stroke-width",1).style("filter","drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5))")}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=_l({type:e,selectors:[["app-denomination-wheel"]],viewQuery:function(i,s){if(1&i&&np(tee,7),2&i){let c;zd(c=Bd())&&(s.wheelContainer=c.first)}},decls:119,vars:0,consts:[["wheelContainer",""],[1,"min-h-screen","bg-gradient-to-br","from-slate-900","via-purple-900","to-slate-900"],[1,"fixed","top-0","left-0","right-0","z-50","bg-slate-900/80","backdrop-blur-lg","border-b","border-violet-500/20"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"flex","items-center","justify-between","h-16"],[1,"flex","items-center","gap-3"],[1,"w-8","h-8","bg-gradient-to-br","from-fuchsia-500","to-violet-600","rounded-lg","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-white"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"],["routerLink","/",1,"text-xl","font-semibold","text-slate-50","hover:text-fuchsia-400","transition-colors"],[1,"text-fuchsia-400"],["routerLink","/",1,"text-slate-300","hover:text-fuchsia-400","transition-colors","duration-200","font-medium","flex","items-center","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],[1,"pt-16","min-h-screen"],[1,"grid","grid-cols-1","lg:grid-cols-12","min-h-screen"],[1,"lg:col-span-4","xl:col-span-3","bg-slate-900/50","backdrop-blur-sm","border-r","border-violet-500/20","overflow-y-auto"],[1,"p-6","lg:p-8","space-y-6"],[1,"text-3xl","font-bold","text-transparent","bg-clip-text","bg-gradient-to-r","from-fuchsia-400","to-cyan-400","mb-2"],[1,"text-slate-400","text-sm"],[1,"space-y-3"],[1,"text-xl","font-semibold","text-slate-100","flex","items-center","gap-2"],[1,"w-2","h-2","bg-fuchsia-400","rounded-full"],[1,"bg-slate-800/50","rounded-lg","p-4","border","border-slate-700"],[1,"space-y-2","text-sm","text-slate-300"],[1,"flex","items-start","gap-2"],["fill","currentColor","viewBox","0 0 20 20",1,"w-4","h-4","text-cyan-400","mt-0.5","flex-shrink-0"],["fill-rule","evenodd","d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule","evenodd"],[1,"w-2","h-2","bg-cyan-400","rounded-full"],[1,"bg-blue-500/10","border","border-blue-500/30","rounded-lg","p-3"],[1,"font-semibold","text-blue-300","mb-1"],[1,"text-xs","text-slate-400"],[1,"bg-yellow-500/10","border","border-yellow-500/30","rounded-lg","p-3"],[1,"font-semibold","text-yellow-300","mb-1"],[1,"bg-orange-500/10","border","border-orange-500/30","rounded-lg","p-3"],[1,"font-semibold","text-orange-300","mb-1"],[1,"bg-lime-500/10","border","border-lime-500/30","rounded-lg","p-3"],[1,"font-semibold","text-lime-300","mb-1"],[1,"bg-slate-800/50","rounded-lg","p-4","border","border-slate-700","text-sm","text-slate-300","space-y-2"],[1,"text-cyan-400"],[1,"text-violet-400"],[1,"text-pink-400"],[1,"text-blue-400"],[1,"lg:col-span-8","xl:col-span-9","flex","items-center","justify-center","p-4","lg:p-8"],[1,"w-full","h-full","min-h-[600px]","lg:min-h-[800px]"]],template:function(i,s){1&i&&(Be(0,"div",1)(1,"nav",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6),er(),Be(6,"svg",7),pn(7,"path",8),We()(),lr(),Be(8,"a",9),vt(9," Theology "),Be(10,"span",10),vt(11,"Visualizer"),We()()(),Be(12,"a",11),er(),Be(13,"svg",12),pn(14,"path",13),We(),vt(15," Back to Home "),We()()()(),lr(),Be(16,"div",14)(17,"div",15)(18,"div",16)(19,"div",17)(20,"div")(21,"h1",18),vt(22," Denomination Wheel "),We(),Be(23,"p",19),vt(24," Explore the hierarchical relationships between Christian denominations and their theological foundations. "),We()(),Be(25,"div",20)(26,"h2",21),pn(27,"span",22),vt(28," Core Christian Beliefs "),We(),Be(29,"div",23)(30,"ul",24)(31,"li",25),er(),Be(32,"svg",26),pn(33,"path",27),We(),lr(),Be(34,"span")(35,"strong",10),vt(36,"Trinity:"),We(),vt(37," One God in three persons"),We()(),Be(38,"li",25),er(),Be(39,"svg",26),pn(40,"path",27),We(),lr(),Be(41,"span")(42,"strong",10),vt(43,"Nicene Creed:"),We(),vt(44," Historic statement of faith"),We()(),Be(45,"li",25),er(),Be(46,"svg",26),pn(47,"path",27),We(),lr(),Be(48,"span")(49,"strong",10),vt(50,"Divinity of Christ:"),We(),vt(51," Jesus is fully God"),We()(),Be(52,"li",25),er(),Be(53,"svg",26),pn(54,"path",27),We(),lr(),Be(55,"span")(56,"strong",10),vt(57,"Virgin Birth:"),We(),vt(58," Miraculous conception"),We()(),Be(59,"li",25),er(),Be(60,"svg",26),pn(61,"path",27),We(),lr(),Be(62,"span")(63,"strong",10),vt(64,"Resurrection:"),We(),vt(65," Jesus rose from the dead"),We()()()()(),Be(66,"div",20)(67,"h2",21),pn(68,"span",28),vt(69," Major Traditions "),We(),Be(70,"div",20)(71,"div",29)(72,"h3",30),vt(73,"Protestant"),We(),Be(74,"p",31),vt(75,"Emphasizes salvation by faith alone and Scripture alone"),We()(),Be(76,"div",32)(77,"h3",33),vt(78,"Catholic"),We(),Be(79,"p",31),vt(80,"Papal authority, sacramental tradition, apostolic succession"),We()(),Be(81,"div",34)(82,"h3",35),vt(83,"Eastern Orthodox"),We(),Be(84,"p",31),vt(85,"Theosis (union with God), liturgical worship, icons"),We()(),Be(86,"div",36)(87,"h3",37),vt(88,"Oriental Orthodox"),We(),Be(89,"p",31),vt(90,"Miaphysite Christology, ancient traditions"),We()()()(),Be(91,"div",20)(92,"h2",21),pn(93,"span",22),vt(94," How to Read "),We(),Be(95,"div",38)(96,"p")(97,"strong",10),vt(98,"Center:"),We(),vt(99," Core Christian beliefs shared by all traditions"),We(),Be(100,"p")(101,"strong",39),vt(102,"Ring 2:"),We(),vt(103," Major Christian traditions (Protestant, Catholic, Orthodox)"),We(),Be(104,"p")(105,"strong",40),vt(106,"Ring 3:"),We(),vt(107," Key theological emphases (SOLA FIDE, SOLA SCRIPTURA)"),We(),Be(108,"p")(109,"strong",41),vt(110,"Ring 4:"),We(),vt(111," Specific theological concepts and polity structures"),We(),Be(112,"p")(113,"strong",42),vt(114,"Outer Rings:"),We(),vt(115," Individual denominations with their distinctive colors"),We()()()()(),Be(116,"div",43),pn(117,"div",44,0),We()()()())},dependencies:[p0],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}.denomination-group[_ngcontent-%COMP%]{transition:all .3s ease}.denomination-group[_ngcontent-%COMP%]:hover{filter:brightness(1.1)}"]})}return e})(),JF=(()=>{class e{_renderer;_elementRef;onChange=n=>{};onTouched=()=>{};constructor(n,i){this._renderer=n,this._elementRef=i}setProperty(n,i){this._renderer.setProperty(this._elementRef.nativeElement,n,i)}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}setDisabledState(n){this.setProperty("disabled",n)}static \u0275fac=function(i){return new(i||e)(rn(Gh),rn(Rs))};static \u0275dir=Di({type:e})}return e})(),eg=(()=>{class e extends JF{static \u0275fac=(()=>{let n;return function(s){return(n||(n=ks(e)))(s||e)}})();static \u0275dir=Di({type:e,features:[$r]})}return e})();const sd=new sn(""),oee={provide:sd,useExisting:Gi(()=>Aw),multi:!0},aee=new sn("");let Aw=(()=>{class e extends JF{_compositionMode;_composing=!1;constructor(n,i,s){super(n,i),this._compositionMode=s,null==this._compositionMode&&(this._compositionMode=!function see(){const e=op()?op().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(n){this.setProperty("value",n??"")}_handleInput(n){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(n)}_compositionStart(){this._composing=!0}_compositionEnd(n){this._composing=!1,this._compositionMode&&this.onChange(n)}static \u0275fac=function(i){return new(i||e)(rn(Gh),rn(Rs),rn(aee,8))};static \u0275dir=Di({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,s){1&i&&xi("input",function(d){return s._handleInput(d.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(d){return s._compositionEnd(d.target.value)})},standalone:!1,features:[Vo([oee]),$r]})}return e})();const Qa=new sn(""),xp=new sn("");function cN(e){return null!=e}function uN(e){return Rv(e)?Aa(e):e}function hN(e){let t={};return e.forEach(n=>{t=null!=n?{...t,...n}:t}),0===Object.keys(t).length?null:t}function dN(e,t){return t.map(n=>n(e))}function fN(e){return e.map(t=>function cee(e){return!e.validate}(t)?t:n=>t.validate(n))}function VE(e){return null!=e?function pN(e){if(!e)return null;const t=e.filter(cN);return 0==t.length?null:function(n){return hN(dN(n,t))}}(fN(e)):null}function jE(e){return null!=e?function mN(e){if(!e)return null;const t=e.filter(cN);return 0==t.length?null:function(n){return function iee(...e){const t=fR(e),{args:n,keys:i}=pR(e),s=new di(c=>{const{length:d}=n;if(!d)return void c.complete();const _=new Array(d);let x=d,E=d;for(let R=0;R<d;R++){let z=!1;Wh(n[R]).subscribe(Lr(c,V=>{z||(z=!0,E--),_[R]=V},()=>x--,void 0,()=>{(!x||!z)&&(E||c.next(i?gR(i,_):_),c.complete())}))}});return t?s.pipe(mR(t)):s}(dN(n,t).map(uN)).pipe(Si(hN))}}(fN(e)):null}function gN(e,t){return null===e?[t]:Array.isArray(e)?[...e,t]:[e,t]}function UE(e){return e?Array.isArray(e)?e:[e]:[]}function Rw(e,t){return Array.isArray(e)?e.includes(t):e===t}function vN(e,t){const n=UE(t);return UE(e).forEach(s=>{Rw(n,s)||n.push(s)}),n}function bN(e,t){return UE(t).filter(n=>!Rw(e,n))}class xN{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=VE(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=jE(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t=void 0){this.control&&this.control.reset(t)}hasError(t,n){return!!this.control&&this.control.hasError(t,n)}getError(t,n){return this.control?this.control.getError(t,n):null}}class Ml extends xN{name;get formDirective(){return null}get path(){return null}}class wp extends xN{_parent=null;name=null;valueAccessor=null}class wN{_cd;constructor(t){this._cd=t}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}}let CN=(()=>{class e extends wN{constructor(n){super(n)}static \u0275fac=function(i){return new(i||e)(rn(wp,2))};static \u0275dir=Di({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,s){2&i&&Tr("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},standalone:!1,features:[$r]})}return e})();const j0="VALID",Ow="INVALID",ny="PENDING",U0="DISABLED";class iy{}class DN extends iy{value;source;constructor(t,n){super(),this.value=t,this.source=n}}class HE extends iy{pristine;source;constructor(t,n){super(),this.pristine=t,this.source=n}}class ZE extends iy{touched;source;constructor(t,n){super(),this.touched=t,this.source=n}}class Fw extends iy{status;source;constructor(t,n){super(),this.status=t,this.source=n}}function Nw(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}class YE{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(t,n){this._assignValidators(t),this._assignAsyncValidators(n)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get status(){return Vs(this.statusReactive)}set status(t){Vs(()=>this.statusReactive.set(t))}_status=$d(()=>this.statusReactive());statusReactive=pl(void 0);get valid(){return this.status===j0}get invalid(){return this.status===Ow}get pending(){return this.status==ny}get disabled(){return this.status===U0}get enabled(){return this.status!==U0}errors;get pristine(){return Vs(this.pristineReactive)}set pristine(t){Vs(()=>this.pristineReactive.set(t))}_pristine=$d(()=>this.pristineReactive());pristineReactive=pl(!0);get dirty(){return!this.pristine}get touched(){return Vs(this.touchedReactive)}set touched(t){Vs(()=>this.touchedReactive.set(t))}_touched=$d(()=>this.touchedReactive());touchedReactive=pl(!1);get untouched(){return!this.touched}_events=new Ir;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._assignValidators(t)}setAsyncValidators(t){this._assignAsyncValidators(t)}addValidators(t){this.setValidators(vN(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(vN(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(bN(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(bN(t,this._rawAsyncValidators))}hasValidator(t){return Rw(this._rawValidators,t)}hasAsyncValidator(t){return Rw(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){const n=!1===this.touched;this.touched=!0;const i=t.sourceControl??this;this._parent&&!t.onlySelf&&this._parent.markAsTouched({...t,sourceControl:i}),n&&!1!==t.emitEvent&&this._events.next(new ZE(!0,i))}markAllAsTouched(t={}){this.markAsTouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:this}),this._forEachChild(n=>n.markAllAsTouched(t))}markAsUntouched(t={}){const n=!0===this.touched;this.touched=!1,this._pendingTouched=!1;const i=t.sourceControl??this;this._forEachChild(s=>{s.markAsUntouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:i})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t,i),n&&!1!==t.emitEvent&&this._events.next(new ZE(!1,i))}markAsDirty(t={}){const n=!0===this.pristine;this.pristine=!1;const i=t.sourceControl??this;this._parent&&!t.onlySelf&&this._parent.markAsDirty({...t,sourceControl:i}),n&&!1!==t.emitEvent&&this._events.next(new HE(!1,i))}markAsPristine(t={}){const n=!1===this.pristine;this.pristine=!0,this._pendingDirty=!1;const i=t.sourceControl??this;this._forEachChild(s=>{s.markAsPristine({onlySelf:!0,emitEvent:t.emitEvent})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t,i),n&&!1!==t.emitEvent&&this._events.next(new HE(!0,i))}markAsPending(t={}){this.status=ny;const n=t.sourceControl??this;!1!==t.emitEvent&&(this._events.next(new Fw(this.status,n)),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.markAsPending({...t,sourceControl:n})}disable(t={}){const n=this._parentMarkedDirty(t.onlySelf);this.status=U0,this.errors=null,this._forEachChild(s=>{s.disable({...t,onlySelf:!0})}),this._updateValue();const i=t.sourceControl??this;!1!==t.emitEvent&&(this._events.next(new DN(this.value,i)),this._events.next(new Fw(this.status,i)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...t,skipPristineCheck:n},this),this._onDisabledChange.forEach(s=>s(!0))}enable(t={}){const n=this._parentMarkedDirty(t.onlySelf);this.status=j0,this._forEachChild(i=>{i.enable({...t,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors({...t,skipPristineCheck:n},this),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(t,n){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine({},n),this._parent._updateTouched({},n))}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){const i=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===j0||this.status===ny)&&this._runAsyncValidator(i,t.emitEvent)}const n=t.sourceControl??this;!1!==t.emitEvent&&(this._events.next(new DN(this.value,n)),this._events.next(new Fw(this.status,n)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity({...t,sourceControl:n})}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(n=>n._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?U0:j0}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t,n){if(this.asyncValidator){this.status=ny,this._hasOwnPendingAsyncValidator={emitEvent:!1!==n};const i=uN(this.asyncValidator(this));this._asyncValidationSubscription=i.subscribe(s=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(s,{emitEvent:n,shouldHaveEmitted:t})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();const t=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,t}return!1}setErrors(t,n={}){this.errors=t,this._updateControlsErrors(!1!==n.emitEvent,this,n.shouldHaveEmitted)}get(t){let n=t;return null==n||(Array.isArray(n)||(n=n.split(".")),0===n.length)?null:n.reduce((i,s)=>i&&i._find(s),this)}getError(t,n){const i=n?this.get(n):this;return i&&i.errors?i.errors[t]:null}hasError(t,n){return!!this.getError(t,n)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t,n,i){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),(t||i)&&this._events.next(new Fw(this.status,n)),this._parent&&this._parent._updateControlsErrors(t,n,i)}_initObservables(){this.valueChanges=new ao,this.statusChanges=new ao}_calculateStatus(){return this._allControlsDisabled()?U0:this.errors?Ow:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(ny)?ny:this._anyControlsHaveStatus(Ow)?Ow:j0}_anyControlsHaveStatus(t){return this._anyControls(n=>n.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t,n){const i=!this._anyControlsDirty(),s=this.pristine!==i;this.pristine=i,this._parent&&!t.onlySelf&&this._parent._updatePristine(t,n),s&&this._events.next(new HE(this.pristine,n))}_updateTouched(t={},n){this.touched=this._anyControlsTouched(),this._events.next(new ZE(this.touched,n)),this._parent&&!t.onlySelf&&this._parent._updateTouched(t,n)}_onDisabledChange=[];_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){Nw(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}_assignValidators(t){this._rawValidators=Array.isArray(t)?t.slice():t,this._composedValidatorFn=function _ee(e){return Array.isArray(e)?VE(e):e||null}(this._rawValidators)}_assignAsyncValidators(t){this._rawAsyncValidators=Array.isArray(t)?t.slice():t,this._composedAsyncValidatorFn=function yee(e){return Array.isArray(e)?jE(e):e||null}(this._rawAsyncValidators)}}const ry=new sn("",{providedIn:"root",factory:()=>zw}),zw="always";function $0(e,t,n=zw){(function KE(e,t){const n=function _N(e){return e._rawValidators}(e);null!==t.validator?e.setValidators(gN(n,t.validator)):"function"==typeof n&&e.setValidators([n]);const i=function yN(e){return e._rawAsyncValidators}(e);null!==t.asyncValidator?e.setAsyncValidators(gN(i,t.asyncValidator)):"function"==typeof i&&e.setAsyncValidators([i]);const s=()=>e.updateValueAndValidity();jw(t._rawValidators,s),jw(t._rawAsyncValidators,s)})(e,t),t.valueAccessor.writeValue(e.value),(e.disabled||"always"===n)&&t.valueAccessor.setDisabledState?.(e.disabled),function xee(e,t){t.valueAccessor.registerOnChange(n=>{e._pendingValue=n,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&PN(e,t)})}(e,t),function Cee(e,t){const n=(i,s)=>{t.valueAccessor.writeValue(i),s&&t.viewToModelUpdate(i)};e.registerOnChange(n),t._registerOnDestroy(()=>{e._unregisterOnChange(n)})}(e,t),function wee(e,t){t.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&PN(e,t),"submit"!==e.updateOn&&e.markAsTouched()})}(e,t),function bee(e,t){if(t.valueAccessor.setDisabledState){const n=i=>{t.valueAccessor.setDisabledState(i)};e.registerOnDisabledChange(n),t._registerOnDestroy(()=>{e._unregisterOnDisabledChange(n)})}}(e,t)}function jw(e,t){e.forEach(n=>{n.registerOnValidatorChange&&n.registerOnValidatorChange(t)})}function PN(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function RN(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}function LN(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}Promise.resolve();const ON=class extends YE{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(t=null,n,i){super(function qE(e){return(Nw(e)?e.validators:e)||null}(n),function WE(e,t){return(Nw(t)?t.asyncValidators:e)||null}(i,n)),this._applyFormState(t),this._setUpdateStrategy(n),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Nw(n)&&(n.nonNullable||n.initialValueIsDefault)&&(this.defaultValue=LN(t)?t.value:t)}setValue(t,n={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==n.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==n.emitViewToModelChange)),this.updateValueAndValidity(n)}patchValue(t,n={}){this.setValue(t,n)}reset(t=this.defaultValue,n={}){this._applyFormState(t),this.markAsPristine(n),this.markAsUntouched(n),this.setValue(this.value,n),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){RN(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){RN(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){LN(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}},Ree={provide:wp,useExisting:Gi(()=>t2)},FN=Promise.resolve();let t2=(()=>{class e extends wp{_changeDetectorRef;callSetDisabledState;control=new ON;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new ao;constructor(n,i,s,c,d,_){super(),this._changeDetectorRef=d,this.callSetDisabledState=_,this._parent=n,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=function e2(e,t){if(!t)return null;let n,i,s;return Array.isArray(t),t.forEach(c=>{c.constructor===Aw?n=c:function Mee(e){return Object.getPrototypeOf(e.constructor)===eg}(c)?i=c:s=c}),s||i||n||null}(0,c)}ngOnChanges(n){if(this._checkForErrors(),!this._registered||"name"in n){if(this._registered&&(this._checkName(),this.formDirective)){const i=n.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in n&&this._updateDisabled(n),function JE(e,t){if(!e.hasOwnProperty("model"))return!1;const n=e.model;return!!n.isFirstChange()||!Object.is(t,n.currentValue)}(n,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){$0(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(n){FN.then(()=>{this.control.setValue(n,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(n){const i=n.isDisabled.currentValue,s=0!==i&&M_(i);FN.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(n){return this._parent?function Bw(e,t){return[...t.path,e]}(n,this._parent):[n]}static \u0275fac=function(i){return new(i||e)(rn(Ml,9),rn(Qa,10),rn(xp,10),rn(sd,10),rn(Yv,8),rn(ry,8))};static \u0275dir=Di({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[Vo([Ree]),$r,Js]})}return e})(),rte=(()=>{class e{static \u0275fac=function(i){return new(i||e)};static \u0275mod=Iv({type:e});static \u0275inj=rr({})}return e})(),ste=(()=>{class e{static withConfig(n){return{ngModule:e,providers:[{provide:ry,useValue:n.callSetDisabledState??zw}]}}static \u0275fac=function(i){return new(i||e)};static \u0275mod=Iv({type:e});static \u0275inj=rr({imports:[rte]})}return e})();function ate(e,t){if(1&e){const n=yl();Be(0,"span",14),xi("click",function(s){q(n);const c=ui().$implicit;return ui().toggleExpand(c),te(s.stopPropagation())}),vt(1),We()}if(2&e){const n=ui().$implicit;Xt(),Ju(" ",n.expanded?"\u25bc":"\u25b6"," ")}}function lte(e,t){if(1&e){const n=yl();Be(0,"div",11),xi("click",function(){const s=q(n).$implicit;return te(ui().selectNode(s))}),ws(1,ate,2,1,"span",12),Be(2,"span",13),vt(3),We()()}if(2&e){const n=t.$implicit,i=ui();JT("padding-left",20*(n.level||0)+10,"px"),Tr("selected",n===i.selectedNode),Xt(),Mi("ngIf",i.hasChildren(n)),Xt(2),wo(i.getNodeLabel(n))}}function cte(e,t){if(1&e){const n=yl();Be(0,"div",15)(1,"button",16),xi("click",function(){return q(n),te(ui().addChild())}),vt(2," \u2795 Add Child "),We(),Be(3,"button",17),xi("click",function(){return q(n),te(ui().deleteNode())}),vt(4," \u{1f5d1}\ufe0f Delete "),We()()}}function ute(e,t){if(1&e){const n=yl();Be(0,"div",18)(1,"div",19)(2,"label"),vt(3,"ID"),We(),Be(4,"input",20),Ud("ngModelChange",function(s){q(n);const c=ui();return ip(c.selectedNode.id,s)||(c.selectedNode.id=s),te(s)}),We()(),Be(5,"div",19)(6,"label"),vt(7,"Question"),We(),Be(8,"textarea",21),Ud("ngModelChange",function(s){q(n);const c=ui();return ip(c.selectedNode.question,s)||(c.selectedNode.question=s),te(s)}),We()(),Be(9,"div",19)(10,"label"),vt(11,"Answer (for buttons)"),We(),Be(12,"input",22),Ud("ngModelChange",function(s){q(n);const c=ui();return ip(c.selectedNode.answer,s)||(c.selectedNode.answer=s),te(s)}),We()(),Be(13,"div",19)(14,"label"),vt(15,"Denomination (final result)"),We(),Be(16,"input",23),Ud("ngModelChange",function(s){q(n);const c=ui();return ip(c.selectedNode.denomination,s)||(c.selectedNode.denomination=s),te(s)}),We()(),Be(17,"div",19)(18,"label"),vt(19,"Color (hex code)"),We(),Be(20,"div",24)(21,"input",25),Ud("ngModelChange",function(s){q(n);const c=ui();return ip(c.selectedNode.color,s)||(c.selectedNode.color=s),te(s)}),We(),Be(22,"input",26),Ud("ngModelChange",function(s){q(n);const c=ui();return ip(c.selectedNode.color,s)||(c.selectedNode.color=s),te(s)}),We()()(),Be(23,"div",19)(24,"label"),vt(25,"Result Text (displayed in card)"),We(),Be(26,"textarea",27),Ud("ngModelChange",function(s){q(n);const c=ui();return ip(c.selectedNode.result,s)||(c.selectedNode.result=s),te(s)}),We()()()}if(2&e){const n=ui();Xt(4),jd("ngModel",n.selectedNode.id),Xt(4),jd("ngModel",n.selectedNode.question),Xt(4),jd("ngModel",n.selectedNode.answer),Xt(4),jd("ngModel",n.selectedNode.denomination),Xt(5),jd("ngModel",n.selectedNode.color),Xt(),jd("ngModel",n.selectedNode.color),Xt(4),jd("ngModel",n.selectedNode.result)}}function hte(e,t){1&e&&(Be(0,"div",28)(1,"p",29),vt(2,"\u{1f448} Click a node in the tree to start editing"),We()())}let dte=(()=>{class e{treeData=null;flattenedNodes=[];selectedNode=null;ngOnInit(){this.loadTreeData()}loadTreeData(){var n=this;return Pe(function*(){try{const i=yield fetch("./tree-data.json");n.treeData=yield i.json(),n.updateFlattenedNodes()}catch(i){console.error("Failed to load tree data:",i)}})()}updateFlattenedNodes(){this.flattenedNodes=[],this.treeData&&this.flattenNode(this.treeData,0)}flattenNode(n,i){n.level=i,n.expanded=n.expanded??!0,this.flattenedNodes.push(n),n.expanded&&n.children&&n.children.forEach(s=>this.flattenNode(s,i+1))}toggleExpand(n){n.expanded=!n.expanded,this.updateFlattenedNodes()}selectNode(n){this.selectedNode=n}getNodeLabel(n){return n.denomination?`\u{1f535} ${n.denomination}`:n.question?`\u2753 ${n.question.substring(0,50)}${n.question.length>50?"...":""}`:n.answer?`\u27a1\ufe0f ${n.answer}`:n.id}hasChildren(n){return!!n.children&&n.children.length>0}saveChanges(){console.log("Saving tree data:",JSON.stringify(this.treeData,null,2));const n=new Blob([JSON.stringify(this.treeData,null,2)],{type:"application/json"}),i=URL.createObjectURL(n),s=document.createElement("a");s.href=i,s.download="tree-data.json",s.click(),URL.revokeObjectURL(i)}addChild(){if(!this.selectedNode)return;const n={id:`new-${Date.now()}`,question:"New Question",result:"New result text",children:[]};this.selectedNode.children||(this.selectedNode.children=[]),this.selectedNode.children.push(n),this.selectedNode.expanded=!0,this.updateFlattenedNodes()}deleteNode(){if(this.selectedNode&&this.treeData){if(this.selectedNode===this.treeData)return void alert("Cannot delete root node");this.deleteNodeRecursive(this.treeData,this.selectedNode),this.selectedNode=null,this.updateFlattenedNodes()}}deleteNodeRecursive(n,i){if(n.children){const s=n.children.indexOf(i);if(-1!==s)return n.children.splice(s,1),!0;for(const c of n.children)if(this.deleteNodeRecursive(c,i))return!0}return!1}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=_l({type:e,selectors:[["app-tree-editor"]],decls:16,vars:5,consts:[[1,"tree-editor-container"],[1,"tree-panel"],[1,"panel-header"],[1,"text-xl","font-bold","text-white","mb-4"],[1,"save-btn",3,"click"],[1,"tree-view"],["class","tree-node",3,"selected","padding-left","click",4,"ngFor","ngForOf"],[1,"editor-panel"],["class","action-buttons",4,"ngIf"],["class","editor-form",4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"tree-node",3,"click"],["class","expand-icon",3,"click",4,"ngIf"],[1,"node-label"],[1,"expand-icon",3,"click"],[1,"action-buttons"],[1,"action-btn","add-btn",3,"click"],[1,"action-btn","delete-btn",3,"click"],[1,"editor-form"],[1,"form-group"],["type","text",1,"form-input",3,"ngModelChange","ngModel"],["rows","3","placeholder","Enter question text...",1,"form-textarea",3,"ngModelChange","ngModel"],["type","text","placeholder","e.g., Yes, No, etc.",1,"form-input",3,"ngModelChange","ngModel"],["type","text","placeholder","e.g., Catholic, Baptist, etc.",1,"form-input",3,"ngModelChange","ngModel"],[1,"color-input-group"],["type","text","placeholder","#FFD700",1,"form-input",3,"ngModelChange","ngModel"],["type","color",1,"color-picker",3,"ngModelChange","ngModel"],["rows","8","placeholder","Enter the explanatory text that will be shown when this node is reached...",1,"form-textarea",3,"ngModelChange","ngModel"],[1,"empty-state"],[1,"text-slate-400","text-center"]],template:function(i,s){1&i&&(Be(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),vt(4,"Tree Structure"),We(),Be(5,"button",4),xi("click",function(){return s.saveChanges()}),vt(6," \u{1f4be} Save & Download "),We()(),Be(7,"div",5),ws(8,lte,4,6,"div",6),We()(),Be(9,"div",7)(10,"div",2)(11,"h2",3),vt(12),We(),ws(13,cte,5,0,"div",8),We(),ws(14,ute,27,7,"div",9)(15,hte,3,0,"div",10),We()()),2&i&&(Xt(8),Mi("ngForOf",s.flattenedNodes),Xt(4),Ju(" ",s.selectedNode?"Edit Node":"Select a node to edit"," "),Xt(),Mi("ngIf",s.selectedNode),Xt(),Mi("ngIf",s.selectedNode),Xt(),Mi("ngIf",!s.selectedNode))},dependencies:[zm,b0,Nm,ste,Aw,CN,t2],styles:[".tree-editor-container[_ngcontent-%COMP%]{display:flex;height:100vh;background:linear-gradient(135deg,#0f172a,#581c87,#0f172a);color:#fff}.tree-panel[_ngcontent-%COMP%]{flex:0 0 400px;border-right:2px solid #a855f7;overflow-y:auto;padding:20px;background:#0f172a80}.editor-panel[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:20px}.panel-header[_ngcontent-%COMP%]{margin-bottom:20px}.save-btn[_ngcontent-%COMP%]{background:#22c55e;color:#fff;padding:10px 20px;border-radius:8px;border:none;font-weight:600;cursor:pointer;transition:all .2s}.save-btn[_ngcontent-%COMP%]:hover{background:#16a34a;transform:translateY(-2px);box-shadow:0 4px 12px #22c55e4d}.tree-view[_ngcontent-%COMP%]{font-family:Courier New,monospace}.tree-node[_ngcontent-%COMP%]{padding:8px 10px;cursor:pointer;border-radius:4px;margin-bottom:2px;transition:all .2s;display:flex;align-items:center;gap:8px}.tree-node[_ngcontent-%COMP%]:hover{background:#a855f733}.tree-node.selected[_ngcontent-%COMP%]{background:#a855f766;border-left:4px solid #a855f7}.expand-icon[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;width:16px;display:inline-block;text-align:center}.node-label[_ngcontent-%COMP%]{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:10px}.action-btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;border:none;font-weight:500;cursor:pointer;transition:all .2s}.add-btn[_ngcontent-%COMP%]{background:#3b82f6;color:#fff}.add-btn[_ngcontent-%COMP%]:hover{background:#2563eb;transform:translateY(-1px)}.delete-btn[_ngcontent-%COMP%]{background:#ef4444;color:#fff}.delete-btn[_ngcontent-%COMP%]:hover{background:#dc2626;transform:translateY(-1px)}.editor-form[_ngcontent-%COMP%]{background:#1e293b99;padding:24px;border-radius:12px;border:1px solid rgba(168,85,247,.3)}.form-group[_ngcontent-%COMP%]{margin-bottom:20px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;font-weight:600;color:#e2e8f0;font-size:14px}.form-input[_ngcontent-%COMP%]{width:100%;padding:10px 12px;border-radius:6px;border:1px solid #475569;background:#0f172acc;color:#fff;font-size:14px;transition:all .2s}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#a855f7;box-shadow:0 0 0 3px #a855f71a}.form-textarea[_ngcontent-%COMP%]{width:100%;padding:10px 12px;border-radius:6px;border:1px solid #475569;background:#0f172acc;color:#fff;font-size:14px;font-family:inherit;resize:vertical;transition:all .2s}.form-textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#a855f7;box-shadow:0 0 0 3px #a855f71a}.color-input-group[_ngcontent-%COMP%]{display:flex;gap:10px}.color-picker[_ngcontent-%COMP%]{width:60px;height:40px;border:1px solid #475569;border-radius:6px;cursor:pointer;background:transparent}.empty-state[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:400px}"]})}return e})();var fte=et(44),o2=et.n(fte),pte=et(17);const mte=["mapContainer"];let gte=(()=>{class e{mapData;mapContainer;map=null;markers=[];arrowLayersAdded=!1;activeFilter="all";expandedFilter=null;getDefaultIcon(n){return{persecution:"fas fa-skull-crossbones",author:"fas fa-pen-fancy",audience:"fas fa-users",trial:"fas fa-fire","notable-event":"fas fa-fire"}[n]||"fas fa-map-pin"}toggleExpand(n,i){i.stopPropagation(),this.expandedFilter=this.expandedFilter===n?null:n}filterMarkers(n){if(this.activeFilter=n,this.markers.forEach(({element:i,type:s})=>{"all"===n||s===n?i.classList.remove("hidden"):i.classList.add("hidden")}),this.map&&this.arrowLayersAdded){const i="all"===n||"audience"===n?"visible":"none";this.map.setLayoutProperty("diaspora-arrows-line","visibility",i),this.map.setLayoutProperty("diaspora-arrows-arrows","visibility",i)}}ngAfterViewInit(){this.renderMap()}ngOnChanges(n){n.mapData&&this.map&&this.renderMap()}renderMap(){this.map&&this.map.remove();const n=this.mapData?.center||[10,45],i=this.mapData?.zoom||4;this.map=new(o2().Map)({container:"map",style:"https://www.openhistoricalmap.org/map-styles/woodblock/woodblock.json",attributionControl:{customAttribution:'<a href="https://www.openhistoricalmap.org/">OpenHistoricalMap</a>'},center:[n[1],n[0]],zoom:i}),this.map.once("styledata",s=>{(0,pte.filterByDate)(this.map,"050-01-01"),this.markers.forEach(c=>c.marker.remove()),this.markers=[],this.mapData?.markers&&this.mapData.markers.forEach(c=>{const d=c.type||"church",_=c.icon||this.getDefaultIcon(d),x=document.createElement("div");x.className=`custom-marker marker-${d}`,x.innerHTML=`<i class="${_}"></i>`,x.setAttribute("data-type",d);const E=new(o2().Marker)({element:x}).setLngLat([c.lng,c.lat]).setPopup(new(o2().Popup)({offset:25,closeButton:!0}).setHTML(`<div class="popup-header">\n                  <i class="${_}"></i>\n                  <span>${c.label||""}</span>\n                </div>\n                <div class="popup-body">\n                  ${c.description||""}\n                </div>`)).addTo(this.map);this.markers.push({marker:E,type:d,element:x})}),this.mapData?.arrows&&(this.map.addSource("diaspora-arrows",{type:"geojson",data:{type:"FeatureCollection",features:this.mapData.arrows.map((c,d)=>({type:"Feature",properties:{label:c.label||"",color:c.color||"#8b5cf6"},geometry:{type:"LineString",coordinates:[[c.from[1],c.from[0]],[c.to[1],c.to[0]]]}}))}}),this.map.addLayer({id:"diaspora-arrows-line",type:"line",source:"diaspora-arrows",layout:{"line-join":"round","line-cap":"round",visibility:"none"},paint:{"line-color":["get","color"],"line-width":2,"line-opacity":.6,"line-dasharray":[2,2]}}),this.map.addLayer({id:"diaspora-arrows-arrows",type:"symbol",source:"diaspora-arrows",layout:{"symbol-placement":"line","symbol-spacing":1,"icon-image":"triangle-11","icon-size":.5,"icon-rotate":90,visibility:"none"},paint:{"icon-color":["get","color"],"icon-opacity":.6}}),this.arrowLayersAdded=!0)})}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=_l({type:e,selectors:[["app-map-view"]],viewQuery:function(i,s){if(1&i&&np(mte,5),2&i){let c;zd(c=Bd())&&(s.mapContainer=c.first)}},inputs:{mapData:"mapData"},features:[Js],decls:37,vars:24,consts:[[1,"w-full","h-full","relative"],["id","map",1,"w-full","h-full"],[1,"map-filter-overlay"],[1,"filter-header"],[1,"filter-item"],[1,"filter-button",3,"click"],[1,"fas","fa-layer-group"],[1,"fas","fa-chevron-down","chevron-icon",3,"click"],[1,"filter-description"],[1,"fas","fa-pen-fancy"],[1,"fas","fa-users"],[1,"fas","fa-fire"]],template:function(i,s){1&i&&(Be(0,"div",0),pn(1,"div",1),Be(2,"div",2)(3,"div",3),vt(4,"Explore the Context"),We(),Be(5,"div",4)(6,"button",5),xi("click",function(){return s.filterMarkers("all")}),pn(7,"i",6),Be(8,"span"),vt(9,"Show All"),We(),Be(10,"i",7),xi("click",function(d){return s.toggleExpand("all",d)}),We()(),Be(11,"div",8),vt(12," View all markers showing the complete historical context of James's letter. "),We()(),Be(13,"div",4)(14,"button",5),xi("click",function(){return s.filterMarkers("author")}),pn(15,"i",9),Be(16,"span"),vt(17,"Who wrote the letter?"),We(),Be(18,"i",7),xi("click",function(d){return s.toggleExpand("author",d)}),We()(),Be(19,"div",8),vt(20,' James, Jesus\'s half-brother, led the Jerusalem church. Known as "James the Just" for his exceptional holiness, he likely wrote this letter around 45-49 AD - making it possibly the earliest New Testament book. He was eventually martyred by stoning in 62 AD. '),We()(),Be(21,"div",4)(22,"button",5),xi("click",function(){return s.filterMarkers("audience")}),pn(23,"i",10),Be(24,"span"),vt(25,"Who was the audience?"),We(),Be(26,"i",7),xi("click",function(d){return s.toggleExpand("audience",d)}),We()(),Be(27,"div",8),vt(28,' "The twelve tribes scattered abroad" - Jewish believers who fled persecution after Stephen\'s death. By the first century, more Jews lived outside Palestine than within it. These diaspora communities maintained their Jewish identity while following Jesus as Messiah, facing hostility from both Jews and Gentiles. '),We()(),Be(29,"div",4)(30,"button",5),xi("click",function(){return s.filterMarkers("notable-event")}),pn(31,"i",11),Be(32,"span"),vt(33,"Notable Events & Trials"),We(),Be(34,"i",7),xi("click",function(d){return s.toggleExpand("notable-event",d)}),We()(),Be(35,"div",8),vt(36," From Stephen's martyrdom to economic hardship, social ostracism, and persecution across the Empire - these trials tested their faith. James wrote to encourage them to see suffering not as punishment, but as an opportunity for spiritual growth and maturity. "),We()()()()),2&i&&(Xt(6),Tr("active","all"===s.activeFilter),Xt(4),Tr("rotated","all"===s.expandedFilter),Xt(),Tr("expanded","all"===s.expandedFilter),Xt(3),Tr("active","author"===s.activeFilter),Xt(4),Tr("rotated","author"===s.expandedFilter),Xt(),Tr("expanded","author"===s.expandedFilter),Xt(3),Tr("active","audience"===s.activeFilter),Xt(4),Tr("rotated","audience"===s.expandedFilter),Xt(),Tr("expanded","audience"===s.expandedFilter),Xt(3),Tr("active","notable-event"===s.activeFilter),Xt(4),Tr("rotated","notable-event"===s.expandedFilter),Xt(),Tr("expanded","notable-event"===s.expandedFilter))},dependencies:[zm],styles:[".map-view[_ngcontent-%COMP%]{background:#f3f4f6;border-radius:1rem;padding:1.5rem;box-shadow:0 2px 8px #0000000f}.map-title[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;color:#312e81;margin-bottom:1rem}.map-container[_ngcontent-%COMP%]{background:#e0e7ff;border-radius:.75rem;padding:1rem}.map-placeholder[_ngcontent-%COMP%]{color:#334155;font-size:1rem}.map-empty[_ngcontent-%COMP%]{color:#64748b;font-style:italic}[_nghost-%COMP%]     .custom-marker{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px #0000004d;cursor:pointer;transition:transform .2s;border:2px solid white}[_nghost-%COMP%]     .custom-marker:hover{transform:scale(1.15)}[_nghost-%COMP%]     .marker-author{background:linear-gradient(135deg,#8b5cf6,#7c3aed)}[_nghost-%COMP%]     .marker-audience{background:linear-gradient(135deg,#3b82f6,#2563eb)}[_nghost-%COMP%]     .marker-notable-event{background:linear-gradient(135deg,#f59e0b,#d97706)}[_nghost-%COMP%]     .custom-marker i{color:#fff;font-size:16px}[_nghost-%COMP%]     .maplibregl-popup-content{padding:0;border-radius:12px;box-shadow:0 8px 24px #00000040;background:linear-gradient(135deg,#fff,#f8f9fa);border:1px solid rgba(255,255,255,.8);min-width:220px;max-width:300px}[_nghost-%COMP%]     .popup-header{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:12px 16px;border-radius:12px 12px 0 0;font-weight:600;font-size:14px;display:flex;align-items:center;gap:8px}[_nghost-%COMP%]     .popup-header i{font-size:16px}[_nghost-%COMP%]     .popup-body{padding:12px 16px;color:#1f2937;font-size:13px;line-height:1.5}[_nghost-%COMP%]     .maplibregl-popup-close-button{font-size:20px;color:#fff;padding:8px;right:4px;top:4px}[_nghost-%COMP%]     .maplibregl-popup-close-button:hover{background:#fff3;border-radius:4px}[_nghost-%COMP%]     .maplibregl-popup-tip{border-top-color:#f8f9fa}.map-filter-overlay[_ngcontent-%COMP%]{position:absolute;top:16px;right:16px;background:#fffffff2;backdrop-filter:blur(10px);border-radius:12px;padding:16px;box-shadow:0 8px 24px #00000026;z-index:1000;width:360px;max-width:calc(100vw - 32px);border:1px solid rgba(255,255,255,.8)}.filter-header[_ngcontent-%COMP%]{font-weight:700;font-size:14px;color:#1f2937;margin-bottom:12px;padding-bottom:8px;border-bottom:2px solid #e5e7eb;text-transform:uppercase;letter-spacing:.5px}.filter-button[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;width:100%;padding:10px 12px;margin-bottom:0;border:2px solid #e5e7eb;border-radius:8px;background:#fff;cursor:pointer;transition:all .2s ease;font-size:13px;color:#4b5563;font-weight:500;position:relative}.filter-item[_ngcontent-%COMP%]{margin-bottom:8px}.filter-description[_ngcontent-%COMP%]{font-size:11px;color:#6b7280;margin:0;padding:0 12px;line-height:1.4;background:#f9fafb;border-left:2px solid #e5e7eb;border-right:2px solid #e5e7eb;border-bottom:2px solid #e5e7eb;border-radius:0 0 8px 8px;max-height:0;overflow:hidden;transition:all .3s ease;opacity:0}.filter-description.expanded[_ngcontent-%COMP%]{max-height:100px;padding:8px 12px;opacity:1}.chevron-icon[_ngcontent-%COMP%]{font-size:12px;margin-left:auto;transition:transform .3s ease;color:#9ca3af}.chevron-icon.rotated[_ngcontent-%COMP%]{transform:rotate(180deg)}.filter-button[_ngcontent-%COMP%]:hover{border-color:#667eea;background:#f9fafb;transform:translate(-2px)}.filter-button.active[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-color:#667eea;box-shadow:0 4px 12px #667eea4d}.filter-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px;width:20px;text-align:center}.filter-button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{flex:1;text-align:left}.filter-button[_ngcontent-%COMP%]:last-child{margin-bottom:0}[_nghost-%COMP%]     .custom-marker.hidden{display:none}"]})}return e})(),tz=(()=>{class e{http;API_BASE_URL="https://bible-api.com";cache=new Map;loadingSubject=new kn(!1);loading$=this.loadingSubject.asObservable();constructor(n){this.http=n}getVerses(n){const i=n.toLowerCase().trim();if(this.cache.has(i))return Pi(this.cache.get(i));this.loadingSubject.next(!0);const s=encodeURIComponent(n);return this.http.get(`${this.API_BASE_URL}/${s}`).pipe(qa(c=>{this.cache.set(i,c),this.loadingSubject.next(!1)}),Pm(c=>(console.error(`Error fetching Bible verse: ${n}`,c),this.loadingSubject.next(!1),Pi(null))))}getMultipleVerses(n){const i={},s=n.map(c=>this.getVerses(c).pipe(Si(d=>({reference:c,verse:d}))));return new di(c=>{let d=0;s.forEach(_=>{_.subscribe(x=>{i[x.reference]=x.verse,d++,d===n.length&&(c.next(i),c.complete())})})})}parseVerseReference(n){const s=n.replace(/^v\.?\s*/,"").trim().match(/(?:(\w+)\s+)?(\d+):(\d+)(?:-(\d+))?/);if(s){const[,c,d,_,x]=s;return{book:c||"james",startChapter:parseInt(d),startVerse:parseInt(_),endVerse:x?parseInt(x):void 0}}return null}formatForAPI(n){const{book:i,startChapter:s,startVerse:c,endVerse:d}=n;return d?`${i} ${s}:${c}-${d}`:`${i} ${s}:${c}`}getFormattedVerseText(n){return n&&n.verses?n.verses.map(i=>`<sup>${i.verse}</sup>${i.text}`).join(" "):""}clearCache(){this.cache.clear()}preloadJamesVerses(){this.getMultipleVerses(["james 1:2-4","james 1:5-8","james 1:9-11","james 1:12-15","james 1:16-18"]).subscribe(i=>{console.log("Pre-loaded James verses:",Object.keys(i).length)})}static \u0275fac=function(i){return new(i||e)(Jn(L1))};static \u0275prov=an({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const _te=["clusterContainer"];function yte(e,t){if(1&e&&(Be(0,"div",27),vt(1),We()),2&e){const n=ui().$implicit,i=ui(2);Xt(),wo(i.getPromptLabel(n.type).subtext)}}function vte(e,t){if(1&e){const n=yl();Be(0,"div",19),xi("click",function(){const s=q(n).index;return te(ui(2).toggleCard(s))}),Be(1,"div",20)(2,"div",21)(3,"div",22),pn(4,"i",23),Be(5,"div",24)(6,"div",25),vt(7),We(),ws(8,yte,2,1,"div",26),We()()()()()}if(2&e){const n=t.$implicit,i=ui(2);Xt(2),Xu("data-type",n.type),Xt(2),Mi("ngClass",i.getPromptIcon(n.type)),Xt(3),wo(i.getPromptLabel(n.type).label),Xt(),Mi("ngIf",i.getPromptLabel(n.type).subtext)}}function bte(e,t){if(1&e&&(Be(0,"div",16)(1,"div",17),ws(2,vte,9,4,"div",18),We()()),2&e){const n=ui();Xt(2),Mi("ngForOf",n.getCurrentNodePrompts())}}function xte(e,t){if(1&e&&(Be(0,"p",36),vt(1),We()),2&e){const n=ui(2);Xt(),Ju(" ",n.getPromptLabel(n.getCurrentNodePrompts()[n.modalCardIndex].type).subtext," ")}}function wte(e,t){if(1&e){const n=yl();Be(0,"div",28),xi("click",function(){return q(n),te(ui().closeModal())}),Be(1,"div",29),xi("click",function(s){return q(n),te(s.stopPropagation())}),Be(2,"button",30),xi("click",function(){return q(n),te(ui().closeModal())}),vt(3,"\xd7"),We(),Be(4,"div",31),pn(5,"i",32),Be(6,"div")(7,"h3",33),vt(8),We(),ws(9,xte,2,1,"p",34),We()(),Be(10,"div",35),vt(11),We()()()}if(2&e){const n=ui();Xt(5),Mi("ngClass",n.getPromptIcon(n.getCurrentNodePrompts()[n.modalCardIndex].type)+" "+n.getCurrentNodePrompts()[n.modalCardIndex].type),Xt(2),Mi("ngClass",n.getCurrentNodePrompts()[n.modalCardIndex].type),Xt(),Ju(" ",n.getPromptLabel(n.getCurrentNodePrompts()[n.modalCardIndex].type).label," "),Xt(),Mi("ngIf",n.getPromptLabel(n.getCurrentNodePrompts()[n.modalCardIndex].type).subtext),Xt(2),Ju(" ",n.getCurrentNodePrompts()[n.modalCardIndex].text," ")}}let Cte=(()=>{class e{bibleService;clusterData;clusterContainer;constructor(n){this.bibleService=n}svg;width=1200;height=800;simulation;nodeRadius=60;sectionColors={};isGuidedMode=!0;currentStep=0;verseCache=new Map;isLoadingVerses=!1;verseLoadError=!1;flippedCards=new Set;modalCardIndex=null;getSectionGradient(n){return this.sectionColors[n]||(this.sectionColors=this.clusterData?.defaultColors||this.getDefaultColors()),this.sectionColors[n]||["#8b5cf6","#6d28d9"]}ngAfterViewInit(){this.renderCluster(),this.loadVerseContent()}ngOnChanges(n){n.clusterData&&this.svg&&(this.loadVerseContent(),this.renderCluster())}renderCluster(){if(Ui("#cluster-viz").selectAll("*").remove(),!this.clusterData||!this.clusterData.nodes)return;this.clusterData.layout&&(this.width=this.clusterData.layout.width||this.width,this.height=this.clusterData.layout.height||this.height,this.nodeRadius=this.clusterData.layout.nodeRadius||this.nodeRadius),this.sectionColors=this.clusterData.defaultColors||this.getDefaultColors(),this.svg=Ui("#cluster-viz").attr("width","100%").attr("height","100%").attr("viewBox",[0,0,this.width,this.height]).attr("preserveAspectRatio","xMidYMid meet");const n=this.svg.append("defs");Object.entries(this.sectionColors).forEach(([J,se])=>{const le=n.append("linearGradient").attr("id",`gradient-${J}`).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","100%");le.append("stop").attr("offset","0%").attr("stop-color",se[0]),le.append("stop").attr("offset","100%").attr("stop-color",se[1])});const s=.8*this.width/(this.clusterData.nodes.length-1||1),c=.1*this.width,d=this.clusterData.nodes.map((J,se)=>({...J,x:c+se*s,y:this.height/2,fx:c+se*s,fy:null})),_=[];for(let J=0;J<d.length-1;J++)_.push({source:d[J],target:d[J+1]});const x=this.clusterData.layout?.linkDistance||150,E=this.clusterData.layout?.chargeStrength||-500;this.simulation=function wX(e){var t,n=1,i=.001,s=1-Math.pow(i,1/300),c=0,d=.6,_=new Map,x=$M(z),E=Y1("tick","end"),R=function _X(){let e=1;return()=>(e=(1664525*e+1013904223)%eF)/eF}();function z(){V(),E.call("tick",t),n<i&&(x.stop(),E.call("end",t))}function V(se){var le,ae,de=e.length;void 0===se&&(se=1);for(var ze=0;ze<se;++ze)for(n+=(c-n)*s,_.forEach(function(Se){Se(n)}),le=0;le<de;++le)null==(ae=e[le]).fx?ae.x+=ae.vx*=d:(ae.x=ae.fx,ae.vx=0),null==ae.fy?ae.y+=ae.vy*=d:(ae.y=ae.fy,ae.vy=0);return t}function j(){for(var de,se=0,le=e.length;se<le;++se){if((de=e[se]).index=se,null!=de.fx&&(de.x=de.fx),null!=de.fy&&(de.y=de.fy),isNaN(de.x)||isNaN(de.y)){var ae=10*Math.sqrt(.5+se),ze=se*xX;de.x=ae*Math.cos(ze),de.y=ae*Math.sin(ze)}(isNaN(de.vx)||isNaN(de.vy))&&(de.vx=de.vy=0)}}function J(se){return se.initialize&&se.initialize(e,R),se}return null==e&&(e=[]),j(),t={tick:V,restart:function(){return x.restart(z),t},stop:function(){return x.stop(),t},nodes:function(se){return arguments.length?(e=se,j(),_.forEach(J),t):e},alpha:function(se){return arguments.length?(n=+se,t):n},alphaMin:function(se){return arguments.length?(i=+se,t):i},alphaDecay:function(se){return arguments.length?(s=+se,t):+s},alphaTarget:function(se){return arguments.length?(c=+se,t):c},velocityDecay:function(se){return arguments.length?(d=1-se,t):1-d},randomSource:function(se){return arguments.length?(R=se,_.forEach(J),t):R},force:function(se,le){return arguments.length>1?(null==le?_.delete(se):_.set(se,J(le)),t):_.get(se)},find:function(se,le,de){var Se,ut,Nt,en,fn,ae=0,ze=e.length;for(null==de?de=1/0:de*=de,ae=0;ae<ze;++ae)(Nt=(Se=se-(en=e[ae]).x)*Se+(ut=le-en.y)*ut)<de&&(fn=en,de=Nt);return fn},on:function(se,le){return arguments.length>1?(E.on(se,le),t):E.on(se)}}}(d).force("link",function pX(e){var i,c,d,_,x,E,t=fX,n=function z(le){return 1/Math.min(_[le.source.index],_[le.target.index])},s=Um(30),R=1;function V(le){for(var de=0,ae=e.length;de<R;++de)for(var Se,ut,Nt,en,fn,Gn,At,ze=0;ze<ae;++ze)en=(Nt=(Se=e[ze]).target).x+Nt.vx-(ut=Se.source).x-ut.vx||pp(E),fn=Nt.y+Nt.vy-ut.y-ut.vy||pp(E),fn*=Gn=((Gn=Math.sqrt(en*en+fn*fn))-c[ze])/Gn*le*i[ze],Nt.vx-=(en*=Gn)*(At=x[ze]),Nt.vy-=fn*At,ut.vx+=en*(At=1-At),ut.vy+=fn*At}function j(){if(d){var le,Se,de=d.length,ae=e.length,ze=new Map(d.map((ut,Nt)=>[t(ut,Nt,d),ut]));for(le=0,_=new Array(de);le<ae;++le)(Se=e[le]).index=le,"object"!=typeof Se.source&&(Se.source=JO(ze,Se.source)),"object"!=typeof Se.target&&(Se.target=JO(ze,Se.target)),_[Se.source.index]=(_[Se.source.index]||0)+1,_[Se.target.index]=(_[Se.target.index]||0)+1;for(le=0,x=new Array(ae);le<ae;++le)x[le]=_[(Se=e[le]).source.index]/(_[Se.source.index]+_[Se.target.index]);i=new Array(ae),J(),c=new Array(ae),se()}}function J(){if(d)for(var le=0,de=e.length;le<de;++le)i[le]=+n(e[le],le,e)}function se(){if(d)for(var le=0,de=e.length;le<de;++le)c[le]=+s(e[le],le,e)}return null==e&&(e=[]),V.initialize=function(le,de){d=le,E=de,j()},V.links=function(le){return arguments.length?(e=le,j(),V):e},V.id=function(le){return arguments.length?(t=le,V):t},V.iterations=function(le){return arguments.length?(R=+le,V):R},V.strength=function(le){return arguments.length?(n="function"==typeof le?le:Um(+le),J(),V):n},V.distance=function(le){return arguments.length?(s="function"==typeof le?le:Um(+le),se(),V):s},V}(_).distance(x).strength(.5)).force("charge",function CX(){var e,t,n,i,c,s=Um(-30),d=1,_=1/0,x=.81;function E(j){var J,se=e.length,le=sE(e,yX,vX).visitAfter(z);for(i=j,J=0;J<se;++J)t=e[J],le.visit(V)}function R(){if(e){var j,se,J=e.length;for(c=new Array(J),j=0;j<J;++j)c[(se=e[j]).index]=+s(se,j,e)}}function z(j){var se,le,ae,ze,Se,J=0,de=0;if(j.length){for(ae=ze=Se=0;Se<4;++Se)(se=j[Se])&&(le=Math.abs(se.value))&&(J+=se.value,de+=le,ae+=le*se.x,ze+=le*se.y);j.x=ae/de,j.y=ze/de}else{(se=j).x=se.data.x,se.y=se.data.y;do{J+=c[se.data.index]}while(se=se.next)}j.value=J}function V(j,J,se,le){if(!j.value)return!0;var de=j.x-t.x,ae=j.y-t.y,ze=le-J,Se=de*de+ae*ae;if(ze*ze/x<Se)return Se<_&&(0===de&&(Se+=(de=pp(n))*de),0===ae&&(Se+=(ae=pp(n))*ae),Se<d&&(Se=Math.sqrt(d*Se)),t.vx+=de*j.value*i/Se,t.vy+=ae*j.value*i/Se),!0;if(!(j.length||Se>=_)){(j.data!==t||j.next)&&(0===de&&(Se+=(de=pp(n))*de),0===ae&&(Se+=(ae=pp(n))*ae),Se<d&&(Se=Math.sqrt(d*Se)));do{j.data!==t&&(t.vx+=de*(ze=c[j.data.index]*i/Se),t.vy+=ae*ze)}while(j=j.next)}}return E.initialize=function(j,J){e=j,n=J,R()},E.strength=function(j){return arguments.length?(s="function"==typeof j?j:Um(+j),R(),E):s},E.distanceMin=function(j){return arguments.length?(d=j*j,E):Math.sqrt(d)},E.distanceMax=function(j){return arguments.length?(_=j*j,E):Math.sqrt(_)},E.theta=function(j){return arguments.length?(x=j*j,E):Math.sqrt(x)},E}().strength(E)).force("center",function qY(e,t){var n,i=1;function s(){var c,_,d=n.length,x=0,E=0;for(c=0;c<d;++c)x+=(_=n[c]).x,E+=_.y;for(x=(x/d-e)*i,E=(E/d-t)*i,c=0;c<d;++c)(_=n[c]).x-=x,_.y-=E}return null==e&&(e=0),null==t&&(t=0),s.initialize=function(c){n=c},s.x=function(c){return arguments.length?(e=+c,s):e},s.y=function(c){return arguments.length?(t=+c,s):t},s.strength=function(c){return arguments.length?(i=+c,s):i},s}(this.width/2,this.height/2)).force("collision",function dX(e){var t,n,i,s=1,c=1;function d(){for(var E,z,V,j,J,se,le,R=t.length,de=0;de<c;++de)for(z=sE(t,uX,hX).visitAfter(_),E=0;E<R;++E)le=(se=n[(V=t[E]).index])*se,j=V.x+V.vx,J=V.y+V.vy,z.visit(ae);function ae(ze,Se,ut,Nt,en){var fn=ze.data,Gn=ze.r,At=se+Gn;if(!fn)return Se>j+At||Nt<j-At||ut>J+At||en<J-At;if(fn.index>V.index){var xn=j-fn.x-fn.vx,Fn=J-fn.y-fn.vy,un=xn*xn+Fn*Fn;un<At*At&&(0===xn&&(un+=(xn=pp(i))*xn),0===Fn&&(un+=(Fn=pp(i))*Fn),un=(At-(un=Math.sqrt(un)))/un*s,V.vx+=(xn*=un)*(At=(Gn*=Gn)/(le+Gn)),V.vy+=(Fn*=un)*At,fn.vx-=xn*(At=1-At),fn.vy-=Fn*At)}}}function _(E){if(E.data)return E.r=n[E.data.index];for(var R=E.r=0;R<4;++R)E[R]&&E[R].r>E.r&&(E.r=E[R].r)}function x(){if(t){var E,z,R=t.length;for(n=new Array(R),E=0;E<R;++E)n[(z=t[E]).index]=+e(z,E,t)}}return"function"!=typeof e&&(e=Um(null==e?1:+e)),d.initialize=function(E,R){t=E,i=R,x()},d.iterations=function(E){return arguments.length?(c=+E,d):c},d.strength=function(E){return arguments.length?(s=+E,d):s},d.radius=function(E){return arguments.length?(e="function"==typeof E?E:Um(+E),x(),d):e},d}().radius(this.nodeRadius+20));const R=this.svg.append("g").selectAll("line").data(_).join("line").attr("stroke","#64748b").attr("stroke-width",2).attr("stroke-dasharray","5,5").attr("opacity",.6),z=this.svg.append("g").selectAll("g").data(d).join("g").attr("cursor","pointer").call(this.drag(this.simulation));z.append("circle").attr("r",this.nodeRadius).attr("fill",J=>J.color?J.color:`url(#gradient-${J.section})`).attr("stroke","#fff").attr("stroke-width",3).style("filter","drop-shadow(0 4px 12px rgba(0,0,0,0.3))"),z.append("text").attr("text-anchor","middle").attr("dy",-5).attr("fill","#fff").attr("font-size","24px").attr("font-weight","bold").text(J=>J.section?`Section ${J.section}`:J.label),z.each(function(J){if(J.verses){const se=Ui(this);se.append("rect").attr("x",-40).attr("y",5).attr("width",80).attr("height",20).attr("rx",10).attr("fill","rgba(255, 255, 255, 0.2)").attr("stroke","rgba(255, 255, 255, 0.4)").attr("stroke-width",1),se.append("text").attr("text-anchor","middle").attr("dy",19).attr("fill","#fff").attr("font-size","11px").attr("font-weight","600").attr("letter-spacing","0.5px").text(J.verses)}});const V=this.nodeRadius,j=this.nodeRadius+10;z.each(function(J){const se=Ui(this);if(J.theme){const le=J.theme.split("\u2192")[0].trim();se.append("text").attr("text-anchor","middle").attr("dy",V+25).attr("fill","#e2e8f0").attr("font-size","13px").attr("font-weight","600").text(le)}else se.append("text").attr("text-anchor","middle").attr("dy",V+25).attr("fill","#e2e8f0").attr("font-size","13px").attr("font-weight","600").text(J.label)}),z.on("mouseenter",function(J,se){Ui(this).select("circle").transition().duration(200).attr("r",j);const le=Ui("#cluster-tooltip");let de="";se.section?(de=`<div class="flex items-center justify-between mb-3">\n          <div class="font-bold text-lg">Section ${se.section}: ${se.label}</div>`,se.verses&&(de+=`<div class="inline-flex items-center bg-purple-600/40 border border-purple-400/50 rounded px-2 py-1 ml-2">\n            <i class="fas fa-book-open text-purple-200 text-xs mr-1"></i>\n            <span class="text-xs font-medium text-purple-100">${se.verses}</span>\n          </div>`),de+="</div>"):(de=`<div class="flex items-center justify-between mb-3">\n          <div class="font-bold text-lg">${se.label}</div>`,se.verses&&(de+=`<div class="inline-flex items-center bg-purple-600/40 border border-purple-400/50 rounded px-2 py-1 ml-2">\n            <i class="fas fa-book-open text-purple-200 text-xs mr-1"></i>\n            <span class="text-xs font-medium text-purple-100">${se.verses}</span>\n          </div>`),de+="</div>"),de+=`<div class="text-sm leading-relaxed">${se.description}</div>`,se.keywords&&se.keywords.length>0&&(de+=`<div class="text-xs mt-3 pt-2 border-t border-purple-500/30 opacity-80">\n          <span class="text-purple-300">Keywords:</span> ${se.keywords.join(", ")}\n        </div>`),le.style("display","block").style("left",J.pageX+10+"px").style("top",J.pageY-10+"px").html(de)}).on("mouseleave",function(){Ui(this).select("circle").transition().duration(200).attr("r",V),Ui("#cluster-tooltip").style("display","none")}).on("click",(J,se)=>{this.isGuidedMode||this.showNodeDetails(se)}),this.simulation.on("tick",()=>{R.attr("x1",J=>J.source.x).attr("y1",J=>J.source.y).attr("x2",J=>J.target.x).attr("y2",J=>J.target.y),z.attr("transform",J=>`translate(${J.x},${J.y})`)})}drag(n){return function HY(){var _,x,E,R,e=jY,t=UY,n=$Y,i=GY,s={},c=Y1("start","drag","end"),d=0,z=0;function V(Se){Se.on("mousedown.drag",j).filter(i).on("touchstart.drag",le).on("touchmove.drag",de,VY).on("touchend.drag touchcancel.drag",ae).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function j(Se,ut){if(!R&&e.call(this,Se,ut)){var Nt=ze(this,t.call(this,Se,ut),Se,ut,"mouse");Nt&&(Ui(Se.view).on("mousemove.drag",J,A0).on("mouseup.drag",se,A0),YO(Se.view),rE(Se),E=!1,_=Se.clientX,x=Se.clientY,Nt("start",Se))}}function J(Se){if(U_(Se),!E){var ut=Se.clientX-_,Nt=Se.clientY-x;E=ut*ut+Nt*Nt>z}s.mouse("drag",Se)}function se(Se){Ui(Se.view).on("mousemove.drag mouseup.drag",null),XO(Se.view,E),U_(Se),s.mouse("end",Se)}function le(Se,ut){if(e.call(this,Se,ut)){var Gn,At,Nt=Se.changedTouches,en=t.call(this,Se,ut),fn=Nt.length;for(Gn=0;Gn<fn;++Gn)(At=ze(this,en,Se,ut,Nt[Gn].identifier,Nt[Gn]))&&(rE(Se),At("start",Se,Nt[Gn]))}}function de(Se){var en,fn,ut=Se.changedTouches,Nt=ut.length;for(en=0;en<Nt;++en)(fn=s[ut[en].identifier])&&(U_(Se),fn("drag",Se,ut[en]))}function ae(Se){var en,fn,ut=Se.changedTouches,Nt=ut.length;for(R&&clearTimeout(R),R=setTimeout(function(){R=null},500),en=0;en<Nt;++en)(fn=s[ut[en].identifier])&&(rE(Se),fn("end",Se,ut[en]))}function ze(Se,ut,Nt,en,fn,Gn){var Fn,un,tt,At=c.copy(),xn=Yd(Gn||Nt,ut);if(null!=(tt=n.call(Se,new oE("beforestart",{sourceEvent:Nt,target:V,identifier:fn,active:d,x:xn[0],y:xn[1],dx:0,dy:0,dispatch:At}),en)))return Fn=tt.x-xn[0]||0,un=tt.y-xn[1]||0,function _n(zt,cn,Yn){var En,Rn=xn;switch(zt){case"start":s[fn]=_n,En=d++;break;case"end":delete s[fn],--d;case"drag":xn=Yd(Yn||cn,ut),En=d}At.call(zt,Se,new oE(zt,{sourceEvent:cn,subject:tt,target:V,identifier:fn,active:En,x:xn[0]+Fn,y:xn[1]+un,dx:xn[0]-Rn[0],dy:xn[1]-Rn[1],dispatch:At}),en)}}return V.filter=function(Se){return arguments.length?(e="function"==typeof Se?Se:dw(!!Se),V):e},V.container=function(Se){return arguments.length?(t="function"==typeof Se?Se:dw(Se),V):t},V.subject=function(Se){return arguments.length?(n="function"==typeof Se?Se:dw(Se),V):n},V.touchable=function(Se){return arguments.length?(i="function"==typeof Se?Se:dw(!!Se),V):i},V.on=function(){var Se=c.on.apply(c,arguments);return Se===c?V:Se},V.clickDistance=function(Se){return arguments.length?(z=(Se=+Se)*Se,V):Math.sqrt(z)},V}().on("start",function i(d){d.active||n.alphaTarget(.3).restart(),d.subject.fx=d.subject.x,d.subject.fy=d.subject.y}).on("drag",function s(d){d.subject.fx=d.x,d.subject.fy=d.y}).on("end",function c(d){d.active||n.alphaTarget(0),d.subject.fx=null,d.subject.fy=null})}getCurrentVerse(){return!this.clusterData?.nodes||this.currentStep>=this.clusterData.nodes.length?"":this.clusterData.nodes[this.currentStep].verses||""}loadVerseContent(){if(!this.clusterData?.nodes)return;this.isLoadingVerses=!0;const n=this.clusterData.nodes.filter(i=>i.verseReference).map(i=>i.verseReference);0!==n.length?this.bibleService.getMultipleVerses(n).subscribe({next:i=>{if(this.clusterData.nodes.forEach(c=>{if(c.verseReference&&i[c.verseReference]){const d=i[c.verseReference];d&&(c.verseText=this.bibleService.getFormattedVerseText(d),this.verseCache.set(c.verseReference,c.verseText))}}),this.isLoadingVerses=!1,this.renderCluster(),this.isGuidedMode&&0===this.currentStep&&setTimeout(()=>this.showGuidedStep(0),200),!Ui("#detail-panel").classed("hidden")){const c=this.clusterData.nodes[this.currentStep];c&&this.showNodeDetails(c)}},error:i=>{console.error("Failed to load verse content:",i),this.isLoadingVerses=!1,this.verseLoadError=!0,this.showVerseLoadError()}}):this.isLoadingVerses=!1}getVerseText(n){return n.verseText?n.verseText:n.verseReference&&this.verseCache.has(n.verseReference)?this.verseCache.get(n.verseReference):n.description}showVerseLoadError(){console.warn("Unable to load Bible verses. Check your internet connection.")}retryLoadVerses(){this.verseLoadError=!1,this.verseCache.clear(),this.loadVerseContent()}toggleMode(){this.isGuidedMode=!this.isGuidedMode,this.flippedCards.clear(),this.isGuidedMode?(this.currentStep=0,!this.isLoadingVerses&&this.clusterData?.nodes?.some(n=>n.verseText)&&this.showGuidedStep(0)):this.resetGuidedMode()}nextStep(){this.currentStep<this.clusterData.nodes.length-1&&(this.currentStep++,this.flippedCards.clear(),this.showGuidedStep(this.currentStep))}previousStep(){this.currentStep>0&&(this.currentStep--,this.flippedCards.clear(),this.showGuidedStep(this.currentStep))}showGuidedStep(n){if(!this.clusterData?.nodes||n>=this.clusterData.nodes.length)return;const i=this.clusterData.nodes[n],s=iF("#cluster-viz g").filter(c=>c&&c.id);s.empty()?setTimeout(()=>this.showGuidedStep(n),200):(s.transition().duration(300).style("opacity",.2),s.filter(c=>c.id===i.id).transition().duration(300).style("opacity",1),this.showNodeDetails(i))}resetGuidedMode(){iF("#cluster-viz g").transition().duration(300).style("opacity",1),Ui("#detail-panel").classed("hidden",!0)}showNodeDetails(n){const i=Ui("#detail-panel").classed("hidden",!1).html(""),s=i.append("div").attr("class","p-6"),c=s.append("div").attr("class","flex justify-between items-start mb-4"),d=c.append("div");d.append("h2").attr("class","text-2xl font-bold text-white mb-2").text(n.label),n.verses&&d.append("div").attr("class","flex items-center gap-2 mb-1").html(`\n          <div class="inline-flex items-center bg-purple-600/30 border border-purple-500/50 rounded-full px-3 py-1">\n            <i class="fas fa-book-open text-purple-300 text-xs mr-2"></i>\n            <span class="text-sm font-semibold text-purple-100">${n.verses}</span>\n          </div>\n        `),this.isGuidedMode||c.append("button").attr("class","text-slate-400 hover:text-white text-2xl").html("&times;").on("click",()=>{i.classed("hidden",!0)}),n.theme&&s.append("div").attr("class","bg-slate-700 rounded p-3 mb-4").html(`<div class="text-sm font-semibold text-slate-300 mb-1">Theme:</div>\n               <div class="text-white">${n.theme}</div>`);const _=this.getVerseText(n);if(_&&_!==n.description&&s.append("div").attr("class","bg-slate-700/30 border border-slate-600 rounded-lg p-4 mb-4").html(`\n          <div class="flex items-center gap-2 mb-3">\n            <i class="fas fa-bible text-purple-400"></i>\n            <span class="text-sm font-semibold text-purple-300">Scripture Text</span>\n            ${this.isLoadingVerses?'<i class="fas fa-spinner fa-spin text-purple-400 ml-2"></i>':""}\n          </div>\n          <div class="text-slate-100 leading-relaxed" style="line-height: 1.6;">\n            ${this.isLoadingVerses?"Loading verse content...":this.verseLoadError?'<div class="flex items-center gap-2 text-amber-300">\n                  <i class="fas fa-exclamation-triangle"></i>\n                  <span>Unable to load verse content. <button onclick="this.closest(\'.cluster-view\').retryLoadVerses()" class="underline hover:text-amber-200">Retry</button></span>\n                </div>':_}\n          </div>\n        `),n.thoughtProvoking&&n.thoughtProvoking.length>0){const x=s.append("div").attr("class","mb-4 border-t border-slate-700 pt-4"),E=x.append("button").attr("class","w-full flex justify-between items-center bg-slate-700/50 hover:bg-slate-700 rounded-lg p-3 transition text-left").on("click",function(){const V=Ui(this.parentNode).select(".thought-prompts"),j=Ui(this).select("i"),J=V.classed("hidden");V.classed("hidden",!J),j.classed("fa-chevron-down",J),j.classed("fa-chevron-up",!J)});E.append("div").html('<i class="fas fa-lightbulb mr-2 text-amber-400"></i><span class="font-semibold text-white">Reflect & Consider</span><span class="ml-2 text-xs text-slate-400">('+n.thoughtProvoking.length+" prompts)</span>"),E.append("i").attr("class","fas fa-chevron-down text-slate-400");const R=x.append("div").attr("class","thought-prompts hidden mt-3 space-y-3");n.thoughtProvoking.forEach((z,V)=>{const j=R.append("div").attr("class","flex gap-3");let J,se,le,de;if("string"==typeof z)z.toLowerCase().startsWith("notice")||z.toLowerCase().startsWith("observe")?(J="discover",le="fa-eye",de="text-blue-400"):z.toLowerCase().startsWith("practice")||z.toLowerCase().startsWith("apply")?(J="apply",le="fa-hands",de="text-green-400"):z.toLowerCase().startsWith("this reframes")||z.toLowerCase().startsWith("reframe")?(J="reframe",le="fa-lightbulb",de="text-amber-400"):(J="become",le="fa-seedling",de="text-emerald-400"),se=z;else switch(J=z.type,se=z.text,z.type){case"discover":le="fa-eye",de="text-blue-400";break;case"apply":le="fa-hands",de="text-green-400";break;case"reframe":le="fa-lightbulb",de="text-amber-400";break;case"become":le="fa-seedling",de="text-emerald-400"}j.append("div").attr("class","flex-shrink-0 mt-1").html(`<i class="fas ${le} ${de}"></i>`);const ae=j.append("div").attr("class","flex-1");ae.append("div").attr("class","text-xs font-semibold uppercase tracking-wide mb-1").attr("style",()=>{switch(J){case"observe":return"color: #60a5fa";case"consider":return"color: #c084fc";case"reflect":return"color: #fb7185";case"question":return"color: #fbbf24";default:return"color: #94a3b8"}}).text(J.charAt(0).toUpperCase()+J.slice(1)),ae.append("div").attr("class","text-slate-200 leading-relaxed").text(se)})}if(this.isGuidedMode){const x=s.append("div").attr("class","flex gap-2 mt-4");x.append("button").attr("class",`flex-1 ${0===this.currentStep?"bg-slate-700 opacity-50 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700"} text-white py-2 px-4 rounded transition`).attr("disabled",0===this.currentStep?"true":null).text("\u2190 Previous").on("click",()=>{this.currentStep>0&&this.previousStep()}),x.append("button").attr("class",`flex-1 ${this.currentStep===this.clusterData.nodes.length-1?"bg-slate-700 opacity-50 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700"} text-white py-2 px-4 rounded transition`).attr("disabled",this.currentStep===this.clusterData.nodes.length-1?"true":null).text("Next \u2192").on("click",()=>{this.currentStep<this.clusterData.nodes.length-1&&this.nextStep()})}else s.append("button").attr("class","mt-4 w-full bg-slate-700 hover:bg-slate-600 text-white py-2 px-4 rounded transition").text("Close").on("click",()=>{i.classed("hidden",!0)})}getDefaultColors(){return{A:["#ec4899","#be185d"],B:["#8b5cf6","#6d28d9"],C:["#3b82f6","#1e40af"],D:["#f59e0b","#d97706"],E:["#10b981","#047857"],F:["#06b6d4","#0891b2"],G:["#f43f5e","#e11d48"],H:["#a855f7","#9333ea"],I:["#14b8a6","#0d9488"],J:["#fb923c","#f97316"]}}getCurrentNodePrompts(){if(!this.clusterData?.nodes||this.currentStep>=this.clusterData.nodes.length)return[];const n=this.clusterData.nodes[this.currentStep];return n.thoughtProvoking?n.thoughtProvoking.map(i=>{if("string"==typeof i){let s="discover";return i.toLowerCase().startsWith("practice")||i.toLowerCase().startsWith("apply")?s="apply":i.toLowerCase().startsWith("this reframes")||i.toLowerCase().startsWith("reframe")?s="reframe":i.toLowerCase().startsWith("are you becoming")&&(s="become"),{type:s,text:i}}return i}):[]}getPromptIcon(n){switch(n){case"discover":return"fa-eye";case"apply":return"fa-hands";case"reframe":default:return"fa-lightbulb";case"become":return"fa-seedling"}}getPromptLabel(n){return{discover:{label:"Discover",subtext:"Propositional"},apply:{label:"Apply",subtext:"Procedural"},reframe:{label:"Reframe",subtext:"Perspectival"},become:{label:"Become",subtext:"Participatory"}}[n]||{label:n,subtext:""}}toggleCard(n){this.modalCardIndex=n}closeModal(){this.modalCardIndex=null}static \u0275fac=function(i){return new(i||e)(rn(tz))};static \u0275cmp=_l({type:e,selectors:[["app-cluster-view"]],viewQuery:function(i,s){if(1&i&&np(_te,5),2&i){let c;zd(c=Bd())&&(s.clusterContainer=c.first)}},inputs:{clusterData:"clusterData"},features:[Js],decls:21,vars:7,consts:[["clusterContainer",""],[1,"w-full","h-full","flex","flex-col","bg-gradient-to-br","from-slate-900","to-slate-800"],[1,"p-6","border-b","border-purple-500/30"],[1,"flex","justify-between","items-start","mb-2"],[1,"text-2xl","font-bold","text-white","mb-2"],[1,"text-slate-300","text-sm"],[1,"px-4","py-2","rounded-lg","transition","flex","items-center","gap-2",3,"click","ngClass"],[1,"fas",3,"ngClass"],[1,"flex-1","flex","flex-col","overflow-hidden"],[1,"flex-1","flex","overflow-hidden","relative"],[1,"flex-1","flex","items-center","justify-center","p-8","relative"],["id","cluster-viz"],["class","cards-overlay w-full",4,"ngIf"],["class","card-overlay",3,"click",4,"ngIf"],["id","detail-panel",1,"hidden","w-96","bg-slate-800","border-l","border-purple-500/30","overflow-y-auto"],["id","cluster-tooltip",1,"absolute","hidden","bg-slate-800/95","backdrop-blur-md","text-white","p-4","rounded-xl","border","border-purple-500/30","shadow-2xl","max-w-xs","z-50",2,"pointer-events","none"],[1,"cards-overlay","w-full"],[1,"flex","gap-3","justify-center","flex-wrap"],["class","flip-card",3,"click",4,"ngFor","ngForOf"],[1,"flip-card",3,"click"],[1,"flip-card-inner"],[1,"flip-card-front"],[1,"flex","flex-col","items-center","justify-center","gap-1"],[1,"fas","fa-lg","mb-2",3,"ngClass"],[1,"text-center"],[1,"text-xs","uppercase","font-bold"],["class","text-[10px] opacity-70 mt-0.5",4,"ngIf"],[1,"text-[10px]","opacity-70","mt-0.5"],[1,"card-overlay",3,"click"],[1,"overlay-card",3,"click"],[1,"overlay-close",3,"click"],[1,"overlay-header"],[1,"fas","fa-2x",3,"ngClass"],[1,"overlay-type",3,"ngClass"],["class","text-sm opacity-60 mt-1",4,"ngIf"],[1,"overlay-body"],[1,"text-sm","opacity-60","mt-1"]],template:function(i,s){if(1&i){const c=yl();Be(0,"div",1)(1,"div",2)(2,"div",3)(3,"div")(4,"h2",4),vt(5),We(),Be(6,"p",5),vt(7),We()(),Be(8,"button",6),xi("click",function(){return q(c),te(s.toggleMode())}),pn(9,"i",7),Be(10,"span"),vt(11),We()()()(),Be(12,"div",8)(13,"div",9)(14,"div",10),er(),pn(15,"svg",11,0),ws(17,bte,3,1,"div",12),We(),ws(18,wte,12,5,"div",13),lr(),pn(19,"div",14),We()(),pn(20,"div",15),We()}2&i&&(Xt(5),wo(null==s.clusterData?null:s.clusterData.title),Xt(2),wo(null==s.clusterData?null:s.clusterData.description),Xt(),Mi("ngClass",s.isGuidedMode?"bg-purple-600 hover:bg-purple-700 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"),Xt(),Mi("ngClass",s.isGuidedMode?"fa-route":"fa-hand-pointer"),Xt(2),wo(s.isGuidedMode?"Guided Mode":"Free Mode"),Xt(6),Mi("ngIf",s.getCurrentNodePrompts().length>0),Xt(),Mi("ngIf",null!==s.modalCardIndex))},dependencies:[zm,RM,b0,Nm],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}#cluster-viz[_ngcontent-%COMP%]{width:100%;height:100%;display:block}#cluster-tooltip[_ngcontent-%COMP%]{transition:opacity .2s ease;max-width:350px;line-height:1.5}#cluster-tooltip[_ngcontent-%COMP%]   .verse-badge[_ngcontent-%COMP%]{background:#9333ea66;border:1px solid rgba(147,51,234,.5);border-radius:4px;padding:2px 8px;font-size:.75rem;font-weight:500}.progress-step[_ngcontent-%COMP%]{transition:all .3s cubic-bezier(.4,0,.2,1)}.cards-overlay[_ngcontent-%COMP%]{position:absolute;bottom:20px;left:50%;transform:translate(-50%);z-index:50;pointer-events:none}.cards-overlay[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{pointer-events:auto}.flip-card[_ngcontent-%COMP%]{width:140px;height:90px;perspective:1000px;cursor:pointer}.flip-card-inner[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;transition:transform .6s;transform-style:preserve-3d}.flip-card.flipped[_ngcontent-%COMP%]   .flip-card-inner[_ngcontent-%COMP%]{transform:rotateY(180deg)}.flip-card-front[_ngcontent-%COMP%], .flip-card-back[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:8px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:500;padding:12px;box-sizing:border-box;overflow:hidden;text-overflow:ellipsis}.flip-card[_ngcontent-%COMP%]:hover   .flip-card-front[_ngcontent-%COMP%], .flip-card[_ngcontent-%COMP%]:hover   .flip-card-back[_ngcontent-%COMP%]{box-shadow:0 8px 30px #00000080}.flip-card-front[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);gap:16px}.flip-card-front[data-type=observe][_ngcontent-%COMP%]{background:linear-gradient(135deg,#60a5fa,#3b82f6)}.flip-card-front[data-type=consider][_ngcontent-%COMP%]{background:linear-gradient(135deg,#c084fc,#a855f7)}.flip-card-front[data-type=reflect][_ngcontent-%COMP%]{background:linear-gradient(135deg,#fb7185,#f43f5e)}.flip-card-front[data-type=question][_ngcontent-%COMP%]{background:linear-gradient(135deg,#fbbf24,#f59e0b)}.flip-card-front[data-type=discover][_ngcontent-%COMP%]{background:linear-gradient(135deg,#3b82f6,#2563eb)}.flip-card-front[data-type=apply][_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#059669)}.flip-card-front[data-type=reframe][_ngcontent-%COMP%]{background:linear-gradient(135deg,#8b5cf6,#7c3aed)}.flip-card-front[data-type=become][_ngcontent-%COMP%]{background:linear-gradient(135deg,#ec4899,#db2777)}.flip-card-front[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#fff;filter:drop-shadow(0 2px 4px rgba(0,0,0,.2))}.flip-card-front[_ngcontent-%COMP%]   .prompt-type[_ngcontent-%COMP%]{color:#fff;font-size:.875rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;text-shadow:0 2px 4px rgba(0,0,0,.2)}.flip-card-back[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1e293b,#334155);transform:rotateY(180deg);color:#fff;padding:24px;overflow-y:auto;border:2px solid rgba(147,51,234,.3)}.flip-card-back[data-type=observe][_ngcontent-%COMP%]{border-color:#60a5fa66}.flip-card-back[data-type=consider][_ngcontent-%COMP%]{border-color:#c084fc66}.flip-card-back[data-type=reflect][_ngcontent-%COMP%]{border-color:#fb718566}.flip-card-back[data-type=question][_ngcontent-%COMP%]{border-color:#fbbf2466}.flip-card-back[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.875rem;line-height:1.6;color:#e2e8f0}.flip-card-back[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.flip-card-back[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#0003;border-radius:3px}.flip-card-back[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#9333ea80;border-radius:3px}.flip-card-back[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#9333eab3}.card-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background:#000000bf;display:flex;align-items:center;justify-content:center;z-index:100;padding:2rem;box-sizing:border-box;backdrop-filter:blur(3px)}.overlay-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#1e293b,#334155);border-radius:16px;padding:2.5rem;max-width:500px;width:100%;max-height:70vh;overflow-y:auto;position:relative;box-shadow:0 20px 60px #0009;border:2px solid rgba(147,51,234,.4);animation:_ngcontent-%COMP%_slideIn .3s ease-out}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:scale(.95) translateY(20px)}to{opacity:1;transform:scale(1) translateY(0)}}.overlay-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:2px solid rgba(147,51,234,.3)}.overlay-header[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{flex-shrink:0}.overlay-type[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;text-transform:uppercase;letter-spacing:.05em;color:#fff}.overlay-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#ffffffb3;margin:0}.overlay-body[_ngcontent-%COMP%]{font-size:1.125rem;line-height:1.75;color:#e2e8f0}.overlay-close[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;background:#9333ea33;border:1px solid rgba(147,51,234,.4);border-radius:8px;width:40px;height:40px;font-size:1.5rem;cursor:pointer;color:#e2e8f0;transition:all .2s;display:flex;align-items:center;justify-content:center}.overlay-close[_ngcontent-%COMP%]:hover{background:#9333ea66;border-color:#9333ea99;color:#fff}.overlay-type.observe[_ngcontent-%COMP%], .overlay-header[_ngcontent-%COMP%]   i.observe[_ngcontent-%COMP%]{color:#60a5fa}.overlay-type.consider[_ngcontent-%COMP%], .overlay-header[_ngcontent-%COMP%]   i.consider[_ngcontent-%COMP%]{color:#c084fc}.overlay-type.reflect[_ngcontent-%COMP%], .overlay-header[_ngcontent-%COMP%]   i.reflect[_ngcontent-%COMP%]{color:#fb7185}.overlay-type.question[_ngcontent-%COMP%], .overlay-header[_ngcontent-%COMP%]   i.question[_ngcontent-%COMP%]{color:#fbbf24}.overlay-type.discover[_ngcontent-%COMP%], .overlay-header[_ngcontent-%COMP%]   i.discover[_ngcontent-%COMP%]{color:#3b82f6}.overlay-type.apply[_ngcontent-%COMP%], .overlay-header[_ngcontent-%COMP%]   i.apply[_ngcontent-%COMP%]{color:#10b981}.overlay-type.reframe[_ngcontent-%COMP%], .overlay-header[_ngcontent-%COMP%]   i.reframe[_ngcontent-%COMP%]{color:#8b5cf6}.overlay-type.become[_ngcontent-%COMP%], .overlay-header[_ngcontent-%COMP%]   i.become[_ngcontent-%COMP%]{color:#ec4899}.overlay-card[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px}.overlay-card[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#0003;border-radius:4px}.overlay-card[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#9333ea80;border-radius:4px}.overlay-card[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#9333eab3}"]})}return e})();function Tte(e,t){if(1&e&&(Be(0,"p",17),vt(1),We()),2&e){const n=ui();Xt(),Ju(" ",n.readingData.introduction," ")}}function Dte(e,t){if(1&e&&(Be(0,"span",22),vt(1),We()),2&e){const n=t.$implicit;Xt(),Ju(" ",n," ")}}function Mte(e,t){if(1&e&&(Be(0,"div",18)(1,"h3",19),vt(2,"Key Themes in This Chapter:"),We(),Be(3,"div",20),ws(4,Dte,2,1,"span",21),We()()),2&e){const n=ui();Xt(4),Mi("ngForOf",n.readingData.keyThemes)}}function Ete(e,t){if(1&e&&(Be(0,"div",23)(1,"div",24)(2,"div",25),pn(3,"i",26),Be(4,"span",27),vt(5,"Study Focus:"),We()(),Be(6,"p",28),vt(7,"We'll be focusing on "),Be(8,"strong"),vt(9),We(),vt(10," in the detailed study that follows."),We()()()),2&e){const n=ui();Xt(9),wo(n.readingData.focusVerses)}}function Ste(e,t){if(1&e&&(Be(0,"div",29)(1,"div",25),pn(2,"i",30),Be(3,"span",31),vt(4,"Reading Guide:"),We()(),Be(5,"p",32),vt(6),We()()),2&e){const n=ui();Xt(6),wo(n.readingData.readingInstructions)}}function Ite(e,t){1&e&&(Be(0,"div",33),pn(1,"i",34),Be(2,"p",35),vt(3,"Loading Scripture text..."),We()())}function Pte(e,t){if(1&e){const n=yl();Be(0,"div",33),pn(1,"i",36),Be(2,"p",37),vt(3,"Unable to load the Bible text."),We(),Be(4,"button",38),xi("click",function(){return q(n),te(ui().retryLoad())}),pn(5,"i",39),vt(6," Retry Loading "),We()()}}function Ate(e,t){if(1&e&&(Be(0,"div",40)(1,"div",41),pn(2,"i",42),Be(3,"h2",43),vt(4),We()(),pn(5,"div",44),We()),2&e){const n=ui();Xt(4),wo(null==n.readingData?null:n.readingData.chapterTitle),Xt(),Mi("innerHTML",n.bibleText,zs)}}let kte=(()=>{class e{bibleService;readingData;verseReference;bibleText="";isLoading=!1;loadError=!1;constructor(n){this.bibleService=n}ngOnInit(){this.loadBibleText()}loadBibleText(){this.verseReference&&(this.isLoading=!0,this.loadError=!1,this.bibleService.getVerses(this.verseReference).subscribe({next:n=>{this.isLoading=!1,n?this.bibleText=this.formatChapterText(n):this.loadError=!0},error:n=>{console.error("Failed to load Bible text:",n),this.isLoading=!1,this.loadError=!0}}))}formatChapterText(n){return n.verses?n.verses.map(i=>`<sup class="verse-number">${i.verse}</sup>${i.text}`).join(" "):n.text||""}retryLoad(){this.loadBibleText()}static \u0275fac=function(i){return new(i||e)(rn(tz))};static \u0275cmp=_l({type:e,selectors:[["app-bible-reading"]],inputs:{readingData:"readingData",verseReference:"verseReference"},decls:22,vars:8,consts:[[1,"w-full","h-full","bg-gradient-to-br","from-slate-900","to-slate-800","overflow-auto"],[1,"p-8","border-b","border-purple-500/30"],[1,"max-w-4xl","mx-auto"],[1,"flex","items-center","gap-3","mb-4"],[1,"fas","fa-bible","text-3xl","text-purple-400"],[1,"text-3xl","font-bold","text-white"],["class","text-slate-300 text-lg leading-relaxed mb-6",4,"ngIf"],["class","mb-6",4,"ngIf"],["class","mb-4",4,"ngIf"],["class","bg-slate-700/50 border border-slate-600 rounded-lg p-4",4,"ngIf"],[1,"p-8"],["class","text-center py-12",4,"ngIf"],["class","bg-slate-800/50 border border-slate-700 rounded-xl p-8",4,"ngIf"],[1,"mt-8","text-center"],[1,"bg-slate-700/50","border","border-slate-600","rounded-lg","p-4","inline-block"],[1,"flex","items-center","gap-2","text-slate-300"],[1,"fas","fa-arrow-right"],[1,"text-slate-300","text-lg","leading-relaxed","mb-6"],[1,"mb-6"],[1,"text-lg","font-semibold","text-purple-300","mb-3"],[1,"flex","flex-wrap","gap-2"],["class","bg-purple-600/20 border border-purple-500/30 rounded-full px-3 py-1 text-sm text-purple-200",4,"ngFor","ngForOf"],[1,"bg-purple-600/20","border","border-purple-500/30","rounded-full","px-3","py-1","text-sm","text-purple-200"],[1,"mb-4"],[1,"bg-amber-600/20","border","border-amber-500/30","rounded-lg","p-4"],[1,"flex","items-center","gap-2","mb-2"],[1,"fas","fa-bullseye","text-amber-400"],[1,"font-semibold","text-amber-300"],[1,"text-amber-100"],[1,"bg-slate-700/50","border","border-slate-600","rounded-lg","p-4"],[1,"fas","fa-lightbulb","text-blue-400"],[1,"font-semibold","text-blue-300"],[1,"text-slate-200"],[1,"text-center","py-12"],[1,"fas","fa-spinner","fa-spin","text-4xl","text-purple-400","mb-4"],[1,"text-slate-300","text-lg"],[1,"fas","fa-exclamation-triangle","text-4xl","text-amber-400","mb-4"],[1,"text-slate-300","text-lg","mb-4"],[1,"bg-purple-600","hover:bg-purple-700","text-white","px-6","py-3","rounded-lg","transition",3,"click"],[1,"fas","fa-retry","mr-2"],[1,"bg-slate-800/50","border","border-slate-700","rounded-xl","p-8"],[1,"flex","items-center","gap-3","mb-6"],[1,"fas","fa-scroll","text-2xl","text-purple-400"],[1,"text-2xl","font-bold","text-white"],[1,"prose","prose-invert","prose-lg","max-w-none","leading-relaxed",2,"line-height","2","font-size","1.1rem",3,"innerHTML"]],template:function(i,s){1&i&&(Be(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),pn(4,"i",4),Be(5,"h1",5),vt(6),We()(),ws(7,Tte,2,1,"p",6)(8,Mte,5,1,"div",7)(9,Ete,11,1,"div",8)(10,Ste,7,1,"div",9),We()(),Be(11,"div",10)(12,"div",2),ws(13,Ite,4,0,"div",11)(14,Pte,7,0,"div",11)(15,Ate,6,2,"div",12),Be(16,"div",13)(17,"div",14)(18,"div",15),pn(19,"i",16),Be(20,"span"),vt(21,"Continue to the next step to explore the structure and meaning of this passage"),We()()()()()()()),2&i&&(Xt(6),wo(null==s.readingData?null:s.readingData.chapterTitle),Xt(),Mi("ngIf",null==s.readingData?null:s.readingData.introduction),Xt(),Mi("ngIf",null==s.readingData||null==s.readingData.keyThemes?null:s.readingData.keyThemes.length),Xt(),Mi("ngIf",null==s.readingData?null:s.readingData.focusVerses),Xt(),Mi("ngIf",null==s.readingData?null:s.readingData.readingInstructions),Xt(3),Mi("ngIf",s.isLoading),Xt(),Mi("ngIf",s.loadError&&!s.isLoading),Xt(),Mi("ngIf",s.bibleText&&!s.isLoading&&!s.loadError))},dependencies:[zm,b0,Nm],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%}.verse-number[_ngcontent-%COMP%]{font-size:.5rem;font-weight:500;color:#a855f7;margin-right:.2rem;opacity:.7;line-height:1}.prose[_ngcontent-%COMP%]{color:#e2e8f0}.prose[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:1rem}[_nghost-%COMP%]::-webkit-scrollbar{width:8px}[_nghost-%COMP%]::-webkit-scrollbar-track{background:#0f172a80}[_nghost-%COMP%]::-webkit-scrollbar-thumb{background:#8b5cf680;border-radius:4px}[_nghost-%COMP%]::-webkit-scrollbar-thumb:hover{background:#8b5cf6cc}"]})}return e})();const Rte=(e,t)=>({"bg-gradient-to-br from-purple-500 to-purple-700 text-white":e,"bg-slate-900/60 text-slate-200":t});function Lte(e,t){if(1&e){const n=yl();Be(0,"li")(1,"button",7),xi("click",function(){const s=q(n).index;return te(ui().setStep(s))}),vt(2),We()()}if(2&e){const n=t.$implicit,i=t.index,s=ui();Xt(),Mi("ngClass",wA(2,Rte,s.currentStepIndex===i,s.currentStepIndex!==i)),Xt(),Ju(" ",n.title," ")}}function Ote(e,t){if(1&e&&pn(0,"app-bible-reading",11),2&e){const n=ui(2);Mi("readingData",n.readingData)("verseReference",n.verseReference)}}function Fte(e,t){1&e&&pn(0,"app-map-view",12),2&e&&Mi("mapData",ui(2).mapData)}function Nte(e,t){1&e&&pn(0,"app-cluster-view",13),2&e&&Mi("clusterData",ui(2).clusterData)}function zte(e,t){if(1&e&&(Nv(0),ws(1,Ote,1,2,"app-bible-reading",8)(2,Fte,1,1,"app-map-view",9)(3,Nte,1,1,"app-cluster-view",10),zv()),2&e){const n=ui();Xt(),Mi("ngIf",n.readingData),Xt(),Mi("ngIf",n.mapData),Xt(),Mi("ngIf",n.clusterData)}}function Bte(e,t){1&e&&(Nv(0),Be(1,"p",14),vt(2,"Loading study steps..."),We(),zv())}const Vte=[{path:"",component:MK},{path:"denomination-quiz",component:eee},{path:"denomination-wheel",component:nee},{path:"tree-editor",component:dte},{path:"interactive-study",component:(()=>{class e{http;steps=[];currentStepIndex=0;mapData=null;clusterData=null;readingData=null;verseReference="";constructor(n){this.http=n}ngOnInit(){this.http.get("/theoviz/stepper-content.json").subscribe(n=>{this.steps=n,this.setStep(0)})}setStep(n){this.currentStepIndex=n;const i=this.steps[n];this.mapData=null,this.clusterData=null,this.readingData=null,this.verseReference="",i&&("bible-reading"===i.type&&i.readingData?(this.readingData=i.readingData,this.verseReference=i.verseReference||""):"map"===i.type&&i.mapData?this.mapData=i.mapData:"cluster"===i.type&&i.clusterData&&(this.clusterData=i.clusterData))}static \u0275fac=function(i){return new(i||e)(rn(L1))};static \u0275cmp=_l({type:e,selectors:[["app-interactive-study"]],decls:10,vars:3,consts:[[1,"flex","w-full","h-screen"],[1,"w-[280px]","bg-slate-800/85","backdrop-blur-md","border","border-purple-500/30","rounded-2xl","p-6","shadow-[0_8px_32px_rgba(0,0,0,0.3)]"],[1,"text-xl","font-bold","text-white","mb-5","font-['Inter','Segoe_UI',Tahoma,Geneva,Verdana,sans-serif]"],[1,"flex","flex-col","gap-2","p-0","m-0","list-none"],[4,"ngFor","ngForOf"],[1,"w-full","h-full"],[4,"ngIf"],[1,"w-full","px-4","py-3","rounded-xl","border-2","border-purple-500","text-sm","font-semibold","cursor-pointer","transition-all","duration-200","text-left","font-['Inter','Segoe_UI',Tahoma,Geneva,Verdana,sans-serif]",3,"click","ngClass"],["class","w-full h-full",3,"readingData","verseReference",4,"ngIf"],["class","w-full h-full",3,"mapData",4,"ngIf"],["class","w-full h-full",3,"clusterData",4,"ngIf"],[1,"w-full","h-full",3,"readingData","verseReference"],[1,"w-full","h-full",3,"mapData"],[1,"w-full","h-full",3,"clusterData"],[1,"text-slate-200","p-8"]],template:function(i,s){1&i&&(Be(0,"div",0)(1,"aside",1)(2,"h2",2),vt(3,"Study Steps"),We(),Be(4,"nav")(5,"ul",3),ws(6,Lte,3,5,"li",4),We()()(),Be(7,"main",5),ws(8,zte,4,3,"ng-container",6)(9,Bte,3,0,"ng-container",6),We()()),2&i&&(Xt(6),Mi("ngForOf",s.steps),Xt(2),Mi("ngIf",s.steps.length),Xt(),Mi("ngIf",!s.steps.length))},dependencies:[gte,Cte,kte,zm,RM,b0,Nm],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;width:100%;height:100vh;min-height:100vh;background:linear-gradient(135deg,#0f172a,#581c87,#0f172a);user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.header-drawer[_ngcontent-%COMP%]{position:fixed;top:20px;left:20px;z-index:100;max-width:500px;transition:all .4s cubic-bezier(.4,0,.2,1)}.drawer-card[_ngcontent-%COMP%]{background:#1e293bd9;backdrop-filter:blur(16px);border:1px solid rgba(168,85,247,.3);border-radius:16px;padding:20px 24px;box-shadow:0 8px 32px #0000004d;position:relative;transition:all .4s cubic-bezier(.4,0,.2,1);width:500px}.drawer-content[_ngcontent-%COMP%]{transition:all .4s cubic-bezier(.4,0,.2,1)}.drawer-title[_ngcontent-%COMP%]{font-size:28px;font-weight:700;color:#fff;margin:0 0 12px;font-family:Inter,Segoe UI,Tahoma,Geneva,Verdana,sans-serif;text-shadow:0px 2px 4px rgba(0,0,0,.3)}.drawer-description[_ngcontent-%COMP%]{font-size:14px;color:#e2e8f0;margin:0 0 16px;line-height:1.6;font-family:Inter,Segoe UI,Tahoma,Geneva,Verdana,sans-serif}"]})}return e})()},{path:"**",redirectTo:"/"}],jte={providers:[function l8(e){const t=e?.ignoreChangesOutsideZone,n=e?.scheduleInRootZone,i=_D({ngZoneFactory:()=>{const s=yD(e);return s.scheduleInRootZone=n,s.shouldCoalesceEventChangeDetection&&Ua("NgZone_CoalesceEvent"),new Cr(s)},ignoreChangesOutsideZone:t,scheduleInRootZone:n});return ds([{provide:a8,useValue:!0},{provide:vf,useValue:!1},i])}({eventCoalescing:!0}),function CZ(e,...t){return ds([{provide:fM,multi:!0,useValue:e},[],{provide:P_,useFactory:mL,deps:[L_]},{provide:Lv,multi:!0,useFactory:gL},t.map(n=>n.\u0275providers)])}(Vte),function e7(...e){const t=[L1,LL,kL,{provide:I1,useExisting:kL},{provide:P1,useFactory:()=>Ot(IL,{optional:!0})??Ot(LL)},{provide:y0,useValue:JZ,multi:!0},{provide:wM,useValue:!0},{provide:NL,useClass:QZ}];for(const n of e)t.push(...n.\u0275providers);return ds(t)}()]};(function KU(e,t,n){return O8({rootComponent:e,platformRef:n?.platformRef,...Yk(t)})})((()=>{class e{title="theoviz";static \u0275fac=function(i){return new(i||e)};static \u0275cmp=_l({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(i,s){1&i&&pn(0,"router-outlet")},dependencies:[rM],encapsulation:2})}return e})(),jte).catch(e=>console.error(e))},244:function(uu,Je){!function(et){"use strict";function Pe(f){var C,P,B,Y;for(P=1,B=arguments.length;P<B;P++)for(C in Y=arguments[P])f[C]=Y[C];return f}var I=Object.create||function(){function f(){}return function(C){return f.prototype=C,new f}}();function p(f,C){var P=Array.prototype.slice;if(f.bind)return f.bind.apply(f,P.call(arguments,1));var B=P.call(arguments,2);return function(){return f.apply(C,B.length?B.concat(P.call(arguments)):arguments)}}var Z=0;function he(f){return"_leaflet_id"in f||(f._leaflet_id=++Z),f._leaflet_id}function be(f,C,P){var B,Y,_e,qe;return qe=function(){B=!1,Y&&(_e.apply(P,Y),Y=!1)},_e=function(){B?Y=arguments:(f.apply(P,arguments),setTimeout(qe,C),B=!0)},_e}function me(f,C,P){var B=C[1],Y=C[0],_e=B-Y;return f===B&&P?f:((f-Y)%_e+_e)%_e+Y}function ve(){return!1}function ee(f,C){if(!1===C)return f;var P=Math.pow(10,void 0===C?6:C);return Math.round(f*P)/P}function fe(f){return f.trim?f.trim():f.replace(/^\s+|\s+$/g,"")}function ue(f){return fe(f).split(/\s+/)}function K(f,C){for(var P in Object.prototype.hasOwnProperty.call(f,"options")||(f.options=f.options?I(f.options):{}),C)f.options[P]=C[P];return f.options}function Ee(f,C,P){var B=[];for(var Y in f)B.push(encodeURIComponent(P?Y.toUpperCase():Y)+"="+encodeURIComponent(f[Y]));return(C&&-1!==C.indexOf("?")?"&":"?")+B.join("&")}var Ie=/\{ *([\w_ -]+) *\}/g;function Ue(f,C){return f.replace(Ie,function(P,B){var Y=C[B];if(void 0===Y)throw new Error("No value provided for variable "+P);return"function"==typeof Y&&(Y=Y(C)),Y})}var ot=Array.isArray||function(f){return"[object Array]"===Object.prototype.toString.call(f)};function ct(f,C){for(var P=0;P<f.length;P++)if(f[P]===C)return P;return-1}var St="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function xt(f){return window["webkit"+f]||window["moz"+f]||window["ms"+f]}var Qt=0;function Mt(f){var C=+new Date,P=Math.max(0,16-(C-Qt));return Qt=C+P,window.setTimeout(f,P)}var on=window.requestAnimationFrame||xt("RequestAnimationFrame")||Mt,Hn=window.cancelAnimationFrame||xt("CancelAnimationFrame")||xt("CancelRequestAnimationFrame")||function(f){window.clearTimeout(f)};function Ze(f,C,P){if(!P||on!==Mt)return on.call(window,p(f,C));f.call(C)}function Dt(f){f&&Hn.call(window,f)}var pe={__proto__:null,extend:Pe,create:I,bind:p,get lastId(){return Z},stamp:he,throttle:be,wrapNum:me,falseFn:ve,formatNum:ee,trim:fe,splitWords:ue,setOptions:K,getParamString:Ee,template:Ue,isArray:ot,indexOf:ct,emptyImageUrl:St,requestFn:on,cancelFn:Hn,requestAnimFrame:Ze,cancelAnimFrame:Dt};function Rt(){}Rt.extend=function(f){var C=function(){K(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},P=C.__super__=this.prototype,B=I(P);for(var Y in B.constructor=C,C.prototype=B,this)Object.prototype.hasOwnProperty.call(this,Y)&&"prototype"!==Y&&"__super__"!==Y&&(C[Y]=this[Y]);return f.statics&&Pe(C,f.statics),f.includes&&(function ii(f){if(!(typeof L>"u")&&L&&L.Mixin){f=ot(f)?f:[f];for(var C=0;C<f.length;C++)f[C]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}(f.includes),Pe.apply(null,[B].concat(f.includes))),Pe(B,f),delete B.statics,delete B.includes,B.options&&(B.options=P.options?I(P.options):{},Pe(B.options,f.options)),B._initHooks=[],B.callInitHooks=function(){if(!this._initHooksCalled){P.callInitHooks&&P.callInitHooks.call(this),this._initHooksCalled=!0;for(var _e=0,qe=B._initHooks.length;_e<qe;_e++)B._initHooks[_e].call(this)}},C},Rt.include=function(f){var C=this.prototype.options;return Pe(this.prototype,f),f.options&&(this.prototype.options=C,this.mergeOptions(f.options)),this},Rt.mergeOptions=function(f){return Pe(this.prototype.options,f),this},Rt.addInitHook=function(f){var C=Array.prototype.slice.call(arguments,1),P="function"==typeof f?f:function(){this[f].apply(this,C)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(P),this};var Bt={on:function(f,C,P){if("object"==typeof f)for(var B in f)this._on(B,f[B],C);else for(var Y=0,_e=(f=ue(f)).length;Y<_e;Y++)this._on(f[Y],C,P);return this},off:function(f,C,P){if(arguments.length)if("object"==typeof f)for(var B in f)this._off(B,f[B],C);else{f=ue(f);for(var Y=1===arguments.length,_e=0,qe=f.length;_e<qe;_e++)Y?this._off(f[_e]):this._off(f[_e],C,P)}else delete this._events;return this},_on:function(f,C,P,B){if("function"==typeof C){if(!1===this._listens(f,C,P)){P===this&&(P=void 0);var Y={fn:C,ctx:P};B&&(Y.once=!0),this._events=this._events||{},this._events[f]=this._events[f]||[],this._events[f].push(Y)}}else console.warn("wrong listener type: "+typeof C)},_off:function(f,C,P){var B,Y,_e;if(this._events&&(B=this._events[f])){if(1===arguments.length){if(this._firingCount)for(Y=0,_e=B.length;Y<_e;Y++)B[Y].fn=ve;return void delete this._events[f]}if("function"!=typeof C)return void console.warn("wrong listener type: "+typeof C);var qe=this._listens(f,C,P);!1!==qe&&(this._firingCount&&(B[qe].fn=ve,this._events[f]=B=B.slice()),B.splice(qe,1))}},fire:function(f,C,P){if(!this.listens(f,P))return this;var B=Pe({},C,{type:f,target:this,sourceTarget:C&&C.sourceTarget||this});if(this._events){var Y=this._events[f];if(Y){this._firingCount=this._firingCount+1||1;for(var _e=0,qe=Y.length;_e<qe;_e++){var at=Y[_e],wt=at.fn;at.once&&this.off(f,wt,at.ctx),wt.call(at.ctx||this,B)}this._firingCount--}}return P&&this._propagateEvent(B),this},listens:function(f,C,P,B){"string"!=typeof f&&console.warn('"string" type argument expected');var Y=C;"function"!=typeof C&&(B=!!C,Y=void 0,P=void 0);var _e=this._events&&this._events[f];if(_e&&_e.length&&!1!==this._listens(f,Y,P))return!0;if(B)for(var qe in this._eventParents)if(this._eventParents[qe].listens(f,C,P,B))return!0;return!1},_listens:function(f,C,P){if(!this._events)return!1;var B=this._events[f]||[];if(!C)return!!B.length;P===this&&(P=void 0);for(var Y=0,_e=B.length;Y<_e;Y++)if(B[Y].fn===C&&B[Y].ctx===P)return Y;return!1},once:function(f,C,P){if("object"==typeof f)for(var B in f)this._on(B,f[B],C,!0);else for(var Y=0,_e=(f=ue(f)).length;Y<_e;Y++)this._on(f[Y],C,P,!0);return this},addEventParent:function(f){return this._eventParents=this._eventParents||{},this._eventParents[he(f)]=f,this},removeEventParent:function(f){return this._eventParents&&delete this._eventParents[he(f)],this},_propagateEvent:function(f){for(var C in this._eventParents)this._eventParents[C].fire(f.type,Pe({layer:f.target,propagatedFrom:f.target},f),!0)}};Bt.addEventListener=Bt.on,Bt.removeEventListener=Bt.clearAllEventListeners=Bt.off,Bt.addOneTimeEventListener=Bt.once,Bt.fireEvent=Bt.fire,Bt.hasEventListeners=Bt.listens;var Qn=Rt.extend(Bt);function pt(f,C,P){this.x=P?Math.round(f):f,this.y=P?Math.round(C):C}var Nn=Math.trunc||function(f){return f>0?Math.floor(f):Math.ceil(f)};function nt(f,C,P){return f instanceof pt?f:ot(f)?new pt(f[0],f[1]):null==f?f:"object"==typeof f&&"x"in f&&"y"in f?new pt(f.x,f.y):new pt(f,C,P)}function ht(f,C){if(f)for(var P=C?[f,C]:f,B=0,Y=P.length;B<Y;B++)this.extend(P[B])}function Sn(f,C){return!f||f instanceof ht?f:new ht(f,C)}function ln(f,C){if(f)for(var P=C?[f,C]:f,B=0,Y=P.length;B<Y;B++)this.extend(P[B])}function Wt(f,C){return f instanceof ln?f:new ln(f,C)}function Pn(f,C,P){if(isNaN(f)||isNaN(C))throw new Error("Invalid LatLng object: ("+f+", "+C+")");this.lat=+f,this.lng=+C,void 0!==P&&(this.alt=+P)}function zn(f,C,P){return f instanceof Pn?f:ot(f)&&"object"!=typeof f[0]?3===f.length?new Pn(f[0],f[1],f[2]):2===f.length?new Pn(f[0],f[1]):null:null==f?f:"object"==typeof f&&"lat"in f?new Pn(f.lat,"lng"in f?f.lng:f.lon,f.alt):void 0===C?null:new Pn(f,C,P)}pt.prototype={clone:function(){return new pt(this.x,this.y)},add:function(f){return this.clone()._add(nt(f))},_add:function(f){return this.x+=f.x,this.y+=f.y,this},subtract:function(f){return this.clone()._subtract(nt(f))},_subtract:function(f){return this.x-=f.x,this.y-=f.y,this},divideBy:function(f){return this.clone()._divideBy(f)},_divideBy:function(f){return this.x/=f,this.y/=f,this},multiplyBy:function(f){return this.clone()._multiplyBy(f)},_multiplyBy:function(f){return this.x*=f,this.y*=f,this},scaleBy:function(f){return new pt(this.x*f.x,this.y*f.y)},unscaleBy:function(f){return new pt(this.x/f.x,this.y/f.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=Nn(this.x),this.y=Nn(this.y),this},distanceTo:function(f){var C=(f=nt(f)).x-this.x,P=f.y-this.y;return Math.sqrt(C*C+P*P)},equals:function(f){return(f=nt(f)).x===this.x&&f.y===this.y},contains:function(f){return f=nt(f),Math.abs(f.x)<=Math.abs(this.x)&&Math.abs(f.y)<=Math.abs(this.y)},toString:function(){return"Point("+ee(this.x)+", "+ee(this.y)+")"}},ht.prototype={extend:function(f){var C,P;if(!f)return this;if(f instanceof pt||"number"==typeof f[0]||"x"in f)C=P=nt(f);else if(P=(f=Sn(f)).max,!(C=f.min)||!P)return this;return this.min||this.max?(this.min.x=Math.min(C.x,this.min.x),this.max.x=Math.max(P.x,this.max.x),this.min.y=Math.min(C.y,this.min.y),this.max.y=Math.max(P.y,this.max.y)):(this.min=C.clone(),this.max=P.clone()),this},getCenter:function(f){return nt((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,f)},getBottomLeft:function(){return nt(this.min.x,this.max.y)},getTopRight:function(){return nt(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(f){var C,P;return(f="number"==typeof f[0]||f instanceof pt?nt(f):Sn(f))instanceof ht?(C=f.min,P=f.max):C=P=f,C.x>=this.min.x&&P.x<=this.max.x&&C.y>=this.min.y&&P.y<=this.max.y},intersects:function(f){f=Sn(f);var C=this.min,P=this.max,B=f.min,Y=f.max;return Y.x>=C.x&&B.x<=P.x&&Y.y>=C.y&&B.y<=P.y},overlaps:function(f){f=Sn(f);var C=this.min,P=this.max,B=f.min,Y=f.max;return Y.x>C.x&&B.x<P.x&&Y.y>C.y&&B.y<P.y},isValid:function(){return!(!this.min||!this.max)},pad:function(f){var C=this.min,P=this.max,B=Math.abs(C.x-P.x)*f,Y=Math.abs(C.y-P.y)*f;return Sn(nt(C.x-B,C.y-Y),nt(P.x+B,P.y+Y))},equals:function(f){return!!f&&(f=Sn(f),this.min.equals(f.getTopLeft())&&this.max.equals(f.getBottomRight()))}},ln.prototype={extend:function(f){var B,Y,C=this._southWest,P=this._northEast;if(f instanceof Pn)B=f,Y=f;else{if(!(f instanceof ln))return f?this.extend(zn(f)||Wt(f)):this;if(Y=f._northEast,!(B=f._southWest)||!Y)return this}return C||P?(C.lat=Math.min(B.lat,C.lat),C.lng=Math.min(B.lng,C.lng),P.lat=Math.max(Y.lat,P.lat),P.lng=Math.max(Y.lng,P.lng)):(this._southWest=new Pn(B.lat,B.lng),this._northEast=new Pn(Y.lat,Y.lng)),this},pad:function(f){var C=this._southWest,P=this._northEast,B=Math.abs(C.lat-P.lat)*f,Y=Math.abs(C.lng-P.lng)*f;return new ln(new Pn(C.lat-B,C.lng-Y),new Pn(P.lat+B,P.lng+Y))},getCenter:function(){return new Pn((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Pn(this.getNorth(),this.getWest())},getSouthEast:function(){return new Pn(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(f){f="number"==typeof f[0]||f instanceof Pn||"lat"in f?zn(f):Wt(f);var B,Y,C=this._southWest,P=this._northEast;return f instanceof ln?(B=f.getSouthWest(),Y=f.getNorthEast()):B=Y=f,B.lat>=C.lat&&Y.lat<=P.lat&&B.lng>=C.lng&&Y.lng<=P.lng},intersects:function(f){f=Wt(f);var C=this._southWest,P=this._northEast,B=f.getSouthWest(),Y=f.getNorthEast();return Y.lat>=C.lat&&B.lat<=P.lat&&Y.lng>=C.lng&&B.lng<=P.lng},overlaps:function(f){f=Wt(f);var C=this._southWest,P=this._northEast,B=f.getSouthWest(),Y=f.getNorthEast();return Y.lat>C.lat&&B.lat<P.lat&&Y.lng>C.lng&&B.lng<P.lng},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(f,C){return!!f&&(f=Wt(f),this._southWest.equals(f.getSouthWest(),C)&&this._northEast.equals(f.getNorthEast(),C))},isValid:function(){return!(!this._southWest||!this._northEast)}},Pn.prototype={equals:function(f,C){return!!f&&(f=zn(f),Math.max(Math.abs(this.lat-f.lat),Math.abs(this.lng-f.lng))<=(void 0===C?1e-9:C))},toString:function(f){return"LatLng("+ee(this.lat,f)+", "+ee(this.lng,f)+")"},distanceTo:function(f){return mi.distance(this,zn(f))},wrap:function(){return mi.wrapLatLng(this)},toBounds:function(f){var C=180*f/40075017,P=C/Math.cos(Math.PI/180*this.lat);return Wt([this.lat-C,this.lng-P],[this.lat+C,this.lng+P])},clone:function(){return new Pn(this.lat,this.lng,this.alt)}};var f,Zn={latLngToPoint:function(f,C){var P=this.projection.project(f),B=this.scale(C);return this.transformation._transform(P,B)},pointToLatLng:function(f,C){var P=this.scale(C),B=this.transformation.untransform(f,P);return this.projection.unproject(B)},project:function(f){return this.projection.project(f)},unproject:function(f){return this.projection.unproject(f)},scale:function(f){return 256*Math.pow(2,f)},zoom:function(f){return Math.log(f/256)/Math.LN2},getProjectedBounds:function(f){if(this.infinite)return null;var C=this.projection.bounds,P=this.scale(f);return new ht(this.transformation.transform(C.min,P),this.transformation.transform(C.max,P))},infinite:!1,wrapLatLng:function(f){var C=this.wrapLng?me(f.lng,this.wrapLng,!0):f.lng;return new Pn(this.wrapLat?me(f.lat,this.wrapLat,!0):f.lat,C,f.alt)},wrapLatLngBounds:function(f){var C=f.getCenter(),P=this.wrapLatLng(C),B=C.lat-P.lat,Y=C.lng-P.lng;if(0===B&&0===Y)return f;var _e=f.getSouthWest(),qe=f.getNorthEast();return new ln(new Pn(_e.lat-B,_e.lng-Y),new Pn(qe.lat-B,qe.lng-Y))}},mi=Pe({},Zn,{wrapLng:[-180,180],R:6371e3,distance:function(f,C){var P=Math.PI/180,B=f.lat*P,Y=C.lat*P,_e=Math.sin((C.lat-f.lat)*P/2),qe=Math.sin((C.lng-f.lng)*P/2),at=_e*_e+Math.cos(B)*Math.cos(Y)*qe*qe,wt=2*Math.atan2(Math.sqrt(at),Math.sqrt(1-at));return this.R*wt}}),tr={R:6378137,MAX_LATITUDE:85.0511287798,project:function(f){var C=Math.PI/180,P=this.MAX_LATITUDE,B=Math.max(Math.min(P,f.lat),-P),Y=Math.sin(B*C);return new pt(this.R*f.lng*C,this.R*Math.log((1+Y)/(1-Y))/2)},unproject:function(f){var C=180/Math.PI;return new Pn((2*Math.atan(Math.exp(f.y/this.R))-Math.PI/2)*C,f.x*C/this.R)},bounds:(f=6378137*Math.PI,new ht([-f,-f],[f,f]))};function pr(f,C,P,B){if(ot(f))return this._a=f[0],this._b=f[1],this._c=f[2],void(this._d=f[3]);this._a=f,this._b=C,this._c=P,this._d=B}function Jr(f,C,P,B){return new pr(f,C,P,B)}pr.prototype={transform:function(f,C){return this._transform(f.clone(),C)},_transform:function(f,C){return f.x=(C=C||1)*(this._a*f.x+this._b),f.y=C*(this._c*f.y+this._d),f},untransform:function(f,C){return new pt((f.x/(C=C||1)-this._b)/this._a,(f.y/C-this._d)/this._c)}};var ne=Pe({},mi,{code:"EPSG:3857",projection:tr,transformation:function(){var f=.5/(Math.PI*tr.R);return Jr(f,.5,-f,.5)}()}),kt=Pe({},ne,{code:"EPSG:900913"});function Ct(f){return document.createElementNS("http://www.w3.org/2000/svg",f)}function Oe(f,C){var B,Y,_e,qe,at,wt,P="";for(B=0,_e=f.length;B<_e;B++){for(Y=0,qe=(at=f[B]).length;Y<qe;Y++)P+=(Y?"L":"M")+(wt=at[Y]).x+" "+wt.y;P+=C?gn.svg?"z":"x":""}return P||"M0 0"}var ke=document.documentElement.style,it="ActiveXObject"in window,jt=it&&!document.addEventListener,Ut="msLaunchUri"in navigator&&!("documentMode"in document),dt=Ci("webkit"),tn=Ci("android"),Cn=Ci("android 2")||Ci("android 3"),nn=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),mn=tn&&Ci("Google")&&nn<537&&!("AudioNode"in window),ji=!!window.opera,bi=!Ut&&Ci("chrome"),Hr=Ci("gecko")&&!dt&&!ji&&!it,ur=!bi&&Ci("safari"),Mo=Ci("phantom"),is="OTransition"in ke,qi=0===navigator.platform.indexOf("Win"),Sr=it&&"transition"in ke,He="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Cn,ie="MozPerspective"in ke,oe=!window.L_DISABLE_3D&&(Sr||He||ie)&&!is&&!Mo,ge=typeof orientation<"u"||Ci("mobile"),Fe=ge&&dt,Ve=ge&&He,rt=!window.PointerEvent&&window.MSPointerEvent,xe=!(!window.PointerEvent&&!rt),Ke="ontouchstart"in window||!!window.TouchEvent,yt=!window.L_NO_TOUCH&&(Ke||xe),bt=ge&&ji,Tt=ge&&Hr,vn=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Bn=function(){var f=!1;try{var C=Object.defineProperty({},"passive",{get:function(){f=!0}});window.addEventListener("testPassiveEventSupport",ve,C),window.removeEventListener("testPassiveEventSupport",ve,C)}catch{}return f}(),ri=!!document.createElement("canvas").getContext,hr=!(!document.createElementNS||!Ct("svg").createSVGRect),Ei=!!hr&&function(){var f=document.createElement("div");return f.innerHTML="<svg/>","http://www.w3.org/2000/svg"===(f.firstChild&&f.firstChild.namespaceURI)}(),$i=!hr&&function(){try{var f=document.createElement("div");f.innerHTML='<v:shape adj="1"/>';var C=f.firstChild;return C.style.behavior="url(#default#VML)",C&&"object"==typeof C.adj}catch{return!1}}();function Ci(f){return navigator.userAgent.toLowerCase().indexOf(f)>=0}var gn={ie:it,ielt9:jt,edge:Ut,webkit:dt,android:tn,android23:Cn,androidStock:mn,opera:ji,chrome:bi,gecko:Hr,safari:ur,phantom:Mo,opera12:is,win:qi,ie3d:Sr,webkit3d:He,gecko3d:ie,any3d:oe,mobile:ge,mobileWebkit:Fe,mobileWebkit3d:Ve,msPointer:rt,pointer:xe,touch:yt,touchNative:Ke,mobileOpera:bt,mobileGecko:Tt,retina:vn,passiveEvents:Bn,canvas:ri,svg:hr,vml:$i,inlineSvg:Ei,mac:0===navigator.platform.indexOf("Mac"),linux:0===navigator.platform.indexOf("Linux")},Zr=gn.msPointer?"MSPointerDown":"pointerdown",di=gn.msPointer?"MSPointerMove":"pointermove",qt=gn.msPointer?"MSPointerUp":"pointerup",Mn=gn.msPointer?"MSPointerCancel":"pointercancel",Un={touchstart:Zr,touchmove:di,touchend:qt,touchcancel:Mn},rs={touchstart:function oc(f,C){C.MSPOINTER_TYPE_TOUCH&&C.pointerType===C.MSPOINTER_TYPE_TOUCH&&rr(C),El(f,C)},touchmove:El,touchend:El,touchcancel:El},Ir={},mo=!1;function kn(f,C,P){return"touchstart"===C&&function Si(){mo||(document.addEventListener(Zr,qr,!0),document.addEventListener(di,Lr,!0),document.addEventListener(qt,ca,!0),document.addEventListener(Mn,ca,!0),mo=!0)}(),rs[C]?(P=rs[C].bind(this,P),f.addEventListener(Un[C],P,!1),P):(console.warn("wrong event specified:",C),ve)}function qr(f){Ir[f.pointerId]=f}function Lr(f){Ir[f.pointerId]&&(Ir[f.pointerId]=f)}function ca(f){delete Ir[f.pointerId]}function El(f,C){if(C.pointerType!==(C.MSPOINTER_TYPE_MOUSE||"mouse")){for(var P in C.touches=[],Ir)C.touches.push(Ir[P]);C.changedTouches=[C],f(C)}}var ti,Uo,Wo,oi,Zs,Sl=Il(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),_r=Il(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Ra="webkitTransition"===_r||"OTransition"===_r?_r+"End":"transitionend";function ua(f){return"string"==typeof f?document.getElementById(f):f}function os(f,C){var P=f.style[C]||f.currentStyle&&f.currentStyle[C];if((!P||"auto"===P)&&document.defaultView){var B=document.defaultView.getComputedStyle(f,null);P=B?B[C]:null}return"auto"===P?null:P}function Ai(f,C,P){var B=document.createElement(f);return B.className=C||"",P&&P.appendChild(B),B}function Qi(f){var C=f.parentNode;C&&C.removeChild(f)}function Rc(f){for(;f.firstChild;)f.removeChild(f.firstChild)}function el(f){var C=f.parentNode;C&&C.lastChild!==f&&C.appendChild(f)}function xa(f){var C=f.parentNode;C&&C.firstChild!==f&&C.insertBefore(f,C.firstChild)}function ld(f,C){if(void 0!==f.classList)return f.classList.contains(C);var P=Wi(f);return P.length>0&&new RegExp("(^|\\s)"+C+"(\\s|$)").test(P)}function On(f,C){if(void 0!==f.classList)for(var P=ue(C),B=0,Y=P.length;B<Y;B++)f.classList.add(P[B]);else if(!ld(f,C)){var _e=Wi(f);dh(f,(_e?_e+" ":"")+C)}}function eo(f,C){void 0!==f.classList?f.classList.remove(C):dh(f,fe((" "+Wi(f)+" ").replace(" "+C+" "," ")))}function dh(f,C){void 0===f.className.baseVal?f.className=C:f.className.baseVal=C}function Wi(f){return f.correspondingElement&&(f=f.correspondingElement),void 0===f.className.baseVal?f.className:f.className.baseVal}function Hs(f,C){"opacity"in f.style?f.style.opacity=C:"filter"in f.style&&function to(f,C){var P=!1,B="DXImageTransform.Microsoft.Alpha";try{P=f.filters.item(B)}catch{if(1===C)return}C=Math.round(100*C),P?(P.Enabled=100!==C,P.Opacity=C):f.style.filter+=" progid:"+B+"(opacity="+C+")"}(f,C)}function Il(f){for(var C=document.documentElement.style,P=0;P<f.length;P++)if(f[P]in C)return f[P];return!1}function sc(f,C,P){var B=C||new pt(0,0);f.style[Sl]=(gn.ie3d?"translate("+B.x+"px,"+B.y+"px)":"translate3d("+B.x+"px,"+B.y+"px,0)")+(P?" scale("+P+")":"")}function dr(f,C){f._leaflet_pos=C,gn.any3d?sc(f,C):(f.style.left=C.x+"px",f.style.top=C.y+"px")}function Gi(f){return f._leaflet_pos||new pt(0,0)}if("onselectstart"in document)ti=function(){$n(window,"selectstart",rr)},Uo=function(){yn(window,"selectstart",rr)};else{var fh=Il(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);ti=function(){if(fh){var f=document.documentElement.style;Wo=f[fh],f[fh]="none"}},Uo=function(){fh&&(document.documentElement.style[fh]=Wo,Wo=void 0)}}function La(){$n(window,"dragstart",rr)}function Pl(){yn(window,"dragstart",rr)}function Fi(f){for(;-1===f.tabIndex;)f=f.parentNode;f.style&&(Oa(),oi=f,Zs=f.style.outlineStyle,f.style.outlineStyle="none",$n(window,"keydown",Oa))}function Oa(){oi&&(oi.style.outlineStyle=Zs,oi=void 0,Zs=void 0,yn(window,"keydown",Oa))}function go(f){do{f=f.parentNode}while(!(f.offsetWidth&&f.offsetHeight||f===document.body));return f}function So(f){var C=f.getBoundingClientRect();return{x:C.width/f.offsetWidth||1,y:C.height/f.offsetHeight||1,boundingClientRect:C}}var ss={__proto__:null,TRANSFORM:Sl,TRANSITION:_r,TRANSITION_END:Ra,get:ua,getStyle:os,create:Ai,remove:Qi,empty:Rc,toFront:el,toBack:xa,hasClass:ld,addClass:On,removeClass:eo,setClass:dh,getClass:Wi,setOpacity:Hs,testProp:Il,setTransform:sc,setPosition:dr,getPosition:Gi,get disableTextSelection(){return ti},get enableTextSelection(){return Uo},disableImageDrag:La,enableImageDrag:Pl,preventOutline:Fi,restoreOutline:Oa,getSizedParentNode:go,getScale:So};function $n(f,C,P,B){if(C&&"object"==typeof C)for(var Y in C)$o(f,Y,C[Y],P);else for(var _e=0,qe=(C=ue(C)).length;_e<qe;_e++)$o(f,C[_e],P,B);return this}var si="_leaflet_events";function yn(f,C,P,B){if(1===arguments.length)as(f),delete f[si];else if(C&&"object"==typeof C)for(var Y in C)cd(f,Y,C[Y],P);else if(C=ue(C),2===arguments.length)as(f,function(at){return-1!==ct(C,at)});else for(var _e=0,qe=C.length;_e<qe;_e++)cd(f,C[_e],P,B);return this}function as(f,C){for(var P in f[si]){var B=P.split(/\d/)[0];(!C||C(B))&&cd(f,B,null,null,P)}}var ls={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function $o(f,C,P,B){var Y=C+he(P)+(B?"_"+he(B):"");if(f[si]&&f[si][Y])return this;var _e=function(at){return P.call(B||f,at||window.event)},qe=_e;!gn.touchNative&&gn.pointer&&0===C.indexOf("touch")?_e=kn(f,C,_e):gn.touch&&"dblclick"===C?_e=function Ja(f,C){f.addEventListener("dblclick",C);var B,P=0;function Y(_e){if(1===_e.detail){if("mouse"!==_e.pointerType&&(!_e.sourceCapabilities||_e.sourceCapabilities.firesTouchEvents)){var qe=cs(_e);if(!qe.some(function(wt){return wt instanceof HTMLLabelElement&&wt.attributes.for})||qe.some(function(wt){return wt instanceof HTMLInputElement||wt instanceof HTMLSelectElement})){var at=Date.now();at-P<=200?2==++B&&C(function Et(f){var P,B,C={};for(B in f)C[B]=(P=f[B])&&P.bind?P.bind(f):P;return f=C,C.type="dblclick",C.detail=2,C.isTrusted=!1,C._simulated=!0,C}(_e)):B=1,P=at}}}else B=_e.detail}return f.addEventListener("click",Y),{dblclick:C,simDblclick:Y}}(f,_e):"addEventListener"in f?"touchstart"===C||"touchmove"===C||"wheel"===C||"mousewheel"===C?f.addEventListener(ls[C]||C,_e,!!gn.passiveEvents&&{passive:!1}):"mouseenter"===C||"mouseleave"===C?f.addEventListener(ls[C],_e=function(at){at=at||window.event,ai(f,at)&&qe(at)},!1):f.addEventListener(C,qe,!1):f.attachEvent("on"+C,_e),f[si]=f[si]||{},f[si][Y]=_e}function cd(f,C,P,B,Y){Y=Y||C+he(P)+(B?"_"+he(B):"");var _e=f[si]&&f[si][Y];if(!_e)return this;!gn.touchNative&&gn.pointer&&0===C.indexOf("touch")?function ka(f,C,P){Un[C]?f.removeEventListener(Un[C],P,!1):console.warn("wrong event specified:",C)}(f,C,_e):gn.touch&&"dblclick"===C?function Gs(f,C){f.removeEventListener("dblclick",C.dblclick),f.removeEventListener("click",C.simDblclick)}(f,_e):"removeEventListener"in f?f.removeEventListener(ls[C]||C,_e,!1):f.detachEvent("on"+C,_e),f[si][Y]=null}function qs(f){return f.stopPropagation?f.stopPropagation():f.originalEvent?f.originalEvent._stopped=!0:f.cancelBubble=!0,this}function an(f){return $o(f,"wheel",qs),this}function tl(f){return $n(f,"mousedown touchstart dblclick contextmenu",qs),f._leaflet_disable_click=!0,this}function rr(f){return f.preventDefault?f.preventDefault():f.returnValue=!1,this}function Ts(f){return rr(f),qs(f),this}function cs(f){if(f.composedPath)return f.composedPath();for(var C=[],P=f.target;P;)C.push(P),P=P.parentNode;return C}function fr(f,C){if(!C)return new pt(f.clientX,f.clientY);var P=So(C),B=P.boundingClientRect;return new pt((f.clientX-B.left)/P.x-C.clientLeft,(f.clientY-B.top)/P.y-C.clientTop)}var Fa=gn.linux&&gn.chrome?window.devicePixelRatio:gn.mac?3*window.devicePixelRatio:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function ki(f){return gn.edge?f.wheelDeltaY/2:f.deltaY&&0===f.deltaMode?-f.deltaY/Fa:f.deltaY&&1===f.deltaMode?20*-f.deltaY:f.deltaY&&2===f.deltaMode?60*-f.deltaY:f.deltaX||f.deltaZ?0:f.wheelDelta?(f.wheelDeltaY||f.wheelDelta)/2:f.detail&&Math.abs(f.detail)<32765?20*-f.detail:f.detail?f.detail/-32765*60:0}function ai(f,C){var P=C.relatedTarget;if(!P)return!0;try{for(;P&&P!==f;)P=P.parentNode}catch{return!1}return P!==f}var Al={__proto__:null,on:$n,off:yn,stopPropagation:qs,disableScrollPropagation:an,disableClickPropagation:tl,preventDefault:rr,stop:Ts,getPropagationPath:cs,getMousePosition:fr,getWheelDelta:ki,isExternalTarget:ai,addListener:$n,removeListener:yn},Ri=Qn.extend({run:function(f,C,P,B){this.stop(),this._el=f,this._inProgress=!0,this._duration=P||.25,this._easeOutPower=1/Math.max(B||.5,.2),this._startPos=Gi(f),this._offset=C.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=Ze(this._animate,this),this._step()},_step:function(f){var C=+new Date-this._startTime,P=1e3*this._duration;C<P?this._runFrame(this._easeOut(C/P),f):(this._runFrame(1),this._complete())},_runFrame:function(f,C){var P=this._startPos.add(this._offset.multiplyBy(f));C&&P._round(),dr(this._el,P),this.fire("step")},_complete:function(){Dt(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(f){return 1-Math.pow(1-f,this._easeOutPower)}}),Li=Qn.extend({options:{crs:ne,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(f,C){C=K(this,C),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(f),this._initLayout(),this._onResize=p(this._onResize,this),this._initEvents(),C.maxBounds&&this.setMaxBounds(C.maxBounds),void 0!==C.zoom&&(this._zoom=this._limitZoom(C.zoom)),C.center&&void 0!==C.zoom&&this.setView(zn(C.center),C.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=_r&&gn.any3d&&!gn.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),$n(this._proxy,Ra,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(f,C,P){return C=void 0===C?this._zoom:this._limitZoom(C),f=this._limitCenter(zn(f),C,this.options.maxBounds),P=P||{},this._stop(),this._loaded&&!P.reset&&!0!==P&&(void 0!==P.animate&&(P.zoom=Pe({animate:P.animate},P.zoom),P.pan=Pe({animate:P.animate,duration:P.duration},P.pan)),this._zoom!==C?this._tryAnimatedZoom&&this._tryAnimatedZoom(f,C,P.zoom):this._tryAnimatedPan(f,P.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(f,C,P.pan&&P.pan.noMoveStart),this)},setZoom:function(f,C){return this._loaded?this.setView(this.getCenter(),f,{zoom:C}):(this._zoom=f,this)},zoomIn:function(f,C){return this.setZoom(this._zoom+(f=f||(gn.any3d?this.options.zoomDelta:1)),C)},zoomOut:function(f,C){return this.setZoom(this._zoom-(f=f||(gn.any3d?this.options.zoomDelta:1)),C)},setZoomAround:function(f,C,P){var B=this.getZoomScale(C),Y=this.getSize().divideBy(2),qe=(f instanceof pt?f:this.latLngToContainerPoint(f)).subtract(Y).multiplyBy(1-1/B),at=this.containerPointToLatLng(Y.add(qe));return this.setView(at,C,{zoom:P})},_getBoundsCenterZoom:function(f,C){C=C||{},f=f.getBounds?f.getBounds():Wt(f);var P=nt(C.paddingTopLeft||C.padding||[0,0]),B=nt(C.paddingBottomRight||C.padding||[0,0]),Y=this.getBoundsZoom(f,!1,P.add(B));if((Y="number"==typeof C.maxZoom?Math.min(C.maxZoom,Y):Y)===1/0)return{center:f.getCenter(),zoom:Y};var _e=B.subtract(P).divideBy(2),qe=this.project(f.getSouthWest(),Y),at=this.project(f.getNorthEast(),Y);return{center:this.unproject(qe.add(at).divideBy(2).add(_e),Y),zoom:Y}},fitBounds:function(f,C){if(!(f=Wt(f)).isValid())throw new Error("Bounds are not valid.");var P=this._getBoundsCenterZoom(f,C);return this.setView(P.center,P.zoom,C)},fitWorld:function(f){return this.fitBounds([[-90,-180],[90,180]],f)},panTo:function(f,C){return this.setView(f,this._zoom,{pan:C})},panBy:function(f,C){if(C=C||{},!(f=nt(f).round()).x&&!f.y)return this.fire("moveend");if(!0!==C.animate&&!this.getSize().contains(f))return this._resetView(this.unproject(this.project(this.getCenter()).add(f)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Ri,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),C.noMoveStart||this.fire("movestart"),!1!==C.animate){On(this._mapPane,"leaflet-pan-anim");var P=this._getMapPanePos().subtract(f).round();this._panAnim.run(this._mapPane,P,C.duration||.25,C.easeLinearity)}else this._rawPanBy(f),this.fire("move").fire("moveend");return this},flyTo:function(f,C,P){if(!1===(P=P||{}).animate||!gn.any3d)return this.setView(f,C,P);this._stop();var B=this.project(this.getCenter()),Y=this.project(f),_e=this.getSize(),qe=this._zoom;f=zn(f),C=void 0===C?qe:C;var at=Math.max(_e.x,_e.y),wt=at*this.getZoomScale(qe,C),Yt=Y.distanceTo(B)||1,wn=1.42,ei=wn*wn;function Ti(Ni){var Qs=(wt*wt-at*at+(Ni?-1:1)*ei*ei*Yt*Yt)/(2*(Ni?wt:at)*ei*Yt),Kn=Math.sqrt(Qs*Qs+1)-Qs;return Kn<1e-9?-18:Math.log(Kn)}function Ko(Ni){return(Math.exp(Ni)-Math.exp(-Ni))/2}function Eo(Ni){return(Math.exp(Ni)+Math.exp(-Ni))/2}var Qo=Ti(0);function $c(Ni){return at*(Eo(Qo)*function ms(Ni){return Ko(Ni)/Eo(Ni)}(Qo+wn*Ni)-Ko(Qo))/ei}var Zt=Date.now(),An=(Ti(1)-Qo)/wn,vr=P.duration?1e3*P.duration:1e3*An*.8;return this._moveStart(!0,P.noMoveStart),function Br(){var Ni=(Date.now()-Zt)/vr,Vr=function ni(Ni){return 1-Math.pow(1-Ni,1.5)}(Ni)*An;Ni<=1?(this._flyToFrame=Ze(Br,this),this._move(this.unproject(B.add(Y.subtract(B).multiplyBy($c(Vr)/Yt)),qe),this.getScaleZoom(at/function sl(Ni){return at*(Eo(Qo)/Eo(Qo+wn*Ni))}(Vr),qe),{flyTo:!0})):this._move(f,C)._moveEnd(!0)}.call(this),this},flyToBounds:function(f,C){var P=this._getBoundsCenterZoom(f,C);return this.flyTo(P.center,P.zoom,C)},setMaxBounds:function(f){return f=Wt(f),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),f.isValid()?(this.options.maxBounds=f,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(f){var C=this.options.minZoom;return this.options.minZoom=f,this._loaded&&C!==f&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(f):this},setMaxZoom:function(f){var C=this.options.maxZoom;return this.options.maxZoom=f,this._loaded&&C!==f&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(f):this},panInsideBounds:function(f,C){this._enforcingBounds=!0;var P=this.getCenter(),B=this._limitCenter(P,this._zoom,Wt(f));return P.equals(B)||this.panTo(B,C),this._enforcingBounds=!1,this},panInside:function(f,C){var P=nt((C=C||{}).paddingTopLeft||C.padding||[0,0]),B=nt(C.paddingBottomRight||C.padding||[0,0]),Y=this.project(this.getCenter()),_e=this.project(f),qe=this.getPixelBounds(),at=Sn([qe.min.add(P),qe.max.subtract(B)]),wt=at.getSize();if(!at.contains(_e)){this._enforcingBounds=!0;var Yt=_e.subtract(at.getCenter()),wn=at.extend(_e).getSize().subtract(wt);Y.x+=Yt.x<0?-wn.x:wn.x,Y.y+=Yt.y<0?-wn.y:wn.y,this.panTo(this.unproject(Y),C),this._enforcingBounds=!1}return this},invalidateSize:function(f){if(!this._loaded)return this;f=Pe({animate:!1,pan:!0},!0===f?{animate:!0}:f);var C=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var P=this.getSize(),B=C.divideBy(2).round(),Y=P.divideBy(2).round(),_e=B.subtract(Y);return _e.x||_e.y?(f.animate&&f.pan?this.panBy(_e):(f.pan&&this._rawPanBy(_e),this.fire("move"),f.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(p(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:C,newSize:P})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(f){if(f=this._locateOptions=Pe({timeout:1e4,watch:!1},f),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var C=p(this._handleGeolocationResponse,this),P=p(this._handleGeolocationError,this);return f.watch?this._locationWatchId=navigator.geolocation.watchPosition(C,P,f):navigator.geolocation.getCurrentPosition(C,P,f),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(f){if(this._container._leaflet_id){var C=f.code,P=f.message||(1===C?"permission denied":2===C?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:C,message:"Geolocation error: "+P+"."})}},_handleGeolocationResponse:function(f){if(this._container._leaflet_id){var B=new Pn(f.coords.latitude,f.coords.longitude),Y=B.toBounds(2*f.coords.accuracy),_e=this._locateOptions;if(_e.setView){var qe=this.getBoundsZoom(Y);this.setView(B,_e.maxZoom?Math.min(qe,_e.maxZoom):qe)}var at={latlng:B,bounds:Y,timestamp:f.timestamp};for(var wt in f.coords)"number"==typeof f.coords[wt]&&(at[wt]=f.coords[wt]);this.fire("locationfound",at)}},addHandler:function(f,C){if(!C)return this;var P=this[f]=new C(this);return this._handlers.push(P),this.options[f]&&P.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}var f;for(f in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),Qi(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(Dt(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[f].remove();for(f in this._panes)Qi(this._panes[f]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(f,C){var B=Ai("div","leaflet-pane"+(f?" leaflet-"+f.replace("Pane","")+"-pane":""),C||this._mapPane);return f&&(this._panes[f]=B),B},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var f=this.getPixelBounds();return new ln(this.unproject(f.getBottomLeft()),this.unproject(f.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(f,C,P){f=Wt(f),P=nt(P||[0,0]);var B=this.getZoom()||0,Y=this.getMinZoom(),_e=this.getMaxZoom(),qe=f.getNorthWest(),at=f.getSouthEast(),wt=this.getSize().subtract(P),Yt=Sn(this.project(at,B),this.project(qe,B)).getSize(),wn=gn.any3d?this.options.zoomSnap:1,ei=wt.x/Yt.x,Ti=wt.y/Yt.y,Ko=C?Math.max(ei,Ti):Math.min(ei,Ti);return B=this.getScaleZoom(Ko,B),wn&&(B=Math.round(B/(wn/100))*(wn/100),B=C?Math.ceil(B/wn)*wn:Math.floor(B/wn)*wn),Math.max(Y,Math.min(_e,B))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new pt(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(f,C){var P=this._getTopLeftPoint(f,C);return new ht(P,P.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(f){return this.options.crs.getProjectedBounds(void 0===f?this.getZoom():f)},getPane:function(f){return"string"==typeof f?this._panes[f]:f},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(f,C){var P=this.options.crs;return C=void 0===C?this._zoom:C,P.scale(f)/P.scale(C)},getScaleZoom:function(f,C){var P=this.options.crs,B=P.zoom(f*P.scale(C=void 0===C?this._zoom:C));return isNaN(B)?1/0:B},project:function(f,C){return C=void 0===C?this._zoom:C,this.options.crs.latLngToPoint(zn(f),C)},unproject:function(f,C){return C=void 0===C?this._zoom:C,this.options.crs.pointToLatLng(nt(f),C)},layerPointToLatLng:function(f){var C=nt(f).add(this.getPixelOrigin());return this.unproject(C)},latLngToLayerPoint:function(f){return this.project(zn(f))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(f){return this.options.crs.wrapLatLng(zn(f))},wrapLatLngBounds:function(f){return this.options.crs.wrapLatLngBounds(Wt(f))},distance:function(f,C){return this.options.crs.distance(zn(f),zn(C))},containerPointToLayerPoint:function(f){return nt(f).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(f){return nt(f).add(this._getMapPanePos())},containerPointToLatLng:function(f){var C=this.containerPointToLayerPoint(nt(f));return this.layerPointToLatLng(C)},latLngToContainerPoint:function(f){return this.layerPointToContainerPoint(this.latLngToLayerPoint(zn(f)))},mouseEventToContainerPoint:function(f){return fr(f,this._container)},mouseEventToLayerPoint:function(f){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(f))},mouseEventToLatLng:function(f){return this.layerPointToLatLng(this.mouseEventToLayerPoint(f))},_initContainer:function(f){var C=this._container=ua(f);if(!C)throw new Error("Map container not found.");if(C._leaflet_id)throw new Error("Map container is already initialized.");$n(C,"scroll",this._onScroll,this),this._containerId=he(C)},_initLayout:function(){var f=this._container;this._fadeAnimated=this.options.fadeAnimation&&gn.any3d,On(f,"leaflet-container"+(gn.touch?" leaflet-touch":"")+(gn.retina?" leaflet-retina":"")+(gn.ielt9?" leaflet-oldie":"")+(gn.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var C=os(f,"position");"absolute"!==C&&"relative"!==C&&"fixed"!==C&&"sticky"!==C&&(f.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var f=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),dr(this._mapPane,new pt(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(On(f.markerPane,"leaflet-zoom-hide"),On(f.shadowPane,"leaflet-zoom-hide"))},_resetView:function(f,C,P){dr(this._mapPane,new pt(0,0));var B=!this._loaded;this._loaded=!0,C=this._limitZoom(C),this.fire("viewprereset");var Y=this._zoom!==C;this._moveStart(Y,P)._move(f,C)._moveEnd(Y),this.fire("viewreset"),B&&this.fire("load")},_moveStart:function(f,C){return f&&this.fire("zoomstart"),C||this.fire("movestart"),this},_move:function(f,C,P,B){void 0===C&&(C=this._zoom);var Y=this._zoom!==C;return this._zoom=C,this._lastCenter=f,this._pixelOrigin=this._getNewPixelOrigin(f),B?P&&P.pinch&&this.fire("zoom",P):((Y||P&&P.pinch)&&this.fire("zoom",P),this.fire("move",P)),this},_moveEnd:function(f){return f&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return Dt(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(f){dr(this._mapPane,this._getMapPanePos().subtract(f))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(f){this._targets={},this._targets[he(this._container)]=this;var C=f?yn:$n;C(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&C(window,"resize",this._onResize,this),gn.any3d&&this.options.transform3DLimit&&(f?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){Dt(this._resizeRequest),this._resizeRequest=Ze(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var f=this._getMapPanePos();Math.max(Math.abs(f.x),Math.abs(f.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(f,C){for(var B,P=[],Y="mouseout"===C||"mouseover"===C,_e=f.target||f.srcElement,qe=!1;_e;){if((B=this._targets[he(_e)])&&("click"===C||"preclick"===C)&&this._draggableMoved(B)){qe=!0;break}if(B&&B.listens(C,!0)&&(Y&&!ai(_e,f)||(P.push(B),Y))||_e===this._container)break;_e=_e.parentNode}return!P.length&&!qe&&!Y&&this.listens(C,!0)&&(P=[this]),P},_isClickDisabled:function(f){for(;f&&f!==this._container;){if(f._leaflet_disable_click)return!0;f=f.parentNode}},_handleDOMEvent:function(f){var C=f.target||f.srcElement;if(!(!this._loaded||C._leaflet_disable_events||"click"===f.type&&this._isClickDisabled(C))){var P=f.type;"mousedown"===P&&Fi(C),this._fireDOMEvent(f,P)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(f,C,P){if("click"===f.type){var B=Pe({},f);B.type="preclick",this._fireDOMEvent(B,B.type,P)}var Y=this._findEventTargets(f,C);if(P){for(var _e=[],qe=0;qe<P.length;qe++)P[qe].listens(C,!0)&&_e.push(P[qe]);Y=_e.concat(Y)}if(Y.length){"contextmenu"===C&&rr(f);var at=Y[0],wt={originalEvent:f};if("keypress"!==f.type&&"keydown"!==f.type&&"keyup"!==f.type){var Yt=at.getLatLng&&(!at._radius||at._radius<=10);wt.containerPoint=Yt?this.latLngToContainerPoint(at.getLatLng()):this.mouseEventToContainerPoint(f),wt.layerPoint=this.containerPointToLayerPoint(wt.containerPoint),wt.latlng=Yt?at.getLatLng():this.layerPointToLatLng(wt.layerPoint)}for(qe=0;qe<Y.length;qe++)if(Y[qe].fire(C,wt,!0),wt.originalEvent._stopped||!1===Y[qe].options.bubblingMouseEvents&&-1!==ct(this._mouseEvents,C))return}},_draggableMoved:function(f){return(f=f.dragging&&f.dragging.enabled()?f:this).dragging&&f.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var f=0,C=this._handlers.length;f<C;f++)this._handlers[f].disable()},whenReady:function(f,C){return this._loaded?f.call(C||this,{target:this}):this.on("load",f,C),this},_getMapPanePos:function(){return Gi(this._mapPane)||new pt(0,0)},_moved:function(){var f=this._getMapPanePos();return f&&!f.equals([0,0])},_getTopLeftPoint:function(f,C){return(f&&void 0!==C?this._getNewPixelOrigin(f,C):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(f,C){var P=this.getSize()._divideBy(2);return this.project(f,C)._subtract(P)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(f,C,P){var B=this._getNewPixelOrigin(P,C);return this.project(f,C)._subtract(B)},_latLngBoundsToNewLayerBounds:function(f,C,P){var B=this._getNewPixelOrigin(P,C);return Sn([this.project(f.getSouthWest(),C)._subtract(B),this.project(f.getNorthWest(),C)._subtract(B),this.project(f.getSouthEast(),C)._subtract(B),this.project(f.getNorthEast(),C)._subtract(B)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(f){return this.latLngToLayerPoint(f).subtract(this._getCenterLayerPoint())},_limitCenter:function(f,C,P){if(!P)return f;var B=this.project(f,C),Y=this.getSize().divideBy(2),_e=new ht(B.subtract(Y),B.add(Y)),qe=this._getBoundsOffset(_e,P,C);return Math.abs(qe.x)<=1&&Math.abs(qe.y)<=1?f:this.unproject(B.add(qe),C)},_limitOffset:function(f,C){if(!C)return f;var P=this.getPixelBounds(),B=new ht(P.min.add(f),P.max.add(f));return f.add(this._getBoundsOffset(B,C))},_getBoundsOffset:function(f,C,P){var B=Sn(this.project(C.getNorthEast(),P),this.project(C.getSouthWest(),P)),Y=B.min.subtract(f.min),_e=B.max.subtract(f.max);return new pt(this._rebound(Y.x,-_e.x),this._rebound(Y.y,-_e.y))},_rebound:function(f,C){return f+C>0?Math.round(f-C)/2:Math.max(0,Math.ceil(f))-Math.max(0,Math.floor(C))},_limitZoom:function(f){var C=this.getMinZoom(),P=this.getMaxZoom(),B=gn.any3d?this.options.zoomSnap:1;return B&&(f=Math.round(f/B)*B),Math.max(C,Math.min(P,f))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){eo(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(f,C){var P=this._getCenterOffset(f)._trunc();return!(!0!==(C&&C.animate)&&!this.getSize().contains(P)||(this.panBy(P,C),0))},_createAnimProxy:function(){var f=this._proxy=Ai("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(f),this.on("zoomanim",function(C){var P=Sl,B=this._proxy.style[P];sc(this._proxy,this.project(C.center,C.zoom),this.getZoomScale(C.zoom,1)),B===this._proxy.style[P]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Qi(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var f=this.getCenter(),C=this.getZoom();sc(this._proxy,this.project(f,C),this.getZoomScale(C,1))},_catchTransitionEnd:function(f){this._animatingZoom&&f.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(f,C,P){if(this._animatingZoom)return!0;if(P=P||{},!this._zoomAnimated||!1===P.animate||this._nothingToAnimate()||Math.abs(C-this._zoom)>this.options.zoomAnimationThreshold)return!1;var B=this.getZoomScale(C),Y=this._getCenterOffset(f)._divideBy(1-1/B);return!(!0!==P.animate&&!this.getSize().contains(Y)||(Ze(function(){this._moveStart(!0,P.noMoveStart||!1)._animateZoom(f,C,!0)},this),0))},_animateZoom:function(f,C,P,B){this._mapPane&&(P&&(this._animatingZoom=!0,this._animateToCenter=f,this._animateToZoom=C,On(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:f,zoom:C,noUpdate:B}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(p(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&eo(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});var Go=Rt.extend({options:{position:"topright"},initialize:function(f){K(this,f)},getPosition:function(){return this.options.position},setPosition:function(f){var C=this._map;return C&&C.removeControl(this),this.options.position=f,C&&C.addControl(this),this},getContainer:function(){return this._container},addTo:function(f){this.remove(),this._map=f;var C=this._container=this.onAdd(f),P=this.getPosition(),B=f._controlCorners[P];return On(C,"leaflet-control"),-1!==P.indexOf("bottom")?B.insertBefore(C,B.firstChild):B.appendChild(C),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Qi(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(f){this._map&&f&&f.screenX>0&&f.screenY>0&&this._map.getContainer().focus()}}),Ds=function(f){return new Go(f)};Li.include({addControl:function(f){return f.addTo(this),this},removeControl:function(f){return f.remove(),this},_initControlPos:function(){var f=this._controlCorners={},C="leaflet-",P=this._controlContainer=Ai("div",C+"control-container",this._container);function B(Y,_e){f[Y+_e]=Ai("div",C+Y+" "+C+_e,P)}B("top","left"),B("top","right"),B("bottom","left"),B("bottom","right")},_clearControlPos:function(){for(var f in this._controlCorners)Qi(this._controlCorners[f]);Qi(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Lc=Go.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(f,C,P,B){return P<B?-1:B<P?1:0}},initialize:function(f,C,P){for(var B in K(this,P),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1,f)this._addLayer(f[B],B);for(B in C)this._addLayer(C[B],B,!0)},onAdd:function(f){this._initLayout(),this._update(),this._map=f,f.on("zoomend",this._checkDisabledLayers,this);for(var C=0;C<this._layers.length;C++)this._layers[C].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(f){return Go.prototype.addTo.call(this,f),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var f=0;f<this._layers.length;f++)this._layers[f].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(f,C){return this._addLayer(f,C),this._map?this._update():this},addOverlay:function(f,C){return this._addLayer(f,C,!0),this._map?this._update():this},removeLayer:function(f){f.off("add remove",this._onLayerChange,this);var C=this._getLayer(he(f));return C&&this._layers.splice(this._layers.indexOf(C),1),this._map?this._update():this},expand:function(){On(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var f=this._map.getSize().y-(this._container.offsetTop+50);return f<this._section.clientHeight?(On(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=f+"px"):eo(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return eo(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var f="leaflet-control-layers",C=this._container=Ai("div",f),P=this.options.collapsed;C.setAttribute("aria-haspopup",!0),tl(C),an(C);var B=this._section=Ai("section",f+"-list");P&&(this._map.on("click",this.collapse,this),$n(C,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var Y=this._layersLink=Ai("a",f+"-toggle",C);Y.href="#",Y.title="Layers",Y.setAttribute("role","button"),$n(Y,{keydown:function(_e){13===_e.keyCode&&this._expandSafely()},click:function(_e){rr(_e),this._expandSafely()}},this),P||this.expand(),this._baseLayersList=Ai("div",f+"-base",B),this._separator=Ai("div",f+"-separator",B),this._overlaysList=Ai("div",f+"-overlays",B),C.appendChild(B)},_getLayer:function(f){for(var C=0;C<this._layers.length;C++)if(this._layers[C]&&he(this._layers[C].layer)===f)return this._layers[C]},_addLayer:function(f,C,P){this._map&&f.on("add remove",this._onLayerChange,this),this._layers.push({layer:f,name:C,overlay:P}),this.options.sortLayers&&this._layers.sort(p(function(B,Y){return this.options.sortFunction(B.layer,Y.layer,B.name,Y.name)},this)),this.options.autoZIndex&&f.setZIndex&&(this._lastZIndex++,f.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Rc(this._baseLayersList),Rc(this._overlaysList),this._layerControlInputs=[];var f,C,P,B,Y=0;for(P=0;P<this._layers.length;P++)this._addItem(B=this._layers[P]),C=C||B.overlay,f=f||!B.overlay,Y+=B.overlay?0:1;return this.options.hideSingleBase&&(this._baseLayersList.style.display=(f=f&&Y>1)?"":"none"),this._separator.style.display=C&&f?"":"none",this},_onLayerChange:function(f){this._handlingClick||this._update();var C=this._getLayer(he(f.target)),P=C.overlay?"add"===f.type?"overlayadd":"overlayremove":"add"===f.type?"baselayerchange":null;P&&this._map.fire(P,C)},_createRadioElement:function(f,C){var P='<input type="radio" class="leaflet-control-layers-selector" name="'+f+'"'+(C?' checked="checked"':"")+"/>",B=document.createElement("div");return B.innerHTML=P,B.firstChild},_addItem:function(f){var B,C=document.createElement("label"),P=this._map.hasLayer(f.layer);f.overlay?((B=document.createElement("input")).type="checkbox",B.className="leaflet-control-layers-selector",B.defaultChecked=P):B=this._createRadioElement("leaflet-base-layers_"+he(this),P),this._layerControlInputs.push(B),B.layerId=he(f.layer),$n(B,"click",this._onInputClick,this);var Y=document.createElement("span");Y.innerHTML=" "+f.name;var _e=document.createElement("span");return C.appendChild(_e),_e.appendChild(B),_e.appendChild(Y),(f.overlay?this._overlaysList:this._baseLayersList).appendChild(C),this._checkDisabledLayers(),C},_onInputClick:function(){if(!this._preventClick){var C,P,f=this._layerControlInputs,B=[],Y=[];this._handlingClick=!0;for(var _e=f.length-1;_e>=0;_e--)P=this._getLayer((C=f[_e]).layerId).layer,C.checked?B.push(P):C.checked||Y.push(P);for(_e=0;_e<Y.length;_e++)this._map.hasLayer(Y[_e])&&this._map.removeLayer(Y[_e]);for(_e=0;_e<B.length;_e++)this._map.hasLayer(B[_e])||this._map.addLayer(B[_e]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var C,P,f=this._layerControlInputs,B=this._map.getZoom(),Y=f.length-1;Y>=0;Y--)P=this._getLayer((C=f[Y]).layerId).layer,C.disabled=void 0!==P.options.minZoom&&B<P.options.minZoom||void 0!==P.options.maxZoom&&B>P.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var f=this._section;this._preventClick=!0,$n(f,"click",rr),this.expand();var C=this;setTimeout(function(){yn(f,"click",rr),C._preventClick=!1})}}),lc=Go.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(f){var C="leaflet-control-zoom",P=Ai("div",C+" leaflet-bar"),B=this.options;return this._zoomInButton=this._createButton(B.zoomInText,B.zoomInTitle,C+"-in",P,this._zoomIn),this._zoomOutButton=this._createButton(B.zoomOutText,B.zoomOutTitle,C+"-out",P,this._zoomOut),this._updateDisabled(),f.on("zoomend zoomlevelschange",this._updateDisabled,this),P},onRemove:function(f){f.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(f){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(f.shiftKey?3:1))},_zoomOut:function(f){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(f.shiftKey?3:1))},_createButton:function(f,C,P,B,Y){var _e=Ai("a",P,B);return _e.innerHTML=f,_e.href="#",_e.title=C,_e.setAttribute("role","button"),_e.setAttribute("aria-label",C),tl(_e),$n(_e,"click",Ts),$n(_e,"click",Y,this),$n(_e,"click",this._refocusOnMap,this),_e},_updateDisabled:function(){var f=this._map,C="leaflet-disabled";eo(this._zoomInButton,C),eo(this._zoomOutButton,C),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||f._zoom===f.getMinZoom())&&(On(this._zoomOutButton,C),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||f._zoom===f.getMaxZoom())&&(On(this._zoomInButton,C),this._zoomInButton.setAttribute("aria-disabled","true"))}});Li.mergeOptions({zoomControl:!0}),Li.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new lc,this.addControl(this.zoomControl))});var Oc=Go.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(f){var C="leaflet-control-scale",P=Ai("div",C),B=this.options;return this._addScales(B,C+"-line",P),f.on(B.updateWhenIdle?"moveend":"move",this._update,this),f.whenReady(this._update,this),P},onRemove:function(f){f.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(f,C,P){f.metric&&(this._mScale=Ai("div",C,P)),f.imperial&&(this._iScale=Ai("div",C,P))},_update:function(){var f=this._map,C=f.getSize().y/2,P=f.distance(f.containerPointToLatLng([0,C]),f.containerPointToLatLng([this.options.maxWidth,C]));this._updateScales(P)},_updateScales:function(f){this.options.metric&&f&&this._updateMetric(f),this.options.imperial&&f&&this._updateImperial(f)},_updateMetric:function(f){var C=this._getRoundNum(f);this._updateScale(this._mScale,C<1e3?C+" m":C/1e3+" km",C/f)},_updateImperial:function(f){var P,B,Y,C=3.2808399*f;C>5280?(B=this._getRoundNum(P=C/5280),this._updateScale(this._iScale,B+" mi",B/P)):(Y=this._getRoundNum(C),this._updateScale(this._iScale,Y+" ft",Y/C))},_updateScale:function(f,C,P){f.style.width=Math.round(this.options.maxWidth*P)+"px",f.innerHTML=C},_getRoundNum:function(f){var C=Math.pow(10,(Math.floor(f)+"").length-1),P=f/C;return C*(P>=10?10:P>=5?5:P>=3?3:P>=2?2:1)}}),Io=Go.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(gn.inlineSvg?'<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg> ':"")+"Leaflet</a>"},initialize:function(f){K(this,f),this._attributions={}},onAdd:function(f){for(var C in f.attributionControl=this,this._container=Ai("div","leaflet-control-attribution"),tl(this._container),f._layers)f._layers[C].getAttribution&&this.addAttribution(f._layers[C].getAttribution());return this._update(),f.on("layeradd",this._addAttribution,this),this._container},onRemove:function(f){f.off("layeradd",this._addAttribution,this)},_addAttribution:function(f){f.layer.getAttribution&&(this.addAttribution(f.layer.getAttribution()),f.layer.once("remove",function(){this.removeAttribution(f.layer.getAttribution())},this))},setPrefix:function(f){return this.options.prefix=f,this._update(),this},addAttribution:function(f){return f?(this._attributions[f]||(this._attributions[f]=0),this._attributions[f]++,this._update(),this):this},removeAttribution:function(f){return f?(this._attributions[f]&&(this._attributions[f]--,this._update()),this):this},_update:function(){if(this._map){var f=[];for(var C in this._attributions)this._attributions[C]&&f.push(C);var P=[];this.options.prefix&&P.push(this.options.prefix),f.length&&P.push(f.join(", ")),this._container.innerHTML=P.join(' <span aria-hidden="true">|</span> ')}}});Li.mergeOptions({attributionControl:!0}),Li.addInitHook(function(){this.options.attributionControl&&(new Io).addTo(this)});Go.Layers=Lc,Go.Zoom=lc,Go.Scale=Oc,Go.Attribution=Io,Ds.layers=function(f,C,P){return new Lc(f,C,P)},Ds.zoom=function(f){return new lc(f)},Ds.scale=function(f){return new Oc(f)},Ds.attribution=function(f){return new Io(f)};var Ws=Rt.extend({initialize:function(f){this._map=f},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Ws.addTo=function(f,C){return f.addHandler(C,this),this};var Wr={Events:Bt},zr=gn.touch?"touchstart mousedown":"mousedown",_o=Qn.extend({options:{clickTolerance:3},initialize:function(f,C,P,B){K(this,B),this._element=f,this._dragStartTarget=C||f,this._preventOutline=P},enable:function(){this._enabled||($n(this._dragStartTarget,zr,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(_o._dragging===this&&this.finishDrag(!0),yn(this._dragStartTarget,zr,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(f){if(this._enabled&&(this._moved=!1,!ld(this._element,"leaflet-zoom-anim"))){if(f.touches&&1!==f.touches.length)return void(_o._dragging===this&&this.finishDrag());if(!(_o._dragging||f.shiftKey||1!==f.which&&1!==f.button&&!f.touches||(_o._dragging=this,this._preventOutline&&Fi(this._element),La(),ti(),this._moving))){this.fire("down");var C=f.touches?f.touches[0]:f,P=go(this._element);this._startPoint=new pt(C.clientX,C.clientY),this._startPos=Gi(this._element),this._parentScale=So(P);var B="mousedown"===f.type;$n(document,B?"mousemove":"touchmove",this._onMove,this),$n(document,B?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(f){if(this._enabled){if(f.touches&&f.touches.length>1)return void(this._moved=!0);var C=f.touches&&1===f.touches.length?f.touches[0]:f,P=new pt(C.clientX,C.clientY)._subtract(this._startPoint);!P.x&&!P.y||Math.abs(P.x)+Math.abs(P.y)<this.options.clickTolerance||(P.x/=this._parentScale.x,P.y/=this._parentScale.y,rr(f),this._moved||(this.fire("dragstart"),this._moved=!0,On(document.body,"leaflet-dragging"),this._lastTarget=f.target||f.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),On(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(P),this._moving=!0,this._lastEvent=f,this._updatePosition())}},_updatePosition:function(){var f={originalEvent:this._lastEvent};this.fire("predrag",f),dr(this._element,this._newPos),this.fire("drag",f)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(f){eo(document.body,"leaflet-dragging"),this._lastTarget&&(eo(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),yn(document,"mousemove touchmove",this._onMove,this),yn(document,"mouseup touchend touchcancel",this._onUp,this),Pl(),Uo();var C=this._moved&&this._moving;this._moving=!1,_o._dragging=!1,C&&this.fire("dragend",{noInertia:f,distance:this._newPos.distanceTo(this._startPos)})}});function kl(f,C,P){var B,_e,qe,at,wt,Yt,wn,ei,Ti,Y=[1,4,2,8];for(_e=0,wn=f.length;_e<wn;_e++)f[_e]._code=wa(f[_e],C);for(at=0;at<4;at++){for(ei=Y[at],B=[],_e=0,qe=(wn=f.length)-1;_e<wn;qe=_e++)Yt=f[qe],(wt=f[_e])._code&ei?Yt._code&ei||((Ti=ci(Yt,wt,ei,C,P))._code=wa(Ti,C),B.push(Ti)):(Yt._code&ei&&((Ti=ci(Yt,wt,ei,C,P))._code=wa(Ti,C),B.push(Ti)),B.push(wt));f=B}return f}function ha(f,C){var P,B,Y,_e,qe,at,wt,Yt;if(!f||0===f.length)throw new Error("latlngs not passed");Ys(f)||(console.warn("latlngs are not flat! Only the first ring will be used"),f=f[0]);var ei=zn([0,0]),Ti=Wt(f);Ti.getNorthWest().distanceTo(Ti.getSouthWest())*Ti.getNorthEast().distanceTo(Ti.getNorthWest())<1700&&(ei=Rl(f));var Eo=f.length,ms=[];for(P=0;P<Eo;P++){var Qo=zn(f[P]);ms.push(C.project(zn([Qo.lat-ei.lat,Qo.lng-ei.lng])))}for(at=wt=Yt=0,P=0,B=Eo-1;P<Eo;B=P++)wt+=((Y=ms[P]).x+(_e=ms[B]).x)*(qe=Y.y*_e.x-_e.y*Y.x),Yt+=(Y.y+_e.y)*qe,at+=3*qe;var sl=C.unproject(nt(0===at?ms[0]:[wt/at,Yt/at]));return zn([sl.lat+ei.lat,sl.lng+ei.lng])}function Rl(f){for(var C=0,P=0,B=0,Y=0;Y<f.length;Y++){var _e=zn(f[Y]);C+=_e.lat,P+=_e.lng,B++}return zn([C/B,P/B])}var us,da={__proto__:null,clipPolygon:kl,polygonCenter:ha,centroid:Rl};function li(f,C){if(!C||!f.length)return f.slice();var P=C*C;return function nf(f,C){var P=f.length,Y=new(typeof Uint8Array<"u"?Uint8Array:Array)(P);Y[0]=Y[P-1]=1,uc(f,Y,C,0,P-1);var _e,qe=[];for(_e=0;_e<P;_e++)Y[_e]&&qe.push(f[_e]);return qe}(f=function hd(f,C){for(var P=[f[0]],B=1,Y=0,_e=f.length;B<_e;B++)Fc(f[B],f[Y])>C&&(P.push(f[B]),Y=B);return Y<_e-1&&P.push(f[_e-1]),P}(f,P),P)}function Yi(f,C,P){return Math.sqrt(yr(f,C,P,!0))}function uc(f,C,P,B,Y){var qe,at,wt,_e=0;for(at=B+1;at<=Y-1;at++)(wt=yr(f[at],f[B],f[Y],!0))>_e&&(qe=at,_e=wt);_e>P&&(C[qe]=1,uc(f,C,P,B,qe),uc(f,C,P,qe,Y))}function hc(f,C,P,B,Y){var at,wt,Yt,_e=B?us:wa(f,P),qe=wa(C,P);for(us=qe;;){if(!(_e|qe))return[f,C];if(_e&qe)return!1;Yt=wa(wt=ci(f,C,at=_e||qe,P,Y),P),at===_e?(f=wt,_e=Yt):(C=wt,qe=Yt)}}function ci(f,C,P,B,Y){var Yt,wn,_e=C.x-f.x,qe=C.y-f.y,at=B.min,wt=B.max;return 8&P?(Yt=f.x+_e*(wt.y-f.y)/qe,wn=wt.y):4&P?(Yt=f.x+_e*(at.y-f.y)/qe,wn=at.y):2&P?(Yt=wt.x,wn=f.y+qe*(wt.x-f.x)/_e):1&P&&(Yt=at.x,wn=f.y+qe*(at.x-f.x)/_e),new pt(Yt,wn,Y)}function wa(f,C){var P=0;return f.x<C.min.x?P|=1:f.x>C.max.x&&(P|=2),f.y<C.min.y?P|=4:f.y>C.max.y&&(P|=8),P}function Fc(f,C){var P=C.x-f.x,B=C.y-f.y;return P*P+B*B}function yr(f,C,P,B){var Yt,Y=C.x,_e=C.y,qe=P.x-Y,at=P.y-_e,wt=qe*qe+at*at;return wt>0&&((Yt=((f.x-Y)*qe+(f.y-_e)*at)/wt)>1?(Y=P.x,_e=P.y):Yt>0&&(Y+=qe*Yt,_e+=at*Yt)),qe=f.x-Y,at=f.y-_e,B?qe*qe+at*at:new pt(Y,_e)}function Ys(f){return!ot(f[0])||"object"!=typeof f[0][0]&&typeof f[0][0]<"u"}function dd(f){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Ys(f)}function hu(f,C){var P,B,Y,_e,qe,at,wt,Yt;if(!f||0===f.length)throw new Error("latlngs not passed");Ys(f)||(console.warn("latlngs are not flat! Only the first ring will be used"),f=f[0]);var wn=zn([0,0]),ei=Wt(f);ei.getNorthWest().distanceTo(ei.getSouthWest())*ei.getNorthEast().distanceTo(ei.getNorthWest())<1700&&(wn=Rl(f));var Ko=f.length,Eo=[];for(P=0;P<Ko;P++){var ms=zn(f[P]);Eo.push(C.project(zn([ms.lat-wn.lat,ms.lng-wn.lng])))}for(P=0,B=0;P<Ko-1;P++)B+=Eo[P].distanceTo(Eo[P+1])/2;if(0===B)Yt=Eo[0];else for(P=0,_e=0;P<Ko-1;P++)if((_e+=Y=(qe=Eo[P]).distanceTo(at=Eo[P+1]))>B){Yt=[at.x-(wt=(_e-B)/Y)*(at.x-qe.x),at.y-wt*(at.y-qe.y)];break}var Qo=C.unproject(nt(Yt));return zn([Qo.lat+wn.lat,Qo.lng+wn.lng])}var Ms={__proto__:null,simplify:li,pointToSegmentDistance:Yi,closestPointOnSegment:function ig(f,C,P){return yr(f,C,P)},clipSegment:hc,_getEdgeIntersection:ci,_getBitCode:wa,_sqClosestPointOnSegment:yr,isFlat:Ys,_flat:dd,polylineCenter:hu},du={project:function(f){return new pt(f.lng,f.lat)},unproject:function(f){return new Pn(f.y,f.x)},bounds:new ht([-180,-90],[180,90])},Ll={R:6378137,R_MINOR:6356752.314245179,bounds:new ht([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(f){var C=Math.PI/180,P=this.R,B=f.lat*C,Y=this.R_MINOR/P,_e=Math.sqrt(1-Y*Y),qe=_e*Math.sin(B),at=Math.tan(Math.PI/4-B/2)/Math.pow((1-qe)/(1+qe),_e/2);return B=-P*Math.log(Math.max(at,1e-10)),new pt(f.lng*C*P,B)},unproject:function(f){for(var Yt,C=180/Math.PI,P=this.R,B=this.R_MINOR/P,Y=Math.sqrt(1-B*B),_e=Math.exp(-f.y/P),qe=Math.PI/2-2*Math.atan(_e),at=0,wt=.1;at<15&&Math.abs(wt)>1e-7;at++)Yt=Y*Math.sin(qe),Yt=Math.pow((1-Yt)/(1+Yt),Y/2),qe+=wt=Math.PI/2-2*Math.atan(_e*Yt)-qe;return new Pn(qe*C,f.x*C/P)}},fu={__proto__:null,LonLat:du,Mercator:Ll,SphericalMercator:tr},Nc=Pe({},mi,{code:"EPSG:3395",projection:Ll,transformation:function(){var f=.5/(Math.PI*Ll.R);return Jr(f,.5,-f,.5)}()}),fd=Pe({},mi,{code:"EPSG:4326",projection:du,transformation:Jr(1/180,1,-1/180,.5)}),rf=Pe({},Zn,{projection:du,transformation:Jr(1,0,-1,0),scale:function(f){return Math.pow(2,f)},zoom:function(f){return Math.log(f)/Math.LN2},distance:function(f,C){var P=C.lng-f.lng,B=C.lat-f.lat;return Math.sqrt(P*P+B*B)},infinite:!0});Zn.Earth=mi,Zn.EPSG3395=Nc,Zn.EPSG3857=ne,Zn.EPSG900913=kt,Zn.EPSG4326=fd,Zn.Simple=rf;var fa=Qn.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(f){return f.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(f){return f&&f.removeLayer(this),this},getPane:function(f){return this._map.getPane(f?this.options[f]||f:this.options.pane)},addInteractiveTarget:function(f){return this._map._targets[he(f)]=this,this},removeInteractiveTarget:function(f){return delete this._map._targets[he(f)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(f){var C=f.target;if(C.hasLayer(this)){if(this._map=C,this._zoomAnimated=C._zoomAnimated,this.getEvents){var P=this.getEvents();C.on(P,this),this.once("remove",function(){C.off(P,this)},this)}this.onAdd(C),this.fire("add"),C.fire("layeradd",{layer:this})}}});Li.include({addLayer:function(f){if(!f._layerAdd)throw new Error("The provided object is not a Layer.");var C=he(f);return this._layers[C]||(this._layers[C]=f,f._mapToAdd=this,f.beforeAdd&&f.beforeAdd(this),this.whenReady(f._layerAdd,f)),this},removeLayer:function(f){var C=he(f);return this._layers[C]?(this._loaded&&f.onRemove(this),delete this._layers[C],this._loaded&&(this.fire("layerremove",{layer:f}),f.fire("remove")),f._map=f._mapToAdd=null,this):this},hasLayer:function(f){return he(f)in this._layers},eachLayer:function(f,C){for(var P in this._layers)f.call(C,this._layers[P]);return this},_addLayers:function(f){for(var C=0,P=(f=f?ot(f)?f:[f]:[]).length;C<P;C++)this.addLayer(f[C])},_addZoomLimit:function(f){(!isNaN(f.options.maxZoom)||!isNaN(f.options.minZoom))&&(this._zoomBoundLayers[he(f)]=f,this._updateZoomLevels())},_removeZoomLimit:function(f){var C=he(f);this._zoomBoundLayers[C]&&(delete this._zoomBoundLayers[C],this._updateZoomLevels())},_updateZoomLevels:function(){var f=1/0,C=-1/0,P=this._getZoomSpan();for(var B in this._zoomBoundLayers){var Y=this._zoomBoundLayers[B].options;f=void 0===Y.minZoom?f:Math.min(f,Y.minZoom),C=void 0===Y.maxZoom?C:Math.max(C,Y.maxZoom)}this._layersMaxZoom=C===-1/0?void 0:C,this._layersMinZoom=f===1/0?void 0:f,P!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var dc=fa.extend({initialize:function(f,C){var P,B;if(K(this,C),this._layers={},f)for(P=0,B=f.length;P<B;P++)this.addLayer(f[P])},addLayer:function(f){var C=this.getLayerId(f);return this._layers[C]=f,this._map&&this._map.addLayer(f),this},removeLayer:function(f){var C=f in this._layers?f:this.getLayerId(f);return this._map&&this._layers[C]&&this._map.removeLayer(this._layers[C]),delete this._layers[C],this},hasLayer:function(f){return("number"==typeof f?f:this.getLayerId(f))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(f){var P,B,C=Array.prototype.slice.call(arguments,1);for(P in this._layers)(B=this._layers[P])[f]&&B[f].apply(B,C);return this},onAdd:function(f){this.eachLayer(f.addLayer,f)},onRemove:function(f){this.eachLayer(f.removeLayer,f)},eachLayer:function(f,C){for(var P in this._layers)f.call(C,this._layers[P]);return this},getLayer:function(f){return this._layers[f]},getLayers:function(){var f=[];return this.eachLayer(f.push,f),f},setZIndex:function(f){return this.invoke("setZIndex",f)},getLayerId:function(f){return he(f)}}),Ca=dc.extend({addLayer:function(f){return this.hasLayer(f)?this:(f.addEventParent(this),dc.prototype.addLayer.call(this,f),this.fire("layeradd",{layer:f}))},removeLayer:function(f){return this.hasLayer(f)?(f in this._layers&&(f=this._layers[f]),f.removeEventParent(this),dc.prototype.removeLayer.call(this,f),this.fire("layerremove",{layer:f})):this},setStyle:function(f){return this.invoke("setStyle",f)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var f=new ln;for(var C in this._layers){var P=this._layers[C];f.extend(P.getBounds?P.getBounds():P.getLatLng())}return f}}),Ta=Rt.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(f){K(this,f)},createIcon:function(f){return this._createIcon("icon",f)},createShadow:function(f){return this._createIcon("shadow",f)},_createIcon:function(f,C){var P=this._getIconUrl(f);if(!P){if("icon"===f)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var B=this._createImg(P,C&&"IMG"===C.tagName?C:null);return this._setIconStyles(B,f),(this.options.crossOrigin||""===this.options.crossOrigin)&&(B.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),B},_setIconStyles:function(f,C){var P=this.options,B=P[C+"Size"];"number"==typeof B&&(B=[B,B]);var Y=nt(B),_e=nt("shadow"===C&&P.shadowAnchor||P.iconAnchor||Y&&Y.divideBy(2,!0));f.className="leaflet-marker-"+C+" "+(P.className||""),_e&&(f.style.marginLeft=-_e.x+"px",f.style.marginTop=-_e.y+"px"),Y&&(f.style.width=Y.x+"px",f.style.height=Y.y+"px")},_createImg:function(f,C){return(C=C||document.createElement("img")).src=f,C},_getIconUrl:function(f){return gn.retina&&this.options[f+"RetinaUrl"]||this.options[f+"Url"]}});var hs=Ta.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(f){return"string"!=typeof hs.imagePath&&(hs.imagePath=this._detectIconPath()),(this.options.imagePath||hs.imagePath)+Ta.prototype._getIconUrl.call(this,f)},_stripUrl:function(f){var C=function(P,B,Y){var _e=B.exec(P);return _e&&_e[Y]};return(f=C(f,/^url\((['"])?(.+)\1\)$/,2))&&C(f,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var f=Ai("div","leaflet-default-icon-path",document.body),C=os(f,"background-image")||os(f,"backgroundImage");if(document.body.removeChild(f),C=this._stripUrl(C))return C;var P=document.querySelector('link[href$="leaflet.css"]');return P?P.href.substring(0,P.href.length-11-1):""}}),pd=Ws.extend({initialize:function(f){this._marker=f},addHooks:function(){var f=this._marker._icon;this._draggable||(this._draggable=new _o(f,f,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),On(f,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&eo(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(f){var C=this._marker,P=C._map,B=this._marker.options.autoPanSpeed,Y=this._marker.options.autoPanPadding,_e=Gi(C._icon),qe=P.getPixelBounds(),at=P.getPixelOrigin(),wt=Sn(qe.min._subtract(at).add(Y),qe.max._subtract(at).subtract(Y));if(!wt.contains(_e)){var Yt=nt((Math.max(wt.max.x,_e.x)-wt.max.x)/(qe.max.x-wt.max.x)-(Math.min(wt.min.x,_e.x)-wt.min.x)/(qe.min.x-wt.min.x),(Math.max(wt.max.y,_e.y)-wt.max.y)/(qe.max.y-wt.max.y)-(Math.min(wt.min.y,_e.y)-wt.min.y)/(qe.min.y-wt.min.y)).multiplyBy(B);P.panBy(Yt,{animate:!1}),this._draggable._newPos._add(Yt),this._draggable._startPos._add(Yt),dr(C._icon,this._draggable._newPos),this._onDrag(f),this._panRequest=Ze(this._adjustPan.bind(this,f))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(f){this._marker.options.autoPan&&(Dt(this._panRequest),this._panRequest=Ze(this._adjustPan.bind(this,f)))},_onDrag:function(f){var C=this._marker,P=C._shadow,B=Gi(C._icon),Y=C._map.layerPointToLatLng(B);P&&dr(P,B),C._latlng=Y,f.latlng=Y,f.oldLatLng=this._oldLatLng,C.fire("move",f).fire("drag",f)},_onDragEnd:function(f){Dt(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",f)}}),mu=fa.extend({options:{icon:new hs,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(f,C){K(this,C),this._latlng=zn(f)},onAdd:function(f){this._zoomAnimated=this._zoomAnimated&&f.options.markerZoomAnimation,this._zoomAnimated&&f.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(f){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&f.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(f){var C=this._latlng;return this._latlng=zn(f),this.update(),this.fire("move",{oldLatLng:C,latlng:this._latlng})},setZIndexOffset:function(f){return this.options.zIndexOffset=f,this.update()},getIcon:function(){return this.options.icon},setIcon:function(f){return this.options.icon=f,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var f=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(f)}return this},_initIcon:function(){var f=this.options,C="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),P=f.icon.createIcon(this._icon),B=!1;P!==this._icon&&(this._icon&&this._removeIcon(),B=!0,f.title&&(P.title=f.title),"IMG"===P.tagName&&(P.alt=f.alt||"")),On(P,C),f.keyboard&&(P.tabIndex="0",P.setAttribute("role","button")),this._icon=P,f.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&$n(P,"focus",this._panOnFocus,this);var Y=f.icon.createShadow(this._shadow),_e=!1;Y!==this._shadow&&(this._removeShadow(),_e=!0),Y&&(On(Y,C),Y.alt=""),this._shadow=Y,f.opacity<1&&this._updateOpacity(),B&&this.getPane().appendChild(this._icon),this._initInteraction(),Y&&_e&&this.getPane(f.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&yn(this._icon,"focus",this._panOnFocus,this),Qi(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Qi(this._shadow),this._shadow=null},_setPos:function(f){this._icon&&dr(this._icon,f),this._shadow&&dr(this._shadow,f),this._zIndex=f.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(f){this._icon&&(this._icon.style.zIndex=this._zIndex+f)},_animateZoom:function(f){var C=this._map._latLngToNewLayerPoint(this._latlng,f.zoom,f.center).round();this._setPos(C)},_initInteraction:function(){if(this.options.interactive&&(On(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),pd)){var f=this.options.draggable;this.dragging&&(f=this.dragging.enabled(),this.dragging.disable()),this.dragging=new pd(this),f&&this.dragging.enable()}},setOpacity:function(f){return this.options.opacity=f,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var f=this.options.opacity;this._icon&&Hs(this._icon,f),this._shadow&&Hs(this._shadow,f)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var f=this._map;if(f){var C=this.options.icon.options,P=C.iconSize?nt(C.iconSize):nt(0,0),B=C.iconAnchor?nt(C.iconAnchor):nt(0,0);f.panInside(this._latlng,{paddingTopLeft:B,paddingBottomRight:P.subtract(B)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});var Da=fa.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(f){this._renderer=f.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(f){return K(this,f),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&f&&Object.prototype.hasOwnProperty.call(f,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Na=Da.extend({options:{fill:!0,radius:10},initialize:function(f,C){K(this,C),this._latlng=zn(f),this._radius=this.options.radius},setLatLng:function(f){var C=this._latlng;return this._latlng=zn(f),this.redraw(),this.fire("move",{oldLatLng:C,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(f){return this.options.radius=this._radius=f,this.redraw()},getRadius:function(){return this._radius},setStyle:function(f){var C=f&&f.radius||this._radius;return Da.prototype.setStyle.call(this,f),this.setRadius(C),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var f=this._radius,C=this._radiusY||f,P=this._clickTolerance(),B=[f+P,C+P];this._pxBounds=new ht(this._point.subtract(B),this._point.add(B))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(f){return f.distanceTo(this._point)<=this._radius+this._clickTolerance()}});var _u=Na.extend({initialize:function(f,C,P){if("number"==typeof C&&(C=Pe({},P,{radius:C})),K(this,C),this._latlng=zn(f),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(f){return this._mRadius=f,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var f=[this._radius,this._radiusY||this._radius];return new ln(this._map.layerPointToLatLng(this._point.subtract(f)),this._map.layerPointToLatLng(this._point.add(f)))},setStyle:Da.prototype.setStyle,_project:function(){var f=this._latlng.lng,C=this._latlng.lat,P=this._map,B=P.options.crs;if(B.distance===mi.distance){var Y=Math.PI/180,_e=this._mRadius/mi.R/Y,qe=P.project([C+_e,f]),at=P.project([C-_e,f]),wt=qe.add(at).divideBy(2),Yt=P.unproject(wt).lat,wn=Math.acos((Math.cos(_e*Y)-Math.sin(C*Y)*Math.sin(Yt*Y))/(Math.cos(C*Y)*Math.cos(Yt*Y)))/Y;(isNaN(wn)||0===wn)&&(wn=_e/Math.cos(Math.PI/180*C)),this._point=wt.subtract(P.getPixelOrigin()),this._radius=isNaN(wn)?0:wt.x-P.project([Yt,f-wn]).x,this._radiusY=wt.y-qe.y}else{var ei=B.unproject(B.project(this._latlng).subtract([this._mRadius,0]));this._point=P.latLngToLayerPoint(this._latlng),this._radius=this._point.x-P.latLngToLayerPoint(ei).x}this._updateBounds()}});var Po=Da.extend({options:{smoothFactor:1,noClip:!1},initialize:function(f,C){K(this,C),this._setLatLngs(f)},getLatLngs:function(){return this._latlngs},setLatLngs:function(f){return this._setLatLngs(f),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(f){for(var Y,_e,C=1/0,P=null,B=yr,qe=0,at=this._parts.length;qe<at;qe++)for(var wt=this._parts[qe],Yt=1,wn=wt.length;Yt<wn;Yt++){var ei=B(f,Y=wt[Yt-1],_e=wt[Yt],!0);ei<C&&(C=ei,P=B(f,Y,_e))}return P&&(P.distance=Math.sqrt(C)),P},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return hu(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(f,C){return C=C||this._defaultShape(),f=zn(f),C.push(f),this._bounds.extend(f),this.redraw()},_setLatLngs:function(f){this._bounds=new ln,this._latlngs=this._convertLatLngs(f)},_defaultShape:function(){return Ys(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(f){for(var C=[],P=Ys(f),B=0,Y=f.length;B<Y;B++)P?(C[B]=zn(f[B]),this._bounds.extend(C[B])):C[B]=this._convertLatLngs(f[B]);return C},_project:function(){var f=new ht;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,f),this._bounds.isValid()&&f.isValid()&&(this._rawPxBounds=f,this._updateBounds())},_updateBounds:function(){var f=this._clickTolerance(),C=new pt(f,f);this._rawPxBounds&&(this._pxBounds=new ht([this._rawPxBounds.min.subtract(C),this._rawPxBounds.max.add(C)]))},_projectLatlngs:function(f,C,P){var _e,qe,Y=f.length;if(f[0]instanceof Pn){for(qe=[],_e=0;_e<Y;_e++)qe[_e]=this._map.latLngToLayerPoint(f[_e]),P.extend(qe[_e]);C.push(qe)}else for(_e=0;_e<Y;_e++)this._projectLatlngs(f[_e],C,P)},_clipPoints:function(){var f=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(f)){if(this.options.noClip)return void(this._parts=this._rings);var P,B,Y,_e,qe,at,wt,C=this._parts;for(P=0,Y=0,_e=this._rings.length;P<_e;P++)for(B=0,qe=(wt=this._rings[P]).length;B<qe-1;B++)(at=hc(wt[B],wt[B+1],f,B,!0))&&(C[Y]=C[Y]||[],C[Y].push(at[0]),(at[1]!==wt[B+1]||B===qe-2)&&(C[Y].push(at[1]),Y++))}},_simplifyPoints:function(){for(var f=this._parts,C=this.options.smoothFactor,P=0,B=f.length;P<B;P++)f[P]=li(f[P],C)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(f,C){var P,B,Y,_e,qe,at,wt=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(f))return!1;for(P=0,_e=this._parts.length;P<_e;P++)for(B=0,Y=(qe=(at=this._parts[P]).length)-1;B<qe;Y=B++)if((C||0!==B)&&Yi(f,at[Y],at[B])<=wt)return!0;return!1}});Po._flat=dd;var no=Po.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return ha(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(f){var C=Po.prototype._convertLatLngs.call(this,f),P=C.length;return P>=2&&C[0]instanceof Pn&&C[0].equals(C[P-1])&&C.pop(),C},_setLatLngs:function(f){Po.prototype._setLatLngs.call(this,f),Ys(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Ys(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var f=this._renderer._bounds,C=this.options.weight,P=new pt(C,C);if(f=new ht(f.min.subtract(P),f.max.add(P)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(f)){if(this.options.noClip)return void(this._parts=this._rings);for(var _e,B=0,Y=this._rings.length;B<Y;B++)(_e=kl(this._rings[B],f,!0)).length&&this._parts.push(_e)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(f){var P,B,Y,_e,qe,at,wt,Yt,C=!1;if(!this._pxBounds||!this._pxBounds.contains(f))return!1;for(_e=0,wt=this._parts.length;_e<wt;_e++)for(qe=0,at=(Yt=(P=this._parts[_e]).length)-1;qe<Yt;at=qe++)(B=P[qe]).y>f.y!=(Y=P[at]).y>f.y&&f.x<(Y.x-B.x)*(f.y-B.y)/(Y.y-B.y)+B.x&&(C=!C);return C||Po.prototype._containsPoint.call(this,f,!0)}});var Es=Ca.extend({initialize:function(f,C){K(this,C),this._layers={},f&&this.addData(f)},addData:function(f){var P,B,Y,C=ot(f)?f:f.features;if(C){for(P=0,B=C.length;P<B;P++)((Y=C[P]).geometries||Y.geometry||Y.features||Y.coordinates)&&this.addData(Y);return this}var _e=this.options;if(_e.filter&&!_e.filter(f))return this;var qe=Yo(f,_e);return qe?(qe.feature=Bc(f),qe.defaultOptions=qe.options,this.resetStyle(qe),_e.onEachFeature&&_e.onEachFeature(f,qe),this.addLayer(qe)):this},resetStyle:function(f){return void 0===f?this.eachLayer(this.resetStyle,this):(f.options=Pe({},f.defaultOptions),this._setLayerStyle(f,this.options.style),this)},setStyle:function(f){return this.eachLayer(function(C){this._setLayerStyle(C,f)},this)},_setLayerStyle:function(f,C){f.setStyle&&("function"==typeof C&&(C=C(f.feature)),f.setStyle(C))}});function Yo(f,C){var at,wt,Yt,wn,P="Feature"===f.type?f.geometry:f,B=P?P.coordinates:null,Y=[],_e=C&&C.pointToLayer,qe=C&&C.coordsToLatLng||zc;if(!B&&!P)return null;switch(P.type){case"Point":return pc(_e,f,at=qe(B),C);case"MultiPoint":for(Yt=0,wn=B.length;Yt<wn;Yt++)at=qe(B[Yt]),Y.push(pc(_e,f,at,C));return new Ca(Y);case"LineString":case"MultiLineString":return wt=mc(B,"LineString"===P.type?0:1,qe),new Po(wt,C);case"Polygon":case"MultiPolygon":return wt=mc(B,"Polygon"===P.type?1:2,qe),new no(wt,C);case"GeometryCollection":for(Yt=0,wn=P.geometries.length;Yt<wn;Yt++){var ei=Yo({geometry:P.geometries[Yt],type:"Feature",properties:f.properties},C);ei&&Y.push(ei)}return new Ca(Y);case"FeatureCollection":for(Yt=0,wn=P.features.length;Yt<wn;Yt++){var Ti=Yo(P.features[Yt],C);Ti&&Y.push(Ti)}return new Ca(Y);default:throw new Error("Invalid GeoJSON object.")}}function pc(f,C,P,B){return f?f(C,P):new mu(P,B&&B.markersInheritOptions&&B)}function zc(f){return new Pn(f[1],f[0],f[2])}function mc(f,C,P){for(var qe,B=[],Y=0,_e=f.length;Y<_e;Y++)qe=C?mc(f[Y],C-1,P):(P||zc)(f[Y]),B.push(qe);return B}function Ho(f,C){return void 0!==(f=zn(f)).alt?[ee(f.lng,C),ee(f.lat,C),ee(f.alt,C)]:[ee(f.lng,C),ee(f.lat,C)]}function Ol(f,C,P,B){for(var Y=[],_e=0,qe=f.length;_e<qe;_e++)Y.push(C?Ol(f[_e],Ys(f[_e])?0:C-1,P,B):Ho(f[_e],B));return!C&&P&&Y.length>0&&Y.push(Y[0].slice()),Y}function Xo(f,C){return f.feature?Pe({},f.feature,{geometry:C}):Bc(C)}function Bc(f){return"Feature"===f.type||"FeatureCollection"===f.type?f:{type:"Feature",properties:{},geometry:f}}var Xs={toGeoJSON:function(f){return Xo(this,{type:"Point",coordinates:Ho(this.getLatLng(),f)})}};function Ln(f,C){return new Es(f,C)}mu.include(Xs),_u.include(Xs),Na.include(Xs),Po.include({toGeoJSON:function(f){var C=!Ys(this._latlngs);return Xo(this,{type:(C?"Multi":"")+"LineString",coordinates:Ol(this._latlngs,C?1:0,!1,f)})}}),no.include({toGeoJSON:function(f){var C=!Ys(this._latlngs),P=C&&!Ys(this._latlngs[0]),B=Ol(this._latlngs,P?2:C?1:0,!0,f);return C||(B=[B]),Xo(this,{type:(P?"Multi":"")+"Polygon",coordinates:B})}}),dc.include({toMultiPoint:function(f){var C=[];return this.eachLayer(function(P){C.push(P.toGeoJSON(f).geometry.coordinates)}),Xo(this,{type:"MultiPoint",coordinates:C})},toGeoJSON:function(f){var C=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===C)return this.toMultiPoint(f);var P="GeometryCollection"===C,B=[];return this.eachLayer(function(Y){if(Y.toGeoJSON){var _e=Y.toGeoJSON(f);if(P)B.push(_e.geometry);else{var qe=Bc(_e);"FeatureCollection"===qe.type?B.push.apply(B,qe.features):B.push(qe)}}}),P?Xo(this,{geometries:B,type:"GeometryCollection"}):{type:"FeatureCollection",features:B}}});var pa=Ln,yu=fa.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(f,C,P){this._url=f,this._bounds=Wt(C),K(this,P)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(On(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Qi(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(f){return this.options.opacity=f,this._image&&this._updateOpacity(),this},setStyle:function(f){return f.opacity&&this.setOpacity(f.opacity),this},bringToFront:function(){return this._map&&el(this._image),this},bringToBack:function(){return this._map&&xa(this._image),this},setUrl:function(f){return this._url=f,this._image&&(this._image.src=f),this},setBounds:function(f){return this._bounds=Wt(f),this._map&&this._reset(),this},getEvents:function(){var f={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(f.zoomanim=this._animateZoom),f},setZIndex:function(f){return this.options.zIndex=f,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var f="IMG"===this._url.tagName,C=this._image=f?this._url:Ai("img");On(C,"leaflet-image-layer"),this._zoomAnimated&&On(C,"leaflet-zoom-animated"),this.options.className&&On(C,this.options.className),C.onselectstart=ve,C.onmousemove=ve,C.onload=p(this.fire,this,"load"),C.onerror=p(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(C.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),f?this._url=C.src:(C.src=this._url,C.alt=this.options.alt)},_animateZoom:function(f){var C=this._map.getZoomScale(f.zoom),P=this._map._latLngBoundsToNewLayerBounds(this._bounds,f.zoom,f.center).min;sc(this._image,P,C)},_reset:function(){var f=this._image,C=new ht(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),P=C.getSize();dr(f,C.min),f.style.width=P.x+"px",f.style.height=P.y+"px"},_updateOpacity:function(){Hs(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&null!=this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var f=this.options.errorOverlayUrl;f&&this._url!==f&&(this._url=f,this._image.src=f)},getCenter:function(){return this._bounds.getCenter()}}),vu=yu.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var f="VIDEO"===this._url.tagName,C=this._image=f?this._url:Ai("video");if(On(C,"leaflet-image-layer"),this._zoomAnimated&&On(C,"leaflet-zoom-animated"),this.options.className&&On(C,this.options.className),C.onselectstart=ve,C.onmousemove=ve,C.onloadeddata=p(this.fire,this,"load"),f){for(var P=C.getElementsByTagName("source"),B=[],Y=0;Y<P.length;Y++)B.push(P[Y].src);this._url=P.length>0?B:[C.src]}else{ot(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(C.style,"objectFit")&&(C.style.objectFit="fill"),C.autoplay=!!this.options.autoplay,C.loop=!!this.options.loop,C.muted=!!this.options.muted,C.playsInline=!!this.options.playsInline;for(var _e=0;_e<this._url.length;_e++){var qe=Ai("source");qe.src=this._url[_e],C.appendChild(qe)}}}});var wi=yu.extend({_initImage:function(){var f=this._image=this._url;On(f,"leaflet-image-layer"),this._zoomAnimated&&On(f,"leaflet-zoom-animated"),this.options.className&&On(f,this.options.className),f.onselectstart=ve,f.onmousemove=ve}});var Pr=fa.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(f,C){f&&(f instanceof Pn||ot(f))?(this._latlng=zn(f),K(this,C)):(K(this,f),this._source=C),this.options.content&&(this._content=this.options.content)},openOn:function(f){return(f=arguments.length?f:this._source._map).hasLayer(this)||f.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(f){return this._map?this.close():(arguments.length?this._source=f:f=this._source,this._prepareOpen(),this.openOn(f._map)),this},onAdd:function(f){this._zoomAnimated=f._zoomAnimated,this._container||this._initLayout(),f._fadeAnimated&&Hs(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),f._fadeAnimated&&Hs(this._container,1),this.bringToFront(),this.options.interactive&&(On(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(f){f._fadeAnimated?(Hs(this._container,0),this._removeTimeout=setTimeout(p(Qi,void 0,this._container),200)):Qi(this._container),this.options.interactive&&(eo(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(f){return this._latlng=zn(f),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(f){return this._content=f,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var f={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(f.zoomanim=this._animateZoom),f},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&el(this._container),this},bringToBack:function(){return this._map&&xa(this._container),this},_prepareOpen:function(f){var C=this._source;if(!C._map)return!1;if(C instanceof Ca){C=null;var P=this._source._layers;for(var B in P)if(P[B]._map){C=P[B];break}if(!C)return!1;this._source=C}if(!f)if(C.getCenter)f=C.getCenter();else if(C.getLatLng)f=C.getLatLng();else{if(!C.getBounds)throw new Error("Unable to get source layer LatLng.");f=C.getBounds().getCenter()}return this.setLatLng(f),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var f=this._contentNode,C="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof C)f.innerHTML=C;else{for(;f.hasChildNodes();)f.removeChild(f.firstChild);f.appendChild(C)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var f=this._map.latLngToLayerPoint(this._latlng),C=nt(this.options.offset),P=this._getAnchor();this._zoomAnimated?dr(this._container,f.add(P)):C=C.add(f).add(P);var B=this._containerBottom=-C.y,Y=this._containerLeft=-Math.round(this._containerWidth/2)+C.x;this._container.style.bottom=B+"px",this._container.style.left=Y+"px"}},_getAnchor:function(){return[0,0]}});Li.include({_initOverlay:function(f,C,P,B){var Y=C;return Y instanceof f||(Y=new f(B).setContent(C)),P&&Y.setLatLng(P),Y}}),fa.include({_initOverlay:function(f,C,P,B){var Y=P;return Y instanceof f?(K(Y,B),Y._source=this):(Y=C&&!B?C:new f(B,this)).setContent(P),Y}});var ma=Pr.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(f){return!(f=arguments.length?f:this._source._map).hasLayer(this)&&f._popup&&f._popup.options.autoClose&&f.removeLayer(f._popup),f._popup=this,Pr.prototype.openOn.call(this,f)},onAdd:function(f){Pr.prototype.onAdd.call(this,f),f.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Da||this._source.on("preclick",qs))},onRemove:function(f){Pr.prototype.onRemove.call(this,f),f.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Da||this._source.off("preclick",qs))},getEvents:function(){var f=Pr.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(f.preclick=this.close),this.options.keepInView&&(f.moveend=this._adjustPan),f},_initLayout:function(){var f="leaflet-popup",C=this._container=Ai("div",f+" "+(this.options.className||"")+" leaflet-zoom-animated"),P=this._wrapper=Ai("div",f+"-content-wrapper",C);if(this._contentNode=Ai("div",f+"-content",P),tl(C),an(this._contentNode),$n(C,"contextmenu",qs),this._tipContainer=Ai("div",f+"-tip-container",C),this._tip=Ai("div",f+"-tip",this._tipContainer),this.options.closeButton){var B=this._closeButton=Ai("a",f+"-close-button",C);B.setAttribute("role","button"),B.setAttribute("aria-label","Close popup"),B.href="#close",B.innerHTML='<span aria-hidden="true">&#215;</span>',$n(B,"click",function(Y){rr(Y),this.close()},this)}},_updateLayout:function(){var f=this._contentNode,C=f.style;C.width="",C.whiteSpace="nowrap";var P=f.offsetWidth;P=Math.min(P,this.options.maxWidth),P=Math.max(P,this.options.minWidth),C.width=P+1+"px",C.whiteSpace="",C.height="";var Y=this.options.maxHeight,_e="leaflet-popup-scrolled";Y&&f.offsetHeight>Y?(C.height=Y+"px",On(f,_e)):eo(f,_e),this._containerWidth=this._container.offsetWidth},_animateZoom:function(f){var C=this._map._latLngToNewLayerPoint(this._latlng,f.zoom,f.center),P=this._getAnchor();dr(this._container,C.add(P))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning)return void(this._autopanning=!1);var f=this._map,C=parseInt(os(this._container,"marginBottom"),10)||0,P=this._container.offsetHeight+C,B=this._containerWidth,Y=new pt(this._containerLeft,-P-this._containerBottom);Y._add(Gi(this._container));var _e=f.layerPointToContainerPoint(Y),qe=nt(this.options.autoPanPadding),at=nt(this.options.autoPanPaddingTopLeft||qe),wt=nt(this.options.autoPanPaddingBottomRight||qe),Yt=f.getSize(),wn=0,ei=0;_e.x+B+wt.x>Yt.x&&(wn=_e.x+B-Yt.x+wt.x),_e.x-wn-at.x<0&&(wn=_e.x-at.x),_e.y+P+wt.y>Yt.y&&(ei=_e.y+P-Yt.y+wt.y),_e.y-ei-at.y<0&&(ei=_e.y-at.y),(wn||ei)&&(this.options.keepInView&&(this._autopanning=!0),f.fire("autopanstart").panBy([wn,ei]))}},_getAnchor:function(){return nt(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}});Li.mergeOptions({closePopupOnClick:!0}),Li.include({openPopup:function(f,C,P){return this._initOverlay(ma,f,C,P).openOn(this),this},closePopup:function(f){return(f=arguments.length?f:this._popup)&&f.close(),this}}),fa.include({bindPopup:function(f,C){return this._popup=this._initOverlay(ma,this._popup,f,C),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(f){return this._popup&&(this instanceof Ca||(this._popup._source=this),this._popup._prepareOpen(f||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(f){return this._popup&&this._popup.setContent(f),this},getPopup:function(){return this._popup},_openPopup:function(f){if(this._popup&&this._map){Ts(f);var C=f.layer||f.target;if(this._popup._source===C&&!(C instanceof Da))return void(this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(f.latlng));this._popup._source=C,this.openPopup(f.latlng)}},_movePopup:function(f){this._popup.setLatLng(f.latlng)},_onKeyPress:function(f){13===f.originalEvent.keyCode&&this._openPopup(f)}});var gc=Pr.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(f){Pr.prototype.onAdd.call(this,f),this.setOpacity(this.options.opacity),f.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(f){Pr.prototype.onRemove.call(this,f),f.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var f=Pr.prototype.getEvents.call(this);return this.options.permanent||(f.preclick=this.close),f},_initLayout:function(){this._contentNode=this._container=Ai("div","leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide")),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+he(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(f){var C,P,B=this._map,Y=this._container,_e=B.latLngToContainerPoint(B.getCenter()),qe=B.layerPointToContainerPoint(f),at=this.options.direction,wt=Y.offsetWidth,Yt=Y.offsetHeight,wn=nt(this.options.offset),ei=this._getAnchor();"top"===at?(C=wt/2,P=Yt):"bottom"===at?(C=wt/2,P=0):"center"===at?(C=wt/2,P=Yt/2):"right"===at?(C=0,P=Yt/2):"left"===at?(C=wt,P=Yt/2):qe.x<_e.x?(at="right",C=0,P=Yt/2):(at="left",C=wt+2*(wn.x+ei.x),P=Yt/2),f=f.subtract(nt(C,P,!0)).add(wn).add(ei),eo(Y,"leaflet-tooltip-right"),eo(Y,"leaflet-tooltip-left"),eo(Y,"leaflet-tooltip-top"),eo(Y,"leaflet-tooltip-bottom"),On(Y,"leaflet-tooltip-"+at),dr(Y,f)},_updatePosition:function(){var f=this._map.latLngToLayerPoint(this._latlng);this._setPosition(f)},setOpacity:function(f){this.options.opacity=f,this._container&&Hs(this._container,f)},_animateZoom:function(f){var C=this._map._latLngToNewLayerPoint(this._latlng,f.zoom,f.center);this._setPosition(C)},_getAnchor:function(){return nt(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}});Li.include({openTooltip:function(f,C,P){return this._initOverlay(gc,f,C,P).openOn(this),this},closeTooltip:function(f){return f.close(),this}}),fa.include({bindTooltip:function(f,C){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(gc,this._tooltip,f,C),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(f){if(f||!this._tooltipHandlersAdded){var C=f?"off":"on",P={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?P.add=this._openTooltip:(P.mouseover=this._openTooltip,P.mouseout=this.closeTooltip,P.click=this._openTooltip,this._map?this._addFocusListeners():P.add=this._addFocusListeners),this._tooltip.options.sticky&&(P.mousemove=this._moveTooltip),this[C](P),this._tooltipHandlersAdded=!f}},openTooltip:function(f){return this._tooltip&&(this instanceof Ca||(this._tooltip._source=this),this._tooltip._prepareOpen(f)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(f){return this._tooltip&&this._tooltip.setContent(f),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(f){var C="function"==typeof f.getElement&&f.getElement();C&&($n(C,"focus",function(){this._tooltip._source=f,this.openTooltip()},this),$n(C,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(f){var C="function"==typeof f.getElement&&f.getElement();C&&C.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(f){if(this._tooltip&&this._map){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var C=this;return void this._map.once("moveend",function(){C._openOnceFlag=!1,C._openTooltip(f)})}this._tooltip._source=f.layer||f.target,this.openTooltip(this._tooltip.options.sticky?f.latlng:void 0)}},_moveTooltip:function(f){var P,B,C=f.latlng;this._tooltip.options.sticky&&f.originalEvent&&(P=this._map.mouseEventToContainerPoint(f.originalEvent),B=this._map.containerPointToLayerPoint(P),C=this._map.layerPointToLatLng(B)),this._tooltip.setLatLng(C)}});var fs=Ta.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(f){var C=f&&"DIV"===f.tagName?f:document.createElement("div"),P=this.options;if(P.html instanceof Element?(Rc(C),C.appendChild(P.html)):C.innerHTML=!1!==P.html?P.html:"",P.bgPos){var B=nt(P.bgPos);C.style.backgroundPosition=-B.x+"px "+-B.y+"px"}return this._setIconStyles(C,"icon"),C},createShadow:function(){return null}});Ta.Default=hs;var il=fa.extend({options:{tileSize:256,opacity:1,updateWhenIdle:gn.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(f){K(this,f)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(f){f._addZoomLimit(this)},onRemove:function(f){this._removeAllTiles(),Qi(this._container),f._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(el(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(xa(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(f){return this.options.opacity=f,this._updateOpacity(),this},setZIndex:function(f){return this.options.zIndex=f,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var f=this._clampZoom(this._map.getZoom());f!==this._tileZoom&&(this._tileZoom=f,this._updateLevels()),this._update()}return this},getEvents:function(){var f={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=be(this._onMoveEnd,this.options.updateInterval,this)),f.move=this._onMove),this._zoomAnimated&&(f.zoomanim=this._animateZoom),f},createTile:function(){return document.createElement("div")},getTileSize:function(){var f=this.options.tileSize;return f instanceof pt?f:new pt(f,f)},_updateZIndex:function(){this._container&&null!=this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(f){for(var _e,C=this.getPane().children,P=-f(-1/0,1/0),B=0,Y=C.length;B<Y;B++)_e=C[B].style.zIndex,C[B]!==this._container&&_e&&(P=f(P,+_e));isFinite(P)&&(this.options.zIndex=P+f(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!gn.ielt9){Hs(this._container,this.options.opacity);var f=+new Date,C=!1,P=!1;for(var B in this._tiles){var Y=this._tiles[B];if(Y.current&&Y.loaded){var _e=Math.min(1,(f-Y.loaded)/200);Hs(Y.el,_e),_e<1?C=!0:(Y.active?P=!0:this._onOpaqueTile(Y),Y.active=!0)}}P&&!this._noPrune&&this._pruneTiles(),C&&(Dt(this._fadeFrame),this._fadeFrame=Ze(this._updateOpacity,this))}},_onOpaqueTile:ve,_initContainer:function(){this._container||(this._container=Ai("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var f=this._tileZoom,C=this.options.maxZoom;if(void 0!==f){for(var P in this._levels)P=Number(P),this._levels[P].el.children.length||P===f?(this._levels[P].el.style.zIndex=C-Math.abs(f-P),this._onUpdateLevel(P)):(Qi(this._levels[P].el),this._removeTilesAtZoom(P),this._onRemoveLevel(P),delete this._levels[P]);var B=this._levels[f],Y=this._map;return B||((B=this._levels[f]={}).el=Ai("div","leaflet-tile-container leaflet-zoom-animated",this._container),B.el.style.zIndex=C,B.origin=Y.project(Y.unproject(Y.getPixelOrigin()),f).round(),B.zoom=f,this._setZoomTransform(B,Y.getCenter(),Y.getZoom()),this._onCreateLevel(B)),this._level=B,B}},_onUpdateLevel:ve,_onRemoveLevel:ve,_onCreateLevel:ve,_pruneTiles:function(){if(this._map){var f,C,P=this._map.getZoom();if(P>this.options.maxZoom||P<this.options.minZoom)return void this._removeAllTiles();for(f in this._tiles)(C=this._tiles[f]).retain=C.current;for(f in this._tiles)if((C=this._tiles[f]).current&&!C.active){var B=C.coords;this._retainParent(B.x,B.y,B.z,B.z-5)||this._retainChildren(B.x,B.y,B.z,B.z+2)}for(f in this._tiles)this._tiles[f].retain||this._removeTile(f)}},_removeTilesAtZoom:function(f){for(var C in this._tiles)this._tiles[C].coords.z===f&&this._removeTile(C)},_removeAllTiles:function(){for(var f in this._tiles)this._removeTile(f)},_invalidateAll:function(){for(var f in this._levels)Qi(this._levels[f].el),this._onRemoveLevel(Number(f)),delete this._levels[f];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(f,C,P,B){var Y=Math.floor(f/2),_e=Math.floor(C/2),qe=P-1,at=new pt(+Y,+_e);at.z=+qe;var wt=this._tileCoordsToKey(at),Yt=this._tiles[wt];return Yt&&Yt.active?(Yt.retain=!0,!0):(Yt&&Yt.loaded&&(Yt.retain=!0),qe>B&&this._retainParent(Y,_e,qe,B))},_retainChildren:function(f,C,P,B){for(var Y=2*f;Y<2*f+2;Y++)for(var _e=2*C;_e<2*C+2;_e++){var qe=new pt(Y,_e);qe.z=P+1;var at=this._tileCoordsToKey(qe),wt=this._tiles[at];wt&&wt.active?wt.retain=!0:(wt&&wt.loaded&&(wt.retain=!0),P+1<B&&this._retainChildren(Y,_e,P+1,B))}},_resetView:function(f){var C=f&&(f.pinch||f.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),C,C)},_animateZoom:function(f){this._setView(f.center,f.zoom,!0,f.noUpdate)},_clampZoom:function(f){var C=this.options;return void 0!==C.minNativeZoom&&f<C.minNativeZoom?C.minNativeZoom:void 0!==C.maxNativeZoom&&C.maxNativeZoom<f?C.maxNativeZoom:f},_setView:function(f,C,P,B){var Y=Math.round(C);Y=void 0!==this.options.maxZoom&&Y>this.options.maxZoom||void 0!==this.options.minZoom&&Y<this.options.minZoom?void 0:this._clampZoom(Y),(!B||this.options.updateWhenZooming&&Y!==this._tileZoom)&&(this._tileZoom=Y,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==Y&&this._update(f),P||this._pruneTiles(),this._noPrune=!!P),this._setZoomTransforms(f,C)},_setZoomTransforms:function(f,C){for(var P in this._levels)this._setZoomTransform(this._levels[P],f,C)},_setZoomTransform:function(f,C,P){var B=this._map.getZoomScale(P,f.zoom),Y=f.origin.multiplyBy(B).subtract(this._map._getNewPixelOrigin(C,P)).round();gn.any3d?sc(f.el,Y,B):dr(f.el,Y)},_resetGrid:function(){var f=this._map,C=f.options.crs,P=this._tileSize=this.getTileSize(),B=this._tileZoom,Y=this._map.getPixelWorldBounds(this._tileZoom);Y&&(this._globalTileRange=this._pxBoundsToTileRange(Y)),this._wrapX=C.wrapLng&&!this.options.noWrap&&[Math.floor(f.project([0,C.wrapLng[0]],B).x/P.x),Math.ceil(f.project([0,C.wrapLng[1]],B).x/P.y)],this._wrapY=C.wrapLat&&!this.options.noWrap&&[Math.floor(f.project([C.wrapLat[0],0],B).y/P.x),Math.ceil(f.project([C.wrapLat[1],0],B).y/P.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(f){var C=this._map,P=C._animatingZoom?Math.max(C._animateToZoom,C.getZoom()):C.getZoom(),B=C.getZoomScale(P,this._tileZoom),Y=C.project(f,this._tileZoom).floor(),_e=C.getSize().divideBy(2*B);return new ht(Y.subtract(_e),Y.add(_e))},_update:function(f){var C=this._map;if(C){var P=this._clampZoom(C.getZoom());if(void 0===f&&(f=C.getCenter()),void 0!==this._tileZoom){var B=this._getTiledPixelBounds(f),Y=this._pxBoundsToTileRange(B),_e=Y.getCenter(),qe=[],at=this.options.keepBuffer,wt=new ht(Y.getBottomLeft().subtract([at,-at]),Y.getTopRight().add([at,-at]));if(!(isFinite(Y.min.x)&&isFinite(Y.min.y)&&isFinite(Y.max.x)&&isFinite(Y.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Yt in this._tiles){var wn=this._tiles[Yt].coords;(wn.z!==this._tileZoom||!wt.contains(new pt(wn.x,wn.y)))&&(this._tiles[Yt].current=!1)}if(Math.abs(P-this._tileZoom)>1)return void this._setView(f,P);for(var ei=Y.min.y;ei<=Y.max.y;ei++)for(var Ti=Y.min.x;Ti<=Y.max.x;Ti++){var Ko=new pt(Ti,ei);if(Ko.z=this._tileZoom,this._isValidTile(Ko)){var Eo=this._tiles[this._tileCoordsToKey(Ko)];Eo?Eo.current=!0:qe.push(Ko)}}if(qe.sort(function(Qo,sl){return Qo.distanceTo(_e)-sl.distanceTo(_e)}),0!==qe.length){this._loading||(this._loading=!0,this.fire("loading"));var ms=document.createDocumentFragment();for(Ti=0;Ti<qe.length;Ti++)this._addTile(qe[Ti],ms);this._level.el.appendChild(ms)}}}},_isValidTile:function(f){var C=this._map.options.crs;if(!C.infinite){var P=this._globalTileRange;if(!C.wrapLng&&(f.x<P.min.x||f.x>P.max.x)||!C.wrapLat&&(f.y<P.min.y||f.y>P.max.y))return!1}if(!this.options.bounds)return!0;var B=this._tileCoordsToBounds(f);return Wt(this.options.bounds).overlaps(B)},_keyToBounds:function(f){return this._tileCoordsToBounds(this._keyToTileCoords(f))},_tileCoordsToNwSe:function(f){var C=this._map,P=this.getTileSize(),B=f.scaleBy(P),Y=B.add(P);return[C.unproject(B,f.z),C.unproject(Y,f.z)]},_tileCoordsToBounds:function(f){var C=this._tileCoordsToNwSe(f),P=new ln(C[0],C[1]);return this.options.noWrap||(P=this._map.wrapLatLngBounds(P)),P},_tileCoordsToKey:function(f){return f.x+":"+f.y+":"+f.z},_keyToTileCoords:function(f){var C=f.split(":"),P=new pt(+C[0],+C[1]);return P.z=+C[2],P},_removeTile:function(f){var C=this._tiles[f];C&&(Qi(C.el),delete this._tiles[f],this.fire("tileunload",{tile:C.el,coords:this._keyToTileCoords(f)}))},_initTile:function(f){On(f,"leaflet-tile");var C=this.getTileSize();f.style.width=C.x+"px",f.style.height=C.y+"px",f.onselectstart=ve,f.onmousemove=ve,gn.ielt9&&this.options.opacity<1&&Hs(f,this.options.opacity)},_addTile:function(f,C){var P=this._getTilePos(f),B=this._tileCoordsToKey(f),Y=this.createTile(this._wrapCoords(f),p(this._tileReady,this,f));this._initTile(Y),this.createTile.length<2&&Ze(p(this._tileReady,this,f,null,Y)),dr(Y,P),this._tiles[B]={el:Y,coords:f,current:!0},C.appendChild(Y),this.fire("tileloadstart",{tile:Y,coords:f})},_tileReady:function(f,C,P){C&&this.fire("tileerror",{error:C,tile:P,coords:f});var B=this._tileCoordsToKey(f);(P=this._tiles[B])&&(P.loaded=+new Date,this._map._fadeAnimated?(Hs(P.el,0),Dt(this._fadeFrame),this._fadeFrame=Ze(this._updateOpacity,this)):(P.active=!0,this._pruneTiles()),C||(On(P.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:P.el,coords:f})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),gn.ielt9||!this._map._fadeAnimated?Ze(this._pruneTiles,this):setTimeout(p(this._pruneTiles,this),250)))},_getTilePos:function(f){return f.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(f){var C=new pt(this._wrapX?me(f.x,this._wrapX):f.x,this._wrapY?me(f.y,this._wrapY):f.y);return C.z=f.z,C},_pxBoundsToTileRange:function(f){var C=this.getTileSize();return new ht(f.min.unscaleBy(C).floor(),f.max.unscaleBy(C).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var f in this._tiles)if(!this._tiles[f].loaded)return!1;return!0}});var Is=il.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(f,C){this._url=f,(C=K(this,C)).detectRetina&&gn.retina&&C.maxZoom>0?(C.tileSize=Math.floor(C.tileSize/2),C.zoomReverse?(C.zoomOffset--,C.minZoom=Math.min(C.maxZoom,C.minZoom+1)):(C.zoomOffset++,C.maxZoom=Math.max(C.minZoom,C.maxZoom-1)),C.minZoom=Math.max(0,C.minZoom)):C.zoomReverse?C.minZoom=Math.min(C.maxZoom,C.minZoom):C.maxZoom=Math.max(C.minZoom,C.maxZoom),"string"==typeof C.subdomains&&(C.subdomains=C.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(f,C){return this._url===f&&void 0===C&&(C=!0),this._url=f,C||this.redraw(),this},createTile:function(f,C){var P=document.createElement("img");return $n(P,"load",p(this._tileOnLoad,this,C,P)),$n(P,"error",p(this._tileOnError,this,C,P)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(P.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"==typeof this.options.referrerPolicy&&(P.referrerPolicy=this.options.referrerPolicy),P.alt="",P.src=this.getTileUrl(f),P},getTileUrl:function(f){var C={r:gn.retina?"@2x":"",s:this._getSubdomain(f),x:f.x,y:f.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var P=this._globalTileRange.max.y-f.y;this.options.tms&&(C.y=P),C["-y"]=P}return Ue(this._url,Pe(C,this.options))},_tileOnLoad:function(f,C){gn.ielt9?setTimeout(p(f,this,null,C),0):f(null,C)},_tileOnError:function(f,C,P){var B=this.options.errorTileUrl;B&&C.getAttribute("src")!==B&&(C.src=B),f(P,C)},_onTileRemove:function(f){f.tile.onload=null},_getZoomForUrl:function(){var f=this._tileZoom;return this.options.zoomReverse&&(f=this.options.maxZoom-f),f+this.options.zoomOffset},_getSubdomain:function(f){var C=Math.abs(f.x+f.y)%this.options.subdomains.length;return this.options.subdomains[C]},_abortLoading:function(){var f,C;for(f in this._tiles)if(this._tiles[f].coords.z!==this._tileZoom&&((C=this._tiles[f].el).onload=ve,C.onerror=ve,!C.complete)){C.src=St;var P=this._tiles[f].coords;Qi(C),delete this._tiles[f],this.fire("tileabort",{tile:C,coords:P})}},_removeTile:function(f){var C=this._tiles[f];if(C)return C.el.setAttribute("src",St),il.prototype._removeTile.call(this,f)},_tileReady:function(f,C,P){if(this._map&&(!P||P.getAttribute("src")!==St))return il.prototype._tileReady.call(this,f,C,P)}});function bu(f,C){return new Is(f,C)}var _c=Is.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(f,C){this._url=f;var P=Pe({},this.defaultWmsParams);for(var B in C)B in this.options||(P[B]=C[B]);var Y=(C=K(this,C)).detectRetina&&gn.retina?2:1,_e=this.getTileSize();P.width=_e.x*Y,P.height=_e.y*Y,this.wmsParams=P},onAdd:function(f){this._crs=this.options.crs||f.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version),this.wmsParams[this._wmsVersion>=1.3?"crs":"srs"]=this._crs.code,Is.prototype.onAdd.call(this,f)},getTileUrl:function(f){var C=this._tileCoordsToNwSe(f),P=this._crs,B=Sn(P.project(C[0]),P.project(C[1])),Y=B.min,_e=B.max,qe=(this._wmsVersion>=1.3&&this._crs===fd?[Y.y,Y.x,_e.y,_e.x]:[Y.x,Y.y,_e.x,_e.y]).join(","),at=Is.prototype.getTileUrl.call(this,f);return at+Ee(this.wmsParams,at,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+qe},setParams:function(f,C){return Pe(this.wmsParams,f),C||this.redraw(),this}});Is.WMS=_c,bu.wms=function jc(f,C){return new _c(f,C)};var Ks=fa.extend({options:{padding:.1},initialize:function(f){K(this,f),he(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),On(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var f={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(f.zoomanim=this._onAnimZoom),f},_onAnimZoom:function(f){this._updateTransform(f.center,f.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(f,C){var P=this._map.getZoomScale(C,this._zoom),B=this._map.getSize().multiplyBy(.5+this.options.padding),Y=this._map.project(this._center,C),_e=B.multiplyBy(-P).add(Y).subtract(this._map._getNewPixelOrigin(f,C));gn.any3d?sc(this._container,_e,P):dr(this._container,_e)},_reset:function(){for(var f in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[f]._reset()},_onZoomEnd:function(){for(var f in this._layers)this._layers[f]._project()},_updatePaths:function(){for(var f in this._layers)this._layers[f]._update()},_update:function(){var f=this.options.padding,C=this._map.getSize(),P=this._map.containerPointToLayerPoint(C.multiplyBy(-f)).round();this._bounds=new ht(P,P.add(C.multiplyBy(1+2*f)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),rl=Ks.extend({options:{tolerance:0},getEvents:function(){var f=Ks.prototype.getEvents.call(this);return f.viewprereset=this._onViewPreReset,f},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Ks.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var f=this._container=document.createElement("canvas");$n(f,"mousemove",this._onMouseMove,this),$n(f,"click dblclick mousedown mouseup contextmenu",this._onClick,this),$n(f,"mouseout",this._handleMouseOut,this),f._leaflet_disable_events=!0,this._ctx=f.getContext("2d")},_destroyContainer:function(){Dt(this._redrawRequest),delete this._ctx,Qi(this._container),yn(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var C in this._redrawBounds=null,this._layers)this._layers[C]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){Ks.prototype._update.call(this);var f=this._bounds,C=this._container,P=f.getSize(),B=gn.retina?2:1;dr(C,f.min),C.width=B*P.x,C.height=B*P.y,C.style.width=P.x+"px",C.style.height=P.y+"px",gn.retina&&this._ctx.scale(2,2),this._ctx.translate(-f.min.x,-f.min.y),this.fire("update")}},_reset:function(){Ks.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(f){this._updateDashArray(f),this._layers[he(f)]=f;var C=f._order={layer:f,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=C),this._drawLast=C,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(f){this._requestRedraw(f)},_removePath:function(f){var C=f._order,P=C.next,B=C.prev;P?P.prev=B:this._drawLast=B,B?B.next=P:this._drawFirst=P,delete f._order,delete this._layers[he(f)],this._requestRedraw(f)},_updatePath:function(f){this._extendRedrawBounds(f),f._project(),f._update(),this._requestRedraw(f)},_updateStyle:function(f){this._updateDashArray(f),this._requestRedraw(f)},_updateDashArray:function(f){if("string"==typeof f.options.dashArray){var B,Y,C=f.options.dashArray.split(/[, ]+/),P=[];for(Y=0;Y<C.length;Y++){if(B=Number(C[Y]),isNaN(B))return;P.push(B)}f.options._dashArray=P}else f.options._dashArray=f.options.dashArray},_requestRedraw:function(f){this._map&&(this._extendRedrawBounds(f),this._redrawRequest=this._redrawRequest||Ze(this._redraw,this))},_extendRedrawBounds:function(f){if(f._pxBounds){var C=(f.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new ht,this._redrawBounds.extend(f._pxBounds.min.subtract([C,C])),this._redrawBounds.extend(f._pxBounds.max.add([C,C]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var f=this._redrawBounds;if(f){var C=f.getSize();this._ctx.clearRect(f.min.x,f.min.y,C.x,C.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var f,C=this._redrawBounds;if(this._ctx.save(),C){var P=C.getSize();this._ctx.beginPath(),this._ctx.rect(C.min.x,C.min.y,P.x,P.y),this._ctx.clip()}this._drawing=!0;for(var B=this._drawFirst;B;B=B.next)f=B.layer,(!C||f._pxBounds&&f._pxBounds.intersects(C))&&f._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(f,C){if(this._drawing){var P,B,Y,_e,qe=f._parts,at=qe.length,wt=this._ctx;if(at){for(wt.beginPath(),P=0;P<at;P++){for(B=0,Y=qe[P].length;B<Y;B++)wt[B?"lineTo":"moveTo"]((_e=qe[P][B]).x,_e.y);C&&wt.closePath()}this._fillStroke(wt,f)}}},_updateCircle:function(f){if(this._drawing&&!f._empty()){var C=f._point,P=this._ctx,B=Math.max(Math.round(f._radius),1),Y=(Math.max(Math.round(f._radiusY),1)||B)/B;1!==Y&&(P.save(),P.scale(1,Y)),P.beginPath(),P.arc(C.x,C.y/Y,B,0,2*Math.PI,!1),1!==Y&&P.restore(),this._fillStroke(P,f)}},_fillStroke:function(f,C){var P=C.options;P.fill&&(f.globalAlpha=P.fillOpacity,f.fillStyle=P.fillColor||P.color,f.fill(P.fillRule||"evenodd")),P.stroke&&0!==P.weight&&(f.setLineDash&&f.setLineDash(C.options&&C.options._dashArray||[]),f.globalAlpha=P.opacity,f.lineWidth=P.weight,f.strokeStyle=P.color,f.lineCap=P.lineCap,f.lineJoin=P.lineJoin,f.stroke())},_onClick:function(f){for(var P,B,C=this._map.mouseEventToLayerPoint(f),Y=this._drawFirst;Y;Y=Y.next)(P=Y.layer).options.interactive&&P._containsPoint(C)&&("click"!==f.type&&"preclick"!==f.type||!this._map._draggableMoved(P))&&(B=P);this._fireEvent(!!B&&[B],f)},_onMouseMove:function(f){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var C=this._map.mouseEventToLayerPoint(f);this._handleMouseHover(f,C)}},_handleMouseOut:function(f){var C=this._hoveredLayer;C&&(eo(this._container,"leaflet-interactive"),this._fireEvent([C],f,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(f,C){if(!this._mouseHoverThrottled){for(var P,B,Y=this._drawFirst;Y;Y=Y.next)(P=Y.layer).options.interactive&&P._containsPoint(C)&&(B=P);B!==this._hoveredLayer&&(this._handleMouseOut(f),B&&(On(this._container,"leaflet-interactive"),this._fireEvent([B],f,"mouseover"),this._hoveredLayer=B)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],f),this._mouseHoverThrottled=!0,setTimeout(p(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(f,C,P){this._map._fireDOMEvent(C,P||C.type,f)},_bringToFront:function(f){var C=f._order;if(C){var P=C.next,B=C.prev;if(!P)return;P.prev=B,B?B.next=P:P&&(this._drawFirst=P),C.prev=this._drawLast,this._drawLast.next=C,C.next=null,this._drawLast=C,this._requestRedraw(f)}},_bringToBack:function(f){var C=f._order;if(C){var P=C.next,B=C.prev;if(!B)return;B.next=P,P?P.prev=B:B&&(this._drawLast=B),C.prev=null,C.next=this._drawFirst,this._drawFirst.prev=C,this._drawFirst=C,this._requestRedraw(f)}}});function yc(f){return gn.canvas?new rl(f):null}var ga=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(f){return document.createElement("<lvml:"+f+' class="lvml">')}}catch{}return function(f){return document.createElement("<"+f+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),xu={_initContainer:function(){this._container=Ai("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Ks.prototype._update.call(this),this.fire("update"))},_initPath:function(f){var C=f._container=ga("shape");On(C,"leaflet-vml-shape "+(this.options.className||"")),C.coordsize="1 1",f._path=ga("path"),C.appendChild(f._path),this._updateStyle(f),this._layers[he(f)]=f},_addPath:function(f){var C=f._container;this._container.appendChild(C),f.options.interactive&&f.addInteractiveTarget(C)},_removePath:function(f){var C=f._container;Qi(C),f.removeInteractiveTarget(C),delete this._layers[he(f)]},_updateStyle:function(f){var C=f._stroke,P=f._fill,B=f.options,Y=f._container;Y.stroked=!!B.stroke,Y.filled=!!B.fill,B.stroke?(C||(C=f._stroke=ga("stroke")),Y.appendChild(C),C.weight=B.weight+"px",C.color=B.color,C.opacity=B.opacity,C.dashStyle=B.dashArray?ot(B.dashArray)?B.dashArray.join(" "):B.dashArray.replace(/( *, *)/g," "):"",C.endcap=B.lineCap.replace("butt","flat"),C.joinstyle=B.lineJoin):C&&(Y.removeChild(C),f._stroke=null),B.fill?(P||(P=f._fill=ga("fill")),Y.appendChild(P),P.color=B.fillColor||B.color,P.opacity=B.fillOpacity):P&&(Y.removeChild(P),f._fill=null)},_updateCircle:function(f){var C=f._point.round(),P=Math.round(f._radius),B=Math.round(f._radiusY||P);this._setPath(f,f._empty()?"M0 0":"AL "+C.x+","+C.y+" "+P+","+B+" 0,23592600")},_setPath:function(f,C){f._path.v=C},_bringToFront:function(f){el(f._container)},_bringToBack:function(f){xa(f._container)}},vc=gn.vml?ga:Ct,_i=Ks.extend({_initContainer:function(){this._container=vc("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=vc("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Qi(this._container),yn(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){Ks.prototype._update.call(this);var f=this._bounds,C=f.getSize(),P=this._container;(!this._svgSize||!this._svgSize.equals(C))&&(this._svgSize=C,P.setAttribute("width",C.x),P.setAttribute("height",C.y)),dr(P,f.min),P.setAttribute("viewBox",[f.min.x,f.min.y,C.x,C.y].join(" ")),this.fire("update")}},_initPath:function(f){var C=f._path=vc("path");f.options.className&&On(C,f.options.className),f.options.interactive&&On(C,"leaflet-interactive"),this._updateStyle(f),this._layers[he(f)]=f},_addPath:function(f){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(f._path),f.addInteractiveTarget(f._path)},_removePath:function(f){Qi(f._path),f.removeInteractiveTarget(f._path),delete this._layers[he(f)]},_updatePath:function(f){f._project(),f._update()},_updateStyle:function(f){var C=f._path,P=f.options;C&&(P.stroke?(C.setAttribute("stroke",P.color),C.setAttribute("stroke-opacity",P.opacity),C.setAttribute("stroke-width",P.weight),C.setAttribute("stroke-linecap",P.lineCap),C.setAttribute("stroke-linejoin",P.lineJoin),P.dashArray?C.setAttribute("stroke-dasharray",P.dashArray):C.removeAttribute("stroke-dasharray"),P.dashOffset?C.setAttribute("stroke-dashoffset",P.dashOffset):C.removeAttribute("stroke-dashoffset")):C.setAttribute("stroke","none"),P.fill?(C.setAttribute("fill",P.fillColor||P.color),C.setAttribute("fill-opacity",P.fillOpacity),C.setAttribute("fill-rule",P.fillRule||"evenodd")):C.setAttribute("fill","none"))},_updatePoly:function(f,C){this._setPath(f,Oe(f._parts,C))},_updateCircle:function(f){var C=f._point,P=Math.max(Math.round(f._radius),1),Y="a"+P+","+(Math.max(Math.round(f._radiusY),1)||P)+" 0 1,0 ",_e=f._empty()?"M0 0":"M"+(C.x-P)+","+C.y+Y+2*P+",0 "+Y+2*-P+",0 ";this._setPath(f,_e)},_setPath:function(f,C){f._path.setAttribute("d",C)},_bringToFront:function(f){el(f._path)},_bringToBack:function(f){xa(f._path)}});function Fl(f){return gn.svg||gn.vml?new _i(f):null}gn.vml&&_i.include(xu),Li.include({getRenderer:function(f){var C=f.options.renderer||this._getPaneRenderer(f.options.pane)||this.options.renderer||this._renderer;return C||(C=this._renderer=this._createRenderer()),this.hasLayer(C)||this.addLayer(C),C},_getPaneRenderer:function(f){if("overlayPane"===f||void 0===f)return!1;var C=this._paneRenderers[f];return void 0===C&&(C=this._createRenderer({pane:f}),this._paneRenderers[f]=C),C},_createRenderer:function(f){return this.options.preferCanvas&&yc(f)||Fl(f)}});var ps=no.extend({initialize:function(f,C){no.prototype.initialize.call(this,this._boundsToLatLngs(f),C)},setBounds:function(f){return this.setLatLngs(this._boundsToLatLngs(f))},_boundsToLatLngs:function(f){return[(f=Wt(f)).getSouthWest(),f.getNorthWest(),f.getNorthEast(),f.getSouthEast()]}});_i.create=vc,_i.pointsToPath=Oe,Es.geometryToLayer=Yo,Es.coordsToLatLng=zc,Es.coordsToLatLngs=mc,Es.latLngToCoords=Ho,Es.latLngsToCoords=Ol,Es.getFeature=Xo,Es.asFeature=Bc,Li.mergeOptions({boxZoom:!0});var zl=Ws.extend({initialize:function(f){this._map=f,this._container=f._container,this._pane=f._panes.overlayPane,this._resetStateTimeout=0,f.on("unload",this._destroy,this)},addHooks:function(){$n(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){yn(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Qi(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(f){if(!f.shiftKey||1!==f.which&&1!==f.button)return!1;this._clearDeferredResetState(),this._resetState(),ti(),La(),this._startPoint=this._map.mouseEventToContainerPoint(f),$n(document,{contextmenu:Ts,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(f){this._moved||(this._moved=!0,this._box=Ai("div","leaflet-zoom-box",this._container),On(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(f);var C=new ht(this._point,this._startPoint),P=C.getSize();dr(this._box,C.min),this._box.style.width=P.x+"px",this._box.style.height=P.y+"px"},_finish:function(){this._moved&&(Qi(this._box),eo(this._container,"leaflet-crosshair")),Uo(),Pl(),yn(document,{contextmenu:Ts,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(f){if((1===f.which||1===f.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(p(this._resetState,this),0);var C=new ln(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(C).fire("boxzoomend",{boxZoomBounds:C})}},_onKeyDown:function(f){27===f.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Li.addInitHook("addHandler","boxZoom",zl),Li.mergeOptions({doubleClickZoom:!0});var mh=Ws.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(f){var C=this._map,P=C.getZoom(),B=C.options.zoomDelta,Y=f.originalEvent.shiftKey?P-B:P+B;"center"===C.options.doubleClickZoom?C.setZoom(Y):C.setZoomAround(f.containerPoint,Y)}});Li.addInitHook("addHandler","doubleClickZoom",mh),Li.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var lf=Ws.extend({addHooks:function(){if(!this._draggable){var f=this._map;this._draggable=new _o(f._mapPane,f._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),f.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),f.on("zoomend",this._onZoomEnd,this),f.whenReady(this._onZoomEnd,this))}On(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){eo(this._map._container,"leaflet-grab"),eo(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var f=this._map;if(f._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var C=Wt(this._map.options.maxBounds);this._offsetLimit=Sn(this._map.latLngToContainerPoint(C.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(C.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;f.fire("movestart").fire("dragstart"),f.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(f){if(this._map.options.inertia){var C=this._lastTime=+new Date,P=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(P),this._times.push(C),this._prunePositions(C)}this._map.fire("move",f).fire("drag",f)},_prunePositions:function(f){for(;this._positions.length>1&&f-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var f=this._map.getSize().divideBy(2),C=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=C.subtract(f).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(f,C){return f-(f-C)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var f=this._draggable._newPos.subtract(this._draggable._startPos),C=this._offsetLimit;f.x<C.min.x&&(f.x=this._viscousLimit(f.x,C.min.x)),f.y<C.min.y&&(f.y=this._viscousLimit(f.y,C.min.y)),f.x>C.max.x&&(f.x=this._viscousLimit(f.x,C.max.x)),f.y>C.max.y&&(f.y=this._viscousLimit(f.y,C.max.y)),this._draggable._newPos=this._draggable._startPos.add(f)}},_onPreDragWrap:function(){var f=this._worldWidth,C=Math.round(f/2),P=this._initialWorldOffset,B=this._draggable._newPos.x,Y=(B-C+P)%f+C-P,_e=(B+C+P)%f-C-P,qe=Math.abs(Y+P)<Math.abs(_e+P)?Y:_e;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=qe},_onDragEnd:function(f){var C=this._map,P=C.options,B=!P.inertia||f.noInertia||this._times.length<2;if(C.fire("dragend",f),B)C.fire("moveend");else{this._prunePositions(+new Date);var Y=this._lastPos.subtract(this._positions[0]),qe=P.easeLinearity,at=Y.multiplyBy(qe/((this._lastTime-this._times[0])/1e3)),wt=at.distanceTo([0,0]),Yt=Math.min(P.inertiaMaxSpeed,wt),wn=at.multiplyBy(Yt/wt),ei=Yt/(P.inertiaDeceleration*qe),Ti=wn.multiplyBy(-ei/2).round();Ti.x||Ti.y?(Ti=C._limitOffset(Ti,C.options.maxBounds),Ze(function(){C.panBy(Ti,{duration:ei,easeLinearity:qe,noMoveStart:!0,animate:!0})})):C.fire("moveend")}}});Li.addInitHook("addHandler","dragging",lf),Li.mergeOptions({keyboard:!0,keyboardPanDelta:80});var gh=Ws.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(f){this._map=f,this._setPanDelta(f.options.keyboardPanDelta),this._setZoomDelta(f.options.zoomDelta)},addHooks:function(){var f=this._map._container;f.tabIndex<=0&&(f.tabIndex="0"),$n(f,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),yn(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var f=document.body,C=document.documentElement,P=f.scrollTop||C.scrollTop,B=f.scrollLeft||C.scrollLeft;this._map._container.focus(),window.scrollTo(B,P)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(f){var B,Y,C=this._panKeys={},P=this.keyCodes;for(B=0,Y=P.left.length;B<Y;B++)C[P.left[B]]=[-1*f,0];for(B=0,Y=P.right.length;B<Y;B++)C[P.right[B]]=[f,0];for(B=0,Y=P.down.length;B<Y;B++)C[P.down[B]]=[0,f];for(B=0,Y=P.up.length;B<Y;B++)C[P.up[B]]=[0,-1*f]},_setZoomDelta:function(f){var B,Y,C=this._zoomKeys={},P=this.keyCodes;for(B=0,Y=P.zoomIn.length;B<Y;B++)C[P.zoomIn[B]]=f;for(B=0,Y=P.zoomOut.length;B<Y;B++)C[P.zoomOut[B]]=-f},_addHooks:function(){$n(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){yn(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(f){if(!(f.altKey||f.ctrlKey||f.metaKey)){var B,C=f.keyCode,P=this._map;if(C in this._panKeys){if(!P._panAnim||!P._panAnim._inProgress)if(B=this._panKeys[C],f.shiftKey&&(B=nt(B).multiplyBy(3)),P.options.maxBounds&&(B=P._limitOffset(nt(B),P.options.maxBounds)),P.options.worldCopyJump){var Y=P.wrapLatLng(P.unproject(P.project(P.getCenter()).add(B)));P.panTo(Y)}else P.panBy(B)}else if(C in this._zoomKeys)P.setZoom(P.getZoom()+(f.shiftKey?3:1)*this._zoomKeys[C]);else{if(27!==C||!P._popup||!P._popup.options.closeOnEscapeKey)return;P.closePopup()}Ts(f)}}});Li.addInitHook("addHandler","keyboard",gh),Li.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Uc=Ws.extend({addHooks:function(){$n(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){yn(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(f){var C=ki(f),P=this._map.options.wheelDebounceTime;this._delta+=C,this._lastMousePos=this._map.mouseEventToContainerPoint(f),this._startTime||(this._startTime=+new Date);var B=Math.max(P-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(p(this._performZoom,this),B),Ts(f)},_performZoom:function(){var f=this._map,C=f.getZoom(),P=this._map.options.zoomSnap||0;f._stop();var Y=4*Math.log(2/(1+Math.exp(-Math.abs(this._delta/(4*this._map.options.wheelPxPerZoomLevel)))))/Math.LN2,_e=P?Math.ceil(Y/P)*P:Y,qe=f._limitZoom(C+(this._delta>0?_e:-_e))-C;this._delta=0,this._startTime=null,qe&&("center"===f.options.scrollWheelZoom?f.setZoom(C+qe):f.setZoomAround(this._lastMousePos,C+qe))}});Li.addInitHook("addHandler","scrollWheelZoom",Uc);Li.mergeOptions({tapHold:gn.touchNative&&gn.safari&&gn.mobile,tapTolerance:15});var wu=Ws.extend({addHooks:function(){$n(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){yn(this._map._container,"touchstart",this._onDown,this)},_onDown:function(f){if(clearTimeout(this._holdTimeout),1===f.touches.length){var C=f.touches[0];this._startPos=this._newPos=new pt(C.clientX,C.clientY),this._holdTimeout=setTimeout(p(function(){this._cancel(),this._isTapValid()&&($n(document,"touchend",rr),$n(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",C))},this),600),$n(document,"touchend touchcancel contextmenu",this._cancel,this),$n(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function f(){yn(document,"touchend",rr),yn(document,"touchend touchcancel",f)},_cancel:function(){clearTimeout(this._holdTimeout),yn(document,"touchend touchcancel contextmenu",this._cancel,this),yn(document,"touchmove",this._onMove,this)},_onMove:function(f){var C=f.touches[0];this._newPos=new pt(C.clientX,C.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(f,C){var P=new MouseEvent(f,{bubbles:!0,cancelable:!0,view:window,screenX:C.screenX,screenY:C.screenY,clientX:C.clientX,clientY:C.clientY});P._simulated=!0,C.target.dispatchEvent(P)}});Li.addInitHook("addHandler","tapHold",wu),Li.mergeOptions({touchZoom:gn.touch,bounceAtZoomLimits:!0});var Cu=Ws.extend({addHooks:function(){On(this._map._container,"leaflet-touch-zoom"),$n(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){eo(this._map._container,"leaflet-touch-zoom"),yn(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(f){var C=this._map;if(f.touches&&2===f.touches.length&&!C._animatingZoom&&!this._zooming){var P=C.mouseEventToContainerPoint(f.touches[0]),B=C.mouseEventToContainerPoint(f.touches[1]);this._centerPoint=C.getSize()._divideBy(2),this._startLatLng=C.containerPointToLatLng(this._centerPoint),"center"!==C.options.touchZoom&&(this._pinchStartLatLng=C.containerPointToLatLng(P.add(B)._divideBy(2))),this._startDist=P.distanceTo(B),this._startZoom=C.getZoom(),this._moved=!1,this._zooming=!0,C._stop(),$n(document,"touchmove",this._onTouchMove,this),$n(document,"touchend touchcancel",this._onTouchEnd,this),rr(f)}},_onTouchMove:function(f){if(f.touches&&2===f.touches.length&&this._zooming){var C=this._map,P=C.mouseEventToContainerPoint(f.touches[0]),B=C.mouseEventToContainerPoint(f.touches[1]),Y=P.distanceTo(B)/this._startDist;if(this._zoom=C.getScaleZoom(Y,this._startZoom),!C.options.bounceAtZoomLimits&&(this._zoom<C.getMinZoom()&&Y<1||this._zoom>C.getMaxZoom()&&Y>1)&&(this._zoom=C._limitZoom(this._zoom)),"center"===C.options.touchZoom){if(this._center=this._startLatLng,1===Y)return}else{var _e=P._add(B)._divideBy(2)._subtract(this._centerPoint);if(1===Y&&0===_e.x&&0===_e.y)return;this._center=C.unproject(C.project(this._pinchStartLatLng,this._zoom).subtract(_e),this._zoom)}this._moved||(C._moveStart(!0,!1),this._moved=!0),Dt(this._animRequest);var qe=p(C._move,C,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=Ze(qe,this,!0),rr(f)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,Dt(this._animRequest),yn(document,"touchmove",this._onTouchMove,this),yn(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});Li.addInitHook("addHandler","touchZoom",Cu),Li.BoxZoom=zl,Li.DoubleClickZoom=mh,Li.Drag=lf,Li.Keyboard=gh,Li.ScrollWheelZoom=Uc,Li.TapHold=wu,Li.TouchZoom=Cu,et.Bounds=ht,et.Browser=gn,et.CRS=Zn,et.Canvas=rl,et.Circle=_u,et.CircleMarker=Na,et.Class=Rt,et.Control=Go,et.DivIcon=fs,et.DivOverlay=Pr,et.DomEvent=Al,et.DomUtil=ss,et.Draggable=_o,et.Evented=Qn,et.FeatureGroup=Ca,et.GeoJSON=Es,et.GridLayer=il,et.Handler=Ws,et.Icon=Ta,et.ImageOverlay=yu,et.LatLng=Pn,et.LatLngBounds=ln,et.Layer=fa,et.LayerGroup=dc,et.LineUtil=Ms,et.Map=Li,et.Marker=mu,et.Mixin=Wr,et.Path=Da,et.Point=pt,et.PolyUtil=da,et.Polygon=no,et.Polyline=Po,et.Popup=ma,et.PosAnimation=Ri,et.Projection=fu,et.Rectangle=ps,et.Renderer=Ks,et.SVG=_i,et.SVGOverlay=wi,et.TileLayer=Is,et.Tooltip=gc,et.Transformation=pr,et.Util=pe,et.VideoOverlay=vu,et.bind=p,et.bounds=Sn,et.canvas=yc,et.circle=function sf(f,C,P){return new _u(f,C,P)},et.circleMarker=function Mp(f,C){return new Na(f,C)},et.control=Ds,et.divIcon=function gd(f){return new fs(f)},et.extend=Pe,et.featureGroup=function(f,C){return new Ca(f,C)},et.geoJSON=Ln,et.geoJson=pa,et.gridLayer=function af(f){return new il(f)},et.icon=function pu(f){return new Ta(f)},et.imageOverlay=function(f,C,P){return new yu(f,C,P)},et.latLng=zn,et.latLngBounds=Wt,et.layerGroup=function(f,C){return new dc(f,C)},et.map=function sn(f,C){return new Li(f,C)},et.marker=function gu(f,C){return new mu(f,C)},et.point=nt,et.polygon=function fc(f,C){return new no(f,C)},et.polyline=function md(f,C){return new Po(f,C)},et.popup=function(f,C){return new ma(f,C)},et.rectangle=function Nl(f,C){return new ps(f,C)},et.setOptions=K,et.stamp=he,et.svg=Fl,et.svgOverlay=function yo(f,C,P){return new wi(f,C,P)},et.tileLayer=bu,et.tooltip=function(f,C){return new gc(f,C)},et.transformation=Jr,et.version="1.9.4",et.videoOverlay=function Ss(f,C,P){return new vu(f,C,P)};var bc=window.L;et.noConflict=function(){return window.L=bc,this},window.L=et}(Je)},247:uu=>{uu.exports=function Je(et,st,Pe){function I(he,be){if(!st[he]){if(!et[he]){if(p)return p(he,!0);var ve=new Error("Cannot find module '"+he+"'");throw ve.code="MODULE_NOT_FOUND",ve}var ee=st[he]={exports:{}};et[he][0].call(ee.exports,function(fe){return I(et[he][1][fe]||fe)},ee,ee.exports,Je,et,st,Pe)}return st[he].exports}for(var p=void 0,Z=0;Z<Pe.length;Z++)I(Pe[Z]);return I}({1:[function(Je,et,st){"use strict";var Pe=Je("./utils"),I=Je("./support"),p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";st.encode=function(Z){for(var he,be,me,ee,fe,ue,K=[],Ee=0,Ie=Z.length,Ue=Ie,ot="string"!==Pe.getTypeOf(Z);Ee<Z.length;)Ue=Ie-Ee,me=ot?(he=Z[Ee++],be=Ee<Ie?Z[Ee++]:0,Ee<Ie?Z[Ee++]:0):(he=Z.charCodeAt(Ee++),be=Ee<Ie?Z.charCodeAt(Ee++):0,Ee<Ie?Z.charCodeAt(Ee++):0),ee=(3&he)<<4|be>>4,fe=1<Ue?(15&be)<<2|me>>6:64,ue=2<Ue?63&me:64,K.push(p.charAt(he>>2)+p.charAt(ee)+p.charAt(fe)+p.charAt(ue));return K.join("")},st.decode=function(Z){var he,be,me,ve,ee,fe,ue=0,K=0;if("data:"===Z.substr(0,5))throw new Error("Invalid base64 input, it looks like a data url.");var Ie,Ue=3*(Z=Z.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(Z.charAt(Z.length-1)===p.charAt(64)&&Ue--,Z.charAt(Z.length-2)===p.charAt(64)&&Ue--,Ue%1!=0)throw new Error("Invalid base64 input, bad content length.");for(Ie=I.uint8array?new Uint8Array(0|Ue):new Array(0|Ue);ue<Z.length;)he=p.indexOf(Z.charAt(ue++))<<2|(ve=p.indexOf(Z.charAt(ue++)))>>4,be=(15&ve)<<4|(ee=p.indexOf(Z.charAt(ue++)))>>2,me=(3&ee)<<6|(fe=p.indexOf(Z.charAt(ue++))),Ie[K++]=he,64!==ee&&(Ie[K++]=be),64!==fe&&(Ie[K++]=me);return Ie}},{"./support":30,"./utils":32}],2:[function(Je,et,st){"use strict";var Pe=Je("./external"),I=Je("./stream/DataWorker"),p=Je("./stream/Crc32Probe"),Z=Je("./stream/DataLengthProbe");function he(be,me,ve,ee,fe){this.compressedSize=be,this.uncompressedSize=me,this.crc32=ve,this.compression=ee,this.compressedContent=fe}he.prototype={getContentWorker:function(){var be=new I(Pe.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new Z("data_length")),me=this;return be.on("end",function(){if(this.streamInfo.data_length!==me.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),be},getCompressedWorker:function(){return new I(Pe.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},he.createWorkerFrom=function(be,me,ve){return be.pipe(new p).pipe(new Z("uncompressedSize")).pipe(me.compressWorker(ve)).pipe(new Z("compressedSize")).withStreamInfo("compression",me)},et.exports=he},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(Je,et,st){"use strict";var Pe=Je("./stream/GenericWorker");st.STORE={magic:"\0\0",compressWorker:function(){return new Pe("STORE compression")},uncompressWorker:function(){return new Pe("STORE decompression")}},st.DEFLATE=Je("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(Je,et,st){"use strict";var Pe=Je("./utils"),I=function(){for(var p,Z=[],he=0;he<256;he++){p=he;for(var be=0;be<8;be++)p=1&p?3988292384^p>>>1:p>>>1;Z[he]=p}return Z}();et.exports=function(p,Z){return void 0!==p&&p.length?"string"!==Pe.getTypeOf(p)?function(he,be,me){var ee=I,fe=0+me;he^=-1;for(var ue=0;ue<fe;ue++)he=he>>>8^ee[255&(he^be[ue])];return~he}(0|Z,p,p.length):function(he,be,me){var ee=I,fe=0+me;he^=-1;for(var ue=0;ue<fe;ue++)he=he>>>8^ee[255&(he^be.charCodeAt(ue))];return~he}(0|Z,p,p.length):0}},{"./utils":32}],5:[function(Je,et,st){"use strict";st.base64=!1,st.binary=!1,st.dir=!1,st.createFolders=!0,st.date=null,st.compression=null,st.compressionOptions=null,st.comment=null,st.unixPermissions=null,st.dosPermissions=null},{}],6:[function(Je,et,st){"use strict";var Pe;Pe=typeof Promise<"u"?Promise:Je("lie"),et.exports={Promise:Pe}},{lie:37}],7:[function(Je,et,st){"use strict";var Pe=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",I=Je("pako"),p=Je("./utils"),Z=Je("./stream/GenericWorker"),he=Pe?"uint8array":"array";function be(me,ve){Z.call(this,"FlateWorker/"+me),this._pako=null,this._pakoAction=me,this._pakoOptions=ve,this.meta={}}st.magic="\b\0",p.inherits(be,Z),be.prototype.processChunk=function(me){this.meta=me.meta,null===this._pako&&this._createPako(),this._pako.push(p.transformTo(he,me.data),!1)},be.prototype.flush=function(){Z.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},be.prototype.cleanUp=function(){Z.prototype.cleanUp.call(this),this._pako=null},be.prototype._createPako=function(){this._pako=new I[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var me=this;this._pako.onData=function(ve){me.push({data:ve,meta:me.meta})}},st.compressWorker=function(me){return new be("Deflate",me)},st.uncompressWorker=function(){return new be("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(Je,et,st){"use strict";function Pe(ee,fe){var ue,K="";for(ue=0;ue<fe;ue++)K+=String.fromCharCode(255&ee),ee>>>=8;return K}function I(ee,fe,ue,K,Ee,Ie){var Ue,ot,ct=ee.file,St=ee.compression,xt=Ie!==he.utf8encode,Qt=p.transformTo("string",Ie(ct.name)),Mt=p.transformTo("string",he.utf8encode(ct.name)),on=ct.comment,Hn=p.transformTo("string",Ie(on)),Ze=p.transformTo("string",he.utf8encode(on)),Dt=Mt.length!==ct.name.length,pe=Ze.length!==on.length,Rt="",ii="",Bt="",Qn=ct.dir,pt=ct.date,Nn={crc32:0,compressedSize:0,uncompressedSize:0};fe&&!ue||(Nn.crc32=ee.crc32,Nn.compressedSize=ee.compressedSize,Nn.uncompressedSize=ee.uncompressedSize);var nt=0;fe&&(nt|=8),xt||!Dt&&!pe||(nt|=2048);var Wt,zn,ht=0,Sn=0;Qn&&(ht|=16),"UNIX"===Ee?(Sn=798,ht|=(zn=Wt=ct.unixPermissions,Wt||(zn=Qn?16893:33204),(65535&zn)<<16)):(Sn=20,ht|=function(Wt){return 63&(Wt||0)}(ct.dosPermissions)),Ue=pt.getUTCHours(),Ue<<=6,Ue|=pt.getUTCMinutes(),Ue<<=5,Ue|=pt.getUTCSeconds()/2,ot=pt.getUTCFullYear()-1980,ot<<=4,ot|=pt.getUTCMonth()+1,ot<<=5,ot|=pt.getUTCDate(),Dt&&(ii=Pe(1,1)+Pe(be(Qt),4)+Mt,Rt+="up"+Pe(ii.length,2)+ii),pe&&(Bt=Pe(1,1)+Pe(be(Hn),4)+Ze,Rt+="uc"+Pe(Bt.length,2)+Bt);var ln="";return ln+="\n\0",ln+=Pe(nt,2),ln+=St.magic,ln+=Pe(Ue,2),ln+=Pe(ot,2),ln+=Pe(Nn.crc32,4),ln+=Pe(Nn.compressedSize,4),ln+=Pe(Nn.uncompressedSize,4),ln+=Pe(Qt.length,2),ln+=Pe(Rt.length,2),{fileRecord:me.LOCAL_FILE_HEADER+ln+Qt+Rt,dirRecord:me.CENTRAL_FILE_HEADER+Pe(Sn,2)+ln+Pe(Hn.length,2)+"\0\0\0\0"+Pe(ht,4)+Pe(K,4)+Qt+Rt+Hn}}var p=Je("../utils"),Z=Je("../stream/GenericWorker"),he=Je("../utf8"),be=Je("../crc32"),me=Je("../signature");function ve(ee,fe,ue,K){Z.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=fe,this.zipPlatform=ue,this.encodeFileName=K,this.streamFiles=ee,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}p.inherits(ve,Z),ve.prototype.push=function(ee){var fe=ee.meta.percent||0,ue=this.entriesCount,K=this._sources.length;this.accumulate?this.contentBuffer.push(ee):(this.bytesWritten+=ee.data.length,Z.prototype.push.call(this,{data:ee.data,meta:{currentFile:this.currentFile,percent:ue?(fe+100*(ue-K-1))/ue:100}}))},ve.prototype.openedSource=function(ee){this.currentSourceOffset=this.bytesWritten,this.currentFile=ee.file.name;var fe=this.streamFiles&&!ee.file.dir;if(fe){var ue=I(ee,fe,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:ue.fileRecord,meta:{percent:0}})}else this.accumulate=!0},ve.prototype.closedSource=function(ee){this.accumulate=!1;var K,fe=this.streamFiles&&!ee.file.dir,ue=I(ee,fe,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(ue.dirRecord),fe)this.push({data:(K=ee,me.DATA_DESCRIPTOR+Pe(K.crc32,4)+Pe(K.compressedSize,4)+Pe(K.uncompressedSize,4)),meta:{percent:100}});else for(this.push({data:ue.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},ve.prototype.flush=function(){for(var ee=this.bytesWritten,fe=0;fe<this.dirRecords.length;fe++)this.push({data:this.dirRecords[fe],meta:{percent:100}});var Ee,Ie,Ue,St,K=(Ee=this.dirRecords.length,Ie=this.bytesWritten-ee,Ue=ee,St=p.transformTo("string",(0,this.encodeFileName)(this.zipComment)),me.CENTRAL_DIRECTORY_END+"\0\0\0\0"+Pe(Ee,2)+Pe(Ee,2)+Pe(Ie,4)+Pe(Ue,4)+Pe(St.length,2)+St);this.push({data:K,meta:{percent:100}})},ve.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},ve.prototype.registerPrevious=function(ee){this._sources.push(ee);var fe=this;return ee.on("data",function(ue){fe.processChunk(ue)}),ee.on("end",function(){fe.closedSource(fe.previous.streamInfo),fe._sources.length?fe.prepareNextSource():fe.end()}),ee.on("error",function(ue){fe.error(ue)}),this},ve.prototype.resume=function(){return!!Z.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},ve.prototype.error=function(ee){var fe=this._sources;if(!Z.prototype.error.call(this,ee))return!1;for(var ue=0;ue<fe.length;ue++)try{fe[ue].error(ee)}catch{}return!0},ve.prototype.lock=function(){Z.prototype.lock.call(this);for(var ee=this._sources,fe=0;fe<ee.length;fe++)ee[fe].lock()},et.exports=ve},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(Je,et,st){"use strict";var Pe=Je("../compressions"),I=Je("./ZipFileWorker");st.generateWorker=function(p,Z,he){var be=new I(Z.streamFiles,he,Z.platform,Z.encodeFileName),me=0;try{p.forEach(function(ve,ee){me++;var fe=function(Ie,Ue){var ot=Ie||Ue,ct=Pe[ot];if(!ct)throw new Error(ot+" is not a valid compression method !");return ct}(ee.options.compression,Z.compression),K=ee.dir,Ee=ee.date;ee._compressWorker(fe,ee.options.compressionOptions||Z.compressionOptions||{}).withStreamInfo("file",{name:ve,dir:K,date:Ee,comment:ee.comment||"",unixPermissions:ee.unixPermissions,dosPermissions:ee.dosPermissions}).pipe(be)}),be.entriesCount=me}catch(ve){be.error(ve)}return be}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(Je,et,st){"use strict";function Pe(){if(!(this instanceof Pe))return new Pe;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var I=new Pe;for(var p in this)"function"!=typeof this[p]&&(I[p]=this[p]);return I}}(Pe.prototype=Je("./object")).loadAsync=Je("./load"),Pe.support=Je("./support"),Pe.defaults=Je("./defaults"),Pe.version="3.10.1",Pe.loadAsync=function(I,p){return(new Pe).loadAsync(I,p)},Pe.external=Je("./external"),et.exports=Pe},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(Je,et,st){"use strict";var Pe=Je("./utils"),I=Je("./external"),p=Je("./utf8"),Z=Je("./zipEntries"),he=Je("./stream/Crc32Probe"),be=Je("./nodejsUtils");function me(ve){return new I.Promise(function(ee,fe){var ue=ve.decompressed.getContentWorker().pipe(new he);ue.on("error",function(K){fe(K)}).on("end",function(){ue.streamInfo.crc32!==ve.decompressed.crc32?fe(new Error("Corrupted zip : CRC32 mismatch")):ee()}).resume()})}et.exports=function(ve,ee){var fe=this;return ee=Pe.extend(ee||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:p.utf8decode}),be.isNode&&be.isStream(ve)?I.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):Pe.prepareContent("the loaded zip file",ve,!0,ee.optimizedBinaryString,ee.base64).then(function(ue){var K=new Z(ee);return K.load(ue),K}).then(function(ue){var K=[I.Promise.resolve(ue)],Ee=ue.files;if(ee.checkCRC32)for(var Ie=0;Ie<Ee.length;Ie++)K.push(me(Ee[Ie]));return I.Promise.all(K)}).then(function(ue){for(var K=ue.shift(),Ee=K.files,Ie=0;Ie<Ee.length;Ie++){var Ue=Ee[Ie],ot=Ue.fileNameStr,ct=Pe.resolve(Ue.fileNameStr);fe.file(ct,Ue.decompressed,{binary:!0,optimizedBinaryString:!0,date:Ue.date,dir:Ue.dir,comment:Ue.fileCommentStr.length?Ue.fileCommentStr:null,unixPermissions:Ue.unixPermissions,dosPermissions:Ue.dosPermissions,createFolders:ee.createFolders}),Ue.dir||(fe.file(ct).unsafeOriginalName=ot)}return K.zipComment.length&&(fe.comment=K.zipComment),fe})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(Je,et,st){"use strict";var Pe=Je("../utils"),I=Je("../stream/GenericWorker");function p(Z,he){I.call(this,"Nodejs stream input adapter for "+Z),this._upstreamEnded=!1,this._bindStream(he)}Pe.inherits(p,I),p.prototype._bindStream=function(Z){var he=this;(this._stream=Z).pause(),Z.on("data",function(be){he.push({data:be,meta:{percent:0}})}).on("error",function(be){he.isPaused?this.generatedError=be:he.error(be)}).on("end",function(){he.isPaused?he._upstreamEnded=!0:he.end()})},p.prototype.pause=function(){return!!I.prototype.pause.call(this)&&(this._stream.pause(),!0)},p.prototype.resume=function(){return!!I.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},et.exports=p},{"../stream/GenericWorker":28,"../utils":32}],13:[function(Je,et,st){"use strict";var Pe=Je("readable-stream").Readable;function I(p,Z,he){Pe.call(this,Z),this._helper=p;var be=this;p.on("data",function(me,ve){be.push(me)||be._helper.pause(),he&&he(ve)}).on("error",function(me){be.emit("error",me)}).on("end",function(){be.push(null)})}Je("../utils").inherits(I,Pe),I.prototype._read=function(){this._helper.resume()},et.exports=I},{"../utils":32,"readable-stream":16}],14:[function(Je,et,st){"use strict";et.exports={isNode:typeof Buffer<"u",newBufferFrom:function(Pe,I){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(Pe,I);if("number"==typeof Pe)throw new Error('The "data" argument must not be a number');return new Buffer(Pe,I)},allocBuffer:function(Pe){if(Buffer.alloc)return Buffer.alloc(Pe);var I=new Buffer(Pe);return I.fill(0),I},isBuffer:function(Pe){return Buffer.isBuffer(Pe)},isStream:function(Pe){return Pe&&"function"==typeof Pe.on&&"function"==typeof Pe.pause&&"function"==typeof Pe.resume}}},{}],15:[function(Je,et,st){"use strict";function Pe(ct,St,xt){var Qt,Mt=p.getTypeOf(St),on=p.extend(xt||{},be);on.date=on.date||new Date,null!==on.compression&&(on.compression=on.compression.toUpperCase()),"string"==typeof on.unixPermissions&&(on.unixPermissions=parseInt(on.unixPermissions,8)),on.unixPermissions&&16384&on.unixPermissions&&(on.dir=!0),on.dosPermissions&&16&on.dosPermissions&&(on.dir=!0),on.dir&&(ct=Ee(ct)),on.createFolders&&(Qt=K(ct))&&Ie.call(this,Qt,!0),xt&&void 0!==xt.binary||(on.binary=!("string"===Mt&&!1===on.binary&&!1===on.base64)),(St instanceof me&&0===St.uncompressedSize||on.dir||!St||0===St.length)&&(on.base64=!1,on.binary=!0,St="",on.compression="STORE",Mt="string");var Ze;Ze=St instanceof me||St instanceof Z?St:fe.isNode&&fe.isStream(St)?new ue(ct,St):p.prepareContent(ct,St,on.binary,on.optimizedBinaryString,on.base64);var Dt=new ve(ct,Ze,on);this.files[ct]=Dt}var I=Je("./utf8"),p=Je("./utils"),Z=Je("./stream/GenericWorker"),he=Je("./stream/StreamHelper"),be=Je("./defaults"),me=Je("./compressedObject"),ve=Je("./zipObject"),ee=Je("./generate"),fe=Je("./nodejsUtils"),ue=Je("./nodejs/NodejsStreamInputAdapter"),K=function(ct){"/"===ct.slice(-1)&&(ct=ct.substring(0,ct.length-1));var St=ct.lastIndexOf("/");return 0<St?ct.substring(0,St):""},Ee=function(ct){return"/"!==ct.slice(-1)&&(ct+="/"),ct},Ie=function(ct,St){return St=void 0!==St?St:be.createFolders,ct=Ee(ct),this.files[ct]||Pe.call(this,ct,null,{dir:!0,createFolders:St}),this.files[ct]};function Ue(ct){return"[object RegExp]"===Object.prototype.toString.call(ct)}var ot={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(ct){var St,xt,Qt;for(St in this.files)Qt=this.files[St],(xt=St.slice(this.root.length,St.length))&&St.slice(0,this.root.length)===this.root&&ct(xt,Qt)},filter:function(ct){var St=[];return this.forEach(function(xt,Qt){ct(xt,Qt)&&St.push(Qt)}),St},file:function(ct,St,xt){if(1!==arguments.length)return Pe.call(this,ct=this.root+ct,St,xt),this;if(Ue(ct)){var Qt=ct;return this.filter(function(on,Hn){return!Hn.dir&&Qt.test(on)})}var Mt=this.files[this.root+ct];return Mt&&!Mt.dir?Mt:null},folder:function(ct){if(!ct)return this;if(Ue(ct))return this.filter(function(Mt,on){return on.dir&&ct.test(Mt)});var xt=Ie.call(this,this.root+ct),Qt=this.clone();return Qt.root=xt.name,Qt},remove:function(ct){var St=this.files[ct=this.root+ct];if(St||("/"!==ct.slice(-1)&&(ct+="/"),St=this.files[ct]),St&&!St.dir)delete this.files[ct];else for(var xt=this.filter(function(Mt,on){return on.name.slice(0,ct.length)===ct}),Qt=0;Qt<xt.length;Qt++)delete this.files[xt[Qt].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(ct){var St,xt={};try{if((xt=p.extend(ct||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:I.utf8encode})).type=xt.type.toLowerCase(),xt.compression=xt.compression.toUpperCase(),"binarystring"===xt.type&&(xt.type="string"),!xt.type)throw new Error("No output type specified.");p.checkSupport(xt.type),"darwin"!==xt.platform&&"freebsd"!==xt.platform&&"linux"!==xt.platform&&"sunos"!==xt.platform||(xt.platform="UNIX"),"win32"===xt.platform&&(xt.platform="DOS"),St=ee.generateWorker(this,xt,xt.comment||this.comment||"")}catch(Mt){(St=new Z("error")).error(Mt)}return new he(St,xt.type||"string",xt.mimeType)},generateAsync:function(ct,St){return this.generateInternalStream(ct).accumulate(St)},generateNodeStream:function(ct,St){return(ct=ct||{}).type||(ct.type="nodebuffer"),this.generateInternalStream(ct).toNodejsStream(St)}};et.exports=ot},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(Je,et,st){"use strict";et.exports=Je("stream")},{stream:void 0}],17:[function(Je,et,st){"use strict";var Pe=Je("./DataReader");function I(p){Pe.call(this,p);for(var Z=0;Z<this.data.length;Z++)p[Z]=255&p[Z]}Je("../utils").inherits(I,Pe),I.prototype.byteAt=function(p){return this.data[this.zero+p]},I.prototype.lastIndexOfSignature=function(p){for(var Z=p.charCodeAt(0),he=p.charCodeAt(1),be=p.charCodeAt(2),me=p.charCodeAt(3),ve=this.length-4;0<=ve;--ve)if(this.data[ve]===Z&&this.data[ve+1]===he&&this.data[ve+2]===be&&this.data[ve+3]===me)return ve-this.zero;return-1},I.prototype.readAndCheckSignature=function(p){var Z=p.charCodeAt(0),he=p.charCodeAt(1),be=p.charCodeAt(2),me=p.charCodeAt(3),ve=this.readData(4);return Z===ve[0]&&he===ve[1]&&be===ve[2]&&me===ve[3]},I.prototype.readData=function(p){if(this.checkOffset(p),0===p)return[];var Z=this.data.slice(this.zero+this.index,this.zero+this.index+p);return this.index+=p,Z},et.exports=I},{"../utils":32,"./DataReader":18}],18:[function(Je,et,st){"use strict";var Pe=Je("../utils");function I(p){this.data=p,this.length=p.length,this.index=0,this.zero=0}I.prototype={checkOffset:function(p){this.checkIndex(this.index+p)},checkIndex:function(p){if(this.length<this.zero+p||p<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+p+"). Corrupted zip ?")},setIndex:function(p){this.checkIndex(p),this.index=p},skip:function(p){this.setIndex(this.index+p)},byteAt:function(){},readInt:function(p){var Z,he=0;for(this.checkOffset(p),Z=this.index+p-1;Z>=this.index;Z--)he=(he<<8)+this.byteAt(Z);return this.index+=p,he},readString:function(p){return Pe.transformTo("string",this.readData(p))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var p=this.readInt(4);return new Date(Date.UTC(1980+(p>>25&127),(p>>21&15)-1,p>>16&31,p>>11&31,p>>5&63,(31&p)<<1))}},et.exports=I},{"../utils":32}],19:[function(Je,et,st){"use strict";var Pe=Je("./Uint8ArrayReader");function I(p){Pe.call(this,p)}Je("../utils").inherits(I,Pe),I.prototype.readData=function(p){this.checkOffset(p);var Z=this.data.slice(this.zero+this.index,this.zero+this.index+p);return this.index+=p,Z},et.exports=I},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(Je,et,st){"use strict";var Pe=Je("./DataReader");function I(p){Pe.call(this,p)}Je("../utils").inherits(I,Pe),I.prototype.byteAt=function(p){return this.data.charCodeAt(this.zero+p)},I.prototype.lastIndexOfSignature=function(p){return this.data.lastIndexOf(p)-this.zero},I.prototype.readAndCheckSignature=function(p){return p===this.readData(4)},I.prototype.readData=function(p){this.checkOffset(p);var Z=this.data.slice(this.zero+this.index,this.zero+this.index+p);return this.index+=p,Z},et.exports=I},{"../utils":32,"./DataReader":18}],21:[function(Je,et,st){"use strict";var Pe=Je("./ArrayReader");function I(p){Pe.call(this,p)}Je("../utils").inherits(I,Pe),I.prototype.readData=function(p){if(this.checkOffset(p),0===p)return new Uint8Array(0);var Z=this.data.subarray(this.zero+this.index,this.zero+this.index+p);return this.index+=p,Z},et.exports=I},{"../utils":32,"./ArrayReader":17}],22:[function(Je,et,st){"use strict";var Pe=Je("../utils"),I=Je("../support"),p=Je("./ArrayReader"),Z=Je("./StringReader"),he=Je("./NodeBufferReader"),be=Je("./Uint8ArrayReader");et.exports=function(me){var ve=Pe.getTypeOf(me);return Pe.checkSupport(ve),"string"!==ve||I.uint8array?"nodebuffer"===ve?new he(me):I.uint8array?new be(Pe.transformTo("uint8array",me)):new p(Pe.transformTo("array",me)):new Z(me)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(Je,et,st){"use strict";st.LOCAL_FILE_HEADER="PK\x03\x04",st.CENTRAL_FILE_HEADER="PK\x01\x02",st.CENTRAL_DIRECTORY_END="PK\x05\x06",st.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x06\x07",st.ZIP64_CENTRAL_DIRECTORY_END="PK\x06\x06",st.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(Je,et,st){"use strict";var Pe=Je("./GenericWorker"),I=Je("../utils");function p(Z){Pe.call(this,"ConvertWorker to "+Z),this.destType=Z}I.inherits(p,Pe),p.prototype.processChunk=function(Z){this.push({data:I.transformTo(this.destType,Z.data),meta:Z.meta})},et.exports=p},{"../utils":32,"./GenericWorker":28}],25:[function(Je,et,st){"use strict";var Pe=Je("./GenericWorker"),I=Je("../crc32");function p(){Pe.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}Je("../utils").inherits(p,Pe),p.prototype.processChunk=function(Z){this.streamInfo.crc32=I(Z.data,this.streamInfo.crc32||0),this.push(Z)},et.exports=p},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(Je,et,st){"use strict";var Pe=Je("../utils"),I=Je("./GenericWorker");function p(Z){I.call(this,"DataLengthProbe for "+Z),this.propName=Z,this.withStreamInfo(Z,0)}Pe.inherits(p,I),p.prototype.processChunk=function(Z){Z&&(this.streamInfo[this.propName]=(this.streamInfo[this.propName]||0)+Z.data.length),I.prototype.processChunk.call(this,Z)},et.exports=p},{"../utils":32,"./GenericWorker":28}],27:[function(Je,et,st){"use strict";var Pe=Je("../utils"),I=Je("./GenericWorker");function p(Z){I.call(this,"DataWorker");var he=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,Z.then(function(be){he.dataIsReady=!0,he.data=be,he.max=be&&be.length||0,he.type=Pe.getTypeOf(be),he.isPaused||he._tickAndRepeat()},function(be){he.error(be)})}Pe.inherits(p,I),p.prototype.cleanUp=function(){I.prototype.cleanUp.call(this),this.data=null},p.prototype.resume=function(){return!!I.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,Pe.delay(this._tickAndRepeat,[],this)),!0)},p.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(Pe.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},p.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var Z=null,he=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":Z=this.data.substring(this.index,he);break;case"uint8array":Z=this.data.subarray(this.index,he);break;case"array":case"nodebuffer":Z=this.data.slice(this.index,he)}return this.index=he,this.push({data:Z,meta:{percent:this.max?this.index/this.max*100:0}})},et.exports=p},{"../utils":32,"./GenericWorker":28}],28:[function(Je,et,st){"use strict";function Pe(I){this.name=I||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}Pe.prototype={push:function(I){this.emit("data",I)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(I){this.emit("error",I)}return!0},error:function(I){return!this.isFinished&&(this.isPaused?this.generatedError=I:(this.isFinished=!0,this.emit("error",I),this.previous&&this.previous.error(I),this.cleanUp()),!0)},on:function(I,p){return this._listeners[I].push(p),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(I,p){if(this._listeners[I])for(var Z=0;Z<this._listeners[I].length;Z++)this._listeners[I][Z].call(this,p)},pipe:function(I){return I.registerPrevious(this)},registerPrevious:function(I){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=I.streamInfo,this.mergeStreamInfo(),this.previous=I;var p=this;return I.on("data",function(Z){p.processChunk(Z)}),I.on("end",function(){p.end()}),I.on("error",function(Z){p.error(Z)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var I=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),I=!0),this.previous&&this.previous.resume(),!I},flush:function(){},processChunk:function(I){this.push(I)},withStreamInfo:function(I,p){return this.extraStreamInfo[I]=p,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var I in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,I)&&(this.streamInfo[I]=this.extraStreamInfo[I])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var I="Worker "+this.name;return this.previous?this.previous+" -> "+I:I}},et.exports=Pe},{}],29:[function(Je,et,st){"use strict";var Pe=Je("../utils"),I=Je("./ConvertWorker"),p=Je("./GenericWorker"),Z=Je("../base64"),he=Je("../support"),be=Je("../external"),me=null;if(he.nodestream)try{me=Je("../nodejs/NodejsStreamOutputAdapter")}catch{}function ee(fe,ue,K){var Ee=ue;switch(ue){case"blob":case"arraybuffer":Ee="uint8array";break;case"base64":Ee="string"}try{this._internalType=Ee,this._outputType=ue,this._mimeType=K,Pe.checkSupport(Ee),this._worker=fe.pipe(new I(Ee)),fe.lock()}catch(Ie){this._worker=new p("error"),this._worker.error(Ie)}}ee.prototype={accumulate:function(fe){return function ve(fe,ue){return new be.Promise(function(K,Ee){var Ie=[],Ue=fe._internalType,ot=fe._outputType,ct=fe._mimeType;fe.on("data",function(St,xt){Ie.push(St),ue&&ue(xt)}).on("error",function(St){Ie=[],Ee(St)}).on("end",function(){try{var St=function(xt,Qt,Mt){switch(xt){case"blob":return Pe.newBlob(Pe.transformTo("arraybuffer",Qt),Mt);case"base64":return Z.encode(Qt);default:return Pe.transformTo(xt,Qt)}}(ot,function(xt,Qt){var Mt,on=0,Hn=null,Ze=0;for(Mt=0;Mt<Qt.length;Mt++)Ze+=Qt[Mt].length;switch(xt){case"string":return Qt.join("");case"array":return Array.prototype.concat.apply([],Qt);case"uint8array":for(Hn=new Uint8Array(Ze),Mt=0;Mt<Qt.length;Mt++)Hn.set(Qt[Mt],on),on+=Qt[Mt].length;return Hn;case"nodebuffer":return Buffer.concat(Qt);default:throw new Error("concat : unsupported type '"+xt+"'")}}(Ue,Ie),ct);K(St)}catch(xt){Ee(xt)}Ie=[]}).resume()})}(this,fe)},on:function(fe,ue){var K=this;return this._worker.on(fe,"data"===fe?function(Ee){ue.call(K,Ee.data,Ee.meta)}:function(){Pe.delay(ue,arguments,K)}),this},resume:function(){return Pe.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(fe){if(Pe.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new me(this,{objectMode:"nodebuffer"!==this._outputType},fe)}},et.exports=ee},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(Je,et,st){"use strict";if(st.base64=!0,st.array=!0,st.string=!0,st.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",st.nodebuffer=typeof Buffer<"u",st.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")st.blob=!1;else{var Pe=new ArrayBuffer(0);try{st.blob=0===new Blob([Pe],{type:"application/zip"}).size}catch{try{var I=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);I.append(Pe),st.blob=0===I.getBlob("application/zip").size}catch{st.blob=!1}}}try{st.nodestream=!!Je("readable-stream").Readable}catch{st.nodestream=!1}},{"readable-stream":16}],31:[function(Je,et,st){"use strict";for(var Pe=Je("./utils"),I=Je("./support"),p=Je("./nodejsUtils"),Z=Je("./stream/GenericWorker"),he=new Array(256),be=0;be<256;be++)he[be]=252<=be?6:248<=be?5:240<=be?4:224<=be?3:192<=be?2:1;function me(){Z.call(this,"utf-8 decode"),this.leftOver=null}function ve(){Z.call(this,"utf-8 encode")}he[254]=he[254]=1,st.utf8encode=function(ee){return I.nodebuffer?p.newBufferFrom(ee,"utf-8"):function(fe){var ue,K,Ee,Ie,Ue,ot=fe.length,ct=0;for(Ie=0;Ie<ot;Ie++)55296==(64512&(K=fe.charCodeAt(Ie)))&&Ie+1<ot&&56320==(64512&(Ee=fe.charCodeAt(Ie+1)))&&(K=65536+(K-55296<<10)+(Ee-56320),Ie++),ct+=K<128?1:K<2048?2:K<65536?3:4;for(ue=I.uint8array?new Uint8Array(ct):new Array(ct),Ie=Ue=0;Ue<ct;Ie++)55296==(64512&(K=fe.charCodeAt(Ie)))&&Ie+1<ot&&56320==(64512&(Ee=fe.charCodeAt(Ie+1)))&&(K=65536+(K-55296<<10)+(Ee-56320),Ie++),K<128?ue[Ue++]=K:(K<2048?ue[Ue++]=192|K>>>6:(K<65536?ue[Ue++]=224|K>>>12:(ue[Ue++]=240|K>>>18,ue[Ue++]=128|K>>>12&63),ue[Ue++]=128|K>>>6&63),ue[Ue++]=128|63&K);return ue}(ee)},st.utf8decode=function(ee){return I.nodebuffer?Pe.transformTo("nodebuffer",ee).toString("utf-8"):function(fe){var ue,K,Ee,Ie,Ue=fe.length,ot=new Array(2*Ue);for(ue=K=0;ue<Ue;)if((Ee=fe[ue++])<128)ot[K++]=Ee;else if(4<(Ie=he[Ee]))ot[K++]=65533,ue+=Ie-1;else{for(Ee&=2===Ie?31:3===Ie?15:7;1<Ie&&ue<Ue;)Ee=Ee<<6|63&fe[ue++],Ie--;1<Ie?ot[K++]=65533:Ee<65536?ot[K++]=Ee:(ot[K++]=55296|(Ee-=65536)>>10&1023,ot[K++]=56320|1023&Ee)}return ot.length!==K&&(ot.subarray?ot=ot.subarray(0,K):ot.length=K),Pe.applyFromCharCode(ot)}(ee=Pe.transformTo(I.uint8array?"uint8array":"array",ee))},Pe.inherits(me,Z),me.prototype.processChunk=function(ee){var fe=Pe.transformTo(I.uint8array?"uint8array":"array",ee.data);if(this.leftOver&&this.leftOver.length){if(I.uint8array){var ue=fe;(fe=new Uint8Array(ue.length+this.leftOver.length)).set(this.leftOver,0),fe.set(ue,this.leftOver.length)}else fe=this.leftOver.concat(fe);this.leftOver=null}var K=function(Ie,Ue){var ot;for((Ue=Ue||Ie.length)>Ie.length&&(Ue=Ie.length),ot=Ue-1;0<=ot&&128==(192&Ie[ot]);)ot--;return ot<0||0===ot?Ue:ot+he[Ie[ot]]>Ue?ot:Ue}(fe),Ee=fe;K!==fe.length&&(I.uint8array?(Ee=fe.subarray(0,K),this.leftOver=fe.subarray(K,fe.length)):(Ee=fe.slice(0,K),this.leftOver=fe.slice(K,fe.length))),this.push({data:st.utf8decode(Ee),meta:ee.meta})},me.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:st.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},st.Utf8DecodeWorker=me,Pe.inherits(ve,Z),ve.prototype.processChunk=function(ee){this.push({data:st.utf8encode(ee.data),meta:ee.meta})},st.Utf8EncodeWorker=ve},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(Je,et,st){"use strict";var Pe=Je("./support"),I=Je("./base64"),p=Je("./nodejsUtils"),Z=Je("./external");function he(ue){return ue}function be(ue,K){for(var Ee=0;Ee<ue.length;++Ee)K[Ee]=255&ue.charCodeAt(Ee);return K}Je("setimmediate"),st.newBlob=function(ue,K){st.checkSupport("blob");try{return new Blob([ue],{type:K})}catch{try{var Ee=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return Ee.append(ue),Ee.getBlob(K)}catch{throw new Error("Bug : can't construct the Blob.")}}};var me={stringifyByChunk:function(ue,K,Ee){var Ie=[],Ue=0,ot=ue.length;if(ot<=Ee)return String.fromCharCode.apply(null,ue);for(;Ue<ot;)Ie.push(String.fromCharCode.apply(null,"array"===K||"nodebuffer"===K?ue.slice(Ue,Math.min(Ue+Ee,ot)):ue.subarray(Ue,Math.min(Ue+Ee,ot)))),Ue+=Ee;return Ie.join("")},stringifyByChar:function(ue){for(var K="",Ee=0;Ee<ue.length;Ee++)K+=String.fromCharCode(ue[Ee]);return K},applyCanBeUsed:{uint8array:function(){try{return Pe.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch{return!1}}(),nodebuffer:function(){try{return Pe.nodebuffer&&1===String.fromCharCode.apply(null,p.allocBuffer(1)).length}catch{return!1}}()}};function ve(ue){var K=65536,Ee=st.getTypeOf(ue),Ie=!0;if("uint8array"===Ee?Ie=me.applyCanBeUsed.uint8array:"nodebuffer"===Ee&&(Ie=me.applyCanBeUsed.nodebuffer),Ie)for(;1<K;)try{return me.stringifyByChunk(ue,Ee,K)}catch{K=Math.floor(K/2)}return me.stringifyByChar(ue)}function ee(ue,K){for(var Ee=0;Ee<ue.length;Ee++)K[Ee]=ue[Ee];return K}st.applyFromCharCode=ve;var fe={};fe.string={string:he,array:function(ue){return be(ue,new Array(ue.length))},arraybuffer:function(ue){return fe.string.uint8array(ue).buffer},uint8array:function(ue){return be(ue,new Uint8Array(ue.length))},nodebuffer:function(ue){return be(ue,p.allocBuffer(ue.length))}},fe.array={string:ve,array:he,arraybuffer:function(ue){return new Uint8Array(ue).buffer},uint8array:function(ue){return new Uint8Array(ue)},nodebuffer:function(ue){return p.newBufferFrom(ue)}},fe.arraybuffer={string:function(ue){return ve(new Uint8Array(ue))},array:function(ue){return ee(new Uint8Array(ue),new Array(ue.byteLength))},arraybuffer:he,uint8array:function(ue){return new Uint8Array(ue)},nodebuffer:function(ue){return p.newBufferFrom(new Uint8Array(ue))}},fe.uint8array={string:ve,array:function(ue){return ee(ue,new Array(ue.length))},arraybuffer:function(ue){return ue.buffer},uint8array:he,nodebuffer:function(ue){return p.newBufferFrom(ue)}},fe.nodebuffer={string:ve,array:function(ue){return ee(ue,new Array(ue.length))},arraybuffer:function(ue){return fe.nodebuffer.uint8array(ue).buffer},uint8array:function(ue){return ee(ue,new Uint8Array(ue.length))},nodebuffer:he},st.transformTo=function(ue,K){if(K=K||"",!ue)return K;st.checkSupport(ue);var Ee=st.getTypeOf(K);return fe[Ee][ue](K)},st.resolve=function(ue){for(var K=ue.split("/"),Ee=[],Ie=0;Ie<K.length;Ie++){var Ue=K[Ie];"."===Ue||""===Ue&&0!==Ie&&Ie!==K.length-1||(".."===Ue?Ee.pop():Ee.push(Ue))}return Ee.join("/")},st.getTypeOf=function(ue){return"string"==typeof ue?"string":"[object Array]"===Object.prototype.toString.call(ue)?"array":Pe.nodebuffer&&p.isBuffer(ue)?"nodebuffer":Pe.uint8array&&ue instanceof Uint8Array?"uint8array":Pe.arraybuffer&&ue instanceof ArrayBuffer?"arraybuffer":void 0},st.checkSupport=function(ue){if(!Pe[ue.toLowerCase()])throw new Error(ue+" is not supported by this platform")},st.MAX_VALUE_16BITS=65535,st.MAX_VALUE_32BITS=-1,st.pretty=function(ue){var K,Ee,Ie="";for(Ee=0;Ee<(ue||"").length;Ee++)Ie+="\\x"+((K=ue.charCodeAt(Ee))<16?"0":"")+K.toString(16).toUpperCase();return Ie},st.delay=function(ue,K,Ee){setImmediate(function(){ue.apply(Ee||null,K||[])})},st.inherits=function(ue,K){function Ee(){}Ee.prototype=K.prototype,ue.prototype=new Ee},st.extend=function(){var ue,K,Ee={};for(ue=0;ue<arguments.length;ue++)for(K in arguments[ue])Object.prototype.hasOwnProperty.call(arguments[ue],K)&&void 0===Ee[K]&&(Ee[K]=arguments[ue][K]);return Ee},st.prepareContent=function(ue,K,Ee,Ie,Ue){return Z.Promise.resolve(K).then(function(ot){return Pe.blob&&(ot instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(ot)))&&typeof FileReader<"u"?new Z.Promise(function(ct,St){var xt=new FileReader;xt.onload=function(Qt){ct(Qt.target.result)},xt.onerror=function(Qt){St(Qt.target.error)},xt.readAsArrayBuffer(ot)}):ot}).then(function(ot){var St,ct=st.getTypeOf(ot);return ct?("arraybuffer"===ct?ot=st.transformTo("uint8array",ot):"string"===ct&&(Ue?ot=I.decode(ot):Ee&&!0!==Ie&&(ot=be(St=ot,Pe.uint8array?new Uint8Array(St.length):new Array(St.length)))),ot):Z.Promise.reject(new Error("Can't read the data of '"+ue+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(Je,et,st){"use strict";var Pe=Je("./reader/readerFor"),I=Je("./utils"),p=Je("./signature"),Z=Je("./zipEntry"),he=Je("./support");function be(me){this.files=[],this.loadOptions=me}be.prototype={checkSignature:function(me){if(!this.reader.readAndCheckSignature(me)){this.reader.index-=4;var ve=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+I.pretty(ve)+", expected "+I.pretty(me)+")")}},isSignature:function(me,ve){var ee=this.reader.index;this.reader.setIndex(me);var fe=this.reader.readString(4)===ve;return this.reader.setIndex(ee),fe},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var me=this.reader.readData(this.zipCommentLength),ee=I.transformTo(he.uint8array?"uint8array":"array",me);this.zipComment=this.loadOptions.decodeFileName(ee)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var me,ve,ee,fe=this.zip64EndOfCentralSize-44;0<fe;)me=this.reader.readInt(2),ve=this.reader.readInt(4),ee=this.reader.readData(ve),this.zip64ExtensibleData[me]={id:me,length:ve,value:ee}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var me,ve;for(me=0;me<this.files.length;me++)this.reader.setIndex((ve=this.files[me]).localHeaderOffset),this.checkSignature(p.LOCAL_FILE_HEADER),ve.readLocalPart(this.reader),ve.handleUTF8(),ve.processAttributes()},readCentralDir:function(){var me;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(p.CENTRAL_FILE_HEADER);)(me=new Z({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(me);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var me=this.reader.lastIndexOfSignature(p.CENTRAL_DIRECTORY_END);if(me<0)throw this.isSignature(0,p.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(me);var ve=me;if(this.checkSignature(p.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===I.MAX_VALUE_16BITS||this.diskWithCentralDirStart===I.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===I.MAX_VALUE_16BITS||this.centralDirRecords===I.MAX_VALUE_16BITS||this.centralDirSize===I.MAX_VALUE_32BITS||this.centralDirOffset===I.MAX_VALUE_32BITS){if(this.zip64=!0,(me=this.reader.lastIndexOfSignature(p.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(me),this.checkSignature(p.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,p.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(p.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(p.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var ee=this.centralDirOffset+this.centralDirSize;this.zip64&&(ee+=20,ee+=12+this.zip64EndOfCentralSize);var fe=ve-ee;if(0<fe)this.isSignature(ve,p.CENTRAL_FILE_HEADER)||(this.reader.zero=fe);else if(fe<0)throw new Error("Corrupted zip: missing "+Math.abs(fe)+" bytes.")},prepareReader:function(me){this.reader=Pe(me)},load:function(me){this.prepareReader(me),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},et.exports=be},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(Je,et,st){"use strict";var Pe=Je("./reader/readerFor"),I=Je("./utils"),p=Je("./compressedObject"),Z=Je("./crc32"),he=Je("./utf8"),be=Je("./compressions"),me=Je("./support");function ve(ee,fe){this.options=ee,this.loadOptions=fe}ve.prototype={isEncrypted:function(){return!(1&~this.bitFlag)},useUTF8:function(){return!(2048&~this.bitFlag)},readLocalPart:function(ee){var fe,ue;if(ee.skip(22),this.fileNameLength=ee.readInt(2),ue=ee.readInt(2),this.fileName=ee.readData(this.fileNameLength),ee.skip(ue),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(fe=function(K){for(var Ee in be)if(Object.prototype.hasOwnProperty.call(be,Ee)&&be[Ee].magic===K)return be[Ee];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+I.pretty(this.compressionMethod)+" unknown (inner file : "+I.transformTo("string",this.fileName)+")");this.decompressed=new p(this.compressedSize,this.uncompressedSize,this.crc32,fe,ee.readData(this.compressedSize))},readCentralPart:function(ee){this.versionMadeBy=ee.readInt(2),ee.skip(2),this.bitFlag=ee.readInt(2),this.compressionMethod=ee.readString(2),this.date=ee.readDate(),this.crc32=ee.readInt(4),this.compressedSize=ee.readInt(4),this.uncompressedSize=ee.readInt(4);var fe=ee.readInt(2);if(this.extraFieldsLength=ee.readInt(2),this.fileCommentLength=ee.readInt(2),this.diskNumberStart=ee.readInt(2),this.internalFileAttributes=ee.readInt(2),this.externalFileAttributes=ee.readInt(4),this.localHeaderOffset=ee.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");ee.skip(fe),this.readExtraFields(ee),this.parseZIP64ExtraField(ee),this.fileComment=ee.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var ee=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==ee&&(this.dosPermissions=63&this.externalFileAttributes),3==ee&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var ee=Pe(this.extraFields[1].value);this.uncompressedSize===I.MAX_VALUE_32BITS&&(this.uncompressedSize=ee.readInt(8)),this.compressedSize===I.MAX_VALUE_32BITS&&(this.compressedSize=ee.readInt(8)),this.localHeaderOffset===I.MAX_VALUE_32BITS&&(this.localHeaderOffset=ee.readInt(8)),this.diskNumberStart===I.MAX_VALUE_32BITS&&(this.diskNumberStart=ee.readInt(4))}},readExtraFields:function(ee){var fe,ue,K,Ee=ee.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});ee.index+4<Ee;)fe=ee.readInt(2),ue=ee.readInt(2),K=ee.readData(ue),this.extraFields[fe]={id:fe,length:ue,value:K};ee.setIndex(Ee)},handleUTF8:function(){var ee=me.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=he.utf8decode(this.fileName),this.fileCommentStr=he.utf8decode(this.fileComment);else{var fe=this.findExtraFieldUnicodePath();if(null!==fe)this.fileNameStr=fe;else{var ue=I.transformTo(ee,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(ue)}var K=this.findExtraFieldUnicodeComment();if(null!==K)this.fileCommentStr=K;else{var Ee=I.transformTo(ee,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(Ee)}}},findExtraFieldUnicodePath:function(){var ee=this.extraFields[28789];if(ee){var fe=Pe(ee.value);return 1!==fe.readInt(1)||Z(this.fileName)!==fe.readInt(4)?null:he.utf8decode(fe.readData(ee.length-5))}return null},findExtraFieldUnicodeComment:function(){var ee=this.extraFields[25461];if(ee){var fe=Pe(ee.value);return 1!==fe.readInt(1)||Z(this.fileComment)!==fe.readInt(4)?null:he.utf8decode(fe.readData(ee.length-5))}return null}},et.exports=ve},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(Je,et,st){"use strict";function Pe(fe,ue,K){this.name=fe,this.dir=K.dir,this.date=K.date,this.comment=K.comment,this.unixPermissions=K.unixPermissions,this.dosPermissions=K.dosPermissions,this._data=ue,this._dataBinary=K.binary,this.options={compression:K.compression,compressionOptions:K.compressionOptions}}var I=Je("./stream/StreamHelper"),p=Je("./stream/DataWorker"),Z=Je("./utf8"),he=Je("./compressedObject"),be=Je("./stream/GenericWorker");Pe.prototype={internalStream:function(fe){var ue=null,K="string";try{if(!fe)throw new Error("No output type specified.");var Ee="string"===(K=fe.toLowerCase())||"text"===K;"binarystring"!==K&&"text"!==K||(K="string"),ue=this._decompressWorker();var Ie=!this._dataBinary;Ie&&!Ee&&(ue=ue.pipe(new Z.Utf8EncodeWorker)),!Ie&&Ee&&(ue=ue.pipe(new Z.Utf8DecodeWorker))}catch(Ue){(ue=new be("error")).error(Ue)}return new I(ue,K,"")},async:function(fe,ue){return this.internalStream(fe).accumulate(ue)},nodeStream:function(fe,ue){return this.internalStream(fe||"nodebuffer").toNodejsStream(ue)},_compressWorker:function(fe,ue){if(this._data instanceof he&&this._data.compression.magic===fe.magic)return this._data.getCompressedWorker();var K=this._decompressWorker();return this._dataBinary||(K=K.pipe(new Z.Utf8EncodeWorker)),he.createWorkerFrom(K,fe,ue)},_decompressWorker:function(){return this._data instanceof he?this._data.getContentWorker():this._data instanceof be?this._data:new p(this._data)}};for(var me=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],ve=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},ee=0;ee<me.length;ee++)Pe.prototype[me[ee]]=ve;et.exports=Pe},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(Je,et,st){(function(Pe){"use strict";var I,p,Z=Pe.MutationObserver||Pe.WebKitMutationObserver;if(Z){var he=0,be=new Z(fe),me=Pe.document.createTextNode("");be.observe(me,{characterData:!0}),I=function(){me.data=he=++he%2}}else if(Pe.setImmediate||void 0===Pe.MessageChannel)I="document"in Pe&&"onreadystatechange"in Pe.document.createElement("script")?function(){var ue=Pe.document.createElement("script");ue.onreadystatechange=function(){fe(),ue.onreadystatechange=null,ue.parentNode.removeChild(ue),ue=null},Pe.document.documentElement.appendChild(ue)}:function(){setTimeout(fe,0)};else{var ve=new Pe.MessageChannel;ve.port1.onmessage=fe,I=function(){ve.port2.postMessage(0)}}var ee=[];function fe(){var ue,K;p=!0;for(var Ee=ee.length;Ee;){for(K=ee,ee=[],ue=-1;++ue<Ee;)K[ue]();Ee=ee.length}p=!1}et.exports=function(ue){1!==ee.push(ue)||p||I()}}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(Je,et,st){"use strict";var Pe=Je("immediate");function I(){}var p={},Z=["REJECTED"],he=["FULFILLED"],be=["PENDING"];function me(Ee){if("function"!=typeof Ee)throw new TypeError("resolver must be a function");this.state=be,this.queue=[],this.outcome=void 0,Ee!==I&&ue(this,Ee)}function ve(Ee,Ie,Ue){this.promise=Ee,"function"==typeof Ie&&(this.onFulfilled=Ie,this.callFulfilled=this.otherCallFulfilled),"function"==typeof Ue&&(this.onRejected=Ue,this.callRejected=this.otherCallRejected)}function ee(Ee,Ie,Ue){Pe(function(){var ot;try{ot=Ie(Ue)}catch(ct){return p.reject(Ee,ct)}ot===Ee?p.reject(Ee,new TypeError("Cannot resolve promise with itself")):p.resolve(Ee,ot)})}function fe(Ee){var Ie=Ee&&Ee.then;if(Ee&&("object"==typeof Ee||"function"==typeof Ee)&&"function"==typeof Ie)return function(){Ie.apply(Ee,arguments)}}function ue(Ee,Ie){var Ue=!1;function ot(xt){Ue||(Ue=!0,p.reject(Ee,xt))}function ct(xt){Ue||(Ue=!0,p.resolve(Ee,xt))}var St=K(function(){Ie(ct,ot)});"error"===St.status&&ot(St.value)}function K(Ee,Ie){var Ue={};try{Ue.value=Ee(Ie),Ue.status="success"}catch(ot){Ue.status="error",Ue.value=ot}return Ue}(et.exports=me).prototype.finally=function(Ee){if("function"!=typeof Ee)return this;var Ie=this.constructor;return this.then(function(Ue){return Ie.resolve(Ee()).then(function(){return Ue})},function(Ue){return Ie.resolve(Ee()).then(function(){throw Ue})})},me.prototype.catch=function(Ee){return this.then(null,Ee)},me.prototype.then=function(Ee,Ie){if("function"!=typeof Ee&&this.state===he||"function"!=typeof Ie&&this.state===Z)return this;var Ue=new this.constructor(I);return this.state!==be?ee(Ue,this.state===he?Ee:Ie,this.outcome):this.queue.push(new ve(Ue,Ee,Ie)),Ue},ve.prototype.callFulfilled=function(Ee){p.resolve(this.promise,Ee)},ve.prototype.otherCallFulfilled=function(Ee){ee(this.promise,this.onFulfilled,Ee)},ve.prototype.callRejected=function(Ee){p.reject(this.promise,Ee)},ve.prototype.otherCallRejected=function(Ee){ee(this.promise,this.onRejected,Ee)},p.resolve=function(Ee,Ie){var Ue=K(fe,Ie);if("error"===Ue.status)return p.reject(Ee,Ue.value);var ot=Ue.value;if(ot)ue(Ee,ot);else{Ee.state=he,Ee.outcome=Ie;for(var ct=-1,St=Ee.queue.length;++ct<St;)Ee.queue[ct].callFulfilled(Ie)}return Ee},p.reject=function(Ee,Ie){Ee.state=Z,Ee.outcome=Ie;for(var Ue=-1,ot=Ee.queue.length;++Ue<ot;)Ee.queue[Ue].callRejected(Ie);return Ee},me.resolve=function(Ee){return Ee instanceof this?Ee:p.resolve(new this(I),Ee)},me.reject=function(Ee){var Ie=new this(I);return p.reject(Ie,Ee)},me.all=function(Ee){var Ie=this;if("[object Array]"!==Object.prototype.toString.call(Ee))return this.reject(new TypeError("must be an array"));var Ue=Ee.length,ot=!1;if(!Ue)return this.resolve([]);for(var ct=new Array(Ue),St=0,xt=-1,Qt=new this(I);++xt<Ue;)Mt(Ee[xt],xt);return Qt;function Mt(on,Hn){Ie.resolve(on).then(function(Ze){ct[Hn]=Ze,++St!==Ue||ot||(ot=!0,p.resolve(Qt,ct))},function(Ze){ot||(ot=!0,p.reject(Qt,Ze))})}},me.race=function(Ee){if("[object Array]"!==Object.prototype.toString.call(Ee))return this.reject(new TypeError("must be an array"));var Ue=Ee.length,ot=!1;if(!Ue)return this.resolve([]);for(var ct=-1,St=new this(I);++ct<Ue;)this.resolve(Ee[ct]).then(function(Qt){ot||(ot=!0,p.resolve(St,Qt))},function(Qt){ot||(ot=!0,p.reject(St,Qt))});return St}},{immediate:36}],38:[function(Je,et,st){"use strict";var Pe={};(0,Je("./lib/utils/common").assign)(Pe,Je("./lib/deflate"),Je("./lib/inflate"),Je("./lib/zlib/constants")),et.exports=Pe},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(Je,et,st){"use strict";var Pe=Je("./zlib/deflate"),I=Je("./utils/common"),p=Je("./utils/strings"),Z=Je("./zlib/messages"),he=Je("./zlib/zstream"),be=Object.prototype.toString;function ue(Ee){if(!(this instanceof ue))return new ue(Ee);this.options=I.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},Ee||{});var Ie=this.options;Ie.raw&&0<Ie.windowBits?Ie.windowBits=-Ie.windowBits:Ie.gzip&&0<Ie.windowBits&&Ie.windowBits<16&&(Ie.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new he,this.strm.avail_out=0;var Ue=Pe.deflateInit2(this.strm,Ie.level,Ie.method,Ie.windowBits,Ie.memLevel,Ie.strategy);if(0!==Ue)throw new Error(Z[Ue]);if(Ie.header&&Pe.deflateSetHeader(this.strm,Ie.header),Ie.dictionary){var ot;if(ot="string"==typeof Ie.dictionary?p.string2buf(Ie.dictionary):"[object ArrayBuffer]"===be.call(Ie.dictionary)?new Uint8Array(Ie.dictionary):Ie.dictionary,0!==(Ue=Pe.deflateSetDictionary(this.strm,ot)))throw new Error(Z[Ue]);this._dict_set=!0}}function K(Ee,Ie){var Ue=new ue(Ie);if(Ue.push(Ee,!0),Ue.err)throw Ue.msg||Z[Ue.err];return Ue.result}ue.prototype.push=function(Ee,Ie){var Ue,ot,ct=this.strm,St=this.options.chunkSize;if(this.ended)return!1;ot=Ie===~~Ie?Ie:!0===Ie?4:0,ct.input="string"==typeof Ee?p.string2buf(Ee):"[object ArrayBuffer]"===be.call(Ee)?new Uint8Array(Ee):Ee,ct.next_in=0,ct.avail_in=ct.input.length;do{if(0===ct.avail_out&&(ct.output=new I.Buf8(St),ct.next_out=0,ct.avail_out=St),1!==(Ue=Pe.deflate(ct,ot))&&0!==Ue)return this.onEnd(Ue),!(this.ended=!0);0!==ct.avail_out&&(0!==ct.avail_in||4!==ot&&2!==ot)||this.onData("string"===this.options.to?p.buf2binstring(I.shrinkBuf(ct.output,ct.next_out)):I.shrinkBuf(ct.output,ct.next_out))}while((0<ct.avail_in||0===ct.avail_out)&&1!==Ue);return 4===ot?(Ue=Pe.deflateEnd(this.strm),this.onEnd(Ue),this.ended=!0,0===Ue):2!==ot||(this.onEnd(0),!(ct.avail_out=0))},ue.prototype.onData=function(Ee){this.chunks.push(Ee)},ue.prototype.onEnd=function(Ee){0===Ee&&(this.result="string"===this.options.to?this.chunks.join(""):I.flattenChunks(this.chunks)),this.chunks=[],this.err=Ee,this.msg=this.strm.msg},st.Deflate=ue,st.deflate=K,st.deflateRaw=function(Ee,Ie){return(Ie=Ie||{}).raw=!0,K(Ee,Ie)},st.gzip=function(Ee,Ie){return(Ie=Ie||{}).gzip=!0,K(Ee,Ie)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(Je,et,st){"use strict";var Pe=Je("./zlib/inflate"),I=Je("./utils/common"),p=Je("./utils/strings"),Z=Je("./zlib/constants"),he=Je("./zlib/messages"),be=Je("./zlib/zstream"),me=Je("./zlib/gzheader"),ve=Object.prototype.toString;function ee(ue){if(!(this instanceof ee))return new ee(ue);this.options=I.assign({chunkSize:16384,windowBits:0,to:""},ue||{});var K=this.options;K.raw&&0<=K.windowBits&&K.windowBits<16&&(K.windowBits=-K.windowBits,0===K.windowBits&&(K.windowBits=-15)),!(0<=K.windowBits&&K.windowBits<16)||ue&&ue.windowBits||(K.windowBits+=32),15<K.windowBits&&K.windowBits<48&&!(15&K.windowBits)&&(K.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new be,this.strm.avail_out=0;var Ee=Pe.inflateInit2(this.strm,K.windowBits);if(Ee!==Z.Z_OK)throw new Error(he[Ee]);this.header=new me,Pe.inflateGetHeader(this.strm,this.header)}function fe(ue,K){var Ee=new ee(K);if(Ee.push(ue,!0),Ee.err)throw Ee.msg||he[Ee.err];return Ee.result}ee.prototype.push=function(ue,K){var Ee,Ie,Ue,ot,ct,St,xt=this.strm,Qt=this.options.chunkSize,Mt=this.options.dictionary,on=!1;if(this.ended)return!1;Ie=K===~~K?K:!0===K?Z.Z_FINISH:Z.Z_NO_FLUSH,xt.input="string"==typeof ue?p.binstring2buf(ue):"[object ArrayBuffer]"===ve.call(ue)?new Uint8Array(ue):ue,xt.next_in=0,xt.avail_in=xt.input.length;do{if(0===xt.avail_out&&(xt.output=new I.Buf8(Qt),xt.next_out=0,xt.avail_out=Qt),(Ee=Pe.inflate(xt,Z.Z_NO_FLUSH))===Z.Z_NEED_DICT&&Mt&&(St="string"==typeof Mt?p.string2buf(Mt):"[object ArrayBuffer]"===ve.call(Mt)?new Uint8Array(Mt):Mt,Ee=Pe.inflateSetDictionary(this.strm,St)),Ee===Z.Z_BUF_ERROR&&!0===on&&(Ee=Z.Z_OK,on=!1),Ee!==Z.Z_STREAM_END&&Ee!==Z.Z_OK)return this.onEnd(Ee),!(this.ended=!0);xt.next_out&&(0!==xt.avail_out&&Ee!==Z.Z_STREAM_END&&(0!==xt.avail_in||Ie!==Z.Z_FINISH&&Ie!==Z.Z_SYNC_FLUSH)||("string"===this.options.to?(Ue=p.utf8border(xt.output,xt.next_out),ot=xt.next_out-Ue,ct=p.buf2string(xt.output,Ue),xt.next_out=ot,xt.avail_out=Qt-ot,ot&&I.arraySet(xt.output,xt.output,Ue,ot,0),this.onData(ct)):this.onData(I.shrinkBuf(xt.output,xt.next_out)))),0===xt.avail_in&&0===xt.avail_out&&(on=!0)}while((0<xt.avail_in||0===xt.avail_out)&&Ee!==Z.Z_STREAM_END);return Ee===Z.Z_STREAM_END&&(Ie=Z.Z_FINISH),Ie===Z.Z_FINISH?(Ee=Pe.inflateEnd(this.strm),this.onEnd(Ee),this.ended=!0,Ee===Z.Z_OK):Ie!==Z.Z_SYNC_FLUSH||(this.onEnd(Z.Z_OK),!(xt.avail_out=0))},ee.prototype.onData=function(ue){this.chunks.push(ue)},ee.prototype.onEnd=function(ue){ue===Z.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):I.flattenChunks(this.chunks)),this.chunks=[],this.err=ue,this.msg=this.strm.msg},st.Inflate=ee,st.inflate=fe,st.inflateRaw=function(ue,K){return(K=K||{}).raw=!0,fe(ue,K)},st.ungzip=fe},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(Je,et,st){"use strict";var Pe=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";st.assign=function(Z){for(var he=Array.prototype.slice.call(arguments,1);he.length;){var be=he.shift();if(be){if("object"!=typeof be)throw new TypeError(be+"must be non-object");for(var me in be)be.hasOwnProperty(me)&&(Z[me]=be[me])}}return Z},st.shrinkBuf=function(Z,he){return Z.length===he?Z:Z.subarray?Z.subarray(0,he):(Z.length=he,Z)};var I={arraySet:function(Z,he,be,me,ve){if(he.subarray&&Z.subarray)Z.set(he.subarray(be,be+me),ve);else for(var ee=0;ee<me;ee++)Z[ve+ee]=he[be+ee]},flattenChunks:function(Z){var he,be,me,ve,ee,fe;for(he=me=0,be=Z.length;he<be;he++)me+=Z[he].length;for(fe=new Uint8Array(me),he=ve=0,be=Z.length;he<be;he++)fe.set(ee=Z[he],ve),ve+=ee.length;return fe}},p={arraySet:function(Z,he,be,me,ve){for(var ee=0;ee<me;ee++)Z[ve+ee]=he[be+ee]},flattenChunks:function(Z){return[].concat.apply([],Z)}};st.setTyped=function(Z){Z?(st.Buf8=Uint8Array,st.Buf16=Uint16Array,st.Buf32=Int32Array,st.assign(st,I)):(st.Buf8=Array,st.Buf16=Array,st.Buf32=Array,st.assign(st,p))},st.setTyped(Pe)},{}],42:[function(Je,et,st){"use strict";var Pe=Je("./common"),I=!0,p=!0;try{String.fromCharCode.apply(null,[0])}catch{I=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{p=!1}for(var Z=new Pe.Buf8(256),he=0;he<256;he++)Z[he]=252<=he?6:248<=he?5:240<=he?4:224<=he?3:192<=he?2:1;function be(me,ve){if(ve<65537&&(me.subarray&&p||!me.subarray&&I))return String.fromCharCode.apply(null,Pe.shrinkBuf(me,ve));for(var ee="",fe=0;fe<ve;fe++)ee+=String.fromCharCode(me[fe]);return ee}Z[254]=Z[254]=1,st.string2buf=function(me){var ve,ee,fe,ue,K,Ee=me.length,Ie=0;for(ue=0;ue<Ee;ue++)55296==(64512&(ee=me.charCodeAt(ue)))&&ue+1<Ee&&56320==(64512&(fe=me.charCodeAt(ue+1)))&&(ee=65536+(ee-55296<<10)+(fe-56320),ue++),Ie+=ee<128?1:ee<2048?2:ee<65536?3:4;for(ve=new Pe.Buf8(Ie),ue=K=0;K<Ie;ue++)55296==(64512&(ee=me.charCodeAt(ue)))&&ue+1<Ee&&56320==(64512&(fe=me.charCodeAt(ue+1)))&&(ee=65536+(ee-55296<<10)+(fe-56320),ue++),ee<128?ve[K++]=ee:(ee<2048?ve[K++]=192|ee>>>6:(ee<65536?ve[K++]=224|ee>>>12:(ve[K++]=240|ee>>>18,ve[K++]=128|ee>>>12&63),ve[K++]=128|ee>>>6&63),ve[K++]=128|63&ee);return ve},st.buf2binstring=function(me){return be(me,me.length)},st.binstring2buf=function(me){for(var ve=new Pe.Buf8(me.length),ee=0,fe=ve.length;ee<fe;ee++)ve[ee]=me.charCodeAt(ee);return ve},st.buf2string=function(me,ve){var ee,fe,ue,K,Ee=ve||me.length,Ie=new Array(2*Ee);for(ee=fe=0;ee<Ee;)if((ue=me[ee++])<128)Ie[fe++]=ue;else if(4<(K=Z[ue]))Ie[fe++]=65533,ee+=K-1;else{for(ue&=2===K?31:3===K?15:7;1<K&&ee<Ee;)ue=ue<<6|63&me[ee++],K--;1<K?Ie[fe++]=65533:ue<65536?Ie[fe++]=ue:(Ie[fe++]=55296|(ue-=65536)>>10&1023,Ie[fe++]=56320|1023&ue)}return be(Ie,fe)},st.utf8border=function(me,ve){var ee;for((ve=ve||me.length)>me.length&&(ve=me.length),ee=ve-1;0<=ee&&128==(192&me[ee]);)ee--;return ee<0||0===ee?ve:ee+Z[me[ee]]>ve?ee:ve}},{"./common":41}],43:[function(Je,et,st){"use strict";et.exports=function(Pe,I,p,Z){for(var he=65535&Pe,be=Pe>>>16&65535,me=0;0!==p;){for(p-=me=2e3<p?2e3:p;be=be+(he=he+I[Z++]|0)|0,--me;);he%=65521,be%=65521}return he|be<<16}},{}],44:[function(Je,et,st){"use strict";et.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(Je,et,st){"use strict";var Pe=function(){for(var I,p=[],Z=0;Z<256;Z++){I=Z;for(var he=0;he<8;he++)I=1&I?3988292384^I>>>1:I>>>1;p[Z]=I}return p}();et.exports=function(I,p,Z,he){var be=Pe,me=he+Z;I^=-1;for(var ve=he;ve<me;ve++)I=I>>>8^be[255&(I^p[ve])];return~I}},{}],46:[function(Je,et,st){"use strict";var Pe,I=Je("../utils/common"),p=Je("./trees"),Z=Je("./adler32"),he=Je("./crc32"),be=Je("./messages"),on=258,Hn=262;function Qn(ne,kt){return ne.msg=be[kt],kt}function pt(ne){return(ne<<1)-(4<ne?9:0)}function Nn(ne){for(var kt=ne.length;0<=--kt;)ne[kt]=0}function nt(ne){var kt=ne.state,Ct=kt.pending;Ct>ne.avail_out&&(Ct=ne.avail_out),0!==Ct&&(I.arraySet(ne.output,kt.pending_buf,kt.pending_out,Ct,ne.next_out),ne.next_out+=Ct,kt.pending_out+=Ct,ne.total_out+=Ct,ne.avail_out-=Ct,kt.pending-=Ct,0===kt.pending&&(kt.pending_out=0))}function ht(ne,kt){p._tr_flush_block(ne,0<=ne.block_start?ne.block_start:-1,ne.strstart-ne.block_start,kt),ne.block_start=ne.strstart,nt(ne.strm)}function Sn(ne,kt){ne.pending_buf[ne.pending++]=kt}function ln(ne,kt){ne.pending_buf[ne.pending++]=kt>>>8&255,ne.pending_buf[ne.pending++]=255&kt}function Wt(ne,kt){var Ct,Oe,ke=ne.max_chain_length,it=ne.strstart,jt=ne.prev_length,Ut=ne.nice_match,dt=ne.strstart>ne.w_size-Hn?ne.strstart-(ne.w_size-Hn):0,tn=ne.window,Cn=ne.w_mask,nn=ne.prev,mn=ne.strstart+on,ji=tn[it+jt-1],bi=tn[it+jt];ne.prev_length>=ne.good_match&&(ke>>=2),Ut>ne.lookahead&&(Ut=ne.lookahead);do{if(tn[(Ct=kt)+jt]===bi&&tn[Ct+jt-1]===ji&&tn[Ct]===tn[it]&&tn[++Ct]===tn[it+1]){it+=2,Ct++;do{}while(tn[++it]===tn[++Ct]&&tn[++it]===tn[++Ct]&&tn[++it]===tn[++Ct]&&tn[++it]===tn[++Ct]&&tn[++it]===tn[++Ct]&&tn[++it]===tn[++Ct]&&tn[++it]===tn[++Ct]&&tn[++it]===tn[++Ct]&&it<mn);if(Oe=on-(mn-it),it=mn-on,jt<Oe){if(ne.match_start=kt,Ut<=(jt=Oe))break;ji=tn[it+jt-1],bi=tn[it+jt]}}}while((kt=nn[kt&Cn])>dt&&0!=--ke);return jt<=ne.lookahead?jt:ne.lookahead}function Pn(ne){var kt,Ct,Oe,ke,it,jt,Ut,dt,tn,Cn,nn=ne.w_size;do{if(ke=ne.window_size-ne.lookahead-ne.strstart,ne.strstart>=nn+(nn-Hn)){for(I.arraySet(ne.window,ne.window,nn,nn,0),ne.match_start-=nn,ne.strstart-=nn,ne.block_start-=nn,kt=Ct=ne.hash_size;Oe=ne.head[--kt],ne.head[kt]=nn<=Oe?Oe-nn:0,--Ct;);for(kt=Ct=nn;Oe=ne.prev[--kt],ne.prev[kt]=nn<=Oe?Oe-nn:0,--Ct;);ke+=nn}if(0===ne.strm.avail_in)break;if(Ut=ne.window,dt=ne.strstart+ne.lookahead,Cn=void 0,(tn=ke)<(Cn=(jt=ne.strm).avail_in)&&(Cn=tn),Ct=0===Cn?0:(jt.avail_in-=Cn,I.arraySet(Ut,jt.input,jt.next_in,Cn,dt),1===jt.state.wrap?jt.adler=Z(jt.adler,Ut,Cn,dt):2===jt.state.wrap&&(jt.adler=he(jt.adler,Ut,Cn,dt)),jt.next_in+=Cn,jt.total_in+=Cn,Cn),ne.lookahead+=Ct,ne.lookahead+ne.insert>=3)for(ne.ins_h=ne.window[it=ne.strstart-ne.insert],ne.ins_h=(ne.ins_h<<ne.hash_shift^ne.window[it+1])&ne.hash_mask;ne.insert&&(ne.ins_h=(ne.ins_h<<ne.hash_shift^ne.window[it+3-1])&ne.hash_mask,ne.prev[it&ne.w_mask]=ne.head[ne.ins_h],ne.head[ne.ins_h]=it,it++,ne.insert--,!(ne.lookahead+ne.insert<3)););}while(ne.lookahead<Hn&&0!==ne.strm.avail_in)}function zn(ne,kt){for(var Ct,Oe;;){if(ne.lookahead<Hn){if(Pn(ne),ne.lookahead<Hn&&0===kt)return 1;if(0===ne.lookahead)break}if(Ct=0,ne.lookahead>=3&&(ne.ins_h=(ne.ins_h<<ne.hash_shift^ne.window[ne.strstart+3-1])&ne.hash_mask,Ct=ne.prev[ne.strstart&ne.w_mask]=ne.head[ne.ins_h],ne.head[ne.ins_h]=ne.strstart),0!==Ct&&ne.strstart-Ct<=ne.w_size-Hn&&(ne.match_length=Wt(ne,Ct)),ne.match_length>=3)if(Oe=p._tr_tally(ne,ne.strstart-ne.match_start,ne.match_length-3),ne.lookahead-=ne.match_length,ne.match_length<=ne.max_lazy_match&&ne.lookahead>=3){for(ne.match_length--;ne.strstart++,ne.ins_h=(ne.ins_h<<ne.hash_shift^ne.window[ne.strstart+3-1])&ne.hash_mask,Ct=ne.prev[ne.strstart&ne.w_mask]=ne.head[ne.ins_h],ne.head[ne.ins_h]=ne.strstart,0!=--ne.match_length;);ne.strstart++}else ne.strstart+=ne.match_length,ne.match_length=0,ne.ins_h=ne.window[ne.strstart],ne.ins_h=(ne.ins_h<<ne.hash_shift^ne.window[ne.strstart+1])&ne.hash_mask;else Oe=p._tr_tally(ne,0,ne.window[ne.strstart]),ne.lookahead--,ne.strstart++;if(Oe&&(ht(ne,!1),0===ne.strm.avail_out))return 1}return ne.insert=ne.strstart<2?ne.strstart:2,4===kt?(ht(ne,!0),0===ne.strm.avail_out?3:4):ne.last_lit&&(ht(ne,!1),0===ne.strm.avail_out)?1:2}function Zn(ne,kt){for(var Ct,Oe,ke;;){if(ne.lookahead<Hn){if(Pn(ne),ne.lookahead<Hn&&0===kt)return 1;if(0===ne.lookahead)break}if(Ct=0,ne.lookahead>=3&&(ne.ins_h=(ne.ins_h<<ne.hash_shift^ne.window[ne.strstart+3-1])&ne.hash_mask,Ct=ne.prev[ne.strstart&ne.w_mask]=ne.head[ne.ins_h],ne.head[ne.ins_h]=ne.strstart),ne.prev_length=ne.match_length,ne.prev_match=ne.match_start,ne.match_length=2,0!==Ct&&ne.prev_length<ne.max_lazy_match&&ne.strstart-Ct<=ne.w_size-Hn&&(ne.match_length=Wt(ne,Ct),ne.match_length<=5&&(1===ne.strategy||3===ne.match_length&&4096<ne.strstart-ne.match_start)&&(ne.match_length=2)),ne.prev_length>=3&&ne.match_length<=ne.prev_length){for(ke=ne.strstart+ne.lookahead-3,Oe=p._tr_tally(ne,ne.strstart-1-ne.prev_match,ne.prev_length-3),ne.lookahead-=ne.prev_length-1,ne.prev_length-=2;++ne.strstart<=ke&&(ne.ins_h=(ne.ins_h<<ne.hash_shift^ne.window[ne.strstart+3-1])&ne.hash_mask,Ct=ne.prev[ne.strstart&ne.w_mask]=ne.head[ne.ins_h],ne.head[ne.ins_h]=ne.strstart),0!=--ne.prev_length;);if(ne.match_available=0,ne.match_length=2,ne.strstart++,Oe&&(ht(ne,!1),0===ne.strm.avail_out))return 1}else if(ne.match_available){if((Oe=p._tr_tally(ne,0,ne.window[ne.strstart-1]))&&ht(ne,!1),ne.strstart++,ne.lookahead--,0===ne.strm.avail_out)return 1}else ne.match_available=1,ne.strstart++,ne.lookahead--}return ne.match_available&&(Oe=p._tr_tally(ne,0,ne.window[ne.strstart-1]),ne.match_available=0),ne.insert=ne.strstart<2?ne.strstart:2,4===kt?(ht(ne,!0),0===ne.strm.avail_out?3:4):ne.last_lit&&(ht(ne,!1),0===ne.strm.avail_out)?1:2}function mi(ne,kt,Ct,Oe,ke){this.good_length=ne,this.max_lazy=kt,this.nice_length=Ct,this.max_chain=Oe,this.func=ke}function ir(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new I.Buf16(1146),this.dyn_dtree=new I.Buf16(122),this.bl_tree=new I.Buf16(78),Nn(this.dyn_ltree),Nn(this.dyn_dtree),Nn(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new I.Buf16(16),this.heap=new I.Buf16(573),Nn(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new I.Buf16(573),Nn(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function tr(ne){var kt;return ne&&ne.state?(ne.total_in=ne.total_out=0,ne.data_type=2,(kt=ne.state).pending=0,kt.pending_out=0,kt.wrap<0&&(kt.wrap=-kt.wrap),kt.status=kt.wrap?42:113,ne.adler=2===kt.wrap?0:1,kt.last_flush=0,p._tr_init(kt),0):Qn(ne,-2)}function pr(ne){var Ct,kt=tr(ne);return 0===kt&&((Ct=ne.state).window_size=2*Ct.w_size,Nn(Ct.head),Ct.max_lazy_match=Pe[Ct.level].max_lazy,Ct.good_match=Pe[Ct.level].good_length,Ct.nice_match=Pe[Ct.level].nice_length,Ct.max_chain_length=Pe[Ct.level].max_chain,Ct.strstart=0,Ct.block_start=0,Ct.lookahead=0,Ct.insert=0,Ct.match_length=Ct.prev_length=2,Ct.match_available=0,Ct.ins_h=0),kt}function Jr(ne,kt,Ct,Oe,ke,it){if(!ne)return-2;var jt=1;if(-1===kt&&(kt=6),Oe<0?(jt=0,Oe=-Oe):15<Oe&&(jt=2,Oe-=16),ke<1||9<ke||8!==Ct||Oe<8||15<Oe||kt<0||9<kt||it<0||4<it)return Qn(ne,-2);8===Oe&&(Oe=9);var Ut=new ir;return(ne.state=Ut).strm=ne,Ut.wrap=jt,Ut.gzhead=null,Ut.w_bits=Oe,Ut.w_size=1<<Ut.w_bits,Ut.w_mask=Ut.w_size-1,Ut.hash_bits=ke+7,Ut.hash_size=1<<Ut.hash_bits,Ut.hash_mask=Ut.hash_size-1,Ut.hash_shift=~~((Ut.hash_bits+3-1)/3),Ut.window=new I.Buf8(2*Ut.w_size),Ut.head=new I.Buf16(Ut.hash_size),Ut.prev=new I.Buf16(Ut.w_size),Ut.lit_bufsize=1<<ke+6,Ut.pending_buf_size=4*Ut.lit_bufsize,Ut.pending_buf=new I.Buf8(Ut.pending_buf_size),Ut.d_buf=1*Ut.lit_bufsize,Ut.l_buf=3*Ut.lit_bufsize,Ut.level=kt,Ut.strategy=it,Ut.method=Ct,pr(ne)}Pe=[new mi(0,0,0,0,function(ne,kt){var Ct=65535;for(Ct>ne.pending_buf_size-5&&(Ct=ne.pending_buf_size-5);;){if(ne.lookahead<=1){if(Pn(ne),0===ne.lookahead&&0===kt)return 1;if(0===ne.lookahead)break}ne.strstart+=ne.lookahead,ne.lookahead=0;var Oe=ne.block_start+Ct;if((0===ne.strstart||ne.strstart>=Oe)&&(ne.lookahead=ne.strstart-Oe,ne.strstart=Oe,ht(ne,!1),0===ne.strm.avail_out)||ne.strstart-ne.block_start>=ne.w_size-Hn&&(ht(ne,!1),0===ne.strm.avail_out))return 1}return ne.insert=0,4===kt?(ht(ne,!0),0===ne.strm.avail_out?3:4):(ne.strstart>ne.block_start&&ht(ne,!1),1)}),new mi(4,4,8,4,zn),new mi(4,5,16,8,zn),new mi(4,6,32,32,zn),new mi(4,4,16,16,Zn),new mi(8,16,32,32,Zn),new mi(8,16,128,128,Zn),new mi(8,32,128,256,Zn),new mi(32,128,258,1024,Zn),new mi(32,258,258,4096,Zn)],st.deflateInit=function(ne,kt){return Jr(ne,kt,8,15,8,0)},st.deflateInit2=Jr,st.deflateReset=pr,st.deflateResetKeep=tr,st.deflateSetHeader=function(ne,kt){return ne&&ne.state?2!==ne.state.wrap?-2:(ne.state.gzhead=kt,0):-2},st.deflate=function(ne,kt){var Ct,Oe,ke,it;if(!ne||!ne.state||5<kt||kt<0)return ne?Qn(ne,-2):-2;if(Oe=ne.state,!ne.output||!ne.input&&0!==ne.avail_in||666===Oe.status&&4!==kt)return Qn(ne,0===ne.avail_out?-5:-2);if(Oe.strm=ne,Ct=Oe.last_flush,Oe.last_flush=kt,42===Oe.status)if(2===Oe.wrap)ne.adler=0,Sn(Oe,31),Sn(Oe,139),Sn(Oe,8),Oe.gzhead?(Sn(Oe,(Oe.gzhead.text?1:0)+(Oe.gzhead.hcrc?2:0)+(Oe.gzhead.extra?4:0)+(Oe.gzhead.name?8:0)+(Oe.gzhead.comment?16:0)),Sn(Oe,255&Oe.gzhead.time),Sn(Oe,Oe.gzhead.time>>8&255),Sn(Oe,Oe.gzhead.time>>16&255),Sn(Oe,Oe.gzhead.time>>24&255),Sn(Oe,9===Oe.level?2:2<=Oe.strategy||Oe.level<2?4:0),Sn(Oe,255&Oe.gzhead.os),Oe.gzhead.extra&&Oe.gzhead.extra.length&&(Sn(Oe,255&Oe.gzhead.extra.length),Sn(Oe,Oe.gzhead.extra.length>>8&255)),Oe.gzhead.hcrc&&(ne.adler=he(ne.adler,Oe.pending_buf,Oe.pending,0)),Oe.gzindex=0,Oe.status=69):(Sn(Oe,0),Sn(Oe,0),Sn(Oe,0),Sn(Oe,0),Sn(Oe,0),Sn(Oe,9===Oe.level?2:2<=Oe.strategy||Oe.level<2?4:0),Sn(Oe,3),Oe.status=113);else{var jt=8+(Oe.w_bits-8<<4)<<8;jt|=(2<=Oe.strategy||Oe.level<2?0:Oe.level<6?1:6===Oe.level?2:3)<<6,0!==Oe.strstart&&(jt|=32),jt+=31-jt%31,Oe.status=113,ln(Oe,jt),0!==Oe.strstart&&(ln(Oe,ne.adler>>>16),ln(Oe,65535&ne.adler)),ne.adler=1}if(69===Oe.status)if(Oe.gzhead.extra){for(ke=Oe.pending;Oe.gzindex<(65535&Oe.gzhead.extra.length)&&(Oe.pending!==Oe.pending_buf_size||(Oe.gzhead.hcrc&&Oe.pending>ke&&(ne.adler=he(ne.adler,Oe.pending_buf,Oe.pending-ke,ke)),nt(ne),ke=Oe.pending,Oe.pending!==Oe.pending_buf_size));)Sn(Oe,255&Oe.gzhead.extra[Oe.gzindex]),Oe.gzindex++;Oe.gzhead.hcrc&&Oe.pending>ke&&(ne.adler=he(ne.adler,Oe.pending_buf,Oe.pending-ke,ke)),Oe.gzindex===Oe.gzhead.extra.length&&(Oe.gzindex=0,Oe.status=73)}else Oe.status=73;if(73===Oe.status)if(Oe.gzhead.name){ke=Oe.pending;do{if(Oe.pending===Oe.pending_buf_size&&(Oe.gzhead.hcrc&&Oe.pending>ke&&(ne.adler=he(ne.adler,Oe.pending_buf,Oe.pending-ke,ke)),nt(ne),ke=Oe.pending,Oe.pending===Oe.pending_buf_size)){it=1;break}it=Oe.gzindex<Oe.gzhead.name.length?255&Oe.gzhead.name.charCodeAt(Oe.gzindex++):0,Sn(Oe,it)}while(0!==it);Oe.gzhead.hcrc&&Oe.pending>ke&&(ne.adler=he(ne.adler,Oe.pending_buf,Oe.pending-ke,ke)),0===it&&(Oe.gzindex=0,Oe.status=91)}else Oe.status=91;if(91===Oe.status)if(Oe.gzhead.comment){ke=Oe.pending;do{if(Oe.pending===Oe.pending_buf_size&&(Oe.gzhead.hcrc&&Oe.pending>ke&&(ne.adler=he(ne.adler,Oe.pending_buf,Oe.pending-ke,ke)),nt(ne),ke=Oe.pending,Oe.pending===Oe.pending_buf_size)){it=1;break}it=Oe.gzindex<Oe.gzhead.comment.length?255&Oe.gzhead.comment.charCodeAt(Oe.gzindex++):0,Sn(Oe,it)}while(0!==it);Oe.gzhead.hcrc&&Oe.pending>ke&&(ne.adler=he(ne.adler,Oe.pending_buf,Oe.pending-ke,ke)),0===it&&(Oe.status=103)}else Oe.status=103;if(103===Oe.status&&(Oe.gzhead.hcrc?(Oe.pending+2>Oe.pending_buf_size&&nt(ne),Oe.pending+2<=Oe.pending_buf_size&&(Sn(Oe,255&ne.adler),Sn(Oe,ne.adler>>8&255),ne.adler=0,Oe.status=113)):Oe.status=113),0!==Oe.pending){if(nt(ne),0===ne.avail_out)return Oe.last_flush=-1,0}else if(0===ne.avail_in&&pt(kt)<=pt(Ct)&&4!==kt)return Qn(ne,-5);if(666===Oe.status&&0!==ne.avail_in)return Qn(ne,-5);if(0!==ne.avail_in||0!==Oe.lookahead||0!==kt&&666!==Oe.status){var Ut=2===Oe.strategy?function(dt,tn){for(var Cn;;){if(0===dt.lookahead&&(Pn(dt),0===dt.lookahead)){if(0===tn)return 1;break}if(dt.match_length=0,Cn=p._tr_tally(dt,0,dt.window[dt.strstart]),dt.lookahead--,dt.strstart++,Cn&&(ht(dt,!1),0===dt.strm.avail_out))return 1}return dt.insert=0,4===tn?(ht(dt,!0),0===dt.strm.avail_out?3:4):dt.last_lit&&(ht(dt,!1),0===dt.strm.avail_out)?1:2}(Oe,kt):3===Oe.strategy?function(dt,tn){for(var Cn,nn,mn,ji,bi=dt.window;;){if(dt.lookahead<=on){if(Pn(dt),dt.lookahead<=on&&0===tn)return 1;if(0===dt.lookahead)break}if(dt.match_length=0,dt.lookahead>=3&&0<dt.strstart&&(nn=bi[mn=dt.strstart-1])===bi[++mn]&&nn===bi[++mn]&&nn===bi[++mn]){ji=dt.strstart+on;do{}while(nn===bi[++mn]&&nn===bi[++mn]&&nn===bi[++mn]&&nn===bi[++mn]&&nn===bi[++mn]&&nn===bi[++mn]&&nn===bi[++mn]&&nn===bi[++mn]&&mn<ji);dt.match_length=on-(ji-mn),dt.match_length>dt.lookahead&&(dt.match_length=dt.lookahead)}if(dt.match_length>=3?(Cn=p._tr_tally(dt,1,dt.match_length-3),dt.lookahead-=dt.match_length,dt.strstart+=dt.match_length,dt.match_length=0):(Cn=p._tr_tally(dt,0,dt.window[dt.strstart]),dt.lookahead--,dt.strstart++),Cn&&(ht(dt,!1),0===dt.strm.avail_out))return 1}return dt.insert=0,4===tn?(ht(dt,!0),0===dt.strm.avail_out?3:4):dt.last_lit&&(ht(dt,!1),0===dt.strm.avail_out)?1:2}(Oe,kt):Pe[Oe.level].func(Oe,kt);if(3!==Ut&&4!==Ut||(Oe.status=666),1===Ut||3===Ut)return 0===ne.avail_out&&(Oe.last_flush=-1),0;if(2===Ut&&(1===kt?p._tr_align(Oe):5!==kt&&(p._tr_stored_block(Oe,0,0,!1),3===kt&&(Nn(Oe.head),0===Oe.lookahead&&(Oe.strstart=0,Oe.block_start=0,Oe.insert=0))),nt(ne),0===ne.avail_out))return Oe.last_flush=-1,0}return 4!==kt?0:Oe.wrap<=0?1:(2===Oe.wrap?(Sn(Oe,255&ne.adler),Sn(Oe,ne.adler>>8&255),Sn(Oe,ne.adler>>16&255),Sn(Oe,ne.adler>>24&255),Sn(Oe,255&ne.total_in),Sn(Oe,ne.total_in>>8&255),Sn(Oe,ne.total_in>>16&255),Sn(Oe,ne.total_in>>24&255)):(ln(Oe,ne.adler>>>16),ln(Oe,65535&ne.adler)),nt(ne),0<Oe.wrap&&(Oe.wrap=-Oe.wrap),0!==Oe.pending?0:1)},st.deflateEnd=function(ne){var kt;return ne&&ne.state?42!==(kt=ne.state.status)&&69!==kt&&73!==kt&&91!==kt&&103!==kt&&113!==kt&&666!==kt?Qn(ne,-2):(ne.state=null,113===kt?Qn(ne,-3):0):-2},st.deflateSetDictionary=function(ne,kt){var Ct,Oe,ke,it,jt,Ut,dt,tn,Cn=kt.length;if(!ne||!ne.state||2===(it=(Ct=ne.state).wrap)||1===it&&42!==Ct.status||Ct.lookahead)return-2;for(1===it&&(ne.adler=Z(ne.adler,kt,Cn,0)),Ct.wrap=0,Cn>=Ct.w_size&&(0===it&&(Nn(Ct.head),Ct.strstart=0,Ct.block_start=0,Ct.insert=0),tn=new I.Buf8(Ct.w_size),I.arraySet(tn,kt,Cn-Ct.w_size,Ct.w_size,0),kt=tn,Cn=Ct.w_size),jt=ne.avail_in,Ut=ne.next_in,dt=ne.input,ne.avail_in=Cn,ne.next_in=0,ne.input=kt,Pn(Ct);Ct.lookahead>=3;){for(Oe=Ct.strstart,ke=Ct.lookahead-2;Ct.ins_h=(Ct.ins_h<<Ct.hash_shift^Ct.window[Oe+3-1])&Ct.hash_mask,Ct.prev[Oe&Ct.w_mask]=Ct.head[Ct.ins_h],Ct.head[Ct.ins_h]=Oe,Oe++,--ke;);Ct.strstart=Oe,Ct.lookahead=2,Pn(Ct)}return Ct.strstart+=Ct.lookahead,Ct.block_start=Ct.strstart,Ct.insert=Ct.lookahead,Ct.lookahead=0,Ct.match_length=Ct.prev_length=2,Ct.match_available=0,ne.next_in=Ut,ne.input=dt,ne.avail_in=jt,Ct.wrap=it,0},st.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(Je,et,st){"use strict";et.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(Je,et,st){"use strict";et.exports=function(Pe,I){var p,Z,he,be,me,ve,ee,fe,ue,K,Ee,Ie,Ue,ot,ct,St,xt,Qt,Mt,on,Hn,Ze,Dt,pe,Rt;pe=Pe.input,he=(Z=Pe.next_in)+(Pe.avail_in-5),Rt=Pe.output,me=(be=Pe.next_out)-(I-Pe.avail_out),ve=be+(Pe.avail_out-257),ee=(p=Pe.state).dmax,fe=p.wsize,ue=p.whave,K=p.wnext,Ee=p.window,Ie=p.hold,Ue=p.bits,ot=p.lencode,ct=p.distcode,St=(1<<p.lenbits)-1,xt=(1<<p.distbits)-1;e:do{Ue<15&&(Ie+=pe[Z++]<<Ue,Ie+=pe[Z++]<<(Ue+=8),Ue+=8),Qt=ot[Ie&St];t:for(;;){if(Ie>>>=Mt=Qt>>>24,Ue-=Mt,0==(Mt=Qt>>>16&255))Rt[be++]=65535&Qt;else{if(!(16&Mt)){if(!(64&Mt)){Qt=ot[(65535&Qt)+(Ie&(1<<Mt)-1)];continue t}if(32&Mt){p.mode=12;break e}Pe.msg="invalid literal/length code",p.mode=30;break e}on=65535&Qt,(Mt&=15)&&(Ue<Mt&&(Ie+=pe[Z++]<<Ue,Ue+=8),on+=Ie&(1<<Mt)-1,Ie>>>=Mt,Ue-=Mt),Ue<15&&(Ie+=pe[Z++]<<Ue,Ie+=pe[Z++]<<(Ue+=8),Ue+=8),Qt=ct[Ie&xt];n:for(;;){if(Ie>>>=Mt=Qt>>>24,Ue-=Mt,!(16&(Mt=Qt>>>16&255))){if(!(64&Mt)){Qt=ct[(65535&Qt)+(Ie&(1<<Mt)-1)];continue n}Pe.msg="invalid distance code",p.mode=30;break e}if(Hn=65535&Qt,Ue<(Mt&=15)&&(Ie+=pe[Z++]<<Ue,(Ue+=8)<Mt&&(Ie+=pe[Z++]<<Ue,Ue+=8)),ee<(Hn+=Ie&(1<<Mt)-1)){Pe.msg="invalid distance too far back",p.mode=30;break e}if(Ie>>>=Mt,Ue-=Mt,(Mt=be-me)<Hn){if(ue<(Mt=Hn-Mt)&&p.sane){Pe.msg="invalid distance too far back",p.mode=30;break e}if(Dt=Ee,(Ze=0)===K){if(Ze+=fe-Mt,Mt<on){for(on-=Mt;Rt[be++]=Ee[Ze++],--Mt;);Ze=be-Hn,Dt=Rt}}else if(K<Mt){if(Ze+=fe+K-Mt,(Mt-=K)<on){for(on-=Mt;Rt[be++]=Ee[Ze++],--Mt;);if(Ze=0,K<on){for(on-=Mt=K;Rt[be++]=Ee[Ze++],--Mt;);Ze=be-Hn,Dt=Rt}}}else if(Ze+=K-Mt,Mt<on){for(on-=Mt;Rt[be++]=Ee[Ze++],--Mt;);Ze=be-Hn,Dt=Rt}for(;2<on;)Rt[be++]=Dt[Ze++],Rt[be++]=Dt[Ze++],Rt[be++]=Dt[Ze++],on-=3;on&&(Rt[be++]=Dt[Ze++],1<on&&(Rt[be++]=Dt[Ze++]))}else{for(Ze=be-Hn;Rt[be++]=Rt[Ze++],Rt[be++]=Rt[Ze++],Rt[be++]=Rt[Ze++],2<(on-=3););on&&(Rt[be++]=Rt[Ze++],1<on&&(Rt[be++]=Rt[Ze++]))}break}}break}}while(Z<he&&be<ve);Z-=on=Ue>>3,Ie&=(1<<(Ue-=on<<3))-1,Pe.next_in=Z,Pe.next_out=be,Pe.avail_in=Z<he?he-Z+5:5-(Z-he),Pe.avail_out=be<ve?ve-be+257:257-(be-ve),p.hold=Ie,p.bits=Ue}},{}],49:[function(Je,et,st){"use strict";var Pe=Je("../utils/common"),I=Je("./adler32"),p=Je("./crc32"),Z=Je("./inffast"),he=Je("./inftrees");function Ee(Ze){return(Ze>>>24&255)+(Ze>>>8&65280)+((65280&Ze)<<8)+((255&Ze)<<24)}function Ie(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Pe.Buf16(320),this.work=new Pe.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Ue(Ze){var Dt;return Ze&&Ze.state?(Ze.total_in=Ze.total_out=(Dt=Ze.state).total=0,Ze.msg="",Dt.wrap&&(Ze.adler=1&Dt.wrap),Dt.mode=1,Dt.last=0,Dt.havedict=0,Dt.dmax=32768,Dt.head=null,Dt.hold=0,Dt.bits=0,Dt.lencode=Dt.lendyn=new Pe.Buf32(852),Dt.distcode=Dt.distdyn=new Pe.Buf32(592),Dt.sane=1,Dt.back=-1,0):-2}function ot(Ze){var Dt;return Ze&&Ze.state?((Dt=Ze.state).wsize=0,Dt.whave=0,Dt.wnext=0,Ue(Ze)):-2}function ct(Ze,Dt){var pe,Rt;return Ze&&Ze.state?(Rt=Ze.state,Dt<0?(pe=0,Dt=-Dt):(pe=1+(Dt>>4),Dt<48&&(Dt&=15)),Dt&&(Dt<8||15<Dt)?-2:(null!==Rt.window&&Rt.wbits!==Dt&&(Rt.window=null),Rt.wrap=pe,Rt.wbits=Dt,ot(Ze))):-2}function St(Ze,Dt){var pe,Rt;return Ze?(Rt=new Ie,(Ze.state=Rt).window=null,0!==(pe=ct(Ze,Dt))&&(Ze.state=null),pe):-2}var xt,Qt,Mt=!0;function on(Ze){if(Mt){var Dt;for(xt=new Pe.Buf32(512),Qt=new Pe.Buf32(32),Dt=0;Dt<144;)Ze.lens[Dt++]=8;for(;Dt<256;)Ze.lens[Dt++]=9;for(;Dt<280;)Ze.lens[Dt++]=7;for(;Dt<288;)Ze.lens[Dt++]=8;for(he(1,Ze.lens,0,288,xt,0,Ze.work,{bits:9}),Dt=0;Dt<32;)Ze.lens[Dt++]=5;he(2,Ze.lens,0,32,Qt,0,Ze.work,{bits:5}),Mt=!1}Ze.lencode=xt,Ze.lenbits=9,Ze.distcode=Qt,Ze.distbits=5}function Hn(Ze,Dt,pe,Rt){var ii,Bt=Ze.state;return null===Bt.window&&(Bt.wsize=1<<Bt.wbits,Bt.wnext=0,Bt.whave=0,Bt.window=new Pe.Buf8(Bt.wsize)),Rt>=Bt.wsize?(Pe.arraySet(Bt.window,Dt,pe-Bt.wsize,Bt.wsize,0),Bt.wnext=0,Bt.whave=Bt.wsize):(Rt<(ii=Bt.wsize-Bt.wnext)&&(ii=Rt),Pe.arraySet(Bt.window,Dt,pe-Rt,ii,Bt.wnext),(Rt-=ii)?(Pe.arraySet(Bt.window,Dt,pe-Rt,Rt,0),Bt.wnext=Rt,Bt.whave=Bt.wsize):(Bt.wnext+=ii,Bt.wnext===Bt.wsize&&(Bt.wnext=0),Bt.whave<Bt.wsize&&(Bt.whave+=ii))),0}st.inflateReset=ot,st.inflateReset2=ct,st.inflateResetKeep=Ue,st.inflateInit=function(Ze){return St(Ze,15)},st.inflateInit2=St,st.inflate=function(Ze,Dt){var pe,Rt,ii,Bt,Qn,pt,Nn,nt,ht,Sn,ln,Wt,Pn,zn,Zn,mi,ir,tr,pr,Jr,ne,kt,Ct,Oe,ke=0,it=new Pe.Buf8(4),jt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!Ze||!Ze.state||!Ze.output||!Ze.input&&0!==Ze.avail_in)return-2;12===(pe=Ze.state).mode&&(pe.mode=13),Qn=Ze.next_out,ii=Ze.output,Bt=Ze.next_in,Rt=Ze.input,nt=pe.hold,ht=pe.bits,Sn=pt=Ze.avail_in,ln=Nn=Ze.avail_out,kt=0;e:for(;;)switch(pe.mode){case 1:if(0===pe.wrap){pe.mode=13;break}for(;ht<16;){if(0===pt)break e;pt--,nt+=Rt[Bt++]<<ht,ht+=8}if(2&pe.wrap&&35615===nt){it[pe.check=0]=255&nt,it[1]=nt>>>8&255,pe.check=p(pe.check,it,2,0),ht=nt=0,pe.mode=2;break}if(pe.flags=0,pe.head&&(pe.head.done=!1),!(1&pe.wrap)||(((255&nt)<<8)+(nt>>8))%31){Ze.msg="incorrect header check",pe.mode=30;break}if(8!=(15&nt)){Ze.msg="unknown compression method",pe.mode=30;break}if(ht-=4,ne=8+(15&(nt>>>=4)),0===pe.wbits)pe.wbits=ne;else if(ne>pe.wbits){Ze.msg="invalid window size",pe.mode=30;break}pe.dmax=1<<ne,Ze.adler=pe.check=1,pe.mode=512&nt?10:12,ht=nt=0;break;case 2:for(;ht<16;){if(0===pt)break e;pt--,nt+=Rt[Bt++]<<ht,ht+=8}if(pe.flags=nt,8!=(255&pe.flags)){Ze.msg="unknown compression method",pe.mode=30;break}if(57344&pe.flags){Ze.msg="unknown header flags set",pe.mode=30;break}pe.head&&(pe.head.text=nt>>8&1),512&pe.flags&&(it[0]=255&nt,it[1]=nt>>>8&255,pe.check=p(pe.check,it,2,0)),ht=nt=0,pe.mode=3;case 3:for(;ht<32;){if(0===pt)break e;pt--,nt+=Rt[Bt++]<<ht,ht+=8}pe.head&&(pe.head.time=nt),512&pe.flags&&(it[0]=255&nt,it[1]=nt>>>8&255,it[2]=nt>>>16&255,it[3]=nt>>>24&255,pe.check=p(pe.check,it,4,0)),ht=nt=0,pe.mode=4;case 4:for(;ht<16;){if(0===pt)break e;pt--,nt+=Rt[Bt++]<<ht,ht+=8}pe.head&&(pe.head.xflags=255&nt,pe.head.os=nt>>8),512&pe.flags&&(it[0]=255&nt,it[1]=nt>>>8&255,pe.check=p(pe.check,it,2,0)),ht=nt=0,pe.mode=5;case 5:if(1024&pe.flags){for(;ht<16;){if(0===pt)break e;pt--,nt+=Rt[Bt++]<<ht,ht+=8}pe.length=nt,pe.head&&(pe.head.extra_len=nt),512&pe.flags&&(it[0]=255&nt,it[1]=nt>>>8&255,pe.check=p(pe.check,it,2,0)),ht=nt=0}else pe.head&&(pe.head.extra=null);pe.mode=6;case 6:if(1024&pe.flags&&(pt<(Wt=pe.length)&&(Wt=pt),Wt&&(pe.head&&(ne=pe.head.extra_len-pe.length,pe.head.extra||(pe.head.extra=new Array(pe.head.extra_len)),Pe.arraySet(pe.head.extra,Rt,Bt,Wt,ne)),512&pe.flags&&(pe.check=p(pe.check,Rt,Wt,Bt)),pt-=Wt,Bt+=Wt,pe.length-=Wt),pe.length))break e;pe.length=0,pe.mode=7;case 7:if(2048&pe.flags){if(0===pt)break e;for(Wt=0;ne=Rt[Bt+Wt++],pe.head&&ne&&pe.length<65536&&(pe.head.name+=String.fromCharCode(ne)),ne&&Wt<pt;);if(512&pe.flags&&(pe.check=p(pe.check,Rt,Wt,Bt)),pt-=Wt,Bt+=Wt,ne)break e}else pe.head&&(pe.head.name=null);pe.length=0,pe.mode=8;case 8:if(4096&pe.flags){if(0===pt)break e;for(Wt=0;ne=Rt[Bt+Wt++],pe.head&&ne&&pe.length<65536&&(pe.head.comment+=String.fromCharCode(ne)),ne&&Wt<pt;);if(512&pe.flags&&(pe.check=p(pe.check,Rt,Wt,Bt)),pt-=Wt,Bt+=Wt,ne)break e}else pe.head&&(pe.head.comment=null);pe.mode=9;case 9:if(512&pe.flags){for(;ht<16;){if(0===pt)break e;pt--,nt+=Rt[Bt++]<<ht,ht+=8}if(nt!==(65535&pe.check)){Ze.msg="header crc mismatch",pe.mode=30;break}ht=nt=0}pe.head&&(pe.head.hcrc=pe.flags>>9&1,pe.head.done=!0),Ze.adler=pe.check=0,pe.mode=12;break;case 10:for(;ht<32;){if(0===pt)break e;pt--,nt+=Rt[Bt++]<<ht,ht+=8}Ze.adler=pe.check=Ee(nt),ht=nt=0,pe.mode=11;case 11:if(0===pe.havedict)return Ze.next_out=Qn,Ze.avail_out=Nn,Ze.next_in=Bt,Ze.avail_in=pt,pe.hold=nt,pe.bits=ht,2;Ze.adler=pe.check=1,pe.mode=12;case 12:if(5===Dt||6===Dt)break e;case 13:if(pe.last){nt>>>=7&ht,ht-=7&ht,pe.mode=27;break}for(;ht<3;){if(0===pt)break e;pt--,nt+=Rt[Bt++]<<ht,ht+=8}switch(pe.last=1&nt,ht-=1,3&(nt>>>=1)){case 0:pe.mode=14;break;case 1:if(on(pe),pe.mode=20,6!==Dt)break;nt>>>=2,ht-=2;break e;case 2:pe.mode=17;break;case 3:Ze.msg="invalid block type",pe.mode=30}nt>>>=2,ht-=2;break;case 14:for(nt>>>=7&ht,ht-=7&ht;ht<32;){if(0===pt)break e;pt--,nt+=Rt[Bt++]<<ht,ht+=8}if((65535&nt)!=(nt>>>16^65535)){Ze.msg="invalid stored block lengths",pe.mode=30;break}if(pe.length=65535&nt,ht=nt=0,pe.mode=15,6===Dt)break e;case 15:pe.mode=16;case 16:if(Wt=pe.length){if(pt<Wt&&(Wt=pt),Nn<Wt&&(Wt=Nn),0===Wt)break e;Pe.arraySet(ii,Rt,Bt,Wt,Qn),pt-=Wt,Bt+=Wt,Nn-=Wt,Qn+=Wt,pe.length-=Wt;break}pe.mode=12;break;case 17:for(;ht<14;){if(0===pt)break e;pt--,nt+=Rt[Bt++]<<ht,ht+=8}if(pe.nlen=257+(31&nt),ht-=5,pe.ndist=1+(31&(nt>>>=5)),ht-=5,pe.ncode=4+(15&(nt>>>=5)),nt>>>=4,ht-=4,286<pe.nlen||30<pe.ndist){Ze.msg="too many length or distance symbols",pe.mode=30;break}pe.have=0,pe.mode=18;case 18:for(;pe.have<pe.ncode;){for(;ht<3;){if(0===pt)break e;pt--,nt+=Rt[Bt++]<<ht,ht+=8}pe.lens[jt[pe.have++]]=7&nt,nt>>>=3,ht-=3}for(;pe.have<19;)pe.lens[jt[pe.have++]]=0;if(pe.lencode=pe.lendyn,pe.lenbits=7,kt=he(0,pe.lens,0,19,pe.lencode,0,pe.work,Ct={bits:pe.lenbits}),pe.lenbits=Ct.bits,kt){Ze.msg="invalid code lengths set",pe.mode=30;break}pe.have=0,pe.mode=19;case 19:for(;pe.have<pe.nlen+pe.ndist;){for(;mi=(ke=pe.lencode[nt&(1<<pe.lenbits)-1])>>>16&255,ir=65535&ke,!((Zn=ke>>>24)<=ht);){if(0===pt)break e;pt--,nt+=Rt[Bt++]<<ht,ht+=8}if(ir<16)nt>>>=Zn,ht-=Zn,pe.lens[pe.have++]=ir;else{if(16===ir){for(Oe=Zn+2;ht<Oe;){if(0===pt)break e;pt--,nt+=Rt[Bt++]<<ht,ht+=8}if(nt>>>=Zn,ht-=Zn,0===pe.have){Ze.msg="invalid bit length repeat",pe.mode=30;break}ne=pe.lens[pe.have-1],Wt=3+(3&nt),nt>>>=2,ht-=2}else if(17===ir){for(Oe=Zn+3;ht<Oe;){if(0===pt)break e;pt--,nt+=Rt[Bt++]<<ht,ht+=8}ht-=Zn,ne=0,Wt=3+(7&(nt>>>=Zn)),nt>>>=3,ht-=3}else{for(Oe=Zn+7;ht<Oe;){if(0===pt)break e;pt--,nt+=Rt[Bt++]<<ht,ht+=8}ht-=Zn,ne=0,Wt=11+(127&(nt>>>=Zn)),nt>>>=7,ht-=7}if(pe.have+Wt>pe.nlen+pe.ndist){Ze.msg="invalid bit length repeat",pe.mode=30;break}for(;Wt--;)pe.lens[pe.have++]=ne}}if(30===pe.mode)break;if(0===pe.lens[256]){Ze.msg="invalid code -- missing end-of-block",pe.mode=30;break}if(pe.lenbits=9,kt=he(1,pe.lens,0,pe.nlen,pe.lencode,0,pe.work,Ct={bits:pe.lenbits}),pe.lenbits=Ct.bits,kt){Ze.msg="invalid literal/lengths set",pe.mode=30;break}if(pe.distbits=6,pe.distcode=pe.distdyn,kt=he(2,pe.lens,pe.nlen,pe.ndist,pe.distcode,0,pe.work,Ct={bits:pe.distbits}),pe.distbits=Ct.bits,kt){Ze.msg="invalid distances set",pe.mode=30;break}if(pe.mode=20,6===Dt)break e;case 20:pe.mode=21;case 21:if(6<=pt&&258<=Nn){Ze.next_out=Qn,Ze.avail_out=Nn,Ze.next_in=Bt,Ze.avail_in=pt,pe.hold=nt,pe.bits=ht,Z(Ze,ln),Qn=Ze.next_out,ii=Ze.output,Nn=Ze.avail_out,Bt=Ze.next_in,Rt=Ze.input,pt=Ze.avail_in,nt=pe.hold,ht=pe.bits,12===pe.mode&&(pe.back=-1);break}for(pe.back=0;mi=(ke=pe.lencode[nt&(1<<pe.lenbits)-1])>>>16&255,ir=65535&ke,!((Zn=ke>>>24)<=ht);){if(0===pt)break e;pt--,nt+=Rt[Bt++]<<ht,ht+=8}if(mi&&!(240&mi)){for(tr=Zn,pr=mi,Jr=ir;mi=(ke=pe.lencode[Jr+((nt&(1<<tr+pr)-1)>>tr)])>>>16&255,ir=65535&ke,!(tr+(Zn=ke>>>24)<=ht);){if(0===pt)break e;pt--,nt+=Rt[Bt++]<<ht,ht+=8}nt>>>=tr,ht-=tr,pe.back+=tr}if(nt>>>=Zn,ht-=Zn,pe.back+=Zn,pe.length=ir,0===mi){pe.mode=26;break}if(32&mi){pe.back=-1,pe.mode=12;break}if(64&mi){Ze.msg="invalid literal/length code",pe.mode=30;break}pe.extra=15&mi,pe.mode=22;case 22:if(pe.extra){for(Oe=pe.extra;ht<Oe;){if(0===pt)break e;pt--,nt+=Rt[Bt++]<<ht,ht+=8}pe.length+=nt&(1<<pe.extra)-1,nt>>>=pe.extra,ht-=pe.extra,pe.back+=pe.extra}pe.was=pe.length,pe.mode=23;case 23:for(;mi=(ke=pe.distcode[nt&(1<<pe.distbits)-1])>>>16&255,ir=65535&ke,!((Zn=ke>>>24)<=ht);){if(0===pt)break e;pt--,nt+=Rt[Bt++]<<ht,ht+=8}if(!(240&mi)){for(tr=Zn,pr=mi,Jr=ir;mi=(ke=pe.distcode[Jr+((nt&(1<<tr+pr)-1)>>tr)])>>>16&255,ir=65535&ke,!(tr+(Zn=ke>>>24)<=ht);){if(0===pt)break e;pt--,nt+=Rt[Bt++]<<ht,ht+=8}nt>>>=tr,ht-=tr,pe.back+=tr}if(nt>>>=Zn,ht-=Zn,pe.back+=Zn,64&mi){Ze.msg="invalid distance code",pe.mode=30;break}pe.offset=ir,pe.extra=15&mi,pe.mode=24;case 24:if(pe.extra){for(Oe=pe.extra;ht<Oe;){if(0===pt)break e;pt--,nt+=Rt[Bt++]<<ht,ht+=8}pe.offset+=nt&(1<<pe.extra)-1,nt>>>=pe.extra,ht-=pe.extra,pe.back+=pe.extra}if(pe.offset>pe.dmax){Ze.msg="invalid distance too far back",pe.mode=30;break}pe.mode=25;case 25:if(0===Nn)break e;if(pe.offset>(Wt=ln-Nn)){if((Wt=pe.offset-Wt)>pe.whave&&pe.sane){Ze.msg="invalid distance too far back",pe.mode=30;break}Pn=Wt>pe.wnext?pe.wsize-(Wt-=pe.wnext):pe.wnext-Wt,Wt>pe.length&&(Wt=pe.length),zn=pe.window}else zn=ii,Pn=Qn-pe.offset,Wt=pe.length;for(Nn<Wt&&(Wt=Nn),Nn-=Wt,pe.length-=Wt;ii[Qn++]=zn[Pn++],--Wt;);0===pe.length&&(pe.mode=21);break;case 26:if(0===Nn)break e;ii[Qn++]=pe.length,Nn--,pe.mode=21;break;case 27:if(pe.wrap){for(;ht<32;){if(0===pt)break e;pt--,nt|=Rt[Bt++]<<ht,ht+=8}if(Ze.total_out+=ln-=Nn,pe.total+=ln,ln&&(Ze.adler=pe.check=pe.flags?p(pe.check,ii,ln,Qn-ln):I(pe.check,ii,ln,Qn-ln)),ln=Nn,(pe.flags?nt:Ee(nt))!==pe.check){Ze.msg="incorrect data check",pe.mode=30;break}ht=nt=0}pe.mode=28;case 28:if(pe.wrap&&pe.flags){for(;ht<32;){if(0===pt)break e;pt--,nt+=Rt[Bt++]<<ht,ht+=8}if(nt!==(4294967295&pe.total)){Ze.msg="incorrect length check",pe.mode=30;break}ht=nt=0}pe.mode=29;case 29:kt=1;break e;case 30:kt=-3;break e;case 31:return-4;default:return-2}return Ze.next_out=Qn,Ze.avail_out=Nn,Ze.next_in=Bt,Ze.avail_in=pt,pe.hold=nt,pe.bits=ht,(pe.wsize||ln!==Ze.avail_out&&pe.mode<30&&(pe.mode<27||4!==Dt))&&Hn(Ze,Ze.output,Ze.next_out,ln-Ze.avail_out)?(pe.mode=31,-4):(ln-=Ze.avail_out,Ze.total_in+=Sn-=Ze.avail_in,Ze.total_out+=ln,pe.total+=ln,pe.wrap&&ln&&(Ze.adler=pe.check=pe.flags?p(pe.check,ii,ln,Ze.next_out-ln):I(pe.check,ii,ln,Ze.next_out-ln)),Ze.data_type=pe.bits+(pe.last?64:0)+(12===pe.mode?128:0)+(20===pe.mode||15===pe.mode?256:0),(0==Sn&&0===ln||4===Dt)&&0===kt&&(kt=-5),kt)},st.inflateEnd=function(Ze){if(!Ze||!Ze.state)return-2;var Dt=Ze.state;return Dt.window&&(Dt.window=null),Ze.state=null,0},st.inflateGetHeader=function(Ze,Dt){var pe;return Ze&&Ze.state&&2&(pe=Ze.state).wrap?((pe.head=Dt).done=!1,0):-2},st.inflateSetDictionary=function(Ze,Dt){var pe,Rt=Dt.length;return Ze&&Ze.state?0!==(pe=Ze.state).wrap&&11!==pe.mode?-2:11===pe.mode&&I(1,Dt,Rt,0)!==pe.check?-3:Hn(Ze,Dt,Rt,Rt)?(pe.mode=31,-4):(pe.havedict=1,0):-2},st.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(Je,et,st){"use strict";var Pe=Je("../utils/common"),I=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],p=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Z=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],he=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];et.exports=function(be,me,ve,ee,fe,ue,K,Ee){var Ie,Ue,ot,ct,St,xt,Qt,Mt,on,Hn=Ee.bits,Ze=0,Dt=0,pe=0,Rt=0,ii=0,Bt=0,Qn=0,pt=0,Nn=0,nt=0,ht=null,Sn=0,ln=new Pe.Buf16(16),Wt=new Pe.Buf16(16),Pn=null,zn=0;for(Ze=0;Ze<=15;Ze++)ln[Ze]=0;for(Dt=0;Dt<ee;Dt++)ln[me[ve+Dt]]++;for(ii=Hn,Rt=15;1<=Rt&&0===ln[Rt];Rt--);if(Rt<ii&&(ii=Rt),0===Rt)return fe[ue++]=20971520,fe[ue++]=20971520,Ee.bits=1,0;for(pe=1;pe<Rt&&0===ln[pe];pe++);for(ii<pe&&(ii=pe),Ze=pt=1;Ze<=15;Ze++)if(pt<<=1,(pt-=ln[Ze])<0)return-1;if(0<pt&&(0===be||1!==Rt))return-1;for(Wt[1]=0,Ze=1;Ze<15;Ze++)Wt[Ze+1]=Wt[Ze]+ln[Ze];for(Dt=0;Dt<ee;Dt++)0!==me[ve+Dt]&&(K[Wt[me[ve+Dt]]++]=Dt);if(xt=0===be?(ht=Pn=K,19):1===be?(ht=I,Sn-=257,Pn=p,zn-=257,256):(ht=Z,Pn=he,-1),Ze=pe,St=ue,Qn=Dt=nt=0,ot=-1,ct=(Nn=1<<(Bt=ii))-1,1===be&&852<Nn||2===be&&592<Nn)return 1;for(;;){for(Qt=Ze-Qn,on=K[Dt]<xt?(Mt=0,K[Dt]):K[Dt]>xt?(Mt=Pn[zn+K[Dt]],ht[Sn+K[Dt]]):(Mt=96,0),Ie=1<<Ze-Qn,pe=Ue=1<<Bt;fe[St+(nt>>Qn)+(Ue-=Ie)]=Qt<<24|Mt<<16|on,0!==Ue;);for(Ie=1<<Ze-1;nt&Ie;)Ie>>=1;if(0!==Ie?(nt&=Ie-1,nt+=Ie):nt=0,Dt++,0==--ln[Ze]){if(Ze===Rt)break;Ze=me[ve+K[Dt]]}if(ii<Ze&&(nt&ct)!==ot){for(0===Qn&&(Qn=ii),St+=pe,pt=1<<(Bt=Ze-Qn);Bt+Qn<Rt&&!((pt-=ln[Bt+Qn])<=0);)Bt++,pt<<=1;if(Nn+=1<<Bt,1===be&&852<Nn||2===be&&592<Nn)return 1;fe[ot=nt&ct]=ii<<24|Bt<<16|St-ue}}return 0!==nt&&(fe[St+nt]=Ze-Qn<<24|64<<16),Ee.bits=ii,0}},{"../utils/common":41}],51:[function(Je,et,st){"use strict";et.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(Je,et,st){"use strict";var Pe=Je("../utils/common");function Z(ke){for(var it=ke.length;0<=--it;)ke[it]=0}var K=15,xt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Qt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Mt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],on=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Hn=new Array(576);Z(Hn);var Ze=new Array(60);Z(Ze);var Dt=new Array(512);Z(Dt);var pe=new Array(256);Z(pe);var Rt=new Array(29);Z(Rt);var ii,Bt,Qn,pt=new Array(30);function Nn(ke,it,jt,Ut,dt){this.static_tree=ke,this.extra_bits=it,this.extra_base=jt,this.elems=Ut,this.max_length=dt,this.has_stree=ke&&ke.length}function nt(ke,it){this.dyn_tree=ke,this.max_code=0,this.stat_desc=it}function ht(ke){return ke<256?Dt[ke]:Dt[256+(ke>>>7)]}function Sn(ke,it){ke.pending_buf[ke.pending++]=255&it,ke.pending_buf[ke.pending++]=it>>>8&255}function ln(ke,it,jt){ke.bi_valid>16-jt?(ke.bi_buf|=it<<ke.bi_valid&65535,Sn(ke,ke.bi_buf),ke.bi_buf=it>>16-ke.bi_valid,ke.bi_valid+=jt-16):(ke.bi_buf|=it<<ke.bi_valid&65535,ke.bi_valid+=jt)}function Wt(ke,it,jt){ln(ke,jt[2*it],jt[2*it+1])}function Pn(ke,it){for(var jt=0;jt|=1&ke,ke>>>=1,jt<<=1,0<--it;);return jt>>>1}function zn(ke,it,jt){var Ut,dt,tn=new Array(16),Cn=0;for(Ut=1;Ut<=K;Ut++)tn[Ut]=Cn=Cn+jt[Ut-1]<<1;for(dt=0;dt<=it;dt++){var nn=ke[2*dt+1];0!==nn&&(ke[2*dt]=Pn(tn[nn]++,nn))}}function Zn(ke){var it;for(it=0;it<286;it++)ke.dyn_ltree[2*it]=0;for(it=0;it<30;it++)ke.dyn_dtree[2*it]=0;for(it=0;it<19;it++)ke.bl_tree[2*it]=0;ke.dyn_ltree[512]=1,ke.opt_len=ke.static_len=0,ke.last_lit=ke.matches=0}function mi(ke){8<ke.bi_valid?Sn(ke,ke.bi_buf):0<ke.bi_valid&&(ke.pending_buf[ke.pending++]=ke.bi_buf),ke.bi_buf=0,ke.bi_valid=0}function ir(ke,it,jt,Ut){var dt=2*it,tn=2*jt;return ke[dt]<ke[tn]||ke[dt]===ke[tn]&&Ut[it]<=Ut[jt]}function tr(ke,it,jt){for(var Ut=ke.heap[jt],dt=jt<<1;dt<=ke.heap_len&&(dt<ke.heap_len&&ir(it,ke.heap[dt+1],ke.heap[dt],ke.depth)&&dt++,!ir(it,Ut,ke.heap[dt],ke.depth));)ke.heap[jt]=ke.heap[dt],jt=dt,dt<<=1;ke.heap[jt]=Ut}function pr(ke,it,jt){var Ut,dt,tn,Cn,nn=0;if(0!==ke.last_lit)for(;Ut=ke.pending_buf[ke.d_buf+2*nn]<<8|ke.pending_buf[ke.d_buf+2*nn+1],dt=ke.pending_buf[ke.l_buf+nn],nn++,0===Ut?Wt(ke,dt,it):(Wt(ke,(tn=pe[dt])+256+1,it),0!==(Cn=xt[tn])&&ln(ke,dt-=Rt[tn],Cn),Wt(ke,tn=ht(--Ut),jt),0!==(Cn=Qt[tn])&&ln(ke,Ut-=pt[tn],Cn)),nn<ke.last_lit;);Wt(ke,256,it)}function Jr(ke,it){var jt,Ut,dt,tn=it.dyn_tree,Cn=it.stat_desc.static_tree,nn=it.stat_desc.has_stree,mn=it.stat_desc.elems,ji=-1;for(ke.heap_len=0,ke.heap_max=573,jt=0;jt<mn;jt++)0!==tn[2*jt]?(ke.heap[++ke.heap_len]=ji=jt,ke.depth[jt]=0):tn[2*jt+1]=0;for(;ke.heap_len<2;)tn[2*(dt=ke.heap[++ke.heap_len]=ji<2?++ji:0)]=1,ke.depth[dt]=0,ke.opt_len--,nn&&(ke.static_len-=Cn[2*dt+1]);for(it.max_code=ji,jt=ke.heap_len>>1;1<=jt;jt--)tr(ke,tn,jt);for(dt=mn;jt=ke.heap[1],ke.heap[1]=ke.heap[ke.heap_len--],tr(ke,tn,1),Ut=ke.heap[1],ke.heap[--ke.heap_max]=jt,ke.heap[--ke.heap_max]=Ut,tn[2*dt]=tn[2*jt]+tn[2*Ut],ke.depth[dt]=(ke.depth[jt]>=ke.depth[Ut]?ke.depth[jt]:ke.depth[Ut])+1,tn[2*jt+1]=tn[2*Ut+1]=dt,ke.heap[1]=dt++,tr(ke,tn,1),2<=ke.heap_len;);ke.heap[--ke.heap_max]=ke.heap[1],function(bi,Hr){var ur,Mo,is,qi,Sr,He,ie=Hr.dyn_tree,oe=Hr.max_code,ge=Hr.stat_desc.static_tree,Fe=Hr.stat_desc.has_stree,Ve=Hr.stat_desc.extra_bits,rt=Hr.stat_desc.extra_base,xe=Hr.stat_desc.max_length,Ke=0;for(qi=0;qi<=K;qi++)bi.bl_count[qi]=0;for(ie[2*bi.heap[bi.heap_max]+1]=0,ur=bi.heap_max+1;ur<573;ur++)xe<(qi=ie[2*ie[2*(Mo=bi.heap[ur])+1]+1]+1)&&(qi=xe,Ke++),ie[2*Mo+1]=qi,oe<Mo||(bi.bl_count[qi]++,Sr=0,rt<=Mo&&(Sr=Ve[Mo-rt]),bi.opt_len+=(He=ie[2*Mo])*(qi+Sr),Fe&&(bi.static_len+=He*(ge[2*Mo+1]+Sr)));if(0!==Ke){do{for(qi=xe-1;0===bi.bl_count[qi];)qi--;bi.bl_count[qi]--,bi.bl_count[qi+1]+=2,bi.bl_count[xe]--,Ke-=2}while(0<Ke);for(qi=xe;0!==qi;qi--)for(Mo=bi.bl_count[qi];0!==Mo;)oe<(is=bi.heap[--ur])||(ie[2*is+1]!==qi&&(bi.opt_len+=(qi-ie[2*is+1])*ie[2*is],ie[2*is+1]=qi),Mo--)}}(ke,it),zn(tn,ji,ke.bl_count)}function ne(ke,it,jt){var Ut,dt,tn=-1,Cn=it[1],nn=0,mn=7,ji=4;for(0===Cn&&(mn=138,ji=3),it[2*(jt+1)+1]=65535,Ut=0;Ut<=jt;Ut++)dt=Cn,Cn=it[2*(Ut+1)+1],++nn<mn&&dt===Cn||(nn<ji?ke.bl_tree[2*dt]+=nn:0!==dt?(dt!==tn&&ke.bl_tree[2*dt]++,ke.bl_tree[32]++):nn<=10?ke.bl_tree[34]++:ke.bl_tree[36]++,tn=dt,ji=(nn=0)===Cn?(mn=138,3):dt===Cn?(mn=6,3):(mn=7,4))}function kt(ke,it,jt){var Ut,dt,tn=-1,Cn=it[1],nn=0,mn=7,ji=4;for(0===Cn&&(mn=138,ji=3),Ut=0;Ut<=jt;Ut++)if(dt=Cn,Cn=it[2*(Ut+1)+1],!(++nn<mn&&dt===Cn)){if(nn<ji)for(;Wt(ke,dt,ke.bl_tree),0!=--nn;);else 0!==dt?(dt!==tn&&(Wt(ke,dt,ke.bl_tree),nn--),Wt(ke,16,ke.bl_tree),ln(ke,nn-3,2)):nn<=10?(Wt(ke,17,ke.bl_tree),ln(ke,nn-3,3)):(Wt(ke,18,ke.bl_tree),ln(ke,nn-11,7));tn=dt,ji=(nn=0)===Cn?(mn=138,3):dt===Cn?(mn=6,3):(mn=7,4)}}Z(pt);var Ct=!1;function Oe(ke,it,jt,Ut){var dt,tn,Cn;ln(ke,0+(Ut?1:0),3),tn=it,Cn=jt,mi(dt=ke),Sn(dt,Cn),Sn(dt,~Cn),Pe.arraySet(dt.pending_buf,dt.window,tn,Cn,dt.pending),dt.pending+=Cn}st._tr_init=function(ke){Ct||(function(){var it,jt,Ut,dt,tn,Cn=new Array(16);for(dt=Ut=0;dt<28;dt++)for(Rt[dt]=Ut,it=0;it<1<<xt[dt];it++)pe[Ut++]=dt;for(pe[Ut-1]=dt,dt=tn=0;dt<16;dt++)for(pt[dt]=tn,it=0;it<1<<Qt[dt];it++)Dt[tn++]=dt;for(tn>>=7;dt<30;dt++)for(pt[dt]=tn<<7,it=0;it<1<<Qt[dt]-7;it++)Dt[256+tn++]=dt;for(jt=0;jt<=K;jt++)Cn[jt]=0;for(it=0;it<=143;)Hn[2*it+1]=8,it++,Cn[8]++;for(;it<=255;)Hn[2*it+1]=9,it++,Cn[9]++;for(;it<=279;)Hn[2*it+1]=7,it++,Cn[7]++;for(;it<=287;)Hn[2*it+1]=8,it++,Cn[8]++;for(zn(Hn,287,Cn),it=0;it<30;it++)Ze[2*it+1]=5,Ze[2*it]=Pn(it,5);ii=new Nn(Hn,xt,257,286,K),Bt=new Nn(Ze,Qt,0,30,K),Qn=new Nn(new Array(0),Mt,0,19,7)}(),Ct=!0),ke.l_desc=new nt(ke.dyn_ltree,ii),ke.d_desc=new nt(ke.dyn_dtree,Bt),ke.bl_desc=new nt(ke.bl_tree,Qn),ke.bi_buf=0,ke.bi_valid=0,Zn(ke)},st._tr_stored_block=Oe,st._tr_flush_block=function(ke,it,jt,Ut){var dt,tn,Cn=0;0<ke.level?(2===ke.strm.data_type&&(ke.strm.data_type=function(nn){var mn,ji=4093624447;for(mn=0;mn<=31;mn++,ji>>>=1)if(1&ji&&0!==nn.dyn_ltree[2*mn])return 0;if(0!==nn.dyn_ltree[18]||0!==nn.dyn_ltree[20]||0!==nn.dyn_ltree[26])return 1;for(mn=32;mn<256;mn++)if(0!==nn.dyn_ltree[2*mn])return 1;return 0}(ke)),Jr(ke,ke.l_desc),Jr(ke,ke.d_desc),Cn=function(nn){var mn;for(ne(nn,nn.dyn_ltree,nn.l_desc.max_code),ne(nn,nn.dyn_dtree,nn.d_desc.max_code),Jr(nn,nn.bl_desc),mn=18;3<=mn&&0===nn.bl_tree[2*on[mn]+1];mn--);return nn.opt_len+=3*(mn+1)+5+5+4,mn}(ke),(tn=ke.static_len+3+7>>>3)<=(dt=ke.opt_len+3+7>>>3)&&(dt=tn)):dt=tn=jt+5,jt+4<=dt&&-1!==it?Oe(ke,it,jt,Ut):4===ke.strategy||tn===dt?(ln(ke,2+(Ut?1:0),3),pr(ke,Hn,Ze)):(ln(ke,4+(Ut?1:0),3),function(nn,mn,ji,bi){var Hr;for(ln(nn,mn-257,5),ln(nn,ji-1,5),ln(nn,bi-4,4),Hr=0;Hr<bi;Hr++)ln(nn,nn.bl_tree[2*on[Hr]+1],3);kt(nn,nn.dyn_ltree,mn-1),kt(nn,nn.dyn_dtree,ji-1)}(ke,ke.l_desc.max_code+1,ke.d_desc.max_code+1,Cn+1),pr(ke,ke.dyn_ltree,ke.dyn_dtree)),Zn(ke),Ut&&mi(ke)},st._tr_tally=function(ke,it,jt){return ke.pending_buf[ke.d_buf+2*ke.last_lit]=it>>>8&255,ke.pending_buf[ke.d_buf+2*ke.last_lit+1]=255&it,ke.pending_buf[ke.l_buf+ke.last_lit]=255&jt,ke.last_lit++,0===it?ke.dyn_ltree[2*jt]++:(ke.matches++,it--,ke.dyn_ltree[2*(pe[jt]+256+1)]++,ke.dyn_dtree[2*ht(it)]++),ke.last_lit===ke.lit_bufsize-1},st._tr_align=function(ke){var it;ln(ke,2,3),Wt(ke,256,Hn),16===(it=ke).bi_valid?(Sn(it,it.bi_buf),it.bi_buf=0,it.bi_valid=0):8<=it.bi_valid&&(it.pending_buf[it.pending++]=255&it.bi_buf,it.bi_buf>>=8,it.bi_valid-=8)}},{"../utils/common":41}],53:[function(Je,et,st){"use strict";et.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(Je,et,st){(function(Pe){!function(I){"use strict";if(!I.setImmediate){var Z,he,be,me,ve=1,ee={},fe=!1,ue=I.document,K=Object.getPrototypeOf&&Object.getPrototypeOf(I);K=K&&K.setTimeout?K:I,Z="[object process]"==={}.toString.call(I.process)?function(ot){process.nextTick(function(){Ie(ot)})}:function(){if(I.postMessage&&!I.importScripts){var ot=!0,ct=I.onmessage;return I.onmessage=function(){ot=!1},I.postMessage("","*"),I.onmessage=ct,ot}}()?(me="setImmediate$"+Math.random()+"$",I.addEventListener?I.addEventListener("message",Ue,!1):I.attachEvent("onmessage",Ue),function(ot){I.postMessage(me+ot,"*")}):I.MessageChannel?((be=new MessageChannel).port1.onmessage=function(ot){Ie(ot.data)},function(ot){be.port2.postMessage(ot)}):ue&&"onreadystatechange"in ue.createElement("script")?(he=ue.documentElement,function(ot){var ct=ue.createElement("script");ct.onreadystatechange=function(){Ie(ot),ct.onreadystatechange=null,he.removeChild(ct),ct=null},he.appendChild(ct)}):function(ot){setTimeout(Ie,0,ot)},K.setImmediate=function(ot){"function"!=typeof ot&&(ot=new Function(""+ot));for(var ct=new Array(arguments.length-1),St=0;St<ct.length;St++)ct[St]=arguments[St+1];return ee[ve]={callback:ot,args:ct},Z(ve),ve++},K.clearImmediate=Ee}function Ee(ot){delete ee[ot]}function Ie(ot){if(fe)setTimeout(Ie,0,ot);else{var ct=ee[ot];if(ct){fe=!0;try{!function(St){var xt=St.callback,Qt=St.args;switch(Qt.length){case 0:xt();break;case 1:xt(Qt[0]);break;case 2:xt(Qt[0],Qt[1]);break;case 3:xt(Qt[0],Qt[1],Qt[2]);break;default:xt.apply(undefined,Qt)}}(ct)}finally{Ee(ot),fe=!1}}}}function Ue(ot){ot.source===I&&"string"==typeof ot.data&&0===ot.data.indexOf(me)&&Ie(+ot.data.slice(me.length))}}(typeof self>"u"?void 0===Pe?this:Pe:self)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)},484:function(uu,Je){!function(et){"use strict";var st=L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,clusterPane:L.Marker.prototype.options.pane,spiderfyOnEveryZoom:!1,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyShapePositions:null,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(I){L.Util.setOptions(this,I),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[],this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};var p=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,p?this._withAnimation:this._noAnimation),this._markerCluster=p?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(I){if(I instanceof L.LayerGroup)return this.addLayers([I]);if(!I.getLatLng)return this._nonPointGroup.addLayer(I),this.fire("layeradd",{layer:I}),this;if(!this._map)return this._needsClustering.push(I),this.fire("layeradd",{layer:I}),this;if(this.hasLayer(I))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(I,this._maxZoom),this.fire("layeradd",{layer:I}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var p=I,Z=this._zoom;if(I.__parent)for(;p.__parent._zoom>=Z;)p=p.__parent;return this._currentShownBounds.contains(p.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(I,p):this._animationAddLayerNonAnimated(I,p)),this},removeLayer:function(I){return I instanceof L.LayerGroup?this.removeLayers([I]):I.getLatLng?this._map?I.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(I)),this._removeLayer(I,!0),this.fire("layerremove",{layer:I}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),I.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(I)&&(this._featureGroup.removeLayer(I),I.clusterShow&&I.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,I)&&this.hasLayer(I)&&this._needsRemoving.push({layer:I,latlng:I._latlng}),this.fire("layerremove",{layer:I}),this):(this._nonPointGroup.removeLayer(I),this.fire("layerremove",{layer:I}),this)},addLayers:function(I,p){if(!L.Util.isArray(I))return this.addLayer(I);var K,Z=this._featureGroup,he=this._nonPointGroup,be=this.options.chunkedLoading,me=this.options.chunkInterval,ve=this.options.chunkProgress,ee=I.length,fe=0,ue=!0;if(this._map){var Ee=(new Date).getTime(),Ie=L.bind(function(){var ot=(new Date).getTime();for(this._map&&this._unspiderfy&&this._unspiderfy();fe<ee&&!(be&&fe%200==0&&(new Date).getTime()-ot>me);fe++)if((K=I[fe])instanceof L.LayerGroup)ue&&(I=I.slice(),ue=!1),this._extractNonGroupLayers(K,I),ee=I.length;else if(K.getLatLng){if(!this.hasLayer(K)&&(this._addLayer(K,this._maxZoom),p||this.fire("layeradd",{layer:K}),K.__parent&&2===K.__parent.getChildCount())){var St=K.__parent.getAllChildMarkers();Z.removeLayer(St[0]===K?St[1]:St[0])}}else he.addLayer(K),p||this.fire("layeradd",{layer:K});ve&&ve(fe,ee,(new Date).getTime()-Ee),fe===ee?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(Ie,this.options.chunkDelay)},this);Ie()}else for(var Ue=this._needsClustering;fe<ee;fe++)(K=I[fe])instanceof L.LayerGroup?(ue&&(I=I.slice(),ue=!1),this._extractNonGroupLayers(K,I),ee=I.length):K.getLatLng?this.hasLayer(K)||Ue.push(K):he.addLayer(K);return this},removeLayers:function(I){var p,Z,he=I.length,be=this._featureGroup,me=this._nonPointGroup,ve=!0;if(!this._map){for(p=0;p<he;p++)(Z=I[p])instanceof L.LayerGroup?(ve&&(I=I.slice(),ve=!1),this._extractNonGroupLayers(Z,I),he=I.length):(this._arraySplice(this._needsClustering,Z),me.removeLayer(Z),this.hasLayer(Z)&&this._needsRemoving.push({layer:Z,latlng:Z._latlng}),this.fire("layerremove",{layer:Z}));return this}if(this._unspiderfy){this._unspiderfy();var ee=I.slice(),fe=he;for(p=0;p<fe;p++)(Z=ee[p])instanceof L.LayerGroup?(this._extractNonGroupLayers(Z,ee),fe=ee.length):this._unspiderfyLayer(Z)}for(p=0;p<he;p++)(Z=I[p])instanceof L.LayerGroup?(ve&&(I=I.slice(),ve=!1),this._extractNonGroupLayers(Z,I),he=I.length):Z.__parent?(this._removeLayer(Z,!0,!0),this.fire("layerremove",{layer:Z}),be.hasLayer(Z)&&(be.removeLayer(Z),Z.clusterShow&&Z.clusterShow())):(me.removeLayer(Z),this.fire("layerremove",{layer:Z}));return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],this._needsRemoving=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(I){I.off(this._childMarkerEventHandlers,this),delete I.__parent},this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var I=new L.LatLngBounds;this._topClusterLevel&&I.extend(this._topClusterLevel._bounds);for(var p=this._needsClustering.length-1;p>=0;p--)I.extend(this._needsClustering[p].getLatLng());return I.extend(this._nonPointGroup.getBounds()),I},eachLayer:function(I,p){var be,me,ve,Z=this._needsClustering.slice(),he=this._needsRemoving;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(Z),me=Z.length-1;me>=0;me--){for(be=!0,ve=he.length-1;ve>=0;ve--)if(he[ve].layer===Z[me]){be=!1;break}be&&I.call(p,Z[me])}this._nonPointGroup.eachLayer(I,p)},getLayers:function(){var I=[];return this.eachLayer(function(p){I.push(p)}),I},getLayer:function(I){var p=null;return I=parseInt(I,10),this.eachLayer(function(Z){L.stamp(Z)===I&&(p=Z)}),p},hasLayer:function(I){if(!I)return!1;var p,Z=this._needsClustering;for(p=Z.length-1;p>=0;p--)if(Z[p]===I)return!0;for(p=(Z=this._needsRemoving).length-1;p>=0;p--)if(Z[p].layer===I)return!1;return!(!I.__parent||I.__parent._group!==this)||this._nonPointGroup.hasLayer(I)},zoomToShowLayer:function(I,p){var Z=this._map;"function"!=typeof p&&(p=function(){});var he=function(){(Z.hasLayer(I)||Z.hasLayer(I.__parent))&&!this._inZoomAnimation&&(this._map.off("moveend",he,this),this.off("animationend",he,this),Z.hasLayer(I)?p():I.__parent._icon&&(this.once("spiderfied",p,this),I.__parent.spiderfy()))};I._icon&&this._map.getBounds().contains(I.getLatLng())?p():I.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",he,this),this._map.panTo(I.getLatLng())):(this._map.on("moveend",he,this),this.on("animationend",he,this),I.__parent.zoomToBounds())},onAdd:function(I){var p,Z,he;if(this._map=I,!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(I),this._nonPointGroup.addTo(I),this._gridClusters||this._generateInitialClusters(),this._maxLat=I.options.crs.projection.MAX_LATITUDE,p=0,Z=this._needsRemoving.length;p<Z;p++)(he=this._needsRemoving[p]).newlatlng=he.layer._latlng,he.layer._latlng=he.latlng;for(p=0,Z=this._needsRemoving.length;p<Z;p++)this._removeLayer((he=this._needsRemoving[p]).layer,!0),he.layer._latlng=he.newlatlng;this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),Z=this._needsClustering,this._needsClustering=[],this.addLayers(Z,!0)},onRemove:function(I){I.off("zoomend",this._zoomEnd,this),I.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(I){for(var p=I;p&&!p._icon;)p=p.__parent;return p||null},_arraySplice:function(I,p){for(var Z=I.length-1;Z>=0;Z--)if(I[Z]===p)return I.splice(Z,1),!0},_removeFromGridUnclustered:function(I,p){for(var Z=this._map,he=this._gridUnclustered,be=Math.floor(this._map.getMinZoom());p>=be&&he[p].removeObject(I,Z.project(I.getLatLng(),p));p--);},_childMarkerDragStart:function(I){I.target.__dragStart=I.target._latlng},_childMarkerMoved:function(I){if(!this._ignoreMove&&!I.target.__dragStart){var p=I.target._popup&&I.target._popup.isOpen();this._moveChild(I.target,I.oldLatLng,I.latlng),p&&I.target.openPopup()}},_moveChild:function(I,p,Z){I._latlng=p,this.removeLayer(I),I._latlng=Z,this.addLayer(I)},_childMarkerDragEnd:function(I){var p=I.target.__dragStart;delete I.target.__dragStart,p&&this._moveChild(I.target,p,I.target._latlng)},_removeLayer:function(I,p,Z){var he=this._gridClusters,be=this._gridUnclustered,me=this._featureGroup,ve=this._map,ee=Math.floor(this._map.getMinZoom());p&&this._removeFromGridUnclustered(I,this._maxZoom);var K,fe=I.__parent;for(this._arraySplice(fe._markers,I);fe&&(fe._childCount--,fe._boundsNeedUpdate=!0,!(fe._zoom<ee));)p&&fe._childCount<=1?(K=fe._markers[0]===I?fe._markers[1]:fe._markers[0],he[fe._zoom].removeObject(fe,ve.project(fe._cLatLng,fe._zoom)),be[fe._zoom].addObject(K,ve.project(K.getLatLng(),fe._zoom)),this._arraySplice(fe.__parent._childClusters,fe),fe.__parent._markers.push(K),K.__parent=fe.__parent,fe._icon&&(me.removeLayer(fe),Z||me.addLayer(K))):fe._iconNeedsUpdate=!0,fe=fe.__parent;delete I.__parent},_isOrIsParent:function(I,p){for(;p;){if(I===p)return!0;p=p.parentNode}return!1},fire:function(I,p,Z){if(p&&p.layer instanceof L.MarkerCluster){if(p.originalEvent&&this._isOrIsParent(p.layer._icon,p.originalEvent.relatedTarget))return;I="cluster"+I}L.FeatureGroup.prototype.fire.call(this,I,p,Z)},listens:function(I,p){return L.FeatureGroup.prototype.listens.call(this,I,p)||L.FeatureGroup.prototype.listens.call(this,"cluster"+I,p)},_defaultIconCreateFunction:function(I){var p=I.getChildCount(),Z=" marker-cluster-";return new L.DivIcon({html:"<div><span>"+p+"</span></div>",className:"marker-cluster"+(Z+=p<10?"small":p<100?"medium":"large"),iconSize:new L.Point(40,40)})},_bindEvents:function(){var I=this._map,Z=this.options.showCoverageOnHover;(this.options.spiderfyOnMaxZoom||this.options.zoomToBoundsOnClick||this.options.spiderfyOnEveryZoom)&&this.on("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),Z&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),I.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(I){var p=I.layer,Z=p;if("clusterkeypress"!==I.type||!I.originalEvent||13===I.originalEvent.keyCode){for(;1===Z._childClusters.length;)Z=Z._childClusters[0];Z._zoom===this._maxZoom&&Z._childCount===p._childCount&&this.options.spiderfyOnMaxZoom?p.spiderfy():this.options.zoomToBoundsOnClick&&p.zoomToBounds(),this.options.spiderfyOnEveryZoom&&p.spiderfy(),I.originalEvent&&13===I.originalEvent.keyCode&&this._map._container.focus()}},_showCoverage:function(I){var p=this._map;this._inZoomAnimation||(this._shownPolygon&&p.removeLayer(this._shownPolygon),I.layer.getChildCount()>2&&I.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(I.layer.getConvexHull(),this.options.polygonOptions),p.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var p=this.options.showCoverageOnHover,be=this._map;(this.options.spiderfyOnMaxZoom||this.options.zoomToBoundsOnClick||this.options.spiderfyOnEveryZoom)&&this.off("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),p&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),be.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var I=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,I),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),I),this._currentShownBounds=I}},_generateInitialClusters:function(){var I=Math.ceil(this._map.getMaxZoom()),p=Math.floor(this._map.getMinZoom()),Z=this.options.maxClusterRadius,he=Z;"function"!=typeof Z&&(he=function(){return Z}),null!==this.options.disableClusteringAtZoom&&(I=this.options.disableClusteringAtZoom-1),this._maxZoom=I,this._gridClusters={},this._gridUnclustered={};for(var be=I;be>=p;be--)this._gridClusters[be]=new L.DistanceGrid(he(be)),this._gridUnclustered[be]=new L.DistanceGrid(he(be));this._topClusterLevel=new this._markerCluster(this,p-1)},_addLayer:function(I,p){var me,ve,Z=this._gridClusters,he=this._gridUnclustered,be=Math.floor(this._map.getMinZoom());for(this.options.singleMarkerMode&&this._overrideMarkerIcon(I),I.on(this._childMarkerEventHandlers,this);p>=be;p--){me=this._map.project(I.getLatLng(),p);var ee=Z[p].getNearObject(me);if(ee)return ee._addChild(I),void(I.__parent=ee);if(ee=he[p].getNearObject(me)){var fe=ee.__parent;fe&&this._removeLayer(ee,!1);var ue=new this._markerCluster(this,p,ee,I);Z[p].addObject(ue,this._map.project(ue._cLatLng,p)),ee.__parent=ue,I.__parent=ue;var K=ue;for(ve=p-1;ve>fe._zoom;ve--)K=new this._markerCluster(this,ve,K),Z[ve].addObject(K,this._map.project(ee.getLatLng(),ve));return fe._addChild(K),void this._removeFromGridUnclustered(ee,p)}he[p].addObject(I,me)}this._topClusterLevel._addChild(I),I.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(I){I instanceof L.MarkerCluster&&I._iconNeedsUpdate&&I._updateIcon()})},_enqueue:function(I){this._queue.push(I),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var I=0;I<this._queue.length;I++)this._queue[I].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var I=Math.round(this._map._zoom);this._processQueue(),this._zoom<I&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,I)):this._zoom>I?(this._animationStart(),this._animationZoomOut(this._zoom,I)):this._moveEnd()},_getExpandedVisibleBounds:function(){return this.options.removeOutsideVisibleBounds?L.Browser.mobile?this._checkBoundsMaxLat(this._map.getBounds()):this._checkBoundsMaxLat(this._map.getBounds().pad(1)):this._mapBoundsInfinite},_checkBoundsMaxLat:function(I){var p=this._maxLat;return void 0!==p&&(I.getNorth()>=p&&(I._northEast.lat=1/0),I.getSouth()<=-p&&(I._southWest.lat=-1/0)),I},_animationAddLayerNonAnimated:function(I,p){if(p===I)this._featureGroup.addLayer(I);else if(2===p._childCount){p._addToMap();var Z=p.getAllChildMarkers();this._featureGroup.removeLayer(Z[0]),this._featureGroup.removeLayer(Z[1])}else p._updateIcon()},_extractNonGroupLayers:function(I,p){var be,Z=I.getLayers(),he=0;for(p=p||[];he<Z.length;he++)(be=Z[he])instanceof L.LayerGroup?this._extractNonGroupLayers(be,p):p.push(be);return p},_overrideMarkerIcon:function(I){return I.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[I]}})}});L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(I,p){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),I),this._topClusterLevel._recursivelyAddChildrenToMap(null,p,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(I,p){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),I),this._topClusterLevel._recursivelyAddChildrenToMap(null,p,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(I,p){this._animationAddLayerNonAnimated(I,p)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(I,p){var me,Z=this._getExpandedVisibleBounds(),he=this._featureGroup,be=Math.floor(this._map.getMinZoom());this._ignoreMove=!0,this._topClusterLevel._recursively(Z,I,be,function(ve){var ue,ee=ve._latlng,fe=ve._markers;for(Z.contains(ee)||(ee=null),ve._isSingleParent()&&I+1===p?(he.removeLayer(ve),ve._recursivelyAddChildrenToMap(null,p,Z)):(ve.clusterHide(),ve._recursivelyAddChildrenToMap(ee,p,Z)),me=fe.length-1;me>=0;me--)Z.contains((ue=fe[me])._latlng)||he.removeLayer(ue)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(Z,p),he.eachLayer(function(ve){!(ve instanceof L.MarkerCluster)&&ve._icon&&ve.clusterShow()}),this._topClusterLevel._recursively(Z,I,p,function(ve){ve._recursivelyRestoreChildPositions(p)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(Z,I,be,function(ve){he.removeLayer(ve),ve.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(I,p){this._animationZoomOutSingle(this._topClusterLevel,I-1,p),this._topClusterLevel._recursivelyAddChildrenToMap(null,p,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),I,this._getExpandedVisibleBounds())},_animationAddLayer:function(I,p){var Z=this,he=this._featureGroup;he.addLayer(I),p!==I&&(p._childCount>2?(p._updateIcon(),this._forceLayout(),this._animationStart(),I._setPos(this._map.latLngToLayerPoint(p.getLatLng())),I.clusterHide(),this._enqueue(function(){he.removeLayer(I),I.clusterShow(),Z._animationEnd()})):(this._forceLayout(),Z._animationStart(),Z._animationZoomOutSingle(p,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(I,p,Z){var he=this._getExpandedVisibleBounds(),be=Math.floor(this._map.getMinZoom());I._recursivelyAnimateChildrenInAndAddSelfToMap(he,be,p+1,Z);var me=this;this._forceLayout(),I._recursivelyBecomeVisible(he,Z),this._enqueue(function(){if(1===I._childCount){var ve=I._markers[0];this._ignoreMove=!0,ve.setLatLng(ve.getLatLng()),this._ignoreMove=!1,ve.clusterShow&&ve.clusterShow()}else I._recursively(he,Z,be,function(ee){ee._recursivelyRemoveChildrenFromMap(he,be,p+1)});me._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}}),L.markerClusterGroup=function(I){return new L.MarkerClusterGroup(I)};var Pe=L.MarkerCluster=L.Marker.extend({options:L.Icon.prototype.options,initialize:function(I,p,Z,he){L.Marker.prototype.initialize.call(this,Z?Z._cLatLng||Z.getLatLng():new L.LatLng(0,0),{icon:this,pane:I.options.clusterPane}),this._group=I,this._zoom=p,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,Z&&this._addChild(Z),he&&this._addChild(he)},getAllChildMarkers:function(I,p){I=I||[];for(var Z=this._childClusters.length-1;Z>=0;Z--)this._childClusters[Z].getAllChildMarkers(I,p);for(var he=this._markers.length-1;he>=0;he--)p&&this._markers[he].__dragStart||I.push(this._markers[he]);return I},getChildCount:function(){return this._childCount},zoomToBounds:function(I){for(var ve,p=this._childClusters.slice(),Z=this._group._map,he=Z.getBoundsZoom(this._bounds),be=this._zoom+1,me=Z.getZoom();p.length>0&&he>be;){be++;var ee=[];for(ve=0;ve<p.length;ve++)ee=ee.concat(p[ve]._childClusters);p=ee}he>be?this._group._map.setView(this._latlng,be):he<=me?this._group._map.setView(this._latlng,me+1):this._group._map.fitBounds(this._bounds,I)},getBounds:function(){var I=new L.LatLngBounds;return I.extend(this._bounds),I},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(I,p){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(I),I instanceof L.MarkerCluster?(p||(this._childClusters.push(I),I.__parent=this),this._childCount+=I._childCount):(p||this._markers.push(I),this._childCount++),this.__parent&&this.__parent._addChild(I,!0)},_setClusterCenter:function(I){this._cLatLng||(this._cLatLng=I._cLatLng||I._latlng)},_resetBounds:function(){var I=this._bounds;I._southWest&&(I._southWest.lat=1/0,I._southWest.lng=1/0),I._northEast&&(I._northEast.lat=-1/0,I._northEast.lng=-1/0)},_recalculateBounds:function(){var me,ve,ee,fe,I=this._markers,p=this._childClusters,Z=0,he=0,be=this._childCount;if(0!==be){for(this._resetBounds(),me=0;me<I.length;me++)this._bounds.extend(ee=I[me]._latlng),Z+=ee.lat,he+=ee.lng;for(me=0;me<p.length;me++)(ve=p[me])._boundsNeedUpdate&&ve._recalculateBounds(),this._bounds.extend(ve._bounds),Z+=(ee=ve._wLatLng).lat*(fe=ve._childCount),he+=ee.lng*fe;this._latlng=this._wLatLng=new L.LatLng(Z/be,he/be),this._boundsNeedUpdate=!1}},_addToMap:function(I){I&&(this._backupLatlng=this._latlng,this.setLatLng(I)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(I,p,Z){this._recursively(I,this._group._map.getMinZoom(),Z-1,function(he){var me,ve,be=he._markers;for(me=be.length-1;me>=0;me--)(ve=be[me])._icon&&(ve._setPos(p),ve.clusterHide())},function(he){var me,ve,be=he._childClusters;for(me=be.length-1;me>=0;me--)(ve=be[me])._icon&&(ve._setPos(p),ve.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(I,p,Z,he){this._recursively(I,he,p,function(be){be._recursivelyAnimateChildrenIn(I,be._group._map.latLngToLayerPoint(be.getLatLng()).round(),Z),be._isSingleParent()&&Z-1===he?(be.clusterShow(),be._recursivelyRemoveChildrenFromMap(I,p,Z)):be.clusterHide(),be._addToMap()})},_recursivelyBecomeVisible:function(I,p){this._recursively(I,this._group._map.getMinZoom(),p,null,function(Z){Z.clusterShow()})},_recursivelyAddChildrenToMap:function(I,p,Z){this._recursively(Z,this._group._map.getMinZoom()-1,p,function(he){if(p!==he._zoom)for(var be=he._markers.length-1;be>=0;be--){var me=he._markers[be];Z.contains(me._latlng)&&(I&&(me._backupLatlng=me.getLatLng(),me.setLatLng(I),me.clusterHide&&me.clusterHide()),he._group._featureGroup.addLayer(me))}},function(he){he._addToMap(I)})},_recursivelyRestoreChildPositions:function(I){for(var p=this._markers.length-1;p>=0;p--){var Z=this._markers[p];Z._backupLatlng&&(Z.setLatLng(Z._backupLatlng),delete Z._backupLatlng)}if(I-1===this._zoom)for(var he=this._childClusters.length-1;he>=0;he--)this._childClusters[he]._restorePosition();else for(var be=this._childClusters.length-1;be>=0;be--)this._childClusters[be]._recursivelyRestoreChildPositions(I)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(I,p,Z,he){var be,me;this._recursively(I,p-1,Z-1,function(ve){for(me=ve._markers.length-1;me>=0;me--)be=ve._markers[me],(!he||!he.contains(be._latlng))&&(ve._group._featureGroup.removeLayer(be),be.clusterShow&&be.clusterShow())},function(ve){for(me=ve._childClusters.length-1;me>=0;me--)be=ve._childClusters[me],(!he||!he.contains(be._latlng))&&(ve._group._featureGroup.removeLayer(be),be.clusterShow&&be.clusterShow())})},_recursively:function(I,p,Z,he,be){var ee,fe,me=this._childClusters,ve=this._zoom;if(p<=ve&&(he&&he(this),be&&ve===Z&&be(this)),ve<p||ve<Z)for(ee=me.length-1;ee>=0;ee--)(fe=me[ee])._boundsNeedUpdate&&fe._recalculateBounds(),I.intersects(fe._bounds)&&fe._recursively(I,p,Z,he,be)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}});L.Marker.include({clusterHide:function(){var I=this.options.opacity;return this.setOpacity(0),this.options.opacity=I,this},clusterShow:function(){return this.setOpacity(this.options.opacity)}}),L.DistanceGrid=function(I){this._cellSize=I,this._sqCellSize=I*I,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(I,p){var Z=this._getCoord(p.x),he=this._getCoord(p.y),be=this._grid,me=be[he]=be[he]||{},ve=me[Z]=me[Z]||[],ee=L.Util.stamp(I);this._objectPoint[ee]=p,ve.push(I)},updateObject:function(I,p){this.removeObject(I),this.addObject(I,p)},removeObject:function(I,p){var ee,fe,Z=this._getCoord(p.x),he=this._getCoord(p.y),be=this._grid,me=be[he]=be[he]||{},ve=me[Z]=me[Z]||[];for(delete this._objectPoint[L.Util.stamp(I)],ee=0,fe=ve.length;ee<fe;ee++)if(ve[ee]===I)return ve.splice(ee,1),1===fe&&delete me[Z],!0},eachObject:function(I,p){var Z,he,be,me,ve,ee,ue=this._grid;for(Z in ue)for(he in ve=ue[Z])for(be=0,me=(ee=ve[he]).length;be<me;be++)I.call(p,ee[be])&&(be--,me--)},getNearObject:function(I){var he,be,me,ve,ee,fe,ue,K,p=this._getCoord(I.x),Z=this._getCoord(I.y),Ee=this._objectPoint,Ie=this._sqCellSize,Ue=null;for(he=Z-1;he<=Z+1;he++)if(ve=this._grid[he])for(be=p-1;be<=p+1;be++)if(ee=ve[be])for(me=0,fe=ee.length;me<fe;me++)ue=ee[me],((K=this._sqDist(Ee[L.Util.stamp(ue)],I))<Ie||K<=Ie&&null===Ue)&&(Ie=K,Ue=ue);return Ue},_getCoord:function(I){var p=Math.floor(I/this._cellSize);return isFinite(p)?p:I},_sqDist:function(I,p){var Z=p.x-I.x,he=p.y-I.y;return Z*Z+he*he}},L.QuickHull={getDistant:function(I,p){return(p[0].lng-p[1].lng)*(I.lat-p[0].lat)+(p[1].lat-p[0].lat)*(I.lng-p[0].lng)},findMostDistantPointFromBaseLine:function(I,p){var me,ve,ee,Z=0,he=null,be=[];for(me=p.length-1;me>=0;me--)(ee=this.getDistant(ve=p[me],I))>0&&(be.push(ve),ee>Z&&(Z=ee,he=ve));return{maxPoint:he,newPoints:be}},buildConvexHull:function(I,p){var Z=[],he=this.findMostDistantPointFromBaseLine(I,p);return he.maxPoint?Z=(Z=Z.concat(this.buildConvexHull([I[0],he.maxPoint],he.newPoints))).concat(this.buildConvexHull([he.maxPoint,I[1]],he.newPoints)):[I[0]]},getConvexHull:function(I){var Ee,p=!1,Z=!1,he=!1,be=!1,me=null,ve=null,ee=null,fe=null,ue=null,K=null;for(Ee=I.length-1;Ee>=0;Ee--){var Ie=I[Ee];(!1===p||Ie.lat>p)&&(me=Ie,p=Ie.lat),(!1===Z||Ie.lat<Z)&&(ve=Ie,Z=Ie.lat),(!1===he||Ie.lng>he)&&(ee=Ie,he=Ie.lng),(!1===be||Ie.lng<be)&&(fe=Ie,be=Ie.lng)}return Z!==p?(K=ve,ue=me):(K=fe,ue=ee),[].concat(this.buildConvexHull([K,ue],I),this.buildConvexHull([ue,K],I))}},L.MarkerCluster.include({getConvexHull:function(){var Z,he,I=this.getAllChildMarkers(),p=[];for(he=I.length-1;he>=0;he--)Z=I[he].getLatLng(),p.push(Z);return L.QuickHull.getConvexHull(p)}}),L.MarkerCluster.include({_2PI:2*Math.PI,_circleFootSeparation:25,_circleStartAngle:0,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied!==this&&!this._group._inZoomAnimation){var be,I=this.getAllChildMarkers(null,!0),he=this._group._map.latLngToLayerPoint(this._latlng);this._group._unspiderfy(),this._group._spiderfied=this,this._group.options.spiderfyShapePositions?be=this._group.options.spiderfyShapePositions(I.length,he):I.length>=this._circleSpiralSwitchover?be=this._generatePointsSpiral(I.length,he):(he.y+=10,be=this._generatePointsCircle(I.length,he)),this._animationSpiderfy(I,be)}},unspiderfy:function(I){this._group._inZoomAnimation||(this._animationUnspiderfy(I),this._group._spiderfied=null)},_generatePointsCircle:function(I,p){var ve,ee,he=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+I)/this._2PI,be=this._2PI/I,me=[];for(he=Math.max(he,35),me.length=I,ve=0;ve<I;ve++)ee=this._circleStartAngle+ve*be,me[ve]=new L.Point(p.x+he*Math.cos(ee),p.y+he*Math.sin(ee))._round();return me},_generatePointsSpiral:function(I,p){var fe,Z=this._group.options.spiderfyDistanceMultiplier,he=Z*this._spiralLengthStart,be=Z*this._spiralFootSeparation,me=Z*this._spiralLengthFactor*this._2PI,ve=0,ee=[];for(ee.length=I,fe=I;fe>=0;fe--)fe<I&&(ee[fe]=new L.Point(p.x+he*Math.cos(ve),p.y+he*Math.sin(ve))._round()),he+=me/(ve+=be/he+5e-4*fe);return ee},_noanimationUnspiderfy:function(){var be,me,I=this._group,p=I._map,Z=I._featureGroup,he=this.getAllChildMarkers(null,!0);for(I._ignoreMove=!0,this.setOpacity(1),me=he.length-1;me>=0;me--)Z.removeLayer(be=he[me]),be._preSpiderfyLatlng&&(be.setLatLng(be._preSpiderfyLatlng),delete be._preSpiderfyLatlng),be.setZIndexOffset&&be.setZIndexOffset(0),be._spiderLeg&&(p.removeLayer(be._spiderLeg),delete be._spiderLeg);I.fire("unspiderfied",{cluster:this,markers:he}),I._ignoreMove=!1,I._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(I,p){var ve,ee,fe,ue,Z=this._group,he=Z._map,be=Z._featureGroup,me=this._group.options.spiderLegPolylineOptions;for(Z._ignoreMove=!0,ve=0;ve<I.length;ve++)ue=he.layerPointToLatLng(p[ve]),ee=I[ve],fe=new L.Polyline([this._latlng,ue],me),he.addLayer(fe),ee._spiderLeg=fe,ee._preSpiderfyLatlng=ee._latlng,ee.setLatLng(ue),ee.setZIndexOffset&&ee.setZIndexOffset(1e6),be.addLayer(ee);this.setOpacity(.3),Z._ignoreMove=!1,Z.fire("spiderfied",{cluster:this,markers:I})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(I,p){var Ee,Ie,Ue,ot,ct,St,Z=this,he=this._group,be=he._map,me=he._featureGroup,ve=this._latlng,ee=be.latLngToLayerPoint(ve),fe=L.Path.SVG,ue=L.extend({},this._group.options.spiderLegPolylineOptions),K=ue.opacity;for(void 0===K&&(K=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),fe?(ue.opacity=0,ue.className=(ue.className||"")+" leaflet-cluster-spider-leg"):ue.opacity=K,he._ignoreMove=!0,Ee=0;Ee<I.length;Ee++)Ie=I[Ee],St=be.layerPointToLatLng(p[Ee]),Ue=new L.Polyline([ve,St],ue),be.addLayer(Ue),Ie._spiderLeg=Ue,fe&&(ct=(ot=Ue._path).getTotalLength()+.1,ot.style.strokeDasharray=ct,ot.style.strokeDashoffset=ct),Ie.setZIndexOffset&&Ie.setZIndexOffset(1e6),Ie.clusterHide&&Ie.clusterHide(),me.addLayer(Ie),Ie._setPos&&Ie._setPos(ee);for(he._forceLayout(),he._animationStart(),Ee=I.length-1;Ee>=0;Ee--)St=be.layerPointToLatLng(p[Ee]),(Ie=I[Ee])._preSpiderfyLatlng=Ie._latlng,Ie.setLatLng(St),Ie.clusterShow&&Ie.clusterShow(),fe&&((ot=(Ue=Ie._spiderLeg)._path).style.strokeDashoffset=0,Ue.setStyle({opacity:K}));this.setOpacity(.3),he._ignoreMove=!1,setTimeout(function(){he._animationEnd(),he.fire("spiderfied",{cluster:Z,markers:I})},200)},_animationUnspiderfy:function(I){var fe,ue,K,Ee,Ie,Ue,p=this,Z=this._group,he=Z._map,be=Z._featureGroup,me=I?he._latLngToNewLayerPoint(this._latlng,I.zoom,I.center):he.latLngToLayerPoint(this._latlng),ve=this.getAllChildMarkers(null,!0),ee=L.Path.SVG;for(Z._ignoreMove=!0,Z._animationStart(),this.setOpacity(1),ue=ve.length-1;ue>=0;ue--)(fe=ve[ue])._preSpiderfyLatlng&&(fe.closePopup(),fe.setLatLng(fe._preSpiderfyLatlng),delete fe._preSpiderfyLatlng,Ue=!0,fe._setPos&&(fe._setPos(me),Ue=!1),fe.clusterHide&&(fe.clusterHide(),Ue=!1),Ue&&be.removeLayer(fe),ee&&(Ie=(Ee=(K=fe._spiderLeg)._path).getTotalLength()+.1,Ee.style.strokeDashoffset=Ie,K.setStyle({opacity:0})));Z._ignoreMove=!1,setTimeout(function(){var ot=0;for(ue=ve.length-1;ue>=0;ue--)(fe=ve[ue])._spiderLeg&&ot++;for(ue=ve.length-1;ue>=0;ue--)(fe=ve[ue])._spiderLeg&&(fe.clusterShow&&fe.clusterShow(),fe.setZIndexOffset&&fe.setZIndexOffset(0),ot>1&&be.removeLayer(fe),he.removeLayer(fe._spiderLeg),delete fe._spiderLeg);Z._animationEnd(),Z.fire("unspiderfied",{cluster:p,markers:ve})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(I){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(I))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(I){this._spiderfied&&this._spiderfied.unspiderfy(I)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(I){I._spiderLeg&&(this._featureGroup.removeLayer(I),I.clusterShow&&I.clusterShow(),I.setZIndexOffset&&I.setZIndexOffset(0),this._map.removeLayer(I._spiderLeg),delete I._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(I){return I?I instanceof L.MarkerClusterGroup?I=I._topClusterLevel.getAllChildMarkers():I instanceof L.LayerGroup?I=I._layers:I instanceof L.MarkerCluster?I=I.getAllChildMarkers():I instanceof L.Marker&&(I=[I]):I=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(I),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(I),this},_flagParentsIconsNeedUpdate:function(I){var p,Z;for(p in I)for(Z=I[p].__parent;Z;)Z._iconNeedsUpdate=!0,Z=Z.__parent},_refreshSingleMarkerModeMarkers:function(I){var p,Z;for(p in I)this.hasLayer(Z=I[p])&&Z.setIcon(this._overrideMarkerIcon(Z))}}),L.Marker.include({refreshIconOptions:function(I,p){var Z=this.options.icon;return L.setOptions(Z,I),this.setIcon(Z),p&&this.__parent&&this.__parent._group.refreshClusters(this),this}}),et.MarkerClusterGroup=st,et.MarkerCluster=Pe,Object.defineProperty(et,"__esModule",{value:!0})}(Je)}},uu=>{uu(uu.s=239)}]);