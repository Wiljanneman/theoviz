<div class="w-full h-full relative">
  <div id="map" class="w-full h-full"></div>
  
  <!-- Mobile Filter Toggle Button (visible only on mobile when drawer is closed) -->
  <button 
    *ngIf="!isFilterDrawerOpen"
    (click)="toggleFilterDrawer()"
    class="md:hidden fixed bottom-4 right-4 z-[1001] bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-full shadow-xl transition-all duration-200 flex items-center justify-center">
    <i class="fas fa-filter text-xl"></i>
  </button>
  
  <!-- Filter overlay -->
  <div class="map-filter-overlay" [class.drawer-open]="isFilterDrawerOpen">
    <!-- Mobile drawer handle / close button -->
    <div class="md:hidden flex items-center justify-between mb-3 pb-3 border-b border-gray-300">
      <div class="filter-header !mb-0 !pb-0 !border-0">Explore the Context</div>
      <button 
        (click)="toggleFilterDrawer()"
        class="text-gray-600 hover:text-gray-800 p-2">
        <i class="fas fa-times text-xl"></i>
      </button>
    </div>
    
    <!-- Desktop header (visible only on desktop) -->
    <div class="hidden md:block filter-header">Explore the Context</div>
    
    <div class="filter-item">
      <button 
        class="filter-button" 
        [class.active]="activeFilter === 'all'"
        (click)="filterMarkers('all')">
        <i class="fas fa-layer-group"></i>
        <span>Show All</span>
        <i class="fas fa-chevron-down chevron-icon" 
           [class.rotated]="expandedFilter === 'all'"
           (click)="toggleExpand('all', $event)"></i>
      </button>
      <div class="filter-description" [class.expanded]="expandedFilter === 'all'">
        View all markers showing the complete historical context of James's letter.
      </div>
    </div>
    
    <div class="filter-item">
      <button 
        class="filter-button" 
        [class.active]="activeFilter === 'author'"
        (click)="filterMarkers('author')">
        <i class="fas fa-pen-fancy"></i>
        <span>Who wrote the letter?</span>
        <i class="fas fa-chevron-down chevron-icon" 
           [class.rotated]="expandedFilter === 'author'"
           (click)="toggleExpand('author', $event)"></i>
      </button>
      <div class="filter-description" [class.expanded]="expandedFilter === 'author'">
        James, Jesus's half-brother, led the Jerusalem church. Known as "James the Just" for his exceptional holiness, he likely wrote this letter around 45-49 AD - making it possibly the earliest New Testament book. He was eventually martyred by stoning in 62 AD.
      </div>
    </div>
    
    <div class="filter-item">
      <button 
        class="filter-button" 
        [class.active]="activeFilter === 'audience'"
        (click)="filterMarkers('audience')">
        <i class="fas fa-users"></i>
        <span>Who was the audience?</span>
        <i class="fas fa-chevron-down chevron-icon" 
           [class.rotated]="expandedFilter === 'audience'"
           (click)="toggleExpand('audience', $event)"></i>
      </button>
      <div class="filter-description" [class.expanded]="expandedFilter === 'audience'">
        "The twelve tribes scattered abroad" - Jewish believers who fled persecution after Stephen's death. By the first century, more Jews lived outside Palestine than within it. These diaspora communities maintained their Jewish identity while following Jesus as Messiah, facing hostility from both Jews and Gentiles.
      </div>
    </div>
    
    <div class="filter-item">
      <button 
        class="filter-button" 
        [class.active]="activeFilter === 'notable-event'"
        (click)="filterMarkers('notable-event')">
        <i class="fas fa-fire"></i>
        <span>Notable Events & Trials</span>
        <i class="fas fa-chevron-down chevron-icon" 
           [class.rotated]="expandedFilter === 'notable-event'"
           (click)="toggleExpand('notable-event', $event)"></i>
      </button>
      <div class="filter-description" [class.expanded]="expandedFilter === 'notable-event'">
        From Stephen's martyrdom to economic hardship, social ostracism, and persecution across the Empire - these trials tested their faith. James wrote to encourage them to see suffering not as punishment, but as an opportunity for spiritual growth and maturity.
      </div>
    </div>
  </div>
  
  <!-- Mobile backdrop -->
  <div 
    *ngIf="isFilterDrawerOpen"
    (click)="toggleFilterDrawer()"
    class="md:hidden fixed inset-0 bg-black/50 z-[999] backdrop-blur-sm"></div>
</div>