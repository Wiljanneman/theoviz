<div class="w-full h-full flex flex-col bg-gradient-to-br from-slate-900 to-slate-800">
  <!-- Header -->
  <div class="p-6 border-b border-purple-500/30">
    <div class="flex justify-between items-start mb-2">
      <div>
        <h2 class="text-2xl font-bold text-white mb-2">{{ clusterData?.title }}</h2>
        <p class="text-slate-300 text-sm">{{ clusterData?.description }}</p>
      </div>
      <button 
        (click)="toggleMode()"
        class="px-4 py-2 rounded-lg transition flex items-center gap-2"
        [ngClass]="isGuidedMode ? 'bg-purple-600 hover:bg-purple-700 text-white' : 'bg-slate-700 hover:bg-slate-600 text-slate-300'">
        <i class="fas" [ngClass]="isGuidedMode ? 'fa-route' : 'fa-hand-pointer'"></i>
        <span>{{ isGuidedMode ? 'Guided Mode' : 'Free Mode' }}</span>
      </button>
    </div>
  
  </div>

  <!-- Main Content Area -->
  <div class="flex-1 flex flex-col overflow-hidden">
    <div class="flex-1 flex overflow-hidden relative">
      <!-- Visualization Container -->
      <div class="flex-1 flex items-center justify-center p-8 relative">
        <svg #clusterContainer id="cluster-viz"></svg>
        
        <!-- AI Question Button at bottom center -->
        <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 z-10">
          <button 
            (click)="generateAiQuestion()"
            class="ai-question-button px-6 py-3 bg-gradient-to-r from-purple-600 to-purple-500 hover:from-purple-500 hover:to-purple-400 text-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 flex items-center gap-3 font-semibold">
            <i class="fas fa-sparkles"></i>
            <span>Ask AI a Question</span>
          </button>
        </div>
      </div>

      <!-- AI Question Modal -->
      <div *ngIf="showAiModal" 
           class="card-overlay"
           (click)="closeAiModal()">
        <div class="overlay-card" (click)="$event.stopPropagation()">
          <button class="overlay-close" (click)="closeAiModal()">&times;</button>
          
          <!-- API Key Input -->
          <div *ngIf="showApiKeyInput">
            <div class="overlay-header">
              <i class="fas fa-key fa-2x text-purple-400"></i>
              <h3 class="overlay-type">Enter Claude API Key</h3>
            </div>
            <div class="overlay-body space-y-4">
              <p class="text-sm text-slate-300 mb-4">
                Get your API key from <a href="https://console.anthropic.com/" target="_blank" class="text-purple-400 hover:text-purple-300 underline">anthropic.com</a>
              </p>
              <input 
                type="password" 
                [(ngModel)]="apiKeyInput"
                placeholder="sk-ant-..."
                class="w-full px-4 py-2 bg-slate-700 text-white rounded-lg border border-purple-500/30 focus:border-purple-500 focus:outline-none"
                (keyup.enter)="saveApiKey()">
              <button 
                (click)="saveApiKey()"
                class="w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition">
                Save & Generate Question
              </button>
              <p *ngIf="aiError" class="text-red-400 text-sm">{{ aiError }}</p>
            </div>
          </div>

          <!-- Loading State -->
          <div *ngIf="isGeneratingQuestion && !showApiKeyInput">
            <div class="overlay-header">
              <i class="fas fa-sparkles fa-2x text-purple-400 animate-pulse"></i>
              <h3 class="overlay-type">Generating Question...</h3>
            </div>
            <div class="overlay-body flex justify-center py-8">
              <div class="animate-spin rounded-full h-12 w-12 border-4 border-purple-500 border-t-transparent"></div>
            </div>
          </div>

          <!-- Generated Question -->
          <div *ngIf="aiQuestion && !isGeneratingQuestion && !showApiKeyInput">
            <div class="overlay-header">
              <i class="fas fa-comment-dots fa-2x text-purple-400"></i>
              <h3 class="overlay-type">AI-Generated Question</h3>
            </div>
            <div class="overlay-body">
              <p class="text-lg leading-relaxed">{{ aiQuestion }}</p>
            </div>
          </div>

          <!-- Error State -->
          <div *ngIf="aiError && !showApiKeyInput && !isGeneratingQuestion">
            <div class="overlay-header">
              <i class="fas fa-exclamation-circle fa-2x text-red-400"></i>
              <h3 class="overlay-type">Error</h3>
            </div>
            <div class="overlay-body">
              <p class="text-red-300">{{ aiError }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Detail Panel (shown when a node is selected) -->
      <div id="detail-panel" 
           class="hidden w-96 bg-slate-800 border-l border-purple-500/30 overflow-y-auto">
      </div>
    </div>
  </div>



  <!-- Tooltip -->
  <div id="cluster-tooltip" 
       class="absolute hidden bg-slate-800/95 backdrop-blur-md text-white p-4 rounded-xl border border-purple-500/30 shadow-2xl max-w-xs z-50"
       style="pointer-events: none;">
  </div>

</div>
